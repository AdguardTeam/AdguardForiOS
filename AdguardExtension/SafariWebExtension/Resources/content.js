/******/ (() => { // webpackBootstrap
/******/ 	var __webpack_modules__ = ({

/***/ "./node_modules/@babel/runtime/helpers/esm/arrayLikeToArray.js":
/*!*********************************************************************!*\
  !*** ./node_modules/@babel/runtime/helpers/esm/arrayLikeToArray.js ***!
  \*********************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ _arrayLikeToArray)
/* harmony export */ });
function _arrayLikeToArray(arr, len) {
  if (len == null || len > arr.length) len = arr.length;

  for (var i = 0, arr2 = new Array(len); i < len; i++) {
    arr2[i] = arr[i];
  }

  return arr2;
}

/***/ }),

/***/ "./node_modules/@babel/runtime/helpers/esm/arrayWithoutHoles.js":
/*!**********************************************************************!*\
  !*** ./node_modules/@babel/runtime/helpers/esm/arrayWithoutHoles.js ***!
  \**********************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ _arrayWithoutHoles)
/* harmony export */ });
/* harmony import */ var _arrayLikeToArray_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./arrayLikeToArray.js */ "./node_modules/@babel/runtime/helpers/esm/arrayLikeToArray.js");

function _arrayWithoutHoles(arr) {
  if (Array.isArray(arr)) return (0,_arrayLikeToArray_js__WEBPACK_IMPORTED_MODULE_0__.default)(arr);
}

/***/ }),

/***/ "./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js":
/*!*********************************************************************!*\
  !*** ./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js ***!
  \*********************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ _asyncToGenerator)
/* harmony export */ });
function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {
  try {
    var info = gen[key](arg);
    var value = info.value;
  } catch (error) {
    reject(error);
    return;
  }

  if (info.done) {
    resolve(value);
  } else {
    Promise.resolve(value).then(_next, _throw);
  }
}

function _asyncToGenerator(fn) {
  return function () {
    var self = this,
        args = arguments;
    return new Promise(function (resolve, reject) {
      var gen = fn.apply(self, args);

      function _next(value) {
        asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value);
      }

      function _throw(err) {
        asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err);
      }

      _next(undefined);
    });
  };
}

/***/ }),

/***/ "./node_modules/@babel/runtime/helpers/esm/iterableToArray.js":
/*!********************************************************************!*\
  !*** ./node_modules/@babel/runtime/helpers/esm/iterableToArray.js ***!
  \********************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ _iterableToArray)
/* harmony export */ });
function _iterableToArray(iter) {
  if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter);
}

/***/ }),

/***/ "./node_modules/@babel/runtime/helpers/esm/nonIterableSpread.js":
/*!**********************************************************************!*\
  !*** ./node_modules/@babel/runtime/helpers/esm/nonIterableSpread.js ***!
  \**********************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ _nonIterableSpread)
/* harmony export */ });
function _nonIterableSpread() {
  throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
}

/***/ }),

/***/ "./node_modules/@babel/runtime/helpers/esm/toConsumableArray.js":
/*!**********************************************************************!*\
  !*** ./node_modules/@babel/runtime/helpers/esm/toConsumableArray.js ***!
  \**********************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ _toConsumableArray)
/* harmony export */ });
/* harmony import */ var _arrayWithoutHoles_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./arrayWithoutHoles.js */ "./node_modules/@babel/runtime/helpers/esm/arrayWithoutHoles.js");
/* harmony import */ var _iterableToArray_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./iterableToArray.js */ "./node_modules/@babel/runtime/helpers/esm/iterableToArray.js");
/* harmony import */ var _unsupportedIterableToArray_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./unsupportedIterableToArray.js */ "./node_modules/@babel/runtime/helpers/esm/unsupportedIterableToArray.js");
/* harmony import */ var _nonIterableSpread_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./nonIterableSpread.js */ "./node_modules/@babel/runtime/helpers/esm/nonIterableSpread.js");




function _toConsumableArray(arr) {
  return (0,_arrayWithoutHoles_js__WEBPACK_IMPORTED_MODULE_0__.default)(arr) || (0,_iterableToArray_js__WEBPACK_IMPORTED_MODULE_1__.default)(arr) || (0,_unsupportedIterableToArray_js__WEBPACK_IMPORTED_MODULE_2__.default)(arr) || (0,_nonIterableSpread_js__WEBPACK_IMPORTED_MODULE_3__.default)();
}

/***/ }),

/***/ "./node_modules/@babel/runtime/helpers/esm/unsupportedIterableToArray.js":
/*!*******************************************************************************!*\
  !*** ./node_modules/@babel/runtime/helpers/esm/unsupportedIterableToArray.js ***!
  \*******************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ _unsupportedIterableToArray)
/* harmony export */ });
/* harmony import */ var _arrayLikeToArray_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./arrayLikeToArray.js */ "./node_modules/@babel/runtime/helpers/esm/arrayLikeToArray.js");

function _unsupportedIterableToArray(o, minLen) {
  if (!o) return;
  if (typeof o === "string") return (0,_arrayLikeToArray_js__WEBPACK_IMPORTED_MODULE_0__.default)(o, minLen);
  var n = Object.prototype.toString.call(o).slice(8, -1);
  if (n === "Object" && o.constructor) n = o.constructor.name;
  if (n === "Map" || n === "Set") return Array.from(o);
  if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return (0,_arrayLikeToArray_js__WEBPACK_IMPORTED_MODULE_0__.default)(o, minLen);
}

/***/ }),

/***/ "./node_modules/@babel/runtime/regenerator/index.js":
/*!**********************************************************!*\
  !*** ./node_modules/@babel/runtime/regenerator/index.js ***!
  \**********************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

module.exports = __webpack_require__(/*! regenerator-runtime */ "./node_modules/regenerator-runtime/runtime.js");


/***/ }),

/***/ "./src/pages/common/constants.ts":
/*!***************************************!*\
  !*** ./src/pages/common/constants.ts ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "MessagesToNativeApp": () => (/* binding */ MessagesToNativeApp),
/* harmony export */   "MessagesToBackgroundPage": () => (/* binding */ MessagesToBackgroundPage),
/* harmony export */   "MessagesToContentScript": () => (/* binding */ MessagesToContentScript),
/* harmony export */   "AppearanceTheme": () => (/* binding */ AppearanceTheme),
/* harmony export */   "APPEARANCE_THEME_DEFAULT": () => (/* binding */ APPEARANCE_THEME_DEFAULT)
/* harmony export */ });
var MessagesToNativeApp;

(function (MessagesToNativeApp) {
  MessagesToNativeApp["WriteInNativeLog"] = "writeInNativeLog";
  MessagesToNativeApp["GetBlockingData"] = "getBlockingData";
  MessagesToNativeApp["AddToUserRules"] = "addToUserRules";
  MessagesToNativeApp["IsProtectionEnabled"] = "isProtectionEnabled";
  MessagesToNativeApp["EnableProtection"] = "enableProtection";
  MessagesToNativeApp["DisableProtection"] = "disableProtection";
  MessagesToNativeApp["HasUserRulesBySite"] = "hasUserRulesBySite";
  MessagesToNativeApp["RemoveUserRulesBySite"] = "removeUserRulesBySite";
  MessagesToNativeApp["ReportProblem"] = "reportProblem";
  MessagesToNativeApp["IsPremium"] = "isPremium";
  MessagesToNativeApp["GetAppearanceTheme"] = "getAppearanceTheme";
  MessagesToNativeApp["AreContentBlockersEnabled"] = "areContentBlockersEnabled";
  MessagesToNativeApp["UpgradeMe"] = "upgradeMe";
  MessagesToNativeApp["GetAdvancedRulesText"] = "getAdvancedRulesText";
})(MessagesToNativeApp || (MessagesToNativeApp = {}));

var MessagesToBackgroundPage;

(function (MessagesToBackgroundPage) {
  MessagesToBackgroundPage["OpenAssistant"] = "open_assistant";
  MessagesToBackgroundPage["GetScriptsAndSelectors"] = "get_scripts_and_selectors";
  MessagesToBackgroundPage["AddRule"] = "add_rule";
  MessagesToBackgroundPage["GetPopupData"] = "get_popup_data";
  MessagesToBackgroundPage["SetPermissionsModalViewed"] = "set_permissions_modal_viewed";
  MessagesToBackgroundPage["SetProtectionStatus"] = "set_protection_status";
  MessagesToBackgroundPage["DeleteUserRulesByUrl"] = "delete_user_rules_by_url";
  MessagesToBackgroundPage["ReportProblem"] = "report_problem";
  MessagesToBackgroundPage["UpgradeClicked"] = "upgrade_clicked";
})(MessagesToBackgroundPage || (MessagesToBackgroundPage = {}));

var MessagesToContentScript;

(function (MessagesToContentScript) {
  MessagesToContentScript["InitAssistant"] = "init_assistant";
})(MessagesToContentScript || (MessagesToContentScript = {}));

var AppearanceTheme;

(function (AppearanceTheme) {
  AppearanceTheme["System"] = "system";
  AppearanceTheme["Dark"] = "dark";
  AppearanceTheme["Light"] = "light";
})(AppearanceTheme || (AppearanceTheme = {}));

var APPEARANCE_THEME_DEFAULT = AppearanceTheme.System;

/***/ }),

/***/ "./src/pages/content/content.ts":
/*!**************************************!*\
  !*** ./src/pages/content/content.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "content": () => (/* binding */ content)
/* harmony export */ });
/* harmony import */ var _babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @babel/runtime/helpers/toConsumableArray */ "./node_modules/@babel/runtime/helpers/esm/toConsumableArray.js");
/* harmony import */ var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @babel/runtime/helpers/asyncToGenerator */ "./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js");
/* harmony import */ var _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @babel/runtime/regenerator */ "./node_modules/@babel/runtime/regenerator/index.js");
/* harmony import */ var _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var webextension_polyfill_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! webextension-polyfill-ts */ "./node_modules/webextension-polyfill-ts/lib/index.js");
/* harmony import */ var extended_css__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! extended-css */ "./node_modules/extended-css/dist/extended-css.esm.js");
/* harmony import */ var _common_constants__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../common/constants */ "./src/pages/common/constants.ts");




/* eslint-disable no-console */




/**
 * Logs a message if verbose is true
 *
 * @param verbose
 * @param message
 */
var logMessage = function logMessage(verbose, message) {
  if (verbose) {
    console.log("(AG) ".concat(message));
  }
};

var getSelectorsAndScripts = /*#__PURE__*/function () {
  var _ref = (0,_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__.default)( /*#__PURE__*/_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2___default().mark(function _callee() {
    var response;
    return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2___default().wrap(function _callee$(_context) {
      while (1) {
        switch (_context.prev = _context.next) {
          case 0:
            _context.next = 2;
            return webextension_polyfill_ts__WEBPACK_IMPORTED_MODULE_3__.browser.runtime.sendMessage({
              type: _common_constants__WEBPACK_IMPORTED_MODULE_5__.MessagesToBackgroundPage.GetScriptsAndSelectors,
              data: {
                url: window.location.href
              }
            });

          case 2:
            response = _context.sent;

            if (!(response === null)) {
              _context.next = 6;
              break;
            }

            console.log('AG: no scripts and selectors received');
            return _context.abrupt("return", null);

          case 6:
            return _context.abrupt("return", response);

          case 7:
          case "end":
            return _context.stop();
        }
      }
    }, _callee);
  }));

  return function getSelectorsAndScripts() {
    return _ref.apply(this, arguments);
  };
}();
/**
 * Execute scripts in a page context and cleanup itself when execution completes
 * @param scripts Scripts array to execute
 */


var executeScripts = function executeScripts(scripts) {
  // Wrap with try catch
  var start = '( function () { try {';
  var end = "} catch (ex) { console.error('Error executing AG js: ' + ex); } })();";
  var updated = [start].concat((0,_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0__.default)(scripts), [end]);
  var scriptTag = document.createElement('script');
  scriptTag.setAttribute('type', 'text/javascript');
  scriptTag.textContent = updated.join('\r\n');
  var parent = document.head || document.documentElement;
  parent.appendChild(scriptTag);

  if (scriptTag.parentNode) {
    scriptTag.parentNode.removeChild(scriptTag);
  }
};
/**
 * Applies JS injections.
 * @param scripts Array with JS scripts
 * @param verbose logging
 */


var applyScripts = function applyScripts(scripts, verbose) {
  if (!scripts || scripts.length === 0) {
    return;
  }

  logMessage(verbose, "scripts length: ".concat(scripts.length));
  executeScripts(scripts.reverse());
};
/**
 * Protects specified style element from changes to the current document
 * Add a mutation observer, which is adds our rules again if it was removed
 *
 * @param protectStyleEl protected style element
 */


var protectStyleElementContent = function protectStyleElementContent(protectStyleEl) {
  // @ts-ignore
  var MutationObserver = window.MutationObserver || window.WebKitMutationObserver;

  if (!MutationObserver) {
    return;
  }
  /* observer, which observe protectStyleEl inner changes, without deleting styleEl */


  var innerObserver = new MutationObserver(function (mutations) {
    for (var i = 0; i < mutations.length; i += 1) {
      var m = mutations[i]; // @ts-ignore

      if (protectStyleEl.hasAttribute('mod') && protectStyleEl.getAttribute('mod') === 'inner') {
        // @ts-ignore
        protectStyleEl.removeAttribute('mod');
        break;
      } // @ts-ignore


      protectStyleEl.setAttribute('mod', 'inner');
      var isProtectStyleElModified = false;
      /**
       * further, there are two mutually exclusive situations: either there were changes
       * the text of protectStyleEl, either there was removes a whole child "text"
       * element of protectStyleEl we'll process both of them
       */

      if (m.removedNodes.length > 0) {
        for (var j = 0; j < m.removedNodes.length; j += 1) {
          isProtectStyleElModified = true;
          protectStyleEl.appendChild(m.removedNodes[j]);
        }
      } else if (m.oldValue) {
        isProtectStyleElModified = true; // eslint-disable-next-line no-param-reassign

        protectStyleEl.textContent = m.oldValue;
      }

      if (!isProtectStyleElModified) {
        // @ts-ignore
        protectStyleEl.removeAttribute('mod');
      }
    }
  });
  innerObserver.observe(protectStyleEl, {
    childList: true,
    characterData: true,
    subtree: true,
    characterDataOldValue: true
  });
};
/**
 * Applies css stylesheet
 * @param styleSelectors Array of stylesheets or selectors
 * @param verbose logging
 */


var applyCss = function applyCss(styleSelectors, verbose) {
  if (!styleSelectors || !styleSelectors.length) {
    return;
  }

  logMessage(verbose, "css length: ".concat(styleSelectors.length));
  var styleElement = document.createElement('style');
  styleElement.setAttribute('type', 'text/css');
  (document.head || document.documentElement).appendChild(styleElement);
  var selectors = styleSelectors.map(function (s) {
    return s.trim();
  });
  selectors.forEach(function (selector) {
    styleElement.sheet.insertRule(selector);
  });
  protectStyleElementContent(styleElement);
};
/**
 * Applies Extended Css stylesheet
 *
 * @param extendedCss Array with ExtendedCss stylesheets
 * @param verbose logging
 */


var applyExtendedCss = function applyExtendedCss(extendedCss, verbose) {
  if (!extendedCss || !extendedCss.length) {
    return;
  }

  logMessage(verbose, "extended css length: ".concat(extendedCss.length));
  var extcss = new extended_css__WEBPACK_IMPORTED_MODULE_4__.default({
    styleSheet: extendedCss.filter(function (s) {
      return s.length > 0;
    }).map(function (s) {
      return s.trim();
    }).map(function (s) {
      return s[s.length - 1] !== '}' ? "".concat(s, " {display:none!important;}") : s;
    }).join('\n')
  });
  extcss.apply();
};
/**
 * Applies injected script and css
 *
 * @param selectorsAndScripts
 * @param verbose
 */


var applyAdvancedBlockingData = function applyAdvancedBlockingData(selectorsAndScripts) {
  var verbose = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;
  logMessage(verbose, 'Applying scripts and css..');
  logMessage(verbose, "Frame url: ".concat(window.location.href));
  applyScripts(selectorsAndScripts.scripts, verbose);
  applyCss(selectorsAndScripts.cssInject, verbose);
  applyExtendedCss(selectorsAndScripts.cssExtended, verbose);
  logMessage(verbose, 'Applying scripts and css - done');
};

var init = /*#__PURE__*/function () {
  var _ref2 = (0,_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__.default)( /*#__PURE__*/_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2___default().mark(function _callee2() {
    var startGettingScripts, selectorsAndScripts;
    return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2___default().wrap(function _callee2$(_context2) {
      while (1) {
        switch (_context2.prev = _context2.next) {
          case 0:
            if (!(document instanceof HTMLDocument)) {
              _context2.next = 15;
              break;
            }

            if (!(window.location.href && window.location.href.indexOf('http') === 0)) {
              _context2.next = 15;
              break;
            }

            startGettingScripts = Date.now();
            _context2.prev = 3;
            _context2.next = 6;
            return getSelectorsAndScripts();

          case 6:
            selectorsAndScripts = _context2.sent;
            console.log(selectorsAndScripts);
            _context2.next = 13;
            break;

          case 10:
            _context2.prev = 10;
            _context2.t0 = _context2["catch"](3);
            console.log(_context2.t0);

          case 13:
            console.log("Time to get selectors and scripts from native page to content script: ".concat(Date.now() - startGettingScripts, " ms"));

            if (selectorsAndScripts) {
              applyAdvancedBlockingData(selectorsAndScripts, false);
            }

          case 15:
          case "end":
            return _context2.stop();
        }
      }
    }, _callee2, null, [[3, 10]]);
  }));

  return function init() {
    return _ref2.apply(this, arguments);
  };
}();

var content = {
  init: init
};

/***/ }),

/***/ "./src/pages/content/index.ts":
/*!************************************!*\
  !*** ./src/pages/content/index.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "content": () => (/* reexport safe */ _content__WEBPACK_IMPORTED_MODULE_0__.content)
/* harmony export */ });
/* harmony import */ var _content__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./content */ "./src/pages/content/content.ts");


/***/ }),

/***/ "./node_modules/extended-css/dist/extended-css.esm.js":
/*!************************************************************!*\
  !*** ./node_modules/extended-css/dist/extended-css.esm.js ***!
  \************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/*! extended-css - v1.3.12 - Mon May 31 2021
* https://github.com/AdguardTeam/ExtendedCss
* Copyright (c) 2021 AdGuard. Licensed LGPL-3.0
*/
function _typeof(obj) {
  "@babel/helpers - typeof";

  if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") {
    _typeof = function (obj) {
      return typeof obj;
    };
  } else {
    _typeof = function (obj) {
      return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;
    };
  }

  return _typeof(obj);
}

function _slicedToArray(arr, i) {
  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();
}

function _toConsumableArray(arr) {
  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();
}

function _arrayWithoutHoles(arr) {
  if (Array.isArray(arr)) return _arrayLikeToArray(arr);
}

function _arrayWithHoles(arr) {
  if (Array.isArray(arr)) return arr;
}

function _iterableToArray(iter) {
  if (typeof Symbol !== "undefined" && Symbol.iterator in Object(iter)) return Array.from(iter);
}

function _iterableToArrayLimit(arr, i) {
  if (typeof Symbol === "undefined" || !(Symbol.iterator in Object(arr))) return;
  var _arr = [];
  var _n = true;
  var _d = false;
  var _e = undefined;

  try {
    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {
      _arr.push(_s.value);

      if (i && _arr.length === i) break;
    }
  } catch (err) {
    _d = true;
    _e = err;
  } finally {
    try {
      if (!_n && _i["return"] != null) _i["return"]();
    } finally {
      if (_d) throw _e;
    }
  }

  return _arr;
}

function _unsupportedIterableToArray(o, minLen) {
  if (!o) return;
  if (typeof o === "string") return _arrayLikeToArray(o, minLen);
  var n = Object.prototype.toString.call(o).slice(8, -1);
  if (n === "Object" && o.constructor) n = o.constructor.name;
  if (n === "Map" || n === "Set") return Array.from(o);
  if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);
}

function _arrayLikeToArray(arr, len) {
  if (len == null || len > arr.length) len = arr.length;

  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];

  return arr2;
}

function _nonIterableSpread() {
  throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
}

function _nonIterableRest() {
  throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
}

/**
 * Copyright 2016 Adguard Software Ltd
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/* eslint-disable no-console */
var utils = {};
utils.MutationObserver = window.MutationObserver || window.WebKitMutationObserver;
/**
 * Stores native Node textContent getter to be used for contains pseudo-class
 * because elements' 'textContent' and 'innerText' properties might be mocked
 * https://github.com/AdguardTeam/ExtendedCss/issues/127
 */

utils.nodeTextContentGetter = function () {
  var nativeNode = window.Node || Node;
  return Object.getOwnPropertyDescriptor(nativeNode.prototype, 'textContent').get;
}();

utils.isSafariBrowser = function () {
  var isChrome = navigator.userAgent.indexOf('Chrome') > -1;
  var isSafari = navigator.userAgent.indexOf('Safari') > -1;

  if (isSafari) {
    if (isChrome) {
      // Chrome seems to have both Chrome and Safari userAgents
      return false;
    }

    return true;
  }

  return false;
}();
/**
 * Converts regular expressions passed as pseudo class arguments into RegExp instances.
 * Have to unescape doublequote " as well, because we escape them while enclosing such
 * arguments with doublequotes, and sizzle does not automatically unescapes them.
 */


utils.pseudoArgToRegex = function (regexSrc, flag) {
  flag = flag || 'i';
  regexSrc = regexSrc.trim().replace(/\\(["\\])/g, '$1');
  return new RegExp(regexSrc, flag);
};
/**
 * Converts string to the regexp
 * @param {string} str
 * @returns {RegExp}
 */


utils.toRegExp = function (str) {
  if (str[0] === '/' && str[str.length - 1] === '/') {
    return new RegExp(str.slice(1, -1));
  }

  var escaped = str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
  return new RegExp(escaped);
};

utils.startsWith = function (str, prefix) {
  // if str === '', (str && false) will return ''
  // that's why it has to be !!str
  return !!str && str.indexOf(prefix) === 0;
};

utils.endsWith = function (str, postfix) {
  if (!str || !postfix) {
    return false;
  }

  if (str.endsWith) {
    return str.endsWith(postfix);
  }

  var t = String(postfix);
  var index = str.lastIndexOf(t);
  return index >= 0 && index === str.length - t.length;
};
/**
 * Helper function for creating regular expression from a url filter rule syntax.
 */


utils.createURLRegex = function () {
  // Constants
  var regexConfiguration = {
    maskStartUrl: '||',
    maskPipe: '|',
    maskSeparator: '^',
    maskAnySymbol: '*',
    regexAnySymbol: '.*',
    regexSeparator: '([^ a-zA-Z0-9.%_-]|$)',
    regexStartUrl: '^(http|https|ws|wss)://([a-z0-9-_.]+\\.)?',
    regexStartString: '^',
    regexEndString: '$'
  }; // https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/regexp
  // should be escaped . * + ? ^ $ { } ( ) | [ ] / \
  // except of * | ^

  var specials = ['.', '+', '?', '$', '{', '}', '(', ')', '[', ']', '\\', '/'];
  var specialsRegex = new RegExp("[".concat(specials.join('\\'), "]"), 'g');
  /**
   * Escapes regular expression string
   */

  var escapeRegExp = function escapeRegExp(str) {
    return str.replace(specialsRegex, '\\$&');
  };

  var replaceAll = function replaceAll(str, find, replace) {
    if (!str) {
      return str;
    }

    return str.split(find).join(replace);
  };
  /**
   * Main function that converts a url filter rule string to a regex.
   * @param {string} str
   * @return {RegExp}
   */


  var createRegexText = function createRegexText(str) {
    var regex = escapeRegExp(str);

    if (utils.startsWith(regex, regexConfiguration.maskStartUrl)) {
      regex = regex.substring(0, regexConfiguration.maskStartUrl.length) + replaceAll(regex.substring(regexConfiguration.maskStartUrl.length, regex.length - 1), '\|', '\\|') + regex.substring(regex.length - 1);
    } else if (utils.startsWith(regex, regexConfiguration.maskPipe)) {
      regex = regex.substring(0, regexConfiguration.maskPipe.length) + replaceAll(regex.substring(regexConfiguration.maskPipe.length, regex.length - 1), '\|', '\\|') + regex.substring(regex.length - 1);
    } else {
      regex = replaceAll(regex.substring(0, regex.length - 1), '\|', '\\|') + regex.substring(regex.length - 1);
    } // Replacing special url masks


    regex = replaceAll(regex, regexConfiguration.maskAnySymbol, regexConfiguration.regexAnySymbol);
    regex = replaceAll(regex, regexConfiguration.maskSeparator, regexConfiguration.regexSeparator);

    if (utils.startsWith(regex, regexConfiguration.maskStartUrl)) {
      regex = regexConfiguration.regexStartUrl + regex.substring(regexConfiguration.maskStartUrl.length);
    } else if (utils.startsWith(regex, regexConfiguration.maskPipe)) {
      regex = regexConfiguration.regexStartString + regex.substring(regexConfiguration.maskPipe.length);
    }

    if (utils.endsWith(regex, regexConfiguration.maskPipe)) {
      regex = regex.substring(0, regex.length - 1) + regexConfiguration.regexEndString;
    }

    return new RegExp(regex, 'i');
  };

  return createRegexText;
}();
/**
 * Creates an object implementing Location interface from a url.
 * An alternative to URL.
 * https://github.com/AdguardTeam/FingerprintingBlocker/blob/master/src/shared/url.ts#L64
 */


utils.createLocation = function (href) {
  var anchor = document.createElement('a');
  anchor.href = href;

  if (anchor.host === '') {
    anchor.href = anchor.href; // eslint-disable-line no-self-assign
  }

  return anchor;
};
/**
 * Checks whether A has the same origin as B.
 * @param {string} urlA location.href of A.
 * @param {Location} locationB location of B.
 * @param {string} domainB document.domain of B.
 * @return {boolean}
 */


utils.isSameOrigin = function (urlA, locationB, domainB) {
  var locationA = utils.createLocation(urlA); // eslint-disable-next-line no-script-url

  if (locationA.protocol === 'javascript:' || locationA.href === 'about:blank') {
    return true;
  }

  if (locationA.protocol === 'data:' || locationA.protocol === 'file:') {
    return false;
  }

  return locationA.hostname === domainB && locationA.port === locationB.port && locationA.protocol === locationB.protocol;
};
/**
 * A helper class to throttle function calls with setTimeout and requestAnimationFrame.
 */


utils.AsyncWrapper = function () {
  /**
   * PhantomJS passes a wrong timestamp to the requestAnimationFrame callback and that breaks the AsyncWrapper logic
   * https://github.com/ariya/phantomjs/issues/14832
   */
  var supported = typeof window.requestAnimationFrame !== 'undefined' && !/phantom/i.test(navigator.userAgent);
  var rAF = supported ? requestAnimationFrame : setTimeout;
  var cAF = supported ? cancelAnimationFrame : clearTimeout;
  var perf = supported ? performance : Date;
  /**
   * @param {Function} callback
   * @param {number} throttle number, the provided callback should be executed twice
   * in this time frame.
   * @constructor
   */

  function AsyncWrapper(callback, throttle) {
    this.callback = callback;
    this.throttle = throttle;
    this.wrappedCallback = this.wrappedCallback.bind(this);

    if (this.wrappedAsapCallback) {
      this.wrappedAsapCallback = this.wrappedAsapCallback.bind(this);
    }
  }
  /** @private */


  AsyncWrapper.prototype.wrappedCallback = function (ts) {
    this.lastRun = isNumber(ts) ? ts : perf.now();
    delete this.rAFid;
    delete this.timerId;
    delete this.asapScheduled;
    this.callback();
  };
  /** @private Indicates whether there is a scheduled callback. */


  AsyncWrapper.prototype.hasPendingCallback = function () {
    return isNumber(this.rAFid) || isNumber(this.timerId);
  };
  /**
   * Schedules a function call before the next animation frame.
   */


  AsyncWrapper.prototype.run = function () {
    if (this.hasPendingCallback()) {
      // There is a pending execution scheduled.
      return;
    }

    if (typeof this.lastRun !== 'undefined') {
      var elapsed = perf.now() - this.lastRun;

      if (elapsed < this.throttle) {
        this.timerId = setTimeout(this.wrappedCallback, this.throttle - elapsed);
        return;
      }
    }

    this.rAFid = rAF(this.wrappedCallback);
  };
  /**
   * Schedules a function call in the most immenent microtask.
   * This cannot be canceled.
   */


  AsyncWrapper.prototype.runAsap = function () {
    if (this.asapScheduled) {
      return;
    }

    this.asapScheduled = true;
    cAF(this.rAFid);
    clearTimeout(this.timerId);

    if (utils.MutationObserver) {
      /**
       * Using MutationObservers to access microtask queue is a standard technique,
       * used in ASAP library
       * {@link https://github.com/kriskowal/asap/blob/master/browser-raw.js#L140}
       */
      if (!this.mo) {
        this.mo = new utils.MutationObserver(this.wrappedCallback);
        this.node = document.createTextNode(1);
        this.mo.observe(this.node, {
          characterData: true
        });
      }

      this.node.nodeValue = -this.node.nodeValue;
    } else {
      setTimeout(this.wrappedCallback);
    }
  };
  /**
   * Runs scheduled execution immediately, if there were any.
   */


  AsyncWrapper.prototype.runImmediately = function () {
    if (this.hasPendingCallback()) {
      cAF(this.rAFid);
      clearTimeout(this.timerId);
      delete this.rAFid;
      delete this.timerId;
      this.wrappedCallback();
    }
  };

  AsyncWrapper.now = function () {
    return perf.now();
  };

  return AsyncWrapper;
}();
/**
 * Stores native OdP to be used in WeakMap and Set polyfills.
 */


utils.defineProperty = Object.defineProperty;
utils.WeakMap = typeof WeakMap !== 'undefined' ? WeakMap : function () {
  /** Originally based on {@link https://github.com/Polymer/WeakMap} */
  var counter = Date.now() % 1e9;

  var WeakMap = function WeakMap() {
    this.name = "__st".concat(Math.random() * 1e9 >>> 0).concat(counter++, "__");
  };

  WeakMap.prototype = {
    set: function set(key, value) {
      var entry = key[this.name];

      if (entry && entry[0] === key) {
        entry[1] = value;
      } else {
        utils.defineProperty(key, this.name, {
          value: [key, value],
          writable: true
        });
      }

      return this;
    },
    get: function get(key) {
      var entry = key[this.name];
      return entry && entry[0] === key ? entry[1] : undefined;
    },
    delete: function _delete(key) {
      var entry = key[this.name];

      if (!entry) {
        return false;
      }

      var hasValue = entry[0] === key;
      delete entry[0];
      delete entry[1];
      return hasValue;
    },
    has: function has(key) {
      var entry = key[this.name];

      if (!entry) {
        return false;
      }

      return entry[0] === key;
    }
  };
  return WeakMap;
}();
utils.Set = typeof Set !== 'undefined' ? Set : function () {
  var counter = Date.now() % 1e9;
  /**
   * A polyfill which covers only the basic usage.
   * Only supports methods that are supported in IE11.
   * {@link https://docs.microsoft.com/en-us/scripting/javascript/reference/set-object-javascript}
   * Assumes that 'key's are all objects, not primitives such as a number.
   *
   * @param {Array} items Initial items in this set
   */

  var Set = function Set(items) {
    this.name = "__st".concat(Math.random() * 1e9 >>> 0).concat(counter++, "__");
    this.keys = [];

    if (items && items.length) {
      var iItems = items.length;

      while (iItems--) {
        this.add(items[iItems]);
      }
    }
  };

  Set.prototype = {
    add: function add(key) {
      if (!isNumber(key[this.name])) {
        var index = this.keys.push(key) - 1;
        utils.defineProperty(key, this.name, {
          value: index,
          writable: true
        });
      }
    },
    delete: function _delete(key) {
      if (isNumber(key[this.name])) {
        var index = key[this.name];
        delete this.keys[index];
        key[this.name] = undefined;
      }
    },
    has: function has(key) {
      return isNumber(key[this.name]);
    },
    clear: function clear() {
      this.keys.forEach(function (key) {
        key[this.name] = undefined;
      });
      this.keys.length = 0;
    },
    forEach: function forEach(cb) {
      var that = this;
      this.keys.forEach(function (value) {
        cb(value, value, that);
      });
    }
  };
  utils.defineProperty(Set.prototype, 'size', {
    get: function get() {
      // Skips holes.
      return this.keys.reduce(function (acc) {
        return acc + 1;
      }, 0);
    }
  });
  return Set;
}();
/**
 * Vendor-specific Element.prototype.matches
 */

utils.matchesPropertyName = function () {
  var props = ['matches', 'matchesSelector', 'mozMatchesSelector', 'msMatchesSelector', 'oMatchesSelector', 'webkitMatchesSelector'];

  for (var i = 0; i < 6; i++) {
    if (Element.prototype.hasOwnProperty(props[i])) {
      return props[i];
    }
  }
}();
/**
 * Provides stats information
 */


utils.Stats = function () {
  /** @member {Array<number>} */
  this.array = [];
  /** @member {number} */

  this.length = 0;
  var zeroDescriptor = {
    value: 0,
    writable: true
  };
  /** @member {number} @private */

  Object.defineProperty(this, 'sum', zeroDescriptor);
  /** @member {number} @private */

  Object.defineProperty(this, 'squaredSum', zeroDescriptor);
};
/**
 * @param {number} dataPoint data point
 */


utils.Stats.prototype.push = function (dataPoint) {
  this.array.push(dataPoint);
  this.length++;
  this.sum += dataPoint;
  this.squaredSum += dataPoint * dataPoint;
  /** @member {number} */

  this.mean = this.sum / this.length;
  /** @member {number} */
  // eslint-disable-next-line no-restricted-properties

  this.stddev = Math.sqrt(this.squaredSum / this.length - Math.pow(this.mean, 2));
};
/** Safe console.error version */


utils.logError = typeof console !== 'undefined' && console.error && Function.prototype.bind && console.error.bind ? console.error.bind(window.console) : console.error;
/** Safe console.info version */

utils.logInfo = typeof console !== 'undefined' && console.info && Function.prototype.bind && console.info.bind ? console.info.bind(window.console) : console.info;

function isNumber(obj) {
  return typeof obj === 'number';
}
/**
 * Returns path to element we will use as element identifier
 * @param {Element} inputEl
 * @returns {string} - path to the element
 */


utils.getNodeSelector = function (inputEl) {
  if (!(inputEl instanceof Element)) {
    throw new Error('Function received argument with wrong type');
  }

  var el = inputEl;
  var path = []; // we need to check '!!el' first because it is possible
  // that some ancestor of the inputEl was removed before it

  while (!!el && el.nodeType === Node.ELEMENT_NODE) {
    var selector = el.nodeName.toLowerCase();

    if (el.id && typeof el.id === 'string') {
      selector += "#".concat(el.id);
      path.unshift(selector);
      break;
    } else {
      var sibling = el;
      var nth = 1;

      while (sibling.previousSibling) {
        sibling = sibling.previousSibling;

        if (sibling.nodeType === Node.ELEMENT_NODE && sibling.nodeName.toLowerCase() === selector) {
          nth++;
        }
      }

      if (nth !== 1) {
        selector += ":nth-of-type(".concat(nth, ")");
      }
    }

    path.unshift(selector);
    el = el.parentNode;
  }

  return path.join(' > ');
};

/**
 * Copyright 2016 Adguard Software Ltd
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/**
 * Helper class css utils
 *
 * @type {{normalize}}
 */
var cssUtils = function () {
  /**
   * Regex that matches AdGuard's backward compatible syntaxes.
   */
  var reAttrFallback = /\[-(?:ext|abp)-([a-z-_]+)=(["'])((?:(?=(\\?))\4.)*?)\2\]/g;
  /**
   * Complex replacement function.
   * Unescapes quote characters inside of an extended selector.
   *
   * @param match     Whole matched string
   * @param name      Group 1
   * @param quoteChar Group 2
   * @param value     Group 3
   */

  var evaluateMatch = function evaluateMatch(match, name, quoteChar, value) {
    // Unescape quotes
    var re = new RegExp("([^\\\\]|^)\\\\".concat(quoteChar), 'g');
    value = value.replace(re, "$1".concat(quoteChar));
    return ":".concat(name, "(").concat(value, ")");
  }; // Sizzle's parsing of pseudo class arguments is buggy on certain circumstances
  // We support following form of arguments:
  // 1. for :matches-css, those of a form {propertyName}: /.*/
  // 2. for :contains, those of a form /.*/
  // We transform such cases in a way that Sizzle has no ambiguity in parsing arguments.


  var reMatchesCss = /\:(matches-css(?:-after|-before)?)\(([a-z-\s]*\:\s*\/(?:\\.|[^\/])*?\/\s*)\)/g;
  var reContains = /:(?:-abp-)?(contains|has-text)\((\s*\/(?:\\.|[^\/])*?\/\s*)\)/g;
  var reScope = /\(\:scope >/g; // Note that we require `/` character in regular expressions to be escaped.

  /**
   * Used for pre-processing pseudo-classes values with above two regexes.
   */

  var addQuotes = function addQuotes(_, c1, c2) {
    return ":".concat(c1, "(\"").concat(c2.replace(/["\\]/g, '\\$&'), "\")");
  };

  var SCOPE_REPLACER = '(>';
  /**
   * Normalizes specified css text in a form that can be parsed by the
   * Sizzle engine.
   * Normalization means
   *  1. transforming [-ext-*=""] attributes to pseudo classes
   *  2. enclosing possibly ambiguous arguments of `:contains`,
   *     `:matches-css` pseudo classes with quotes.
   * @param {string} cssText
   * @return {string}
   */

  var normalize = function normalize(cssText) {
    var normalizedCssText = cssText.replace(reAttrFallback, evaluateMatch).replace(reMatchesCss, addQuotes).replace(reContains, addQuotes).replace(reScope, SCOPE_REPLACER);
    return normalizedCssText;
  };

  var isSimpleSelectorValid = function isSimpleSelectorValid(selector) {
    try {
      document.querySelectorAll(selector);
    } catch (e) {
      return false;
    }

    return true;
  };

  return {
    normalize: normalize,
    isSimpleSelectorValid: isSimpleSelectorValid
  };
}();

/*!
 * Sizzle CSS Selector Engine v2.3.4-pre-adguard
 * https://sizzlejs.com/
 *
 * Copyright JS Foundation and other contributors
 * Released under the MIT license
 * https://js.foundation/
 *
 * Date: 2020-08-04
 */

/**
 * Version of Sizzle patched by AdGuard in order to be used in the ExtendedCss module.
 * https://github.com/AdguardTeam/sizzle-extcss
 *
 * Look for [AdGuard Patch] and ADGUARD_EXTCSS markers to find out what exactly was changed by us.
 *
 * Global changes:
 * 1. Added additional parameters to the "Sizzle.tokenize" method so that it can be used for stylesheets parsing and validation.
 * 2. Added tokens re-sorting mechanism forcing slow pseudos to be matched last  (see sortTokenGroups).
 * 3. Fix the nonnativeSelectorCache caching -- there was no value corresponding to a key.
 * 4. Added Sizzle.compile call to the `:has` pseudo definition.
 *
 * Changes that are applied to the ADGUARD_EXTCSS build only:
 * 1. Do not expose Sizzle to the global scope. Initialize it lazily via initializeSizzle().
 * 2. Removed :contains pseudo declaration -- its syntax is changed and declared outside of Sizzle.
 * 3. Removed declarations for the following non-standard pseudo classes:
 * :parent, :header, :input, :button, :text, :first, :last, :eq,
 * :even, :odd, :lt, :gt, :nth, :radio, :checkbox, :file,
 * :password, :image, :submit, :reset
 * 4. Added es6 module export
 */
var Sizzle;
/**
 * Initializes Sizzle object.
 * In the case of AdGuard ExtendedCss we want to avoid initializing Sizzle right away
 * and exposing it to the global scope.
 */

var initializeSizzle = function initializeSizzle() {
  // jshint ignore:line
  if (!Sizzle) {
    //<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
    Sizzle = function (window) {
      var support,
          Expr,
          getText,
          isXML,
          tokenize,
          compile,
          select,
          outermostContext,
          sortInput,
          hasDuplicate,
          // Local document vars
      setDocument,
          document,
          docElem,
          documentIsHTML,
          rbuggyQSA,
          rbuggyMatches,
          matches,
          contains,
          // Instance-specific data
      expando = "sizzle" + 1 * new Date(),
          preferredDoc = window.document,
          dirruns = 0,
          done = 0,
          classCache = createCache(),
          tokenCache = createCache(),
          compilerCache = createCache(),
          nonnativeSelectorCache = createCache(),
          sortOrder = function sortOrder(a, b) {
        if (a === b) {
          hasDuplicate = true;
        }

        return 0;
      },
          // Instance methods
      hasOwn = {}.hasOwnProperty,
          arr = [],
          pop = arr.pop,
          push_native = arr.push,
          push = arr.push,
          slice = arr.slice,
          // Use a stripped-down indexOf as it's faster than native
      // https://jsperf.com/thor-indexof-vs-for/5
      indexOf = function indexOf(list, elem) {
        var i = 0,
            len = list.length;

        for (; i < len; i++) {
          if (list[i] === elem) {
            return i;
          }
        }

        return -1;
      },
          booleans = "checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",
          // Regular expressions
      // http://www.w3.org/TR/css3-selectors/#whitespace
      whitespace = "[\\x20\\t\\r\\n\\f]",
          // http://www.w3.org/TR/CSS21/syndata.html#value-def-identifier
      identifier = "(?:\\\\.|[\\w-]|[^\0-\\xa0])+",
          // Attribute selectors: http://www.w3.org/TR/selectors/#attribute-selectors
      attributes = "\\[" + whitespace + "*(" + identifier + ")(?:" + whitespace + // Operator (capture 2)
      "*([*^$|!~]?=)" + whitespace + // "Attribute values must be CSS identifiers [capture 5] or strings [capture 3 or capture 4]"
      "*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|(" + identifier + "))|)" + whitespace + "*\\]",
          pseudos = ":(" + identifier + ")(?:\\((" + // To reduce the number of selectors needing tokenize in the preFilter, prefer arguments:
      // 1. quoted (capture 3; capture 4 or capture 5)
      "('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|" + // 2. simple (capture 6)
      "((?:\\\\.|[^\\\\()[\\]]|" + attributes + ")*)|" + // 3. anything else (capture 2)
      ".*" + ")\\)|)",
          // Leading and non-escaped trailing whitespace, capturing some non-whitespace characters preceding the latter
      rwhitespace = new RegExp(whitespace + "+", "g"),
          rtrim = new RegExp("^" + whitespace + "+|((?:^|[^\\\\])(?:\\\\.)*)" + whitespace + "+$", "g"),
          rcomma = new RegExp("^" + whitespace + "*," + whitespace + "*"),
          rcombinators = new RegExp("^" + whitespace + "*([>+~]|" + whitespace + ")" + whitespace + "*"),
          rpseudo = new RegExp(pseudos),
          ridentifier = new RegExp("^" + identifier + "$"),
          matchExpr = {
        "ID": new RegExp("^#(" + identifier + ")"),
        "CLASS": new RegExp("^\\.(" + identifier + ")"),
        "TAG": new RegExp("^(" + identifier + "|[*])"),
        "ATTR": new RegExp("^" + attributes),
        "PSEUDO": new RegExp("^" + pseudos),
        "CHILD": new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\(" + whitespace + "*(even|odd|(([+-]|)(\\d*)n|)" + whitespace + "*(?:([+-]|)" + whitespace + "*(\\d+)|))" + whitespace + "*\\)|)", "i"),
        "bool": new RegExp("^(?:" + booleans + ")$", "i"),
        // For use in libraries implementing .is()
        // We use this for POS matching in `select`
        "needsContext": new RegExp("^" + whitespace + "*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\(" + whitespace + "*((?:-\\d)?\\d*)" + whitespace + "*\\)|)(?=[^-]|$)", "i")
      },
          rnative = /^[^{]+\{\s*\[native \w/,
          // Easily-parseable/retrievable ID or TAG or CLASS selectors
      rquickExpr = /^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,
          rsibling = /[+~]/,
          // CSS escapes
      // http://www.w3.org/TR/CSS21/syndata.html#escaped-characters
      runescape = new RegExp("\\\\([\\da-f]{1,6}" + whitespace + "?|(" + whitespace + ")|.)", "ig"),
          funescape = function funescape(_, escaped, escapedWhitespace) {
        var high = "0x" + escaped - 0x10000; // NaN means non-codepoint
        // Support: Firefox<24
        // Workaround erroneous numeric interpretation of +"0x"

        return high !== high || escapedWhitespace ? escaped : high < 0 ? // BMP codepoint
        String.fromCharCode(high + 0x10000) : // Supplemental Plane codepoint (surrogate pair)
        String.fromCharCode(high >> 10 | 0xD800, high & 0x3FF | 0xDC00);
      },
          // CSS string/identifier serialization
      // https://drafts.csswg.org/cssom/#common-serializing-idioms
      rcssescape = /([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,
          fcssescape = function fcssescape(ch, asCodePoint) {
        if (asCodePoint) {
          // U+0000 NULL becomes U+FFFD REPLACEMENT CHARACTER
          if (ch === "\0") {
            return "\uFFFD";
          } // Control characters and (dependent upon position) numbers get escaped as code points


          return ch.slice(0, -1) + "\\" + ch.charCodeAt(ch.length - 1).toString(16) + " ";
        } // Other potentially-special ASCII characters get backslash-escaped


        return "\\" + ch;
      },
          // Used for iframes
      // See setDocument()
      // Removing the function wrapper causes a "Permission Denied"
      // error in IE
      unloadHandler = function unloadHandler() {
        setDocument();
      },
          inDisabledFieldset = addCombinator(function (elem) {
        return elem.disabled === true && elem.nodeName.toLowerCase() === "fieldset";
      }, {
        dir: "parentNode",
        next: "legend"
      }); // Optimize for push.apply( _, NodeList )


      try {
        push.apply(arr = slice.call(preferredDoc.childNodes), preferredDoc.childNodes); // Support: Android<4.0
        // Detect silently failing push.apply

        arr[preferredDoc.childNodes.length].nodeType;
      } catch (e) {
        push = {
          apply: arr.length ? // Leverage slice if possible
          function (target, els) {
            push_native.apply(target, slice.call(els));
          } : // Support: IE<9
          // Otherwise append directly
          function (target, els) {
            var j = target.length,
                i = 0; // Can't trust NodeList.length

            while (target[j++] = els[i++]) {}

            target.length = j - 1;
          }
        };
      }

      function Sizzle(selector, context, results, seed) {
        var m,
            i,
            elem,
            nid,
            match,
            groups,
            newSelector,
            newContext = context && context.ownerDocument,
            // nodeType defaults to 9, since context defaults to document
        nodeType = context ? context.nodeType : 9;
        results = results || []; // Return early from calls with invalid selector or context

        if (typeof selector !== "string" || !selector || nodeType !== 1 && nodeType !== 9 && nodeType !== 11) {
          return results;
        } // Try to shortcut find operations (as opposed to filters) in HTML documents


        if (!seed) {
          if ((context ? context.ownerDocument || context : preferredDoc) !== document) {
            setDocument(context);
          }

          context = context || document;

          if (documentIsHTML) {
            // If the selector is sufficiently simple, try using a "get*By*" DOM method
            // (excepting DocumentFragment context, where the methods don't exist)
            if (nodeType !== 11 && (match = rquickExpr.exec(selector))) {
              // ID selector
              if (m = match[1]) {
                // Document context
                if (nodeType === 9) {
                  if (elem = context.getElementById(m)) {
                    // Support: IE, Opera, Webkit
                    // TODO: identify versions
                    // getElementById can match elements by name instead of ID
                    if (elem.id === m) {
                      results.push(elem);
                      return results;
                    }
                  } else {
                    return results;
                  } // Element context

                } else {
                  // Support: IE, Opera, Webkit
                  // TODO: identify versions
                  // getElementById can match elements by name instead of ID
                  if (newContext && (elem = newContext.getElementById(m)) && contains(context, elem) && elem.id === m) {
                    results.push(elem);
                    return results;
                  }
                } // Type selector

              } else if (match[2]) {
                push.apply(results, context.getElementsByTagName(selector));
                return results; // Class selector
              } else if ((m = match[3]) && support.getElementsByClassName && context.getElementsByClassName) {
                push.apply(results, context.getElementsByClassName(m));
                return results;
              }
            } // Take advantage of querySelectorAll


            if (support.qsa && !nonnativeSelectorCache[selector + " "] && (!rbuggyQSA || !rbuggyQSA.test(selector))) {
              if (nodeType !== 1) {
                newContext = context;
                newSelector = selector; // qSA looks outside Element context, which is not what we want
                // Thanks to Andrew Dupont for this workaround technique
                // Support: IE <=8
                // Exclude object elements
              } else if (context.nodeName.toLowerCase() !== "object") {
                // Capture the context ID, setting it first if necessary
                if (nid = context.getAttribute("id")) {
                  nid = nid.replace(rcssescape, fcssescape);
                } else {
                  context.setAttribute("id", nid = expando);
                } // Prefix every selector in the list


                groups = tokenize(selector);
                i = groups.length;

                while (i--) {
                  groups[i] = "#" + nid + " " + toSelector(groups[i]);
                }

                newSelector = groups.join(","); // Expand context for sibling selectors

                newContext = rsibling.test(selector) && testContext(context.parentNode) || context;
              }

              if (newSelector) {
                try {
                  push.apply(results, newContext.querySelectorAll(newSelector));
                  return results;
                } catch (qsaError) {
                  // [AdGuard Path]: Fix the cache value
                  nonnativeSelectorCache(selector, true);
                } finally {
                  if (nid === expando) {
                    context.removeAttribute("id");
                  }
                }
              }
            }
          }
        } // All others


        return select(selector.replace(rtrim, "$1"), context, results, seed);
      }
      /**
       * Create key-value caches of limited size
       * @returns {function(string, object)} Returns the Object data after storing it on itself with
       *	property name the (space-suffixed) string and (if the cache is larger than Expr.cacheLength)
       *	deleting the oldest entry
       */


      function createCache() {
        var keys = [];

        function cache(key, value) {
          // Use (key + " ") to avoid collision with native prototype properties (see Issue #157)
          if (keys.push(key + " ") > Expr.cacheLength) {
            // Only keep the most recent entries
            delete cache[keys.shift()];
          }

          return cache[key + " "] = value;
        }

        return cache;
      }
      /**
       * Mark a function for special use by Sizzle
       * @param {Function} fn The function to mark
       */


      function markFunction(fn) {
        fn[expando] = true;
        return fn;
      }
      /**
       * Support testing using an element
       * @param {Function} fn Passed the created element and returns a boolean result
       */


      function assert(fn) {
        var el = document.createElement("fieldset");

        try {
          return !!fn(el);
        } catch (e) {
          return false;
        } finally {
          // Remove from its parent by default
          if (el.parentNode) {
            el.parentNode.removeChild(el);
          } // release memory in IE


          el = null;
        }
      }
      /**
       * Adds the same handler for all of the specified attrs
       * @param {String} attrs Pipe-separated list of attributes
       * @param {Function} handler The method that will be applied
       */


      function addHandle(attrs, handler) {
        var arr = attrs.split("|"),
            i = arr.length;

        while (i--) {
          Expr.attrHandle[arr[i]] = handler;
        }
      }
      /**
       * Checks document order of two siblings
       * @param {Element} a
       * @param {Element} b
       * @returns {Number} Returns less than 0 if a precedes b, greater than 0 if a follows b
       */


      function siblingCheck(a, b) {
        var cur = b && a,
            diff = cur && a.nodeType === 1 && b.nodeType === 1 && a.sourceIndex - b.sourceIndex; // Use IE sourceIndex if available on both nodes

        if (diff) {
          return diff;
        } // Check if b follows a


        if (cur) {
          while (cur = cur.nextSibling) {
            if (cur === b) {
              return -1;
            }
          }
        }

        return a ? 1 : -1;
      }
      /**
       * Returns a function to use in pseudos for :enabled/:disabled
       * @param {Boolean} disabled true for :disabled; false for :enabled
       */


      function createDisabledPseudo(disabled) {
        // Known :disabled false positives: fieldset[disabled] > legend:nth-of-type(n+2) :can-disable
        return function (elem) {
          // Only certain elements can match :enabled or :disabled
          // https://html.spec.whatwg.org/multipage/scripting.html#selector-enabled
          // https://html.spec.whatwg.org/multipage/scripting.html#selector-disabled
          if ("form" in elem) {
            // Check for inherited disabledness on relevant non-disabled elements:
            // * listed form-associated elements in a disabled fieldset
            //   https://html.spec.whatwg.org/multipage/forms.html#category-listed
            //   https://html.spec.whatwg.org/multipage/forms.html#concept-fe-disabled
            // * option elements in a disabled optgroup
            //   https://html.spec.whatwg.org/multipage/forms.html#concept-option-disabled
            // All such elements have a "form" property.
            if (elem.parentNode && elem.disabled === false) {
              // Option elements defer to a parent optgroup if present
              if ("label" in elem) {
                if ("label" in elem.parentNode) {
                  return elem.parentNode.disabled === disabled;
                } else {
                  return elem.disabled === disabled;
                }
              } // Support: IE 6 - 11
              // Use the isDisabled shortcut property to check for disabled fieldset ancestors


              return elem.isDisabled === disabled || // Where there is no isDisabled, check manually

              /* jshint -W018 */
              elem.isDisabled !== !disabled && inDisabledFieldset(elem) === disabled;
            }

            return elem.disabled === disabled; // Try to winnow out elements that can't be disabled before trusting the disabled property.
            // Some victims get caught in our net (label, legend, menu, track), but it shouldn't
            // even exist on them, let alone have a boolean value.
          } else if ("label" in elem) {
            return elem.disabled === disabled;
          } // Remaining elements are neither :enabled nor :disabled


          return false;
        };
      }
      /**
       * Checks a node for validity as a Sizzle context
       * @param {Element|Object=} context
       * @returns {Element|Object|Boolean} The input node if acceptable, otherwise a falsy value
       */


      function testContext(context) {
        return context && typeof context.getElementsByTagName !== "undefined" && context;
      } // Expose support vars for convenience


      support = Sizzle.support = {};
      /**
       * Detects XML nodes
       * @param {Element|Object} elem An element or a document
       * @returns {Boolean} True iff elem is a non-HTML XML node
       */

      isXML = Sizzle.isXML = function (elem) {
        // documentElement is verified for cases where it doesn't yet exist
        // (such as loading iframes in IE - #4833)
        var documentElement = elem && (elem.ownerDocument || elem).documentElement;
        return documentElement ? documentElement.nodeName !== "HTML" : false;
      };
      /**
       * Sets document-related variables once based on the current document
       * @param {Element|Object} [doc] An element or document object to use to set the document
       * @returns {Object} Returns the current document
       */


      setDocument = Sizzle.setDocument = function (node) {
        var hasCompare,
            subWindow,
            doc = node ? node.ownerDocument || node : preferredDoc; // Return early if doc is invalid or already selected

        if (doc === document || doc.nodeType !== 9 || !doc.documentElement) {
          return document;
        } // Update global variables


        document = doc;
        docElem = document.documentElement;
        documentIsHTML = !isXML(document); // Support: IE 9-11, Edge
        // Accessing iframe documents after unload throws "permission denied" errors (jQuery #13936)

        if (preferredDoc !== document && (subWindow = document.defaultView) && subWindow.top !== subWindow) {
          // Support: IE 11, Edge
          if (subWindow.addEventListener) {
            subWindow.addEventListener("unload", unloadHandler, false); // Support: IE 9 - 10 only
          } else if (subWindow.attachEvent) {
            subWindow.attachEvent("onunload", unloadHandler);
          }
        }
        /* Attributes
        ---------------------------------------------------------------------- */
        // Support: IE<8
        // Verify that getAttribute really returns attributes and not properties
        // (excepting IE8 booleans)


        support.attributes = assert(function (el) {
          el.className = "i";
          return !el.getAttribute("className");
        });
        /* getElement(s)By*
        ---------------------------------------------------------------------- */
        // Check if getElementsByTagName("*") returns only elements

        support.getElementsByTagName = assert(function (el) {
          el.appendChild(document.createComment(""));
          return !el.getElementsByTagName("*").length;
        }); // Support: IE<9

        support.getElementsByClassName = rnative.test(document.getElementsByClassName); // Support: IE<10
        // Check if getElementById returns elements by name
        // The broken getElementById methods don't pick up programmatically-set names,
        // so use a roundabout getElementsByName test

        support.getById = assert(function (el) {
          docElem.appendChild(el).id = expando;
          return !document.getElementsByName || !document.getElementsByName(expando).length;
        }); // ID filter and find

        if (support.getById) {
          Expr.filter["ID"] = function (id) {
            var attrId = id.replace(runescape, funescape);
            return function (elem) {
              return elem.getAttribute("id") === attrId;
            };
          };

          Expr.find["ID"] = function (id, context) {
            if (typeof context.getElementById !== "undefined" && documentIsHTML) {
              var elem = context.getElementById(id);
              return elem ? [elem] : [];
            }
          };
        } else {
          Expr.filter["ID"] = function (id) {
            var attrId = id.replace(runescape, funescape);
            return function (elem) {
              var node = typeof elem.getAttributeNode !== "undefined" && elem.getAttributeNode("id");
              return node && node.value === attrId;
            };
          }; // Support: IE 6 - 7 only
          // getElementById is not reliable as a find shortcut


          Expr.find["ID"] = function (id, context) {
            if (typeof context.getElementById !== "undefined" && documentIsHTML) {
              var node,
                  i,
                  elems,
                  elem = context.getElementById(id);

              if (elem) {
                // Verify the id attribute
                node = elem.getAttributeNode("id");

                if (node && node.value === id) {
                  return [elem];
                } // Fall back on getElementsByName


                elems = context.getElementsByName(id);
                i = 0;

                while (elem = elems[i++]) {
                  node = elem.getAttributeNode("id");

                  if (node && node.value === id) {
                    return [elem];
                  }
                }
              }

              return [];
            }
          };
        } // Tag


        Expr.find["TAG"] = support.getElementsByTagName ? function (tag, context) {
          if (typeof context.getElementsByTagName !== "undefined") {
            return context.getElementsByTagName(tag); // DocumentFragment nodes don't have gEBTN
          } else if (support.qsa) {
            return context.querySelectorAll(tag);
          }
        } : function (tag, context) {
          var elem,
              tmp = [],
              i = 0,
              // By happy coincidence, a (broken) gEBTN appears on DocumentFragment nodes too
          results = context.getElementsByTagName(tag); // Filter out possible comments

          if (tag === "*") {
            while (elem = results[i++]) {
              if (elem.nodeType === 1) {
                tmp.push(elem);
              }
            }

            return tmp;
          }

          return results;
        }; // Class

        Expr.find["CLASS"] = support.getElementsByClassName && function (className, context) {
          if (typeof context.getElementsByClassName !== "undefined" && documentIsHTML) {
            return context.getElementsByClassName(className);
          }
        };
        /* QSA/matchesSelector
        ---------------------------------------------------------------------- */
        // QSA and matchesSelector support
        // matchesSelector(:active) reports false when true (IE9/Opera 11.5)


        rbuggyMatches = []; // qSa(:focus) reports false when true (Chrome 21)
        // We allow this because of a bug in IE8/9 that throws an error
        // whenever `document.activeElement` is accessed on an iframe
        // So, we allow :focus to pass through QSA all the time to avoid the IE error
        // See https://bugs.jquery.com/ticket/13378

        rbuggyQSA = [];

        if (support.qsa = rnative.test(document.querySelectorAll)) {
          // Build QSA regex
          // Regex strategy adopted from Diego Perini
          assert(function (el) {
            // Select is set to empty string on purpose
            // This is to test IE's treatment of not explicitly
            // setting a boolean content attribute,
            // since its presence should be enough
            // https://bugs.jquery.com/ticket/12359
            docElem.appendChild(el).innerHTML = AGPolicy.createHTML("<a id='" + expando + "'></a>" + "<select id='" + expando + "-\r\\' msallowcapture=''>" + "<option selected=''></option></select>"); // Support: IE8, Opera 11-12.16
            // Nothing should be selected when empty strings follow ^= or $= or *=
            // The test attribute must be unknown in Opera but "safe" for WinRT
            // https://msdn.microsoft.com/en-us/library/ie/hh465388.aspx#attribute_section

            if (el.querySelectorAll("[msallowcapture^='']").length) {
              rbuggyQSA.push("[*^$]=" + whitespace + "*(?:''|\"\")");
            } // Support: IE8
            // Boolean attributes and "value" are not treated correctly


            if (!el.querySelectorAll("[selected]").length) {
              rbuggyQSA.push("\\[" + whitespace + "*(?:value|" + booleans + ")");
            } // Support: Chrome<29, Android<4.4, Safari<7.0+, iOS<7.0+, PhantomJS<1.9.8+


            if (!el.querySelectorAll("[id~=" + expando + "-]").length) {
              rbuggyQSA.push("~=");
            } // Webkit/Opera - :checked should return selected option elements
            // http://www.w3.org/TR/2011/REC-css3-selectors-20110929/#checked
            // IE8 throws error here and will not see later tests


            if (!el.querySelectorAll(":checked").length) {
              rbuggyQSA.push(":checked");
            } // Support: Safari 8+, iOS 8+
            // https://bugs.webkit.org/show_bug.cgi?id=136851
            // In-page `selector#id sibling-combinator selector` fails


            if (!el.querySelectorAll("a#" + expando + "+*").length) {
              rbuggyQSA.push(".#.+[+~]");
            }
          });
          assert(function (el) {
            el.innerHTML = AGPolicy.createHTML("<a href='' disabled='disabled'></a>" + "<select disabled='disabled'><option/></select>"); // Support: Windows 8 Native Apps
            // The type and name attributes are restricted during .innerHTML assignment

            var input = document.createElement("input");
            input.setAttribute("type", "hidden");
            el.appendChild(input).setAttribute("name", "D"); // Support: IE8
            // Enforce case-sensitivity of name attribute

            if (el.querySelectorAll("[name=d]").length) {
              rbuggyQSA.push("name" + whitespace + "*[*^$|!~]?=");
            } // FF 3.5 - :enabled/:disabled and hidden elements (hidden elements are still enabled)
            // IE8 throws error here and will not see later tests


            if (el.querySelectorAll(":enabled").length !== 2) {
              rbuggyQSA.push(":enabled", ":disabled");
            } // Support: IE9-11+
            // IE's :disabled selector does not pick up the children of disabled fieldsets


            docElem.appendChild(el).disabled = true;

            if (el.querySelectorAll(":disabled").length !== 2) {
              rbuggyQSA.push(":enabled", ":disabled");
            } // Opera 10-11 does not throw on post-comma invalid pseudos


            el.querySelectorAll("*,:x");
            rbuggyQSA.push(",.*:");
          });
        }

        if (support.matchesSelector = rnative.test(matches = docElem.matches || docElem.webkitMatchesSelector || docElem.mozMatchesSelector || docElem.oMatchesSelector || docElem.msMatchesSelector)) {
          assert(function (el) {
            // Check to see if it's possible to do matchesSelector
            // on a disconnected node (IE 9)
            support.disconnectedMatch = matches.call(el, "*"); // This should fail with an exception
            // Gecko does not error, returns false instead

            matches.call(el, "[s!='']:x");
            rbuggyMatches.push("!=", pseudos);
          });
        }

        rbuggyQSA = rbuggyQSA.length && new RegExp(rbuggyQSA.join("|"));
        rbuggyMatches = rbuggyMatches.length && new RegExp(rbuggyMatches.join("|"));
        /* Contains
        ---------------------------------------------------------------------- */

        hasCompare = rnative.test(docElem.compareDocumentPosition); // Element contains another
        // Purposefully self-exclusive
        // As in, an element does not contain itself

        contains = hasCompare || rnative.test(docElem.contains) ? function (a, b) {
          var adown = a.nodeType === 9 ? a.documentElement : a,
              bup = b && b.parentNode;
          return a === bup || !!(bup && bup.nodeType === 1 && (adown.contains ? adown.contains(bup) : a.compareDocumentPosition && a.compareDocumentPosition(bup) & 16));
        } : function (a, b) {
          if (b) {
            while (b = b.parentNode) {
              if (b === a) {
                return true;
              }
            }
          }

          return false;
        };
        /* Sorting
        ---------------------------------------------------------------------- */
        // Document order sorting

        sortOrder = hasCompare ? function (a, b) {
          // Flag for duplicate removal
          if (a === b) {
            hasDuplicate = true;
            return 0;
          } // Sort on method existence if only one input has compareDocumentPosition


          var compare = !a.compareDocumentPosition - !b.compareDocumentPosition;

          if (compare) {
            return compare;
          } // Calculate position if both inputs belong to the same document


          compare = (a.ownerDocument || a) === (b.ownerDocument || b) ? a.compareDocumentPosition(b) : // Otherwise we know they are disconnected
          1; // Disconnected nodes

          if (compare & 1 || !support.sortDetached && b.compareDocumentPosition(a) === compare) {
            // Choose the first element that is related to our preferred document
            if (a === document || a.ownerDocument === preferredDoc && contains(preferredDoc, a)) {
              return -1;
            }

            if (b === document || b.ownerDocument === preferredDoc && contains(preferredDoc, b)) {
              return 1;
            } // Maintain original order


            return sortInput ? indexOf(sortInput, a) - indexOf(sortInput, b) : 0;
          }

          return compare & 4 ? -1 : 1;
        } : function (a, b) {
          // Exit early if the nodes are identical
          if (a === b) {
            hasDuplicate = true;
            return 0;
          }

          var cur,
              i = 0,
              aup = a.parentNode,
              bup = b.parentNode,
              ap = [a],
              bp = [b]; // Parentless nodes are either documents or disconnected

          if (!aup || !bup) {
            return a === document ? -1 : b === document ? 1 : aup ? -1 : bup ? 1 : sortInput ? indexOf(sortInput, a) - indexOf(sortInput, b) : 0; // If the nodes are siblings, we can do a quick check
          } else if (aup === bup) {
            return siblingCheck(a, b);
          } // Otherwise we need full lists of their ancestors for comparison


          cur = a;

          while (cur = cur.parentNode) {
            ap.unshift(cur);
          }

          cur = b;

          while (cur = cur.parentNode) {
            bp.unshift(cur);
          } // Walk down the tree looking for a discrepancy


          while (ap[i] === bp[i]) {
            i++;
          }

          return i ? // Do a sibling check if the nodes have a common ancestor
          siblingCheck(ap[i], bp[i]) : // Otherwise nodes in our document sort first
          ap[i] === preferredDoc ? -1 : bp[i] === preferredDoc ? 1 : 0;
        };
        return document;
      };

      Sizzle.matches = function (expr, elements) {
        return Sizzle(expr, null, null, elements);
      };

      Sizzle.matchesSelector = function (elem, expr) {
        // Set document vars if needed
        if ((elem.ownerDocument || elem) !== document) {
          setDocument(elem);
        }

        if (support.matchesSelector && documentIsHTML && !nonnativeSelectorCache[expr + " "] && (!rbuggyMatches || !rbuggyMatches.test(expr)) && (!rbuggyQSA || !rbuggyQSA.test(expr))) {
          try {
            var ret = matches.call(elem, expr); // IE 9's matchesSelector returns false on disconnected nodes

            if (ret || support.disconnectedMatch || // As well, disconnected nodes are said to be in a document
            // fragment in IE 9
            elem.document && elem.document.nodeType !== 11) {
              return ret;
            }
          } catch (e) {
            // [AdGuard Path]: Fix the cache value
            nonnativeSelectorCache(expr, true);
          }
        }

        return Sizzle(expr, document, null, [elem]).length > 0;
      };

      Sizzle.contains = function (context, elem) {
        // Set document vars if needed
        if ((context.ownerDocument || context) !== document) {
          setDocument(context);
        }

        return contains(context, elem);
      };

      Sizzle.attr = function (elem, name) {
        // Set document vars if needed
        if ((elem.ownerDocument || elem) !== document) {
          setDocument(elem);
        }

        var fn = Expr.attrHandle[name.toLowerCase()],
            // Don't get fooled by Object.prototype properties (jQuery #13807)
        val = fn && hasOwn.call(Expr.attrHandle, name.toLowerCase()) ? fn(elem, name, !documentIsHTML) : undefined;
        return val !== undefined ? val : support.attributes || !documentIsHTML ? elem.getAttribute(name) : (val = elem.getAttributeNode(name)) && val.specified ? val.value : null;
      };

      Sizzle.escape = function (sel) {
        return (sel + "").replace(rcssescape, fcssescape);
      };

      Sizzle.error = function (msg) {
        throw new Error("Syntax error, unrecognized expression: " + msg);
      };
      /**
       * Document sorting and removing duplicates
       * @param {ArrayLike} results
       */


      Sizzle.uniqueSort = function (results) {
        var elem,
            duplicates = [],
            j = 0,
            i = 0; // Unless we *know* we can detect duplicates, assume their presence

        hasDuplicate = !support.detectDuplicates;
        sortInput = !support.sortStable && results.slice(0);
        results.sort(sortOrder);

        if (hasDuplicate) {
          while (elem = results[i++]) {
            if (elem === results[i]) {
              j = duplicates.push(i);
            }
          }

          while (j--) {
            results.splice(duplicates[j], 1);
          }
        } // Clear input after sorting to release objects
        // See https://github.com/jquery/sizzle/pull/225


        sortInput = null;
        return results;
      };
      /**
       * Utility function for retrieving the text value of an array of DOM nodes
       * @param {Array|Element} elem
       */


      getText = Sizzle.getText = function (elem) {
        var node,
            ret = "",
            i = 0,
            nodeType = elem.nodeType;

        if (!nodeType) {
          // If no nodeType, this is expected to be an array
          while (node = elem[i++]) {
            // Do not traverse comment nodes
            ret += getText(node);
          }
        } else if (nodeType === 1 || nodeType === 9 || nodeType === 11) {
          // Use textContent for elements
          // innerText usage removed for consistency of new lines (jQuery #11153)
          if (typeof elem.textContent === "string") {
            return elem.textContent;
          } else {
            // Traverse its children
            for (elem = elem.firstChild; elem; elem = elem.nextSibling) {
              ret += getText(elem);
            }
          }
        } else if (nodeType === 3 || nodeType === 4) {
          return elem.nodeValue;
        } // Do not include comment or processing instruction nodes


        return ret;
      };

      Expr = Sizzle.selectors = {
        // Can be adjusted by the user
        cacheLength: 50,
        createPseudo: markFunction,
        match: matchExpr,
        attrHandle: {},
        find: {},
        relative: {
          ">": {
            dir: "parentNode",
            first: true
          },
          " ": {
            dir: "parentNode"
          },
          "+": {
            dir: "previousSibling",
            first: true
          },
          "~": {
            dir: "previousSibling"
          }
        },
        preFilter: {
          "ATTR": function ATTR(match) {
            match[1] = match[1].replace(runescape, funescape); // Move the given value to match[3] whether quoted or unquoted

            match[3] = (match[3] || match[4] || match[5] || "").replace(runescape, funescape);

            if (match[2] === "~=") {
              match[3] = " " + match[3] + " ";
            }

            return match.slice(0, 4);
          },
          "CHILD": function CHILD(match) {
            /* matches from matchExpr["CHILD"]
            	1 type (only|nth|...)
            	2 what (child|of-type)
            	3 argument (even|odd|\d*|\d*n([+-]\d+)?|...)
            	4 xn-component of xn+y argument ([+-]?\d*n|)
            	5 sign of xn-component
            	6 x of xn-component
            	7 sign of y-component
            	8 y of y-component
            */
            match[1] = match[1].toLowerCase();

            if (match[1].slice(0, 3) === "nth") {
              // nth-* requires argument
              if (!match[3]) {
                Sizzle.error(match[0]);
              } // numeric x and y parameters for Expr.filter.CHILD
              // remember that false/true cast respectively to 0/1


              match[4] = +(match[4] ? match[5] + (match[6] || 1) : 2 * (match[3] === "even" || match[3] === "odd"));
              match[5] = +(match[7] + match[8] || match[3] === "odd"); // other types prohibit arguments
            } else if (match[3]) {
              Sizzle.error(match[0]);
            }

            return match;
          },
          "PSEUDO": function PSEUDO(match) {
            var excess,
                unquoted = !match[6] && match[2];

            if (matchExpr["CHILD"].test(match[0])) {
              return null;
            } // Accept quoted arguments as-is


            if (match[3]) {
              match[2] = match[4] || match[5] || ""; // Strip excess characters from unquoted arguments
            } else if (unquoted && rpseudo.test(unquoted) && ( // Get excess from tokenize (recursively)
            excess = tokenize(unquoted, true)) && ( // advance to the next closing parenthesis
            excess = unquoted.indexOf(")", unquoted.length - excess) - unquoted.length)) {
              // excess is a negative index
              match[0] = match[0].slice(0, excess);
              match[2] = unquoted.slice(0, excess);
            } // Return only captures needed by the pseudo filter method (type and argument)


            return match.slice(0, 3);
          }
        },
        filter: {
          "TAG": function TAG(nodeNameSelector) {
            var nodeName = nodeNameSelector.replace(runescape, funescape).toLowerCase();
            return nodeNameSelector === "*" ? function () {
              return true;
            } : function (elem) {
              return elem.nodeName && elem.nodeName.toLowerCase() === nodeName;
            };
          },
          "CLASS": function CLASS(className) {
            var pattern = classCache[className + " "];
            return pattern || (pattern = new RegExp("(^|" + whitespace + ")" + className + "(" + whitespace + "|$)")) && classCache(className, function (elem) {
              return pattern.test(typeof elem.className === "string" && elem.className || typeof elem.getAttribute !== "undefined" && elem.getAttribute("class") || "");
            });
          },
          "ATTR": function ATTR(name, operator, check) {
            return function (elem) {
              var result = Sizzle.attr(elem, name);

              if (result == null) {
                return operator === "!=";
              }

              if (!operator) {
                return true;
              }

              result += "";
              return operator === "=" ? result === check : operator === "!=" ? result !== check : operator === "^=" ? check && result.indexOf(check) === 0 : operator === "*=" ? check && result.indexOf(check) > -1 : operator === "$=" ? check && result.slice(-check.length) === check : operator === "~=" ? (" " + result.replace(rwhitespace, " ") + " ").indexOf(check) > -1 : operator === "|=" ? result === check || result.slice(0, check.length + 1) === check + "-" : false;
            };
          },
          "CHILD": function CHILD(type, what, argument, first, last) {
            var simple = type.slice(0, 3) !== "nth",
                forward = type.slice(-4) !== "last",
                ofType = what === "of-type";
            return first === 1 && last === 0 ? // Shortcut for :nth-*(n)
            function (elem) {
              return !!elem.parentNode;
            } : function (elem, context, xml) {
              var cache,
                  uniqueCache,
                  outerCache,
                  node,
                  nodeIndex,
                  start,
                  dir = simple !== forward ? "nextSibling" : "previousSibling",
                  parent = elem.parentNode,
                  name = ofType && elem.nodeName.toLowerCase(),
                  useCache = !xml && !ofType,
                  diff = false;

              if (parent) {
                // :(first|last|only)-(child|of-type)
                if (simple) {
                  while (dir) {
                    node = elem;

                    while (node = node[dir]) {
                      if (ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1) {
                        return false;
                      }
                    } // Reverse direction for :only-* (if we haven't yet done so)


                    start = dir = type === "only" && !start && "nextSibling";
                  }

                  return true;
                }

                start = [forward ? parent.firstChild : parent.lastChild]; // non-xml :nth-child(...) stores cache data on `parent`

                if (forward && useCache) {
                  // Seek `elem` from a previously-cached index
                  // ...in a gzip-friendly way
                  node = parent;
                  outerCache = node[expando] || (node[expando] = {}); // Support: IE <9 only
                  // Defend against cloned attroperties (jQuery gh-1709)

                  uniqueCache = outerCache[node.uniqueID] || (outerCache[node.uniqueID] = {});
                  cache = uniqueCache[type] || [];
                  nodeIndex = cache[0] === dirruns && cache[1];
                  diff = nodeIndex && cache[2];
                  node = nodeIndex && parent.childNodes[nodeIndex];

                  while (node = ++nodeIndex && node && node[dir] || ( // Fallback to seeking `elem` from the start
                  diff = nodeIndex = 0) || start.pop()) {
                    // When found, cache indexes on `parent` and break
                    if (node.nodeType === 1 && ++diff && node === elem) {
                      uniqueCache[type] = [dirruns, nodeIndex, diff];
                      break;
                    }
                  }
                } else {
                  // Use previously-cached element index if available
                  if (useCache) {
                    // ...in a gzip-friendly way
                    node = elem;
                    outerCache = node[expando] || (node[expando] = {}); // Support: IE <9 only
                    // Defend against cloned attroperties (jQuery gh-1709)

                    uniqueCache = outerCache[node.uniqueID] || (outerCache[node.uniqueID] = {});
                    cache = uniqueCache[type] || [];
                    nodeIndex = cache[0] === dirruns && cache[1];
                    diff = nodeIndex;
                  } // xml :nth-child(...)
                  // or :nth-last-child(...) or :nth(-last)?-of-type(...)


                  if (diff === false) {
                    // Use the same loop as above to seek `elem` from the start
                    while (node = ++nodeIndex && node && node[dir] || (diff = nodeIndex = 0) || start.pop()) {
                      if ((ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1) && ++diff) {
                        // Cache the index of each encountered element
                        if (useCache) {
                          outerCache = node[expando] || (node[expando] = {}); // Support: IE <9 only
                          // Defend against cloned attroperties (jQuery gh-1709)

                          uniqueCache = outerCache[node.uniqueID] || (outerCache[node.uniqueID] = {});
                          uniqueCache[type] = [dirruns, diff];
                        }

                        if (node === elem) {
                          break;
                        }
                      }
                    }
                  }
                } // Incorporate the offset, then check against cycle size


                diff -= last;
                return diff === first || diff % first === 0 && diff / first >= 0;
              }
            };
          },
          "PSEUDO": function PSEUDO(pseudo, argument) {
            // pseudo-class names are case-insensitive
            // http://www.w3.org/TR/selectors/#pseudo-classes
            // Prioritize by case sensitivity in case custom pseudos are added with uppercase letters
            // Remember that setFilters inherits from pseudos
            var args,
                fn = Expr.pseudos[pseudo] || Expr.setFilters[pseudo.toLowerCase()] || Sizzle.error("unsupported pseudo: " + pseudo); // The user may use createPseudo to indicate that
            // arguments are needed to create the filter function
            // just as Sizzle does

            if (fn[expando]) {
              return fn(argument);
            } // But maintain support for old signatures


            if (fn.length > 1) {
              args = [pseudo, pseudo, "", argument];
              return Expr.setFilters.hasOwnProperty(pseudo.toLowerCase()) ? markFunction(function (seed, matches) {
                var idx,
                    matched = fn(seed, argument),
                    i = matched.length;

                while (i--) {
                  idx = indexOf(seed, matched[i]);
                  seed[idx] = !(matches[idx] = matched[i]);
                }
              }) : function (elem) {
                return fn(elem, 0, args);
              };
            }

            return fn;
          }
        },
        pseudos: {
          // Potentially complex pseudos
          "not": markFunction(function (selector) {
            // Trim the selector passed to compile
            // to avoid treating leading and trailing
            // spaces as combinators
            var input = [],
                results = [],
                matcher = compile(selector.replace(rtrim, "$1"));
            return matcher[expando] ? markFunction(function (seed, matches, context, xml) {
              var elem,
                  unmatched = matcher(seed, null, xml, []),
                  i = seed.length; // Match elements unmatched by `matcher`

              while (i--) {
                if (elem = unmatched[i]) {
                  seed[i] = !(matches[i] = elem);
                }
              }
            }) : function (elem, context, xml) {
              input[0] = elem;
              matcher(input, null, xml, results); // Don't keep the element (issue #299)

              input[0] = null;
              return !results.pop();
            };
          }),
          "has": markFunction(function (selector) {
            if (typeof selector === "string") {
              Sizzle.compile(selector);
            }

            return function (elem) {
              return Sizzle(selector, elem).length > 0;
            };
          }),
          // Removed :contains pseudo-class declaration
          // "Whether an element is represented by a :lang() selector
          // is based solely on the element's language value
          // being equal to the identifier C,
          // or beginning with the identifier C immediately followed by "-".
          // The matching of C against the element's language value is performed case-insensitively.
          // The identifier C does not have to be a valid language name."
          // http://www.w3.org/TR/selectors/#lang-pseudo
          "lang": markFunction(function (lang) {
            // lang value must be a valid identifier
            if (!ridentifier.test(lang || "")) {
              Sizzle.error("unsupported lang: " + lang);
            }

            lang = lang.replace(runescape, funescape).toLowerCase();
            return function (elem) {
              var elemLang;

              do {
                if (elemLang = documentIsHTML ? elem.lang : elem.getAttribute("xml:lang") || elem.getAttribute("lang")) {
                  elemLang = elemLang.toLowerCase();
                  return elemLang === lang || elemLang.indexOf(lang + "-") === 0;
                }
              } while ((elem = elem.parentNode) && elem.nodeType === 1);

              return false;
            };
          }),
          // Miscellaneous
          "target": function target(elem) {
            var hash = window.location && window.location.hash;
            return hash && hash.slice(1) === elem.id;
          },
          "root": function root(elem) {
            return elem === docElem;
          },
          "focus": function focus(elem) {
            return elem === document.activeElement && (!document.hasFocus || document.hasFocus()) && !!(elem.type || elem.href || ~elem.tabIndex);
          },
          // Boolean properties
          "enabled": createDisabledPseudo(false),
          "disabled": createDisabledPseudo(true),
          "checked": function checked(elem) {
            // In CSS3, :checked should return both checked and selected elements
            // http://www.w3.org/TR/2011/REC-css3-selectors-20110929/#checked
            var nodeName = elem.nodeName.toLowerCase();
            return nodeName === "input" && !!elem.checked || nodeName === "option" && !!elem.selected;
          },
          "selected": function selected(elem) {
            // Accessing this property makes selected-by-default
            // options in Safari work properly
            if (elem.parentNode) {
              elem.parentNode.selectedIndex;
            }

            return elem.selected === true;
          },
          // Contents
          "empty": function empty(elem) {
            // http://www.w3.org/TR/selectors/#empty-pseudo
            // :empty is negated by element (1) or content nodes (text: 3; cdata: 4; entity ref: 5),
            //   but not by others (comment: 8; processing instruction: 7; etc.)
            // nodeType < 6 works because attributes (2) do not appear as children
            for (elem = elem.firstChild; elem; elem = elem.nextSibling) {
              if (elem.nodeType < 6) {
                return false;
              }
            }

            return true;
          } // Removed custom pseudo-classes

        }
      }; // Removed custom pseudo-classes
      // Easy API for creating new setFilters

      function setFilters() {}

      setFilters.prototype = Expr.filters = Expr.pseudos;
      Expr.setFilters = new setFilters();
      /**
       * [AdGuard Patch]:
       * Sorts the tokens in order to mitigate the performance issues caused by matching slow pseudos first:
       * https://github.com/AdguardTeam/ExtendedCss/issues/55#issuecomment-364058745
       */

      var sortTokenGroups = function () {
        /**
         * Splits compound selector into a list of simple selectors
         *
         * @param {*} tokens Tokens to split into groups
         * @returns an array consisting of token groups (arrays) and relation tokens.
         */
        var splitCompoundSelector = function splitCompoundSelector(tokens) {
          var groups = [];
          var currentTokensGroup = [];
          var maxIdx = tokens.length - 1;

          for (var i = 0; i <= maxIdx; i++) {
            var token = tokens[i];
            var relative = Sizzle.selectors.relative[token.type];

            if (relative) {
              groups.push(currentTokensGroup);
              groups.push(token);
              currentTokensGroup = [];
            } else {
              currentTokensGroup.push(token);
            }

            if (i === maxIdx) {
              groups.push(currentTokensGroup);
            }
          }

          return groups;
        };

        var TOKEN_TYPES_VALUES = {
          // nth-child, etc, always go last
          "CHILD": 100,
          "ID": 90,
          "CLASS": 80,
          "TAG": 70,
          "ATTR": 70,
          "PSEUDO": 60
        };
        var POSITIONAL_PSEUDOS = ["nth", "first", "last", "eq", "even", "odd", "lt", "gt", "not"];
        /**
         * A function that defines the sort order.
         * Returns a value lesser than 0 if "left" is less than "right".
         */

        var compareFunction = function compareFunction(left, right) {
          var leftValue = TOKEN_TYPES_VALUES[left.type];
          var rightValue = TOKEN_TYPES_VALUES[right.type];
          return leftValue - rightValue;
        };
        /**
         * Checks if the specified tokens group is sortable.
         * We do not re-sort tokens in case of any positional or child pseudos in the group
         */


        var isSortable = function isSortable(tokens) {
          var iTokens = tokens.length;

          while (iTokens--) {
            var token = tokens[iTokens];

            if (token.type === "PSEUDO" && POSITIONAL_PSEUDOS.indexOf(token.matches[0]) !== -1) {
              return false;
            }

            if (token.type === "CHILD") {
              return false;
            }
          }

          return true;
        };
        /**
         * Sorts the tokens in order to mitigate the issues caused by the left-to-right matching.
         * The idea is change the tokens order so that Sizzle was matching fast selectors first (id, class),
         * and slow selectors after that (and here I mean our slow custom pseudo classes).
         *
         * @param {Array} tokens An array of tokens to sort
         * @returns {Array} A new re-sorted array
         */


        var sortTokens = function sortTokens(tokens) {
          if (!tokens || tokens.length === 1) {
            return tokens;
          }

          var sortedTokens = [];
          var groups = splitCompoundSelector(tokens);

          for (var i = 0; i < groups.length; i++) {
            var group = groups[i];

            if (group instanceof Array) {
              if (isSortable(group)) {
                group.sort(compareFunction);
              }

              sortedTokens = sortedTokens.concat(group);
            } else {
              sortedTokens.push(group);
            }
          }

          return sortedTokens;
        };
        /**
         * Sorts every tokens array inside of the specified "groups" array.
         * See "sortTokens" methods for more information on how tokens are sorted.
         *
         * @param {Array} groups An array of tokens arrays.
         * @returns {Array} A new array that consists of the same tokens arrays after sorting
         */


        var sortTokenGroups = function sortTokenGroups(groups) {
          var sortedGroups = [];
          var len = groups.length;
          var i = 0;

          for (; i < len; i++) {
            sortedGroups.push(sortTokens(groups[i]));
          }

          return sortedGroups;
        }; // Expose


        return sortTokenGroups;
      }();
      /**
       * Creates custom policy to use TrustedTypes CSP policy
       * https://w3c.github.io/webappsec-trusted-types/dist/spec/
       */


      var AGPolicy = function createPolicy() {
        var defaultPolicy = {
          createHTML: function createHTML(input) {
            return input;
          },
          createScript: function createScript(input) {
            return input;
          },
          createScriptURL: function createScriptURL(input) {
            return input;
          }
        };

        if (window.trustedTypes && window.trustedTypes.createPolicy) {
          return window.trustedTypes.createPolicy("AGPolicy", defaultPolicy);
        }

        return defaultPolicy;
      }();
      /**
       * [AdGuard Patch]:
       * Removes trailing spaces from the tokens list
       *
       * @param {*} tokens An array of Sizzle tokens to post-process
       */


      function removeTrailingSpaces(tokens) {
        var iTokens = tokens.length;

        while (iTokens--) {
          var token = tokens[iTokens];

          if (token.type === " ") {
            tokens.length = iTokens;
          } else {
            break;
          }
        }
      }
      /**
       * [AdGuard Patch]:
       * An object with the information about selectors and their token representation
       * @typedef {{selectorText: string, groups: Array}} SelectorData
       * @property {string} selectorText A CSS selector text
       * @property {Array} groups An array of token groups corresponding to that selector
       */

      /**
       * [AdGuard Patch]:
       * This method processes parsed token groups, divides them into a number of selectors
       * and makes sure that each selector's tokens are cached properly in Sizzle.
       *
       * @param {*} groups Token groups (see {@link Sizzle.tokenize})
       * @returns {Array.<SelectorData>} An array of selectors data we got from the groups
       */


      function tokenGroupsToSelectors(groups) {
        // Remove trailing spaces which we can encounter in tolerant mode
        // We're doing it in tolerant mode only as this is the only case when
        // encountering trailing spaces is expected
        removeTrailingSpaces(groups[groups.length - 1]); // We need sorted tokens to make cache work properly

        var sortedGroups = sortTokenGroups(groups);
        var selectors = [];

        for (var i = 0; i < groups.length; i++) {
          var tokenGroups = groups[i];
          var selectorText = toSelector(tokenGroups);
          selectors.push({
            // Sizzle expects an array of token groups when compiling a selector
            groups: [tokenGroups],
            selectorText: selectorText
          }); // Now make sure that selector tokens are cached

          var tokensCacheItem = {
            groups: tokenGroups,
            sortedGroups: [sortedGroups[i]]
          };
          tokenCache(selectorText, tokensCacheItem);
        }

        return selectors;
      }
      /**
       * [AdGuard Patch]:
       * Add an additional argument for Sizzle.tokenize which indicates that it
       * should not throw on invalid tokens, and instead should return tokens
       * that it has produced so far.
       *
       * One more additional argument that allow to choose if you want to receive sorted or unsorted tokens
       * The problem is that the re-sorted selectors are valid for Sizzle, but not for the browser.
       * options.returnUnsorted -- return unsorted tokens if true.
       * options.cacheOnly -- return cached result only. Required for unit-tests.
       *
       * @param {*} options Optional configuration object with two additional flags
       * (options.tolerant, options.returnUnsorted, options.cacheOnly) -- see patches #5 and #6 notes
       */


      tokenize = Sizzle.tokenize = function (selector, parseOnly, options) {
        var matched,
            match,
            tokens,
            type,
            soFar,
            groups,
            preFilters,
            cached = tokenCache[selector + " "];
        var tolerant = options && options.tolerant;
        var returnUnsorted = options && options.returnUnsorted;
        var cacheOnly = options && options.cacheOnly;

        if (cached) {
          if (parseOnly) {
            return 0;
          } else {
            return (returnUnsorted ? cached.groups : cached.sortedGroups).slice(0);
          }
        }

        if (cacheOnly) {
          return null;
        }

        soFar = selector;
        groups = [];
        preFilters = Expr.preFilter;

        while (soFar) {
          // Comma and first run
          if (!matched || (match = rcomma.exec(soFar))) {
            if (match) {
              // Don't consume trailing commas as valid
              soFar = soFar.slice(match[0].length) || soFar;
            }

            groups.push(tokens = []);
          }

          matched = false; // Combinators

          if (match = rcombinators.exec(soFar)) {
            matched = match.shift();
            tokens.push({
              value: matched,
              // Cast descendant combinators to space
              type: match[0].replace(rtrim, " ")
            });
            soFar = soFar.slice(matched.length);
          } // Filters


          for (type in Expr.filter) {
            if ((match = matchExpr[type].exec(soFar)) && (!preFilters[type] || (match = preFilters[type](match)))) {
              matched = match.shift();
              tokens.push({
                value: matched,
                type: type,
                matches: match
              });
              soFar = soFar.slice(matched.length);
            }
          }

          if (!matched) {
            break;
          }
        } // Return the length of the invalid excess
        // if we're just parsing
        // Otherwise, throw an error or return tokens


        var invalidLen = soFar.length;

        if (parseOnly) {
          return invalidLen;
        }

        if (invalidLen !== 0 && !tolerant) {
          Sizzle.error(selector); // Throws an error.
        }

        if (tolerant) {
          /**
           * [AdGuard Patch]:
           * In tolerant mode we return a special object that constists of
           * an array of parsed selectors (and their tokens) and a "nextIndex" field
           * that points to an index after which we're not able to parse selectors farther.
           */
          var nextIndex = selector.length - invalidLen;
          var selectors = tokenGroupsToSelectors(groups);
          return {
            selectors: selectors,
            nextIndex: nextIndex
          };
        }
        /** [AdGuard Patch]: Sorting tokens */


        var sortedGroups = sortTokenGroups(groups);
        /** [AdGuard Patch]: Change the way tokens are cached */

        var tokensCacheItem = {
          groups: groups,
          sortedGroups: sortedGroups
        };
        tokensCacheItem = tokenCache(selector, tokensCacheItem);
        return (returnUnsorted ? tokensCacheItem.groups : tokensCacheItem.sortedGroups).slice(0);
      };

      function toSelector(tokens) {
        var i = 0,
            len = tokens.length,
            selector = "";

        for (; i < len; i++) {
          selector += tokens[i].value;
        }

        return selector;
      }

      function addCombinator(matcher, combinator, base) {
        var dir = combinator.dir,
            skip = combinator.next,
            key = skip || dir,
            checkNonElements = base && key === "parentNode",
            doneName = done++;
        return combinator.first ? // Check against closest ancestor/preceding element
        function (elem, context, xml) {
          while (elem = elem[dir]) {
            if (elem.nodeType === 1 || checkNonElements) {
              return matcher(elem, context, xml);
            }
          }

          return false;
        } : // Check against all ancestor/preceding elements
        function (elem, context, xml) {
          var oldCache,
              uniqueCache,
              outerCache,
              newCache = [dirruns, doneName]; // We can't set arbitrary data on XML nodes, so they don't benefit from combinator caching

          if (xml) {
            while (elem = elem[dir]) {
              if (elem.nodeType === 1 || checkNonElements) {
                if (matcher(elem, context, xml)) {
                  return true;
                }
              }
            }
          } else {
            while (elem = elem[dir]) {
              if (elem.nodeType === 1 || checkNonElements) {
                outerCache = elem[expando] || (elem[expando] = {}); // Support: IE <9 only
                // Defend against cloned attroperties (jQuery gh-1709)

                uniqueCache = outerCache[elem.uniqueID] || (outerCache[elem.uniqueID] = {});

                if (skip && skip === elem.nodeName.toLowerCase()) {
                  elem = elem[dir] || elem;
                } else if ((oldCache = uniqueCache[key]) && oldCache[0] === dirruns && oldCache[1] === doneName) {
                  // Assign to newCache so results back-propagate to previous elements
                  return newCache[2] = oldCache[2];
                } else {
                  // Reuse newcache so results back-propagate to previous elements
                  uniqueCache[key] = newCache; // A match means we're done; a fail means we have to keep checking

                  if (newCache[2] = matcher(elem, context, xml)) {
                    return true;
                  }
                }
              }
            }
          }

          return false;
        };
      }

      function elementMatcher(matchers) {
        return matchers.length > 1 ? function (elem, context, xml) {
          var i = matchers.length;

          while (i--) {
            if (!matchers[i](elem, context, xml)) {
              return false;
            }
          }

          return true;
        } : matchers[0];
      }

      function multipleContexts(selector, contexts, results) {
        var i = 0,
            len = contexts.length;

        for (; i < len; i++) {
          Sizzle(selector, contexts[i], results);
        }

        return results;
      }

      function condense(unmatched, map, filter, context, xml) {
        var elem,
            newUnmatched = [],
            i = 0,
            len = unmatched.length,
            mapped = map != null;

        for (; i < len; i++) {
          if (elem = unmatched[i]) {
            if (!filter || filter(elem, context, xml)) {
              newUnmatched.push(elem);

              if (mapped) {
                map.push(i);
              }
            }
          }
        }

        return newUnmatched;
      }

      function setMatcher(preFilter, selector, matcher, postFilter, postFinder, postSelector) {
        if (postFilter && !postFilter[expando]) {
          postFilter = setMatcher(postFilter);
        }

        if (postFinder && !postFinder[expando]) {
          postFinder = setMatcher(postFinder, postSelector);
        }

        return markFunction(function (seed, results, context, xml) {
          var temp,
              i,
              elem,
              preMap = [],
              postMap = [],
              preexisting = results.length,
              // Get initial elements from seed or context
          elems = seed || multipleContexts(selector || "*", context.nodeType ? [context] : context, []),
              // Prefilter to get matcher input, preserving a map for seed-results synchronization
          matcherIn = preFilter && (seed || !selector) ? condense(elems, preMap, preFilter, context, xml) : elems,
              matcherOut = matcher ? // If we have a postFinder, or filtered seed, or non-seed postFilter or preexisting results,
          postFinder || (seed ? preFilter : preexisting || postFilter) ? // ...intermediate processing is necessary
          [] : // ...otherwise use results directly
          results : matcherIn; // Find primary matches

          if (matcher) {
            matcher(matcherIn, matcherOut, context, xml);
          } // Apply postFilter


          if (postFilter) {
            temp = condense(matcherOut, postMap);
            postFilter(temp, [], context, xml); // Un-match failing elements by moving them back to matcherIn

            i = temp.length;

            while (i--) {
              if (elem = temp[i]) {
                matcherOut[postMap[i]] = !(matcherIn[postMap[i]] = elem);
              }
            }
          }

          if (seed) {
            if (postFinder || preFilter) {
              if (postFinder) {
                // Get the final matcherOut by condensing this intermediate into postFinder contexts
                temp = [];
                i = matcherOut.length;

                while (i--) {
                  if (elem = matcherOut[i]) {
                    // Restore matcherIn since elem is not yet a final match
                    temp.push(matcherIn[i] = elem);
                  }
                }

                postFinder(null, matcherOut = [], temp, xml);
              } // Move matched elements from seed to results to keep them synchronized


              i = matcherOut.length;

              while (i--) {
                if ((elem = matcherOut[i]) && (temp = postFinder ? indexOf(seed, elem) : preMap[i]) > -1) {
                  seed[temp] = !(results[temp] = elem);
                }
              }
            } // Add elements to results, through postFinder if defined

          } else {
            matcherOut = condense(matcherOut === results ? matcherOut.splice(preexisting, matcherOut.length) : matcherOut);

            if (postFinder) {
              postFinder(null, results, matcherOut, xml);
            } else {
              push.apply(results, matcherOut);
            }
          }
        });
      }

      function matcherFromTokens(tokens) {
        var checkContext,
            matcher,
            j,
            len = tokens.length,
            leadingRelative = Expr.relative[tokens[0].type],
            implicitRelative = leadingRelative || Expr.relative[" "],
            i = leadingRelative ? 1 : 0,
            // The foundational matcher ensures that elements are reachable from top-level context(s)
        matchContext = addCombinator(function (elem) {
          return elem === checkContext;
        }, implicitRelative, true),
            matchAnyContext = addCombinator(function (elem) {
          return indexOf(checkContext, elem) > -1;
        }, implicitRelative, true),
            matchers = [function (elem, context, xml) {
          var ret = !leadingRelative && (xml || context !== outermostContext) || ((checkContext = context).nodeType ? matchContext(elem, context, xml) : matchAnyContext(elem, context, xml)); // Avoid hanging onto element (issue #299)

          checkContext = null;
          return ret;
        }];

        for (; i < len; i++) {
          if (matcher = Expr.relative[tokens[i].type]) {
            matchers = [addCombinator(elementMatcher(matchers), matcher)];
          } else {
            matcher = Expr.filter[tokens[i].type].apply(null, tokens[i].matches); // Return special upon seeing a positional matcher

            if (matcher[expando]) {
              // Find the next relative operator (if any) for proper handling
              j = ++i;

              for (; j < len; j++) {
                if (Expr.relative[tokens[j].type]) {
                  break;
                }
              }

              return setMatcher(i > 1 && elementMatcher(matchers), i > 1 && toSelector( // If the preceding token was a descendant combinator, insert an implicit any-element `*`
              tokens.slice(0, i - 1).concat({
                value: tokens[i - 2].type === " " ? "*" : ""
              })).replace(rtrim, "$1"), matcher, i < j && matcherFromTokens(tokens.slice(i, j)), j < len && matcherFromTokens(tokens = tokens.slice(j)), j < len && toSelector(tokens));
            }

            matchers.push(matcher);
          }
        }

        return elementMatcher(matchers);
      }

      function matcherFromGroupMatchers(elementMatchers, setMatchers) {
        var bySet = setMatchers.length > 0,
            byElement = elementMatchers.length > 0,
            superMatcher = function superMatcher(seed, context, xml, results, outermost) {
          var elem,
              j,
              matcher,
              matchedCount = 0,
              i = "0",
              unmatched = seed && [],
              setMatched = [],
              contextBackup = outermostContext,
              // We must always have either seed elements or outermost context
          elems = seed || byElement && Expr.find["TAG"]("*", outermost),
              // Use integer dirruns iff this is the outermost matcher
          dirrunsUnique = dirruns += contextBackup == null ? 1 : Math.random() || 0.1,
              len = elems.length;

          if (outermost) {
            outermostContext = context === document || context || outermost;
          } // Add elements passing elementMatchers directly to results
          // Support: IE<9, Safari
          // Tolerate NodeList properties (IE: "length"; Safari: <number>) matching elements by id


          for (; i !== len && (elem = elems[i]) != null; i++) {
            if (byElement && elem) {
              j = 0;

              if (!context && elem.ownerDocument !== document) {
                setDocument(elem);
                xml = !documentIsHTML;
              }

              while (matcher = elementMatchers[j++]) {
                if (matcher(elem, context || document, xml)) {
                  results.push(elem);
                  break;
                }
              }

              if (outermost) {
                dirruns = dirrunsUnique;
              }
            } // Track unmatched elements for set filters


            if (bySet) {
              // They will have gone through all possible matchers
              if (elem = !matcher && elem) {
                matchedCount--;
              } // Lengthen the array for every element, matched or not


              if (seed) {
                unmatched.push(elem);
              }
            }
          } // `i` is now the count of elements visited above, and adding it to `matchedCount`
          // makes the latter nonnegative.


          matchedCount += i; // Apply set filters to unmatched elements
          // NOTE: This can be skipped if there are no unmatched elements (i.e., `matchedCount`
          // equals `i`), unless we didn't visit _any_ elements in the above loop because we have
          // no element matchers and no seed.
          // Incrementing an initially-string "0" `i` allows `i` to remain a string only in that
          // case, which will result in a "00" `matchedCount` that differs from `i` but is also
          // numerically zero.

          if (bySet && i !== matchedCount) {
            j = 0;

            while (matcher = setMatchers[j++]) {
              matcher(unmatched, setMatched, context, xml);
            }

            if (seed) {
              // Reintegrate element matches to eliminate the need for sorting
              if (matchedCount > 0) {
                while (i--) {
                  if (!(unmatched[i] || setMatched[i])) {
                    setMatched[i] = pop.call(results);
                  }
                }
              } // Discard index placeholder values to get only actual matches


              setMatched = condense(setMatched);
            } // Add matches to results


            push.apply(results, setMatched); // Seedless set matches succeeding multiple successful matchers stipulate sorting

            if (outermost && !seed && setMatched.length > 0 && matchedCount + setMatchers.length > 1) {
              Sizzle.uniqueSort(results);
            }
          } // Override manipulation of globals by nested matchers


          if (outermost) {
            dirruns = dirrunsUnique;
            outermostContext = contextBackup;
          }

          return unmatched;
        };

        return bySet ? markFunction(superMatcher) : superMatcher;
      }

      compile = Sizzle.compile = function (selector, match
      /* Internal Use Only */
      ) {
        var i,
            setMatchers = [],
            elementMatchers = [],
            cached = compilerCache[selector + " "];

        if (!cached) {
          // Generate a function of recursive functions that can be used to check each element
          if (!match) {
            match = tokenize(selector);
          }

          i = match.length;

          while (i--) {
            cached = matcherFromTokens(match[i]);

            if (cached[expando]) {
              setMatchers.push(cached);
            } else {
              elementMatchers.push(cached);
            }
          } // Cache the compiled function


          cached = compilerCache(selector, matcherFromGroupMatchers(elementMatchers, setMatchers)); // Save selector and tokenization

          cached.selector = selector;
        }

        return cached;
      };
      /**
       * A low-level selection function that works with Sizzle's compiled
       *  selector functions
       * @param {String|Function} selector A selector or a pre-compiled
       *  selector function built with Sizzle.compile
       * @param {Element} context
       * @param {Array} [results]
       * @param {Array} [seed] A set of elements to match against
       */


      select = Sizzle.select = function (selector, context, results, seed) {
        var i,
            tokens,
            token,
            type,
            find,
            compiled = typeof selector === "function" && selector,
            match = !seed && tokenize(selector = compiled.selector || selector);
        results = results || []; // Try to minimize operations if there is only one selector in the list and no seed
        // (the latter of which guarantees us context)

        if (match.length === 1) {
          // Reduce context if the leading compound selector is an ID
          tokens = match[0] = match[0].slice(0);

          if (tokens.length > 2 && (token = tokens[0]).type === "ID" && context.nodeType === 9 && documentIsHTML && Expr.relative[tokens[1].type]) {
            context = (Expr.find["ID"](token.matches[0].replace(runescape, funescape), context) || [])[0];

            if (!context) {
              return results; // Precompiled matchers will still verify ancestry, so step up a level
            } else if (compiled) {
              context = context.parentNode;
            }

            selector = selector.slice(tokens.shift().value.length);
          } // Fetch a seed set for right-to-left matching


          i = matchExpr["needsContext"].test(selector) ? 0 : tokens.length;

          while (i--) {
            token = tokens[i]; // Abort if we hit a combinator

            if (Expr.relative[type = token.type]) {
              break;
            }

            if (find = Expr.find[type]) {
              // Search, expanding context for leading sibling combinators
              if (seed = find(token.matches[0].replace(runescape, funescape), rsibling.test(tokens[0].type) && testContext(context.parentNode) || context)) {
                // If seed is empty or no tokens remain, we can return early
                tokens.splice(i, 1);
                selector = seed.length && toSelector(tokens);

                if (!selector) {
                  push.apply(results, seed);
                  return results;
                }

                break;
              }
            }
          }
        } // Compile and execute a filtering function if one is not provided
        // Provide `match` to avoid retokenization if we modified the selector above


        (compiled || compile(selector, match))(seed, context, !documentIsHTML, results, !context || rsibling.test(selector) && testContext(context.parentNode) || context);
        return results;
      }; // One-time assignments
      // Sort stability


      support.sortStable = expando.split("").sort(sortOrder).join("") === expando; // Support: Chrome 14-35+
      // Always assume duplicates if they aren't passed to the comparison function

      support.detectDuplicates = !!hasDuplicate; // Initialize against the default document

      setDocument(); // Support: Webkit<537.32 - Safari 6.0.3/Chrome 25 (fixed in Chrome 27)
      // Detached nodes confoundingly follow *each other*

      support.sortDetached = assert(function (el) {
        // Should return 1, but returns 4 (following)
        return el.compareDocumentPosition(document.createElement("fieldset")) & 1;
      }); // Support: IE<8
      // Prevent attribute/property "interpolation"
      // https://msdn.microsoft.com/en-us/library/ms536429%28VS.85%29.aspx

      if (!assert(function (el) {
        el.innerHTML = AGPolicy.createHTML("<a href='#'></a>");
        return el.firstChild.getAttribute("href") === "#";
      })) {
        addHandle("type|href|height|width", function (elem, name, isXML) {
          if (!isXML) {
            return elem.getAttribute(name, name.toLowerCase() === "type" ? 1 : 2);
          }
        });
      } // Support: IE<9
      // Use defaultValue in place of getAttribute("value")


      if (!support.attributes || !assert(function (el) {
        el.innerHTML = AGPolicy.createHTML("<input/>");
        el.firstChild.setAttribute("value", "");
        return el.firstChild.getAttribute("value") === "";
      })) {
        addHandle("value", function (elem, name, isXML) {
          if (!isXML && elem.nodeName.toLowerCase() === "input") {
            return elem.defaultValue;
          }
        });
      } // Support: IE<9
      // Use getAttributeNode to fetch booleans when getAttribute lies


      if (!assert(function (el) {
        return el.getAttribute("disabled") == null;
      })) {
        addHandle(booleans, function (elem, name, isXML) {
          var val;

          if (!isXML) {
            return elem[name] === true ? name.toLowerCase() : (val = elem.getAttributeNode(name)) && val.specified ? val.value : null;
          }
        });
      } // EXPOSE
      // Do not expose Sizzle to the global scope in the case of AdGuard ExtendedCss build


      return Sizzle; // EXPOSE
    }(window); //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

  }

  return Sizzle;
};

/* jshint ignore:end */

/**
 * Copyright 2016 Adguard Software Ltd
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * Class that extends Sizzle and adds support for "matches-css" pseudo element.
 */

var StylePropertyMatcher = function (window) {
  var isPhantom = !!window._phantom;
  var useFallback = isPhantom && !!window.getMatchedCSSRules;
  /**
   * Unquotes specified value
   * Webkit-based browsers singlequotes <string> content property values
   * Other browsers doublequotes content property values.
   */

  var removeContentQuotes = function removeContentQuotes(value) {
    if (typeof value === 'string') {
      return value.replace(/^(["'])([\s\S]*)\1$/, '$2');
    }

    return value;
  };

  var getComputedStyle = window.getComputedStyle.bind(window);
  var getMatchedCSSRules = useFallback ? window.getMatchedCSSRules.bind(window) : null;
  /**
   * There is an issue in browsers based on old webkit:
   * getComputedStyle(el, ":before") is empty if element is not visible.
   *
   * To circumvent this issue we use getMatchedCSSRules instead.
   *
   * It appears that getMatchedCSSRules sorts the CSS rules
   * in increasing order of specifities of corresponding selectors.
   * We pick the css rule that is being applied to an element based on this assumption.
   *
   * @param element       DOM node
   * @param pseudoElement Optional pseudoElement name
   * @param propertyName  CSS property name
   */

  var getComputedStylePropertyValue = function getComputedStylePropertyValue(element, pseudoElement, propertyName) {
    var value = '';

    if (useFallback && pseudoElement) {
      var cssRules = getMatchedCSSRules(element, pseudoElement) || [];
      var i = cssRules.length;

      while (i-- > 0 && !value) {
        value = cssRules[i].style.getPropertyValue(propertyName);
      }
    } else {
      var style = getComputedStyle(element, pseudoElement);

      if (style) {
        value = style.getPropertyValue(propertyName); // https://bugs.webkit.org/show_bug.cgi?id=93445

        if (propertyName === 'opacity' && utils.isSafariBrowser) {
          value = (Math.round(parseFloat(value) * 100) / 100).toString();
        }
      }
    }

    if (propertyName === 'content') {
      value = removeContentQuotes(value);
    }

    return value;
  };
  /**
   * Adds url parameter quotes for non-regex pattern
   * @param {string} pattern
   */


  var addUrlQuotes = function addUrlQuotes(pattern) {
    // for regex patterns
    if (pattern[0] === '/' && pattern[pattern.length - 1] === '/' && pattern.indexOf('\\"') < 10) {
      // e.g. /^url\\([a-z]{4}:[a-z]{5}/
      // or /^url\\(data\\:\\image\\/gif;base64.+/
      var re = /(\^)?url(\\)?\\\((\w|\[\w)/g;
      return pattern.replace(re, '$1url$2\\\(\\"?$3');
    } // for non-regex patterns


    if (pattern.indexOf('url("') === -1) {
      var _re = /url\((.*?)\)/g;
      return pattern.replace(_re, 'url("$1")');
    }

    return pattern;
  };
  /**
   * Class that matches element style against the specified expression
   * @member {string} propertyName
   * @member {string} pseudoElement
   * @member {RegExp} regex
   */


  var Matcher = function Matcher(propertyFilter, pseudoElement) {
    this.pseudoElement = pseudoElement;

    try {
      var index = propertyFilter.indexOf(':');
      this.propertyName = propertyFilter.substring(0, index).trim();
      var pattern = propertyFilter.substring(index + 1).trim();
      pattern = addUrlQuotes(pattern); // Unescaping pattern
      // For non-regex patterns, (,),[,] should be unescaped, because we require escaping them in filter rules.
      // For regex patterns, ",\ should be escaped, because we manually escape those in extended-css-selector.js.

      if (/^\/.*\/$/.test(pattern)) {
        pattern = pattern.slice(1, -1);
        this.regex = utils.pseudoArgToRegex(pattern);
      } else {
        pattern = pattern.replace(/\\([\\()[\]"])/g, '$1');
        this.regex = utils.createURLRegex(pattern);
      }
    } catch (ex) {
      utils.logError("StylePropertyMatcher: invalid match string ".concat(propertyFilter));
    }
  };
  /**
   * Function to check if element CSS property matches filter pattern
   * @param {Element} element to check
   */


  Matcher.prototype.matches = function (element) {
    if (!this.regex || !this.propertyName) {
      return false;
    }

    var value = getComputedStylePropertyValue(element, this.pseudoElement, this.propertyName);
    return value && this.regex.test(value);
  };
  /**
   * Creates a new pseudo-class and registers it in Sizzle
   */


  var extendSizzle = function extendSizzle(sizzle) {
    // First of all we should prepare Sizzle engine
    sizzle.selectors.pseudos['matches-css'] = sizzle.selectors.createPseudo(function (propertyFilter) {
      var matcher = new Matcher(propertyFilter);
      return function (element) {
        return matcher.matches(element);
      };
    });
    sizzle.selectors.pseudos['matches-css-before'] = sizzle.selectors.createPseudo(function (propertyFilter) {
      var matcher = new Matcher(propertyFilter, ':before');
      return function (element) {
        return matcher.matches(element);
      };
    });
    sizzle.selectors.pseudos['matches-css-after'] = sizzle.selectors.createPseudo(function (propertyFilter) {
      var matcher = new Matcher(propertyFilter, ':after');
      return function (element) {
        return matcher.matches(element);
      };
    });
  }; // EXPOSE


  return {
    extendSizzle: extendSizzle
  };
}(window);

/**
 * Copyright 2016 Adguard Software Ltd
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var matcherUtils = {};
matcherUtils.MutationObserver = window.MutationObserver || window.WebKitMutationObserver;
/**
 * Parses argument of matcher pseudo (for matches-attr and matches-property)
 * @param {string} matcherFilter argument of pseudo class
 * @returns {Array}
 */

matcherUtils.parseMatcherFilter = function (matcherFilter) {
  var FULL_MATCH_MARKER = '"="';
  var rawArgs = [];

  if (matcherFilter.indexOf(FULL_MATCH_MARKER) === -1) {
    // if there is only one pseudo arg
    // e.g. :matches-attr("data-name") or :matches-property("inner.prop")
    // Sizzle will parse it and get rid of quotes
    // so it might be valid arg already without them
    rawArgs.push(matcherFilter);
  } else {
    matcherFilter.split('=').forEach(function (arg) {
      if (arg[0] === '"' && arg[arg.length - 1] === '"') {
        rawArgs.push(arg.slice(1, -1));
      }
    });
  }

  return rawArgs;
};
/**
 * @typedef {Object} ArgData
 * @property {string} arg
 * @property {boolean} isRegexp
 */

/**
 * Parses raw matcher arg
 * @param {string} rawArg
 * @returns {ArgData}
 */


matcherUtils.parseRawMatcherArg = function (rawArg) {
  var arg = rawArg;
  var isRegexp = !!rawArg && rawArg[0] === '/' && rawArg[rawArg.length - 1] === '/';

  if (isRegexp) {
    // to avoid at least such case  :matches-property("//")
    if (rawArg.length > 2) {
      arg = utils.toRegExp(rawArg);
    } else {
      throw new Error("Invalid regexp: ".concat(rawArg));
    }
  }

  return {
    arg: arg,
    isRegexp: isRegexp
  };
};
/**
 * @typedef Chain
 * @property {Object} base
 * @property {string} prop
 * @property {string} value
 */

/**
 * Checks if the property exists in the base object (recursively).
 * @param {Object} base
 * @param {ArgData[]} chain array of objects - parsed string property chain
 * @param {Array} [output=[]] result acc
 * @returns {Chain[]} array of objects
 */


matcherUtils.filterRootsByRegexpChain = function (base, chain) {
  var output = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];
  var tempProp = chain[0];

  if (chain.length === 1) {
    // eslint-disable-next-line no-restricted-syntax
    for (var key in base) {
      if (tempProp.isRegexp) {
        if (tempProp.arg.test(key)) {
          output.push({
            base: base,
            prop: key,
            value: base[key]
          });
        }
      } else if (tempProp.arg === key) {
        output.push({
          base: base,
          prop: tempProp.arg,
          value: base[key]
        });
      }
    }

    return output;
  } // if there is a regexp prop in input chain
  // e.g. 'unit./^ad.+/.src' for 'unit.ad-1gf2.src unit.ad-fgd34.src'),
  // every base keys should be tested by regexp and it can be more that one results


  if (tempProp.isRegexp) {
    var nextProp = chain.slice(1);
    var baseKeys = []; // eslint-disable-next-line no-restricted-syntax

    for (var _key in base) {
      if (tempProp.arg.test(_key)) {
        baseKeys.push(_key);
      }
    }

    baseKeys.forEach(function (key) {
      var item = base[key];
      matcherUtils.filterRootsByRegexpChain(item, nextProp, output);
    });
  } // avoid TypeError while accessing to null-prop's child


  if (base === null) {
    return;
  }

  var nextBase = base[tempProp.arg];
  chain = chain.slice(1);

  if (nextBase !== undefined) {
    matcherUtils.filterRootsByRegexpChain(nextBase, chain, output);
  }

  return output;
};
/**
 * Validates parsed args of matches-property pseudo
 * @param {...ArgData} args
 */


matcherUtils.validatePropMatcherArgs = function () {
  for (var _len = arguments.length, args = new Array(_len), _key2 = 0; _key2 < _len; _key2++) {
    args[_key2] = arguments[_key2];
  }

  for (var i = 0; i < args.length; i += 1) {
    if (args[i].isRegexp) {
      if (!utils.startsWith(args[i].arg.toString(), '/') || !utils.endsWith(args[i].arg.toString(), '/')) {
        return false;
      } // simple arg check if it is not a regexp

    } else if (!/^[\w-]+$/.test(args[i].arg)) {
      return false;
    }
  }

  return true;
};

/**
 * Class that extends Sizzle and adds support for "matches-attr" pseudo element.
 */

var AttributesMatcher = function () {
  /**
   * Class that matches element attributes against the specified expressions
   * @param {ArgData} nameArg - parsed name argument
   * @param {ArgData} valueArg - parsed value argument
   * @param {string} pseudoElement
   * @constructor
   *
   * @member {string|RegExp} attrName
   * @member {boolean} isRegexpName
   * @member {string|RegExp} attrValue
   * @member {boolean} isRegexpValue
   */
  var AttrMatcher = function AttrMatcher(nameArg, valueArg, pseudoElement) {
    this.pseudoElement = pseudoElement;
    this.attrName = nameArg.arg;
    this.isRegexpName = nameArg.isRegexp;
    this.attrValue = valueArg.arg;
    this.isRegexpValue = valueArg.isRegexp;
  };
  /**
   * Function to check if element attributes matches filter pattern
   * @param {Element} element to check
   */


  AttrMatcher.prototype.matches = function (element) {
    var elAttrs = element.attributes;

    if (elAttrs.length === 0 || !this.attrName) {
      return false;
    }

    var i = 0;

    while (i < elAttrs.length) {
      var attr = elAttrs[i];
      var matched = false;
      var attrNameMatched = this.isRegexpName ? this.attrName.test(attr.name) : this.attrName === attr.name;

      if (!this.attrValue) {
        // for :matches-attr("/regex/") or :matches-attr("attr-name")
        matched = attrNameMatched;
      } else {
        var attrValueMatched = this.isRegexpValue ? this.attrValue.test(attr.value) : this.attrValue === attr.value;
        matched = attrNameMatched && attrValueMatched;
      }

      if (matched) {
        return true;
      }

      i += 1;
    }
  };
  /**
   * Creates a new pseudo-class and registers it in Sizzle
   */


  var extendSizzle = function extendSizzle(sizzle) {
    // First of all we should prepare Sizzle engine
    sizzle.selectors.pseudos['matches-attr'] = sizzle.selectors.createPseudo(function (attrFilter) {
      var _matcherUtils$parseMa = matcherUtils.parseMatcherFilter(attrFilter),
          _matcherUtils$parseMa2 = _slicedToArray(_matcherUtils$parseMa, 2),
          rawName = _matcherUtils$parseMa2[0],
          rawValue = _matcherUtils$parseMa2[1];

      var nameArg = matcherUtils.parseRawMatcherArg(rawName);
      var valueArg = matcherUtils.parseRawMatcherArg(rawValue);

      if (!attrFilter || !matcherUtils.validatePropMatcherArgs(nameArg, valueArg)) {
        throw new Error("Invalid argument of :matches-attr pseudo class: ".concat(attrFilter));
      }

      var matcher = new AttrMatcher(nameArg, valueArg);
      return function (element) {
        return matcher.matches(element);
      };
    });
  }; // EXPOSE


  return {
    extendSizzle: extendSizzle
  };
}();

/**
 * Parses raw property arg
 * @param {string} input
 * @returns {ArgData[]} array of objects
 */

var parseRawPropChain = function parseRawPropChain(input) {
  var PROPS_DIVIDER = '.';
  var REGEXP_MARKER = '/';
  var propsArr = [];
  var str = input;

  while (str.length > 0) {
    if (utils.startsWith(str, PROPS_DIVIDER)) {
      // for cases like '.prop.id' and 'nested..test'
      throw new Error("Invalid chain property: ".concat(input));
    }

    if (!utils.startsWith(str, REGEXP_MARKER)) {
      var isRegexp = false;
      var dividerIndex = str.indexOf(PROPS_DIVIDER);

      if (str.indexOf(PROPS_DIVIDER) === -1) {
        // if there is no '.' left in str
        // take the rest of str as prop
        propsArr.push({
          arg: str,
          isRegexp: isRegexp
        });
        return propsArr;
      } // else take prop from str


      var prop = str.slice(0, dividerIndex); // for cases like 'asadf.?+/.test'

      if (prop.indexOf(REGEXP_MARKER) > -1) {
        // prop is '?+/'
        throw new Error("Invalid chain property: ".concat(prop));
      }

      propsArr.push({
        arg: prop,
        isRegexp: isRegexp
      }); // delete prop from str

      str = str.slice(dividerIndex);
    } else {
      // deal with regexp
      var propChunks = [];
      propChunks.push(str.slice(0, 1)); // if str starts with '/', delete it from str and find closing regexp slash.
      // note that chained property name can not include '/' or '.'
      // so there is no checking for escaped characters

      str = str.slice(1);
      var regexEndIndex = str.indexOf(REGEXP_MARKER);

      if (regexEndIndex < 1) {
        // regexp should be at least === '/./'
        // so we should avoid args like '/id' and 'test.//.id'
        throw new Error("Invalid regexp: ".concat(REGEXP_MARKER).concat(str));
      }

      var _isRegexp = true; // take the rest regexp part

      propChunks.push(str.slice(0, regexEndIndex + 1));

      var _prop = utils.toRegExp(propChunks.join(''));

      propsArr.push({
        arg: _prop,
        isRegexp: _isRegexp
      }); // delete prop from str

      str = str.slice(regexEndIndex + 1);
    }

    if (!str) {
      return propsArr;
    } // str should be like '.nextProp' now
    // so 'zx.prop' or '.' is invalid


    if (!utils.startsWith(str, PROPS_DIVIDER) || utils.startsWith(str, PROPS_DIVIDER) && str.length === 1) {
      throw new Error("Invalid chain property: ".concat(input));
    }

    str = str.slice(1);
  }
};

var convertTypeFromStr = function convertTypeFromStr(value) {
  var numValue = Number(value);
  var output;

  if (!Number.isNaN(numValue)) {
    output = numValue;
  } else {
    switch (value) {
      case 'undefined':
        output = undefined;
        break;

      case 'null':
        output = null;
        break;

      case 'true':
        output = true;
        break;

      case 'false':
        output = false;
        break;

      default:
        output = value;
    }
  }

  return output;
};

var convertTypeIntoStr = function convertTypeIntoStr(value) {
  var output;

  switch (value) {
    case undefined:
      output = 'undefined';
      break;

    case null:
      output = 'null';
      break;

    default:
      output = value.toString();
  }

  return output;
};
/**
 * Class that extends Sizzle and adds support for "matches-property" pseudo element.
 */


var ElementPropertyMatcher = function () {
  /**
   * Class that matches element properties against the specified expressions
   * @param {ArgData[]} propsChainArg - array of parsed props chain objects
   * @param {ArgData} valueArg - parsed value argument
   * @param {string} pseudoElement
   * @constructor
   *
   * @member {Array} chainedProps
   * @member {boolean} isRegexpName
   * @member {string|RegExp} propValue
   * @member {boolean} isRegexpValue
   */
  var PropMatcher = function PropMatcher(propsChainArg, valueArg, pseudoElement) {
    this.pseudoElement = pseudoElement;
    this.chainedProps = propsChainArg;
    this.propValue = valueArg.arg;
    this.isRegexpValue = valueArg.isRegexp;
  };
  /**
   * Function to check if element properties matches filter pattern
   * @param {Element} element to check
   */


  PropMatcher.prototype.matches = function (element) {
    var ownerObjArr = matcherUtils.filterRootsByRegexpChain(element, this.chainedProps);

    if (ownerObjArr.length === 0) {
      return false;
    }

    var matched = true;

    if (this.propValue) {
      for (var i = 0; i < ownerObjArr.length; i += 1) {
        var realValue = ownerObjArr[i].value;

        if (this.isRegexpValue) {
          matched = this.propValue.test(convertTypeIntoStr(realValue));
        } else {
          // handle 'null' and 'undefined' property values set as string
          if (realValue === 'null' || realValue === 'undefined') {
            matched = this.propValue === realValue;
            break;
          }

          matched = convertTypeFromStr(this.propValue) === realValue;
        }

        if (matched) {
          break;
        }
      }
    }

    return matched;
  };
  /**
   * Creates a new pseudo-class and registers it in Sizzle
   */


  var extendSizzle = function extendSizzle(sizzle) {
    // First of all we should prepare Sizzle engine
    sizzle.selectors.pseudos['matches-property'] = sizzle.selectors.createPseudo(function (propertyFilter) {
      if (!propertyFilter) {
        throw new Error('No argument is given for :matches-property pseudo class');
      }

      var _matcherUtils$parseMa = matcherUtils.parseMatcherFilter(propertyFilter),
          _matcherUtils$parseMa2 = _slicedToArray(_matcherUtils$parseMa, 2),
          rawProp = _matcherUtils$parseMa2[0],
          rawValue = _matcherUtils$parseMa2[1]; // chained property name can not include '/' or '.'
      // so regex prop names with such escaped characters are invalid


      if (rawProp.indexOf('\\/') > -1 || rawProp.indexOf('\\.') > -1) {
        throw new Error("Invalid property name: ".concat(rawProp));
      }

      var propsChainArg = parseRawPropChain(rawProp);
      var valueArg = matcherUtils.parseRawMatcherArg(rawValue);
      var propsToValidate = [].concat(_toConsumableArray(propsChainArg), [valueArg]);

      if (!matcherUtils.validatePropMatcherArgs(propsToValidate)) {
        throw new Error("Invalid argument of :matches-property pseudo class: ".concat(propertyFilter));
      }

      var matcher = new PropMatcher(propsChainArg, valueArg);
      return function (element) {
        return matcher.matches(element);
      };
    });
  }; // EXPOSE


  return {
    extendSizzle: extendSizzle
  };
}();

/**
 * Copyright 2020 Adguard Software Ltd
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * Class that extends Sizzle and adds support for :is() pseudo element.
 */

var IsAnyMatcher = function () {
  /**
   * Class that matches element by one of the selectors
   * https://developer.mozilla.org/en-US/docs/Web/CSS/:is
   * @param {Array} selectors
   * @param {string} pseudoElement
   * @constructor
   */
  var IsMatcher = function IsMatcher(selectors, pseudoElement) {
    this.selectors = selectors;
    this.pseudoElement = pseudoElement;
  };
  /**
   * Function to check if element can be matched by any passed selector
   * @param {Element} element to check
   */


  IsMatcher.prototype.matches = function (element) {
    var isMatched = !!this.selectors.find(function (selector) {
      var nodes = document.querySelectorAll(selector);
      return Array.from(nodes).find(function (node) {
        return node === element;
      });
    });
    return isMatched;
  };
  /**
   * Creates a new pseudo-class and registers it in Sizzle
   */


  var extendSizzle = function extendSizzle(sizzle) {
    // First of all we should prepare Sizzle engine
    sizzle.selectors.pseudos['is'] = sizzle.selectors.createPseudo(function (input) {
      if (input === '') {
        throw new Error("Invalid argument of :is pseudo-class: ".concat(input));
      }

      var selectors = input.split(',').map(function (s) {
        return s.trim();
      }); // collect valid selectors and log about invalid ones

      var validSelectors = selectors.reduce(function (acc, selector) {
        if (cssUtils.isSimpleSelectorValid(selector)) {
          acc.push(selector);
        } else {
          utils.logInfo("Invalid selector passed to :is() pseudo-class: '".concat(selector, "'"));
        }

        return acc;
      }, []);
      var matcher = new IsMatcher(validSelectors);
      return function (element) {
        return matcher.matches(element);
      };
    });
  };

  return {
    extendSizzle: extendSizzle
  };
}();

/**
 * Copyright 2021 Adguard Software Ltd
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * Extended selector factory module, for creating extended selector classes.
 *
 * Extended selection capabilities description:
 * https://github.com/AdguardTeam/ExtendedCss/blob/master/README.md
 */

var ExtendedSelectorFactory = function () {
  // while adding new markers, constants in other AdGuard repos should be corrected
  // AdGuard browser extension : CssFilterRule.SUPPORTED_PSEUDO_CLASSES and CssFilterRule.EXTENDED_CSS_MARKERS
  // tsurlfilter, SafariConverterLib : EXT_CSS_PSEUDO_INDICATORS
  var PSEUDO_EXTENSIONS_MARKERS = [':has', ':contains', ':has-text', ':matches-css', ':-abp-has', ':-abp-has-text', ':if', ':if-not', ':xpath', ':nth-ancestor', ':upward', ':remove', ':matches-attr', ':matches-property', ':-abp-contains', ':is'];
  var initialized = false;
  var Sizzle;
  /**
   * Lazy initialization of the ExtendedSelectorFactory and objects that might be necessary for creating and applying styles.
   * This method extends Sizzle engine that we use under the hood with our custom pseudo-classes.
   */

  function initialize() {
    if (initialized) {
      return;
    }

    initialized = true; // Our version of Sizzle is initialized lazily as well

    Sizzle = initializeSizzle(); // Add :matches-css-*() support

    StylePropertyMatcher.extendSizzle(Sizzle); // Add :matches-attr() support

    AttributesMatcher.extendSizzle(Sizzle); // Add :matches-property() support

    ElementPropertyMatcher.extendSizzle(Sizzle); // Add :is() support

    IsAnyMatcher.extendSizzle(Sizzle); // Add :contains, :has-text, :-abp-contains support

    var containsPseudo = Sizzle.selectors.createPseudo(function (text) {
      if (/^\s*\/.*\/[gmisuy]*\s*$/.test(text)) {
        text = text.trim();
        var flagsIndex = text.lastIndexOf('/');
        var flags = text.substring(flagsIndex + 1);
        text = text.substr(0, flagsIndex + 1).slice(1, -1).replace(/\\([\\"])/g, '$1');
        var regex;

        try {
          regex = new RegExp(text, flags);
        } catch (e) {
          throw new Error("Invalid argument of :contains pseudo class: ".concat(text));
        }

        return function (elem) {
          var elemTextContent = utils.nodeTextContentGetter.apply(elem);
          return regex.test(elemTextContent);
        };
      }

      text = text.replace(/\\([\\()[\]"])/g, '$1');
      return function (elem) {
        var elemTextContent = utils.nodeTextContentGetter.apply(elem);
        return elemTextContent.indexOf(text) > -1;
      };
    });
    Sizzle.selectors.pseudos['contains'] = containsPseudo;
    Sizzle.selectors.pseudos['has-text'] = containsPseudo;
    Sizzle.selectors.pseudos['-abp-contains'] = containsPseudo; // Add :if, :-abp-has support

    Sizzle.selectors.pseudos['if'] = Sizzle.selectors.pseudos['has'];
    Sizzle.selectors.pseudos['-abp-has'] = Sizzle.selectors.pseudos['has']; // Add :if-not support

    Sizzle.selectors.pseudos['if-not'] = Sizzle.selectors.createPseudo(function (selector) {
      if (typeof selector === 'string') {
        Sizzle.compile(selector);
      }

      return function (elem) {
        return Sizzle(selector, elem).length === 0;
      };
    });
    registerParserOnlyTokens();
  }
  /**
   * Registrate custom tokens for parser.
   * Needed for proper work of pseudos:
   * for checking if the token is last and pseudo-class arguments validation
   */


  function registerParserOnlyTokens() {
    Sizzle.selectors.pseudos['xpath'] = Sizzle.selectors.createPseudo(function (selector) {
      try {
        document.createExpression(selector, null);
      } catch (e) {
        throw new Error("Invalid argument of :xpath pseudo class: ".concat(selector));
      }

      return function () {
        return true;
      };
    });
    Sizzle.selectors.pseudos['nth-ancestor'] = Sizzle.selectors.createPseudo(function (selector) {
      var deep = Number(selector);

      if (Number.isNaN(deep) || deep < 1 || deep >= 256) {
        throw new Error("Invalid argument of :nth-ancestor pseudo class: ".concat(selector));
      }

      return function () {
        return true;
      };
    });
    Sizzle.selectors.pseudos['upward'] = Sizzle.selectors.createPseudo(function (input) {
      if (input === '') {
        throw new Error("Invalid argument of :upward pseudo class: ".concat(input));
      } else if (Number.isInteger(+input) && (+input < 1 || +input >= 256)) {
        throw new Error("Invalid argument of :upward pseudo class: ".concat(input));
      }

      return function () {
        return true;
      };
    });
    Sizzle.selectors.pseudos['remove'] = Sizzle.selectors.createPseudo(function (input) {
      if (input !== '') {
        throw new Error("Invalid argument of :remove pseudo class: ".concat(input));
      }

      return function () {
        return true;
      };
    });
  }
  /**
   * Checks if specified token can be used by document.querySelectorAll.
   */


  function isSimpleToken(token) {
    var type = token.type;

    if (type === 'ID' || type === 'CLASS' || type === 'ATTR' || type === 'TAG' || type === 'CHILD') {
      // known simple tokens
      return true;
    }

    if (type === 'PSEUDO') {
      // check if value contains any of extended pseudo classes
      var i = PSEUDO_EXTENSIONS_MARKERS.length;

      while (i--) {
        if (token.value.indexOf(PSEUDO_EXTENSIONS_MARKERS[i]) >= 0) {
          return false;
        }
      }

      return true;
    } // all others aren't simple


    return false;
  }
  /**
   * Checks if specified token is a combinator
   */


  function isRelationToken(token) {
    var type = token.type;
    return type === ' ' || type === '>' || type === '+' || type === '~';
  }
  /**
   * ExtendedSelectorParser is a helper class for creating various selector instances which
   * all shares a method `querySelectorAll()` and `matches()` implementing different search strategies
   * depending on a type of selector.
   *
   * Currently, there are 3 types:
   *  A trait-less extended selector
   *    - we directly feed selector strings to Sizzle.
   *  A splitted extended selector
   *    - such as #container #feedItem:has(.ads), where it is splitted to `#container` and `#feedItem:has(.ads)`.
   */


  function ExtendedSelectorParser(selectorText, tokens, debug) {
    initialize();

    if (typeof tokens === 'undefined') {
      this.selectorText = cssUtils.normalize(selectorText); // Passing `returnUnsorted` in order to receive tokens in the order that's valid for the browser
      // In Sizzle internally, the tokens are re-sorted: https://github.com/AdguardTeam/ExtendedCss/issues/55

      this.tokens = Sizzle.tokenize(this.selectorText, false, {
        returnUnsorted: true
      });
    } else {
      this.selectorText = selectorText;
      this.tokens = tokens;
    }

    if (debug === true) {
      this.debug = true;
    }
  }

  ExtendedSelectorParser.prototype = {
    /**
     * The main method, creates a selector instance depending on the type of a selector.
     * @public
     */
    createSelector: function createSelector() {
      var debug = this.debug;
      var tokens = this.tokens;
      var selectorText = this.selectorText;

      if (tokens.length !== 1) {
        // Comma-separate selector - can't optimize further
        return new TraitLessSelector(selectorText, debug);
      }

      var xpathPart = this.getXpathPart();

      if (typeof xpathPart !== 'undefined') {
        return new XpathSelector(selectorText, xpathPart, debug);
      }

      var upwardPart = this.getUpwardPart();

      if (typeof upwardPart !== 'undefined') {
        var output;
        var upwardDeep = parseInt(upwardPart, 10); // if upward parameter is not a number, we consider it as a selector

        if (Number.isNaN(upwardDeep)) {
          output = new UpwardSelector(selectorText, upwardPart, debug);
        } else {
          // upward works like nth-ancestor
          var xpath = this.convertNthAncestorToken(upwardDeep);
          output = new XpathSelector(selectorText, xpath, debug);
        }

        return output;
      } // argument of pseudo-class remove;
      // it's defined only if remove is parsed as last token
      // and it's valid only if remove arg is empty string


      var removePart = this.getRemovePart();

      if (typeof removePart !== 'undefined') {
        var hasValidRemovePart = removePart === '';
        return new RemoveSelector(selectorText, hasValidRemovePart, debug);
      }

      tokens = tokens[0];
      var l = tokens.length;
      var lastRelTokenInd = this.getSplitPoint();

      if (typeof lastRelTokenInd === 'undefined') {
        try {
          document.querySelector(selectorText);
        } catch (e) {
          return new TraitLessSelector(selectorText, debug);
        }

        return new NotAnExtendedSelector(selectorText, debug);
      }

      var simple = '';
      var relation = null;
      var complex = '';
      var i = 0;

      for (; i < lastRelTokenInd; i++) {
        // build simple part
        simple += tokens[i].value;
      }

      if (i > 0) {
        // build relation part
        relation = tokens[i++].type;
      } // i is pointing to the start of a complex part.


      for (; i < l; i++) {
        complex += tokens[i].value;
      }

      return lastRelTokenInd === -1 ? new TraitLessSelector(selectorText, debug) : new SplittedSelector(selectorText, simple, relation, complex, debug);
    },

    /**
     * @private
     * @return {number|undefined} An index of a token that is split point.
     * returns undefined if the selector does not contain any complex tokens
     * or it is not eligible for splitting.
     * Otherwise returns an integer indicating the index of the last relation token.
     */
    getSplitPoint: function getSplitPoint() {
      var tokens = this.tokens[0]; // We split selector only when the last compound selector
      // is the only extended selector.

      var latestRelationTokenIndex = -1;
      var haveMetComplexToken = false;

      for (var i = 0, l = tokens.length; i < l; i++) {
        var token = tokens[i];

        if (isRelationToken(token)) {
          if (haveMetComplexToken) {
            return;
          }

          latestRelationTokenIndex = i;
        } else if (!isSimpleToken(token)) {
          haveMetComplexToken = true;
        }
      }

      if (!haveMetComplexToken) {
        return;
      }

      return latestRelationTokenIndex;
    },

    /**
     * @private
     * @return {string|undefined} xpath selector part if exists
     * returns undefined if the selector does not contain xpath tokens
     */
    getXpathPart: function getXpathPart() {
      var tokens = this.tokens[0];

      for (var i = 0, tokensLength = tokens.length; i < tokensLength; i++) {
        var token = tokens[i];

        if (token.type === 'PSEUDO') {
          var matches = token.matches;

          if (matches && matches.length > 1) {
            if (matches[0] === 'xpath') {
              if (this.isLastToken(tokens, i)) {
                throw new Error('Invalid pseudo: \':xpath\' should be at the end of the selector');
              }

              return matches[1];
            }

            if (matches[0] === 'nth-ancestor') {
              if (this.isLastToken(tokens, i)) {
                throw new Error('Invalid pseudo: \':nth-ancestor\' should be at the end of the selector');
              }

              var deep = matches[1];

              if (deep > 0 && deep < 256) {
                return this.convertNthAncestorToken(deep);
              }
            }
          }
        }
      }
    },

    /**
     * converts nth-ancestor/upward deep value to xpath equivalent
     * @param {number} deep
     * @return {string}
     */
    convertNthAncestorToken: function convertNthAncestorToken(deep) {
      var result = '..';

      while (deep > 1) {
        result += '/..';
        deep--;
      }

      return result;
    },

    /**
     * Checks if the token is last,
     * except of remove pseudo-class
     * @param {Array} tokens
     * @param {number} i index of token
     * @returns {boolean}
     */
    isLastToken: function isLastToken(tokens, i) {
      // check id the next parsed token is remove pseudo
      var isNextRemoveToken = tokens[i + 1] && tokens[i + 1].type === 'PSEUDO' && tokens[i + 1].matches && tokens[i + 1].matches[0] === 'remove'; // check if the token is last
      // and if it is not check if it is remove one
      // which should be skipped

      return i + 1 !== tokens.length && !isNextRemoveToken;
    },

    /**
     * @private
     * @return {string|undefined} upward parameter
     * or undefined if the input does not contain upward tokens
     */
    getUpwardPart: function getUpwardPart() {
      var tokens = this.tokens[0];

      for (var i = 0, tokensLength = tokens.length; i < tokensLength; i++) {
        var token = tokens[i];

        if (token.type === 'PSEUDO') {
          var matches = token.matches;

          if (matches && matches.length > 1) {
            if (matches[0] === 'upward') {
              if (this.isLastToken(tokens, i)) {
                throw new Error('Invalid pseudo: \':upward\' should be at the end of the selector');
              }

              return matches[1];
            }
          }
        }
      }
    },

    /**
     * @private
     * @return {string|undefined} remove parameter
     * or undefined if the input does not contain remove tokens
     */
    getRemovePart: function getRemovePart() {
      var tokens = this.tokens[0];

      for (var i = 0, tokensLength = tokens.length; i < tokensLength; i++) {
        var token = tokens[i];

        if (token.type === 'PSEUDO') {
          var matches = token.matches;

          if (matches && matches.length > 1) {
            if (matches[0] === 'remove') {
              if (i + 1 !== tokensLength) {
                throw new Error('Invalid pseudo: \':remove\' should be at the end of the selector');
              }

              return matches[1];
            }
          }
        }
      }
    }
  };
  var globalDebuggingFlag = false;

  function isDebugging() {
    return globalDebuggingFlag || this.debug;
  }
  /**
   * This class represents a selector which is not an extended selector.
   * @param {string} selectorText
   * @param {boolean=} debug
   * @final
   */


  function NotAnExtendedSelector(selectorText, debug) {
    this.selectorText = selectorText;
    this.debug = debug;
  }

  NotAnExtendedSelector.prototype = {
    querySelectorAll: function querySelectorAll() {
      return document.querySelectorAll(this.selectorText);
    },
    matches: function matches(element) {
      return element[utils.matchesPropertyName](this.selectorText);
    },
    isDebugging: isDebugging
  };
  /**
   * A trait-less extended selector class.
   * @param {string} selectorText
   * @param {boolean=} debug
   * @constructor
   */

  function TraitLessSelector(selectorText, debug) {
    this.selectorText = selectorText;
    this.debug = debug;
    Sizzle.compile(selectorText);
  }

  TraitLessSelector.prototype = {
    querySelectorAll: function querySelectorAll() {
      return Sizzle(this.selectorText);
    },

    /** @final */
    matches: function matches(element) {
      return Sizzle.matchesSelector(element, this.selectorText);
    },

    /** @final */
    isDebugging: isDebugging
  };
  /**
   * Parental class for such pseudo-classes as xpath, upward, remove
   * which are limited to be the last one token in selector
   *
   * @param {string} selectorText
   * @param {string} pseudoClassArg pseudo-class arg
   * @param {boolean=} debug
   * @constructor
   */

  function BaseLastArgumentSelector(selectorText, pseudoClassArg, debug) {
    this.selectorText = selectorText;
    this.pseudoClassArg = pseudoClassArg;
    this.debug = debug;
    Sizzle.compile(this.selectorText);
  }

  BaseLastArgumentSelector.prototype = {
    querySelectorAll: function querySelectorAll() {
      var _this = this;

      var resultNodes = [];
      var simpleNodes;

      if (this.selectorText) {
        simpleNodes = Sizzle(this.selectorText);

        if (!simpleNodes || !simpleNodes.length) {
          return resultNodes;
        }
      } else {
        simpleNodes = [document];
      }

      simpleNodes.forEach(function (node) {
        _this.searchResultNodes(node, _this.pseudoClassArg, resultNodes);
      });
      return Sizzle.uniqueSort(resultNodes);
    },

    /** @final */
    matches: function matches(element) {
      var results = this.querySelectorAll();
      return results.indexOf(element) > -1;
    },

    /** @final */
    isDebugging: isDebugging,

    /**
     * Primitive method that returns all nodes if pseudo-class arg is defined.
     * That logic works for remove pseudo-class,
     * but for others it should be overridden.
     * @param {Object} node context element
     * @param {string} pseudoClassArg pseudo-class argument
     * @param {Array} result
     */
    searchResultNodes: function searchResultNodes(node, pseudoClassArg, result) {
      if (pseudoClassArg) {
        result.push(node);
      }
    }
  };
  /**
   * Xpath selector class
   * Limited to support 'xpath' to be only the last one token in selector
   * @param {string} selectorText
   * @param {string} xpath value
   * @param {boolean=} debug
   * @constructor
   * @augments BaseLastArgumentSelector
   */

  function XpathSelector(selectorText, xpath, debug) {
    var NO_SELECTOR_MARKER = ':xpath(//';
    var BODY_SELECTOR_REPLACER = 'body:xpath(//';
    var modifiedSelectorText = selectorText; // Normally, a pseudo-class is applied to nodes selected by a selector -- selector:xpath(...).
    // However, :xpath is special as the selector can be ommited.
    // For any other pseudo-class that would mean "apply to ALL DOM nodes",
    // but in case of :xpath it just means "apply me to the document".

    if (utils.startsWith(selectorText, NO_SELECTOR_MARKER)) {
      modifiedSelectorText = selectorText.replace(NO_SELECTOR_MARKER, BODY_SELECTOR_REPLACER);
    }

    BaseLastArgumentSelector.call(this, modifiedSelectorText, xpath, debug);
  }

  XpathSelector.prototype = Object.create(BaseLastArgumentSelector.prototype);
  XpathSelector.prototype.constructor = XpathSelector;
  /**
   * Applies xpath pseudo-class to provided context node
   * @param {Object} node context element
   * @param {string} pseudoClassArg xpath
   * @param {Array} result
   * @override
   */

  XpathSelector.prototype.searchResultNodes = function (node, pseudoClassArg, result) {
    var xpathResult = document.evaluate(pseudoClassArg, node, null, XPathResult.UNORDERED_NODE_ITERATOR_TYPE, null);
    var iNode; // eslint-disable-next-line no-cond-assign

    while (iNode = xpathResult.iterateNext()) {
      result.push(iNode);
    }
  };
  /**
   * Upward selector class
   * Limited to support 'upward' to be only the last one token in selector
   * @param {string} selectorText
   * @param {string} upwardSelector value
   * @param {boolean=} debug
   * @constructor
   * @augments BaseLastArgumentSelector
   */


  function UpwardSelector(selectorText, upwardSelector, debug) {
    BaseLastArgumentSelector.call(this, selectorText, upwardSelector, debug);
  }

  UpwardSelector.prototype = Object.create(BaseLastArgumentSelector.prototype);
  UpwardSelector.prototype.constructor = UpwardSelector;
  /**
   * Applies upward pseudo-class to provided context node
   * @param {Object} node context element
   * @param {string} upwardSelector upward selector
   * @param {Array} result
   * @override
   */

  UpwardSelector.prototype.searchResultNodes = function (node, upwardSelector, result) {
    if (upwardSelector !== '') {
      var parent = node.parentElement;

      if (parent === null) {
        return;
      }

      node = parent.closest(upwardSelector);

      if (node === null) {
        return;
      }
    }

    result.push(node);
  };
  /**
   * Remove selector class
   * Limited to support 'remove' to be only the last one token in selector
   * @param {string} selectorText
   * @param {boolean} hasValidRemovePart
   * @param {boolean=} debug
   * @constructor
   * @augments BaseLastArgumentSelector
   */


  function RemoveSelector(selectorText, hasValidRemovePart, debug) {
    var REMOVE_PSEUDO_MARKER = ':remove()';
    var removeMarkerIndex = selectorText.indexOf(REMOVE_PSEUDO_MARKER); // deleting remove part of rule instead of which
    // pseudo-property property 'remove' will be added by ExtendedCssParser

    var modifiedSelectorText = selectorText.slice(0, removeMarkerIndex);
    BaseLastArgumentSelector.call(this, modifiedSelectorText, hasValidRemovePart, debug); // mark extendedSelector as Remove one for ExtendedCssParser

    this.isRemoveSelector = true;
  }

  RemoveSelector.prototype = Object.create(BaseLastArgumentSelector.prototype);
  RemoveSelector.prototype.constructor = RemoveSelector;
  /**
   * A splitted extended selector class.
   *
   * #container #feedItem:has(.ads)
   * +--------+                     simple
   *           +                    relation
   *            +-----------------+ complex
   * We split selector only when the last selector is complex
   * @param {string} selectorText
   * @param {string} simple
   * @param {string} relation
   * @param {string} complex
   * @param {boolean=} debug
   * @constructor
   * @extends TraitLessSelector
   */

  function SplittedSelector(selectorText, simple, relation, complex, debug) {
    TraitLessSelector.call(this, selectorText, debug);
    this.simple = simple;
    this.relation = relation;
    this.complex = complex;
    Sizzle.compile(complex);
  }

  SplittedSelector.prototype = Object.create(TraitLessSelector.prototype);
  SplittedSelector.prototype.constructor = SplittedSelector;
  /** @override */

  SplittedSelector.prototype.querySelectorAll = function () {
    var _this2 = this;

    var resultNodes = [];
    var simpleNodes;
    var simple = this.simple;
    var relation;

    if (simple) {
      // First we use simple selector to narrow our search
      simpleNodes = document.querySelectorAll(simple);

      if (!simpleNodes || !simpleNodes.length) {
        return resultNodes;
      }

      relation = this.relation;
    } else {
      simpleNodes = [document];
      relation = ' ';
    }

    switch (relation) {
      case ' ':
        simpleNodes.forEach(function (node) {
          _this2.relativeSearch(node, resultNodes);
        });
        break;

      case '>':
        {
          simpleNodes.forEach(function (node) {
            Object.values(node.children).forEach(function (childNode) {
              if (_this2.matches(childNode)) {
                resultNodes.push(childNode);
              }
            });
          });
          break;
        }

      case '+':
        {
          simpleNodes.forEach(function (node) {
            var parentNode = node.parentNode;
            Object.values(parentNode.children).forEach(function (childNode) {
              if (_this2.matches(childNode) && childNode.previousElementSibling === node) {
                resultNodes.push(childNode);
              }
            });
          });
          break;
        }

      case '~':
        {
          simpleNodes.forEach(function (node) {
            var parentNode = node.parentNode;
            Object.values(parentNode.children).forEach(function (childNode) {
              if (_this2.matches(childNode) && node.compareDocumentPosition(childNode) === 4) {
                resultNodes.push(childNode);
              }
            });
          });
          break;
        }
    }

    return Sizzle.uniqueSort(resultNodes);
  };
  /**
   * Performs a search of "complex" part relative to results for the "simple" part.
   * @param {Node} node a node matching the "simple" part.
   * @param {Node[]} result an array to append search result.
   */


  SplittedSelector.prototype.relativeSearch = function (node, results) {
    Sizzle(this.complex, node, results);
  };

  return {
    /**
     * Wraps the inner class so that the instance is not exposed.
     */
    createSelector: function createSelector(selector, tokens, debug) {
      return new ExtendedSelectorParser(selector, tokens, debug).createSelector();
    },

    /**
     * Mark every selector as a selector being debugged, so that timing information
     * for the selector is printed to the console.
     */
    enableGlobalDebugging: function enableGlobalDebugging() {
      globalDebuggingFlag = true;
    }
  };
}();

/**
 * Copyright 2016 Adguard Software Ltd
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * A helper class that parses stylesheets containing extended selectors
 * into ExtendedSelector instances and key-value maps of style declarations.
 * Please note, that it does not support any complex things like media queries and such.
 */

var ExtendedCssParser = function () {
  var reDeclEnd = /[;}]/g;
  var reDeclDivider = /[;:}]/g;
  var reNonWhitespace = /\S/g;
  var Sizzle;
  /**
   * @param {string} cssText
   * @constructor
   */

  function Parser(cssText) {
    this.cssText = cssText;
  }

  Parser.prototype = {
    error: function error(position) {
      throw new Error("CssParser: parse error at position ".concat(this.posOffset + position));
    },

    /**
     * Validates that the tokens correspond to a valid selector.
     * Sizzle is different from browsers and some selectors that it tolerates aren't actually valid.
     * For instance, "div >" won't work in a browser, but it will in Sizzle (it'd be the same as "div > *").
     *
     * @param {*} selectors An array of SelectorData (selector, groups)
     * @returns {boolean} false if any of the groups are invalid
     */
    validateSelectors: function validateSelectors(selectors) {
      var iSelectors = selectors.length;

      while (iSelectors--) {
        var groups = selectors[iSelectors].groups;
        var iGroups = groups.length;

        while (iGroups--) {
          var tokens = groups[iGroups];
          var lastToken = tokens[tokens.length - 1];

          if (Sizzle.selectors.relative[lastToken.type]) {
            return false;
          }
        }
      }

      return true;
    },

    /**
     * Parses a stylesheet and returns a list of pairs of an ExtendedSelector and a styles map.
     * This method will throw an error in case of an obviously invalid input.
     * If any of the selectors used in the stylesheet cannot be compiled into an ExtendedSelector,
     * it will be ignored.
     *
     * @typedef {Object} ExtendedStyle
     * @property {Object} selector An instance of the {@link ExtendedSelector} class
     * @property {Object} styleMap A map of styles parsed
     *
     * @returns {Array.<ExtendedStyle>} An array of the styles parsed
     */
    parseCss: function parseCss() {
      this.posOffset = 0;

      if (!this.cssText) {
        this.error(0);
      }

      var results = [];

      while (this.cssText) {
        // Apply tolerant tokenization.
        var parseResult = Sizzle.tokenize(this.cssText, false, {
          tolerant: true,
          returnUnsorted: true
        });
        var selectorData = parseResult.selectors;
        this.nextIndex = parseResult.nextIndex;

        if (this.cssText.charCodeAt(this.nextIndex) !== 123 ||
        /* charCode of '{' */
        !this.validateSelectors(selectorData)) {
          this.error(this.nextIndex);
        }

        this.nextIndex++; // Move the pointer to the start of style declaration.

        var styleMap = this.parseNextStyle();
        var debug = false; // If there is a style property 'debug', mark the selector
        // as a debuggable selector, and delete the style declaration.

        var debugPropertyValue = styleMap['debug'];

        if (typeof debugPropertyValue !== 'undefined') {
          if (debugPropertyValue === 'global') {
            ExtendedSelectorFactory.enableGlobalDebugging();
          }

          debug = true;
          delete styleMap['debug'];
        } // Creating an ExtendedSelector instance for every selector we got from Sizzle.tokenize.
        // This is quite important as Sizzle does a poor job at executing selectors like "selector1, selector2".


        for (var i = 0, l = selectorData.length; i < l; i++) {
          var data = selectorData[i];

          try {
            var extendedSelector = ExtendedSelectorFactory.createSelector(data.selectorText, data.groups, debug);

            if (extendedSelector.pseudoClassArg && extendedSelector.isRemoveSelector) {
              // if there is remove pseudo-class in rule,
              // the element will be removed and no other styles will be applied
              styleMap['remove'] = 'true';
            }

            results.push({
              selector: extendedSelector,
              style: styleMap
            });
          } catch (ex) {
            utils.logError("ExtendedCssParser: ignoring invalid selector ".concat(data.selectorText));
          }
        }
      }

      return results;
    },
    parseNextStyle: function parseNextStyle() {
      var styleMap = Object.create(null);
      var bracketPos = this.parseUntilClosingBracket(styleMap); // Cut out matched portion from cssText.

      reNonWhitespace.lastIndex = bracketPos + 1;
      var match = reNonWhitespace.exec(this.cssText);

      if (match === null) {
        this.cssText = '';
        return styleMap;
      }

      var matchPos = match.index;
      this.cssText = this.cssText.slice(matchPos);
      this.posOffset += matchPos;
      return styleMap;
    },

    /**
     * @return {number} an index of the next '}' in `this.cssText`.
     */
    parseUntilClosingBracket: function parseUntilClosingBracket(styleMap) {
      // Expects ":", ";", and "}".
      reDeclDivider.lastIndex = this.nextIndex;
      var match = reDeclDivider.exec(this.cssText);

      if (match === null) {
        this.error(this.nextIndex);
      }

      var matchPos = match.index;
      var matched = match[0];

      if (matched === '}') {
        return matchPos;
      }

      if (matched === ':') {
        var colonIndex = matchPos; // Expects ";" and "}".

        reDeclEnd.lastIndex = colonIndex;
        match = reDeclEnd.exec(this.cssText);

        if (match === null) {
          this.error(colonIndex);
        }

        matchPos = match.index;
        matched = match[0]; // Populates the `styleMap` key-value map.

        var property = this.cssText.slice(this.nextIndex, colonIndex).trim();
        var value = this.cssText.slice(colonIndex + 1, matchPos).trim();
        styleMap[property] = value; // If found "}", re-run the outer loop.

        if (matched === '}') {
          return matchPos;
        }
      } // matchPos is the position of the next ';'.
      // Increase 'nextIndex' and re-run the loop.


      this.nextIndex = matchPos + 1;
      return this.parseUntilClosingBracket(styleMap); // Should be a subject of tail-call optimization.
    }
  };
  return {
    parseCss: function parseCss(cssText) {
      Sizzle = initializeSizzle();
      return new Parser(cssUtils.normalize(cssText)).parseCss();
    }
  };
}();

/**
 * This callback is used to get affected node elements and handle style properties
 * before they are applied to them if it is necessary
 * @callback beforeStyleApplied
 * @param {object} affectedElement - Object containing DOM node and rule to be applied
 * @return {object} affectedElement - Same or modified object containing DOM node and rule to be applied
 */

/**
 * Extended css class
 *
 * @param {Object} configuration
 * @param {string} configuration.styleSheet - the CSS stylesheet text
 * @param {beforeStyleApplied} [configuration.beforeStyleApplied] - the callback that handles affected elements
 * @constructor
 */

function ExtendedCss(configuration) {
  if (!configuration) {
    throw new Error('Configuration is not provided.');
  }

  var styleSheet = configuration.styleSheet;
  var beforeStyleApplied = configuration.beforeStyleApplied;

  if (beforeStyleApplied && typeof beforeStyleApplied !== 'function') {
    // eslint-disable-next-line max-len
    throw new Error("Wrong configuration. Type of 'beforeStyleApplied' field should be a function, received: ".concat(_typeof(beforeStyleApplied)));
  } // We use EventTracker to track the event that is likely to cause the mutation.
  // The problem is that we cannot use `window.event` directly from the mutation observer call
  // as we're not in the event handler context anymore.


  var EventTracker = function () {
    var ignoredEventTypes = ['mouseover', 'mouseleave', 'mouseenter', 'mouseout'];
    var LAST_EVENT_TIMEOUT_MS = 10;
    var EVENTS = [// keyboard events
    'keydown', 'keypress', 'keyup', // mouse events
    'auxclick', 'click', 'contextmenu', 'dblclick', 'mousedown', 'mouseenter', 'mouseleave', 'mousemove', 'mouseover', 'mouseout', 'mouseup', 'pointerlockchange', 'pointerlockerror', 'select', 'wheel']; // 'wheel' event makes scrolling in Safari twitchy
    // https://github.com/AdguardTeam/ExtendedCss/issues/120

    var safariProblematicEvents = ['wheel'];
    var trackedEvents = utils.isSafariBrowser ? EVENTS.filter(function (el) {
      return !(safariProblematicEvents.indexOf(el) > -1);
    }) : EVENTS;
    var lastEventType;
    var lastEventTime;

    var trackEvent = function trackEvent(e) {
      lastEventType = e.type;
      lastEventTime = Date.now();
    };

    trackedEvents.forEach(function (evName) {
      document.documentElement.addEventListener(evName, trackEvent, true);
    });

    var getLastEventType = function getLastEventType() {
      return lastEventType;
    };

    var getTimeSinceLastEvent = function getTimeSinceLastEvent() {
      return Date.now() - lastEventTime;
    };

    return {
      isIgnoredEventType: function isIgnoredEventType() {
        return ignoredEventTypes.indexOf(getLastEventType()) > -1 && getTimeSinceLastEvent() < LAST_EVENT_TIMEOUT_MS;
      }
    };
  }();

  var rules = [];
  var affectedElements = [];
  var removalsStatistic = {};
  var domObserved;
  var eventListenerSupported = window.addEventListener;
  var domMutationObserver;

  function observeDocument(callback) {
    // We are trying to limit the number of callback calls by not calling it on all kind of "hover" events.
    // The rationale behind this is that "hover" events often cause attributes modification,
    // but re-applying extCSS rules will be useless as these attribute changes are usually transient.
    var isIgnoredMutation = function isIgnoredMutation(mutations) {
      for (var i = 0; i < mutations.length; i += 1) {
        if (mutations.type !== 'attributes') {
          return false;
        }
      }

      return true;
    };

    if (utils.MutationObserver) {
      domMutationObserver = new utils.MutationObserver(function (mutations) {
        if (!mutations || mutations.length === 0) {
          return;
        }

        if (EventTracker.isIgnoredEventType() && isIgnoredMutation(mutations)) {
          return;
        }

        callback();
      });
      domMutationObserver.observe(document, {
        childList: true,
        subtree: true,
        attributes: true,
        attributeFilter: ['id', 'class']
      });
    } else if (eventListenerSupported) {
      document.addEventListener('DOMNodeInserted', callback, false);
      document.addEventListener('DOMNodeRemoved', callback, false);
      document.addEventListener('DOMAttrModified', callback, false);
    }
  }

  function disconnectDocument(callback) {
    if (domMutationObserver) {
      domMutationObserver.disconnect();
    } else if (eventListenerSupported) {
      document.removeEventListener('DOMNodeInserted', callback, false);
      document.removeEventListener('DOMNodeRemoved', callback, false);
      document.removeEventListener('DOMAttrModified', callback, false);
    }
  }

  var MAX_STYLE_PROTECTION_COUNT = 50;
  var protectionObserverOption = {
    attributes: true,
    attributeOldValue: true,
    attributeFilter: ['style']
  };
  /**
   * Creates MutationObserver protection function
   *
   * @param styles
   * @return {protectionFunction}
   */

  function createProtectionFunction(styles) {
    function protectionFunction(mutations, observer) {
      if (!mutations.length) {
        return;
      }

      var mutation = mutations[0];
      var target = mutation.target;
      observer.disconnect();
      styles.forEach(function (style) {
        setStyleToElement(target, style);
      });

      if (++observer.styleProtectionCount < MAX_STYLE_PROTECTION_COUNT) {
        observer.observe(target, protectionObserverOption);
      } else {
        utils.logError('ExtendedCss: infinite loop protection for style');
      }
    }

    return protectionFunction;
  }
  /**
   * Sets up a MutationObserver which protects style attributes from changes
   * @param node DOM node
   * @param rules rules
   * @returns Mutation observer used to protect attribute or null if there's nothing to protect
   */


  function protectStyleAttribute(node, rules) {
    if (!utils.MutationObserver) {
      return null;
    }

    var styles = rules.map(function (r) {
      return r.style;
    });
    var protectionObserver = new utils.MutationObserver(createProtectionFunction(styles));
    protectionObserver.observe(node, protectionObserverOption); // Adds an expando to the observer to keep 'style fix counts'.

    protectionObserver.styleProtectionCount = 0;
    return protectionObserver;
  }

  function removeSuffix(str, suffix) {
    var index = str.indexOf(suffix, str.length - suffix.length);

    if (index >= 0) {
      return str.substring(0, index);
    }

    return str;
  }
  /**
   * Finds affectedElement object for the specified DOM node
   * @param node  DOM node
   * @returns     affectedElement found or null
   */


  function findAffectedElement(node) {
    for (var i = 0; i < affectedElements.length; i += 1) {
      if (affectedElements[i].node === node) {
        return affectedElements[i];
      }
    }

    return null;
  }

  function removeElement(affectedElement) {
    var node = affectedElement.node;
    affectedElement.removed = true;
    var elementSelector = utils.getNodeSelector(node); // check if the element has been already removed earlier

    var elementRemovalsCounter = removalsStatistic[elementSelector] || 0; // if removals attempts happened more than specified we do not try to remove node again

    if (elementRemovalsCounter > MAX_STYLE_PROTECTION_COUNT) {
      utils.logError('ExtendedCss: infinite loop protection for SELECTOR', elementSelector);
      return;
    }

    if (node.parentNode) {
      node.parentNode.removeChild(node);
      removalsStatistic[elementSelector] = elementRemovalsCounter + 1;
    }
  }
  /**
   * Applies style to the specified DOM node
   * @param affectedElement Object containing DOM node and rule to be applied
   */


  function applyStyle(affectedElement) {
    if (affectedElement.protectionObserver) {
      // Style is already applied and protected by the observer
      return;
    }

    if (beforeStyleApplied) {
      affectedElement = beforeStyleApplied(affectedElement);

      if (!affectedElement) {
        return;
      }
    }

    var _affectedElement = affectedElement,
        node = _affectedElement.node;

    for (var i = 0; i < affectedElement.rules.length; i++) {
      var style = affectedElement.rules[i].style;

      if (style['remove'] === 'true') {
        removeElement(affectedElement);
        return;
      }

      setStyleToElement(node, style);
    }
  }
  /**
   * Sets style to the specified DOM node
   * @param node element
   * @param style style
   */


  function setStyleToElement(node, style) {
    Object.keys(style).forEach(function (prop) {
      // Apply this style only to existing properties
      // We can't use hasOwnProperty here (does not work in FF)
      if (typeof node.style.getPropertyValue(prop) !== 'undefined') {
        var value = style[prop]; // First we should remove !important attribute (or it won't be applied')

        value = removeSuffix(value.trim(), '!important').trim();
        node.style.setProperty(prop, value, 'important');
      }
    });
  }
  /**
   * Reverts style for the affected object
   */


  function revertStyle(affectedElement) {
    if (affectedElement.protectionObserver) {
      affectedElement.protectionObserver.disconnect();
    }

    affectedElement.node.style.cssText = affectedElement.originalStyle;
  }
  /**
   * Applies specified rule and returns list of elements affected
   * @param rule Rule to apply
   * @returns List of elements affected by this rule
   */


  function applyRule(rule) {
    var debug = rule.selector.isDebugging();
    var start;

    if (debug) {
      start = utils.AsyncWrapper.now();
    }

    var selector = rule.selector;
    var nodes = selector.querySelectorAll();
    nodes.forEach(function (node) {
      var affectedElement = findAffectedElement(node);

      if (affectedElement) {
        affectedElement.rules.push(rule);
        applyStyle(affectedElement);
      } else {
        // Applying style first time
        var originalStyle = node.style.cssText;
        affectedElement = {
          node: node,
          // affected DOM node
          rules: [rule],
          // rules to be applied
          originalStyle: originalStyle,
          // original node style
          protectionObserver: null // style attribute observer

        };
        applyStyle(affectedElement);
        affectedElements.push(affectedElement);
      }
    });

    if (debug) {
      var elapsed = utils.AsyncWrapper.now() - start;

      if (!('timingStats' in rule)) {
        rule.timingStats = new utils.Stats();
      }

      rule.timingStats.push(elapsed);
    }

    return nodes;
  }
  /**
   * Applies filtering rules
   */


  function applyRules() {
    var elementsIndex = []; // some rules could make call - selector.querySelectorAll() temporarily to change node id attribute
    // this caused MutationObserver to call recursively
    // https://github.com/AdguardTeam/ExtendedCss/issues/81

    stopObserve();
    rules.forEach(function (rule) {
      var nodes = applyRule(rule);
      Array.prototype.push.apply(elementsIndex, nodes);
    }); // Now revert styles for elements which are no more affected

    var l = affectedElements.length; // do nothing if there is no elements to process

    if (elementsIndex.length > 0) {
      while (l--) {
        var obj = affectedElements[l];

        if (elementsIndex.indexOf(obj.node) === -1) {
          // Time to revert style
          revertStyle(obj);
          affectedElements.splice(l, 1);
        } else if (!obj.removed) {
          // Add style protection observer
          // Protect "style" attribute from changes
          if (!obj.protectionObserver) {
            obj.protectionObserver = protectStyleAttribute(obj.node, obj.rules);
          }
        }
      }
    } // After styles are applied we can start observe again


    observe();
    printTimingInfo();
  }

  var APPLY_RULES_DELAY = 150;
  var applyRulesScheduler = new utils.AsyncWrapper(applyRules, APPLY_RULES_DELAY);
  var mainCallback = applyRulesScheduler.run.bind(applyRulesScheduler);

  function observe() {
    if (domObserved) {
      return;
    } // Handle dynamically added elements


    domObserved = true;
    observeDocument(mainCallback);
  }

  function stopObserve() {
    if (!domObserved) {
      return;
    }

    domObserved = false;
    disconnectDocument(mainCallback);
  }

  function apply() {
    applyRules();

    if (document.readyState !== 'complete') {
      document.addEventListener('DOMContentLoaded', applyRules);
    }
  }
  /**
   * Disposes ExtendedCss and removes our styles from matched elements
   */


  function dispose() {
    stopObserve();
    affectedElements.forEach(function (obj) {
      revertStyle(obj);
    });
  }

  var timingsPrinted = false;
  /**
   * Prints timing information for all selectors marked as "debug"
   */

  function printTimingInfo() {
    if (timingsPrinted) {
      return;
    }

    timingsPrinted = true;
    var timings = rules.filter(function (rule) {
      return rule.selector.isDebugging();
    }).map(function (rule) {
      return {
        selectorText: rule.selector.selectorText,
        timingStats: rule.timingStats
      };
    });

    if (timings.length === 0) {
      return;
    } // Add location.href to the message to distinguish frames


    utils.logInfo('[ExtendedCss] Timings for %o:\n%o (in milliseconds)', window.location.href, timings);
  } // First of all parse the stylesheet


  rules = ExtendedCssParser.parseCss(styleSheet); // EXPOSE

  this.dispose = dispose;
  this.apply = apply;
  /** Exposed for testing purposes only */

  this._getAffectedElements = function () {
    return affectedElements;
  };
}
/**
 * Expose querySelectorAll for debugging and validating selectors
 *
 * @param {string} selectorText selector text
 * @param {boolean} noTiming if true -- do not print the timing to the console
 * @returns {Array<Node>|NodeList} a list of elements found
 * @throws Will throw an error if the argument is not a valid selector
 */


ExtendedCss.query = function (selectorText, noTiming) {
  if (typeof selectorText !== 'string') {
    throw new Error('Selector text is empty');
  }

  var now = utils.AsyncWrapper.now;
  var start = now();

  try {
    return ExtendedSelectorFactory.createSelector(selectorText).querySelectorAll();
  } finally {
    var end = now();

    if (!noTiming) {
      utils.logInfo("[ExtendedCss] Elapsed: ".concat(Math.round((end - start) * 1000), " \u03BCs."));
    }
  }
};

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ExtendedCss);


/***/ }),

/***/ "./node_modules/regenerator-runtime/runtime.js":
/*!*****************************************************!*\
  !*** ./node_modules/regenerator-runtime/runtime.js ***!
  \*****************************************************/
/***/ ((module) => {

/**
 * Copyright (c) 2014-present, Facebook, Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */

var runtime = (function (exports) {
  "use strict";

  var Op = Object.prototype;
  var hasOwn = Op.hasOwnProperty;
  var undefined; // More compressible than void 0.
  var $Symbol = typeof Symbol === "function" ? Symbol : {};
  var iteratorSymbol = $Symbol.iterator || "@@iterator";
  var asyncIteratorSymbol = $Symbol.asyncIterator || "@@asyncIterator";
  var toStringTagSymbol = $Symbol.toStringTag || "@@toStringTag";

  function define(obj, key, value) {
    Object.defineProperty(obj, key, {
      value: value,
      enumerable: true,
      configurable: true,
      writable: true
    });
    return obj[key];
  }
  try {
    // IE 8 has a broken Object.defineProperty that only works on DOM objects.
    define({}, "");
  } catch (err) {
    define = function(obj, key, value) {
      return obj[key] = value;
    };
  }

  function wrap(innerFn, outerFn, self, tryLocsList) {
    // If outerFn provided and outerFn.prototype is a Generator, then outerFn.prototype instanceof Generator.
    var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator;
    var generator = Object.create(protoGenerator.prototype);
    var context = new Context(tryLocsList || []);

    // The ._invoke method unifies the implementations of the .next,
    // .throw, and .return methods.
    generator._invoke = makeInvokeMethod(innerFn, self, context);

    return generator;
  }
  exports.wrap = wrap;

  // Try/catch helper to minimize deoptimizations. Returns a completion
  // record like context.tryEntries[i].completion. This interface could
  // have been (and was previously) designed to take a closure to be
  // invoked without arguments, but in all the cases we care about we
  // already have an existing method we want to call, so there's no need
  // to create a new function object. We can even get away with assuming
  // the method takes exactly one argument, since that happens to be true
  // in every case, so we don't have to touch the arguments object. The
  // only additional allocation required is the completion record, which
  // has a stable shape and so hopefully should be cheap to allocate.
  function tryCatch(fn, obj, arg) {
    try {
      return { type: "normal", arg: fn.call(obj, arg) };
    } catch (err) {
      return { type: "throw", arg: err };
    }
  }

  var GenStateSuspendedStart = "suspendedStart";
  var GenStateSuspendedYield = "suspendedYield";
  var GenStateExecuting = "executing";
  var GenStateCompleted = "completed";

  // Returning this object from the innerFn has the same effect as
  // breaking out of the dispatch switch statement.
  var ContinueSentinel = {};

  // Dummy constructor functions that we use as the .constructor and
  // .constructor.prototype properties for functions that return Generator
  // objects. For full spec compliance, you may wish to configure your
  // minifier not to mangle the names of these two functions.
  function Generator() {}
  function GeneratorFunction() {}
  function GeneratorFunctionPrototype() {}

  // This is a polyfill for %IteratorPrototype% for environments that
  // don't natively support it.
  var IteratorPrototype = {};
  IteratorPrototype[iteratorSymbol] = function () {
    return this;
  };

  var getProto = Object.getPrototypeOf;
  var NativeIteratorPrototype = getProto && getProto(getProto(values([])));
  if (NativeIteratorPrototype &&
      NativeIteratorPrototype !== Op &&
      hasOwn.call(NativeIteratorPrototype, iteratorSymbol)) {
    // This environment has a native %IteratorPrototype%; use it instead
    // of the polyfill.
    IteratorPrototype = NativeIteratorPrototype;
  }

  var Gp = GeneratorFunctionPrototype.prototype =
    Generator.prototype = Object.create(IteratorPrototype);
  GeneratorFunction.prototype = Gp.constructor = GeneratorFunctionPrototype;
  GeneratorFunctionPrototype.constructor = GeneratorFunction;
  GeneratorFunction.displayName = define(
    GeneratorFunctionPrototype,
    toStringTagSymbol,
    "GeneratorFunction"
  );

  // Helper for defining the .next, .throw, and .return methods of the
  // Iterator interface in terms of a single ._invoke method.
  function defineIteratorMethods(prototype) {
    ["next", "throw", "return"].forEach(function(method) {
      define(prototype, method, function(arg) {
        return this._invoke(method, arg);
      });
    });
  }

  exports.isGeneratorFunction = function(genFun) {
    var ctor = typeof genFun === "function" && genFun.constructor;
    return ctor
      ? ctor === GeneratorFunction ||
        // For the native GeneratorFunction constructor, the best we can
        // do is to check its .name property.
        (ctor.displayName || ctor.name) === "GeneratorFunction"
      : false;
  };

  exports.mark = function(genFun) {
    if (Object.setPrototypeOf) {
      Object.setPrototypeOf(genFun, GeneratorFunctionPrototype);
    } else {
      genFun.__proto__ = GeneratorFunctionPrototype;
      define(genFun, toStringTagSymbol, "GeneratorFunction");
    }
    genFun.prototype = Object.create(Gp);
    return genFun;
  };

  // Within the body of any async function, `await x` is transformed to
  // `yield regeneratorRuntime.awrap(x)`, so that the runtime can test
  // `hasOwn.call(value, "__await")` to determine if the yielded value is
  // meant to be awaited.
  exports.awrap = function(arg) {
    return { __await: arg };
  };

  function AsyncIterator(generator, PromiseImpl) {
    function invoke(method, arg, resolve, reject) {
      var record = tryCatch(generator[method], generator, arg);
      if (record.type === "throw") {
        reject(record.arg);
      } else {
        var result = record.arg;
        var value = result.value;
        if (value &&
            typeof value === "object" &&
            hasOwn.call(value, "__await")) {
          return PromiseImpl.resolve(value.__await).then(function(value) {
            invoke("next", value, resolve, reject);
          }, function(err) {
            invoke("throw", err, resolve, reject);
          });
        }

        return PromiseImpl.resolve(value).then(function(unwrapped) {
          // When a yielded Promise is resolved, its final value becomes
          // the .value of the Promise<{value,done}> result for the
          // current iteration.
          result.value = unwrapped;
          resolve(result);
        }, function(error) {
          // If a rejected Promise was yielded, throw the rejection back
          // into the async generator function so it can be handled there.
          return invoke("throw", error, resolve, reject);
        });
      }
    }

    var previousPromise;

    function enqueue(method, arg) {
      function callInvokeWithMethodAndArg() {
        return new PromiseImpl(function(resolve, reject) {
          invoke(method, arg, resolve, reject);
        });
      }

      return previousPromise =
        // If enqueue has been called before, then we want to wait until
        // all previous Promises have been resolved before calling invoke,
        // so that results are always delivered in the correct order. If
        // enqueue has not been called before, then it is important to
        // call invoke immediately, without waiting on a callback to fire,
        // so that the async generator function has the opportunity to do
        // any necessary setup in a predictable way. This predictability
        // is why the Promise constructor synchronously invokes its
        // executor callback, and why async functions synchronously
        // execute code before the first await. Since we implement simple
        // async functions in terms of async generators, it is especially
        // important to get this right, even though it requires care.
        previousPromise ? previousPromise.then(
          callInvokeWithMethodAndArg,
          // Avoid propagating failures to Promises returned by later
          // invocations of the iterator.
          callInvokeWithMethodAndArg
        ) : callInvokeWithMethodAndArg();
    }

    // Define the unified helper method that is used to implement .next,
    // .throw, and .return (see defineIteratorMethods).
    this._invoke = enqueue;
  }

  defineIteratorMethods(AsyncIterator.prototype);
  AsyncIterator.prototype[asyncIteratorSymbol] = function () {
    return this;
  };
  exports.AsyncIterator = AsyncIterator;

  // Note that simple async functions are implemented on top of
  // AsyncIterator objects; they just return a Promise for the value of
  // the final result produced by the iterator.
  exports.async = function(innerFn, outerFn, self, tryLocsList, PromiseImpl) {
    if (PromiseImpl === void 0) PromiseImpl = Promise;

    var iter = new AsyncIterator(
      wrap(innerFn, outerFn, self, tryLocsList),
      PromiseImpl
    );

    return exports.isGeneratorFunction(outerFn)
      ? iter // If outerFn is a generator, return the full iterator.
      : iter.next().then(function(result) {
          return result.done ? result.value : iter.next();
        });
  };

  function makeInvokeMethod(innerFn, self, context) {
    var state = GenStateSuspendedStart;

    return function invoke(method, arg) {
      if (state === GenStateExecuting) {
        throw new Error("Generator is already running");
      }

      if (state === GenStateCompleted) {
        if (method === "throw") {
          throw arg;
        }

        // Be forgiving, per 25.3.3.3.3 of the spec:
        // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume
        return doneResult();
      }

      context.method = method;
      context.arg = arg;

      while (true) {
        var delegate = context.delegate;
        if (delegate) {
          var delegateResult = maybeInvokeDelegate(delegate, context);
          if (delegateResult) {
            if (delegateResult === ContinueSentinel) continue;
            return delegateResult;
          }
        }

        if (context.method === "next") {
          // Setting context._sent for legacy support of Babel's
          // function.sent implementation.
          context.sent = context._sent = context.arg;

        } else if (context.method === "throw") {
          if (state === GenStateSuspendedStart) {
            state = GenStateCompleted;
            throw context.arg;
          }

          context.dispatchException(context.arg);

        } else if (context.method === "return") {
          context.abrupt("return", context.arg);
        }

        state = GenStateExecuting;

        var record = tryCatch(innerFn, self, context);
        if (record.type === "normal") {
          // If an exception is thrown from innerFn, we leave state ===
          // GenStateExecuting and loop back for another invocation.
          state = context.done
            ? GenStateCompleted
            : GenStateSuspendedYield;

          if (record.arg === ContinueSentinel) {
            continue;
          }

          return {
            value: record.arg,
            done: context.done
          };

        } else if (record.type === "throw") {
          state = GenStateCompleted;
          // Dispatch the exception by looping back around to the
          // context.dispatchException(context.arg) call above.
          context.method = "throw";
          context.arg = record.arg;
        }
      }
    };
  }

  // Call delegate.iterator[context.method](context.arg) and handle the
  // result, either by returning a { value, done } result from the
  // delegate iterator, or by modifying context.method and context.arg,
  // setting context.delegate to null, and returning the ContinueSentinel.
  function maybeInvokeDelegate(delegate, context) {
    var method = delegate.iterator[context.method];
    if (method === undefined) {
      // A .throw or .return when the delegate iterator has no .throw
      // method always terminates the yield* loop.
      context.delegate = null;

      if (context.method === "throw") {
        // Note: ["return"] must be used for ES3 parsing compatibility.
        if (delegate.iterator["return"]) {
          // If the delegate iterator has a return method, give it a
          // chance to clean up.
          context.method = "return";
          context.arg = undefined;
          maybeInvokeDelegate(delegate, context);

          if (context.method === "throw") {
            // If maybeInvokeDelegate(context) changed context.method from
            // "return" to "throw", let that override the TypeError below.
            return ContinueSentinel;
          }
        }

        context.method = "throw";
        context.arg = new TypeError(
          "The iterator does not provide a 'throw' method");
      }

      return ContinueSentinel;
    }

    var record = tryCatch(method, delegate.iterator, context.arg);

    if (record.type === "throw") {
      context.method = "throw";
      context.arg = record.arg;
      context.delegate = null;
      return ContinueSentinel;
    }

    var info = record.arg;

    if (! info) {
      context.method = "throw";
      context.arg = new TypeError("iterator result is not an object");
      context.delegate = null;
      return ContinueSentinel;
    }

    if (info.done) {
      // Assign the result of the finished delegate to the temporary
      // variable specified by delegate.resultName (see delegateYield).
      context[delegate.resultName] = info.value;

      // Resume execution at the desired location (see delegateYield).
      context.next = delegate.nextLoc;

      // If context.method was "throw" but the delegate handled the
      // exception, let the outer generator proceed normally. If
      // context.method was "next", forget context.arg since it has been
      // "consumed" by the delegate iterator. If context.method was
      // "return", allow the original .return call to continue in the
      // outer generator.
      if (context.method !== "return") {
        context.method = "next";
        context.arg = undefined;
      }

    } else {
      // Re-yield the result returned by the delegate method.
      return info;
    }

    // The delegate iterator is finished, so forget it and continue with
    // the outer generator.
    context.delegate = null;
    return ContinueSentinel;
  }

  // Define Generator.prototype.{next,throw,return} in terms of the
  // unified ._invoke helper method.
  defineIteratorMethods(Gp);

  define(Gp, toStringTagSymbol, "Generator");

  // A Generator should always return itself as the iterator object when the
  // @@iterator function is called on it. Some browsers' implementations of the
  // iterator prototype chain incorrectly implement this, causing the Generator
  // object to not be returned from this call. This ensures that doesn't happen.
  // See https://github.com/facebook/regenerator/issues/274 for more details.
  Gp[iteratorSymbol] = function() {
    return this;
  };

  Gp.toString = function() {
    return "[object Generator]";
  };

  function pushTryEntry(locs) {
    var entry = { tryLoc: locs[0] };

    if (1 in locs) {
      entry.catchLoc = locs[1];
    }

    if (2 in locs) {
      entry.finallyLoc = locs[2];
      entry.afterLoc = locs[3];
    }

    this.tryEntries.push(entry);
  }

  function resetTryEntry(entry) {
    var record = entry.completion || {};
    record.type = "normal";
    delete record.arg;
    entry.completion = record;
  }

  function Context(tryLocsList) {
    // The root entry object (effectively a try statement without a catch
    // or a finally block) gives us a place to store values thrown from
    // locations where there is no enclosing try statement.
    this.tryEntries = [{ tryLoc: "root" }];
    tryLocsList.forEach(pushTryEntry, this);
    this.reset(true);
  }

  exports.keys = function(object) {
    var keys = [];
    for (var key in object) {
      keys.push(key);
    }
    keys.reverse();

    // Rather than returning an object with a next method, we keep
    // things simple and return the next function itself.
    return function next() {
      while (keys.length) {
        var key = keys.pop();
        if (key in object) {
          next.value = key;
          next.done = false;
          return next;
        }
      }

      // To avoid creating an additional object, we just hang the .value
      // and .done properties off the next function object itself. This
      // also ensures that the minifier will not anonymize the function.
      next.done = true;
      return next;
    };
  };

  function values(iterable) {
    if (iterable) {
      var iteratorMethod = iterable[iteratorSymbol];
      if (iteratorMethod) {
        return iteratorMethod.call(iterable);
      }

      if (typeof iterable.next === "function") {
        return iterable;
      }

      if (!isNaN(iterable.length)) {
        var i = -1, next = function next() {
          while (++i < iterable.length) {
            if (hasOwn.call(iterable, i)) {
              next.value = iterable[i];
              next.done = false;
              return next;
            }
          }

          next.value = undefined;
          next.done = true;

          return next;
        };

        return next.next = next;
      }
    }

    // Return an iterator with no values.
    return { next: doneResult };
  }
  exports.values = values;

  function doneResult() {
    return { value: undefined, done: true };
  }

  Context.prototype = {
    constructor: Context,

    reset: function(skipTempReset) {
      this.prev = 0;
      this.next = 0;
      // Resetting context._sent for legacy support of Babel's
      // function.sent implementation.
      this.sent = this._sent = undefined;
      this.done = false;
      this.delegate = null;

      this.method = "next";
      this.arg = undefined;

      this.tryEntries.forEach(resetTryEntry);

      if (!skipTempReset) {
        for (var name in this) {
          // Not sure about the optimal order of these conditions:
          if (name.charAt(0) === "t" &&
              hasOwn.call(this, name) &&
              !isNaN(+name.slice(1))) {
            this[name] = undefined;
          }
        }
      }
    },

    stop: function() {
      this.done = true;

      var rootEntry = this.tryEntries[0];
      var rootRecord = rootEntry.completion;
      if (rootRecord.type === "throw") {
        throw rootRecord.arg;
      }

      return this.rval;
    },

    dispatchException: function(exception) {
      if (this.done) {
        throw exception;
      }

      var context = this;
      function handle(loc, caught) {
        record.type = "throw";
        record.arg = exception;
        context.next = loc;

        if (caught) {
          // If the dispatched exception was caught by a catch block,
          // then let that catch block handle the exception normally.
          context.method = "next";
          context.arg = undefined;
        }

        return !! caught;
      }

      for (var i = this.tryEntries.length - 1; i >= 0; --i) {
        var entry = this.tryEntries[i];
        var record = entry.completion;

        if (entry.tryLoc === "root") {
          // Exception thrown outside of any try block that could handle
          // it, so set the completion value of the entire function to
          // throw the exception.
          return handle("end");
        }

        if (entry.tryLoc <= this.prev) {
          var hasCatch = hasOwn.call(entry, "catchLoc");
          var hasFinally = hasOwn.call(entry, "finallyLoc");

          if (hasCatch && hasFinally) {
            if (this.prev < entry.catchLoc) {
              return handle(entry.catchLoc, true);
            } else if (this.prev < entry.finallyLoc) {
              return handle(entry.finallyLoc);
            }

          } else if (hasCatch) {
            if (this.prev < entry.catchLoc) {
              return handle(entry.catchLoc, true);
            }

          } else if (hasFinally) {
            if (this.prev < entry.finallyLoc) {
              return handle(entry.finallyLoc);
            }

          } else {
            throw new Error("try statement without catch or finally");
          }
        }
      }
    },

    abrupt: function(type, arg) {
      for (var i = this.tryEntries.length - 1; i >= 0; --i) {
        var entry = this.tryEntries[i];
        if (entry.tryLoc <= this.prev &&
            hasOwn.call(entry, "finallyLoc") &&
            this.prev < entry.finallyLoc) {
          var finallyEntry = entry;
          break;
        }
      }

      if (finallyEntry &&
          (type === "break" ||
           type === "continue") &&
          finallyEntry.tryLoc <= arg &&
          arg <= finallyEntry.finallyLoc) {
        // Ignore the finally entry if control is not jumping to a
        // location outside the try/catch block.
        finallyEntry = null;
      }

      var record = finallyEntry ? finallyEntry.completion : {};
      record.type = type;
      record.arg = arg;

      if (finallyEntry) {
        this.method = "next";
        this.next = finallyEntry.finallyLoc;
        return ContinueSentinel;
      }

      return this.complete(record);
    },

    complete: function(record, afterLoc) {
      if (record.type === "throw") {
        throw record.arg;
      }

      if (record.type === "break" ||
          record.type === "continue") {
        this.next = record.arg;
      } else if (record.type === "return") {
        this.rval = this.arg = record.arg;
        this.method = "return";
        this.next = "end";
      } else if (record.type === "normal" && afterLoc) {
        this.next = afterLoc;
      }

      return ContinueSentinel;
    },

    finish: function(finallyLoc) {
      for (var i = this.tryEntries.length - 1; i >= 0; --i) {
        var entry = this.tryEntries[i];
        if (entry.finallyLoc === finallyLoc) {
          this.complete(entry.completion, entry.afterLoc);
          resetTryEntry(entry);
          return ContinueSentinel;
        }
      }
    },

    "catch": function(tryLoc) {
      for (var i = this.tryEntries.length - 1; i >= 0; --i) {
        var entry = this.tryEntries[i];
        if (entry.tryLoc === tryLoc) {
          var record = entry.completion;
          if (record.type === "throw") {
            var thrown = record.arg;
            resetTryEntry(entry);
          }
          return thrown;
        }
      }

      // The context.catch method must only be called with a location
      // argument that corresponds to a known catch block.
      throw new Error("illegal catch attempt");
    },

    delegateYield: function(iterable, resultName, nextLoc) {
      this.delegate = {
        iterator: values(iterable),
        resultName: resultName,
        nextLoc: nextLoc
      };

      if (this.method === "next") {
        // Deliberately forget the last sent value so that we don't
        // accidentally pass it on to the delegate.
        this.arg = undefined;
      }

      return ContinueSentinel;
    }
  };

  // Regardless of whether this script is executing as a CommonJS module
  // or not, return the runtime object so that we can declare the variable
  // regeneratorRuntime in the outer scope, which allows this module to be
  // injected easily by `bin/regenerator --include-runtime script.js`.
  return exports;

}(
  // If this script is executing as a CommonJS module, use module.exports
  // as the regeneratorRuntime namespace. Otherwise create a new empty
  // object. Either way, the resulting object will be used to initialize
  // the regeneratorRuntime variable at the top of this file.
   true ? module.exports : 0
));

try {
  regeneratorRuntime = runtime;
} catch (accidentalStrictMode) {
  // This module should not be running in strict mode, so the above
  // assignment should always work unless something is misconfigured. Just
  // in case runtime.js accidentally runs in strict mode, we can escape
  // strict mode using a global Function call. This could conceivably fail
  // if a Content Security Policy forbids using Function, but in that case
  // the proper solution is to fix the accidental strict mode problem. If
  // you've misconfigured your bundler to force strict mode and applied a
  // CSP to forbid Function, and you're not willing to fix either of those
  // problems, please detail your unique predicament in a GitHub issue.
  Function("r", "regeneratorRuntime = r")(runtime);
}


/***/ }),

/***/ "./node_modules/webextension-polyfill-ts/lib/index.js":
/*!************************************************************!*\
  !*** ./node_modules/webextension-polyfill-ts/lib/index.js ***!
  \************************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

"use strict";

Object.defineProperty(exports, "__esModule", ({ value: true }));

exports.browser = __webpack_require__(/*! webextension-polyfill */ "./node_modules/webextension-polyfill/dist/browser-polyfill.js");


/***/ }),

/***/ "./node_modules/webextension-polyfill/dist/browser-polyfill.js":
/*!*********************************************************************!*\
  !*** ./node_modules/webextension-polyfill/dist/browser-polyfill.js ***!
  \*********************************************************************/
/***/ (function(module, exports) {

var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;(function (global, factory) {
  if (true) {
    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [module], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),
		__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?
		(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),
		__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));
  } else { var mod; }
})(typeof globalThis !== "undefined" ? globalThis : typeof self !== "undefined" ? self : this, function (module) {
  /* webextension-polyfill - v0.7.0 - Tue Nov 10 2020 20:24:04 */

  /* -*- Mode: indent-tabs-mode: nil; js-indent-level: 2 -*- */

  /* vim: set sts=2 sw=2 et tw=80: */

  /* This Source Code Form is subject to the terms of the Mozilla Public
   * License, v. 2.0. If a copy of the MPL was not distributed with this
   * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
  "use strict";

  if (typeof browser === "undefined" || Object.getPrototypeOf(browser) !== Object.prototype) {
    const CHROME_SEND_MESSAGE_CALLBACK_NO_RESPONSE_MESSAGE = "The message port closed before a response was received.";
    const SEND_RESPONSE_DEPRECATION_WARNING = "Returning a Promise is the preferred way to send a reply from an onMessage/onMessageExternal listener, as the sendResponse will be removed from the specs (See https://developer.mozilla.org/docs/Mozilla/Add-ons/WebExtensions/API/runtime/onMessage)"; // Wrapping the bulk of this polyfill in a one-time-use function is a minor
    // optimization for Firefox. Since Spidermonkey does not fully parse the
    // contents of a function until the first time it's called, and since it will
    // never actually need to be called, this allows the polyfill to be included
    // in Firefox nearly for free.

    const wrapAPIs = extensionAPIs => {
      // NOTE: apiMetadata is associated to the content of the api-metadata.json file
      // at build time by replacing the following "include" with the content of the
      // JSON file.
      const apiMetadata = {
        "alarms": {
          "clear": {
            "minArgs": 0,
            "maxArgs": 1
          },
          "clearAll": {
            "minArgs": 0,
            "maxArgs": 0
          },
          "get": {
            "minArgs": 0,
            "maxArgs": 1
          },
          "getAll": {
            "minArgs": 0,
            "maxArgs": 0
          }
        },
        "bookmarks": {
          "create": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "get": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "getChildren": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "getRecent": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "getSubTree": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "getTree": {
            "minArgs": 0,
            "maxArgs": 0
          },
          "move": {
            "minArgs": 2,
            "maxArgs": 2
          },
          "remove": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "removeTree": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "search": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "update": {
            "minArgs": 2,
            "maxArgs": 2
          }
        },
        "browserAction": {
          "disable": {
            "minArgs": 0,
            "maxArgs": 1,
            "fallbackToNoCallback": true
          },
          "enable": {
            "minArgs": 0,
            "maxArgs": 1,
            "fallbackToNoCallback": true
          },
          "getBadgeBackgroundColor": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "getBadgeText": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "getPopup": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "getTitle": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "openPopup": {
            "minArgs": 0,
            "maxArgs": 0
          },
          "setBadgeBackgroundColor": {
            "minArgs": 1,
            "maxArgs": 1,
            "fallbackToNoCallback": true
          },
          "setBadgeText": {
            "minArgs": 1,
            "maxArgs": 1,
            "fallbackToNoCallback": true
          },
          "setIcon": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "setPopup": {
            "minArgs": 1,
            "maxArgs": 1,
            "fallbackToNoCallback": true
          },
          "setTitle": {
            "minArgs": 1,
            "maxArgs": 1,
            "fallbackToNoCallback": true
          }
        },
        "browsingData": {
          "remove": {
            "minArgs": 2,
            "maxArgs": 2
          },
          "removeCache": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "removeCookies": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "removeDownloads": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "removeFormData": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "removeHistory": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "removeLocalStorage": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "removePasswords": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "removePluginData": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "settings": {
            "minArgs": 0,
            "maxArgs": 0
          }
        },
        "commands": {
          "getAll": {
            "minArgs": 0,
            "maxArgs": 0
          }
        },
        "contextMenus": {
          "remove": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "removeAll": {
            "minArgs": 0,
            "maxArgs": 0
          },
          "update": {
            "minArgs": 2,
            "maxArgs": 2
          }
        },
        "cookies": {
          "get": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "getAll": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "getAllCookieStores": {
            "minArgs": 0,
            "maxArgs": 0
          },
          "remove": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "set": {
            "minArgs": 1,
            "maxArgs": 1
          }
        },
        "devtools": {
          "inspectedWindow": {
            "eval": {
              "minArgs": 1,
              "maxArgs": 2,
              "singleCallbackArg": false
            }
          },
          "panels": {
            "create": {
              "minArgs": 3,
              "maxArgs": 3,
              "singleCallbackArg": true
            },
            "elements": {
              "createSidebarPane": {
                "minArgs": 1,
                "maxArgs": 1
              }
            }
          }
        },
        "downloads": {
          "cancel": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "download": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "erase": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "getFileIcon": {
            "minArgs": 1,
            "maxArgs": 2
          },
          "open": {
            "minArgs": 1,
            "maxArgs": 1,
            "fallbackToNoCallback": true
          },
          "pause": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "removeFile": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "resume": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "search": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "show": {
            "minArgs": 1,
            "maxArgs": 1,
            "fallbackToNoCallback": true
          }
        },
        "extension": {
          "isAllowedFileSchemeAccess": {
            "minArgs": 0,
            "maxArgs": 0
          },
          "isAllowedIncognitoAccess": {
            "minArgs": 0,
            "maxArgs": 0
          }
        },
        "history": {
          "addUrl": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "deleteAll": {
            "minArgs": 0,
            "maxArgs": 0
          },
          "deleteRange": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "deleteUrl": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "getVisits": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "search": {
            "minArgs": 1,
            "maxArgs": 1
          }
        },
        "i18n": {
          "detectLanguage": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "getAcceptLanguages": {
            "minArgs": 0,
            "maxArgs": 0
          }
        },
        "identity": {
          "launchWebAuthFlow": {
            "minArgs": 1,
            "maxArgs": 1
          }
        },
        "idle": {
          "queryState": {
            "minArgs": 1,
            "maxArgs": 1
          }
        },
        "management": {
          "get": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "getAll": {
            "minArgs": 0,
            "maxArgs": 0
          },
          "getSelf": {
            "minArgs": 0,
            "maxArgs": 0
          },
          "setEnabled": {
            "minArgs": 2,
            "maxArgs": 2
          },
          "uninstallSelf": {
            "minArgs": 0,
            "maxArgs": 1
          }
        },
        "notifications": {
          "clear": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "create": {
            "minArgs": 1,
            "maxArgs": 2
          },
          "getAll": {
            "minArgs": 0,
            "maxArgs": 0
          },
          "getPermissionLevel": {
            "minArgs": 0,
            "maxArgs": 0
          },
          "update": {
            "minArgs": 2,
            "maxArgs": 2
          }
        },
        "pageAction": {
          "getPopup": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "getTitle": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "hide": {
            "minArgs": 1,
            "maxArgs": 1,
            "fallbackToNoCallback": true
          },
          "setIcon": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "setPopup": {
            "minArgs": 1,
            "maxArgs": 1,
            "fallbackToNoCallback": true
          },
          "setTitle": {
            "minArgs": 1,
            "maxArgs": 1,
            "fallbackToNoCallback": true
          },
          "show": {
            "minArgs": 1,
            "maxArgs": 1,
            "fallbackToNoCallback": true
          }
        },
        "permissions": {
          "contains": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "getAll": {
            "minArgs": 0,
            "maxArgs": 0
          },
          "remove": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "request": {
            "minArgs": 1,
            "maxArgs": 1
          }
        },
        "runtime": {
          "getBackgroundPage": {
            "minArgs": 0,
            "maxArgs": 0
          },
          "getPlatformInfo": {
            "minArgs": 0,
            "maxArgs": 0
          },
          "openOptionsPage": {
            "minArgs": 0,
            "maxArgs": 0
          },
          "requestUpdateCheck": {
            "minArgs": 0,
            "maxArgs": 0
          },
          "sendMessage": {
            "minArgs": 1,
            "maxArgs": 3
          },
          "sendNativeMessage": {
            "minArgs": 2,
            "maxArgs": 2
          },
          "setUninstallURL": {
            "minArgs": 1,
            "maxArgs": 1
          }
        },
        "sessions": {
          "getDevices": {
            "minArgs": 0,
            "maxArgs": 1
          },
          "getRecentlyClosed": {
            "minArgs": 0,
            "maxArgs": 1
          },
          "restore": {
            "minArgs": 0,
            "maxArgs": 1
          }
        },
        "storage": {
          "local": {
            "clear": {
              "minArgs": 0,
              "maxArgs": 0
            },
            "get": {
              "minArgs": 0,
              "maxArgs": 1
            },
            "getBytesInUse": {
              "minArgs": 0,
              "maxArgs": 1
            },
            "remove": {
              "minArgs": 1,
              "maxArgs": 1
            },
            "set": {
              "minArgs": 1,
              "maxArgs": 1
            }
          },
          "managed": {
            "get": {
              "minArgs": 0,
              "maxArgs": 1
            },
            "getBytesInUse": {
              "minArgs": 0,
              "maxArgs": 1
            }
          },
          "sync": {
            "clear": {
              "minArgs": 0,
              "maxArgs": 0
            },
            "get": {
              "minArgs": 0,
              "maxArgs": 1
            },
            "getBytesInUse": {
              "minArgs": 0,
              "maxArgs": 1
            },
            "remove": {
              "minArgs": 1,
              "maxArgs": 1
            },
            "set": {
              "minArgs": 1,
              "maxArgs": 1
            }
          }
        },
        "tabs": {
          "captureVisibleTab": {
            "minArgs": 0,
            "maxArgs": 2
          },
          "create": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "detectLanguage": {
            "minArgs": 0,
            "maxArgs": 1
          },
          "discard": {
            "minArgs": 0,
            "maxArgs": 1
          },
          "duplicate": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "executeScript": {
            "minArgs": 1,
            "maxArgs": 2
          },
          "get": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "getCurrent": {
            "minArgs": 0,
            "maxArgs": 0
          },
          "getZoom": {
            "minArgs": 0,
            "maxArgs": 1
          },
          "getZoomSettings": {
            "minArgs": 0,
            "maxArgs": 1
          },
          "goBack": {
            "minArgs": 0,
            "maxArgs": 1
          },
          "goForward": {
            "minArgs": 0,
            "maxArgs": 1
          },
          "highlight": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "insertCSS": {
            "minArgs": 1,
            "maxArgs": 2
          },
          "move": {
            "minArgs": 2,
            "maxArgs": 2
          },
          "query": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "reload": {
            "minArgs": 0,
            "maxArgs": 2
          },
          "remove": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "removeCSS": {
            "minArgs": 1,
            "maxArgs": 2
          },
          "sendMessage": {
            "minArgs": 2,
            "maxArgs": 3
          },
          "setZoom": {
            "minArgs": 1,
            "maxArgs": 2
          },
          "setZoomSettings": {
            "minArgs": 1,
            "maxArgs": 2
          },
          "update": {
            "minArgs": 1,
            "maxArgs": 2
          }
        },
        "topSites": {
          "get": {
            "minArgs": 0,
            "maxArgs": 0
          }
        },
        "webNavigation": {
          "getAllFrames": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "getFrame": {
            "minArgs": 1,
            "maxArgs": 1
          }
        },
        "webRequest": {
          "handlerBehaviorChanged": {
            "minArgs": 0,
            "maxArgs": 0
          }
        },
        "windows": {
          "create": {
            "minArgs": 0,
            "maxArgs": 1
          },
          "get": {
            "minArgs": 1,
            "maxArgs": 2
          },
          "getAll": {
            "minArgs": 0,
            "maxArgs": 1
          },
          "getCurrent": {
            "minArgs": 0,
            "maxArgs": 1
          },
          "getLastFocused": {
            "minArgs": 0,
            "maxArgs": 1
          },
          "remove": {
            "minArgs": 1,
            "maxArgs": 1
          },
          "update": {
            "minArgs": 2,
            "maxArgs": 2
          }
        }
      };

      if (Object.keys(apiMetadata).length === 0) {
        throw new Error("api-metadata.json has not been included in browser-polyfill");
      }
      /**
       * A WeakMap subclass which creates and stores a value for any key which does
       * not exist when accessed, but behaves exactly as an ordinary WeakMap
       * otherwise.
       *
       * @param {function} createItem
       *        A function which will be called in order to create the value for any
       *        key which does not exist, the first time it is accessed. The
       *        function receives, as its only argument, the key being created.
       */


      class DefaultWeakMap extends WeakMap {
        constructor(createItem, items = undefined) {
          super(items);
          this.createItem = createItem;
        }

        get(key) {
          if (!this.has(key)) {
            this.set(key, this.createItem(key));
          }

          return super.get(key);
        }

      }
      /**
       * Returns true if the given object is an object with a `then` method, and can
       * therefore be assumed to behave as a Promise.
       *
       * @param {*} value The value to test.
       * @returns {boolean} True if the value is thenable.
       */


      const isThenable = value => {
        return value && typeof value === "object" && typeof value.then === "function";
      };
      /**
       * Creates and returns a function which, when called, will resolve or reject
       * the given promise based on how it is called:
       *
       * - If, when called, `chrome.runtime.lastError` contains a non-null object,
       *   the promise is rejected with that value.
       * - If the function is called with exactly one argument, the promise is
       *   resolved to that value.
       * - Otherwise, the promise is resolved to an array containing all of the
       *   function's arguments.
       *
       * @param {object} promise
       *        An object containing the resolution and rejection functions of a
       *        promise.
       * @param {function} promise.resolve
       *        The promise's resolution function.
       * @param {function} promise.rejection
       *        The promise's rejection function.
       * @param {object} metadata
       *        Metadata about the wrapped method which has created the callback.
       * @param {integer} metadata.maxResolvedArgs
       *        The maximum number of arguments which may be passed to the
       *        callback created by the wrapped async function.
       *
       * @returns {function}
       *        The generated callback function.
       */


      const makeCallback = (promise, metadata) => {
        return (...callbackArgs) => {
          if (extensionAPIs.runtime.lastError) {
            promise.reject(extensionAPIs.runtime.lastError);
          } else if (metadata.singleCallbackArg || callbackArgs.length <= 1 && metadata.singleCallbackArg !== false) {
            promise.resolve(callbackArgs[0]);
          } else {
            promise.resolve(callbackArgs);
          }
        };
      };

      const pluralizeArguments = numArgs => numArgs == 1 ? "argument" : "arguments";
      /**
       * Creates a wrapper function for a method with the given name and metadata.
       *
       * @param {string} name
       *        The name of the method which is being wrapped.
       * @param {object} metadata
       *        Metadata about the method being wrapped.
       * @param {integer} metadata.minArgs
       *        The minimum number of arguments which must be passed to the
       *        function. If called with fewer than this number of arguments, the
       *        wrapper will raise an exception.
       * @param {integer} metadata.maxArgs
       *        The maximum number of arguments which may be passed to the
       *        function. If called with more than this number of arguments, the
       *        wrapper will raise an exception.
       * @param {integer} metadata.maxResolvedArgs
       *        The maximum number of arguments which may be passed to the
       *        callback created by the wrapped async function.
       *
       * @returns {function(object, ...*)}
       *       The generated wrapper function.
       */


      const wrapAsyncFunction = (name, metadata) => {
        return function asyncFunctionWrapper(target, ...args) {
          if (args.length < metadata.minArgs) {
            throw new Error(`Expected at least ${metadata.minArgs} ${pluralizeArguments(metadata.minArgs)} for ${name}(), got ${args.length}`);
          }

          if (args.length > metadata.maxArgs) {
            throw new Error(`Expected at most ${metadata.maxArgs} ${pluralizeArguments(metadata.maxArgs)} for ${name}(), got ${args.length}`);
          }

          return new Promise((resolve, reject) => {
            if (metadata.fallbackToNoCallback) {
              // This API method has currently no callback on Chrome, but it return a promise on Firefox,
              // and so the polyfill will try to call it with a callback first, and it will fallback
              // to not passing the callback if the first call fails.
              try {
                target[name](...args, makeCallback({
                  resolve,
                  reject
                }, metadata));
              } catch (cbError) {
                console.warn(`${name} API method doesn't seem to support the callback parameter, ` + "falling back to call it without a callback: ", cbError);
                target[name](...args); // Update the API method metadata, so that the next API calls will not try to
                // use the unsupported callback anymore.

                metadata.fallbackToNoCallback = false;
                metadata.noCallback = true;
                resolve();
              }
            } else if (metadata.noCallback) {
              target[name](...args);
              resolve();
            } else {
              target[name](...args, makeCallback({
                resolve,
                reject
              }, metadata));
            }
          });
        };
      };
      /**
       * Wraps an existing method of the target object, so that calls to it are
       * intercepted by the given wrapper function. The wrapper function receives,
       * as its first argument, the original `target` object, followed by each of
       * the arguments passed to the original method.
       *
       * @param {object} target
       *        The original target object that the wrapped method belongs to.
       * @param {function} method
       *        The method being wrapped. This is used as the target of the Proxy
       *        object which is created to wrap the method.
       * @param {function} wrapper
       *        The wrapper function which is called in place of a direct invocation
       *        of the wrapped method.
       *
       * @returns {Proxy<function>}
       *        A Proxy object for the given method, which invokes the given wrapper
       *        method in its place.
       */


      const wrapMethod = (target, method, wrapper) => {
        return new Proxy(method, {
          apply(targetMethod, thisObj, args) {
            return wrapper.call(thisObj, target, ...args);
          }

        });
      };

      let hasOwnProperty = Function.call.bind(Object.prototype.hasOwnProperty);
      /**
       * Wraps an object in a Proxy which intercepts and wraps certain methods
       * based on the given `wrappers` and `metadata` objects.
       *
       * @param {object} target
       *        The target object to wrap.
       *
       * @param {object} [wrappers = {}]
       *        An object tree containing wrapper functions for special cases. Any
       *        function present in this object tree is called in place of the
       *        method in the same location in the `target` object tree. These
       *        wrapper methods are invoked as described in {@see wrapMethod}.
       *
       * @param {object} [metadata = {}]
       *        An object tree containing metadata used to automatically generate
       *        Promise-based wrapper functions for asynchronous. Any function in
       *        the `target` object tree which has a corresponding metadata object
       *        in the same location in the `metadata` tree is replaced with an
       *        automatically-generated wrapper function, as described in
       *        {@see wrapAsyncFunction}
       *
       * @returns {Proxy<object>}
       */

      const wrapObject = (target, wrappers = {}, metadata = {}) => {
        let cache = Object.create(null);
        let handlers = {
          has(proxyTarget, prop) {
            return prop in target || prop in cache;
          },

          get(proxyTarget, prop, receiver) {
            if (prop in cache) {
              return cache[prop];
            }

            if (!(prop in target)) {
              return undefined;
            }

            let value = target[prop];

            if (typeof value === "function") {
              // This is a method on the underlying object. Check if we need to do
              // any wrapping.
              if (typeof wrappers[prop] === "function") {
                // We have a special-case wrapper for this method.
                value = wrapMethod(target, target[prop], wrappers[prop]);
              } else if (hasOwnProperty(metadata, prop)) {
                // This is an async method that we have metadata for. Create a
                // Promise wrapper for it.
                let wrapper = wrapAsyncFunction(prop, metadata[prop]);
                value = wrapMethod(target, target[prop], wrapper);
              } else {
                // This is a method that we don't know or care about. Return the
                // original method, bound to the underlying object.
                value = value.bind(target);
              }
            } else if (typeof value === "object" && value !== null && (hasOwnProperty(wrappers, prop) || hasOwnProperty(metadata, prop))) {
              // This is an object that we need to do some wrapping for the children
              // of. Create a sub-object wrapper for it with the appropriate child
              // metadata.
              value = wrapObject(value, wrappers[prop], metadata[prop]);
            } else if (hasOwnProperty(metadata, "*")) {
              // Wrap all properties in * namespace.
              value = wrapObject(value, wrappers[prop], metadata["*"]);
            } else {
              // We don't need to do any wrapping for this property,
              // so just forward all access to the underlying object.
              Object.defineProperty(cache, prop, {
                configurable: true,
                enumerable: true,

                get() {
                  return target[prop];
                },

                set(value) {
                  target[prop] = value;
                }

              });
              return value;
            }

            cache[prop] = value;
            return value;
          },

          set(proxyTarget, prop, value, receiver) {
            if (prop in cache) {
              cache[prop] = value;
            } else {
              target[prop] = value;
            }

            return true;
          },

          defineProperty(proxyTarget, prop, desc) {
            return Reflect.defineProperty(cache, prop, desc);
          },

          deleteProperty(proxyTarget, prop) {
            return Reflect.deleteProperty(cache, prop);
          }

        }; // Per contract of the Proxy API, the "get" proxy handler must return the
        // original value of the target if that value is declared read-only and
        // non-configurable. For this reason, we create an object with the
        // prototype set to `target` instead of using `target` directly.
        // Otherwise we cannot return a custom object for APIs that
        // are declared read-only and non-configurable, such as `chrome.devtools`.
        //
        // The proxy handlers themselves will still use the original `target`
        // instead of the `proxyTarget`, so that the methods and properties are
        // dereferenced via the original targets.

        let proxyTarget = Object.create(target);
        return new Proxy(proxyTarget, handlers);
      };
      /**
       * Creates a set of wrapper functions for an event object, which handles
       * wrapping of listener functions that those messages are passed.
       *
       * A single wrapper is created for each listener function, and stored in a
       * map. Subsequent calls to `addListener`, `hasListener`, or `removeListener`
       * retrieve the original wrapper, so that  attempts to remove a
       * previously-added listener work as expected.
       *
       * @param {DefaultWeakMap<function, function>} wrapperMap
       *        A DefaultWeakMap object which will create the appropriate wrapper
       *        for a given listener function when one does not exist, and retrieve
       *        an existing one when it does.
       *
       * @returns {object}
       */


      const wrapEvent = wrapperMap => ({
        addListener(target, listener, ...args) {
          target.addListener(wrapperMap.get(listener), ...args);
        },

        hasListener(target, listener) {
          return target.hasListener(wrapperMap.get(listener));
        },

        removeListener(target, listener) {
          target.removeListener(wrapperMap.get(listener));
        }

      }); // Keep track if the deprecation warning has been logged at least once.


      let loggedSendResponseDeprecationWarning = false;
      const onMessageWrappers = new DefaultWeakMap(listener => {
        if (typeof listener !== "function") {
          return listener;
        }
        /**
         * Wraps a message listener function so that it may send responses based on
         * its return value, rather than by returning a sentinel value and calling a
         * callback. If the listener function returns a Promise, the response is
         * sent when the promise either resolves or rejects.
         *
         * @param {*} message
         *        The message sent by the other end of the channel.
         * @param {object} sender
         *        Details about the sender of the message.
         * @param {function(*)} sendResponse
         *        A callback which, when called with an arbitrary argument, sends
         *        that value as a response.
         * @returns {boolean}
         *        True if the wrapped listener returned a Promise, which will later
         *        yield a response. False otherwise.
         */


        return function onMessage(message, sender, sendResponse) {
          let didCallSendResponse = false;
          let wrappedSendResponse;
          let sendResponsePromise = new Promise(resolve => {
            wrappedSendResponse = function (response) {
              if (!loggedSendResponseDeprecationWarning) {
                console.warn(SEND_RESPONSE_DEPRECATION_WARNING, new Error().stack);
                loggedSendResponseDeprecationWarning = true;
              }

              didCallSendResponse = true;
              resolve(response);
            };
          });
          let result;

          try {
            result = listener(message, sender, wrappedSendResponse);
          } catch (err) {
            result = Promise.reject(err);
          }

          const isResultThenable = result !== true && isThenable(result); // If the listener didn't returned true or a Promise, or called
          // wrappedSendResponse synchronously, we can exit earlier
          // because there will be no response sent from this listener.

          if (result !== true && !isResultThenable && !didCallSendResponse) {
            return false;
          } // A small helper to send the message if the promise resolves
          // and an error if the promise rejects (a wrapped sendMessage has
          // to translate the message into a resolved promise or a rejected
          // promise).


          const sendPromisedResult = promise => {
            promise.then(msg => {
              // send the message value.
              sendResponse(msg);
            }, error => {
              // Send a JSON representation of the error if the rejected value
              // is an instance of error, or the object itself otherwise.
              let message;

              if (error && (error instanceof Error || typeof error.message === "string")) {
                message = error.message;
              } else {
                message = "An unexpected error occurred";
              }

              sendResponse({
                __mozWebExtensionPolyfillReject__: true,
                message
              });
            }).catch(err => {
              // Print an error on the console if unable to send the response.
              console.error("Failed to send onMessage rejected reply", err);
            });
          }; // If the listener returned a Promise, send the resolved value as a
          // result, otherwise wait the promise related to the wrappedSendResponse
          // callback to resolve and send it as a response.


          if (isResultThenable) {
            sendPromisedResult(result);
          } else {
            sendPromisedResult(sendResponsePromise);
          } // Let Chrome know that the listener is replying.


          return true;
        };
      });

      const wrappedSendMessageCallback = ({
        reject,
        resolve
      }, reply) => {
        if (extensionAPIs.runtime.lastError) {
          // Detect when none of the listeners replied to the sendMessage call and resolve
          // the promise to undefined as in Firefox.
          // See https://github.com/mozilla/webextension-polyfill/issues/130
          if (extensionAPIs.runtime.lastError.message === CHROME_SEND_MESSAGE_CALLBACK_NO_RESPONSE_MESSAGE) {
            resolve();
          } else {
            reject(extensionAPIs.runtime.lastError);
          }
        } else if (reply && reply.__mozWebExtensionPolyfillReject__) {
          // Convert back the JSON representation of the error into
          // an Error instance.
          reject(new Error(reply.message));
        } else {
          resolve(reply);
        }
      };

      const wrappedSendMessage = (name, metadata, apiNamespaceObj, ...args) => {
        if (args.length < metadata.minArgs) {
          throw new Error(`Expected at least ${metadata.minArgs} ${pluralizeArguments(metadata.minArgs)} for ${name}(), got ${args.length}`);
        }

        if (args.length > metadata.maxArgs) {
          throw new Error(`Expected at most ${metadata.maxArgs} ${pluralizeArguments(metadata.maxArgs)} for ${name}(), got ${args.length}`);
        }

        return new Promise((resolve, reject) => {
          const wrappedCb = wrappedSendMessageCallback.bind(null, {
            resolve,
            reject
          });
          args.push(wrappedCb);
          apiNamespaceObj.sendMessage(...args);
        });
      };

      const staticWrappers = {
        runtime: {
          onMessage: wrapEvent(onMessageWrappers),
          onMessageExternal: wrapEvent(onMessageWrappers),
          sendMessage: wrappedSendMessage.bind(null, "sendMessage", {
            minArgs: 1,
            maxArgs: 3
          })
        },
        tabs: {
          sendMessage: wrappedSendMessage.bind(null, "sendMessage", {
            minArgs: 2,
            maxArgs: 3
          })
        }
      };
      const settingMetadata = {
        clear: {
          minArgs: 1,
          maxArgs: 1
        },
        get: {
          minArgs: 1,
          maxArgs: 1
        },
        set: {
          minArgs: 1,
          maxArgs: 1
        }
      };
      apiMetadata.privacy = {
        network: {
          "*": settingMetadata
        },
        services: {
          "*": settingMetadata
        },
        websites: {
          "*": settingMetadata
        }
      };
      return wrapObject(extensionAPIs, staticWrappers, apiMetadata);
    };

    if (typeof chrome != "object" || !chrome || !chrome.runtime || !chrome.runtime.id) {
      throw new Error("This script should only be loaded in a browser extension.");
    } // The build process adds a UMD wrapper around this file, which makes the
    // `module` variable available.


    module.exports = wrapAPIs(chrome);
  } else {
    module.exports = browser;
  }
});
//# sourceMappingURL=browser-polyfill.js.map


/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/compat get default export */
/******/ 	(() => {
/******/ 		// getDefaultExport function for compatibility with non-harmony modules
/******/ 		__webpack_require__.n = (module) => {
/******/ 			var getter = module && module.__esModule ?
/******/ 				() => (module['default']) :
/******/ 				() => (module);
/******/ 			__webpack_require__.d(getter, { a: getter });
/******/ 			return getter;
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
var __webpack_exports__ = {};
// This entry need to be wrapped in an IIFE because it need to be in strict mode.
(() => {
"use strict";
/*!**************************************!*\
  !*** ./src/targets/content/index.ts ***!
  \**************************************/
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _pages_content__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../pages/content */ "./src/pages/content/index.ts");

_pages_content__WEBPACK_IMPORTED_MODULE_0__.content.init();
})();

/******/ })()
;
<<<<<<< Updated upstream
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9hZHZhbmNlZC1hZGJsb2NrZXItd2ViLWV4dGVuc2lvbi8uL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9hcnJheUxpa2VUb0FycmF5LmpzIiwid2VicGFjazovL2FkdmFuY2VkLWFkYmxvY2tlci13ZWItZXh0ZW5zaW9uLy4vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2FycmF5V2l0aG91dEhvbGVzLmpzIiwid2VicGFjazovL2FkdmFuY2VkLWFkYmxvY2tlci13ZWItZXh0ZW5zaW9uLy4vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2FzeW5jVG9HZW5lcmF0b3IuanMiLCJ3ZWJwYWNrOi8vYWR2YW5jZWQtYWRibG9ja2VyLXdlYi1leHRlbnNpb24vLi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vaXRlcmFibGVUb0FycmF5LmpzIiwid2VicGFjazovL2FkdmFuY2VkLWFkYmxvY2tlci13ZWItZXh0ZW5zaW9uLy4vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL25vbkl0ZXJhYmxlU3ByZWFkLmpzIiwid2VicGFjazovL2FkdmFuY2VkLWFkYmxvY2tlci13ZWItZXh0ZW5zaW9uLy4vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3RvQ29uc3VtYWJsZUFycmF5LmpzIiwid2VicGFjazovL2FkdmFuY2VkLWFkYmxvY2tlci13ZWItZXh0ZW5zaW9uLy4vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5LmpzIiwid2VicGFjazovL2FkdmFuY2VkLWFkYmxvY2tlci13ZWItZXh0ZW5zaW9uLy4vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL3JlZ2VuZXJhdG9yL2luZGV4LmpzIiwid2VicGFjazovL2FkdmFuY2VkLWFkYmxvY2tlci13ZWItZXh0ZW5zaW9uLy4vc3JjL3BhZ2VzL2NvbW1vbi9jb25zdGFudHMudHMiLCJ3ZWJwYWNrOi8vYWR2YW5jZWQtYWRibG9ja2VyLXdlYi1leHRlbnNpb24vLi9zcmMvcGFnZXMvY29udGVudC9jb250ZW50LnRzIiwid2VicGFjazovL2FkdmFuY2VkLWFkYmxvY2tlci13ZWItZXh0ZW5zaW9uLy4vbm9kZV9tb2R1bGVzL2V4dGVuZGVkLWNzcy9kaXN0L2V4dGVuZGVkLWNzcy5lc20uanMiLCJ3ZWJwYWNrOi8vYWR2YW5jZWQtYWRibG9ja2VyLXdlYi1leHRlbnNpb24vLi9ub2RlX21vZHVsZXMvcmVnZW5lcmF0b3ItcnVudGltZS9ydW50aW1lLmpzIiwid2VicGFjazovL2FkdmFuY2VkLWFkYmxvY2tlci13ZWItZXh0ZW5zaW9uLy4vbm9kZV9tb2R1bGVzL3dlYmV4dGVuc2lvbi1wb2x5ZmlsbC10cy9saWIvaW5kZXguanMiLCJ3ZWJwYWNrOi8vYWR2YW5jZWQtYWRibG9ja2VyLXdlYi1leHRlbnNpb24vLi9ub2RlX21vZHVsZXMvd2ViZXh0ZW5zaW9uLXBvbHlmaWxsL2Rpc3QvYnJvd3Nlci1wb2x5ZmlsbC5qcyIsIndlYnBhY2s6Ly9hZHZhbmNlZC1hZGJsb2NrZXItd2ViLWV4dGVuc2lvbi93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9hZHZhbmNlZC1hZGJsb2NrZXItd2ViLWV4dGVuc2lvbi93ZWJwYWNrL3J1bnRpbWUvY29tcGF0IGdldCBkZWZhdWx0IGV4cG9ydCIsIndlYnBhY2s6Ly9hZHZhbmNlZC1hZGJsb2NrZXItd2ViLWV4dGVuc2lvbi93ZWJwYWNrL3J1bnRpbWUvZGVmaW5lIHByb3BlcnR5IGdldHRlcnMiLCJ3ZWJwYWNrOi8vYWR2YW5jZWQtYWRibG9ja2VyLXdlYi1leHRlbnNpb24vd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly9hZHZhbmNlZC1hZGJsb2NrZXItd2ViLWV4dGVuc2lvbi93ZWJwYWNrL3J1bnRpbWUvbWFrZSBuYW1lc3BhY2Ugb2JqZWN0Iiwid2VicGFjazovL2FkdmFuY2VkLWFkYmxvY2tlci13ZWItZXh0ZW5zaW9uLy4vc3JjL3RhcmdldHMvY29udGVudC9pbmRleC50cyJdLCJuYW1lcyI6WyJNZXNzYWdlc1RvTmF0aXZlQXBwIiwiTWVzc2FnZXNUb0JhY2tncm91bmRQYWdlIiwiTWVzc2FnZXNUb0NvbnRlbnRTY3JpcHQiLCJsb2dNZXNzYWdlIiwidmVyYm9zZSIsIm1lc3NhZ2UiLCJjb25zb2xlIiwibG9nIiwiZ2V0U2VsZWN0b3JzQW5kU2NyaXB0cyIsImJyb3dzZXIiLCJ0eXBlIiwiZGF0YSIsInVybCIsIndpbmRvdyIsImxvY2F0aW9uIiwiaHJlZiIsInJlc3BvbnNlIiwiZXhlY3V0ZVNjcmlwdHMiLCJzY3JpcHRzIiwic3RhcnQiLCJlbmQiLCJ1cGRhdGVkIiwic2NyaXB0VGFnIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50Iiwic2V0QXR0cmlidXRlIiwidGV4dENvbnRlbnQiLCJqb2luIiwicGFyZW50IiwiaGVhZCIsImRvY3VtZW50RWxlbWVudCIsImFwcGVuZENoaWxkIiwicGFyZW50Tm9kZSIsInJlbW92ZUNoaWxkIiwiYXBwbHlTY3JpcHRzIiwibGVuZ3RoIiwicmV2ZXJzZSIsInByb3RlY3RTdHlsZUVsZW1lbnRDb250ZW50IiwicHJvdGVjdFN0eWxlRWwiLCJNdXRhdGlvbk9ic2VydmVyIiwiV2ViS2l0TXV0YXRpb25PYnNlcnZlciIsImlubmVyT2JzZXJ2ZXIiLCJtdXRhdGlvbnMiLCJpIiwibSIsImhhc0F0dHJpYnV0ZSIsImdldEF0dHJpYnV0ZSIsInJlbW92ZUF0dHJpYnV0ZSIsImlzUHJvdGVjdFN0eWxlRWxNb2RpZmllZCIsInJlbW92ZWROb2RlcyIsImoiLCJvbGRWYWx1ZSIsIm9ic2VydmUiLCJjaGlsZExpc3QiLCJjaGFyYWN0ZXJEYXRhIiwic3VidHJlZSIsImNoYXJhY3RlckRhdGFPbGRWYWx1ZSIsImFwcGx5Q3NzIiwic3R5bGVTZWxlY3RvcnMiLCJzdHlsZUVsZW1lbnQiLCJzZWxlY3RvcnMiLCJtYXAiLCJzIiwidHJpbSIsImZvckVhY2giLCJzZWxlY3RvciIsInNoZWV0IiwiaW5zZXJ0UnVsZSIsImFwcGx5RXh0ZW5kZWRDc3MiLCJleHRlbmRlZENzcyIsImV4dGNzcyIsIkV4dGVuZGVkQ3NzIiwic3R5bGVTaGVldCIsImZpbHRlciIsImFwcGx5IiwiYXBwbHlBZHZhbmNlZEJsb2NraW5nRGF0YSIsInNlbGVjdG9yc0FuZFNjcmlwdHMiLCJjc3NJbmplY3QiLCJjc3NFeHRlbmRlZCIsImluaXQiLCJIVE1MRG9jdW1lbnQiLCJpbmRleE9mIiwic3RhcnRHZXR0aW5nU2NyaXB0cyIsIkRhdGUiLCJub3ciLCJjb250ZW50Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUFlO0FBQ2Y7O0FBRUEsd0NBQXdDLFNBQVM7QUFDakQ7QUFDQTs7QUFFQTtBQUNBLEM7Ozs7Ozs7Ozs7Ozs7Ozs7QUNScUQ7QUFDdEM7QUFDZixpQ0FBaUMsNkRBQWdCO0FBQ2pELEM7Ozs7Ozs7Ozs7Ozs7OztBQ0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTs7QUFFZTtBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEtBQUs7QUFDTDtBQUNBLEM7Ozs7Ozs7Ozs7Ozs7OztBQ2xDZTtBQUNmO0FBQ0EsQzs7Ozs7Ozs7Ozs7Ozs7O0FDRmU7QUFDZjtBQUNBLEM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUNGdUQ7QUFDSjtBQUNzQjtBQUNsQjtBQUN4QztBQUNmLFNBQVMsOERBQWlCLFNBQVMsNERBQWUsU0FBUyx1RUFBMEIsU0FBUyw4REFBaUI7QUFDL0csQzs7Ozs7Ozs7Ozs7Ozs7OztBQ05xRDtBQUN0QztBQUNmO0FBQ0Esb0NBQW9DLDZEQUFnQjtBQUNwRDtBQUNBO0FBQ0E7QUFDQSxzRkFBc0YsNkRBQWdC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QUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7O0FBRUE7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBLDJCQUEyQix5Q0FBeUM7QUFDcEU7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDs7QUFFQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0EsYUFBYSxNQUFNO0FBQ25COztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtB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QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQSxXQUFXO0FBQ1g7O0FBRUE7QUFDQTtBQUNBLHdDQUF3QyxXQUFXO0FBQ25EO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSwyQkFBMkI7QUFDM0I7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBLFNBQVM7QUFDVDtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0Esb0NBQW9DLGNBQWM7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsaUNBQWlDLGtCQUFrQjtBQUNuRDtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsaUJBQWlCOztBQUVqQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsaUJBQWlCO0FBQ3pDO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7O0FBRUE7QUFDQSxZQUFZO0FBQ1o7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQSw4Q0FBOEMsUUFBUTtBQUN0RDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7O0FBRUEsV0FBVztBQUNYO0FBQ0E7QUFDQTs7QUFFQSxXQUFXO0FBQ1g7QUFDQTtBQUNBOztBQUVBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQSw4Q0FBOEMsUUFBUTtBQUN0RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBOztBQUVBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBLDhDQUE4QyxRQUFRO0FBQ3REO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBLDhDQUE4QyxRQUFRO0FBQ3REO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRSxLQUEwQixvQkFBb0IsQ0FBRTtBQUNsRDs7QUFFQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7OztBQzN1QmE7QUFDYiw4Q0FBNkMsQ0FBQyxjQUFjLEVBQUM7O0FBRTdELG1JQUFrRDs7Ozs7Ozs7Ozs7QUNIbEQ7QUFDQSxNQUFNLElBQTBDO0FBQ2hELElBQUksaUNBQWdDLENBQUMsTUFBUSxDQUFDLG9DQUFFLE9BQU87QUFBQTtBQUFBO0FBQUEsa0dBQUM7QUFDeEQsR0FBRyxNQUFNLFlBUU47QUFDSCxDQUFDO0FBQ0Q7O0FBRUEscUNBQXFDOztBQUVyQzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsdVNBQXVTO0FBQ3ZTO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNB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O1dBQ0E7V0FDQSxzREFBc0Qsa0JBQWtCO1dBQ3hFO1dBQ0EsK0NBQStDLGNBQWM7V0FDN0QsRTs7Ozs7Ozs7Ozs7OztBQ05BO0FBRUFNLHdEQUFBLEciLCJmaWxlIjoiY29udGVudC5qcyIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIF9hcnJheUxpa2VUb0FycmF5KGFyciwgbGVuKSB7XG4gIGlmIChsZW4gPT0gbnVsbCB8fCBsZW4gPiBhcnIubGVuZ3RoKSBsZW4gPSBhcnIubGVuZ3RoO1xuXG4gIGZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGxlbik7IGkgPCBsZW47IGkrKykge1xuICAgIGFycjJbaV0gPSBhcnJbaV07XG4gIH1cblxuICByZXR1cm4gYXJyMjtcbn0iLCJpbXBvcnQgYXJyYXlMaWtlVG9BcnJheSBmcm9tIFwiLi9hcnJheUxpa2VUb0FycmF5LmpzXCI7XG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB7XG4gIGlmIChBcnJheS5pc0FycmF5KGFycikpIHJldHVybiBhcnJheUxpa2VUb0FycmF5KGFycik7XG59IiwiZnVuY3Rpb24gYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCBrZXksIGFyZykge1xuICB0cnkge1xuICAgIHZhciBpbmZvID0gZ2VuW2tleV0oYXJnKTtcbiAgICB2YXIgdmFsdWUgPSBpbmZvLnZhbHVlO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJlamVjdChlcnJvcik7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKGluZm8uZG9uZSkge1xuICAgIHJlc29sdmUodmFsdWUpO1xuICB9IGVsc2Uge1xuICAgIFByb21pc2UucmVzb2x2ZSh2YWx1ZSkudGhlbihfbmV4dCwgX3Rocm93KTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBfYXN5bmNUb0dlbmVyYXRvcihmbikge1xuICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgICAgYXJncyA9IGFyZ3VtZW50cztcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgdmFyIGdlbiA9IGZuLmFwcGx5KHNlbGYsIGFyZ3MpO1xuXG4gICAgICBmdW5jdGlvbiBfbmV4dCh2YWx1ZSkge1xuICAgICAgICBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csIFwibmV4dFwiLCB2YWx1ZSk7XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIF90aHJvdyhlcnIpIHtcbiAgICAgICAgYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCBcInRocm93XCIsIGVycik7XG4gICAgICB9XG5cbiAgICAgIF9uZXh0KHVuZGVmaW5lZCk7XG4gICAgfSk7XG4gIH07XG59IiwiZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheShpdGVyKSB7XG4gIGlmICh0eXBlb2YgU3ltYm9sICE9PSBcInVuZGVmaW5lZFwiICYmIGl0ZXJbU3ltYm9sLml0ZXJhdG9yXSAhPSBudWxsIHx8IGl0ZXJbXCJAQGl0ZXJhdG9yXCJdICE9IG51bGwpIHJldHVybiBBcnJheS5mcm9tKGl0ZXIpO1xufSIsImV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIF9ub25JdGVyYWJsZVNwcmVhZCgpIHtcbiAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkludmFsaWQgYXR0ZW1wdCB0byBzcHJlYWQgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxcbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC5cIik7XG59IiwiaW1wb3J0IGFycmF5V2l0aG91dEhvbGVzIGZyb20gXCIuL2FycmF5V2l0aG91dEhvbGVzLmpzXCI7XG5pbXBvcnQgaXRlcmFibGVUb0FycmF5IGZyb20gXCIuL2l0ZXJhYmxlVG9BcnJheS5qc1wiO1xuaW1wb3J0IHVuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5IGZyb20gXCIuL3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5LmpzXCI7XG5pbXBvcnQgbm9uSXRlcmFibGVTcHJlYWQgZnJvbSBcIi4vbm9uSXRlcmFibGVTcHJlYWQuanNcIjtcbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIF90b0NvbnN1bWFibGVBcnJheShhcnIpIHtcbiAgcmV0dXJuIGFycmF5V2l0aG91dEhvbGVzKGFycikgfHwgaXRlcmFibGVUb0FycmF5KGFycikgfHwgdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkoYXJyKSB8fCBub25JdGVyYWJsZVNwcmVhZCgpO1xufSIsImltcG9ydCBhcnJheUxpa2VUb0FycmF5IGZyb20gXCIuL2FycmF5TGlrZVRvQXJyYXkuanNcIjtcbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShvLCBtaW5MZW4pIHtcbiAgaWYgKCFvKSByZXR1cm47XG4gIGlmICh0eXBlb2YgbyA9PT0gXCJzdHJpbmdcIikgcmV0dXJuIGFycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTtcbiAgdmFyIG4gPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobykuc2xpY2UoOCwgLTEpO1xuICBpZiAobiA9PT0gXCJPYmplY3RcIiAmJiBvLmNvbnN0cnVjdG9yKSBuID0gby5jb25zdHJ1Y3Rvci5uYW1lO1xuICBpZiAobiA9PT0gXCJNYXBcIiB8fCBuID09PSBcIlNldFwiKSByZXR1cm4gQXJyYXkuZnJvbShvKTtcbiAgaWYgKG4gPT09IFwiQXJndW1lbnRzXCIgfHwgL14oPzpVaXxJKW50KD86OHwxNnwzMikoPzpDbGFtcGVkKT9BcnJheSQvLnRlc3QobikpIHJldHVybiBhcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7XG59IiwibW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKFwicmVnZW5lcmF0b3ItcnVudGltZVwiKTtcbiIsImV4cG9ydCBlbnVtIE1lc3NhZ2VzVG9OYXRpdmVBcHAge1xuICAgIFdyaXRlSW5OYXRpdmVMb2cgPSAnd3JpdGVJbk5hdGl2ZUxvZycsXG4gICAgR2V0QmxvY2tpbmdEYXRhID0gJ2dldEJsb2NraW5nRGF0YScsXG4gICAgQWRkVG9Vc2VyUnVsZXMgPSAnYWRkVG9Vc2VyUnVsZXMnLFxuICAgIElzUHJvdGVjdGlvbkVuYWJsZWQgPSAnaXNQcm90ZWN0aW9uRW5hYmxlZCcsXG4gICAgRW5hYmxlUHJvdGVjdGlvbiA9ICdlbmFibGVQcm90ZWN0aW9uJyxcbiAgICBEaXNhYmxlUHJvdGVjdGlvbiA9ICdkaXNhYmxlUHJvdGVjdGlvbicsXG4gICAgSGFzVXNlclJ1bGVzQnlTaXRlID0gJ2hhc1VzZXJSdWxlc0J5U2l0ZScsXG4gICAgUmVtb3ZlVXNlclJ1bGVzQnlTaXRlID0gJ3JlbW92ZVVzZXJSdWxlc0J5U2l0ZScsXG4gICAgUmVwb3J0UHJvYmxlbSA9ICdyZXBvcnRQcm9ibGVtJyxcbiAgICBJc1ByZW1pdW0gPSAnaXNQcmVtaXVtJyxcbiAgICBBcmVDb250ZW50QmxvY2tlcnNFbmFibGVkID0gJ2FyZUNvbnRlbnRCbG9ja2Vyc0VuYWJsZWQnLFxuICAgIFVwZ3JhZGVNZSA9ICd1cGdyYWRlTWUnLFxuICAgIEdldEFkdmFuY2VkUnVsZXNUZXh0ID0gJ2dldEFkdmFuY2VkUnVsZXNUZXh0Jyxcbn1cblxuZXhwb3J0IGVudW0gTWVzc2FnZXNUb0JhY2tncm91bmRQYWdlIHtcbiAgICBPcGVuQXNzaXN0YW50ID0gJ29wZW5fYXNzaXN0YW50JyxcbiAgICBHZXRTY3JpcHRzQW5kU2VsZWN0b3JzID0gJ2dldF9zY3JpcHRzX2FuZF9zZWxlY3RvcnMnLFxuICAgIEFkZFJ1bGUgPSAnYWRkX3J1bGUnLFxuICAgIEdldFBvcHVwRGF0YSA9ICdnZXRfcG9wdXBfZGF0YScsXG4gICAgU2V0UGVybWlzc2lvbnNNb2RhbFZpZXdlZCA9ICdzZXRfcGVybWlzc2lvbnNfbW9kYWxfdmlld2VkJyxcbiAgICBTZXRQcm90ZWN0aW9uU3RhdHVzID0gJ3NldF9wcm90ZWN0aW9uX3N0YXR1cycsXG4gICAgRGVsZXRlVXNlclJ1bGVzQnlVcmwgPSAnZGVsZXRlX3VzZXJfcnVsZXNfYnlfdXJsJyxcbiAgICBSZXBvcnRQcm9ibGVtID0gJ3JlcG9ydF9wcm9ibGVtJyxcbiAgICBVcGdyYWRlQ2xpY2tlZCA9ICd1cGdyYWRlX2NsaWNrZWQnLFxufVxuXG5leHBvcnQgZW51bSBNZXNzYWdlc1RvQ29udGVudFNjcmlwdCB7XG4gICAgSW5pdEFzc2lzdGFudCA9ICdpbml0X2Fzc2lzdGFudCcsXG59XG4iLCIvKiBlc2xpbnQtZGlzYWJsZSBuby1jb25zb2xlICovXG5pbXBvcnQgeyBicm93c2VyIH0gZnJvbSAnd2ViZXh0ZW5zaW9uLXBvbHlmaWxsLXRzJztcbmltcG9ydCBFeHRlbmRlZENzcyBmcm9tICdleHRlbmRlZC1jc3MnO1xuXG5pbXBvcnQgeyBNZXNzYWdlc1RvQmFja2dyb3VuZFBhZ2UgfSBmcm9tICcuLi9jb21tb24vY29uc3RhbnRzJztcbmltcG9ydCB7IFNlbGVjdG9yc0FuZFNjcmlwdHMgfSBmcm9tICcuLi9jb21tb24vaW50ZXJmYWNlcyc7XG5cbi8qKlxuICogTG9ncyBhIG1lc3NhZ2UgaWYgdmVyYm9zZSBpcyB0cnVlXG4gKlxuICogQHBhcmFtIHZlcmJvc2VcbiAqIEBwYXJhbSBtZXNzYWdlXG4gKi9cbmNvbnN0IGxvZ01lc3NhZ2UgPSAodmVyYm9zZTogYm9vbGVhbiwgbWVzc2FnZTogc3RyaW5nKSA9PiB7XG4gICAgaWYgKHZlcmJvc2UpIHtcbiAgICAgICAgY29uc29sZS5sb2coYChBRykgJHttZXNzYWdlfWApO1xuICAgIH1cbn07XG5cbmNvbnN0IGdldFNlbGVjdG9yc0FuZFNjcmlwdHMgPSBhc3luYyAoKTogUHJvbWlzZTxTZWxlY3RvcnNBbmRTY3JpcHRzIHwgbnVsbD4gPT4ge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYnJvd3Nlci5ydW50aW1lLnNlbmRNZXNzYWdlKHtcbiAgICAgICAgdHlwZTogTWVzc2FnZXNUb0JhY2tncm91bmRQYWdlLkdldFNjcmlwdHNBbmRTZWxlY3RvcnMsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHVybDogd2luZG93LmxvY2F0aW9uLmhyZWYsXG4gICAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBpZiAocmVzcG9uc2UgPT09IG51bGwpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ0FHOiBubyBzY3JpcHRzIGFuZCBzZWxlY3RvcnMgcmVjZWl2ZWQnKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3BvbnNlIGFzIFNlbGVjdG9yc0FuZFNjcmlwdHM7XG59O1xuXG4vKipcbiAqIEV4ZWN1dGUgc2NyaXB0cyBpbiBhIHBhZ2UgY29udGV4dCBhbmQgY2xlYW51cCBpdHNlbGYgd2hlbiBleGVjdXRpb24gY29tcGxldGVzXG4gKiBAcGFyYW0gc2NyaXB0cyBTY3JpcHRzIGFycmF5IHRvIGV4ZWN1dGVcbiAqL1xuY29uc3QgZXhlY3V0ZVNjcmlwdHMgPSAoc2NyaXB0czogc3RyaW5nW10pID0+IHtcbiAgICAvLyBXcmFwIHdpdGggdHJ5IGNhdGNoXG4gICAgY29uc3Qgc3RhcnQgPSAnKCBmdW5jdGlvbiAoKSB7IHRyeSB7JztcbiAgICBjb25zdCBlbmQgPSBcIn0gY2F0Y2ggKGV4KSB7IGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGV4ZWN1dGluZyBBRyBqczogJyArIGV4KTsgfSB9KSgpO1wiO1xuXG4gICAgY29uc3QgdXBkYXRlZCA9IFtzdGFydCwgLi4uc2NyaXB0cywgZW5kXTtcblxuICAgIGNvbnN0IHNjcmlwdFRhZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpO1xuICAgIHNjcmlwdFRhZy5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCAndGV4dC9qYXZhc2NyaXB0Jyk7XG4gICAgc2NyaXB0VGFnLnRleHRDb250ZW50ID0gdXBkYXRlZC5qb2luKCdcXHJcXG4nKTtcblxuICAgIGNvbnN0IHBhcmVudCA9IGRvY3VtZW50LmhlYWQgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50O1xuICAgIHBhcmVudC5hcHBlbmRDaGlsZChzY3JpcHRUYWcpO1xuICAgIGlmIChzY3JpcHRUYWcucGFyZW50Tm9kZSkge1xuICAgICAgICBzY3JpcHRUYWcucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChzY3JpcHRUYWcpO1xuICAgIH1cbn07XG5cbi8qKlxuICogQXBwbGllcyBKUyBpbmplY3Rpb25zLlxuICogQHBhcmFtIHNjcmlwdHMgQXJyYXkgd2l0aCBKUyBzY3JpcHRzXG4gKiBAcGFyYW0gdmVyYm9zZSBsb2dnaW5nXG4gKi9cbmNvbnN0IGFwcGx5U2NyaXB0cyA9IChzY3JpcHRzOiBzdHJpbmdbXSwgdmVyYm9zZTogYm9vbGVhbikgPT4ge1xuICAgIGlmICghc2NyaXB0cyB8fCBzY3JpcHRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgbG9nTWVzc2FnZSh2ZXJib3NlLCBgc2NyaXB0cyBsZW5ndGg6ICR7c2NyaXB0cy5sZW5ndGh9YCk7XG4gICAgZXhlY3V0ZVNjcmlwdHMoc2NyaXB0cy5yZXZlcnNlKCkpO1xufTtcblxuLyoqXG4gKiBQcm90ZWN0cyBzcGVjaWZpZWQgc3R5bGUgZWxlbWVudCBmcm9tIGNoYW5nZXMgdG8gdGhlIGN1cnJlbnQgZG9jdW1lbnRcbiAqIEFkZCBhIG11dGF0aW9uIG9ic2VydmVyLCB3aGljaCBpcyBhZGRzIG91ciBydWxlcyBhZ2FpbiBpZiBpdCB3YXMgcmVtb3ZlZFxuICpcbiAqIEBwYXJhbSBwcm90ZWN0U3R5bGVFbCBwcm90ZWN0ZWQgc3R5bGUgZWxlbWVudFxuICovXG5jb25zdCBwcm90ZWN0U3R5bGVFbGVtZW50Q29udGVudCA9IChwcm90ZWN0U3R5bGVFbDogTm9kZSkgPT4ge1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBjb25zdCBNdXRhdGlvbk9ic2VydmVyID0gd2luZG93Lk11dGF0aW9uT2JzZXJ2ZXIgfHwgd2luZG93LldlYktpdE11dGF0aW9uT2JzZXJ2ZXI7XG4gICAgaWYgKCFNdXRhdGlvbk9ic2VydmVyKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLyogb2JzZXJ2ZXIsIHdoaWNoIG9ic2VydmUgcHJvdGVjdFN0eWxlRWwgaW5uZXIgY2hhbmdlcywgd2l0aG91dCBkZWxldGluZyBzdHlsZUVsICovXG4gICAgY29uc3QgaW5uZXJPYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKCgobXV0YXRpb25zKSA9PiB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbXV0YXRpb25zLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgICAgICBjb25zdCBtID0gbXV0YXRpb25zW2ldO1xuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgaWYgKHByb3RlY3RTdHlsZUVsLmhhc0F0dHJpYnV0ZSgnbW9kJykgJiYgcHJvdGVjdFN0eWxlRWwuZ2V0QXR0cmlidXRlKCdtb2QnKSA9PT0gJ2lubmVyJykge1xuICAgICAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgICAgICBwcm90ZWN0U3R5bGVFbC5yZW1vdmVBdHRyaWJ1dGUoJ21vZCcpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICBwcm90ZWN0U3R5bGVFbC5zZXRBdHRyaWJ1dGUoJ21vZCcsICdpbm5lcicpO1xuICAgICAgICAgICAgbGV0IGlzUHJvdGVjdFN0eWxlRWxNb2RpZmllZCA9IGZhbHNlO1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIGZ1cnRoZXIsIHRoZXJlIGFyZSB0d28gbXV0dWFsbHkgZXhjbHVzaXZlIHNpdHVhdGlvbnM6IGVpdGhlciB0aGVyZSB3ZXJlIGNoYW5nZXNcbiAgICAgICAgICAgICAqIHRoZSB0ZXh0IG9mIHByb3RlY3RTdHlsZUVsLCBlaXRoZXIgdGhlcmUgd2FzIHJlbW92ZXMgYSB3aG9sZSBjaGlsZCBcInRleHRcIlxuICAgICAgICAgICAgICogZWxlbWVudCBvZiBwcm90ZWN0U3R5bGVFbCB3ZSdsbCBwcm9jZXNzIGJvdGggb2YgdGhlbVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBpZiAobS5yZW1vdmVkTm9kZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgbS5yZW1vdmVkTm9kZXMubGVuZ3RoOyBqICs9IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgaXNQcm90ZWN0U3R5bGVFbE1vZGlmaWVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgcHJvdGVjdFN0eWxlRWwuYXBwZW5kQ2hpbGQobS5yZW1vdmVkTm9kZXNbal0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAobS5vbGRWYWx1ZSkge1xuICAgICAgICAgICAgICAgIGlzUHJvdGVjdFN0eWxlRWxNb2RpZmllZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXBhcmFtLXJlYXNzaWduXG4gICAgICAgICAgICAgICAgcHJvdGVjdFN0eWxlRWwudGV4dENvbnRlbnQgPSBtLm9sZFZhbHVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIWlzUHJvdGVjdFN0eWxlRWxNb2RpZmllZCkge1xuICAgICAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgICAgICBwcm90ZWN0U3R5bGVFbC5yZW1vdmVBdHRyaWJ1dGUoJ21vZCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSkpO1xuXG4gICAgaW5uZXJPYnNlcnZlci5vYnNlcnZlKHByb3RlY3RTdHlsZUVsLCB7XG4gICAgICAgIGNoaWxkTGlzdDogdHJ1ZSxcbiAgICAgICAgY2hhcmFjdGVyRGF0YTogdHJ1ZSxcbiAgICAgICAgc3VidHJlZTogdHJ1ZSxcbiAgICAgICAgY2hhcmFjdGVyRGF0YU9sZFZhbHVlOiB0cnVlLFxuICAgIH0pO1xufTtcblxuLyoqXG4gKiBBcHBsaWVzIGNzcyBzdHlsZXNoZWV0XG4gKiBAcGFyYW0gc3R5bGVTZWxlY3RvcnMgQXJyYXkgb2Ygc3R5bGVzaGVldHMgb3Igc2VsZWN0b3JzXG4gKiBAcGFyYW0gdmVyYm9zZSBsb2dnaW5nXG4gKi9cbmNvbnN0IGFwcGx5Q3NzID0gKHN0eWxlU2VsZWN0b3JzOiBzdHJpbmdbXSwgdmVyYm9zZTogYm9vbGVhbikgPT4ge1xuICAgIGlmICghc3R5bGVTZWxlY3RvcnMgfHwgIXN0eWxlU2VsZWN0b3JzLmxlbmd0aCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgbG9nTWVzc2FnZSh2ZXJib3NlLCBgY3NzIGxlbmd0aDogJHtzdHlsZVNlbGVjdG9ycy5sZW5ndGh9YCk7XG5cbiAgICBjb25zdCBzdHlsZUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzdHlsZScpO1xuICAgIHN0eWxlRWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCAndGV4dC9jc3MnKTtcbiAgICAoZG9jdW1lbnQuaGVhZCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpLmFwcGVuZENoaWxkKHN0eWxlRWxlbWVudCk7XG5cbiAgICBjb25zdCBzZWxlY3RvcnMgPSBzdHlsZVNlbGVjdG9ycy5tYXAoKHMpID0+IHMudHJpbSgpKTtcbiAgICBzZWxlY3RvcnMuZm9yRWFjaCgoc2VsZWN0b3IpID0+IHtcbiAgICAgICAgc3R5bGVFbGVtZW50LnNoZWV0IS5pbnNlcnRSdWxlKHNlbGVjdG9yKTtcbiAgICB9KTtcblxuICAgIHByb3RlY3RTdHlsZUVsZW1lbnRDb250ZW50KHN0eWxlRWxlbWVudCk7XG59O1xuXG4vKipcbiAqIEFwcGxpZXMgRXh0ZW5kZWQgQ3NzIHN0eWxlc2hlZXRcbiAqXG4gKiBAcGFyYW0gZXh0ZW5kZWRDc3MgQXJyYXkgd2l0aCBFeHRlbmRlZENzcyBzdHlsZXNoZWV0c1xuICogQHBhcmFtIHZlcmJvc2UgbG9nZ2luZ1xuICovXG5jb25zdCBhcHBseUV4dGVuZGVkQ3NzID0gKGV4dGVuZGVkQ3NzOiBzdHJpbmdbXSwgdmVyYm9zZTogYm9vbGVhbikgPT4ge1xuICAgIGlmICghZXh0ZW5kZWRDc3MgfHwgIWV4dGVuZGVkQ3NzLmxlbmd0aCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgbG9nTWVzc2FnZSh2ZXJib3NlLCBgZXh0ZW5kZWQgY3NzIGxlbmd0aDogJHtleHRlbmRlZENzcy5sZW5ndGh9YCk7XG4gICAgY29uc3QgZXh0Y3NzID0gbmV3IEV4dGVuZGVkQ3NzKHtcbiAgICAgICAgc3R5bGVTaGVldDogZXh0ZW5kZWRDc3NcbiAgICAgICAgICAgIC5maWx0ZXIoKHMpID0+IHMubGVuZ3RoID4gMClcbiAgICAgICAgICAgIC5tYXAoKHMpID0+IHMudHJpbSgpKVxuICAgICAgICAgICAgLm1hcCgocykgPT4gKHNbcy5sZW5ndGggLSAxXSAhPT0gJ30nID8gYCR7c30ge2Rpc3BsYXk6bm9uZSFpbXBvcnRhbnQ7fWAgOiBzKSlcbiAgICAgICAgICAgIC5qb2luKCdcXG4nKSxcbiAgICB9KTtcbiAgICBleHRjc3MuYXBwbHkoKTtcbn07XG5cbi8qKlxuICogQXBwbGllcyBpbmplY3RlZCBzY3JpcHQgYW5kIGNzc1xuICpcbiAqIEBwYXJhbSBzZWxlY3RvcnNBbmRTY3JpcHRzXG4gKiBAcGFyYW0gdmVyYm9zZVxuICovXG5jb25zdCBhcHBseUFkdmFuY2VkQmxvY2tpbmdEYXRhID0gKHNlbGVjdG9yc0FuZFNjcmlwdHM6IFNlbGVjdG9yc0FuZFNjcmlwdHMsIHZlcmJvc2UgPSB0cnVlKSA9PiB7XG4gICAgbG9nTWVzc2FnZSh2ZXJib3NlLCAnQXBwbHlpbmcgc2NyaXB0cyBhbmQgY3NzLi4nKTtcbiAgICBsb2dNZXNzYWdlKHZlcmJvc2UsIGBGcmFtZSB1cmw6ICR7d2luZG93LmxvY2F0aW9uLmhyZWZ9YCk7XG5cbiAgICBhcHBseVNjcmlwdHMoc2VsZWN0b3JzQW5kU2NyaXB0cy5zY3JpcHRzLCB2ZXJib3NlKTtcbiAgICBhcHBseUNzcyhzZWxlY3RvcnNBbmRTY3JpcHRzLmNzc0luamVjdCwgdmVyYm9zZSk7XG4gICAgYXBwbHlFeHRlbmRlZENzcyhzZWxlY3RvcnNBbmRTY3JpcHRzLmNzc0V4dGVuZGVkLCB2ZXJib3NlKTtcblxuICAgIGxvZ01lc3NhZ2UodmVyYm9zZSwgJ0FwcGx5aW5nIHNjcmlwdHMgYW5kIGNzcyAtIGRvbmUnKTtcbn07XG5cbmNvbnN0IGluaXQgPSBhc3luYyAoKSA9PiB7XG4gICAgaWYgKGRvY3VtZW50IGluc3RhbmNlb2YgSFRNTERvY3VtZW50KSB7XG4gICAgICAgIGlmICh3aW5kb3cubG9jYXRpb24uaHJlZiAmJiB3aW5kb3cubG9jYXRpb24uaHJlZi5pbmRleE9mKCdodHRwJykgPT09IDApIHtcbiAgICAgICAgICAgIGNvbnN0IHN0YXJ0R2V0dGluZ1NjcmlwdHMgPSBEYXRlLm5vdygpO1xuICAgICAgICAgICAgbGV0IHNlbGVjdG9yc0FuZFNjcmlwdHM7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHNlbGVjdG9yc0FuZFNjcmlwdHMgPSBhd2FpdCBnZXRTZWxlY3RvcnNBbmRTY3JpcHRzKCk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coc2VsZWN0b3JzQW5kU2NyaXB0cyk7XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgVGltZSB0byBnZXQgc2VsZWN0b3JzIGFuZCBzY3JpcHRzIGZyb20gbmF0aXZlIHBhZ2UgdG8gY29udGVudCBzY3JpcHQ6ICR7RGF0ZS5ub3coKSAtIHN0YXJ0R2V0dGluZ1NjcmlwdHN9IG1zYCk7XG4gICAgICAgICAgICBpZiAoc2VsZWN0b3JzQW5kU2NyaXB0cykge1xuICAgICAgICAgICAgICAgIGFwcGx5QWR2YW5jZWRCbG9ja2luZ0RhdGEoc2VsZWN0b3JzQW5kU2NyaXB0cywgZmFsc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufTtcblxuZXhwb3J0IGNvbnN0IGNvbnRlbnQgPSB7XG4gICAgaW5pdCxcbn07XG4iLCIvKiEgZXh0ZW5kZWQtY3NzIC0gdjEuMy4xMiAtIE1vbiBNYXkgMzEgMjAyMVxuKiBodHRwczovL2dpdGh1Yi5jb20vQWRndWFyZFRlYW0vRXh0ZW5kZWRDc3NcbiogQ29weXJpZ2h0IChjKSAyMDIxIEFkR3VhcmQuIExpY2Vuc2VkIExHUEwtMy4wXG4qL1xuZnVuY3Rpb24gX3R5cGVvZihvYmopIHtcbiAgXCJAYmFiZWwvaGVscGVycyAtIHR5cGVvZlwiO1xuXG4gIGlmICh0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gXCJzeW1ib2xcIikge1xuICAgIF90eXBlb2YgPSBmdW5jdGlvbiAob2JqKSB7XG4gICAgICByZXR1cm4gdHlwZW9mIG9iajtcbiAgICB9O1xuICB9IGVsc2Uge1xuICAgIF90eXBlb2YgPSBmdW5jdGlvbiAob2JqKSB7XG4gICAgICByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyBcInN5bWJvbFwiIDogdHlwZW9mIG9iajtcbiAgICB9O1xuICB9XG5cbiAgcmV0dXJuIF90eXBlb2Yob2JqKTtcbn1cblxuZnVuY3Rpb24gX3NsaWNlZFRvQXJyYXkoYXJyLCBpKSB7XG4gIHJldHVybiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB8fCBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkoYXJyLCBpKSB8fCBfbm9uSXRlcmFibGVSZXN0KCk7XG59XG5cbmZ1bmN0aW9uIF90b0NvbnN1bWFibGVBcnJheShhcnIpIHtcbiAgcmV0dXJuIF9hcnJheVdpdGhvdXRIb2xlcyhhcnIpIHx8IF9pdGVyYWJsZVRvQXJyYXkoYXJyKSB8fCBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkoYXJyKSB8fCBfbm9uSXRlcmFibGVTcHJlYWQoKTtcbn1cblxuZnVuY3Rpb24gX2FycmF5V2l0aG91dEhvbGVzKGFycikge1xuICBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkoYXJyKTtcbn1cblxuZnVuY3Rpb24gX2FycmF5V2l0aEhvbGVzKGFycikge1xuICBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSByZXR1cm4gYXJyO1xufVxuXG5mdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5KGl0ZXIpIHtcbiAgaWYgKHR5cGVvZiBTeW1ib2wgIT09IFwidW5kZWZpbmVkXCIgJiYgU3ltYm9sLml0ZXJhdG9yIGluIE9iamVjdChpdGVyKSkgcmV0dXJuIEFycmF5LmZyb20oaXRlcik7XG59XG5cbmZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHtcbiAgaWYgKHR5cGVvZiBTeW1ib2wgPT09IFwidW5kZWZpbmVkXCIgfHwgIShTeW1ib2wuaXRlcmF0b3IgaW4gT2JqZWN0KGFycikpKSByZXR1cm47XG4gIHZhciBfYXJyID0gW107XG4gIHZhciBfbiA9IHRydWU7XG4gIHZhciBfZCA9IGZhbHNlO1xuICB2YXIgX2UgPSB1bmRlZmluZWQ7XG5cbiAgdHJ5IHtcbiAgICBmb3IgKHZhciBfaSA9IGFycltTeW1ib2wuaXRlcmF0b3JdKCksIF9zOyAhKF9uID0gKF9zID0gX2kubmV4dCgpKS5kb25lKTsgX24gPSB0cnVlKSB7XG4gICAgICBfYXJyLnB1c2goX3MudmFsdWUpO1xuXG4gICAgICBpZiAoaSAmJiBfYXJyLmxlbmd0aCA9PT0gaSkgYnJlYWs7XG4gICAgfVxuICB9IGNhdGNoIChlcnIpIHtcbiAgICBfZCA9IHRydWU7XG4gICAgX2UgPSBlcnI7XG4gIH0gZmluYWxseSB7XG4gICAgdHJ5IHtcbiAgICAgIGlmICghX24gJiYgX2lbXCJyZXR1cm5cIl0gIT0gbnVsbCkgX2lbXCJyZXR1cm5cIl0oKTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgaWYgKF9kKSB0aHJvdyBfZTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gX2Fycjtcbn1cblxuZnVuY3Rpb24gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8sIG1pbkxlbikge1xuICBpZiAoIW8pIHJldHVybjtcbiAgaWYgKHR5cGVvZiBvID09PSBcInN0cmluZ1wiKSByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTtcbiAgdmFyIG4gPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobykuc2xpY2UoOCwgLTEpO1xuICBpZiAobiA9PT0gXCJPYmplY3RcIiAmJiBvLmNvbnN0cnVjdG9yKSBuID0gby5jb25zdHJ1Y3Rvci5uYW1lO1xuICBpZiAobiA9PT0gXCJNYXBcIiB8fCBuID09PSBcIlNldFwiKSByZXR1cm4gQXJyYXkuZnJvbShvKTtcbiAgaWYgKG4gPT09IFwiQXJndW1lbnRzXCIgfHwgL14oPzpVaXxJKW50KD86OHwxNnwzMikoPzpDbGFtcGVkKT9BcnJheSQvLnRlc3QobikpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pO1xufVxuXG5mdW5jdGlvbiBfYXJyYXlMaWtlVG9BcnJheShhcnIsIGxlbikge1xuICBpZiAobGVuID09IG51bGwgfHwgbGVuID4gYXJyLmxlbmd0aCkgbGVuID0gYXJyLmxlbmd0aDtcblxuICBmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShsZW4pOyBpIDwgbGVuOyBpKyspIGFycjJbaV0gPSBhcnJbaV07XG5cbiAgcmV0dXJuIGFycjI7XG59XG5cbmZ1bmN0aW9uIF9ub25JdGVyYWJsZVNwcmVhZCgpIHtcbiAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkludmFsaWQgYXR0ZW1wdCB0byBzcHJlYWQgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxcbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC5cIik7XG59XG5cbmZ1bmN0aW9uIF9ub25JdGVyYWJsZVJlc3QoKSB7XG4gIHRocm93IG5ldyBUeXBlRXJyb3IoXCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxcbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC5cIik7XG59XG5cbi8qKlxuICogQ29weXJpZ2h0IDIwMTYgQWRndWFyZCBTb2Z0d2FyZSBMdGRcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG4vKiBlc2xpbnQtZGlzYWJsZSBuby1jb25zb2xlICovXG52YXIgdXRpbHMgPSB7fTtcbnV0aWxzLk11dGF0aW9uT2JzZXJ2ZXIgPSB3aW5kb3cuTXV0YXRpb25PYnNlcnZlciB8fCB3aW5kb3cuV2ViS2l0TXV0YXRpb25PYnNlcnZlcjtcbi8qKlxuICogU3RvcmVzIG5hdGl2ZSBOb2RlIHRleHRDb250ZW50IGdldHRlciB0byBiZSB1c2VkIGZvciBjb250YWlucyBwc2V1ZG8tY2xhc3NcbiAqIGJlY2F1c2UgZWxlbWVudHMnICd0ZXh0Q29udGVudCcgYW5kICdpbm5lclRleHQnIHByb3BlcnRpZXMgbWlnaHQgYmUgbW9ja2VkXG4gKiBodHRwczovL2dpdGh1Yi5jb20vQWRndWFyZFRlYW0vRXh0ZW5kZWRDc3MvaXNzdWVzLzEyN1xuICovXG5cbnV0aWxzLm5vZGVUZXh0Q29udGVudEdldHRlciA9IGZ1bmN0aW9uICgpIHtcbiAgdmFyIG5hdGl2ZU5vZGUgPSB3aW5kb3cuTm9kZSB8fCBOb2RlO1xuICByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihuYXRpdmVOb2RlLnByb3RvdHlwZSwgJ3RleHRDb250ZW50JykuZ2V0O1xufSgpO1xuXG51dGlscy5pc1NhZmFyaUJyb3dzZXIgPSBmdW5jdGlvbiAoKSB7XG4gIHZhciBpc0Nocm9tZSA9IG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignQ2hyb21lJykgPiAtMTtcbiAgdmFyIGlzU2FmYXJpID0gbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCdTYWZhcmknKSA+IC0xO1xuXG4gIGlmIChpc1NhZmFyaSkge1xuICAgIGlmIChpc0Nocm9tZSkge1xuICAgICAgLy8gQ2hyb21lIHNlZW1zIHRvIGhhdmUgYm90aCBDaHJvbWUgYW5kIFNhZmFyaSB1c2VyQWdlbnRzXG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICByZXR1cm4gZmFsc2U7XG59KCk7XG4vKipcbiAqIENvbnZlcnRzIHJlZ3VsYXIgZXhwcmVzc2lvbnMgcGFzc2VkIGFzIHBzZXVkbyBjbGFzcyBhcmd1bWVudHMgaW50byBSZWdFeHAgaW5zdGFuY2VzLlxuICogSGF2ZSB0byB1bmVzY2FwZSBkb3VibGVxdW90ZSBcIiBhcyB3ZWxsLCBiZWNhdXNlIHdlIGVzY2FwZSB0aGVtIHdoaWxlIGVuY2xvc2luZyBzdWNoXG4gKiBhcmd1bWVudHMgd2l0aCBkb3VibGVxdW90ZXMsIGFuZCBzaXp6bGUgZG9lcyBub3QgYXV0b21hdGljYWxseSB1bmVzY2FwZXMgdGhlbS5cbiAqL1xuXG5cbnV0aWxzLnBzZXVkb0FyZ1RvUmVnZXggPSBmdW5jdGlvbiAocmVnZXhTcmMsIGZsYWcpIHtcbiAgZmxhZyA9IGZsYWcgfHwgJ2knO1xuICByZWdleFNyYyA9IHJlZ2V4U3JjLnRyaW0oKS5yZXBsYWNlKC9cXFxcKFtcIlxcXFxdKS9nLCAnJDEnKTtcbiAgcmV0dXJuIG5ldyBSZWdFeHAocmVnZXhTcmMsIGZsYWcpO1xufTtcbi8qKlxuICogQ29udmVydHMgc3RyaW5nIHRvIHRoZSByZWdleHBcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHJcbiAqIEByZXR1cm5zIHtSZWdFeHB9XG4gKi9cblxuXG51dGlscy50b1JlZ0V4cCA9IGZ1bmN0aW9uIChzdHIpIHtcbiAgaWYgKHN0clswXSA9PT0gJy8nICYmIHN0cltzdHIubGVuZ3RoIC0gMV0gPT09ICcvJykge1xuICAgIHJldHVybiBuZXcgUmVnRXhwKHN0ci5zbGljZSgxLCAtMSkpO1xuICB9XG5cbiAgdmFyIGVzY2FwZWQgPSBzdHIucmVwbGFjZSgvWy4qKz9eJHt9KCl8W1xcXVxcXFxdL2csICdcXFxcJCYnKTtcbiAgcmV0dXJuIG5ldyBSZWdFeHAoZXNjYXBlZCk7XG59O1xuXG51dGlscy5zdGFydHNXaXRoID0gZnVuY3Rpb24gKHN0ciwgcHJlZml4KSB7XG4gIC8vIGlmIHN0ciA9PT0gJycsIChzdHIgJiYgZmFsc2UpIHdpbGwgcmV0dXJuICcnXG4gIC8vIHRoYXQncyB3aHkgaXQgaGFzIHRvIGJlICEhc3RyXG4gIHJldHVybiAhIXN0ciAmJiBzdHIuaW5kZXhPZihwcmVmaXgpID09PSAwO1xufTtcblxudXRpbHMuZW5kc1dpdGggPSBmdW5jdGlvbiAoc3RyLCBwb3N0Zml4KSB7XG4gIGlmICghc3RyIHx8ICFwb3N0Zml4KSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgaWYgKHN0ci5lbmRzV2l0aCkge1xuICAgIHJldHVybiBzdHIuZW5kc1dpdGgocG9zdGZpeCk7XG4gIH1cblxuICB2YXIgdCA9IFN0cmluZyhwb3N0Zml4KTtcbiAgdmFyIGluZGV4ID0gc3RyLmxhc3RJbmRleE9mKHQpO1xuICByZXR1cm4gaW5kZXggPj0gMCAmJiBpbmRleCA9PT0gc3RyLmxlbmd0aCAtIHQubGVuZ3RoO1xufTtcbi8qKlxuICogSGVscGVyIGZ1bmN0aW9uIGZvciBjcmVhdGluZyByZWd1bGFyIGV4cHJlc3Npb24gZnJvbSBhIHVybCBmaWx0ZXIgcnVsZSBzeW50YXguXG4gKi9cblxuXG51dGlscy5jcmVhdGVVUkxSZWdleCA9IGZ1bmN0aW9uICgpIHtcbiAgLy8gQ29uc3RhbnRzXG4gIHZhciByZWdleENvbmZpZ3VyYXRpb24gPSB7XG4gICAgbWFza1N0YXJ0VXJsOiAnfHwnLFxuICAgIG1hc2tQaXBlOiAnfCcsXG4gICAgbWFza1NlcGFyYXRvcjogJ14nLFxuICAgIG1hc2tBbnlTeW1ib2w6ICcqJyxcbiAgICByZWdleEFueVN5bWJvbDogJy4qJyxcbiAgICByZWdleFNlcGFyYXRvcjogJyhbXiBhLXpBLVowLTkuJV8tXXwkKScsXG4gICAgcmVnZXhTdGFydFVybDogJ14oaHR0cHxodHRwc3x3c3x3c3MpOi8vKFthLXowLTktXy5dK1xcXFwuKT8nLFxuICAgIHJlZ2V4U3RhcnRTdHJpbmc6ICdeJyxcbiAgICByZWdleEVuZFN0cmluZzogJyQnXG4gIH07IC8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL3JlZ2V4cFxuICAvLyBzaG91bGQgYmUgZXNjYXBlZCAuICogKyA/IF4gJCB7IH0gKCApIHwgWyBdIC8gXFxcbiAgLy8gZXhjZXB0IG9mICogfCBeXG5cbiAgdmFyIHNwZWNpYWxzID0gWycuJywgJysnLCAnPycsICckJywgJ3snLCAnfScsICcoJywgJyknLCAnWycsICddJywgJ1xcXFwnLCAnLyddO1xuICB2YXIgc3BlY2lhbHNSZWdleCA9IG5ldyBSZWdFeHAoXCJbXCIuY29uY2F0KHNwZWNpYWxzLmpvaW4oJ1xcXFwnKSwgXCJdXCIpLCAnZycpO1xuICAvKipcbiAgICogRXNjYXBlcyByZWd1bGFyIGV4cHJlc3Npb24gc3RyaW5nXG4gICAqL1xuXG4gIHZhciBlc2NhcGVSZWdFeHAgPSBmdW5jdGlvbiBlc2NhcGVSZWdFeHAoc3RyKSB7XG4gICAgcmV0dXJuIHN0ci5yZXBsYWNlKHNwZWNpYWxzUmVnZXgsICdcXFxcJCYnKTtcbiAgfTtcblxuICB2YXIgcmVwbGFjZUFsbCA9IGZ1bmN0aW9uIHJlcGxhY2VBbGwoc3RyLCBmaW5kLCByZXBsYWNlKSB7XG4gICAgaWYgKCFzdHIpIHtcbiAgICAgIHJldHVybiBzdHI7XG4gICAgfVxuXG4gICAgcmV0dXJuIHN0ci5zcGxpdChmaW5kKS5qb2luKHJlcGxhY2UpO1xuICB9O1xuICAvKipcbiAgICogTWFpbiBmdW5jdGlvbiB0aGF0IGNvbnZlcnRzIGEgdXJsIGZpbHRlciBydWxlIHN0cmluZyB0byBhIHJlZ2V4LlxuICAgKiBAcGFyYW0ge3N0cmluZ30gc3RyXG4gICAqIEByZXR1cm4ge1JlZ0V4cH1cbiAgICovXG5cblxuICB2YXIgY3JlYXRlUmVnZXhUZXh0ID0gZnVuY3Rpb24gY3JlYXRlUmVnZXhUZXh0KHN0cikge1xuICAgIHZhciByZWdleCA9IGVzY2FwZVJlZ0V4cChzdHIpO1xuXG4gICAgaWYgKHV0aWxzLnN0YXJ0c1dpdGgocmVnZXgsIHJlZ2V4Q29uZmlndXJhdGlvbi5tYXNrU3RhcnRVcmwpKSB7XG4gICAgICByZWdleCA9IHJlZ2V4LnN1YnN0cmluZygwLCByZWdleENvbmZpZ3VyYXRpb24ubWFza1N0YXJ0VXJsLmxlbmd0aCkgKyByZXBsYWNlQWxsKHJlZ2V4LnN1YnN0cmluZyhyZWdleENvbmZpZ3VyYXRpb24ubWFza1N0YXJ0VXJsLmxlbmd0aCwgcmVnZXgubGVuZ3RoIC0gMSksICdcXHwnLCAnXFxcXHwnKSArIHJlZ2V4LnN1YnN0cmluZyhyZWdleC5sZW5ndGggLSAxKTtcbiAgICB9IGVsc2UgaWYgKHV0aWxzLnN0YXJ0c1dpdGgocmVnZXgsIHJlZ2V4Q29uZmlndXJhdGlvbi5tYXNrUGlwZSkpIHtcbiAgICAgIHJlZ2V4ID0gcmVnZXguc3Vic3RyaW5nKDAsIHJlZ2V4Q29uZmlndXJhdGlvbi5tYXNrUGlwZS5sZW5ndGgpICsgcmVwbGFjZUFsbChyZWdleC5zdWJzdHJpbmcocmVnZXhDb25maWd1cmF0aW9uLm1hc2tQaXBlLmxlbmd0aCwgcmVnZXgubGVuZ3RoIC0gMSksICdcXHwnLCAnXFxcXHwnKSArIHJlZ2V4LnN1YnN0cmluZyhyZWdleC5sZW5ndGggLSAxKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVnZXggPSByZXBsYWNlQWxsKHJlZ2V4LnN1YnN0cmluZygwLCByZWdleC5sZW5ndGggLSAxKSwgJ1xcfCcsICdcXFxcfCcpICsgcmVnZXguc3Vic3RyaW5nKHJlZ2V4Lmxlbmd0aCAtIDEpO1xuICAgIH0gLy8gUmVwbGFjaW5nIHNwZWNpYWwgdXJsIG1hc2tzXG5cblxuICAgIHJlZ2V4ID0gcmVwbGFjZUFsbChyZWdleCwgcmVnZXhDb25maWd1cmF0aW9uLm1hc2tBbnlTeW1ib2wsIHJlZ2V4Q29uZmlndXJhdGlvbi5yZWdleEFueVN5bWJvbCk7XG4gICAgcmVnZXggPSByZXBsYWNlQWxsKHJlZ2V4LCByZWdleENvbmZpZ3VyYXRpb24ubWFza1NlcGFyYXRvciwgcmVnZXhDb25maWd1cmF0aW9uLnJlZ2V4U2VwYXJhdG9yKTtcblxuICAgIGlmICh1dGlscy5zdGFydHNXaXRoKHJlZ2V4LCByZWdleENvbmZpZ3VyYXRpb24ubWFza1N0YXJ0VXJsKSkge1xuICAgICAgcmVnZXggPSByZWdleENvbmZpZ3VyYXRpb24ucmVnZXhTdGFydFVybCArIHJlZ2V4LnN1YnN0cmluZyhyZWdleENvbmZpZ3VyYXRpb24ubWFza1N0YXJ0VXJsLmxlbmd0aCk7XG4gICAgfSBlbHNlIGlmICh1dGlscy5zdGFydHNXaXRoKHJlZ2V4LCByZWdleENvbmZpZ3VyYXRpb24ubWFza1BpcGUpKSB7XG4gICAgICByZWdleCA9IHJlZ2V4Q29uZmlndXJhdGlvbi5yZWdleFN0YXJ0U3RyaW5nICsgcmVnZXguc3Vic3RyaW5nKHJlZ2V4Q29uZmlndXJhdGlvbi5tYXNrUGlwZS5sZW5ndGgpO1xuICAgIH1cblxuICAgIGlmICh1dGlscy5lbmRzV2l0aChyZWdleCwgcmVnZXhDb25maWd1cmF0aW9uLm1hc2tQaXBlKSkge1xuICAgICAgcmVnZXggPSByZWdleC5zdWJzdHJpbmcoMCwgcmVnZXgubGVuZ3RoIC0gMSkgKyByZWdleENvbmZpZ3VyYXRpb24ucmVnZXhFbmRTdHJpbmc7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5ldyBSZWdFeHAocmVnZXgsICdpJyk7XG4gIH07XG5cbiAgcmV0dXJuIGNyZWF0ZVJlZ2V4VGV4dDtcbn0oKTtcbi8qKlxuICogQ3JlYXRlcyBhbiBvYmplY3QgaW1wbGVtZW50aW5nIExvY2F0aW9uIGludGVyZmFjZSBmcm9tIGEgdXJsLlxuICogQW4gYWx0ZXJuYXRpdmUgdG8gVVJMLlxuICogaHR0cHM6Ly9naXRodWIuY29tL0FkZ3VhcmRUZWFtL0ZpbmdlcnByaW50aW5nQmxvY2tlci9ibG9iL21hc3Rlci9zcmMvc2hhcmVkL3VybC50cyNMNjRcbiAqL1xuXG5cbnV0aWxzLmNyZWF0ZUxvY2F0aW9uID0gZnVuY3Rpb24gKGhyZWYpIHtcbiAgdmFyIGFuY2hvciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcbiAgYW5jaG9yLmhyZWYgPSBocmVmO1xuXG4gIGlmIChhbmNob3IuaG9zdCA9PT0gJycpIHtcbiAgICBhbmNob3IuaHJlZiA9IGFuY2hvci5ocmVmOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXNlbGYtYXNzaWduXG4gIH1cblxuICByZXR1cm4gYW5jaG9yO1xufTtcbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgQSBoYXMgdGhlIHNhbWUgb3JpZ2luIGFzIEIuXG4gKiBAcGFyYW0ge3N0cmluZ30gdXJsQSBsb2NhdGlvbi5ocmVmIG9mIEEuXG4gKiBAcGFyYW0ge0xvY2F0aW9ufSBsb2NhdGlvbkIgbG9jYXRpb24gb2YgQi5cbiAqIEBwYXJhbSB7c3RyaW5nfSBkb21haW5CIGRvY3VtZW50LmRvbWFpbiBvZiBCLlxuICogQHJldHVybiB7Ym9vbGVhbn1cbiAqL1xuXG5cbnV0aWxzLmlzU2FtZU9yaWdpbiA9IGZ1bmN0aW9uICh1cmxBLCBsb2NhdGlvbkIsIGRvbWFpbkIpIHtcbiAgdmFyIGxvY2F0aW9uQSA9IHV0aWxzLmNyZWF0ZUxvY2F0aW9uKHVybEEpOyAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tc2NyaXB0LXVybFxuXG4gIGlmIChsb2NhdGlvbkEucHJvdG9jb2wgPT09ICdqYXZhc2NyaXB0OicgfHwgbG9jYXRpb25BLmhyZWYgPT09ICdhYm91dDpibGFuaycpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIGlmIChsb2NhdGlvbkEucHJvdG9jb2wgPT09ICdkYXRhOicgfHwgbG9jYXRpb25BLnByb3RvY29sID09PSAnZmlsZTonKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgcmV0dXJuIGxvY2F0aW9uQS5ob3N0bmFtZSA9PT0gZG9tYWluQiAmJiBsb2NhdGlvbkEucG9ydCA9PT0gbG9jYXRpb25CLnBvcnQgJiYgbG9jYXRpb25BLnByb3RvY29sID09PSBsb2NhdGlvbkIucHJvdG9jb2w7XG59O1xuLyoqXG4gKiBBIGhlbHBlciBjbGFzcyB0byB0aHJvdHRsZSBmdW5jdGlvbiBjYWxscyB3aXRoIHNldFRpbWVvdXQgYW5kIHJlcXVlc3RBbmltYXRpb25GcmFtZS5cbiAqL1xuXG5cbnV0aWxzLkFzeW5jV3JhcHBlciA9IGZ1bmN0aW9uICgpIHtcbiAgLyoqXG4gICAqIFBoYW50b21KUyBwYXNzZXMgYSB3cm9uZyB0aW1lc3RhbXAgdG8gdGhlIHJlcXVlc3RBbmltYXRpb25GcmFtZSBjYWxsYmFjayBhbmQgdGhhdCBicmVha3MgdGhlIEFzeW5jV3JhcHBlciBsb2dpY1xuICAgKiBodHRwczovL2dpdGh1Yi5jb20vYXJpeWEvcGhhbnRvbWpzL2lzc3Vlcy8xNDgzMlxuICAgKi9cbiAgdmFyIHN1cHBvcnRlZCA9IHR5cGVvZiB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lICE9PSAndW5kZWZpbmVkJyAmJiAhL3BoYW50b20vaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpO1xuICB2YXIgckFGID0gc3VwcG9ydGVkID8gcmVxdWVzdEFuaW1hdGlvbkZyYW1lIDogc2V0VGltZW91dDtcbiAgdmFyIGNBRiA9IHN1cHBvcnRlZCA/IGNhbmNlbEFuaW1hdGlvbkZyYW1lIDogY2xlYXJUaW1lb3V0O1xuICB2YXIgcGVyZiA9IHN1cHBvcnRlZCA/IHBlcmZvcm1hbmNlIDogRGF0ZTtcbiAgLyoqXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrXG4gICAqIEBwYXJhbSB7bnVtYmVyfSB0aHJvdHRsZSBudW1iZXIsIHRoZSBwcm92aWRlZCBjYWxsYmFjayBzaG91bGQgYmUgZXhlY3V0ZWQgdHdpY2VcbiAgICogaW4gdGhpcyB0aW1lIGZyYW1lLlxuICAgKiBAY29uc3RydWN0b3JcbiAgICovXG5cbiAgZnVuY3Rpb24gQXN5bmNXcmFwcGVyKGNhbGxiYWNrLCB0aHJvdHRsZSkge1xuICAgIHRoaXMuY2FsbGJhY2sgPSBjYWxsYmFjaztcbiAgICB0aGlzLnRocm90dGxlID0gdGhyb3R0bGU7XG4gICAgdGhpcy53cmFwcGVkQ2FsbGJhY2sgPSB0aGlzLndyYXBwZWRDYWxsYmFjay5iaW5kKHRoaXMpO1xuXG4gICAgaWYgKHRoaXMud3JhcHBlZEFzYXBDYWxsYmFjaykge1xuICAgICAgdGhpcy53cmFwcGVkQXNhcENhbGxiYWNrID0gdGhpcy53cmFwcGVkQXNhcENhbGxiYWNrLmJpbmQodGhpcyk7XG4gICAgfVxuICB9XG4gIC8qKiBAcHJpdmF0ZSAqL1xuXG5cbiAgQXN5bmNXcmFwcGVyLnByb3RvdHlwZS53cmFwcGVkQ2FsbGJhY2sgPSBmdW5jdGlvbiAodHMpIHtcbiAgICB0aGlzLmxhc3RSdW4gPSBpc051bWJlcih0cykgPyB0cyA6IHBlcmYubm93KCk7XG4gICAgZGVsZXRlIHRoaXMuckFGaWQ7XG4gICAgZGVsZXRlIHRoaXMudGltZXJJZDtcbiAgICBkZWxldGUgdGhpcy5hc2FwU2NoZWR1bGVkO1xuICAgIHRoaXMuY2FsbGJhY2soKTtcbiAgfTtcbiAgLyoqIEBwcml2YXRlIEluZGljYXRlcyB3aGV0aGVyIHRoZXJlIGlzIGEgc2NoZWR1bGVkIGNhbGxiYWNrLiAqL1xuXG5cbiAgQXN5bmNXcmFwcGVyLnByb3RvdHlwZS5oYXNQZW5kaW5nQ2FsbGJhY2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGlzTnVtYmVyKHRoaXMuckFGaWQpIHx8IGlzTnVtYmVyKHRoaXMudGltZXJJZCk7XG4gIH07XG4gIC8qKlxuICAgKiBTY2hlZHVsZXMgYSBmdW5jdGlvbiBjYWxsIGJlZm9yZSB0aGUgbmV4dCBhbmltYXRpb24gZnJhbWUuXG4gICAqL1xuXG5cbiAgQXN5bmNXcmFwcGVyLnByb3RvdHlwZS5ydW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKHRoaXMuaGFzUGVuZGluZ0NhbGxiYWNrKCkpIHtcbiAgICAgIC8vIFRoZXJlIGlzIGEgcGVuZGluZyBleGVjdXRpb24gc2NoZWR1bGVkLlxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2YgdGhpcy5sYXN0UnVuICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgdmFyIGVsYXBzZWQgPSBwZXJmLm5vdygpIC0gdGhpcy5sYXN0UnVuO1xuXG4gICAgICBpZiAoZWxhcHNlZCA8IHRoaXMudGhyb3R0bGUpIHtcbiAgICAgICAgdGhpcy50aW1lcklkID0gc2V0VGltZW91dCh0aGlzLndyYXBwZWRDYWxsYmFjaywgdGhpcy50aHJvdHRsZSAtIGVsYXBzZWQpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5yQUZpZCA9IHJBRih0aGlzLndyYXBwZWRDYWxsYmFjayk7XG4gIH07XG4gIC8qKlxuICAgKiBTY2hlZHVsZXMgYSBmdW5jdGlvbiBjYWxsIGluIHRoZSBtb3N0IGltbWVuZW50IG1pY3JvdGFzay5cbiAgICogVGhpcyBjYW5ub3QgYmUgY2FuY2VsZWQuXG4gICAqL1xuXG5cbiAgQXN5bmNXcmFwcGVyLnByb3RvdHlwZS5ydW5Bc2FwID0gZnVuY3Rpb24gKCkge1xuICAgIGlmICh0aGlzLmFzYXBTY2hlZHVsZWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmFzYXBTY2hlZHVsZWQgPSB0cnVlO1xuICAgIGNBRih0aGlzLnJBRmlkKTtcbiAgICBjbGVhclRpbWVvdXQodGhpcy50aW1lcklkKTtcblxuICAgIGlmICh1dGlscy5NdXRhdGlvbk9ic2VydmVyKSB7XG4gICAgICAvKipcbiAgICAgICAqIFVzaW5nIE11dGF0aW9uT2JzZXJ2ZXJzIHRvIGFjY2VzcyBtaWNyb3Rhc2sgcXVldWUgaXMgYSBzdGFuZGFyZCB0ZWNobmlxdWUsXG4gICAgICAgKiB1c2VkIGluIEFTQVAgbGlicmFyeVxuICAgICAgICoge0BsaW5rIGh0dHBzOi8vZ2l0aHViLmNvbS9rcmlza293YWwvYXNhcC9ibG9iL21hc3Rlci9icm93c2VyLXJhdy5qcyNMMTQwfVxuICAgICAgICovXG4gICAgICBpZiAoIXRoaXMubW8pIHtcbiAgICAgICAgdGhpcy5tbyA9IG5ldyB1dGlscy5NdXRhdGlvbk9ic2VydmVyKHRoaXMud3JhcHBlZENhbGxiYWNrKTtcbiAgICAgICAgdGhpcy5ub2RlID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoMSk7XG4gICAgICAgIHRoaXMubW8ub2JzZXJ2ZSh0aGlzLm5vZGUsIHtcbiAgICAgICAgICBjaGFyYWN0ZXJEYXRhOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICB0aGlzLm5vZGUubm9kZVZhbHVlID0gLXRoaXMubm9kZS5ub2RlVmFsdWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNldFRpbWVvdXQodGhpcy53cmFwcGVkQ2FsbGJhY2spO1xuICAgIH1cbiAgfTtcbiAgLyoqXG4gICAqIFJ1bnMgc2NoZWR1bGVkIGV4ZWN1dGlvbiBpbW1lZGlhdGVseSwgaWYgdGhlcmUgd2VyZSBhbnkuXG4gICAqL1xuXG5cbiAgQXN5bmNXcmFwcGVyLnByb3RvdHlwZS5ydW5JbW1lZGlhdGVseSA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAodGhpcy5oYXNQZW5kaW5nQ2FsbGJhY2soKSkge1xuICAgICAgY0FGKHRoaXMuckFGaWQpO1xuICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudGltZXJJZCk7XG4gICAgICBkZWxldGUgdGhpcy5yQUZpZDtcbiAgICAgIGRlbGV0ZSB0aGlzLnRpbWVySWQ7XG4gICAgICB0aGlzLndyYXBwZWRDYWxsYmFjaygpO1xuICAgIH1cbiAgfTtcblxuICBBc3luY1dyYXBwZXIubm93ID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBwZXJmLm5vdygpO1xuICB9O1xuXG4gIHJldHVybiBBc3luY1dyYXBwZXI7XG59KCk7XG4vKipcbiAqIFN0b3JlcyBuYXRpdmUgT2RQIHRvIGJlIHVzZWQgaW4gV2Vha01hcCBhbmQgU2V0IHBvbHlmaWxscy5cbiAqL1xuXG5cbnV0aWxzLmRlZmluZVByb3BlcnR5ID0gT2JqZWN0LmRlZmluZVByb3BlcnR5O1xudXRpbHMuV2Vha01hcCA9IHR5cGVvZiBXZWFrTWFwICE9PSAndW5kZWZpbmVkJyA/IFdlYWtNYXAgOiBmdW5jdGlvbiAoKSB7XG4gIC8qKiBPcmlnaW5hbGx5IGJhc2VkIG9uIHtAbGluayBodHRwczovL2dpdGh1Yi5jb20vUG9seW1lci9XZWFrTWFwfSAqL1xuICB2YXIgY291bnRlciA9IERhdGUubm93KCkgJSAxZTk7XG5cbiAgdmFyIFdlYWtNYXAgPSBmdW5jdGlvbiBXZWFrTWFwKCkge1xuICAgIHRoaXMubmFtZSA9IFwiX19zdFwiLmNvbmNhdChNYXRoLnJhbmRvbSgpICogMWU5ID4+PiAwKS5jb25jYXQoY291bnRlcisrLCBcIl9fXCIpO1xuICB9O1xuXG4gIFdlYWtNYXAucHJvdG90eXBlID0ge1xuICAgIHNldDogZnVuY3Rpb24gc2V0KGtleSwgdmFsdWUpIHtcbiAgICAgIHZhciBlbnRyeSA9IGtleVt0aGlzLm5hbWVdO1xuXG4gICAgICBpZiAoZW50cnkgJiYgZW50cnlbMF0gPT09IGtleSkge1xuICAgICAgICBlbnRyeVsxXSA9IHZhbHVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdXRpbHMuZGVmaW5lUHJvcGVydHkoa2V5LCB0aGlzLm5hbWUsIHtcbiAgICAgICAgICB2YWx1ZTogW2tleSwgdmFsdWVdLFxuICAgICAgICAgIHdyaXRhYmxlOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuICAgIGdldDogZnVuY3Rpb24gZ2V0KGtleSkge1xuICAgICAgdmFyIGVudHJ5ID0ga2V5W3RoaXMubmFtZV07XG4gICAgICByZXR1cm4gZW50cnkgJiYgZW50cnlbMF0gPT09IGtleSA/IGVudHJ5WzFdIDogdW5kZWZpbmVkO1xuICAgIH0sXG4gICAgZGVsZXRlOiBmdW5jdGlvbiBfZGVsZXRlKGtleSkge1xuICAgICAgdmFyIGVudHJ5ID0ga2V5W3RoaXMubmFtZV07XG5cbiAgICAgIGlmICghZW50cnkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuXG4gICAgICB2YXIgaGFzVmFsdWUgPSBlbnRyeVswXSA9PT0ga2V5O1xuICAgICAgZGVsZXRlIGVudHJ5WzBdO1xuICAgICAgZGVsZXRlIGVudHJ5WzFdO1xuICAgICAgcmV0dXJuIGhhc1ZhbHVlO1xuICAgIH0sXG4gICAgaGFzOiBmdW5jdGlvbiBoYXMoa2V5KSB7XG4gICAgICB2YXIgZW50cnkgPSBrZXlbdGhpcy5uYW1lXTtcblxuICAgICAgaWYgKCFlbnRyeSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBlbnRyeVswXSA9PT0ga2V5O1xuICAgIH1cbiAgfTtcbiAgcmV0dXJuIFdlYWtNYXA7XG59KCk7XG51dGlscy5TZXQgPSB0eXBlb2YgU2V0ICE9PSAndW5kZWZpbmVkJyA/IFNldCA6IGZ1bmN0aW9uICgpIHtcbiAgdmFyIGNvdW50ZXIgPSBEYXRlLm5vdygpICUgMWU5O1xuICAvKipcbiAgICogQSBwb2x5ZmlsbCB3aGljaCBjb3ZlcnMgb25seSB0aGUgYmFzaWMgdXNhZ2UuXG4gICAqIE9ubHkgc3VwcG9ydHMgbWV0aG9kcyB0aGF0IGFyZSBzdXBwb3J0ZWQgaW4gSUUxMS5cbiAgICoge0BsaW5rIGh0dHBzOi8vZG9jcy5taWNyb3NvZnQuY29tL2VuLXVzL3NjcmlwdGluZy9qYXZhc2NyaXB0L3JlZmVyZW5jZS9zZXQtb2JqZWN0LWphdmFzY3JpcHR9XG4gICAqIEFzc3VtZXMgdGhhdCAna2V5J3MgYXJlIGFsbCBvYmplY3RzLCBub3QgcHJpbWl0aXZlcyBzdWNoIGFzIGEgbnVtYmVyLlxuICAgKlxuICAgKiBAcGFyYW0ge0FycmF5fSBpdGVtcyBJbml0aWFsIGl0ZW1zIGluIHRoaXMgc2V0XG4gICAqL1xuXG4gIHZhciBTZXQgPSBmdW5jdGlvbiBTZXQoaXRlbXMpIHtcbiAgICB0aGlzLm5hbWUgPSBcIl9fc3RcIi5jb25jYXQoTWF0aC5yYW5kb20oKSAqIDFlOSA+Pj4gMCkuY29uY2F0KGNvdW50ZXIrKywgXCJfX1wiKTtcbiAgICB0aGlzLmtleXMgPSBbXTtcblxuICAgIGlmIChpdGVtcyAmJiBpdGVtcy5sZW5ndGgpIHtcbiAgICAgIHZhciBpSXRlbXMgPSBpdGVtcy5sZW5ndGg7XG5cbiAgICAgIHdoaWxlIChpSXRlbXMtLSkge1xuICAgICAgICB0aGlzLmFkZChpdGVtc1tpSXRlbXNdKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgU2V0LnByb3RvdHlwZSA9IHtcbiAgICBhZGQ6IGZ1bmN0aW9uIGFkZChrZXkpIHtcbiAgICAgIGlmICghaXNOdW1iZXIoa2V5W3RoaXMubmFtZV0pKSB7XG4gICAgICAgIHZhciBpbmRleCA9IHRoaXMua2V5cy5wdXNoKGtleSkgLSAxO1xuICAgICAgICB1dGlscy5kZWZpbmVQcm9wZXJ0eShrZXksIHRoaXMubmFtZSwge1xuICAgICAgICAgIHZhbHVlOiBpbmRleCxcbiAgICAgICAgICB3cml0YWJsZTogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGRlbGV0ZTogZnVuY3Rpb24gX2RlbGV0ZShrZXkpIHtcbiAgICAgIGlmIChpc051bWJlcihrZXlbdGhpcy5uYW1lXSkpIHtcbiAgICAgICAgdmFyIGluZGV4ID0ga2V5W3RoaXMubmFtZV07XG4gICAgICAgIGRlbGV0ZSB0aGlzLmtleXNbaW5kZXhdO1xuICAgICAgICBrZXlbdGhpcy5uYW1lXSA9IHVuZGVmaW5lZDtcbiAgICAgIH1cbiAgICB9LFxuICAgIGhhczogZnVuY3Rpb24gaGFzKGtleSkge1xuICAgICAgcmV0dXJuIGlzTnVtYmVyKGtleVt0aGlzLm5hbWVdKTtcbiAgICB9LFxuICAgIGNsZWFyOiBmdW5jdGlvbiBjbGVhcigpIHtcbiAgICAgIHRoaXMua2V5cy5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAga2V5W3RoaXMubmFtZV0gPSB1bmRlZmluZWQ7XG4gICAgICB9KTtcbiAgICAgIHRoaXMua2V5cy5sZW5ndGggPSAwO1xuICAgIH0sXG4gICAgZm9yRWFjaDogZnVuY3Rpb24gZm9yRWFjaChjYikge1xuICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgdGhpcy5rZXlzLmZvckVhY2goZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgIGNiKHZhbHVlLCB2YWx1ZSwgdGhhdCk7XG4gICAgICB9KTtcbiAgICB9XG4gIH07XG4gIHV0aWxzLmRlZmluZVByb3BlcnR5KFNldC5wcm90b3R5cGUsICdzaXplJywge1xuICAgIGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgLy8gU2tpcHMgaG9sZXMuXG4gICAgICByZXR1cm4gdGhpcy5rZXlzLnJlZHVjZShmdW5jdGlvbiAoYWNjKSB7XG4gICAgICAgIHJldHVybiBhY2MgKyAxO1xuICAgICAgfSwgMCk7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIFNldDtcbn0oKTtcbi8qKlxuICogVmVuZG9yLXNwZWNpZmljIEVsZW1lbnQucHJvdG90eXBlLm1hdGNoZXNcbiAqL1xuXG51dGlscy5tYXRjaGVzUHJvcGVydHlOYW1lID0gZnVuY3Rpb24gKCkge1xuICB2YXIgcHJvcHMgPSBbJ21hdGNoZXMnLCAnbWF0Y2hlc1NlbGVjdG9yJywgJ21vek1hdGNoZXNTZWxlY3RvcicsICdtc01hdGNoZXNTZWxlY3RvcicsICdvTWF0Y2hlc1NlbGVjdG9yJywgJ3dlYmtpdE1hdGNoZXNTZWxlY3RvciddO1xuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgNjsgaSsrKSB7XG4gICAgaWYgKEVsZW1lbnQucHJvdG90eXBlLmhhc093blByb3BlcnR5KHByb3BzW2ldKSkge1xuICAgICAgcmV0dXJuIHByb3BzW2ldO1xuICAgIH1cbiAgfVxufSgpO1xuLyoqXG4gKiBQcm92aWRlcyBzdGF0cyBpbmZvcm1hdGlvblxuICovXG5cblxudXRpbHMuU3RhdHMgPSBmdW5jdGlvbiAoKSB7XG4gIC8qKiBAbWVtYmVyIHtBcnJheTxudW1iZXI+fSAqL1xuICB0aGlzLmFycmF5ID0gW107XG4gIC8qKiBAbWVtYmVyIHtudW1iZXJ9ICovXG5cbiAgdGhpcy5sZW5ndGggPSAwO1xuICB2YXIgemVyb0Rlc2NyaXB0b3IgPSB7XG4gICAgdmFsdWU6IDAsXG4gICAgd3JpdGFibGU6IHRydWVcbiAgfTtcbiAgLyoqIEBtZW1iZXIge251bWJlcn0gQHByaXZhdGUgKi9cblxuICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgJ3N1bScsIHplcm9EZXNjcmlwdG9yKTtcbiAgLyoqIEBtZW1iZXIge251bWJlcn0gQHByaXZhdGUgKi9cblxuICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgJ3NxdWFyZWRTdW0nLCB6ZXJvRGVzY3JpcHRvcik7XG59O1xuLyoqXG4gKiBAcGFyYW0ge251bWJlcn0gZGF0YVBvaW50IGRhdGEgcG9pbnRcbiAqL1xuXG5cbnV0aWxzLlN0YXRzLnByb3RvdHlwZS5wdXNoID0gZnVuY3Rpb24gKGRhdGFQb2ludCkge1xuICB0aGlzLmFycmF5LnB1c2goZGF0YVBvaW50KTtcbiAgdGhpcy5sZW5ndGgrKztcbiAgdGhpcy5zdW0gKz0gZGF0YVBvaW50O1xuICB0aGlzLnNxdWFyZWRTdW0gKz0gZGF0YVBvaW50ICogZGF0YVBvaW50O1xuICAvKiogQG1lbWJlciB7bnVtYmVyfSAqL1xuXG4gIHRoaXMubWVhbiA9IHRoaXMuc3VtIC8gdGhpcy5sZW5ndGg7XG4gIC8qKiBAbWVtYmVyIHtudW1iZXJ9ICovXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1yZXN0cmljdGVkLXByb3BlcnRpZXNcblxuICB0aGlzLnN0ZGRldiA9IE1hdGguc3FydCh0aGlzLnNxdWFyZWRTdW0gLyB0aGlzLmxlbmd0aCAtIE1hdGgucG93KHRoaXMubWVhbiwgMikpO1xufTtcbi8qKiBTYWZlIGNvbnNvbGUuZXJyb3IgdmVyc2lvbiAqL1xuXG5cbnV0aWxzLmxvZ0Vycm9yID0gdHlwZW9mIGNvbnNvbGUgIT09ICd1bmRlZmluZWQnICYmIGNvbnNvbGUuZXJyb3IgJiYgRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQgJiYgY29uc29sZS5lcnJvci5iaW5kID8gY29uc29sZS5lcnJvci5iaW5kKHdpbmRvdy5jb25zb2xlKSA6IGNvbnNvbGUuZXJyb3I7XG4vKiogU2FmZSBjb25zb2xlLmluZm8gdmVyc2lvbiAqL1xuXG51dGlscy5sb2dJbmZvID0gdHlwZW9mIGNvbnNvbGUgIT09ICd1bmRlZmluZWQnICYmIGNvbnNvbGUuaW5mbyAmJiBGdW5jdGlvbi5wcm90b3R5cGUuYmluZCAmJiBjb25zb2xlLmluZm8uYmluZCA/IGNvbnNvbGUuaW5mby5iaW5kKHdpbmRvdy5jb25zb2xlKSA6IGNvbnNvbGUuaW5mbztcblxuZnVuY3Rpb24gaXNOdW1iZXIob2JqKSB7XG4gIHJldHVybiB0eXBlb2Ygb2JqID09PSAnbnVtYmVyJztcbn1cbi8qKlxuICogUmV0dXJucyBwYXRoIHRvIGVsZW1lbnQgd2Ugd2lsbCB1c2UgYXMgZWxlbWVudCBpZGVudGlmaWVyXG4gKiBAcGFyYW0ge0VsZW1lbnR9IGlucHV0RWxcbiAqIEByZXR1cm5zIHtzdHJpbmd9IC0gcGF0aCB0byB0aGUgZWxlbWVudFxuICovXG5cblxudXRpbHMuZ2V0Tm9kZVNlbGVjdG9yID0gZnVuY3Rpb24gKGlucHV0RWwpIHtcbiAgaWYgKCEoaW5wdXRFbCBpbnN0YW5jZW9mIEVsZW1lbnQpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdGdW5jdGlvbiByZWNlaXZlZCBhcmd1bWVudCB3aXRoIHdyb25nIHR5cGUnKTtcbiAgfVxuXG4gIHZhciBlbCA9IGlucHV0RWw7XG4gIHZhciBwYXRoID0gW107IC8vIHdlIG5lZWQgdG8gY2hlY2sgJyEhZWwnIGZpcnN0IGJlY2F1c2UgaXQgaXMgcG9zc2libGVcbiAgLy8gdGhhdCBzb21lIGFuY2VzdG9yIG9mIHRoZSBpbnB1dEVsIHdhcyByZW1vdmVkIGJlZm9yZSBpdFxuXG4gIHdoaWxlICghIWVsICYmIGVsLm5vZGVUeXBlID09PSBOb2RlLkVMRU1FTlRfTk9ERSkge1xuICAgIHZhciBzZWxlY3RvciA9IGVsLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7XG5cbiAgICBpZiAoZWwuaWQgJiYgdHlwZW9mIGVsLmlkID09PSAnc3RyaW5nJykge1xuICAgICAgc2VsZWN0b3IgKz0gXCIjXCIuY29uY2F0KGVsLmlkKTtcbiAgICAgIHBhdGgudW5zaGlmdChzZWxlY3Rvcik7XG4gICAgICBicmVhaztcbiAgICB9IGVsc2Uge1xuICAgICAgdmFyIHNpYmxpbmcgPSBlbDtcbiAgICAgIHZhciBudGggPSAxO1xuXG4gICAgICB3aGlsZSAoc2libGluZy5wcmV2aW91c1NpYmxpbmcpIHtcbiAgICAgICAgc2libGluZyA9IHNpYmxpbmcucHJldmlvdXNTaWJsaW5nO1xuXG4gICAgICAgIGlmIChzaWJsaW5nLm5vZGVUeXBlID09PSBOb2RlLkVMRU1FTlRfTk9ERSAmJiBzaWJsaW5nLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IHNlbGVjdG9yKSB7XG4gICAgICAgICAgbnRoKys7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKG50aCAhPT0gMSkge1xuICAgICAgICBzZWxlY3RvciArPSBcIjpudGgtb2YtdHlwZShcIi5jb25jYXQobnRoLCBcIilcIik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcGF0aC51bnNoaWZ0KHNlbGVjdG9yKTtcbiAgICBlbCA9IGVsLnBhcmVudE5vZGU7XG4gIH1cblxuICByZXR1cm4gcGF0aC5qb2luKCcgPiAnKTtcbn07XG5cbi8qKlxuICogQ29weXJpZ2h0IDIwMTYgQWRndWFyZCBTb2Z0d2FyZSBMdGRcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG4vKipcbiAqIEhlbHBlciBjbGFzcyBjc3MgdXRpbHNcbiAqXG4gKiBAdHlwZSB7e25vcm1hbGl6ZX19XG4gKi9cbnZhciBjc3NVdGlscyA9IGZ1bmN0aW9uICgpIHtcbiAgLyoqXG4gICAqIFJlZ2V4IHRoYXQgbWF0Y2hlcyBBZEd1YXJkJ3MgYmFja3dhcmQgY29tcGF0aWJsZSBzeW50YXhlcy5cbiAgICovXG4gIHZhciByZUF0dHJGYWxsYmFjayA9IC9cXFstKD86ZXh0fGFicCktKFthLXotX10rKT0oW1wiJ10pKCg/Oig/PShcXFxcPykpXFw0LikqPylcXDJcXF0vZztcbiAgLyoqXG4gICAqIENvbXBsZXggcmVwbGFjZW1lbnQgZnVuY3Rpb24uXG4gICAqIFVuZXNjYXBlcyBxdW90ZSBjaGFyYWN0ZXJzIGluc2lkZSBvZiBhbiBleHRlbmRlZCBzZWxlY3Rvci5cbiAgICpcbiAgICogQHBhcmFtIG1hdGNoICAgICBXaG9sZSBtYXRjaGVkIHN0cmluZ1xuICAgKiBAcGFyYW0gbmFtZSAgICAgIEdyb3VwIDFcbiAgICogQHBhcmFtIHF1b3RlQ2hhciBHcm91cCAyXG4gICAqIEBwYXJhbSB2YWx1ZSAgICAgR3JvdXAgM1xuICAgKi9cblxuICB2YXIgZXZhbHVhdGVNYXRjaCA9IGZ1bmN0aW9uIGV2YWx1YXRlTWF0Y2gobWF0Y2gsIG5hbWUsIHF1b3RlQ2hhciwgdmFsdWUpIHtcbiAgICAvLyBVbmVzY2FwZSBxdW90ZXNcbiAgICB2YXIgcmUgPSBuZXcgUmVnRXhwKFwiKFteXFxcXFxcXFxdfF4pXFxcXFxcXFxcIi5jb25jYXQocXVvdGVDaGFyKSwgJ2cnKTtcbiAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UocmUsIFwiJDFcIi5jb25jYXQocXVvdGVDaGFyKSk7XG4gICAgcmV0dXJuIFwiOlwiLmNvbmNhdChuYW1lLCBcIihcIikuY29uY2F0KHZhbHVlLCBcIilcIik7XG4gIH07IC8vIFNpenpsZSdzIHBhcnNpbmcgb2YgcHNldWRvIGNsYXNzIGFyZ3VtZW50cyBpcyBidWdneSBvbiBjZXJ0YWluIGNpcmN1bXN0YW5jZXNcbiAgLy8gV2Ugc3VwcG9ydCBmb2xsb3dpbmcgZm9ybSBvZiBhcmd1bWVudHM6XG4gIC8vIDEuIGZvciA6bWF0Y2hlcy1jc3MsIHRob3NlIG9mIGEgZm9ybSB7cHJvcGVydHlOYW1lfTogLy4qL1xuICAvLyAyLiBmb3IgOmNvbnRhaW5zLCB0aG9zZSBvZiBhIGZvcm0gLy4qL1xuICAvLyBXZSB0cmFuc2Zvcm0gc3VjaCBjYXNlcyBpbiBhIHdheSB0aGF0IFNpenpsZSBoYXMgbm8gYW1iaWd1aXR5IGluIHBhcnNpbmcgYXJndW1lbnRzLlxuXG5cbiAgdmFyIHJlTWF0Y2hlc0NzcyA9IC9cXDoobWF0Y2hlcy1jc3MoPzotYWZ0ZXJ8LWJlZm9yZSk/KVxcKChbYS16LVxcc10qXFw6XFxzKlxcLyg/OlxcXFwufFteXFwvXSkqP1xcL1xccyopXFwpL2c7XG4gIHZhciByZUNvbnRhaW5zID0gLzooPzotYWJwLSk/KGNvbnRhaW5zfGhhcy10ZXh0KVxcKChcXHMqXFwvKD86XFxcXC58W15cXC9dKSo/XFwvXFxzKilcXCkvZztcbiAgdmFyIHJlU2NvcGUgPSAvXFwoXFw6c2NvcGUgPi9nOyAvLyBOb3RlIHRoYXQgd2UgcmVxdWlyZSBgL2AgY2hhcmFjdGVyIGluIHJlZ3VsYXIgZXhwcmVzc2lvbnMgdG8gYmUgZXNjYXBlZC5cblxuICAvKipcbiAgICogVXNlZCBmb3IgcHJlLXByb2Nlc3NpbmcgcHNldWRvLWNsYXNzZXMgdmFsdWVzIHdpdGggYWJvdmUgdHdvIHJlZ2V4ZXMuXG4gICAqL1xuXG4gIHZhciBhZGRRdW90ZXMgPSBmdW5jdGlvbiBhZGRRdW90ZXMoXywgYzEsIGMyKSB7XG4gICAgcmV0dXJuIFwiOlwiLmNvbmNhdChjMSwgXCIoXFxcIlwiKS5jb25jYXQoYzIucmVwbGFjZSgvW1wiXFxcXF0vZywgJ1xcXFwkJicpLCBcIlxcXCIpXCIpO1xuICB9O1xuXG4gIHZhciBTQ09QRV9SRVBMQUNFUiA9ICcoPic7XG4gIC8qKlxuICAgKiBOb3JtYWxpemVzIHNwZWNpZmllZCBjc3MgdGV4dCBpbiBhIGZvcm0gdGhhdCBjYW4gYmUgcGFyc2VkIGJ5IHRoZVxuICAgKiBTaXp6bGUgZW5naW5lLlxuICAgKiBOb3JtYWxpemF0aW9uIG1lYW5zXG4gICAqICAxLiB0cmFuc2Zvcm1pbmcgWy1leHQtKj1cIlwiXSBhdHRyaWJ1dGVzIHRvIHBzZXVkbyBjbGFzc2VzXG4gICAqICAyLiBlbmNsb3NpbmcgcG9zc2libHkgYW1iaWd1b3VzIGFyZ3VtZW50cyBvZiBgOmNvbnRhaW5zYCxcbiAgICogICAgIGA6bWF0Y2hlcy1jc3NgIHBzZXVkbyBjbGFzc2VzIHdpdGggcXVvdGVzLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gY3NzVGV4dFxuICAgKiBAcmV0dXJuIHtzdHJpbmd9XG4gICAqL1xuXG4gIHZhciBub3JtYWxpemUgPSBmdW5jdGlvbiBub3JtYWxpemUoY3NzVGV4dCkge1xuICAgIHZhciBub3JtYWxpemVkQ3NzVGV4dCA9IGNzc1RleHQucmVwbGFjZShyZUF0dHJGYWxsYmFjaywgZXZhbHVhdGVNYXRjaCkucmVwbGFjZShyZU1hdGNoZXNDc3MsIGFkZFF1b3RlcykucmVwbGFjZShyZUNvbnRhaW5zLCBhZGRRdW90ZXMpLnJlcGxhY2UocmVTY29wZSwgU0NPUEVfUkVQTEFDRVIpO1xuICAgIHJldHVybiBub3JtYWxpemVkQ3NzVGV4dDtcbiAgfTtcblxuICB2YXIgaXNTaW1wbGVTZWxlY3RvclZhbGlkID0gZnVuY3Rpb24gaXNTaW1wbGVTZWxlY3RvclZhbGlkKHNlbGVjdG9yKSB7XG4gICAgdHJ5IHtcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIG5vcm1hbGl6ZTogbm9ybWFsaXplLFxuICAgIGlzU2ltcGxlU2VsZWN0b3JWYWxpZDogaXNTaW1wbGVTZWxlY3RvclZhbGlkXG4gIH07XG59KCk7XG5cbi8qIVxuICogU2l6emxlIENTUyBTZWxlY3RvciBFbmdpbmUgdjIuMy40LXByZS1hZGd1YXJkXG4gKiBodHRwczovL3NpenpsZWpzLmNvbS9cbiAqXG4gKiBDb3B5cmlnaHQgSlMgRm91bmRhdGlvbiBhbmQgb3RoZXIgY29udHJpYnV0b3JzXG4gKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2VcbiAqIGh0dHBzOi8vanMuZm91bmRhdGlvbi9cbiAqXG4gKiBEYXRlOiAyMDIwLTA4LTA0XG4gKi9cblxuLyoqXG4gKiBWZXJzaW9uIG9mIFNpenpsZSBwYXRjaGVkIGJ5IEFkR3VhcmQgaW4gb3JkZXIgdG8gYmUgdXNlZCBpbiB0aGUgRXh0ZW5kZWRDc3MgbW9kdWxlLlxuICogaHR0cHM6Ly9naXRodWIuY29tL0FkZ3VhcmRUZWFtL3NpenpsZS1leHRjc3NcbiAqXG4gKiBMb29rIGZvciBbQWRHdWFyZCBQYXRjaF0gYW5kIEFER1VBUkRfRVhUQ1NTIG1hcmtlcnMgdG8gZmluZCBvdXQgd2hhdCBleGFjdGx5IHdhcyBjaGFuZ2VkIGJ5IHVzLlxuICpcbiAqIEdsb2JhbCBjaGFuZ2VzOlxuICogMS4gQWRkZWQgYWRkaXRpb25hbCBwYXJhbWV0ZXJzIHRvIHRoZSBcIlNpenpsZS50b2tlbml6ZVwiIG1ldGhvZCBzbyB0aGF0IGl0IGNhbiBiZSB1c2VkIGZvciBzdHlsZXNoZWV0cyBwYXJzaW5nIGFuZCB2YWxpZGF0aW9uLlxuICogMi4gQWRkZWQgdG9rZW5zIHJlLXNvcnRpbmcgbWVjaGFuaXNtIGZvcmNpbmcgc2xvdyBwc2V1ZG9zIHRvIGJlIG1hdGNoZWQgbGFzdCAgKHNlZSBzb3J0VG9rZW5Hcm91cHMpLlxuICogMy4gRml4IHRoZSBub25uYXRpdmVTZWxlY3RvckNhY2hlIGNhY2hpbmcgLS0gdGhlcmUgd2FzIG5vIHZhbHVlIGNvcnJlc3BvbmRpbmcgdG8gYSBrZXkuXG4gKiA0LiBBZGRlZCBTaXp6bGUuY29tcGlsZSBjYWxsIHRvIHRoZSBgOmhhc2AgcHNldWRvIGRlZmluaXRpb24uXG4gKlxuICogQ2hhbmdlcyB0aGF0IGFyZSBhcHBsaWVkIHRvIHRoZSBBREdVQVJEX0VYVENTUyBidWlsZCBvbmx5OlxuICogMS4gRG8gbm90IGV4cG9zZSBTaXp6bGUgdG8gdGhlIGdsb2JhbCBzY29wZS4gSW5pdGlhbGl6ZSBpdCBsYXppbHkgdmlhIGluaXRpYWxpemVTaXp6bGUoKS5cbiAqIDIuIFJlbW92ZWQgOmNvbnRhaW5zIHBzZXVkbyBkZWNsYXJhdGlvbiAtLSBpdHMgc3ludGF4IGlzIGNoYW5nZWQgYW5kIGRlY2xhcmVkIG91dHNpZGUgb2YgU2l6emxlLlxuICogMy4gUmVtb3ZlZCBkZWNsYXJhdGlvbnMgZm9yIHRoZSBmb2xsb3dpbmcgbm9uLXN0YW5kYXJkIHBzZXVkbyBjbGFzc2VzOlxuICogOnBhcmVudCwgOmhlYWRlciwgOmlucHV0LCA6YnV0dG9uLCA6dGV4dCwgOmZpcnN0LCA6bGFzdCwgOmVxLFxuICogOmV2ZW4sIDpvZGQsIDpsdCwgOmd0LCA6bnRoLCA6cmFkaW8sIDpjaGVja2JveCwgOmZpbGUsXG4gKiA6cGFzc3dvcmQsIDppbWFnZSwgOnN1Ym1pdCwgOnJlc2V0XG4gKiA0LiBBZGRlZCBlczYgbW9kdWxlIGV4cG9ydFxuICovXG52YXIgU2l6emxlO1xuLyoqXG4gKiBJbml0aWFsaXplcyBTaXp6bGUgb2JqZWN0LlxuICogSW4gdGhlIGNhc2Ugb2YgQWRHdWFyZCBFeHRlbmRlZENzcyB3ZSB3YW50IHRvIGF2b2lkIGluaXRpYWxpemluZyBTaXp6bGUgcmlnaHQgYXdheVxuICogYW5kIGV4cG9zaW5nIGl0IHRvIHRoZSBnbG9iYWwgc2NvcGUuXG4gKi9cblxudmFyIGluaXRpYWxpemVTaXp6bGUgPSBmdW5jdGlvbiBpbml0aWFsaXplU2l6emxlKCkge1xuICAvLyBqc2hpbnQgaWdub3JlOmxpbmVcbiAgaWYgKCFTaXp6bGUpIHtcbiAgICAvLzw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PFxuICAgIFNpenpsZSA9IGZ1bmN0aW9uICh3aW5kb3cpIHtcbiAgICAgIHZhciBzdXBwb3J0LFxuICAgICAgICAgIEV4cHIsXG4gICAgICAgICAgZ2V0VGV4dCxcbiAgICAgICAgICBpc1hNTCxcbiAgICAgICAgICB0b2tlbml6ZSxcbiAgICAgICAgICBjb21waWxlLFxuICAgICAgICAgIHNlbGVjdCxcbiAgICAgICAgICBvdXRlcm1vc3RDb250ZXh0LFxuICAgICAgICAgIHNvcnRJbnB1dCxcbiAgICAgICAgICBoYXNEdXBsaWNhdGUsXG4gICAgICAgICAgLy8gTG9jYWwgZG9jdW1lbnQgdmFyc1xuICAgICAgc2V0RG9jdW1lbnQsXG4gICAgICAgICAgZG9jdW1lbnQsXG4gICAgICAgICAgZG9jRWxlbSxcbiAgICAgICAgICBkb2N1bWVudElzSFRNTCxcbiAgICAgICAgICByYnVnZ3lRU0EsXG4gICAgICAgICAgcmJ1Z2d5TWF0Y2hlcyxcbiAgICAgICAgICBtYXRjaGVzLFxuICAgICAgICAgIGNvbnRhaW5zLFxuICAgICAgICAgIC8vIEluc3RhbmNlLXNwZWNpZmljIGRhdGFcbiAgICAgIGV4cGFuZG8gPSBcInNpenpsZVwiICsgMSAqIG5ldyBEYXRlKCksXG4gICAgICAgICAgcHJlZmVycmVkRG9jID0gd2luZG93LmRvY3VtZW50LFxuICAgICAgICAgIGRpcnJ1bnMgPSAwLFxuICAgICAgICAgIGRvbmUgPSAwLFxuICAgICAgICAgIGNsYXNzQ2FjaGUgPSBjcmVhdGVDYWNoZSgpLFxuICAgICAgICAgIHRva2VuQ2FjaGUgPSBjcmVhdGVDYWNoZSgpLFxuICAgICAgICAgIGNvbXBpbGVyQ2FjaGUgPSBjcmVhdGVDYWNoZSgpLFxuICAgICAgICAgIG5vbm5hdGl2ZVNlbGVjdG9yQ2FjaGUgPSBjcmVhdGVDYWNoZSgpLFxuICAgICAgICAgIHNvcnRPcmRlciA9IGZ1bmN0aW9uIHNvcnRPcmRlcihhLCBiKSB7XG4gICAgICAgIGlmIChhID09PSBiKSB7XG4gICAgICAgICAgaGFzRHVwbGljYXRlID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAwO1xuICAgICAgfSxcbiAgICAgICAgICAvLyBJbnN0YW5jZSBtZXRob2RzXG4gICAgICBoYXNPd24gPSB7fS5oYXNPd25Qcm9wZXJ0eSxcbiAgICAgICAgICBhcnIgPSBbXSxcbiAgICAgICAgICBwb3AgPSBhcnIucG9wLFxuICAgICAgICAgIHB1c2hfbmF0aXZlID0gYXJyLnB1c2gsXG4gICAgICAgICAgcHVzaCA9IGFyci5wdXNoLFxuICAgICAgICAgIHNsaWNlID0gYXJyLnNsaWNlLFxuICAgICAgICAgIC8vIFVzZSBhIHN0cmlwcGVkLWRvd24gaW5kZXhPZiBhcyBpdCdzIGZhc3RlciB0aGFuIG5hdGl2ZVxuICAgICAgLy8gaHR0cHM6Ly9qc3BlcmYuY29tL3Rob3ItaW5kZXhvZi12cy1mb3IvNVxuICAgICAgaW5kZXhPZiA9IGZ1bmN0aW9uIGluZGV4T2YobGlzdCwgZWxlbSkge1xuICAgICAgICB2YXIgaSA9IDAsXG4gICAgICAgICAgICBsZW4gPSBsaXN0Lmxlbmd0aDtcblxuICAgICAgICBmb3IgKDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgaWYgKGxpc3RbaV0gPT09IGVsZW0pIHtcbiAgICAgICAgICAgIHJldHVybiBpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAtMTtcbiAgICAgIH0sXG4gICAgICAgICAgYm9vbGVhbnMgPSBcImNoZWNrZWR8c2VsZWN0ZWR8YXN5bmN8YXV0b2ZvY3VzfGF1dG9wbGF5fGNvbnRyb2xzfGRlZmVyfGRpc2FibGVkfGhpZGRlbnxpc21hcHxsb29wfG11bHRpcGxlfG9wZW58cmVhZG9ubHl8cmVxdWlyZWR8c2NvcGVkXCIsXG4gICAgICAgICAgLy8gUmVndWxhciBleHByZXNzaW9uc1xuICAgICAgLy8gaHR0cDovL3d3dy53My5vcmcvVFIvY3NzMy1zZWxlY3RvcnMvI3doaXRlc3BhY2VcbiAgICAgIHdoaXRlc3BhY2UgPSBcIltcXFxceDIwXFxcXHRcXFxcclxcXFxuXFxcXGZdXCIsXG4gICAgICAgICAgLy8gaHR0cDovL3d3dy53My5vcmcvVFIvQ1NTMjEvc3luZGF0YS5odG1sI3ZhbHVlLWRlZi1pZGVudGlmaWVyXG4gICAgICBpZGVudGlmaWVyID0gXCIoPzpcXFxcXFxcXC58W1xcXFx3LV18W15cXDAtXFxcXHhhMF0pK1wiLFxuICAgICAgICAgIC8vIEF0dHJpYnV0ZSBzZWxlY3RvcnM6IGh0dHA6Ly93d3cudzMub3JnL1RSL3NlbGVjdG9ycy8jYXR0cmlidXRlLXNlbGVjdG9yc1xuICAgICAgYXR0cmlidXRlcyA9IFwiXFxcXFtcIiArIHdoaXRlc3BhY2UgKyBcIiooXCIgKyBpZGVudGlmaWVyICsgXCIpKD86XCIgKyB3aGl0ZXNwYWNlICsgLy8gT3BlcmF0b3IgKGNhcHR1cmUgMilcbiAgICAgIFwiKihbKl4kfCF+XT89KVwiICsgd2hpdGVzcGFjZSArIC8vIFwiQXR0cmlidXRlIHZhbHVlcyBtdXN0IGJlIENTUyBpZGVudGlmaWVycyBbY2FwdHVyZSA1XSBvciBzdHJpbmdzIFtjYXB0dXJlIDMgb3IgY2FwdHVyZSA0XVwiXG4gICAgICBcIiooPzonKCg/OlxcXFxcXFxcLnxbXlxcXFxcXFxcJ10pKiknfFxcXCIoKD86XFxcXFxcXFwufFteXFxcXFxcXFxcXFwiXSkqKVxcXCJ8KFwiICsgaWRlbnRpZmllciArIFwiKSl8KVwiICsgd2hpdGVzcGFjZSArIFwiKlxcXFxdXCIsXG4gICAgICAgICAgcHNldWRvcyA9IFwiOihcIiArIGlkZW50aWZpZXIgKyBcIikoPzpcXFxcKChcIiArIC8vIFRvIHJlZHVjZSB0aGUgbnVtYmVyIG9mIHNlbGVjdG9ycyBuZWVkaW5nIHRva2VuaXplIGluIHRoZSBwcmVGaWx0ZXIsIHByZWZlciBhcmd1bWVudHM6XG4gICAgICAvLyAxLiBxdW90ZWQgKGNhcHR1cmUgMzsgY2FwdHVyZSA0IG9yIGNhcHR1cmUgNSlcbiAgICAgIFwiKCcoKD86XFxcXFxcXFwufFteXFxcXFxcXFwnXSkqKSd8XFxcIigoPzpcXFxcXFxcXC58W15cXFxcXFxcXFxcXCJdKSopXFxcIil8XCIgKyAvLyAyLiBzaW1wbGUgKGNhcHR1cmUgNilcbiAgICAgIFwiKCg/OlxcXFxcXFxcLnxbXlxcXFxcXFxcKClbXFxcXF1dfFwiICsgYXR0cmlidXRlcyArIFwiKSopfFwiICsgLy8gMy4gYW55dGhpbmcgZWxzZSAoY2FwdHVyZSAyKVxuICAgICAgXCIuKlwiICsgXCIpXFxcXCl8KVwiLFxuICAgICAgICAgIC8vIExlYWRpbmcgYW5kIG5vbi1lc2NhcGVkIHRyYWlsaW5nIHdoaXRlc3BhY2UsIGNhcHR1cmluZyBzb21lIG5vbi13aGl0ZXNwYWNlIGNoYXJhY3RlcnMgcHJlY2VkaW5nIHRoZSBsYXR0ZXJcbiAgICAgIHJ3aGl0ZXNwYWNlID0gbmV3IFJlZ0V4cCh3aGl0ZXNwYWNlICsgXCIrXCIsIFwiZ1wiKSxcbiAgICAgICAgICBydHJpbSA9IG5ldyBSZWdFeHAoXCJeXCIgKyB3aGl0ZXNwYWNlICsgXCIrfCgoPzpefFteXFxcXFxcXFxdKSg/OlxcXFxcXFxcLikqKVwiICsgd2hpdGVzcGFjZSArIFwiKyRcIiwgXCJnXCIpLFxuICAgICAgICAgIHJjb21tYSA9IG5ldyBSZWdFeHAoXCJeXCIgKyB3aGl0ZXNwYWNlICsgXCIqLFwiICsgd2hpdGVzcGFjZSArIFwiKlwiKSxcbiAgICAgICAgICByY29tYmluYXRvcnMgPSBuZXcgUmVnRXhwKFwiXlwiICsgd2hpdGVzcGFjZSArIFwiKihbPit+XXxcIiArIHdoaXRlc3BhY2UgKyBcIilcIiArIHdoaXRlc3BhY2UgKyBcIipcIiksXG4gICAgICAgICAgcnBzZXVkbyA9IG5ldyBSZWdFeHAocHNldWRvcyksXG4gICAgICAgICAgcmlkZW50aWZpZXIgPSBuZXcgUmVnRXhwKFwiXlwiICsgaWRlbnRpZmllciArIFwiJFwiKSxcbiAgICAgICAgICBtYXRjaEV4cHIgPSB7XG4gICAgICAgIFwiSURcIjogbmV3IFJlZ0V4cChcIl4jKFwiICsgaWRlbnRpZmllciArIFwiKVwiKSxcbiAgICAgICAgXCJDTEFTU1wiOiBuZXcgUmVnRXhwKFwiXlxcXFwuKFwiICsgaWRlbnRpZmllciArIFwiKVwiKSxcbiAgICAgICAgXCJUQUdcIjogbmV3IFJlZ0V4cChcIl4oXCIgKyBpZGVudGlmaWVyICsgXCJ8WypdKVwiKSxcbiAgICAgICAgXCJBVFRSXCI6IG5ldyBSZWdFeHAoXCJeXCIgKyBhdHRyaWJ1dGVzKSxcbiAgICAgICAgXCJQU0VVRE9cIjogbmV3IFJlZ0V4cChcIl5cIiArIHBzZXVkb3MpLFxuICAgICAgICBcIkNISUxEXCI6IG5ldyBSZWdFeHAoXCJeOihvbmx5fGZpcnN0fGxhc3R8bnRofG50aC1sYXN0KS0oY2hpbGR8b2YtdHlwZSkoPzpcXFxcKFwiICsgd2hpdGVzcGFjZSArIFwiKihldmVufG9kZHwoKFsrLV18KShcXFxcZCopbnwpXCIgKyB3aGl0ZXNwYWNlICsgXCIqKD86KFsrLV18KVwiICsgd2hpdGVzcGFjZSArIFwiKihcXFxcZCspfCkpXCIgKyB3aGl0ZXNwYWNlICsgXCIqXFxcXCl8KVwiLCBcImlcIiksXG4gICAgICAgIFwiYm9vbFwiOiBuZXcgUmVnRXhwKFwiXig/OlwiICsgYm9vbGVhbnMgKyBcIikkXCIsIFwiaVwiKSxcbiAgICAgICAgLy8gRm9yIHVzZSBpbiBsaWJyYXJpZXMgaW1wbGVtZW50aW5nIC5pcygpXG4gICAgICAgIC8vIFdlIHVzZSB0aGlzIGZvciBQT1MgbWF0Y2hpbmcgaW4gYHNlbGVjdGBcbiAgICAgICAgXCJuZWVkc0NvbnRleHRcIjogbmV3IFJlZ0V4cChcIl5cIiArIHdoaXRlc3BhY2UgKyBcIipbPit+XXw6KGV2ZW58b2RkfGVxfGd0fGx0fG50aHxmaXJzdHxsYXN0KSg/OlxcXFwoXCIgKyB3aGl0ZXNwYWNlICsgXCIqKCg/Oi1cXFxcZCk/XFxcXGQqKVwiICsgd2hpdGVzcGFjZSArIFwiKlxcXFwpfCkoPz1bXi1dfCQpXCIsIFwiaVwiKVxuICAgICAgfSxcbiAgICAgICAgICBybmF0aXZlID0gL15bXntdK1xce1xccypcXFtuYXRpdmUgXFx3LyxcbiAgICAgICAgICAvLyBFYXNpbHktcGFyc2VhYmxlL3JldHJpZXZhYmxlIElEIG9yIFRBRyBvciBDTEFTUyBzZWxlY3RvcnNcbiAgICAgIHJxdWlja0V4cHIgPSAvXig/OiMoW1xcdy1dKyl8KFxcdyspfFxcLihbXFx3LV0rKSkkLyxcbiAgICAgICAgICByc2libGluZyA9IC9bK35dLyxcbiAgICAgICAgICAvLyBDU1MgZXNjYXBlc1xuICAgICAgLy8gaHR0cDovL3d3dy53My5vcmcvVFIvQ1NTMjEvc3luZGF0YS5odG1sI2VzY2FwZWQtY2hhcmFjdGVyc1xuICAgICAgcnVuZXNjYXBlID0gbmV3IFJlZ0V4cChcIlxcXFxcXFxcKFtcXFxcZGEtZl17MSw2fVwiICsgd2hpdGVzcGFjZSArIFwiP3woXCIgKyB3aGl0ZXNwYWNlICsgXCIpfC4pXCIsIFwiaWdcIiksXG4gICAgICAgICAgZnVuZXNjYXBlID0gZnVuY3Rpb24gZnVuZXNjYXBlKF8sIGVzY2FwZWQsIGVzY2FwZWRXaGl0ZXNwYWNlKSB7XG4gICAgICAgIHZhciBoaWdoID0gXCIweFwiICsgZXNjYXBlZCAtIDB4MTAwMDA7IC8vIE5hTiBtZWFucyBub24tY29kZXBvaW50XG4gICAgICAgIC8vIFN1cHBvcnQ6IEZpcmVmb3g8MjRcbiAgICAgICAgLy8gV29ya2Fyb3VuZCBlcnJvbmVvdXMgbnVtZXJpYyBpbnRlcnByZXRhdGlvbiBvZiArXCIweFwiXG5cbiAgICAgICAgcmV0dXJuIGhpZ2ggIT09IGhpZ2ggfHwgZXNjYXBlZFdoaXRlc3BhY2UgPyBlc2NhcGVkIDogaGlnaCA8IDAgPyAvLyBCTVAgY29kZXBvaW50XG4gICAgICAgIFN0cmluZy5mcm9tQ2hhckNvZGUoaGlnaCArIDB4MTAwMDApIDogLy8gU3VwcGxlbWVudGFsIFBsYW5lIGNvZGVwb2ludCAoc3Vycm9nYXRlIHBhaXIpXG4gICAgICAgIFN0cmluZy5mcm9tQ2hhckNvZGUoaGlnaCA+PiAxMCB8IDB4RDgwMCwgaGlnaCAmIDB4M0ZGIHwgMHhEQzAwKTtcbiAgICAgIH0sXG4gICAgICAgICAgLy8gQ1NTIHN0cmluZy9pZGVudGlmaWVyIHNlcmlhbGl6YXRpb25cbiAgICAgIC8vIGh0dHBzOi8vZHJhZnRzLmNzc3dnLm9yZy9jc3NvbS8jY29tbW9uLXNlcmlhbGl6aW5nLWlkaW9tc1xuICAgICAgcmNzc2VzY2FwZSA9IC8oW1xcMC1cXHgxZlxceDdmXXxeLT9cXGQpfF4tJHxbXlxcMC1cXHgxZlxceDdmLVxcdUZGRkZcXHctXS9nLFxuICAgICAgICAgIGZjc3Nlc2NhcGUgPSBmdW5jdGlvbiBmY3NzZXNjYXBlKGNoLCBhc0NvZGVQb2ludCkge1xuICAgICAgICBpZiAoYXNDb2RlUG9pbnQpIHtcbiAgICAgICAgICAvLyBVKzAwMDAgTlVMTCBiZWNvbWVzIFUrRkZGRCBSRVBMQUNFTUVOVCBDSEFSQUNURVJcbiAgICAgICAgICBpZiAoY2ggPT09IFwiXFwwXCIpIHtcbiAgICAgICAgICAgIHJldHVybiBcIlxcdUZGRkRcIjtcbiAgICAgICAgICB9IC8vIENvbnRyb2wgY2hhcmFjdGVycyBhbmQgKGRlcGVuZGVudCB1cG9uIHBvc2l0aW9uKSBudW1iZXJzIGdldCBlc2NhcGVkIGFzIGNvZGUgcG9pbnRzXG5cblxuICAgICAgICAgIHJldHVybiBjaC5zbGljZSgwLCAtMSkgKyBcIlxcXFxcIiArIGNoLmNoYXJDb2RlQXQoY2gubGVuZ3RoIC0gMSkudG9TdHJpbmcoMTYpICsgXCIgXCI7XG4gICAgICAgIH0gLy8gT3RoZXIgcG90ZW50aWFsbHktc3BlY2lhbCBBU0NJSSBjaGFyYWN0ZXJzIGdldCBiYWNrc2xhc2gtZXNjYXBlZFxuXG5cbiAgICAgICAgcmV0dXJuIFwiXFxcXFwiICsgY2g7XG4gICAgICB9LFxuICAgICAgICAgIC8vIFVzZWQgZm9yIGlmcmFtZXNcbiAgICAgIC8vIFNlZSBzZXREb2N1bWVudCgpXG4gICAgICAvLyBSZW1vdmluZyB0aGUgZnVuY3Rpb24gd3JhcHBlciBjYXVzZXMgYSBcIlBlcm1pc3Npb24gRGVuaWVkXCJcbiAgICAgIC8vIGVycm9yIGluIElFXG4gICAgICB1bmxvYWRIYW5kbGVyID0gZnVuY3Rpb24gdW5sb2FkSGFuZGxlcigpIHtcbiAgICAgICAgc2V0RG9jdW1lbnQoKTtcbiAgICAgIH0sXG4gICAgICAgICAgaW5EaXNhYmxlZEZpZWxkc2V0ID0gYWRkQ29tYmluYXRvcihmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICByZXR1cm4gZWxlbS5kaXNhYmxlZCA9PT0gdHJ1ZSAmJiBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IFwiZmllbGRzZXRcIjtcbiAgICAgIH0sIHtcbiAgICAgICAgZGlyOiBcInBhcmVudE5vZGVcIixcbiAgICAgICAgbmV4dDogXCJsZWdlbmRcIlxuICAgICAgfSk7IC8vIE9wdGltaXplIGZvciBwdXNoLmFwcGx5KCBfLCBOb2RlTGlzdCApXG5cblxuICAgICAgdHJ5IHtcbiAgICAgICAgcHVzaC5hcHBseShhcnIgPSBzbGljZS5jYWxsKHByZWZlcnJlZERvYy5jaGlsZE5vZGVzKSwgcHJlZmVycmVkRG9jLmNoaWxkTm9kZXMpOyAvLyBTdXBwb3J0OiBBbmRyb2lkPDQuMFxuICAgICAgICAvLyBEZXRlY3Qgc2lsZW50bHkgZmFpbGluZyBwdXNoLmFwcGx5XG5cbiAgICAgICAgYXJyW3ByZWZlcnJlZERvYy5jaGlsZE5vZGVzLmxlbmd0aF0ubm9kZVR5cGU7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHB1c2ggPSB7XG4gICAgICAgICAgYXBwbHk6IGFyci5sZW5ndGggPyAvLyBMZXZlcmFnZSBzbGljZSBpZiBwb3NzaWJsZVxuICAgICAgICAgIGZ1bmN0aW9uICh0YXJnZXQsIGVscykge1xuICAgICAgICAgICAgcHVzaF9uYXRpdmUuYXBwbHkodGFyZ2V0LCBzbGljZS5jYWxsKGVscykpO1xuICAgICAgICAgIH0gOiAvLyBTdXBwb3J0OiBJRTw5XG4gICAgICAgICAgLy8gT3RoZXJ3aXNlIGFwcGVuZCBkaXJlY3RseVxuICAgICAgICAgIGZ1bmN0aW9uICh0YXJnZXQsIGVscykge1xuICAgICAgICAgICAgdmFyIGogPSB0YXJnZXQubGVuZ3RoLFxuICAgICAgICAgICAgICAgIGkgPSAwOyAvLyBDYW4ndCB0cnVzdCBOb2RlTGlzdC5sZW5ndGhcblxuICAgICAgICAgICAgd2hpbGUgKHRhcmdldFtqKytdID0gZWxzW2krK10pIHt9XG5cbiAgICAgICAgICAgIHRhcmdldC5sZW5ndGggPSBqIC0gMTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIFNpenpsZShzZWxlY3RvciwgY29udGV4dCwgcmVzdWx0cywgc2VlZCkge1xuICAgICAgICB2YXIgbSxcbiAgICAgICAgICAgIGksXG4gICAgICAgICAgICBlbGVtLFxuICAgICAgICAgICAgbmlkLFxuICAgICAgICAgICAgbWF0Y2gsXG4gICAgICAgICAgICBncm91cHMsXG4gICAgICAgICAgICBuZXdTZWxlY3RvcixcbiAgICAgICAgICAgIG5ld0NvbnRleHQgPSBjb250ZXh0ICYmIGNvbnRleHQub3duZXJEb2N1bWVudCxcbiAgICAgICAgICAgIC8vIG5vZGVUeXBlIGRlZmF1bHRzIHRvIDksIHNpbmNlIGNvbnRleHQgZGVmYXVsdHMgdG8gZG9jdW1lbnRcbiAgICAgICAgbm9kZVR5cGUgPSBjb250ZXh0ID8gY29udGV4dC5ub2RlVHlwZSA6IDk7XG4gICAgICAgIHJlc3VsdHMgPSByZXN1bHRzIHx8IFtdOyAvLyBSZXR1cm4gZWFybHkgZnJvbSBjYWxscyB3aXRoIGludmFsaWQgc2VsZWN0b3Igb3IgY29udGV4dFxuXG4gICAgICAgIGlmICh0eXBlb2Ygc2VsZWN0b3IgIT09IFwic3RyaW5nXCIgfHwgIXNlbGVjdG9yIHx8IG5vZGVUeXBlICE9PSAxICYmIG5vZGVUeXBlICE9PSA5ICYmIG5vZGVUeXBlICE9PSAxMSkge1xuICAgICAgICAgIHJldHVybiByZXN1bHRzO1xuICAgICAgICB9IC8vIFRyeSB0byBzaG9ydGN1dCBmaW5kIG9wZXJhdGlvbnMgKGFzIG9wcG9zZWQgdG8gZmlsdGVycykgaW4gSFRNTCBkb2N1bWVudHNcblxuXG4gICAgICAgIGlmICghc2VlZCkge1xuICAgICAgICAgIGlmICgoY29udGV4dCA/IGNvbnRleHQub3duZXJEb2N1bWVudCB8fCBjb250ZXh0IDogcHJlZmVycmVkRG9jKSAhPT0gZG9jdW1lbnQpIHtcbiAgICAgICAgICAgIHNldERvY3VtZW50KGNvbnRleHQpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnRleHQgPSBjb250ZXh0IHx8IGRvY3VtZW50O1xuXG4gICAgICAgICAgaWYgKGRvY3VtZW50SXNIVE1MKSB7XG4gICAgICAgICAgICAvLyBJZiB0aGUgc2VsZWN0b3IgaXMgc3VmZmljaWVudGx5IHNpbXBsZSwgdHJ5IHVzaW5nIGEgXCJnZXQqQnkqXCIgRE9NIG1ldGhvZFxuICAgICAgICAgICAgLy8gKGV4Y2VwdGluZyBEb2N1bWVudEZyYWdtZW50IGNvbnRleHQsIHdoZXJlIHRoZSBtZXRob2RzIGRvbid0IGV4aXN0KVxuICAgICAgICAgICAgaWYgKG5vZGVUeXBlICE9PSAxMSAmJiAobWF0Y2ggPSBycXVpY2tFeHByLmV4ZWMoc2VsZWN0b3IpKSkge1xuICAgICAgICAgICAgICAvLyBJRCBzZWxlY3RvclxuICAgICAgICAgICAgICBpZiAobSA9IG1hdGNoWzFdKSB7XG4gICAgICAgICAgICAgICAgLy8gRG9jdW1lbnQgY29udGV4dFxuICAgICAgICAgICAgICAgIGlmIChub2RlVHlwZSA9PT0gOSkge1xuICAgICAgICAgICAgICAgICAgaWYgKGVsZW0gPSBjb250ZXh0LmdldEVsZW1lbnRCeUlkKG0pKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFN1cHBvcnQ6IElFLCBPcGVyYSwgV2Via2l0XG4gICAgICAgICAgICAgICAgICAgIC8vIFRPRE86IGlkZW50aWZ5IHZlcnNpb25zXG4gICAgICAgICAgICAgICAgICAgIC8vIGdldEVsZW1lbnRCeUlkIGNhbiBtYXRjaCBlbGVtZW50cyBieSBuYW1lIGluc3RlYWQgb2YgSURcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVsZW0uaWQgPT09IG0pIHtcbiAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzLnB1c2goZWxlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHRzO1xuICAgICAgICAgICAgICAgICAgfSAvLyBFbGVtZW50IGNvbnRleHRcblxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAvLyBTdXBwb3J0OiBJRSwgT3BlcmEsIFdlYmtpdFxuICAgICAgICAgICAgICAgICAgLy8gVE9ETzogaWRlbnRpZnkgdmVyc2lvbnNcbiAgICAgICAgICAgICAgICAgIC8vIGdldEVsZW1lbnRCeUlkIGNhbiBtYXRjaCBlbGVtZW50cyBieSBuYW1lIGluc3RlYWQgb2YgSURcbiAgICAgICAgICAgICAgICAgIGlmIChuZXdDb250ZXh0ICYmIChlbGVtID0gbmV3Q29udGV4dC5nZXRFbGVtZW50QnlJZChtKSkgJiYgY29udGFpbnMoY29udGV4dCwgZWxlbSkgJiYgZWxlbS5pZCA9PT0gbSkge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRzLnB1c2goZWxlbSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHRzO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gLy8gVHlwZSBzZWxlY3RvclxuXG4gICAgICAgICAgICAgIH0gZWxzZSBpZiAobWF0Y2hbMl0pIHtcbiAgICAgICAgICAgICAgICBwdXNoLmFwcGx5KHJlc3VsdHMsIGNvbnRleHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoc2VsZWN0b3IpKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0czsgLy8gQ2xhc3Mgc2VsZWN0b3JcbiAgICAgICAgICAgICAgfSBlbHNlIGlmICgobSA9IG1hdGNoWzNdKSAmJiBzdXBwb3J0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUgJiYgY29udGV4dC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKSB7XG4gICAgICAgICAgICAgICAgcHVzaC5hcHBseShyZXN1bHRzLCBjb250ZXh0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUobSkpO1xuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHRzO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IC8vIFRha2UgYWR2YW50YWdlIG9mIHF1ZXJ5U2VsZWN0b3JBbGxcblxuXG4gICAgICAgICAgICBpZiAoc3VwcG9ydC5xc2EgJiYgIW5vbm5hdGl2ZVNlbGVjdG9yQ2FjaGVbc2VsZWN0b3IgKyBcIiBcIl0gJiYgKCFyYnVnZ3lRU0EgfHwgIXJidWdneVFTQS50ZXN0KHNlbGVjdG9yKSkpIHtcbiAgICAgICAgICAgICAgaWYgKG5vZGVUeXBlICE9PSAxKSB7XG4gICAgICAgICAgICAgICAgbmV3Q29udGV4dCA9IGNvbnRleHQ7XG4gICAgICAgICAgICAgICAgbmV3U2VsZWN0b3IgPSBzZWxlY3RvcjsgLy8gcVNBIGxvb2tzIG91dHNpZGUgRWxlbWVudCBjb250ZXh0LCB3aGljaCBpcyBub3Qgd2hhdCB3ZSB3YW50XG4gICAgICAgICAgICAgICAgLy8gVGhhbmtzIHRvIEFuZHJldyBEdXBvbnQgZm9yIHRoaXMgd29ya2Fyb3VuZCB0ZWNobmlxdWVcbiAgICAgICAgICAgICAgICAvLyBTdXBwb3J0OiBJRSA8PThcbiAgICAgICAgICAgICAgICAvLyBFeGNsdWRlIG9iamVjdCBlbGVtZW50c1xuICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNvbnRleHQubm9kZU5hbWUudG9Mb3dlckNhc2UoKSAhPT0gXCJvYmplY3RcIikge1xuICAgICAgICAgICAgICAgIC8vIENhcHR1cmUgdGhlIGNvbnRleHQgSUQsIHNldHRpbmcgaXQgZmlyc3QgaWYgbmVjZXNzYXJ5XG4gICAgICAgICAgICAgICAgaWYgKG5pZCA9IGNvbnRleHQuZ2V0QXR0cmlidXRlKFwiaWRcIikpIHtcbiAgICAgICAgICAgICAgICAgIG5pZCA9IG5pZC5yZXBsYWNlKHJjc3Nlc2NhcGUsIGZjc3Nlc2NhcGUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICBjb250ZXh0LnNldEF0dHJpYnV0ZShcImlkXCIsIG5pZCA9IGV4cGFuZG8pO1xuICAgICAgICAgICAgICAgIH0gLy8gUHJlZml4IGV2ZXJ5IHNlbGVjdG9yIGluIHRoZSBsaXN0XG5cblxuICAgICAgICAgICAgICAgIGdyb3VwcyA9IHRva2VuaXplKHNlbGVjdG9yKTtcbiAgICAgICAgICAgICAgICBpID0gZ3JvdXBzLmxlbmd0aDtcblxuICAgICAgICAgICAgICAgIHdoaWxlIChpLS0pIHtcbiAgICAgICAgICAgICAgICAgIGdyb3Vwc1tpXSA9IFwiI1wiICsgbmlkICsgXCIgXCIgKyB0b1NlbGVjdG9yKGdyb3Vwc1tpXSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgbmV3U2VsZWN0b3IgPSBncm91cHMuam9pbihcIixcIik7IC8vIEV4cGFuZCBjb250ZXh0IGZvciBzaWJsaW5nIHNlbGVjdG9yc1xuXG4gICAgICAgICAgICAgICAgbmV3Q29udGV4dCA9IHJzaWJsaW5nLnRlc3Qoc2VsZWN0b3IpICYmIHRlc3RDb250ZXh0KGNvbnRleHQucGFyZW50Tm9kZSkgfHwgY29udGV4dDtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGlmIChuZXdTZWxlY3Rvcikge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICBwdXNoLmFwcGx5KHJlc3VsdHMsIG5ld0NvbnRleHQucXVlcnlTZWxlY3RvckFsbChuZXdTZWxlY3RvcikpO1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAocXNhRXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgIC8vIFtBZEd1YXJkIFBhdGhdOiBGaXggdGhlIGNhY2hlIHZhbHVlXG4gICAgICAgICAgICAgICAgICBub25uYXRpdmVTZWxlY3RvckNhY2hlKHNlbGVjdG9yLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9IGZpbmFsbHkge1xuICAgICAgICAgICAgICAgICAgaWYgKG5pZCA9PT0gZXhwYW5kbykge1xuICAgICAgICAgICAgICAgICAgICBjb250ZXh0LnJlbW92ZUF0dHJpYnV0ZShcImlkXCIpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSAvLyBBbGwgb3RoZXJzXG5cblxuICAgICAgICByZXR1cm4gc2VsZWN0KHNlbGVjdG9yLnJlcGxhY2UocnRyaW0sIFwiJDFcIiksIGNvbnRleHQsIHJlc3VsdHMsIHNlZWQpO1xuICAgICAgfVxuICAgICAgLyoqXG4gICAgICAgKiBDcmVhdGUga2V5LXZhbHVlIGNhY2hlcyBvZiBsaW1pdGVkIHNpemVcbiAgICAgICAqIEByZXR1cm5zIHtmdW5jdGlvbihzdHJpbmcsIG9iamVjdCl9IFJldHVybnMgdGhlIE9iamVjdCBkYXRhIGFmdGVyIHN0b3JpbmcgaXQgb24gaXRzZWxmIHdpdGhcbiAgICAgICAqXHRwcm9wZXJ0eSBuYW1lIHRoZSAoc3BhY2Utc3VmZml4ZWQpIHN0cmluZyBhbmQgKGlmIHRoZSBjYWNoZSBpcyBsYXJnZXIgdGhhbiBFeHByLmNhY2hlTGVuZ3RoKVxuICAgICAgICpcdGRlbGV0aW5nIHRoZSBvbGRlc3QgZW50cnlcbiAgICAgICAqL1xuXG5cbiAgICAgIGZ1bmN0aW9uIGNyZWF0ZUNhY2hlKCkge1xuICAgICAgICB2YXIga2V5cyA9IFtdO1xuXG4gICAgICAgIGZ1bmN0aW9uIGNhY2hlKGtleSwgdmFsdWUpIHtcbiAgICAgICAgICAvLyBVc2UgKGtleSArIFwiIFwiKSB0byBhdm9pZCBjb2xsaXNpb24gd2l0aCBuYXRpdmUgcHJvdG90eXBlIHByb3BlcnRpZXMgKHNlZSBJc3N1ZSAjMTU3KVxuICAgICAgICAgIGlmIChrZXlzLnB1c2goa2V5ICsgXCIgXCIpID4gRXhwci5jYWNoZUxlbmd0aCkge1xuICAgICAgICAgICAgLy8gT25seSBrZWVwIHRoZSBtb3N0IHJlY2VudCBlbnRyaWVzXG4gICAgICAgICAgICBkZWxldGUgY2FjaGVba2V5cy5zaGlmdCgpXTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gY2FjaGVba2V5ICsgXCIgXCJdID0gdmFsdWU7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gY2FjaGU7XG4gICAgICB9XG4gICAgICAvKipcbiAgICAgICAqIE1hcmsgYSBmdW5jdGlvbiBmb3Igc3BlY2lhbCB1c2UgYnkgU2l6emxlXG4gICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbiBUaGUgZnVuY3Rpb24gdG8gbWFya1xuICAgICAgICovXG5cblxuICAgICAgZnVuY3Rpb24gbWFya0Z1bmN0aW9uKGZuKSB7XG4gICAgICAgIGZuW2V4cGFuZG9dID0gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIGZuO1xuICAgICAgfVxuICAgICAgLyoqXG4gICAgICAgKiBTdXBwb3J0IHRlc3RpbmcgdXNpbmcgYW4gZWxlbWVudFxuICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZm4gUGFzc2VkIHRoZSBjcmVhdGVkIGVsZW1lbnQgYW5kIHJldHVybnMgYSBib29sZWFuIHJlc3VsdFxuICAgICAgICovXG5cblxuICAgICAgZnVuY3Rpb24gYXNzZXJ0KGZuKSB7XG4gICAgICAgIHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJmaWVsZHNldFwiKTtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgIHJldHVybiAhIWZuKGVsKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgICAvLyBSZW1vdmUgZnJvbSBpdHMgcGFyZW50IGJ5IGRlZmF1bHRcbiAgICAgICAgICBpZiAoZWwucGFyZW50Tm9kZSkge1xuICAgICAgICAgICAgZWwucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChlbCk7XG4gICAgICAgICAgfSAvLyByZWxlYXNlIG1lbW9yeSBpbiBJRVxuXG5cbiAgICAgICAgICBlbCA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIC8qKlxuICAgICAgICogQWRkcyB0aGUgc2FtZSBoYW5kbGVyIGZvciBhbGwgb2YgdGhlIHNwZWNpZmllZCBhdHRyc1xuICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGF0dHJzIFBpcGUtc2VwYXJhdGVkIGxpc3Qgb2YgYXR0cmlidXRlc1xuICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gaGFuZGxlciBUaGUgbWV0aG9kIHRoYXQgd2lsbCBiZSBhcHBsaWVkXG4gICAgICAgKi9cblxuXG4gICAgICBmdW5jdGlvbiBhZGRIYW5kbGUoYXR0cnMsIGhhbmRsZXIpIHtcbiAgICAgICAgdmFyIGFyciA9IGF0dHJzLnNwbGl0KFwifFwiKSxcbiAgICAgICAgICAgIGkgPSBhcnIubGVuZ3RoO1xuXG4gICAgICAgIHdoaWxlIChpLS0pIHtcbiAgICAgICAgICBFeHByLmF0dHJIYW5kbGVbYXJyW2ldXSA9IGhhbmRsZXI7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIC8qKlxuICAgICAgICogQ2hlY2tzIGRvY3VtZW50IG9yZGVyIG9mIHR3byBzaWJsaW5nc1xuICAgICAgICogQHBhcmFtIHtFbGVtZW50fSBhXG4gICAgICAgKiBAcGFyYW0ge0VsZW1lbnR9IGJcbiAgICAgICAqIEByZXR1cm5zIHtOdW1iZXJ9IFJldHVybnMgbGVzcyB0aGFuIDAgaWYgYSBwcmVjZWRlcyBiLCBncmVhdGVyIHRoYW4gMCBpZiBhIGZvbGxvd3MgYlxuICAgICAgICovXG5cblxuICAgICAgZnVuY3Rpb24gc2libGluZ0NoZWNrKGEsIGIpIHtcbiAgICAgICAgdmFyIGN1ciA9IGIgJiYgYSxcbiAgICAgICAgICAgIGRpZmYgPSBjdXIgJiYgYS5ub2RlVHlwZSA9PT0gMSAmJiBiLm5vZGVUeXBlID09PSAxICYmIGEuc291cmNlSW5kZXggLSBiLnNvdXJjZUluZGV4OyAvLyBVc2UgSUUgc291cmNlSW5kZXggaWYgYXZhaWxhYmxlIG9uIGJvdGggbm9kZXNcblxuICAgICAgICBpZiAoZGlmZikge1xuICAgICAgICAgIHJldHVybiBkaWZmO1xuICAgICAgICB9IC8vIENoZWNrIGlmIGIgZm9sbG93cyBhXG5cblxuICAgICAgICBpZiAoY3VyKSB7XG4gICAgICAgICAgd2hpbGUgKGN1ciA9IGN1ci5uZXh0U2libGluZykge1xuICAgICAgICAgICAgaWYgKGN1ciA9PT0gYikge1xuICAgICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGEgPyAxIDogLTE7XG4gICAgICB9XG4gICAgICAvKipcbiAgICAgICAqIFJldHVybnMgYSBmdW5jdGlvbiB0byB1c2UgaW4gcHNldWRvcyBmb3IgOmVuYWJsZWQvOmRpc2FibGVkXG4gICAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IGRpc2FibGVkIHRydWUgZm9yIDpkaXNhYmxlZDsgZmFsc2UgZm9yIDplbmFibGVkXG4gICAgICAgKi9cblxuXG4gICAgICBmdW5jdGlvbiBjcmVhdGVEaXNhYmxlZFBzZXVkbyhkaXNhYmxlZCkge1xuICAgICAgICAvLyBLbm93biA6ZGlzYWJsZWQgZmFsc2UgcG9zaXRpdmVzOiBmaWVsZHNldFtkaXNhYmxlZF0gPiBsZWdlbmQ6bnRoLW9mLXR5cGUobisyKSA6Y2FuLWRpc2FibGVcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICAgICAgLy8gT25seSBjZXJ0YWluIGVsZW1lbnRzIGNhbiBtYXRjaCA6ZW5hYmxlZCBvciA6ZGlzYWJsZWRcbiAgICAgICAgICAvLyBodHRwczovL2h0bWwuc3BlYy53aGF0d2cub3JnL211bHRpcGFnZS9zY3JpcHRpbmcuaHRtbCNzZWxlY3Rvci1lbmFibGVkXG4gICAgICAgICAgLy8gaHR0cHM6Ly9odG1sLnNwZWMud2hhdHdnLm9yZy9tdWx0aXBhZ2Uvc2NyaXB0aW5nLmh0bWwjc2VsZWN0b3ItZGlzYWJsZWRcbiAgICAgICAgICBpZiAoXCJmb3JtXCIgaW4gZWxlbSkge1xuICAgICAgICAgICAgLy8gQ2hlY2sgZm9yIGluaGVyaXRlZCBkaXNhYmxlZG5lc3Mgb24gcmVsZXZhbnQgbm9uLWRpc2FibGVkIGVsZW1lbnRzOlxuICAgICAgICAgICAgLy8gKiBsaXN0ZWQgZm9ybS1hc3NvY2lhdGVkIGVsZW1lbnRzIGluIGEgZGlzYWJsZWQgZmllbGRzZXRcbiAgICAgICAgICAgIC8vICAgaHR0cHM6Ly9odG1sLnNwZWMud2hhdHdnLm9yZy9tdWx0aXBhZ2UvZm9ybXMuaHRtbCNjYXRlZ29yeS1saXN0ZWRcbiAgICAgICAgICAgIC8vICAgaHR0cHM6Ly9odG1sLnNwZWMud2hhdHdnLm9yZy9tdWx0aXBhZ2UvZm9ybXMuaHRtbCNjb25jZXB0LWZlLWRpc2FibGVkXG4gICAgICAgICAgICAvLyAqIG9wdGlvbiBlbGVtZW50cyBpbiBhIGRpc2FibGVkIG9wdGdyb3VwXG4gICAgICAgICAgICAvLyAgIGh0dHBzOi8vaHRtbC5zcGVjLndoYXR3Zy5vcmcvbXVsdGlwYWdlL2Zvcm1zLmh0bWwjY29uY2VwdC1vcHRpb24tZGlzYWJsZWRcbiAgICAgICAgICAgIC8vIEFsbCBzdWNoIGVsZW1lbnRzIGhhdmUgYSBcImZvcm1cIiBwcm9wZXJ0eS5cbiAgICAgICAgICAgIGlmIChlbGVtLnBhcmVudE5vZGUgJiYgZWxlbS5kaXNhYmxlZCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgLy8gT3B0aW9uIGVsZW1lbnRzIGRlZmVyIHRvIGEgcGFyZW50IG9wdGdyb3VwIGlmIHByZXNlbnRcbiAgICAgICAgICAgICAgaWYgKFwibGFiZWxcIiBpbiBlbGVtKSB7XG4gICAgICAgICAgICAgICAgaWYgKFwibGFiZWxcIiBpbiBlbGVtLnBhcmVudE5vZGUpIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtLnBhcmVudE5vZGUuZGlzYWJsZWQgPT09IGRpc2FibGVkO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbS5kaXNhYmxlZCA9PT0gZGlzYWJsZWQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9IC8vIFN1cHBvcnQ6IElFIDYgLSAxMVxuICAgICAgICAgICAgICAvLyBVc2UgdGhlIGlzRGlzYWJsZWQgc2hvcnRjdXQgcHJvcGVydHkgdG8gY2hlY2sgZm9yIGRpc2FibGVkIGZpZWxkc2V0IGFuY2VzdG9yc1xuXG5cbiAgICAgICAgICAgICAgcmV0dXJuIGVsZW0uaXNEaXNhYmxlZCA9PT0gZGlzYWJsZWQgfHwgLy8gV2hlcmUgdGhlcmUgaXMgbm8gaXNEaXNhYmxlZCwgY2hlY2sgbWFudWFsbHlcblxuICAgICAgICAgICAgICAvKiBqc2hpbnQgLVcwMTggKi9cbiAgICAgICAgICAgICAgZWxlbS5pc0Rpc2FibGVkICE9PSAhZGlzYWJsZWQgJiYgaW5EaXNhYmxlZEZpZWxkc2V0KGVsZW0pID09PSBkaXNhYmxlZDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGVsZW0uZGlzYWJsZWQgPT09IGRpc2FibGVkOyAvLyBUcnkgdG8gd2lubm93IG91dCBlbGVtZW50cyB0aGF0IGNhbid0IGJlIGRpc2FibGVkIGJlZm9yZSB0cnVzdGluZyB0aGUgZGlzYWJsZWQgcHJvcGVydHkuXG4gICAgICAgICAgICAvLyBTb21lIHZpY3RpbXMgZ2V0IGNhdWdodCBpbiBvdXIgbmV0IChsYWJlbCwgbGVnZW5kLCBtZW51LCB0cmFjayksIGJ1dCBpdCBzaG91bGRuJ3RcbiAgICAgICAgICAgIC8vIGV2ZW4gZXhpc3Qgb24gdGhlbSwgbGV0IGFsb25lIGhhdmUgYSBib29sZWFuIHZhbHVlLlxuICAgICAgICAgIH0gZWxzZSBpZiAoXCJsYWJlbFwiIGluIGVsZW0pIHtcbiAgICAgICAgICAgIHJldHVybiBlbGVtLmRpc2FibGVkID09PSBkaXNhYmxlZDtcbiAgICAgICAgICB9IC8vIFJlbWFpbmluZyBlbGVtZW50cyBhcmUgbmVpdGhlciA6ZW5hYmxlZCBub3IgOmRpc2FibGVkXG5cblxuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIC8qKlxuICAgICAgICogQ2hlY2tzIGEgbm9kZSBmb3IgdmFsaWRpdHkgYXMgYSBTaXp6bGUgY29udGV4dFxuICAgICAgICogQHBhcmFtIHtFbGVtZW50fE9iamVjdD19IGNvbnRleHRcbiAgICAgICAqIEByZXR1cm5zIHtFbGVtZW50fE9iamVjdHxCb29sZWFufSBUaGUgaW5wdXQgbm9kZSBpZiBhY2NlcHRhYmxlLCBvdGhlcndpc2UgYSBmYWxzeSB2YWx1ZVxuICAgICAgICovXG5cblxuICAgICAgZnVuY3Rpb24gdGVzdENvbnRleHQoY29udGV4dCkge1xuICAgICAgICByZXR1cm4gY29udGV4dCAmJiB0eXBlb2YgY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSAhPT0gXCJ1bmRlZmluZWRcIiAmJiBjb250ZXh0O1xuICAgICAgfSAvLyBFeHBvc2Ugc3VwcG9ydCB2YXJzIGZvciBjb252ZW5pZW5jZVxuXG5cbiAgICAgIHN1cHBvcnQgPSBTaXp6bGUuc3VwcG9ydCA9IHt9O1xuICAgICAgLyoqXG4gICAgICAgKiBEZXRlY3RzIFhNTCBub2Rlc1xuICAgICAgICogQHBhcmFtIHtFbGVtZW50fE9iamVjdH0gZWxlbSBBbiBlbGVtZW50IG9yIGEgZG9jdW1lbnRcbiAgICAgICAqIEByZXR1cm5zIHtCb29sZWFufSBUcnVlIGlmZiBlbGVtIGlzIGEgbm9uLUhUTUwgWE1MIG5vZGVcbiAgICAgICAqL1xuXG4gICAgICBpc1hNTCA9IFNpenpsZS5pc1hNTCA9IGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICAgIC8vIGRvY3VtZW50RWxlbWVudCBpcyB2ZXJpZmllZCBmb3IgY2FzZXMgd2hlcmUgaXQgZG9lc24ndCB5ZXQgZXhpc3RcbiAgICAgICAgLy8gKHN1Y2ggYXMgbG9hZGluZyBpZnJhbWVzIGluIElFIC0gIzQ4MzMpXG4gICAgICAgIHZhciBkb2N1bWVudEVsZW1lbnQgPSBlbGVtICYmIChlbGVtLm93bmVyRG9jdW1lbnQgfHwgZWxlbSkuZG9jdW1lbnRFbGVtZW50O1xuICAgICAgICByZXR1cm4gZG9jdW1lbnRFbGVtZW50ID8gZG9jdW1lbnRFbGVtZW50Lm5vZGVOYW1lICE9PSBcIkhUTUxcIiA6IGZhbHNlO1xuICAgICAgfTtcbiAgICAgIC8qKlxuICAgICAgICogU2V0cyBkb2N1bWVudC1yZWxhdGVkIHZhcmlhYmxlcyBvbmNlIGJhc2VkIG9uIHRoZSBjdXJyZW50IGRvY3VtZW50XG4gICAgICAgKiBAcGFyYW0ge0VsZW1lbnR8T2JqZWN0fSBbZG9jXSBBbiBlbGVtZW50IG9yIGRvY3VtZW50IG9iamVjdCB0byB1c2UgdG8gc2V0IHRoZSBkb2N1bWVudFxuICAgICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgY3VycmVudCBkb2N1bWVudFxuICAgICAgICovXG5cblxuICAgICAgc2V0RG9jdW1lbnQgPSBTaXp6bGUuc2V0RG9jdW1lbnQgPSBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgICB2YXIgaGFzQ29tcGFyZSxcbiAgICAgICAgICAgIHN1YldpbmRvdyxcbiAgICAgICAgICAgIGRvYyA9IG5vZGUgPyBub2RlLm93bmVyRG9jdW1lbnQgfHwgbm9kZSA6IHByZWZlcnJlZERvYzsgLy8gUmV0dXJuIGVhcmx5IGlmIGRvYyBpcyBpbnZhbGlkIG9yIGFscmVhZHkgc2VsZWN0ZWRcblxuICAgICAgICBpZiAoZG9jID09PSBkb2N1bWVudCB8fCBkb2Mubm9kZVR5cGUgIT09IDkgfHwgIWRvYy5kb2N1bWVudEVsZW1lbnQpIHtcbiAgICAgICAgICByZXR1cm4gZG9jdW1lbnQ7XG4gICAgICAgIH0gLy8gVXBkYXRlIGdsb2JhbCB2YXJpYWJsZXNcblxuXG4gICAgICAgIGRvY3VtZW50ID0gZG9jO1xuICAgICAgICBkb2NFbGVtID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50O1xuICAgICAgICBkb2N1bWVudElzSFRNTCA9ICFpc1hNTChkb2N1bWVudCk7IC8vIFN1cHBvcnQ6IElFIDktMTEsIEVkZ2VcbiAgICAgICAgLy8gQWNjZXNzaW5nIGlmcmFtZSBkb2N1bWVudHMgYWZ0ZXIgdW5sb2FkIHRocm93cyBcInBlcm1pc3Npb24gZGVuaWVkXCIgZXJyb3JzIChqUXVlcnkgIzEzOTM2KVxuXG4gICAgICAgIGlmIChwcmVmZXJyZWREb2MgIT09IGRvY3VtZW50ICYmIChzdWJXaW5kb3cgPSBkb2N1bWVudC5kZWZhdWx0VmlldykgJiYgc3ViV2luZG93LnRvcCAhPT0gc3ViV2luZG93KSB7XG4gICAgICAgICAgLy8gU3VwcG9ydDogSUUgMTEsIEVkZ2VcbiAgICAgICAgICBpZiAoc3ViV2luZG93LmFkZEV2ZW50TGlzdGVuZXIpIHtcbiAgICAgICAgICAgIHN1YldpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwidW5sb2FkXCIsIHVubG9hZEhhbmRsZXIsIGZhbHNlKTsgLy8gU3VwcG9ydDogSUUgOSAtIDEwIG9ubHlcbiAgICAgICAgICB9IGVsc2UgaWYgKHN1YldpbmRvdy5hdHRhY2hFdmVudCkge1xuICAgICAgICAgICAgc3ViV2luZG93LmF0dGFjaEV2ZW50KFwib251bmxvYWRcIiwgdW5sb2FkSGFuZGxlcik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8qIEF0dHJpYnV0ZXNcbiAgICAgICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuICAgICAgICAvLyBTdXBwb3J0OiBJRTw4XG4gICAgICAgIC8vIFZlcmlmeSB0aGF0IGdldEF0dHJpYnV0ZSByZWFsbHkgcmV0dXJucyBhdHRyaWJ1dGVzIGFuZCBub3QgcHJvcGVydGllc1xuICAgICAgICAvLyAoZXhjZXB0aW5nIElFOCBib29sZWFucylcblxuXG4gICAgICAgIHN1cHBvcnQuYXR0cmlidXRlcyA9IGFzc2VydChmdW5jdGlvbiAoZWwpIHtcbiAgICAgICAgICBlbC5jbGFzc05hbWUgPSBcImlcIjtcbiAgICAgICAgICByZXR1cm4gIWVsLmdldEF0dHJpYnV0ZShcImNsYXNzTmFtZVwiKTtcbiAgICAgICAgfSk7XG4gICAgICAgIC8qIGdldEVsZW1lbnQocylCeSpcbiAgICAgICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuICAgICAgICAvLyBDaGVjayBpZiBnZXRFbGVtZW50c0J5VGFnTmFtZShcIipcIikgcmV0dXJucyBvbmx5IGVsZW1lbnRzXG5cbiAgICAgICAgc3VwcG9ydC5nZXRFbGVtZW50c0J5VGFnTmFtZSA9IGFzc2VydChmdW5jdGlvbiAoZWwpIHtcbiAgICAgICAgICBlbC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVDb21tZW50KFwiXCIpKTtcbiAgICAgICAgICByZXR1cm4gIWVsLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiKlwiKS5sZW5ndGg7XG4gICAgICAgIH0pOyAvLyBTdXBwb3J0OiBJRTw5XG5cbiAgICAgICAgc3VwcG9ydC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lID0gcm5hdGl2ZS50ZXN0KGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUpOyAvLyBTdXBwb3J0OiBJRTwxMFxuICAgICAgICAvLyBDaGVjayBpZiBnZXRFbGVtZW50QnlJZCByZXR1cm5zIGVsZW1lbnRzIGJ5IG5hbWVcbiAgICAgICAgLy8gVGhlIGJyb2tlbiBnZXRFbGVtZW50QnlJZCBtZXRob2RzIGRvbid0IHBpY2sgdXAgcHJvZ3JhbW1hdGljYWxseS1zZXQgbmFtZXMsXG4gICAgICAgIC8vIHNvIHVzZSBhIHJvdW5kYWJvdXQgZ2V0RWxlbWVudHNCeU5hbWUgdGVzdFxuXG4gICAgICAgIHN1cHBvcnQuZ2V0QnlJZCA9IGFzc2VydChmdW5jdGlvbiAoZWwpIHtcbiAgICAgICAgICBkb2NFbGVtLmFwcGVuZENoaWxkKGVsKS5pZCA9IGV4cGFuZG87XG4gICAgICAgICAgcmV0dXJuICFkb2N1bWVudC5nZXRFbGVtZW50c0J5TmFtZSB8fCAhZG9jdW1lbnQuZ2V0RWxlbWVudHNCeU5hbWUoZXhwYW5kbykubGVuZ3RoO1xuICAgICAgICB9KTsgLy8gSUQgZmlsdGVyIGFuZCBmaW5kXG5cbiAgICAgICAgaWYgKHN1cHBvcnQuZ2V0QnlJZCkge1xuICAgICAgICAgIEV4cHIuZmlsdGVyW1wiSURcIl0gPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgIHZhciBhdHRySWQgPSBpZC5yZXBsYWNlKHJ1bmVzY2FwZSwgZnVuZXNjYXBlKTtcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICAgICAgICByZXR1cm4gZWxlbS5nZXRBdHRyaWJ1dGUoXCJpZFwiKSA9PT0gYXR0cklkO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgRXhwci5maW5kW1wiSURcIl0gPSBmdW5jdGlvbiAoaWQsIGNvbnRleHQpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgY29udGV4dC5nZXRFbGVtZW50QnlJZCAhPT0gXCJ1bmRlZmluZWRcIiAmJiBkb2N1bWVudElzSFRNTCkge1xuICAgICAgICAgICAgICB2YXIgZWxlbSA9IGNvbnRleHQuZ2V0RWxlbWVudEJ5SWQoaWQpO1xuICAgICAgICAgICAgICByZXR1cm4gZWxlbSA/IFtlbGVtXSA6IFtdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgRXhwci5maWx0ZXJbXCJJRFwiXSA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgdmFyIGF0dHJJZCA9IGlkLnJlcGxhY2UocnVuZXNjYXBlLCBmdW5lc2NhcGUpO1xuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICAgICAgICAgIHZhciBub2RlID0gdHlwZW9mIGVsZW0uZ2V0QXR0cmlidXRlTm9kZSAhPT0gXCJ1bmRlZmluZWRcIiAmJiBlbGVtLmdldEF0dHJpYnV0ZU5vZGUoXCJpZFwiKTtcbiAgICAgICAgICAgICAgcmV0dXJuIG5vZGUgJiYgbm9kZS52YWx1ZSA9PT0gYXR0cklkO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9OyAvLyBTdXBwb3J0OiBJRSA2IC0gNyBvbmx5XG4gICAgICAgICAgLy8gZ2V0RWxlbWVudEJ5SWQgaXMgbm90IHJlbGlhYmxlIGFzIGEgZmluZCBzaG9ydGN1dFxuXG5cbiAgICAgICAgICBFeHByLmZpbmRbXCJJRFwiXSA9IGZ1bmN0aW9uIChpZCwgY29udGV4dCkge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBjb250ZXh0LmdldEVsZW1lbnRCeUlkICE9PSBcInVuZGVmaW5lZFwiICYmIGRvY3VtZW50SXNIVE1MKSB7XG4gICAgICAgICAgICAgIHZhciBub2RlLFxuICAgICAgICAgICAgICAgICAgaSxcbiAgICAgICAgICAgICAgICAgIGVsZW1zLFxuICAgICAgICAgICAgICAgICAgZWxlbSA9IGNvbnRleHQuZ2V0RWxlbWVudEJ5SWQoaWQpO1xuXG4gICAgICAgICAgICAgIGlmIChlbGVtKSB7XG4gICAgICAgICAgICAgICAgLy8gVmVyaWZ5IHRoZSBpZCBhdHRyaWJ1dGVcbiAgICAgICAgICAgICAgICBub2RlID0gZWxlbS5nZXRBdHRyaWJ1dGVOb2RlKFwiaWRcIik7XG5cbiAgICAgICAgICAgICAgICBpZiAobm9kZSAmJiBub2RlLnZhbHVlID09PSBpZCkge1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIFtlbGVtXTtcbiAgICAgICAgICAgICAgICB9IC8vIEZhbGwgYmFjayBvbiBnZXRFbGVtZW50c0J5TmFtZVxuXG5cbiAgICAgICAgICAgICAgICBlbGVtcyA9IGNvbnRleHQuZ2V0RWxlbWVudHNCeU5hbWUoaWQpO1xuICAgICAgICAgICAgICAgIGkgPSAwO1xuXG4gICAgICAgICAgICAgICAgd2hpbGUgKGVsZW0gPSBlbGVtc1tpKytdKSB7XG4gICAgICAgICAgICAgICAgICBub2RlID0gZWxlbS5nZXRBdHRyaWJ1dGVOb2RlKFwiaWRcIik7XG5cbiAgICAgICAgICAgICAgICAgIGlmIChub2RlICYmIG5vZGUudmFsdWUgPT09IGlkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbZWxlbV07XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH07XG4gICAgICAgIH0gLy8gVGFnXG5cblxuICAgICAgICBFeHByLmZpbmRbXCJUQUdcIl0gPSBzdXBwb3J0LmdldEVsZW1lbnRzQnlUYWdOYW1lID8gZnVuY3Rpb24gKHRhZywgY29udGV4dCkge1xuICAgICAgICAgIGlmICh0eXBlb2YgY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAgICAgcmV0dXJuIGNvbnRleHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUodGFnKTsgLy8gRG9jdW1lbnRGcmFnbWVudCBub2RlcyBkb24ndCBoYXZlIGdFQlROXG4gICAgICAgICAgfSBlbHNlIGlmIChzdXBwb3J0LnFzYSkge1xuICAgICAgICAgICAgcmV0dXJuIGNvbnRleHQucXVlcnlTZWxlY3RvckFsbCh0YWcpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSA6IGZ1bmN0aW9uICh0YWcsIGNvbnRleHQpIHtcbiAgICAgICAgICB2YXIgZWxlbSxcbiAgICAgICAgICAgICAgdG1wID0gW10sXG4gICAgICAgICAgICAgIGkgPSAwLFxuICAgICAgICAgICAgICAvLyBCeSBoYXBweSBjb2luY2lkZW5jZSwgYSAoYnJva2VuKSBnRUJUTiBhcHBlYXJzIG9uIERvY3VtZW50RnJhZ21lbnQgbm9kZXMgdG9vXG4gICAgICAgICAgcmVzdWx0cyA9IGNvbnRleHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUodGFnKTsgLy8gRmlsdGVyIG91dCBwb3NzaWJsZSBjb21tZW50c1xuXG4gICAgICAgICAgaWYgKHRhZyA9PT0gXCIqXCIpIHtcbiAgICAgICAgICAgIHdoaWxlIChlbGVtID0gcmVzdWx0c1tpKytdKSB7XG4gICAgICAgICAgICAgIGlmIChlbGVtLm5vZGVUeXBlID09PSAxKSB7XG4gICAgICAgICAgICAgICAgdG1wLnB1c2goZWxlbSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHRtcDtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICAgICAgfTsgLy8gQ2xhc3NcblxuICAgICAgICBFeHByLmZpbmRbXCJDTEFTU1wiXSA9IHN1cHBvcnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSAmJiBmdW5jdGlvbiAoY2xhc3NOYW1lLCBjb250ZXh0KSB7XG4gICAgICAgICAgaWYgKHR5cGVvZiBjb250ZXh0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUgIT09IFwidW5kZWZpbmVkXCIgJiYgZG9jdW1lbnRJc0hUTUwpIHtcbiAgICAgICAgICAgIHJldHVybiBjb250ZXh0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoY2xhc3NOYW1lKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIC8qIFFTQS9tYXRjaGVzU2VsZWN0b3JcbiAgICAgICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuICAgICAgICAvLyBRU0EgYW5kIG1hdGNoZXNTZWxlY3RvciBzdXBwb3J0XG4gICAgICAgIC8vIG1hdGNoZXNTZWxlY3Rvcig6YWN0aXZlKSByZXBvcnRzIGZhbHNlIHdoZW4gdHJ1ZSAoSUU5L09wZXJhIDExLjUpXG5cblxuICAgICAgICByYnVnZ3lNYXRjaGVzID0gW107IC8vIHFTYSg6Zm9jdXMpIHJlcG9ydHMgZmFsc2Ugd2hlbiB0cnVlIChDaHJvbWUgMjEpXG4gICAgICAgIC8vIFdlIGFsbG93IHRoaXMgYmVjYXVzZSBvZiBhIGJ1ZyBpbiBJRTgvOSB0aGF0IHRocm93cyBhbiBlcnJvclxuICAgICAgICAvLyB3aGVuZXZlciBgZG9jdW1lbnQuYWN0aXZlRWxlbWVudGAgaXMgYWNjZXNzZWQgb24gYW4gaWZyYW1lXG4gICAgICAgIC8vIFNvLCB3ZSBhbGxvdyA6Zm9jdXMgdG8gcGFzcyB0aHJvdWdoIFFTQSBhbGwgdGhlIHRpbWUgdG8gYXZvaWQgdGhlIElFIGVycm9yXG4gICAgICAgIC8vIFNlZSBodHRwczovL2J1Z3MuanF1ZXJ5LmNvbS90aWNrZXQvMTMzNzhcblxuICAgICAgICByYnVnZ3lRU0EgPSBbXTtcblxuICAgICAgICBpZiAoc3VwcG9ydC5xc2EgPSBybmF0aXZlLnRlc3QoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCkpIHtcbiAgICAgICAgICAvLyBCdWlsZCBRU0EgcmVnZXhcbiAgICAgICAgICAvLyBSZWdleCBzdHJhdGVneSBhZG9wdGVkIGZyb20gRGllZ28gUGVyaW5pXG4gICAgICAgICAgYXNzZXJ0KGZ1bmN0aW9uIChlbCkge1xuICAgICAgICAgICAgLy8gU2VsZWN0IGlzIHNldCB0byBlbXB0eSBzdHJpbmcgb24gcHVycG9zZVxuICAgICAgICAgICAgLy8gVGhpcyBpcyB0byB0ZXN0IElFJ3MgdHJlYXRtZW50IG9mIG5vdCBleHBsaWNpdGx5XG4gICAgICAgICAgICAvLyBzZXR0aW5nIGEgYm9vbGVhbiBjb250ZW50IGF0dHJpYnV0ZSxcbiAgICAgICAgICAgIC8vIHNpbmNlIGl0cyBwcmVzZW5jZSBzaG91bGQgYmUgZW5vdWdoXG4gICAgICAgICAgICAvLyBodHRwczovL2J1Z3MuanF1ZXJ5LmNvbS90aWNrZXQvMTIzNTlcbiAgICAgICAgICAgIGRvY0VsZW0uYXBwZW5kQ2hpbGQoZWwpLmlubmVySFRNTCA9IEFHUG9saWN5LmNyZWF0ZUhUTUwoXCI8YSBpZD0nXCIgKyBleHBhbmRvICsgXCInPjwvYT5cIiArIFwiPHNlbGVjdCBpZD0nXCIgKyBleHBhbmRvICsgXCItXFxyXFxcXCcgbXNhbGxvd2NhcHR1cmU9Jyc+XCIgKyBcIjxvcHRpb24gc2VsZWN0ZWQ9Jyc+PC9vcHRpb24+PC9zZWxlY3Q+XCIpOyAvLyBTdXBwb3J0OiBJRTgsIE9wZXJhIDExLTEyLjE2XG4gICAgICAgICAgICAvLyBOb3RoaW5nIHNob3VsZCBiZSBzZWxlY3RlZCB3aGVuIGVtcHR5IHN0cmluZ3MgZm9sbG93IF49IG9yICQ9IG9yICo9XG4gICAgICAgICAgICAvLyBUaGUgdGVzdCBhdHRyaWJ1dGUgbXVzdCBiZSB1bmtub3duIGluIE9wZXJhIGJ1dCBcInNhZmVcIiBmb3IgV2luUlRcbiAgICAgICAgICAgIC8vIGh0dHBzOi8vbXNkbi5taWNyb3NvZnQuY29tL2VuLXVzL2xpYnJhcnkvaWUvaGg0NjUzODguYXNweCNhdHRyaWJ1dGVfc2VjdGlvblxuXG4gICAgICAgICAgICBpZiAoZWwucXVlcnlTZWxlY3RvckFsbChcIlttc2FsbG93Y2FwdHVyZV49JyddXCIpLmxlbmd0aCkge1xuICAgICAgICAgICAgICByYnVnZ3lRU0EucHVzaChcIlsqXiRdPVwiICsgd2hpdGVzcGFjZSArIFwiKig/OicnfFxcXCJcXFwiKVwiKTtcbiAgICAgICAgICAgIH0gLy8gU3VwcG9ydDogSUU4XG4gICAgICAgICAgICAvLyBCb29sZWFuIGF0dHJpYnV0ZXMgYW5kIFwidmFsdWVcIiBhcmUgbm90IHRyZWF0ZWQgY29ycmVjdGx5XG5cblxuICAgICAgICAgICAgaWYgKCFlbC5xdWVyeVNlbGVjdG9yQWxsKFwiW3NlbGVjdGVkXVwiKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgcmJ1Z2d5UVNBLnB1c2goXCJcXFxcW1wiICsgd2hpdGVzcGFjZSArIFwiKig/OnZhbHVlfFwiICsgYm9vbGVhbnMgKyBcIilcIik7XG4gICAgICAgICAgICB9IC8vIFN1cHBvcnQ6IENocm9tZTwyOSwgQW5kcm9pZDw0LjQsIFNhZmFyaTw3LjArLCBpT1M8Ny4wKywgUGhhbnRvbUpTPDEuOS44K1xuXG5cbiAgICAgICAgICAgIGlmICghZWwucXVlcnlTZWxlY3RvckFsbChcIltpZH49XCIgKyBleHBhbmRvICsgXCItXVwiKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgcmJ1Z2d5UVNBLnB1c2goXCJ+PVwiKTtcbiAgICAgICAgICAgIH0gLy8gV2Via2l0L09wZXJhIC0gOmNoZWNrZWQgc2hvdWxkIHJldHVybiBzZWxlY3RlZCBvcHRpb24gZWxlbWVudHNcbiAgICAgICAgICAgIC8vIGh0dHA6Ly93d3cudzMub3JnL1RSLzIwMTEvUkVDLWNzczMtc2VsZWN0b3JzLTIwMTEwOTI5LyNjaGVja2VkXG4gICAgICAgICAgICAvLyBJRTggdGhyb3dzIGVycm9yIGhlcmUgYW5kIHdpbGwgbm90IHNlZSBsYXRlciB0ZXN0c1xuXG5cbiAgICAgICAgICAgIGlmICghZWwucXVlcnlTZWxlY3RvckFsbChcIjpjaGVja2VkXCIpLmxlbmd0aCkge1xuICAgICAgICAgICAgICByYnVnZ3lRU0EucHVzaChcIjpjaGVja2VkXCIpO1xuICAgICAgICAgICAgfSAvLyBTdXBwb3J0OiBTYWZhcmkgOCssIGlPUyA4K1xuICAgICAgICAgICAgLy8gaHR0cHM6Ly9idWdzLndlYmtpdC5vcmcvc2hvd19idWcuY2dpP2lkPTEzNjg1MVxuICAgICAgICAgICAgLy8gSW4tcGFnZSBgc2VsZWN0b3IjaWQgc2libGluZy1jb21iaW5hdG9yIHNlbGVjdG9yYCBmYWlsc1xuXG5cbiAgICAgICAgICAgIGlmICghZWwucXVlcnlTZWxlY3RvckFsbChcImEjXCIgKyBleHBhbmRvICsgXCIrKlwiKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgcmJ1Z2d5UVNBLnB1c2goXCIuIy4rWyt+XVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgICBhc3NlcnQoZnVuY3Rpb24gKGVsKSB7XG4gICAgICAgICAgICBlbC5pbm5lckhUTUwgPSBBR1BvbGljeS5jcmVhdGVIVE1MKFwiPGEgaHJlZj0nJyBkaXNhYmxlZD0nZGlzYWJsZWQnPjwvYT5cIiArIFwiPHNlbGVjdCBkaXNhYmxlZD0nZGlzYWJsZWQnPjxvcHRpb24vPjwvc2VsZWN0PlwiKTsgLy8gU3VwcG9ydDogV2luZG93cyA4IE5hdGl2ZSBBcHBzXG4gICAgICAgICAgICAvLyBUaGUgdHlwZSBhbmQgbmFtZSBhdHRyaWJ1dGVzIGFyZSByZXN0cmljdGVkIGR1cmluZyAuaW5uZXJIVE1MIGFzc2lnbm1lbnRcblxuICAgICAgICAgICAgdmFyIGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpO1xuICAgICAgICAgICAgaW5wdXQuc2V0QXR0cmlidXRlKFwidHlwZVwiLCBcImhpZGRlblwiKTtcbiAgICAgICAgICAgIGVsLmFwcGVuZENoaWxkKGlucHV0KS5zZXRBdHRyaWJ1dGUoXCJuYW1lXCIsIFwiRFwiKTsgLy8gU3VwcG9ydDogSUU4XG4gICAgICAgICAgICAvLyBFbmZvcmNlIGNhc2Utc2Vuc2l0aXZpdHkgb2YgbmFtZSBhdHRyaWJ1dGVcblxuICAgICAgICAgICAgaWYgKGVsLnF1ZXJ5U2VsZWN0b3JBbGwoXCJbbmFtZT1kXVwiKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgcmJ1Z2d5UVNBLnB1c2goXCJuYW1lXCIgKyB3aGl0ZXNwYWNlICsgXCIqWypeJHwhfl0/PVwiKTtcbiAgICAgICAgICAgIH0gLy8gRkYgMy41IC0gOmVuYWJsZWQvOmRpc2FibGVkIGFuZCBoaWRkZW4gZWxlbWVudHMgKGhpZGRlbiBlbGVtZW50cyBhcmUgc3RpbGwgZW5hYmxlZClcbiAgICAgICAgICAgIC8vIElFOCB0aHJvd3MgZXJyb3IgaGVyZSBhbmQgd2lsbCBub3Qgc2VlIGxhdGVyIHRlc3RzXG5cblxuICAgICAgICAgICAgaWYgKGVsLnF1ZXJ5U2VsZWN0b3JBbGwoXCI6ZW5hYmxlZFwiKS5sZW5ndGggIT09IDIpIHtcbiAgICAgICAgICAgICAgcmJ1Z2d5UVNBLnB1c2goXCI6ZW5hYmxlZFwiLCBcIjpkaXNhYmxlZFwiKTtcbiAgICAgICAgICAgIH0gLy8gU3VwcG9ydDogSUU5LTExK1xuICAgICAgICAgICAgLy8gSUUncyA6ZGlzYWJsZWQgc2VsZWN0b3IgZG9lcyBub3QgcGljayB1cCB0aGUgY2hpbGRyZW4gb2YgZGlzYWJsZWQgZmllbGRzZXRzXG5cblxuICAgICAgICAgICAgZG9jRWxlbS5hcHBlbmRDaGlsZChlbCkuZGlzYWJsZWQgPSB0cnVlO1xuXG4gICAgICAgICAgICBpZiAoZWwucXVlcnlTZWxlY3RvckFsbChcIjpkaXNhYmxlZFwiKS5sZW5ndGggIT09IDIpIHtcbiAgICAgICAgICAgICAgcmJ1Z2d5UVNBLnB1c2goXCI6ZW5hYmxlZFwiLCBcIjpkaXNhYmxlZFwiKTtcbiAgICAgICAgICAgIH0gLy8gT3BlcmEgMTAtMTEgZG9lcyBub3QgdGhyb3cgb24gcG9zdC1jb21tYSBpbnZhbGlkIHBzZXVkb3NcblxuXG4gICAgICAgICAgICBlbC5xdWVyeVNlbGVjdG9yQWxsKFwiKiw6eFwiKTtcbiAgICAgICAgICAgIHJidWdneVFTQS5wdXNoKFwiLC4qOlwiKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChzdXBwb3J0Lm1hdGNoZXNTZWxlY3RvciA9IHJuYXRpdmUudGVzdChtYXRjaGVzID0gZG9jRWxlbS5tYXRjaGVzIHx8IGRvY0VsZW0ud2Via2l0TWF0Y2hlc1NlbGVjdG9yIHx8IGRvY0VsZW0ubW96TWF0Y2hlc1NlbGVjdG9yIHx8IGRvY0VsZW0ub01hdGNoZXNTZWxlY3RvciB8fCBkb2NFbGVtLm1zTWF0Y2hlc1NlbGVjdG9yKSkge1xuICAgICAgICAgIGFzc2VydChmdW5jdGlvbiAoZWwpIHtcbiAgICAgICAgICAgIC8vIENoZWNrIHRvIHNlZSBpZiBpdCdzIHBvc3NpYmxlIHRvIGRvIG1hdGNoZXNTZWxlY3RvclxuICAgICAgICAgICAgLy8gb24gYSBkaXNjb25uZWN0ZWQgbm9kZSAoSUUgOSlcbiAgICAgICAgICAgIHN1cHBvcnQuZGlzY29ubmVjdGVkTWF0Y2ggPSBtYXRjaGVzLmNhbGwoZWwsIFwiKlwiKTsgLy8gVGhpcyBzaG91bGQgZmFpbCB3aXRoIGFuIGV4Y2VwdGlvblxuICAgICAgICAgICAgLy8gR2Vja28gZG9lcyBub3QgZXJyb3IsIHJldHVybnMgZmFsc2UgaW5zdGVhZFxuXG4gICAgICAgICAgICBtYXRjaGVzLmNhbGwoZWwsIFwiW3MhPScnXTp4XCIpO1xuICAgICAgICAgICAgcmJ1Z2d5TWF0Y2hlcy5wdXNoKFwiIT1cIiwgcHNldWRvcyk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByYnVnZ3lRU0EgPSByYnVnZ3lRU0EubGVuZ3RoICYmIG5ldyBSZWdFeHAocmJ1Z2d5UVNBLmpvaW4oXCJ8XCIpKTtcbiAgICAgICAgcmJ1Z2d5TWF0Y2hlcyA9IHJidWdneU1hdGNoZXMubGVuZ3RoICYmIG5ldyBSZWdFeHAocmJ1Z2d5TWF0Y2hlcy5qb2luKFwifFwiKSk7XG4gICAgICAgIC8qIENvbnRhaW5zXG4gICAgICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuICAgICAgICBoYXNDb21wYXJlID0gcm5hdGl2ZS50ZXN0KGRvY0VsZW0uY29tcGFyZURvY3VtZW50UG9zaXRpb24pOyAvLyBFbGVtZW50IGNvbnRhaW5zIGFub3RoZXJcbiAgICAgICAgLy8gUHVycG9zZWZ1bGx5IHNlbGYtZXhjbHVzaXZlXG4gICAgICAgIC8vIEFzIGluLCBhbiBlbGVtZW50IGRvZXMgbm90IGNvbnRhaW4gaXRzZWxmXG5cbiAgICAgICAgY29udGFpbnMgPSBoYXNDb21wYXJlIHx8IHJuYXRpdmUudGVzdChkb2NFbGVtLmNvbnRhaW5zKSA/IGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgICAgdmFyIGFkb3duID0gYS5ub2RlVHlwZSA9PT0gOSA/IGEuZG9jdW1lbnRFbGVtZW50IDogYSxcbiAgICAgICAgICAgICAgYnVwID0gYiAmJiBiLnBhcmVudE5vZGU7XG4gICAgICAgICAgcmV0dXJuIGEgPT09IGJ1cCB8fCAhIShidXAgJiYgYnVwLm5vZGVUeXBlID09PSAxICYmIChhZG93bi5jb250YWlucyA/IGFkb3duLmNvbnRhaW5zKGJ1cCkgOiBhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uICYmIGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24oYnVwKSAmIDE2KSk7XG4gICAgICAgIH0gOiBmdW5jdGlvbiAoYSwgYikge1xuICAgICAgICAgIGlmIChiKSB7XG4gICAgICAgICAgICB3aGlsZSAoYiA9IGIucGFyZW50Tm9kZSkge1xuICAgICAgICAgICAgICBpZiAoYiA9PT0gYSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9O1xuICAgICAgICAvKiBTb3J0aW5nXG4gICAgICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cbiAgICAgICAgLy8gRG9jdW1lbnQgb3JkZXIgc29ydGluZ1xuXG4gICAgICAgIHNvcnRPcmRlciA9IGhhc0NvbXBhcmUgPyBmdW5jdGlvbiAoYSwgYikge1xuICAgICAgICAgIC8vIEZsYWcgZm9yIGR1cGxpY2F0ZSByZW1vdmFsXG4gICAgICAgICAgaWYgKGEgPT09IGIpIHtcbiAgICAgICAgICAgIGhhc0R1cGxpY2F0ZSA9IHRydWU7XG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICB9IC8vIFNvcnQgb24gbWV0aG9kIGV4aXN0ZW5jZSBpZiBvbmx5IG9uZSBpbnB1dCBoYXMgY29tcGFyZURvY3VtZW50UG9zaXRpb25cblxuXG4gICAgICAgICAgdmFyIGNvbXBhcmUgPSAhYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiAtICFiLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uO1xuXG4gICAgICAgICAgaWYgKGNvbXBhcmUpIHtcbiAgICAgICAgICAgIHJldHVybiBjb21wYXJlO1xuICAgICAgICAgIH0gLy8gQ2FsY3VsYXRlIHBvc2l0aW9uIGlmIGJvdGggaW5wdXRzIGJlbG9uZyB0byB0aGUgc2FtZSBkb2N1bWVudFxuXG5cbiAgICAgICAgICBjb21wYXJlID0gKGEub3duZXJEb2N1bWVudCB8fCBhKSA9PT0gKGIub3duZXJEb2N1bWVudCB8fCBiKSA/IGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24oYikgOiAvLyBPdGhlcndpc2Ugd2Uga25vdyB0aGV5IGFyZSBkaXNjb25uZWN0ZWRcbiAgICAgICAgICAxOyAvLyBEaXNjb25uZWN0ZWQgbm9kZXNcblxuICAgICAgICAgIGlmIChjb21wYXJlICYgMSB8fCAhc3VwcG9ydC5zb3J0RGV0YWNoZWQgJiYgYi5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbihhKSA9PT0gY29tcGFyZSkge1xuICAgICAgICAgICAgLy8gQ2hvb3NlIHRoZSBmaXJzdCBlbGVtZW50IHRoYXQgaXMgcmVsYXRlZCB0byBvdXIgcHJlZmVycmVkIGRvY3VtZW50XG4gICAgICAgICAgICBpZiAoYSA9PT0gZG9jdW1lbnQgfHwgYS5vd25lckRvY3VtZW50ID09PSBwcmVmZXJyZWREb2MgJiYgY29udGFpbnMocHJlZmVycmVkRG9jLCBhKSkge1xuICAgICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChiID09PSBkb2N1bWVudCB8fCBiLm93bmVyRG9jdW1lbnQgPT09IHByZWZlcnJlZERvYyAmJiBjb250YWlucyhwcmVmZXJyZWREb2MsIGIpKSB7XG4gICAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICAgICAgfSAvLyBNYWludGFpbiBvcmlnaW5hbCBvcmRlclxuXG5cbiAgICAgICAgICAgIHJldHVybiBzb3J0SW5wdXQgPyBpbmRleE9mKHNvcnRJbnB1dCwgYSkgLSBpbmRleE9mKHNvcnRJbnB1dCwgYikgOiAwO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiBjb21wYXJlICYgNCA/IC0xIDogMTtcbiAgICAgICAgfSA6IGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgICAgLy8gRXhpdCBlYXJseSBpZiB0aGUgbm9kZXMgYXJlIGlkZW50aWNhbFxuICAgICAgICAgIGlmIChhID09PSBiKSB7XG4gICAgICAgICAgICBoYXNEdXBsaWNhdGUgPSB0cnVlO1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdmFyIGN1cixcbiAgICAgICAgICAgICAgaSA9IDAsXG4gICAgICAgICAgICAgIGF1cCA9IGEucGFyZW50Tm9kZSxcbiAgICAgICAgICAgICAgYnVwID0gYi5wYXJlbnROb2RlLFxuICAgICAgICAgICAgICBhcCA9IFthXSxcbiAgICAgICAgICAgICAgYnAgPSBbYl07IC8vIFBhcmVudGxlc3Mgbm9kZXMgYXJlIGVpdGhlciBkb2N1bWVudHMgb3IgZGlzY29ubmVjdGVkXG5cbiAgICAgICAgICBpZiAoIWF1cCB8fCAhYnVwKSB7XG4gICAgICAgICAgICByZXR1cm4gYSA9PT0gZG9jdW1lbnQgPyAtMSA6IGIgPT09IGRvY3VtZW50ID8gMSA6IGF1cCA/IC0xIDogYnVwID8gMSA6IHNvcnRJbnB1dCA/IGluZGV4T2Yoc29ydElucHV0LCBhKSAtIGluZGV4T2Yoc29ydElucHV0LCBiKSA6IDA7IC8vIElmIHRoZSBub2RlcyBhcmUgc2libGluZ3MsIHdlIGNhbiBkbyBhIHF1aWNrIGNoZWNrXG4gICAgICAgICAgfSBlbHNlIGlmIChhdXAgPT09IGJ1cCkge1xuICAgICAgICAgICAgcmV0dXJuIHNpYmxpbmdDaGVjayhhLCBiKTtcbiAgICAgICAgICB9IC8vIE90aGVyd2lzZSB3ZSBuZWVkIGZ1bGwgbGlzdHMgb2YgdGhlaXIgYW5jZXN0b3JzIGZvciBjb21wYXJpc29uXG5cblxuICAgICAgICAgIGN1ciA9IGE7XG5cbiAgICAgICAgICB3aGlsZSAoY3VyID0gY3VyLnBhcmVudE5vZGUpIHtcbiAgICAgICAgICAgIGFwLnVuc2hpZnQoY3VyKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBjdXIgPSBiO1xuXG4gICAgICAgICAgd2hpbGUgKGN1ciA9IGN1ci5wYXJlbnROb2RlKSB7XG4gICAgICAgICAgICBicC51bnNoaWZ0KGN1cik7XG4gICAgICAgICAgfSAvLyBXYWxrIGRvd24gdGhlIHRyZWUgbG9va2luZyBmb3IgYSBkaXNjcmVwYW5jeVxuXG5cbiAgICAgICAgICB3aGlsZSAoYXBbaV0gPT09IGJwW2ldKSB7XG4gICAgICAgICAgICBpKys7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIGkgPyAvLyBEbyBhIHNpYmxpbmcgY2hlY2sgaWYgdGhlIG5vZGVzIGhhdmUgYSBjb21tb24gYW5jZXN0b3JcbiAgICAgICAgICBzaWJsaW5nQ2hlY2soYXBbaV0sIGJwW2ldKSA6IC8vIE90aGVyd2lzZSBub2RlcyBpbiBvdXIgZG9jdW1lbnQgc29ydCBmaXJzdFxuICAgICAgICAgIGFwW2ldID09PSBwcmVmZXJyZWREb2MgPyAtMSA6IGJwW2ldID09PSBwcmVmZXJyZWREb2MgPyAxIDogMDtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGRvY3VtZW50O1xuICAgICAgfTtcblxuICAgICAgU2l6emxlLm1hdGNoZXMgPSBmdW5jdGlvbiAoZXhwciwgZWxlbWVudHMpIHtcbiAgICAgICAgcmV0dXJuIFNpenpsZShleHByLCBudWxsLCBudWxsLCBlbGVtZW50cyk7XG4gICAgICB9O1xuXG4gICAgICBTaXp6bGUubWF0Y2hlc1NlbGVjdG9yID0gZnVuY3Rpb24gKGVsZW0sIGV4cHIpIHtcbiAgICAgICAgLy8gU2V0IGRvY3VtZW50IHZhcnMgaWYgbmVlZGVkXG4gICAgICAgIGlmICgoZWxlbS5vd25lckRvY3VtZW50IHx8IGVsZW0pICE9PSBkb2N1bWVudCkge1xuICAgICAgICAgIHNldERvY3VtZW50KGVsZW0pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHN1cHBvcnQubWF0Y2hlc1NlbGVjdG9yICYmIGRvY3VtZW50SXNIVE1MICYmICFub25uYXRpdmVTZWxlY3RvckNhY2hlW2V4cHIgKyBcIiBcIl0gJiYgKCFyYnVnZ3lNYXRjaGVzIHx8ICFyYnVnZ3lNYXRjaGVzLnRlc3QoZXhwcikpICYmICghcmJ1Z2d5UVNBIHx8ICFyYnVnZ3lRU0EudGVzdChleHByKSkpIHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgdmFyIHJldCA9IG1hdGNoZXMuY2FsbChlbGVtLCBleHByKTsgLy8gSUUgOSdzIG1hdGNoZXNTZWxlY3RvciByZXR1cm5zIGZhbHNlIG9uIGRpc2Nvbm5lY3RlZCBub2Rlc1xuXG4gICAgICAgICAgICBpZiAocmV0IHx8IHN1cHBvcnQuZGlzY29ubmVjdGVkTWF0Y2ggfHwgLy8gQXMgd2VsbCwgZGlzY29ubmVjdGVkIG5vZGVzIGFyZSBzYWlkIHRvIGJlIGluIGEgZG9jdW1lbnRcbiAgICAgICAgICAgIC8vIGZyYWdtZW50IGluIElFIDlcbiAgICAgICAgICAgIGVsZW0uZG9jdW1lbnQgJiYgZWxlbS5kb2N1bWVudC5ub2RlVHlwZSAhPT0gMTEpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHJldDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAvLyBbQWRHdWFyZCBQYXRoXTogRml4IHRoZSBjYWNoZSB2YWx1ZVxuICAgICAgICAgICAgbm9ubmF0aXZlU2VsZWN0b3JDYWNoZShleHByLCB0cnVlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gU2l6emxlKGV4cHIsIGRvY3VtZW50LCBudWxsLCBbZWxlbV0pLmxlbmd0aCA+IDA7XG4gICAgICB9O1xuXG4gICAgICBTaXp6bGUuY29udGFpbnMgPSBmdW5jdGlvbiAoY29udGV4dCwgZWxlbSkge1xuICAgICAgICAvLyBTZXQgZG9jdW1lbnQgdmFycyBpZiBuZWVkZWRcbiAgICAgICAgaWYgKChjb250ZXh0Lm93bmVyRG9jdW1lbnQgfHwgY29udGV4dCkgIT09IGRvY3VtZW50KSB7XG4gICAgICAgICAgc2V0RG9jdW1lbnQoY29udGV4dCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gY29udGFpbnMoY29udGV4dCwgZWxlbSk7XG4gICAgICB9O1xuXG4gICAgICBTaXp6bGUuYXR0ciA9IGZ1bmN0aW9uIChlbGVtLCBuYW1lKSB7XG4gICAgICAgIC8vIFNldCBkb2N1bWVudCB2YXJzIGlmIG5lZWRlZFxuICAgICAgICBpZiAoKGVsZW0ub3duZXJEb2N1bWVudCB8fCBlbGVtKSAhPT0gZG9jdW1lbnQpIHtcbiAgICAgICAgICBzZXREb2N1bWVudChlbGVtKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBmbiA9IEV4cHIuYXR0ckhhbmRsZVtuYW1lLnRvTG93ZXJDYXNlKCldLFxuICAgICAgICAgICAgLy8gRG9uJ3QgZ2V0IGZvb2xlZCBieSBPYmplY3QucHJvdG90eXBlIHByb3BlcnRpZXMgKGpRdWVyeSAjMTM4MDcpXG4gICAgICAgIHZhbCA9IGZuICYmIGhhc093bi5jYWxsKEV4cHIuYXR0ckhhbmRsZSwgbmFtZS50b0xvd2VyQ2FzZSgpKSA/IGZuKGVsZW0sIG5hbWUsICFkb2N1bWVudElzSFRNTCkgOiB1bmRlZmluZWQ7XG4gICAgICAgIHJldHVybiB2YWwgIT09IHVuZGVmaW5lZCA/IHZhbCA6IHN1cHBvcnQuYXR0cmlidXRlcyB8fCAhZG9jdW1lbnRJc0hUTUwgPyBlbGVtLmdldEF0dHJpYnV0ZShuYW1lKSA6ICh2YWwgPSBlbGVtLmdldEF0dHJpYnV0ZU5vZGUobmFtZSkpICYmIHZhbC5zcGVjaWZpZWQgPyB2YWwudmFsdWUgOiBudWxsO1xuICAgICAgfTtcblxuICAgICAgU2l6emxlLmVzY2FwZSA9IGZ1bmN0aW9uIChzZWwpIHtcbiAgICAgICAgcmV0dXJuIChzZWwgKyBcIlwiKS5yZXBsYWNlKHJjc3Nlc2NhcGUsIGZjc3Nlc2NhcGUpO1xuICAgICAgfTtcblxuICAgICAgU2l6emxlLmVycm9yID0gZnVuY3Rpb24gKG1zZykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTeW50YXggZXJyb3IsIHVucmVjb2duaXplZCBleHByZXNzaW9uOiBcIiArIG1zZyk7XG4gICAgICB9O1xuICAgICAgLyoqXG4gICAgICAgKiBEb2N1bWVudCBzb3J0aW5nIGFuZCByZW1vdmluZyBkdXBsaWNhdGVzXG4gICAgICAgKiBAcGFyYW0ge0FycmF5TGlrZX0gcmVzdWx0c1xuICAgICAgICovXG5cblxuICAgICAgU2l6emxlLnVuaXF1ZVNvcnQgPSBmdW5jdGlvbiAocmVzdWx0cykge1xuICAgICAgICB2YXIgZWxlbSxcbiAgICAgICAgICAgIGR1cGxpY2F0ZXMgPSBbXSxcbiAgICAgICAgICAgIGogPSAwLFxuICAgICAgICAgICAgaSA9IDA7IC8vIFVubGVzcyB3ZSAqa25vdyogd2UgY2FuIGRldGVjdCBkdXBsaWNhdGVzLCBhc3N1bWUgdGhlaXIgcHJlc2VuY2VcblxuICAgICAgICBoYXNEdXBsaWNhdGUgPSAhc3VwcG9ydC5kZXRlY3REdXBsaWNhdGVzO1xuICAgICAgICBzb3J0SW5wdXQgPSAhc3VwcG9ydC5zb3J0U3RhYmxlICYmIHJlc3VsdHMuc2xpY2UoMCk7XG4gICAgICAgIHJlc3VsdHMuc29ydChzb3J0T3JkZXIpO1xuXG4gICAgICAgIGlmIChoYXNEdXBsaWNhdGUpIHtcbiAgICAgICAgICB3aGlsZSAoZWxlbSA9IHJlc3VsdHNbaSsrXSkge1xuICAgICAgICAgICAgaWYgKGVsZW0gPT09IHJlc3VsdHNbaV0pIHtcbiAgICAgICAgICAgICAgaiA9IGR1cGxpY2F0ZXMucHVzaChpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cbiAgICAgICAgICB3aGlsZSAoai0tKSB7XG4gICAgICAgICAgICByZXN1bHRzLnNwbGljZShkdXBsaWNhdGVzW2pdLCAxKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gLy8gQ2xlYXIgaW5wdXQgYWZ0ZXIgc29ydGluZyB0byByZWxlYXNlIG9iamVjdHNcbiAgICAgICAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9qcXVlcnkvc2l6emxlL3B1bGwvMjI1XG5cblxuICAgICAgICBzb3J0SW5wdXQgPSBudWxsO1xuICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICAgIH07XG4gICAgICAvKipcbiAgICAgICAqIFV0aWxpdHkgZnVuY3Rpb24gZm9yIHJldHJpZXZpbmcgdGhlIHRleHQgdmFsdWUgb2YgYW4gYXJyYXkgb2YgRE9NIG5vZGVzXG4gICAgICAgKiBAcGFyYW0ge0FycmF5fEVsZW1lbnR9IGVsZW1cbiAgICAgICAqL1xuXG5cbiAgICAgIGdldFRleHQgPSBTaXp6bGUuZ2V0VGV4dCA9IGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICAgIHZhciBub2RlLFxuICAgICAgICAgICAgcmV0ID0gXCJcIixcbiAgICAgICAgICAgIGkgPSAwLFxuICAgICAgICAgICAgbm9kZVR5cGUgPSBlbGVtLm5vZGVUeXBlO1xuXG4gICAgICAgIGlmICghbm9kZVR5cGUpIHtcbiAgICAgICAgICAvLyBJZiBubyBub2RlVHlwZSwgdGhpcyBpcyBleHBlY3RlZCB0byBiZSBhbiBhcnJheVxuICAgICAgICAgIHdoaWxlIChub2RlID0gZWxlbVtpKytdKSB7XG4gICAgICAgICAgICAvLyBEbyBub3QgdHJhdmVyc2UgY29tbWVudCBub2Rlc1xuICAgICAgICAgICAgcmV0ICs9IGdldFRleHQobm9kZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKG5vZGVUeXBlID09PSAxIHx8IG5vZGVUeXBlID09PSA5IHx8IG5vZGVUeXBlID09PSAxMSkge1xuICAgICAgICAgIC8vIFVzZSB0ZXh0Q29udGVudCBmb3IgZWxlbWVudHNcbiAgICAgICAgICAvLyBpbm5lclRleHQgdXNhZ2UgcmVtb3ZlZCBmb3IgY29uc2lzdGVuY3kgb2YgbmV3IGxpbmVzIChqUXVlcnkgIzExMTUzKVxuICAgICAgICAgIGlmICh0eXBlb2YgZWxlbS50ZXh0Q29udGVudCA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgcmV0dXJuIGVsZW0udGV4dENvbnRlbnQ7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIFRyYXZlcnNlIGl0cyBjaGlsZHJlblxuICAgICAgICAgICAgZm9yIChlbGVtID0gZWxlbS5maXJzdENoaWxkOyBlbGVtOyBlbGVtID0gZWxlbS5uZXh0U2libGluZykge1xuICAgICAgICAgICAgICByZXQgKz0gZ2V0VGV4dChlbGVtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAobm9kZVR5cGUgPT09IDMgfHwgbm9kZVR5cGUgPT09IDQpIHtcbiAgICAgICAgICByZXR1cm4gZWxlbS5ub2RlVmFsdWU7XG4gICAgICAgIH0gLy8gRG8gbm90IGluY2x1ZGUgY29tbWVudCBvciBwcm9jZXNzaW5nIGluc3RydWN0aW9uIG5vZGVzXG5cblxuICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgfTtcblxuICAgICAgRXhwciA9IFNpenpsZS5zZWxlY3RvcnMgPSB7XG4gICAgICAgIC8vIENhbiBiZSBhZGp1c3RlZCBieSB0aGUgdXNlclxuICAgICAgICBjYWNoZUxlbmd0aDogNTAsXG4gICAgICAgIGNyZWF0ZVBzZXVkbzogbWFya0Z1bmN0aW9uLFxuICAgICAgICBtYXRjaDogbWF0Y2hFeHByLFxuICAgICAgICBhdHRySGFuZGxlOiB7fSxcbiAgICAgICAgZmluZDoge30sXG4gICAgICAgIHJlbGF0aXZlOiB7XG4gICAgICAgICAgXCI+XCI6IHtcbiAgICAgICAgICAgIGRpcjogXCJwYXJlbnROb2RlXCIsXG4gICAgICAgICAgICBmaXJzdDogdHJ1ZVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCIgXCI6IHtcbiAgICAgICAgICAgIGRpcjogXCJwYXJlbnROb2RlXCJcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiK1wiOiB7XG4gICAgICAgICAgICBkaXI6IFwicHJldmlvdXNTaWJsaW5nXCIsXG4gICAgICAgICAgICBmaXJzdDogdHJ1ZVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJ+XCI6IHtcbiAgICAgICAgICAgIGRpcjogXCJwcmV2aW91c1NpYmxpbmdcIlxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgcHJlRmlsdGVyOiB7XG4gICAgICAgICAgXCJBVFRSXCI6IGZ1bmN0aW9uIEFUVFIobWF0Y2gpIHtcbiAgICAgICAgICAgIG1hdGNoWzFdID0gbWF0Y2hbMV0ucmVwbGFjZShydW5lc2NhcGUsIGZ1bmVzY2FwZSk7IC8vIE1vdmUgdGhlIGdpdmVuIHZhbHVlIHRvIG1hdGNoWzNdIHdoZXRoZXIgcXVvdGVkIG9yIHVucXVvdGVkXG5cbiAgICAgICAgICAgIG1hdGNoWzNdID0gKG1hdGNoWzNdIHx8IG1hdGNoWzRdIHx8IG1hdGNoWzVdIHx8IFwiXCIpLnJlcGxhY2UocnVuZXNjYXBlLCBmdW5lc2NhcGUpO1xuXG4gICAgICAgICAgICBpZiAobWF0Y2hbMl0gPT09IFwifj1cIikge1xuICAgICAgICAgICAgICBtYXRjaFszXSA9IFwiIFwiICsgbWF0Y2hbM10gKyBcIiBcIjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIG1hdGNoLnNsaWNlKDAsIDQpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJDSElMRFwiOiBmdW5jdGlvbiBDSElMRChtYXRjaCkge1xuICAgICAgICAgICAgLyogbWF0Y2hlcyBmcm9tIG1hdGNoRXhwcltcIkNISUxEXCJdXG4gICAgICAgICAgICBcdDEgdHlwZSAob25seXxudGh8Li4uKVxuICAgICAgICAgICAgXHQyIHdoYXQgKGNoaWxkfG9mLXR5cGUpXG4gICAgICAgICAgICBcdDMgYXJndW1lbnQgKGV2ZW58b2RkfFxcZCp8XFxkKm4oWystXVxcZCspP3wuLi4pXG4gICAgICAgICAgICBcdDQgeG4tY29tcG9uZW50IG9mIHhuK3kgYXJndW1lbnQgKFsrLV0/XFxkKm58KVxuICAgICAgICAgICAgXHQ1IHNpZ24gb2YgeG4tY29tcG9uZW50XG4gICAgICAgICAgICBcdDYgeCBvZiB4bi1jb21wb25lbnRcbiAgICAgICAgICAgIFx0NyBzaWduIG9mIHktY29tcG9uZW50XG4gICAgICAgICAgICBcdDggeSBvZiB5LWNvbXBvbmVudFxuICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIG1hdGNoWzFdID0gbWF0Y2hbMV0udG9Mb3dlckNhc2UoKTtcblxuICAgICAgICAgICAgaWYgKG1hdGNoWzFdLnNsaWNlKDAsIDMpID09PSBcIm50aFwiKSB7XG4gICAgICAgICAgICAgIC8vIG50aC0qIHJlcXVpcmVzIGFyZ3VtZW50XG4gICAgICAgICAgICAgIGlmICghbWF0Y2hbM10pIHtcbiAgICAgICAgICAgICAgICBTaXp6bGUuZXJyb3IobWF0Y2hbMF0pO1xuICAgICAgICAgICAgICB9IC8vIG51bWVyaWMgeCBhbmQgeSBwYXJhbWV0ZXJzIGZvciBFeHByLmZpbHRlci5DSElMRFxuICAgICAgICAgICAgICAvLyByZW1lbWJlciB0aGF0IGZhbHNlL3RydWUgY2FzdCByZXNwZWN0aXZlbHkgdG8gMC8xXG5cblxuICAgICAgICAgICAgICBtYXRjaFs0XSA9ICsobWF0Y2hbNF0gPyBtYXRjaFs1XSArIChtYXRjaFs2XSB8fCAxKSA6IDIgKiAobWF0Y2hbM10gPT09IFwiZXZlblwiIHx8IG1hdGNoWzNdID09PSBcIm9kZFwiKSk7XG4gICAgICAgICAgICAgIG1hdGNoWzVdID0gKyhtYXRjaFs3XSArIG1hdGNoWzhdIHx8IG1hdGNoWzNdID09PSBcIm9kZFwiKTsgLy8gb3RoZXIgdHlwZXMgcHJvaGliaXQgYXJndW1lbnRzXG4gICAgICAgICAgICB9IGVsc2UgaWYgKG1hdGNoWzNdKSB7XG4gICAgICAgICAgICAgIFNpenpsZS5lcnJvcihtYXRjaFswXSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBtYXRjaDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiUFNFVURPXCI6IGZ1bmN0aW9uIFBTRVVETyhtYXRjaCkge1xuICAgICAgICAgICAgdmFyIGV4Y2VzcyxcbiAgICAgICAgICAgICAgICB1bnF1b3RlZCA9ICFtYXRjaFs2XSAmJiBtYXRjaFsyXTtcblxuICAgICAgICAgICAgaWYgKG1hdGNoRXhwcltcIkNISUxEXCJdLnRlc3QobWF0Y2hbMF0pKSB7XG4gICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfSAvLyBBY2NlcHQgcXVvdGVkIGFyZ3VtZW50cyBhcy1pc1xuXG5cbiAgICAgICAgICAgIGlmIChtYXRjaFszXSkge1xuICAgICAgICAgICAgICBtYXRjaFsyXSA9IG1hdGNoWzRdIHx8IG1hdGNoWzVdIHx8IFwiXCI7IC8vIFN0cmlwIGV4Y2VzcyBjaGFyYWN0ZXJzIGZyb20gdW5xdW90ZWQgYXJndW1lbnRzXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHVucXVvdGVkICYmIHJwc2V1ZG8udGVzdCh1bnF1b3RlZCkgJiYgKCAvLyBHZXQgZXhjZXNzIGZyb20gdG9rZW5pemUgKHJlY3Vyc2l2ZWx5KVxuICAgICAgICAgICAgZXhjZXNzID0gdG9rZW5pemUodW5xdW90ZWQsIHRydWUpKSAmJiAoIC8vIGFkdmFuY2UgdG8gdGhlIG5leHQgY2xvc2luZyBwYXJlbnRoZXNpc1xuICAgICAgICAgICAgZXhjZXNzID0gdW5xdW90ZWQuaW5kZXhPZihcIilcIiwgdW5xdW90ZWQubGVuZ3RoIC0gZXhjZXNzKSAtIHVucXVvdGVkLmxlbmd0aCkpIHtcbiAgICAgICAgICAgICAgLy8gZXhjZXNzIGlzIGEgbmVnYXRpdmUgaW5kZXhcbiAgICAgICAgICAgICAgbWF0Y2hbMF0gPSBtYXRjaFswXS5zbGljZSgwLCBleGNlc3MpO1xuICAgICAgICAgICAgICBtYXRjaFsyXSA9IHVucXVvdGVkLnNsaWNlKDAsIGV4Y2Vzcyk7XG4gICAgICAgICAgICB9IC8vIFJldHVybiBvbmx5IGNhcHR1cmVzIG5lZWRlZCBieSB0aGUgcHNldWRvIGZpbHRlciBtZXRob2QgKHR5cGUgYW5kIGFyZ3VtZW50KVxuXG5cbiAgICAgICAgICAgIHJldHVybiBtYXRjaC5zbGljZSgwLCAzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGZpbHRlcjoge1xuICAgICAgICAgIFwiVEFHXCI6IGZ1bmN0aW9uIFRBRyhub2RlTmFtZVNlbGVjdG9yKSB7XG4gICAgICAgICAgICB2YXIgbm9kZU5hbWUgPSBub2RlTmFtZVNlbGVjdG9yLnJlcGxhY2UocnVuZXNjYXBlLCBmdW5lc2NhcGUpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICByZXR1cm4gbm9kZU5hbWVTZWxlY3RvciA9PT0gXCIqXCIgPyBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfSA6IGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICAgICAgICAgIHJldHVybiBlbGVtLm5vZGVOYW1lICYmIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gbm9kZU5hbWU7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJDTEFTU1wiOiBmdW5jdGlvbiBDTEFTUyhjbGFzc05hbWUpIHtcbiAgICAgICAgICAgIHZhciBwYXR0ZXJuID0gY2xhc3NDYWNoZVtjbGFzc05hbWUgKyBcIiBcIl07XG4gICAgICAgICAgICByZXR1cm4gcGF0dGVybiB8fCAocGF0dGVybiA9IG5ldyBSZWdFeHAoXCIoXnxcIiArIHdoaXRlc3BhY2UgKyBcIilcIiArIGNsYXNzTmFtZSArIFwiKFwiICsgd2hpdGVzcGFjZSArIFwifCQpXCIpKSAmJiBjbGFzc0NhY2hlKGNsYXNzTmFtZSwgZnVuY3Rpb24gKGVsZW0pIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHBhdHRlcm4udGVzdCh0eXBlb2YgZWxlbS5jbGFzc05hbWUgPT09IFwic3RyaW5nXCIgJiYgZWxlbS5jbGFzc05hbWUgfHwgdHlwZW9mIGVsZW0uZ2V0QXR0cmlidXRlICE9PSBcInVuZGVmaW5lZFwiICYmIGVsZW0uZ2V0QXR0cmlidXRlKFwiY2xhc3NcIikgfHwgXCJcIik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiQVRUUlwiOiBmdW5jdGlvbiBBVFRSKG5hbWUsIG9wZXJhdG9yLCBjaGVjaykge1xuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICAgICAgICAgIHZhciByZXN1bHQgPSBTaXp6bGUuYXR0cihlbGVtLCBuYW1lKTtcblxuICAgICAgICAgICAgICBpZiAocmVzdWx0ID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gb3BlcmF0b3IgPT09IFwiIT1cIjtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGlmICghb3BlcmF0b3IpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIHJlc3VsdCArPSBcIlwiO1xuICAgICAgICAgICAgICByZXR1cm4gb3BlcmF0b3IgPT09IFwiPVwiID8gcmVzdWx0ID09PSBjaGVjayA6IG9wZXJhdG9yID09PSBcIiE9XCIgPyByZXN1bHQgIT09IGNoZWNrIDogb3BlcmF0b3IgPT09IFwiXj1cIiA/IGNoZWNrICYmIHJlc3VsdC5pbmRleE9mKGNoZWNrKSA9PT0gMCA6IG9wZXJhdG9yID09PSBcIio9XCIgPyBjaGVjayAmJiByZXN1bHQuaW5kZXhPZihjaGVjaykgPiAtMSA6IG9wZXJhdG9yID09PSBcIiQ9XCIgPyBjaGVjayAmJiByZXN1bHQuc2xpY2UoLWNoZWNrLmxlbmd0aCkgPT09IGNoZWNrIDogb3BlcmF0b3IgPT09IFwifj1cIiA/IChcIiBcIiArIHJlc3VsdC5yZXBsYWNlKHJ3aGl0ZXNwYWNlLCBcIiBcIikgKyBcIiBcIikuaW5kZXhPZihjaGVjaykgPiAtMSA6IG9wZXJhdG9yID09PSBcInw9XCIgPyByZXN1bHQgPT09IGNoZWNrIHx8IHJlc3VsdC5zbGljZSgwLCBjaGVjay5sZW5ndGggKyAxKSA9PT0gY2hlY2sgKyBcIi1cIiA6IGZhbHNlO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiQ0hJTERcIjogZnVuY3Rpb24gQ0hJTEQodHlwZSwgd2hhdCwgYXJndW1lbnQsIGZpcnN0LCBsYXN0KSB7XG4gICAgICAgICAgICB2YXIgc2ltcGxlID0gdHlwZS5zbGljZSgwLCAzKSAhPT0gXCJudGhcIixcbiAgICAgICAgICAgICAgICBmb3J3YXJkID0gdHlwZS5zbGljZSgtNCkgIT09IFwibGFzdFwiLFxuICAgICAgICAgICAgICAgIG9mVHlwZSA9IHdoYXQgPT09IFwib2YtdHlwZVwiO1xuICAgICAgICAgICAgcmV0dXJuIGZpcnN0ID09PSAxICYmIGxhc3QgPT09IDAgPyAvLyBTaG9ydGN1dCBmb3IgOm50aC0qKG4pXG4gICAgICAgICAgICBmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICAgICAgICByZXR1cm4gISFlbGVtLnBhcmVudE5vZGU7XG4gICAgICAgICAgICB9IDogZnVuY3Rpb24gKGVsZW0sIGNvbnRleHQsIHhtbCkge1xuICAgICAgICAgICAgICB2YXIgY2FjaGUsXG4gICAgICAgICAgICAgICAgICB1bmlxdWVDYWNoZSxcbiAgICAgICAgICAgICAgICAgIG91dGVyQ2FjaGUsXG4gICAgICAgICAgICAgICAgICBub2RlLFxuICAgICAgICAgICAgICAgICAgbm9kZUluZGV4LFxuICAgICAgICAgICAgICAgICAgc3RhcnQsXG4gICAgICAgICAgICAgICAgICBkaXIgPSBzaW1wbGUgIT09IGZvcndhcmQgPyBcIm5leHRTaWJsaW5nXCIgOiBcInByZXZpb3VzU2libGluZ1wiLFxuICAgICAgICAgICAgICAgICAgcGFyZW50ID0gZWxlbS5wYXJlbnROb2RlLFxuICAgICAgICAgICAgICAgICAgbmFtZSA9IG9mVHlwZSAmJiBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCksXG4gICAgICAgICAgICAgICAgICB1c2VDYWNoZSA9ICF4bWwgJiYgIW9mVHlwZSxcbiAgICAgICAgICAgICAgICAgIGRpZmYgPSBmYWxzZTtcblxuICAgICAgICAgICAgICBpZiAocGFyZW50KSB7XG4gICAgICAgICAgICAgICAgLy8gOihmaXJzdHxsYXN0fG9ubHkpLShjaGlsZHxvZi10eXBlKVxuICAgICAgICAgICAgICAgIGlmIChzaW1wbGUpIHtcbiAgICAgICAgICAgICAgICAgIHdoaWxlIChkaXIpIHtcbiAgICAgICAgICAgICAgICAgICAgbm9kZSA9IGVsZW07XG5cbiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKG5vZGUgPSBub2RlW2Rpcl0pIHtcbiAgICAgICAgICAgICAgICAgICAgICBpZiAob2ZUeXBlID8gbm9kZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSBuYW1lIDogbm9kZS5ub2RlVHlwZSA9PT0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSAvLyBSZXZlcnNlIGRpcmVjdGlvbiBmb3IgOm9ubHktKiAoaWYgd2UgaGF2ZW4ndCB5ZXQgZG9uZSBzbylcblxuXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0ID0gZGlyID0gdHlwZSA9PT0gXCJvbmx5XCIgJiYgIXN0YXJ0ICYmIFwibmV4dFNpYmxpbmdcIjtcbiAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgc3RhcnQgPSBbZm9yd2FyZCA/IHBhcmVudC5maXJzdENoaWxkIDogcGFyZW50Lmxhc3RDaGlsZF07IC8vIG5vbi14bWwgOm50aC1jaGlsZCguLi4pIHN0b3JlcyBjYWNoZSBkYXRhIG9uIGBwYXJlbnRgXG5cbiAgICAgICAgICAgICAgICBpZiAoZm9yd2FyZCAmJiB1c2VDYWNoZSkge1xuICAgICAgICAgICAgICAgICAgLy8gU2VlayBgZWxlbWAgZnJvbSBhIHByZXZpb3VzbHktY2FjaGVkIGluZGV4XG4gICAgICAgICAgICAgICAgICAvLyAuLi5pbiBhIGd6aXAtZnJpZW5kbHkgd2F5XG4gICAgICAgICAgICAgICAgICBub2RlID0gcGFyZW50O1xuICAgICAgICAgICAgICAgICAgb3V0ZXJDYWNoZSA9IG5vZGVbZXhwYW5kb10gfHwgKG5vZGVbZXhwYW5kb10gPSB7fSk7IC8vIFN1cHBvcnQ6IElFIDw5IG9ubHlcbiAgICAgICAgICAgICAgICAgIC8vIERlZmVuZCBhZ2FpbnN0IGNsb25lZCBhdHRyb3BlcnRpZXMgKGpRdWVyeSBnaC0xNzA5KVxuXG4gICAgICAgICAgICAgICAgICB1bmlxdWVDYWNoZSA9IG91dGVyQ2FjaGVbbm9kZS51bmlxdWVJRF0gfHwgKG91dGVyQ2FjaGVbbm9kZS51bmlxdWVJRF0gPSB7fSk7XG4gICAgICAgICAgICAgICAgICBjYWNoZSA9IHVuaXF1ZUNhY2hlW3R5cGVdIHx8IFtdO1xuICAgICAgICAgICAgICAgICAgbm9kZUluZGV4ID0gY2FjaGVbMF0gPT09IGRpcnJ1bnMgJiYgY2FjaGVbMV07XG4gICAgICAgICAgICAgICAgICBkaWZmID0gbm9kZUluZGV4ICYmIGNhY2hlWzJdO1xuICAgICAgICAgICAgICAgICAgbm9kZSA9IG5vZGVJbmRleCAmJiBwYXJlbnQuY2hpbGROb2Rlc1tub2RlSW5kZXhdO1xuXG4gICAgICAgICAgICAgICAgICB3aGlsZSAobm9kZSA9ICsrbm9kZUluZGV4ICYmIG5vZGUgJiYgbm9kZVtkaXJdIHx8ICggLy8gRmFsbGJhY2sgdG8gc2Vla2luZyBgZWxlbWAgZnJvbSB0aGUgc3RhcnRcbiAgICAgICAgICAgICAgICAgIGRpZmYgPSBub2RlSW5kZXggPSAwKSB8fCBzdGFydC5wb3AoKSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBXaGVuIGZvdW5kLCBjYWNoZSBpbmRleGVzIG9uIGBwYXJlbnRgIGFuZCBicmVha1xuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5ub2RlVHlwZSA9PT0gMSAmJiArK2RpZmYgJiYgbm9kZSA9PT0gZWxlbSkge1xuICAgICAgICAgICAgICAgICAgICAgIHVuaXF1ZUNhY2hlW3R5cGVdID0gW2RpcnJ1bnMsIG5vZGVJbmRleCwgZGlmZl07XG4gICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgLy8gVXNlIHByZXZpb3VzbHktY2FjaGVkIGVsZW1lbnQgaW5kZXggaWYgYXZhaWxhYmxlXG4gICAgICAgICAgICAgICAgICBpZiAodXNlQ2FjaGUpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gLi4uaW4gYSBnemlwLWZyaWVuZGx5IHdheVxuICAgICAgICAgICAgICAgICAgICBub2RlID0gZWxlbTtcbiAgICAgICAgICAgICAgICAgICAgb3V0ZXJDYWNoZSA9IG5vZGVbZXhwYW5kb10gfHwgKG5vZGVbZXhwYW5kb10gPSB7fSk7IC8vIFN1cHBvcnQ6IElFIDw5IG9ubHlcbiAgICAgICAgICAgICAgICAgICAgLy8gRGVmZW5kIGFnYWluc3QgY2xvbmVkIGF0dHJvcGVydGllcyAoalF1ZXJ5IGdoLTE3MDkpXG5cbiAgICAgICAgICAgICAgICAgICAgdW5pcXVlQ2FjaGUgPSBvdXRlckNhY2hlW25vZGUudW5pcXVlSURdIHx8IChvdXRlckNhY2hlW25vZGUudW5pcXVlSURdID0ge30pO1xuICAgICAgICAgICAgICAgICAgICBjYWNoZSA9IHVuaXF1ZUNhY2hlW3R5cGVdIHx8IFtdO1xuICAgICAgICAgICAgICAgICAgICBub2RlSW5kZXggPSBjYWNoZVswXSA9PT0gZGlycnVucyAmJiBjYWNoZVsxXTtcbiAgICAgICAgICAgICAgICAgICAgZGlmZiA9IG5vZGVJbmRleDtcbiAgICAgICAgICAgICAgICAgIH0gLy8geG1sIDpudGgtY2hpbGQoLi4uKVxuICAgICAgICAgICAgICAgICAgLy8gb3IgOm50aC1sYXN0LWNoaWxkKC4uLikgb3IgOm50aCgtbGFzdCk/LW9mLXR5cGUoLi4uKVxuXG5cbiAgICAgICAgICAgICAgICAgIGlmIChkaWZmID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBVc2UgdGhlIHNhbWUgbG9vcCBhcyBhYm92ZSB0byBzZWVrIGBlbGVtYCBmcm9tIHRoZSBzdGFydFxuICAgICAgICAgICAgICAgICAgICB3aGlsZSAobm9kZSA9ICsrbm9kZUluZGV4ICYmIG5vZGUgJiYgbm9kZVtkaXJdIHx8IChkaWZmID0gbm9kZUluZGV4ID0gMCkgfHwgc3RhcnQucG9wKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICBpZiAoKG9mVHlwZSA/IG5vZGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gbmFtZSA6IG5vZGUubm9kZVR5cGUgPT09IDEpICYmICsrZGlmZikge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2FjaGUgdGhlIGluZGV4IG9mIGVhY2ggZW5jb3VudGVyZWQgZWxlbWVudFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVzZUNhY2hlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIG91dGVyQ2FjaGUgPSBub2RlW2V4cGFuZG9dIHx8IChub2RlW2V4cGFuZG9dID0ge30pOyAvLyBTdXBwb3J0OiBJRSA8OSBvbmx5XG4gICAgICAgICAgICAgICAgICAgICAgICAgIC8vIERlZmVuZCBhZ2FpbnN0IGNsb25lZCBhdHRyb3BlcnRpZXMgKGpRdWVyeSBnaC0xNzA5KVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHVuaXF1ZUNhY2hlID0gb3V0ZXJDYWNoZVtub2RlLnVuaXF1ZUlEXSB8fCAob3V0ZXJDYWNoZVtub2RlLnVuaXF1ZUlEXSA9IHt9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdW5pcXVlQ2FjaGVbdHlwZV0gPSBbZGlycnVucywgZGlmZl07XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChub2RlID09PSBlbGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gLy8gSW5jb3Jwb3JhdGUgdGhlIG9mZnNldCwgdGhlbiBjaGVjayBhZ2FpbnN0IGN5Y2xlIHNpemVcblxuXG4gICAgICAgICAgICAgICAgZGlmZiAtPSBsYXN0O1xuICAgICAgICAgICAgICAgIHJldHVybiBkaWZmID09PSBmaXJzdCB8fCBkaWZmICUgZmlyc3QgPT09IDAgJiYgZGlmZiAvIGZpcnN0ID49IDA7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfSxcbiAgICAgICAgICBcIlBTRVVET1wiOiBmdW5jdGlvbiBQU0VVRE8ocHNldWRvLCBhcmd1bWVudCkge1xuICAgICAgICAgICAgLy8gcHNldWRvLWNsYXNzIG5hbWVzIGFyZSBjYXNlLWluc2Vuc2l0aXZlXG4gICAgICAgICAgICAvLyBodHRwOi8vd3d3LnczLm9yZy9UUi9zZWxlY3RvcnMvI3BzZXVkby1jbGFzc2VzXG4gICAgICAgICAgICAvLyBQcmlvcml0aXplIGJ5IGNhc2Ugc2Vuc2l0aXZpdHkgaW4gY2FzZSBjdXN0b20gcHNldWRvcyBhcmUgYWRkZWQgd2l0aCB1cHBlcmNhc2UgbGV0dGVyc1xuICAgICAgICAgICAgLy8gUmVtZW1iZXIgdGhhdCBzZXRGaWx0ZXJzIGluaGVyaXRzIGZyb20gcHNldWRvc1xuICAgICAgICAgICAgdmFyIGFyZ3MsXG4gICAgICAgICAgICAgICAgZm4gPSBFeHByLnBzZXVkb3NbcHNldWRvXSB8fCBFeHByLnNldEZpbHRlcnNbcHNldWRvLnRvTG93ZXJDYXNlKCldIHx8IFNpenpsZS5lcnJvcihcInVuc3VwcG9ydGVkIHBzZXVkbzogXCIgKyBwc2V1ZG8pOyAvLyBUaGUgdXNlciBtYXkgdXNlIGNyZWF0ZVBzZXVkbyB0byBpbmRpY2F0ZSB0aGF0XG4gICAgICAgICAgICAvLyBhcmd1bWVudHMgYXJlIG5lZWRlZCB0byBjcmVhdGUgdGhlIGZpbHRlciBmdW5jdGlvblxuICAgICAgICAgICAgLy8ganVzdCBhcyBTaXp6bGUgZG9lc1xuXG4gICAgICAgICAgICBpZiAoZm5bZXhwYW5kb10pIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGZuKGFyZ3VtZW50KTtcbiAgICAgICAgICAgIH0gLy8gQnV0IG1haW50YWluIHN1cHBvcnQgZm9yIG9sZCBzaWduYXR1cmVzXG5cblxuICAgICAgICAgICAgaWYgKGZuLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgYXJncyA9IFtwc2V1ZG8sIHBzZXVkbywgXCJcIiwgYXJndW1lbnRdO1xuICAgICAgICAgICAgICByZXR1cm4gRXhwci5zZXRGaWx0ZXJzLmhhc093blByb3BlcnR5KHBzZXVkby50b0xvd2VyQ2FzZSgpKSA/IG1hcmtGdW5jdGlvbihmdW5jdGlvbiAoc2VlZCwgbWF0Y2hlcykge1xuICAgICAgICAgICAgICAgIHZhciBpZHgsXG4gICAgICAgICAgICAgICAgICAgIG1hdGNoZWQgPSBmbihzZWVkLCBhcmd1bWVudCksXG4gICAgICAgICAgICAgICAgICAgIGkgPSBtYXRjaGVkLmxlbmd0aDtcblxuICAgICAgICAgICAgICAgIHdoaWxlIChpLS0pIHtcbiAgICAgICAgICAgICAgICAgIGlkeCA9IGluZGV4T2Yoc2VlZCwgbWF0Y2hlZFtpXSk7XG4gICAgICAgICAgICAgICAgICBzZWVkW2lkeF0gPSAhKG1hdGNoZXNbaWR4XSA9IG1hdGNoZWRbaV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSkgOiBmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmbihlbGVtLCAwLCBhcmdzKTtcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGZuO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgcHNldWRvczoge1xuICAgICAgICAgIC8vIFBvdGVudGlhbGx5IGNvbXBsZXggcHNldWRvc1xuICAgICAgICAgIFwibm90XCI6IG1hcmtGdW5jdGlvbihmdW5jdGlvbiAoc2VsZWN0b3IpIHtcbiAgICAgICAgICAgIC8vIFRyaW0gdGhlIHNlbGVjdG9yIHBhc3NlZCB0byBjb21waWxlXG4gICAgICAgICAgICAvLyB0byBhdm9pZCB0cmVhdGluZyBsZWFkaW5nIGFuZCB0cmFpbGluZ1xuICAgICAgICAgICAgLy8gc3BhY2VzIGFzIGNvbWJpbmF0b3JzXG4gICAgICAgICAgICB2YXIgaW5wdXQgPSBbXSxcbiAgICAgICAgICAgICAgICByZXN1bHRzID0gW10sXG4gICAgICAgICAgICAgICAgbWF0Y2hlciA9IGNvbXBpbGUoc2VsZWN0b3IucmVwbGFjZShydHJpbSwgXCIkMVwiKSk7XG4gICAgICAgICAgICByZXR1cm4gbWF0Y2hlcltleHBhbmRvXSA/IG1hcmtGdW5jdGlvbihmdW5jdGlvbiAoc2VlZCwgbWF0Y2hlcywgY29udGV4dCwgeG1sKSB7XG4gICAgICAgICAgICAgIHZhciBlbGVtLFxuICAgICAgICAgICAgICAgICAgdW5tYXRjaGVkID0gbWF0Y2hlcihzZWVkLCBudWxsLCB4bWwsIFtdKSxcbiAgICAgICAgICAgICAgICAgIGkgPSBzZWVkLmxlbmd0aDsgLy8gTWF0Y2ggZWxlbWVudHMgdW5tYXRjaGVkIGJ5IGBtYXRjaGVyYFxuXG4gICAgICAgICAgICAgIHdoaWxlIChpLS0pIHtcbiAgICAgICAgICAgICAgICBpZiAoZWxlbSA9IHVubWF0Y2hlZFtpXSkge1xuICAgICAgICAgICAgICAgICAgc2VlZFtpXSA9ICEobWF0Y2hlc1tpXSA9IGVsZW0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkgOiBmdW5jdGlvbiAoZWxlbSwgY29udGV4dCwgeG1sKSB7XG4gICAgICAgICAgICAgIGlucHV0WzBdID0gZWxlbTtcbiAgICAgICAgICAgICAgbWF0Y2hlcihpbnB1dCwgbnVsbCwgeG1sLCByZXN1bHRzKTsgLy8gRG9uJ3Qga2VlcCB0aGUgZWxlbWVudCAoaXNzdWUgIzI5OSlcblxuICAgICAgICAgICAgICBpbnB1dFswXSA9IG51bGw7XG4gICAgICAgICAgICAgIHJldHVybiAhcmVzdWx0cy5wb3AoKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfSksXG4gICAgICAgICAgXCJoYXNcIjogbWFya0Z1bmN0aW9uKGZ1bmN0aW9uIChzZWxlY3Rvcikge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBzZWxlY3RvciA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgICBTaXp6bGUuY29tcGlsZShzZWxlY3Rvcik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICAgICAgICByZXR1cm4gU2l6emxlKHNlbGVjdG9yLCBlbGVtKS5sZW5ndGggPiAwO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9KSxcbiAgICAgICAgICAvLyBSZW1vdmVkIDpjb250YWlucyBwc2V1ZG8tY2xhc3MgZGVjbGFyYXRpb25cbiAgICAgICAgICAvLyBcIldoZXRoZXIgYW4gZWxlbWVudCBpcyByZXByZXNlbnRlZCBieSBhIDpsYW5nKCkgc2VsZWN0b3JcbiAgICAgICAgICAvLyBpcyBiYXNlZCBzb2xlbHkgb24gdGhlIGVsZW1lbnQncyBsYW5ndWFnZSB2YWx1ZVxuICAgICAgICAgIC8vIGJlaW5nIGVxdWFsIHRvIHRoZSBpZGVudGlmaWVyIEMsXG4gICAgICAgICAgLy8gb3IgYmVnaW5uaW5nIHdpdGggdGhlIGlkZW50aWZpZXIgQyBpbW1lZGlhdGVseSBmb2xsb3dlZCBieSBcIi1cIi5cbiAgICAgICAgICAvLyBUaGUgbWF0Y2hpbmcgb2YgQyBhZ2FpbnN0IHRoZSBlbGVtZW50J3MgbGFuZ3VhZ2UgdmFsdWUgaXMgcGVyZm9ybWVkIGNhc2UtaW5zZW5zaXRpdmVseS5cbiAgICAgICAgICAvLyBUaGUgaWRlbnRpZmllciBDIGRvZXMgbm90IGhhdmUgdG8gYmUgYSB2YWxpZCBsYW5ndWFnZSBuYW1lLlwiXG4gICAgICAgICAgLy8gaHR0cDovL3d3dy53My5vcmcvVFIvc2VsZWN0b3JzLyNsYW5nLXBzZXVkb1xuICAgICAgICAgIFwibGFuZ1wiOiBtYXJrRnVuY3Rpb24oZnVuY3Rpb24gKGxhbmcpIHtcbiAgICAgICAgICAgIC8vIGxhbmcgdmFsdWUgbXVzdCBiZSBhIHZhbGlkIGlkZW50aWZpZXJcbiAgICAgICAgICAgIGlmICghcmlkZW50aWZpZXIudGVzdChsYW5nIHx8IFwiXCIpKSB7XG4gICAgICAgICAgICAgIFNpenpsZS5lcnJvcihcInVuc3VwcG9ydGVkIGxhbmc6IFwiICsgbGFuZyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGxhbmcgPSBsYW5nLnJlcGxhY2UocnVuZXNjYXBlLCBmdW5lc2NhcGUpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGVsZW0pIHtcbiAgICAgICAgICAgICAgdmFyIGVsZW1MYW5nO1xuXG4gICAgICAgICAgICAgIGRvIHtcbiAgICAgICAgICAgICAgICBpZiAoZWxlbUxhbmcgPSBkb2N1bWVudElzSFRNTCA/IGVsZW0ubGFuZyA6IGVsZW0uZ2V0QXR0cmlidXRlKFwieG1sOmxhbmdcIikgfHwgZWxlbS5nZXRBdHRyaWJ1dGUoXCJsYW5nXCIpKSB7XG4gICAgICAgICAgICAgICAgICBlbGVtTGFuZyA9IGVsZW1MYW5nLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbUxhbmcgPT09IGxhbmcgfHwgZWxlbUxhbmcuaW5kZXhPZihsYW5nICsgXCItXCIpID09PSAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSB3aGlsZSAoKGVsZW0gPSBlbGVtLnBhcmVudE5vZGUpICYmIGVsZW0ubm9kZVR5cGUgPT09IDEpO1xuXG4gICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfSksXG4gICAgICAgICAgLy8gTWlzY2VsbGFuZW91c1xuICAgICAgICAgIFwidGFyZ2V0XCI6IGZ1bmN0aW9uIHRhcmdldChlbGVtKSB7XG4gICAgICAgICAgICB2YXIgaGFzaCA9IHdpbmRvdy5sb2NhdGlvbiAmJiB3aW5kb3cubG9jYXRpb24uaGFzaDtcbiAgICAgICAgICAgIHJldHVybiBoYXNoICYmIGhhc2guc2xpY2UoMSkgPT09IGVsZW0uaWQ7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInJvb3RcIjogZnVuY3Rpb24gcm9vdChlbGVtKSB7XG4gICAgICAgICAgICByZXR1cm4gZWxlbSA9PT0gZG9jRWxlbTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiZm9jdXNcIjogZnVuY3Rpb24gZm9jdXMoZWxlbSkge1xuICAgICAgICAgICAgcmV0dXJuIGVsZW0gPT09IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgJiYgKCFkb2N1bWVudC5oYXNGb2N1cyB8fCBkb2N1bWVudC5oYXNGb2N1cygpKSAmJiAhIShlbGVtLnR5cGUgfHwgZWxlbS5ocmVmIHx8IH5lbGVtLnRhYkluZGV4KTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIC8vIEJvb2xlYW4gcHJvcGVydGllc1xuICAgICAgICAgIFwiZW5hYmxlZFwiOiBjcmVhdGVEaXNhYmxlZFBzZXVkbyhmYWxzZSksXG4gICAgICAgICAgXCJkaXNhYmxlZFwiOiBjcmVhdGVEaXNhYmxlZFBzZXVkbyh0cnVlKSxcbiAgICAgICAgICBcImNoZWNrZWRcIjogZnVuY3Rpb24gY2hlY2tlZChlbGVtKSB7XG4gICAgICAgICAgICAvLyBJbiBDU1MzLCA6Y2hlY2tlZCBzaG91bGQgcmV0dXJuIGJvdGggY2hlY2tlZCBhbmQgc2VsZWN0ZWQgZWxlbWVudHNcbiAgICAgICAgICAgIC8vIGh0dHA6Ly93d3cudzMub3JnL1RSLzIwMTEvUkVDLWNzczMtc2VsZWN0b3JzLTIwMTEwOTI5LyNjaGVja2VkXG4gICAgICAgICAgICB2YXIgbm9kZU5hbWUgPSBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICByZXR1cm4gbm9kZU5hbWUgPT09IFwiaW5wdXRcIiAmJiAhIWVsZW0uY2hlY2tlZCB8fCBub2RlTmFtZSA9PT0gXCJvcHRpb25cIiAmJiAhIWVsZW0uc2VsZWN0ZWQ7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInNlbGVjdGVkXCI6IGZ1bmN0aW9uIHNlbGVjdGVkKGVsZW0pIHtcbiAgICAgICAgICAgIC8vIEFjY2Vzc2luZyB0aGlzIHByb3BlcnR5IG1ha2VzIHNlbGVjdGVkLWJ5LWRlZmF1bHRcbiAgICAgICAgICAgIC8vIG9wdGlvbnMgaW4gU2FmYXJpIHdvcmsgcHJvcGVybHlcbiAgICAgICAgICAgIGlmIChlbGVtLnBhcmVudE5vZGUpIHtcbiAgICAgICAgICAgICAgZWxlbS5wYXJlbnROb2RlLnNlbGVjdGVkSW5kZXg7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBlbGVtLnNlbGVjdGVkID09PSB0cnVlO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgLy8gQ29udGVudHNcbiAgICAgICAgICBcImVtcHR5XCI6IGZ1bmN0aW9uIGVtcHR5KGVsZW0pIHtcbiAgICAgICAgICAgIC8vIGh0dHA6Ly93d3cudzMub3JnL1RSL3NlbGVjdG9ycy8jZW1wdHktcHNldWRvXG4gICAgICAgICAgICAvLyA6ZW1wdHkgaXMgbmVnYXRlZCBieSBlbGVtZW50ICgxKSBvciBjb250ZW50IG5vZGVzICh0ZXh0OiAzOyBjZGF0YTogNDsgZW50aXR5IHJlZjogNSksXG4gICAgICAgICAgICAvLyAgIGJ1dCBub3QgYnkgb3RoZXJzIChjb21tZW50OiA4OyBwcm9jZXNzaW5nIGluc3RydWN0aW9uOiA3OyBldGMuKVxuICAgICAgICAgICAgLy8gbm9kZVR5cGUgPCA2IHdvcmtzIGJlY2F1c2UgYXR0cmlidXRlcyAoMikgZG8gbm90IGFwcGVhciBhcyBjaGlsZHJlblxuICAgICAgICAgICAgZm9yIChlbGVtID0gZWxlbS5maXJzdENoaWxkOyBlbGVtOyBlbGVtID0gZWxlbS5uZXh0U2libGluZykge1xuICAgICAgICAgICAgICBpZiAoZWxlbS5ub2RlVHlwZSA8IDYpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgfSAvLyBSZW1vdmVkIGN1c3RvbSBwc2V1ZG8tY2xhc3Nlc1xuXG4gICAgICAgIH1cbiAgICAgIH07IC8vIFJlbW92ZWQgY3VzdG9tIHBzZXVkby1jbGFzc2VzXG4gICAgICAvLyBFYXN5IEFQSSBmb3IgY3JlYXRpbmcgbmV3IHNldEZpbHRlcnNcblxuICAgICAgZnVuY3Rpb24gc2V0RmlsdGVycygpIHt9XG5cbiAgICAgIHNldEZpbHRlcnMucHJvdG90eXBlID0gRXhwci5maWx0ZXJzID0gRXhwci5wc2V1ZG9zO1xuICAgICAgRXhwci5zZXRGaWx0ZXJzID0gbmV3IHNldEZpbHRlcnMoKTtcbiAgICAgIC8qKlxuICAgICAgICogW0FkR3VhcmQgUGF0Y2hdOlxuICAgICAgICogU29ydHMgdGhlIHRva2VucyBpbiBvcmRlciB0byBtaXRpZ2F0ZSB0aGUgcGVyZm9ybWFuY2UgaXNzdWVzIGNhdXNlZCBieSBtYXRjaGluZyBzbG93IHBzZXVkb3MgZmlyc3Q6XG4gICAgICAgKiBodHRwczovL2dpdGh1Yi5jb20vQWRndWFyZFRlYW0vRXh0ZW5kZWRDc3MvaXNzdWVzLzU1I2lzc3VlY29tbWVudC0zNjQwNTg3NDVcbiAgICAgICAqL1xuXG4gICAgICB2YXIgc29ydFRva2VuR3JvdXBzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAvKipcbiAgICAgICAgICogU3BsaXRzIGNvbXBvdW5kIHNlbGVjdG9yIGludG8gYSBsaXN0IG9mIHNpbXBsZSBzZWxlY3RvcnNcbiAgICAgICAgICpcbiAgICAgICAgICogQHBhcmFtIHsqfSB0b2tlbnMgVG9rZW5zIHRvIHNwbGl0IGludG8gZ3JvdXBzXG4gICAgICAgICAqIEByZXR1cm5zIGFuIGFycmF5IGNvbnNpc3Rpbmcgb2YgdG9rZW4gZ3JvdXBzIChhcnJheXMpIGFuZCByZWxhdGlvbiB0b2tlbnMuXG4gICAgICAgICAqL1xuICAgICAgICB2YXIgc3BsaXRDb21wb3VuZFNlbGVjdG9yID0gZnVuY3Rpb24gc3BsaXRDb21wb3VuZFNlbGVjdG9yKHRva2Vucykge1xuICAgICAgICAgIHZhciBncm91cHMgPSBbXTtcbiAgICAgICAgICB2YXIgY3VycmVudFRva2Vuc0dyb3VwID0gW107XG4gICAgICAgICAgdmFyIG1heElkeCA9IHRva2Vucy5sZW5ndGggLSAxO1xuXG4gICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPD0gbWF4SWR4OyBpKyspIHtcbiAgICAgICAgICAgIHZhciB0b2tlbiA9IHRva2Vuc1tpXTtcbiAgICAgICAgICAgIHZhciByZWxhdGl2ZSA9IFNpenpsZS5zZWxlY3RvcnMucmVsYXRpdmVbdG9rZW4udHlwZV07XG5cbiAgICAgICAgICAgIGlmIChyZWxhdGl2ZSkge1xuICAgICAgICAgICAgICBncm91cHMucHVzaChjdXJyZW50VG9rZW5zR3JvdXApO1xuICAgICAgICAgICAgICBncm91cHMucHVzaCh0b2tlbik7XG4gICAgICAgICAgICAgIGN1cnJlbnRUb2tlbnNHcm91cCA9IFtdO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgY3VycmVudFRva2Vuc0dyb3VwLnB1c2godG9rZW4pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoaSA9PT0gbWF4SWR4KSB7XG4gICAgICAgICAgICAgIGdyb3Vwcy5wdXNoKGN1cnJlbnRUb2tlbnNHcm91cCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIGdyb3VwcztcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgVE9LRU5fVFlQRVNfVkFMVUVTID0ge1xuICAgICAgICAgIC8vIG50aC1jaGlsZCwgZXRjLCBhbHdheXMgZ28gbGFzdFxuICAgICAgICAgIFwiQ0hJTERcIjogMTAwLFxuICAgICAgICAgIFwiSURcIjogOTAsXG4gICAgICAgICAgXCJDTEFTU1wiOiA4MCxcbiAgICAgICAgICBcIlRBR1wiOiA3MCxcbiAgICAgICAgICBcIkFUVFJcIjogNzAsXG4gICAgICAgICAgXCJQU0VVRE9cIjogNjBcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIFBPU0lUSU9OQUxfUFNFVURPUyA9IFtcIm50aFwiLCBcImZpcnN0XCIsIFwibGFzdFwiLCBcImVxXCIsIFwiZXZlblwiLCBcIm9kZFwiLCBcImx0XCIsIFwiZ3RcIiwgXCJub3RcIl07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBIGZ1bmN0aW9uIHRoYXQgZGVmaW5lcyB0aGUgc29ydCBvcmRlci5cbiAgICAgICAgICogUmV0dXJucyBhIHZhbHVlIGxlc3NlciB0aGFuIDAgaWYgXCJsZWZ0XCIgaXMgbGVzcyB0aGFuIFwicmlnaHRcIi5cbiAgICAgICAgICovXG5cbiAgICAgICAgdmFyIGNvbXBhcmVGdW5jdGlvbiA9IGZ1bmN0aW9uIGNvbXBhcmVGdW5jdGlvbihsZWZ0LCByaWdodCkge1xuICAgICAgICAgIHZhciBsZWZ0VmFsdWUgPSBUT0tFTl9UWVBFU19WQUxVRVNbbGVmdC50eXBlXTtcbiAgICAgICAgICB2YXIgcmlnaHRWYWx1ZSA9IFRPS0VOX1RZUEVTX1ZBTFVFU1tyaWdodC50eXBlXTtcbiAgICAgICAgICByZXR1cm4gbGVmdFZhbHVlIC0gcmlnaHRWYWx1ZTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIENoZWNrcyBpZiB0aGUgc3BlY2lmaWVkIHRva2VucyBncm91cCBpcyBzb3J0YWJsZS5cbiAgICAgICAgICogV2UgZG8gbm90IHJlLXNvcnQgdG9rZW5zIGluIGNhc2Ugb2YgYW55IHBvc2l0aW9uYWwgb3IgY2hpbGQgcHNldWRvcyBpbiB0aGUgZ3JvdXBcbiAgICAgICAgICovXG5cblxuICAgICAgICB2YXIgaXNTb3J0YWJsZSA9IGZ1bmN0aW9uIGlzU29ydGFibGUodG9rZW5zKSB7XG4gICAgICAgICAgdmFyIGlUb2tlbnMgPSB0b2tlbnMubGVuZ3RoO1xuXG4gICAgICAgICAgd2hpbGUgKGlUb2tlbnMtLSkge1xuICAgICAgICAgICAgdmFyIHRva2VuID0gdG9rZW5zW2lUb2tlbnNdO1xuXG4gICAgICAgICAgICBpZiAodG9rZW4udHlwZSA9PT0gXCJQU0VVRE9cIiAmJiBQT1NJVElPTkFMX1BTRVVET1MuaW5kZXhPZih0b2tlbi5tYXRjaGVzWzBdKSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodG9rZW4udHlwZSA9PT0gXCJDSElMRFwiKSB7XG4gICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNvcnRzIHRoZSB0b2tlbnMgaW4gb3JkZXIgdG8gbWl0aWdhdGUgdGhlIGlzc3VlcyBjYXVzZWQgYnkgdGhlIGxlZnQtdG8tcmlnaHQgbWF0Y2hpbmcuXG4gICAgICAgICAqIFRoZSBpZGVhIGlzIGNoYW5nZSB0aGUgdG9rZW5zIG9yZGVyIHNvIHRoYXQgU2l6emxlIHdhcyBtYXRjaGluZyBmYXN0IHNlbGVjdG9ycyBmaXJzdCAoaWQsIGNsYXNzKSxcbiAgICAgICAgICogYW5kIHNsb3cgc2VsZWN0b3JzIGFmdGVyIHRoYXQgKGFuZCBoZXJlIEkgbWVhbiBvdXIgc2xvdyBjdXN0b20gcHNldWRvIGNsYXNzZXMpLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAcGFyYW0ge0FycmF5fSB0b2tlbnMgQW4gYXJyYXkgb2YgdG9rZW5zIHRvIHNvcnRcbiAgICAgICAgICogQHJldHVybnMge0FycmF5fSBBIG5ldyByZS1zb3J0ZWQgYXJyYXlcbiAgICAgICAgICovXG5cblxuICAgICAgICB2YXIgc29ydFRva2VucyA9IGZ1bmN0aW9uIHNvcnRUb2tlbnModG9rZW5zKSB7XG4gICAgICAgICAgaWYgKCF0b2tlbnMgfHwgdG9rZW5zLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgcmV0dXJuIHRva2VucztcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB2YXIgc29ydGVkVG9rZW5zID0gW107XG4gICAgICAgICAgdmFyIGdyb3VwcyA9IHNwbGl0Q29tcG91bmRTZWxlY3Rvcih0b2tlbnMpO1xuXG4gICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBncm91cHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBncm91cCA9IGdyb3Vwc1tpXTtcblxuICAgICAgICAgICAgaWYgKGdyb3VwIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgICAgICAgaWYgKGlzU29ydGFibGUoZ3JvdXApKSB7XG4gICAgICAgICAgICAgICAgZ3JvdXAuc29ydChjb21wYXJlRnVuY3Rpb24pO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgc29ydGVkVG9rZW5zID0gc29ydGVkVG9rZW5zLmNvbmNhdChncm91cCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBzb3J0ZWRUb2tlbnMucHVzaChncm91cCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIHNvcnRlZFRva2VucztcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNvcnRzIGV2ZXJ5IHRva2VucyBhcnJheSBpbnNpZGUgb2YgdGhlIHNwZWNpZmllZCBcImdyb3Vwc1wiIGFycmF5LlxuICAgICAgICAgKiBTZWUgXCJzb3J0VG9rZW5zXCIgbWV0aG9kcyBmb3IgbW9yZSBpbmZvcm1hdGlvbiBvbiBob3cgdG9rZW5zIGFyZSBzb3J0ZWQuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSB7QXJyYXl9IGdyb3VwcyBBbiBhcnJheSBvZiB0b2tlbnMgYXJyYXlzLlxuICAgICAgICAgKiBAcmV0dXJucyB7QXJyYXl9IEEgbmV3IGFycmF5IHRoYXQgY29uc2lzdHMgb2YgdGhlIHNhbWUgdG9rZW5zIGFycmF5cyBhZnRlciBzb3J0aW5nXG4gICAgICAgICAqL1xuXG5cbiAgICAgICAgdmFyIHNvcnRUb2tlbkdyb3VwcyA9IGZ1bmN0aW9uIHNvcnRUb2tlbkdyb3Vwcyhncm91cHMpIHtcbiAgICAgICAgICB2YXIgc29ydGVkR3JvdXBzID0gW107XG4gICAgICAgICAgdmFyIGxlbiA9IGdyb3Vwcy5sZW5ndGg7XG4gICAgICAgICAgdmFyIGkgPSAwO1xuXG4gICAgICAgICAgZm9yICg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgICAgc29ydGVkR3JvdXBzLnB1c2goc29ydFRva2Vucyhncm91cHNbaV0pKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gc29ydGVkR3JvdXBzO1xuICAgICAgICB9OyAvLyBFeHBvc2VcblxuXG4gICAgICAgIHJldHVybiBzb3J0VG9rZW5Hcm91cHM7XG4gICAgICB9KCk7XG4gICAgICAvKipcbiAgICAgICAqIENyZWF0ZXMgY3VzdG9tIHBvbGljeSB0byB1c2UgVHJ1c3RlZFR5cGVzIENTUCBwb2xpY3lcbiAgICAgICAqIGh0dHBzOi8vdzNjLmdpdGh1Yi5pby93ZWJhcHBzZWMtdHJ1c3RlZC10eXBlcy9kaXN0L3NwZWMvXG4gICAgICAgKi9cblxuXG4gICAgICB2YXIgQUdQb2xpY3kgPSBmdW5jdGlvbiBjcmVhdGVQb2xpY3koKSB7XG4gICAgICAgIHZhciBkZWZhdWx0UG9saWN5ID0ge1xuICAgICAgICAgIGNyZWF0ZUhUTUw6IGZ1bmN0aW9uIGNyZWF0ZUhUTUwoaW5wdXQpIHtcbiAgICAgICAgICAgIHJldHVybiBpbnB1dDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGNyZWF0ZVNjcmlwdDogZnVuY3Rpb24gY3JlYXRlU2NyaXB0KGlucHV0KSB7XG4gICAgICAgICAgICByZXR1cm4gaW5wdXQ7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBjcmVhdGVTY3JpcHRVUkw6IGZ1bmN0aW9uIGNyZWF0ZVNjcmlwdFVSTChpbnB1dCkge1xuICAgICAgICAgICAgcmV0dXJuIGlucHV0O1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBpZiAod2luZG93LnRydXN0ZWRUeXBlcyAmJiB3aW5kb3cudHJ1c3RlZFR5cGVzLmNyZWF0ZVBvbGljeSkge1xuICAgICAgICAgIHJldHVybiB3aW5kb3cudHJ1c3RlZFR5cGVzLmNyZWF0ZVBvbGljeShcIkFHUG9saWN5XCIsIGRlZmF1bHRQb2xpY3kpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGRlZmF1bHRQb2xpY3k7XG4gICAgICB9KCk7XG4gICAgICAvKipcbiAgICAgICAqIFtBZEd1YXJkIFBhdGNoXTpcbiAgICAgICAqIFJlbW92ZXMgdHJhaWxpbmcgc3BhY2VzIGZyb20gdGhlIHRva2VucyBsaXN0XG4gICAgICAgKlxuICAgICAgICogQHBhcmFtIHsqfSB0b2tlbnMgQW4gYXJyYXkgb2YgU2l6emxlIHRva2VucyB0byBwb3N0LXByb2Nlc3NcbiAgICAgICAqL1xuXG5cbiAgICAgIGZ1bmN0aW9uIHJlbW92ZVRyYWlsaW5nU3BhY2VzKHRva2Vucykge1xuICAgICAgICB2YXIgaVRva2VucyA9IHRva2Vucy5sZW5ndGg7XG5cbiAgICAgICAgd2hpbGUgKGlUb2tlbnMtLSkge1xuICAgICAgICAgIHZhciB0b2tlbiA9IHRva2Vuc1tpVG9rZW5zXTtcblxuICAgICAgICAgIGlmICh0b2tlbi50eXBlID09PSBcIiBcIikge1xuICAgICAgICAgICAgdG9rZW5zLmxlbmd0aCA9IGlUb2tlbnM7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgLyoqXG4gICAgICAgKiBbQWRHdWFyZCBQYXRjaF06XG4gICAgICAgKiBBbiBvYmplY3Qgd2l0aCB0aGUgaW5mb3JtYXRpb24gYWJvdXQgc2VsZWN0b3JzIGFuZCB0aGVpciB0b2tlbiByZXByZXNlbnRhdGlvblxuICAgICAgICogQHR5cGVkZWYge3tzZWxlY3RvclRleHQ6IHN0cmluZywgZ3JvdXBzOiBBcnJheX19IFNlbGVjdG9yRGF0YVxuICAgICAgICogQHByb3BlcnR5IHtzdHJpbmd9IHNlbGVjdG9yVGV4dCBBIENTUyBzZWxlY3RvciB0ZXh0XG4gICAgICAgKiBAcHJvcGVydHkge0FycmF5fSBncm91cHMgQW4gYXJyYXkgb2YgdG9rZW4gZ3JvdXBzIGNvcnJlc3BvbmRpbmcgdG8gdGhhdCBzZWxlY3RvclxuICAgICAgICovXG5cbiAgICAgIC8qKlxuICAgICAgICogW0FkR3VhcmQgUGF0Y2hdOlxuICAgICAgICogVGhpcyBtZXRob2QgcHJvY2Vzc2VzIHBhcnNlZCB0b2tlbiBncm91cHMsIGRpdmlkZXMgdGhlbSBpbnRvIGEgbnVtYmVyIG9mIHNlbGVjdG9yc1xuICAgICAgICogYW5kIG1ha2VzIHN1cmUgdGhhdCBlYWNoIHNlbGVjdG9yJ3MgdG9rZW5zIGFyZSBjYWNoZWQgcHJvcGVybHkgaW4gU2l6emxlLlxuICAgICAgICpcbiAgICAgICAqIEBwYXJhbSB7Kn0gZ3JvdXBzIFRva2VuIGdyb3VwcyAoc2VlIHtAbGluayBTaXp6bGUudG9rZW5pemV9KVxuICAgICAgICogQHJldHVybnMge0FycmF5LjxTZWxlY3RvckRhdGE+fSBBbiBhcnJheSBvZiBzZWxlY3RvcnMgZGF0YSB3ZSBnb3QgZnJvbSB0aGUgZ3JvdXBzXG4gICAgICAgKi9cblxuXG4gICAgICBmdW5jdGlvbiB0b2tlbkdyb3Vwc1RvU2VsZWN0b3JzKGdyb3Vwcykge1xuICAgICAgICAvLyBSZW1vdmUgdHJhaWxpbmcgc3BhY2VzIHdoaWNoIHdlIGNhbiBlbmNvdW50ZXIgaW4gdG9sZXJhbnQgbW9kZVxuICAgICAgICAvLyBXZSdyZSBkb2luZyBpdCBpbiB0b2xlcmFudCBtb2RlIG9ubHkgYXMgdGhpcyBpcyB0aGUgb25seSBjYXNlIHdoZW5cbiAgICAgICAgLy8gZW5jb3VudGVyaW5nIHRyYWlsaW5nIHNwYWNlcyBpcyBleHBlY3RlZFxuICAgICAgICByZW1vdmVUcmFpbGluZ1NwYWNlcyhncm91cHNbZ3JvdXBzLmxlbmd0aCAtIDFdKTsgLy8gV2UgbmVlZCBzb3J0ZWQgdG9rZW5zIHRvIG1ha2UgY2FjaGUgd29yayBwcm9wZXJseVxuXG4gICAgICAgIHZhciBzb3J0ZWRHcm91cHMgPSBzb3J0VG9rZW5Hcm91cHMoZ3JvdXBzKTtcbiAgICAgICAgdmFyIHNlbGVjdG9ycyA9IFtdO1xuXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZ3JvdXBzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgdmFyIHRva2VuR3JvdXBzID0gZ3JvdXBzW2ldO1xuICAgICAgICAgIHZhciBzZWxlY3RvclRleHQgPSB0b1NlbGVjdG9yKHRva2VuR3JvdXBzKTtcbiAgICAgICAgICBzZWxlY3RvcnMucHVzaCh7XG4gICAgICAgICAgICAvLyBTaXp6bGUgZXhwZWN0cyBhbiBhcnJheSBvZiB0b2tlbiBncm91cHMgd2hlbiBjb21waWxpbmcgYSBzZWxlY3RvclxuICAgICAgICAgICAgZ3JvdXBzOiBbdG9rZW5Hcm91cHNdLFxuICAgICAgICAgICAgc2VsZWN0b3JUZXh0OiBzZWxlY3RvclRleHRcbiAgICAgICAgICB9KTsgLy8gTm93IG1ha2Ugc3VyZSB0aGF0IHNlbGVjdG9yIHRva2VucyBhcmUgY2FjaGVkXG5cbiAgICAgICAgICB2YXIgdG9rZW5zQ2FjaGVJdGVtID0ge1xuICAgICAgICAgICAgZ3JvdXBzOiB0b2tlbkdyb3VwcyxcbiAgICAgICAgICAgIHNvcnRlZEdyb3VwczogW3NvcnRlZEdyb3Vwc1tpXV1cbiAgICAgICAgICB9O1xuICAgICAgICAgIHRva2VuQ2FjaGUoc2VsZWN0b3JUZXh0LCB0b2tlbnNDYWNoZUl0ZW0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHNlbGVjdG9ycztcbiAgICAgIH1cbiAgICAgIC8qKlxuICAgICAgICogW0FkR3VhcmQgUGF0Y2hdOlxuICAgICAgICogQWRkIGFuIGFkZGl0aW9uYWwgYXJndW1lbnQgZm9yIFNpenpsZS50b2tlbml6ZSB3aGljaCBpbmRpY2F0ZXMgdGhhdCBpdFxuICAgICAgICogc2hvdWxkIG5vdCB0aHJvdyBvbiBpbnZhbGlkIHRva2VucywgYW5kIGluc3RlYWQgc2hvdWxkIHJldHVybiB0b2tlbnNcbiAgICAgICAqIHRoYXQgaXQgaGFzIHByb2R1Y2VkIHNvIGZhci5cbiAgICAgICAqXG4gICAgICAgKiBPbmUgbW9yZSBhZGRpdGlvbmFsIGFyZ3VtZW50IHRoYXQgYWxsb3cgdG8gY2hvb3NlIGlmIHlvdSB3YW50IHRvIHJlY2VpdmUgc29ydGVkIG9yIHVuc29ydGVkIHRva2Vuc1xuICAgICAgICogVGhlIHByb2JsZW0gaXMgdGhhdCB0aGUgcmUtc29ydGVkIHNlbGVjdG9ycyBhcmUgdmFsaWQgZm9yIFNpenpsZSwgYnV0IG5vdCBmb3IgdGhlIGJyb3dzZXIuXG4gICAgICAgKiBvcHRpb25zLnJldHVyblVuc29ydGVkIC0tIHJldHVybiB1bnNvcnRlZCB0b2tlbnMgaWYgdHJ1ZS5cbiAgICAgICAqIG9wdGlvbnMuY2FjaGVPbmx5IC0tIHJldHVybiBjYWNoZWQgcmVzdWx0IG9ubHkuIFJlcXVpcmVkIGZvciB1bml0LXRlc3RzLlxuICAgICAgICpcbiAgICAgICAqIEBwYXJhbSB7Kn0gb3B0aW9ucyBPcHRpb25hbCBjb25maWd1cmF0aW9uIG9iamVjdCB3aXRoIHR3byBhZGRpdGlvbmFsIGZsYWdzXG4gICAgICAgKiAob3B0aW9ucy50b2xlcmFudCwgb3B0aW9ucy5yZXR1cm5VbnNvcnRlZCwgb3B0aW9ucy5jYWNoZU9ubHkpIC0tIHNlZSBwYXRjaGVzICM1IGFuZCAjNiBub3Rlc1xuICAgICAgICovXG5cblxuICAgICAgdG9rZW5pemUgPSBTaXp6bGUudG9rZW5pemUgPSBmdW5jdGlvbiAoc2VsZWN0b3IsIHBhcnNlT25seSwgb3B0aW9ucykge1xuICAgICAgICB2YXIgbWF0Y2hlZCxcbiAgICAgICAgICAgIG1hdGNoLFxuICAgICAgICAgICAgdG9rZW5zLFxuICAgICAgICAgICAgdHlwZSxcbiAgICAgICAgICAgIHNvRmFyLFxuICAgICAgICAgICAgZ3JvdXBzLFxuICAgICAgICAgICAgcHJlRmlsdGVycyxcbiAgICAgICAgICAgIGNhY2hlZCA9IHRva2VuQ2FjaGVbc2VsZWN0b3IgKyBcIiBcIl07XG4gICAgICAgIHZhciB0b2xlcmFudCA9IG9wdGlvbnMgJiYgb3B0aW9ucy50b2xlcmFudDtcbiAgICAgICAgdmFyIHJldHVyblVuc29ydGVkID0gb3B0aW9ucyAmJiBvcHRpb25zLnJldHVyblVuc29ydGVkO1xuICAgICAgICB2YXIgY2FjaGVPbmx5ID0gb3B0aW9ucyAmJiBvcHRpb25zLmNhY2hlT25seTtcblxuICAgICAgICBpZiAoY2FjaGVkKSB7XG4gICAgICAgICAgaWYgKHBhcnNlT25seSkge1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiAocmV0dXJuVW5zb3J0ZWQgPyBjYWNoZWQuZ3JvdXBzIDogY2FjaGVkLnNvcnRlZEdyb3Vwcykuc2xpY2UoMCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNhY2hlT25seSkge1xuICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgc29GYXIgPSBzZWxlY3RvcjtcbiAgICAgICAgZ3JvdXBzID0gW107XG4gICAgICAgIHByZUZpbHRlcnMgPSBFeHByLnByZUZpbHRlcjtcblxuICAgICAgICB3aGlsZSAoc29GYXIpIHtcbiAgICAgICAgICAvLyBDb21tYSBhbmQgZmlyc3QgcnVuXG4gICAgICAgICAgaWYgKCFtYXRjaGVkIHx8IChtYXRjaCA9IHJjb21tYS5leGVjKHNvRmFyKSkpIHtcbiAgICAgICAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICAgICAgICAvLyBEb24ndCBjb25zdW1lIHRyYWlsaW5nIGNvbW1hcyBhcyB2YWxpZFxuICAgICAgICAgICAgICBzb0ZhciA9IHNvRmFyLnNsaWNlKG1hdGNoWzBdLmxlbmd0aCkgfHwgc29GYXI7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGdyb3Vwcy5wdXNoKHRva2VucyA9IFtdKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBtYXRjaGVkID0gZmFsc2U7IC8vIENvbWJpbmF0b3JzXG5cbiAgICAgICAgICBpZiAobWF0Y2ggPSByY29tYmluYXRvcnMuZXhlYyhzb0ZhcikpIHtcbiAgICAgICAgICAgIG1hdGNoZWQgPSBtYXRjaC5zaGlmdCgpO1xuICAgICAgICAgICAgdG9rZW5zLnB1c2goe1xuICAgICAgICAgICAgICB2YWx1ZTogbWF0Y2hlZCxcbiAgICAgICAgICAgICAgLy8gQ2FzdCBkZXNjZW5kYW50IGNvbWJpbmF0b3JzIHRvIHNwYWNlXG4gICAgICAgICAgICAgIHR5cGU6IG1hdGNoWzBdLnJlcGxhY2UocnRyaW0sIFwiIFwiKVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBzb0ZhciA9IHNvRmFyLnNsaWNlKG1hdGNoZWQubGVuZ3RoKTtcbiAgICAgICAgICB9IC8vIEZpbHRlcnNcblxuXG4gICAgICAgICAgZm9yICh0eXBlIGluIEV4cHIuZmlsdGVyKSB7XG4gICAgICAgICAgICBpZiAoKG1hdGNoID0gbWF0Y2hFeHByW3R5cGVdLmV4ZWMoc29GYXIpKSAmJiAoIXByZUZpbHRlcnNbdHlwZV0gfHwgKG1hdGNoID0gcHJlRmlsdGVyc1t0eXBlXShtYXRjaCkpKSkge1xuICAgICAgICAgICAgICBtYXRjaGVkID0gbWF0Y2guc2hpZnQoKTtcbiAgICAgICAgICAgICAgdG9rZW5zLnB1c2goe1xuICAgICAgICAgICAgICAgIHZhbHVlOiBtYXRjaGVkLFxuICAgICAgICAgICAgICAgIHR5cGU6IHR5cGUsXG4gICAgICAgICAgICAgICAgbWF0Y2hlczogbWF0Y2hcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIHNvRmFyID0gc29GYXIuc2xpY2UobWF0Y2hlZC5sZW5ndGgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmICghbWF0Y2hlZCkge1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9IC8vIFJldHVybiB0aGUgbGVuZ3RoIG9mIHRoZSBpbnZhbGlkIGV4Y2Vzc1xuICAgICAgICAvLyBpZiB3ZSdyZSBqdXN0IHBhcnNpbmdcbiAgICAgICAgLy8gT3RoZXJ3aXNlLCB0aHJvdyBhbiBlcnJvciBvciByZXR1cm4gdG9rZW5zXG5cblxuICAgICAgICB2YXIgaW52YWxpZExlbiA9IHNvRmFyLmxlbmd0aDtcblxuICAgICAgICBpZiAocGFyc2VPbmx5KSB7XG4gICAgICAgICAgcmV0dXJuIGludmFsaWRMZW47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaW52YWxpZExlbiAhPT0gMCAmJiAhdG9sZXJhbnQpIHtcbiAgICAgICAgICBTaXp6bGUuZXJyb3Ioc2VsZWN0b3IpOyAvLyBUaHJvd3MgYW4gZXJyb3IuXG4gICAgICAgIH1cblxuICAgICAgICBpZiAodG9sZXJhbnQpIHtcbiAgICAgICAgICAvKipcbiAgICAgICAgICAgKiBbQWRHdWFyZCBQYXRjaF06XG4gICAgICAgICAgICogSW4gdG9sZXJhbnQgbW9kZSB3ZSByZXR1cm4gYSBzcGVjaWFsIG9iamVjdCB0aGF0IGNvbnN0aXN0cyBvZlxuICAgICAgICAgICAqIGFuIGFycmF5IG9mIHBhcnNlZCBzZWxlY3RvcnMgKGFuZCB0aGVpciB0b2tlbnMpIGFuZCBhIFwibmV4dEluZGV4XCIgZmllbGRcbiAgICAgICAgICAgKiB0aGF0IHBvaW50cyB0byBhbiBpbmRleCBhZnRlciB3aGljaCB3ZSdyZSBub3QgYWJsZSB0byBwYXJzZSBzZWxlY3RvcnMgZmFydGhlci5cbiAgICAgICAgICAgKi9cbiAgICAgICAgICB2YXIgbmV4dEluZGV4ID0gc2VsZWN0b3IubGVuZ3RoIC0gaW52YWxpZExlbjtcbiAgICAgICAgICB2YXIgc2VsZWN0b3JzID0gdG9rZW5Hcm91cHNUb1NlbGVjdG9ycyhncm91cHMpO1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzZWxlY3RvcnM6IHNlbGVjdG9ycyxcbiAgICAgICAgICAgIG5leHRJbmRleDogbmV4dEluZGV4XG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICAvKiogW0FkR3VhcmQgUGF0Y2hdOiBTb3J0aW5nIHRva2VucyAqL1xuXG5cbiAgICAgICAgdmFyIHNvcnRlZEdyb3VwcyA9IHNvcnRUb2tlbkdyb3Vwcyhncm91cHMpO1xuICAgICAgICAvKiogW0FkR3VhcmQgUGF0Y2hdOiBDaGFuZ2UgdGhlIHdheSB0b2tlbnMgYXJlIGNhY2hlZCAqL1xuXG4gICAgICAgIHZhciB0b2tlbnNDYWNoZUl0ZW0gPSB7XG4gICAgICAgICAgZ3JvdXBzOiBncm91cHMsXG4gICAgICAgICAgc29ydGVkR3JvdXBzOiBzb3J0ZWRHcm91cHNcbiAgICAgICAgfTtcbiAgICAgICAgdG9rZW5zQ2FjaGVJdGVtID0gdG9rZW5DYWNoZShzZWxlY3RvciwgdG9rZW5zQ2FjaGVJdGVtKTtcbiAgICAgICAgcmV0dXJuIChyZXR1cm5VbnNvcnRlZCA/IHRva2Vuc0NhY2hlSXRlbS5ncm91cHMgOiB0b2tlbnNDYWNoZUl0ZW0uc29ydGVkR3JvdXBzKS5zbGljZSgwKTtcbiAgICAgIH07XG5cbiAgICAgIGZ1bmN0aW9uIHRvU2VsZWN0b3IodG9rZW5zKSB7XG4gICAgICAgIHZhciBpID0gMCxcbiAgICAgICAgICAgIGxlbiA9IHRva2Vucy5sZW5ndGgsXG4gICAgICAgICAgICBzZWxlY3RvciA9IFwiXCI7XG5cbiAgICAgICAgZm9yICg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgIHNlbGVjdG9yICs9IHRva2Vuc1tpXS52YWx1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBzZWxlY3RvcjtcbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gYWRkQ29tYmluYXRvcihtYXRjaGVyLCBjb21iaW5hdG9yLCBiYXNlKSB7XG4gICAgICAgIHZhciBkaXIgPSBjb21iaW5hdG9yLmRpcixcbiAgICAgICAgICAgIHNraXAgPSBjb21iaW5hdG9yLm5leHQsXG4gICAgICAgICAgICBrZXkgPSBza2lwIHx8IGRpcixcbiAgICAgICAgICAgIGNoZWNrTm9uRWxlbWVudHMgPSBiYXNlICYmIGtleSA9PT0gXCJwYXJlbnROb2RlXCIsXG4gICAgICAgICAgICBkb25lTmFtZSA9IGRvbmUrKztcbiAgICAgICAgcmV0dXJuIGNvbWJpbmF0b3IuZmlyc3QgPyAvLyBDaGVjayBhZ2FpbnN0IGNsb3Nlc3QgYW5jZXN0b3IvcHJlY2VkaW5nIGVsZW1lbnRcbiAgICAgICAgZnVuY3Rpb24gKGVsZW0sIGNvbnRleHQsIHhtbCkge1xuICAgICAgICAgIHdoaWxlIChlbGVtID0gZWxlbVtkaXJdKSB7XG4gICAgICAgICAgICBpZiAoZWxlbS5ub2RlVHlwZSA9PT0gMSB8fCBjaGVja05vbkVsZW1lbnRzKSB7XG4gICAgICAgICAgICAgIHJldHVybiBtYXRjaGVyKGVsZW0sIGNvbnRleHQsIHhtbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9IDogLy8gQ2hlY2sgYWdhaW5zdCBhbGwgYW5jZXN0b3IvcHJlY2VkaW5nIGVsZW1lbnRzXG4gICAgICAgIGZ1bmN0aW9uIChlbGVtLCBjb250ZXh0LCB4bWwpIHtcbiAgICAgICAgICB2YXIgb2xkQ2FjaGUsXG4gICAgICAgICAgICAgIHVuaXF1ZUNhY2hlLFxuICAgICAgICAgICAgICBvdXRlckNhY2hlLFxuICAgICAgICAgICAgICBuZXdDYWNoZSA9IFtkaXJydW5zLCBkb25lTmFtZV07IC8vIFdlIGNhbid0IHNldCBhcmJpdHJhcnkgZGF0YSBvbiBYTUwgbm9kZXMsIHNvIHRoZXkgZG9uJ3QgYmVuZWZpdCBmcm9tIGNvbWJpbmF0b3IgY2FjaGluZ1xuXG4gICAgICAgICAgaWYgKHhtbCkge1xuICAgICAgICAgICAgd2hpbGUgKGVsZW0gPSBlbGVtW2Rpcl0pIHtcbiAgICAgICAgICAgICAgaWYgKGVsZW0ubm9kZVR5cGUgPT09IDEgfHwgY2hlY2tOb25FbGVtZW50cykge1xuICAgICAgICAgICAgICAgIGlmIChtYXRjaGVyKGVsZW0sIGNvbnRleHQsIHhtbCkpIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB3aGlsZSAoZWxlbSA9IGVsZW1bZGlyXSkge1xuICAgICAgICAgICAgICBpZiAoZWxlbS5ub2RlVHlwZSA9PT0gMSB8fCBjaGVja05vbkVsZW1lbnRzKSB7XG4gICAgICAgICAgICAgICAgb3V0ZXJDYWNoZSA9IGVsZW1bZXhwYW5kb10gfHwgKGVsZW1bZXhwYW5kb10gPSB7fSk7IC8vIFN1cHBvcnQ6IElFIDw5IG9ubHlcbiAgICAgICAgICAgICAgICAvLyBEZWZlbmQgYWdhaW5zdCBjbG9uZWQgYXR0cm9wZXJ0aWVzIChqUXVlcnkgZ2gtMTcwOSlcblxuICAgICAgICAgICAgICAgIHVuaXF1ZUNhY2hlID0gb3V0ZXJDYWNoZVtlbGVtLnVuaXF1ZUlEXSB8fCAob3V0ZXJDYWNoZVtlbGVtLnVuaXF1ZUlEXSA9IHt9KTtcblxuICAgICAgICAgICAgICAgIGlmIChza2lwICYmIHNraXAgPT09IGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSkge1xuICAgICAgICAgICAgICAgICAgZWxlbSA9IGVsZW1bZGlyXSB8fCBlbGVtO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoKG9sZENhY2hlID0gdW5pcXVlQ2FjaGVba2V5XSkgJiYgb2xkQ2FjaGVbMF0gPT09IGRpcnJ1bnMgJiYgb2xkQ2FjaGVbMV0gPT09IGRvbmVOYW1lKSB7XG4gICAgICAgICAgICAgICAgICAvLyBBc3NpZ24gdG8gbmV3Q2FjaGUgc28gcmVzdWx0cyBiYWNrLXByb3BhZ2F0ZSB0byBwcmV2aW91cyBlbGVtZW50c1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ld0NhY2hlWzJdID0gb2xkQ2FjaGVbMl07XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIC8vIFJldXNlIG5ld2NhY2hlIHNvIHJlc3VsdHMgYmFjay1wcm9wYWdhdGUgdG8gcHJldmlvdXMgZWxlbWVudHNcbiAgICAgICAgICAgICAgICAgIHVuaXF1ZUNhY2hlW2tleV0gPSBuZXdDYWNoZTsgLy8gQSBtYXRjaCBtZWFucyB3ZSdyZSBkb25lOyBhIGZhaWwgbWVhbnMgd2UgaGF2ZSB0byBrZWVwIGNoZWNraW5nXG5cbiAgICAgICAgICAgICAgICAgIGlmIChuZXdDYWNoZVsyXSA9IG1hdGNoZXIoZWxlbSwgY29udGV4dCwgeG1sKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIGVsZW1lbnRNYXRjaGVyKG1hdGNoZXJzKSB7XG4gICAgICAgIHJldHVybiBtYXRjaGVycy5sZW5ndGggPiAxID8gZnVuY3Rpb24gKGVsZW0sIGNvbnRleHQsIHhtbCkge1xuICAgICAgICAgIHZhciBpID0gbWF0Y2hlcnMubGVuZ3RoO1xuXG4gICAgICAgICAgd2hpbGUgKGktLSkge1xuICAgICAgICAgICAgaWYgKCFtYXRjaGVyc1tpXShlbGVtLCBjb250ZXh0LCB4bWwpKSB7XG4gICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSA6IG1hdGNoZXJzWzBdO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBtdWx0aXBsZUNvbnRleHRzKHNlbGVjdG9yLCBjb250ZXh0cywgcmVzdWx0cykge1xuICAgICAgICB2YXIgaSA9IDAsXG4gICAgICAgICAgICBsZW4gPSBjb250ZXh0cy5sZW5ndGg7XG5cbiAgICAgICAgZm9yICg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgIFNpenpsZShzZWxlY3RvciwgY29udGV4dHNbaV0sIHJlc3VsdHMpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIGNvbmRlbnNlKHVubWF0Y2hlZCwgbWFwLCBmaWx0ZXIsIGNvbnRleHQsIHhtbCkge1xuICAgICAgICB2YXIgZWxlbSxcbiAgICAgICAgICAgIG5ld1VubWF0Y2hlZCA9IFtdLFxuICAgICAgICAgICAgaSA9IDAsXG4gICAgICAgICAgICBsZW4gPSB1bm1hdGNoZWQubGVuZ3RoLFxuICAgICAgICAgICAgbWFwcGVkID0gbWFwICE9IG51bGw7XG5cbiAgICAgICAgZm9yICg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgIGlmIChlbGVtID0gdW5tYXRjaGVkW2ldKSB7XG4gICAgICAgICAgICBpZiAoIWZpbHRlciB8fCBmaWx0ZXIoZWxlbSwgY29udGV4dCwgeG1sKSkge1xuICAgICAgICAgICAgICBuZXdVbm1hdGNoZWQucHVzaChlbGVtKTtcblxuICAgICAgICAgICAgICBpZiAobWFwcGVkKSB7XG4gICAgICAgICAgICAgICAgbWFwLnB1c2goaSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbmV3VW5tYXRjaGVkO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBzZXRNYXRjaGVyKHByZUZpbHRlciwgc2VsZWN0b3IsIG1hdGNoZXIsIHBvc3RGaWx0ZXIsIHBvc3RGaW5kZXIsIHBvc3RTZWxlY3Rvcikge1xuICAgICAgICBpZiAocG9zdEZpbHRlciAmJiAhcG9zdEZpbHRlcltleHBhbmRvXSkge1xuICAgICAgICAgIHBvc3RGaWx0ZXIgPSBzZXRNYXRjaGVyKHBvc3RGaWx0ZXIpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHBvc3RGaW5kZXIgJiYgIXBvc3RGaW5kZXJbZXhwYW5kb10pIHtcbiAgICAgICAgICBwb3N0RmluZGVyID0gc2V0TWF0Y2hlcihwb3N0RmluZGVyLCBwb3N0U2VsZWN0b3IpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG1hcmtGdW5jdGlvbihmdW5jdGlvbiAoc2VlZCwgcmVzdWx0cywgY29udGV4dCwgeG1sKSB7XG4gICAgICAgICAgdmFyIHRlbXAsXG4gICAgICAgICAgICAgIGksXG4gICAgICAgICAgICAgIGVsZW0sXG4gICAgICAgICAgICAgIHByZU1hcCA9IFtdLFxuICAgICAgICAgICAgICBwb3N0TWFwID0gW10sXG4gICAgICAgICAgICAgIHByZWV4aXN0aW5nID0gcmVzdWx0cy5sZW5ndGgsXG4gICAgICAgICAgICAgIC8vIEdldCBpbml0aWFsIGVsZW1lbnRzIGZyb20gc2VlZCBvciBjb250ZXh0XG4gICAgICAgICAgZWxlbXMgPSBzZWVkIHx8IG11bHRpcGxlQ29udGV4dHMoc2VsZWN0b3IgfHwgXCIqXCIsIGNvbnRleHQubm9kZVR5cGUgPyBbY29udGV4dF0gOiBjb250ZXh0LCBbXSksXG4gICAgICAgICAgICAgIC8vIFByZWZpbHRlciB0byBnZXQgbWF0Y2hlciBpbnB1dCwgcHJlc2VydmluZyBhIG1hcCBmb3Igc2VlZC1yZXN1bHRzIHN5bmNocm9uaXphdGlvblxuICAgICAgICAgIG1hdGNoZXJJbiA9IHByZUZpbHRlciAmJiAoc2VlZCB8fCAhc2VsZWN0b3IpID8gY29uZGVuc2UoZWxlbXMsIHByZU1hcCwgcHJlRmlsdGVyLCBjb250ZXh0LCB4bWwpIDogZWxlbXMsXG4gICAgICAgICAgICAgIG1hdGNoZXJPdXQgPSBtYXRjaGVyID8gLy8gSWYgd2UgaGF2ZSBhIHBvc3RGaW5kZXIsIG9yIGZpbHRlcmVkIHNlZWQsIG9yIG5vbi1zZWVkIHBvc3RGaWx0ZXIgb3IgcHJlZXhpc3RpbmcgcmVzdWx0cyxcbiAgICAgICAgICBwb3N0RmluZGVyIHx8IChzZWVkID8gcHJlRmlsdGVyIDogcHJlZXhpc3RpbmcgfHwgcG9zdEZpbHRlcikgPyAvLyAuLi5pbnRlcm1lZGlhdGUgcHJvY2Vzc2luZyBpcyBuZWNlc3NhcnlcbiAgICAgICAgICBbXSA6IC8vIC4uLm90aGVyd2lzZSB1c2UgcmVzdWx0cyBkaXJlY3RseVxuICAgICAgICAgIHJlc3VsdHMgOiBtYXRjaGVySW47IC8vIEZpbmQgcHJpbWFyeSBtYXRjaGVzXG5cbiAgICAgICAgICBpZiAobWF0Y2hlcikge1xuICAgICAgICAgICAgbWF0Y2hlcihtYXRjaGVySW4sIG1hdGNoZXJPdXQsIGNvbnRleHQsIHhtbCk7XG4gICAgICAgICAgfSAvLyBBcHBseSBwb3N0RmlsdGVyXG5cblxuICAgICAgICAgIGlmIChwb3N0RmlsdGVyKSB7XG4gICAgICAgICAgICB0ZW1wID0gY29uZGVuc2UobWF0Y2hlck91dCwgcG9zdE1hcCk7XG4gICAgICAgICAgICBwb3N0RmlsdGVyKHRlbXAsIFtdLCBjb250ZXh0LCB4bWwpOyAvLyBVbi1tYXRjaCBmYWlsaW5nIGVsZW1lbnRzIGJ5IG1vdmluZyB0aGVtIGJhY2sgdG8gbWF0Y2hlckluXG5cbiAgICAgICAgICAgIGkgPSB0ZW1wLmxlbmd0aDtcblxuICAgICAgICAgICAgd2hpbGUgKGktLSkge1xuICAgICAgICAgICAgICBpZiAoZWxlbSA9IHRlbXBbaV0pIHtcbiAgICAgICAgICAgICAgICBtYXRjaGVyT3V0W3Bvc3RNYXBbaV1dID0gIShtYXRjaGVySW5bcG9zdE1hcFtpXV0gPSBlbGVtKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChzZWVkKSB7XG4gICAgICAgICAgICBpZiAocG9zdEZpbmRlciB8fCBwcmVGaWx0ZXIpIHtcbiAgICAgICAgICAgICAgaWYgKHBvc3RGaW5kZXIpIHtcbiAgICAgICAgICAgICAgICAvLyBHZXQgdGhlIGZpbmFsIG1hdGNoZXJPdXQgYnkgY29uZGVuc2luZyB0aGlzIGludGVybWVkaWF0ZSBpbnRvIHBvc3RGaW5kZXIgY29udGV4dHNcbiAgICAgICAgICAgICAgICB0ZW1wID0gW107XG4gICAgICAgICAgICAgICAgaSA9IG1hdGNoZXJPdXQubGVuZ3RoO1xuXG4gICAgICAgICAgICAgICAgd2hpbGUgKGktLSkge1xuICAgICAgICAgICAgICAgICAgaWYgKGVsZW0gPSBtYXRjaGVyT3V0W2ldKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFJlc3RvcmUgbWF0Y2hlckluIHNpbmNlIGVsZW0gaXMgbm90IHlldCBhIGZpbmFsIG1hdGNoXG4gICAgICAgICAgICAgICAgICAgIHRlbXAucHVzaChtYXRjaGVySW5baV0gPSBlbGVtKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBwb3N0RmluZGVyKG51bGwsIG1hdGNoZXJPdXQgPSBbXSwgdGVtcCwgeG1sKTtcbiAgICAgICAgICAgICAgfSAvLyBNb3ZlIG1hdGNoZWQgZWxlbWVudHMgZnJvbSBzZWVkIHRvIHJlc3VsdHMgdG8ga2VlcCB0aGVtIHN5bmNocm9uaXplZFxuXG5cbiAgICAgICAgICAgICAgaSA9IG1hdGNoZXJPdXQubGVuZ3RoO1xuXG4gICAgICAgICAgICAgIHdoaWxlIChpLS0pIHtcbiAgICAgICAgICAgICAgICBpZiAoKGVsZW0gPSBtYXRjaGVyT3V0W2ldKSAmJiAodGVtcCA9IHBvc3RGaW5kZXIgPyBpbmRleE9mKHNlZWQsIGVsZW0pIDogcHJlTWFwW2ldKSA+IC0xKSB7XG4gICAgICAgICAgICAgICAgICBzZWVkW3RlbXBdID0gIShyZXN1bHRzW3RlbXBdID0gZWxlbSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IC8vIEFkZCBlbGVtZW50cyB0byByZXN1bHRzLCB0aHJvdWdoIHBvc3RGaW5kZXIgaWYgZGVmaW5lZFxuXG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG1hdGNoZXJPdXQgPSBjb25kZW5zZShtYXRjaGVyT3V0ID09PSByZXN1bHRzID8gbWF0Y2hlck91dC5zcGxpY2UocHJlZXhpc3RpbmcsIG1hdGNoZXJPdXQubGVuZ3RoKSA6IG1hdGNoZXJPdXQpO1xuXG4gICAgICAgICAgICBpZiAocG9zdEZpbmRlcikge1xuICAgICAgICAgICAgICBwb3N0RmluZGVyKG51bGwsIHJlc3VsdHMsIG1hdGNoZXJPdXQsIHhtbCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBwdXNoLmFwcGx5KHJlc3VsdHMsIG1hdGNoZXJPdXQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIG1hdGNoZXJGcm9tVG9rZW5zKHRva2Vucykge1xuICAgICAgICB2YXIgY2hlY2tDb250ZXh0LFxuICAgICAgICAgICAgbWF0Y2hlcixcbiAgICAgICAgICAgIGosXG4gICAgICAgICAgICBsZW4gPSB0b2tlbnMubGVuZ3RoLFxuICAgICAgICAgICAgbGVhZGluZ1JlbGF0aXZlID0gRXhwci5yZWxhdGl2ZVt0b2tlbnNbMF0udHlwZV0sXG4gICAgICAgICAgICBpbXBsaWNpdFJlbGF0aXZlID0gbGVhZGluZ1JlbGF0aXZlIHx8IEV4cHIucmVsYXRpdmVbXCIgXCJdLFxuICAgICAgICAgICAgaSA9IGxlYWRpbmdSZWxhdGl2ZSA/IDEgOiAwLFxuICAgICAgICAgICAgLy8gVGhlIGZvdW5kYXRpb25hbCBtYXRjaGVyIGVuc3VyZXMgdGhhdCBlbGVtZW50cyBhcmUgcmVhY2hhYmxlIGZyb20gdG9wLWxldmVsIGNvbnRleHQocylcbiAgICAgICAgbWF0Y2hDb250ZXh0ID0gYWRkQ29tYmluYXRvcihmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICAgIHJldHVybiBlbGVtID09PSBjaGVja0NvbnRleHQ7XG4gICAgICAgIH0sIGltcGxpY2l0UmVsYXRpdmUsIHRydWUpLFxuICAgICAgICAgICAgbWF0Y2hBbnlDb250ZXh0ID0gYWRkQ29tYmluYXRvcihmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICAgIHJldHVybiBpbmRleE9mKGNoZWNrQ29udGV4dCwgZWxlbSkgPiAtMTtcbiAgICAgICAgfSwgaW1wbGljaXRSZWxhdGl2ZSwgdHJ1ZSksXG4gICAgICAgICAgICBtYXRjaGVycyA9IFtmdW5jdGlvbiAoZWxlbSwgY29udGV4dCwgeG1sKSB7XG4gICAgICAgICAgdmFyIHJldCA9ICFsZWFkaW5nUmVsYXRpdmUgJiYgKHhtbCB8fCBjb250ZXh0ICE9PSBvdXRlcm1vc3RDb250ZXh0KSB8fCAoKGNoZWNrQ29udGV4dCA9IGNvbnRleHQpLm5vZGVUeXBlID8gbWF0Y2hDb250ZXh0KGVsZW0sIGNvbnRleHQsIHhtbCkgOiBtYXRjaEFueUNvbnRleHQoZWxlbSwgY29udGV4dCwgeG1sKSk7IC8vIEF2b2lkIGhhbmdpbmcgb250byBlbGVtZW50IChpc3N1ZSAjMjk5KVxuXG4gICAgICAgICAgY2hlY2tDb250ZXh0ID0gbnVsbDtcbiAgICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgICB9XTtcblxuICAgICAgICBmb3IgKDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgaWYgKG1hdGNoZXIgPSBFeHByLnJlbGF0aXZlW3Rva2Vuc1tpXS50eXBlXSkge1xuICAgICAgICAgICAgbWF0Y2hlcnMgPSBbYWRkQ29tYmluYXRvcihlbGVtZW50TWF0Y2hlcihtYXRjaGVycyksIG1hdGNoZXIpXTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbWF0Y2hlciA9IEV4cHIuZmlsdGVyW3Rva2Vuc1tpXS50eXBlXS5hcHBseShudWxsLCB0b2tlbnNbaV0ubWF0Y2hlcyk7IC8vIFJldHVybiBzcGVjaWFsIHVwb24gc2VlaW5nIGEgcG9zaXRpb25hbCBtYXRjaGVyXG5cbiAgICAgICAgICAgIGlmIChtYXRjaGVyW2V4cGFuZG9dKSB7XG4gICAgICAgICAgICAgIC8vIEZpbmQgdGhlIG5leHQgcmVsYXRpdmUgb3BlcmF0b3IgKGlmIGFueSkgZm9yIHByb3BlciBoYW5kbGluZ1xuICAgICAgICAgICAgICBqID0gKytpO1xuXG4gICAgICAgICAgICAgIGZvciAoOyBqIDwgbGVuOyBqKyspIHtcbiAgICAgICAgICAgICAgICBpZiAoRXhwci5yZWxhdGl2ZVt0b2tlbnNbal0udHlwZV0pIHtcbiAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIHJldHVybiBzZXRNYXRjaGVyKGkgPiAxICYmIGVsZW1lbnRNYXRjaGVyKG1hdGNoZXJzKSwgaSA+IDEgJiYgdG9TZWxlY3RvciggLy8gSWYgdGhlIHByZWNlZGluZyB0b2tlbiB3YXMgYSBkZXNjZW5kYW50IGNvbWJpbmF0b3IsIGluc2VydCBhbiBpbXBsaWNpdCBhbnktZWxlbWVudCBgKmBcbiAgICAgICAgICAgICAgdG9rZW5zLnNsaWNlKDAsIGkgLSAxKS5jb25jYXQoe1xuICAgICAgICAgICAgICAgIHZhbHVlOiB0b2tlbnNbaSAtIDJdLnR5cGUgPT09IFwiIFwiID8gXCIqXCIgOiBcIlwiXG4gICAgICAgICAgICAgIH0pKS5yZXBsYWNlKHJ0cmltLCBcIiQxXCIpLCBtYXRjaGVyLCBpIDwgaiAmJiBtYXRjaGVyRnJvbVRva2Vucyh0b2tlbnMuc2xpY2UoaSwgaikpLCBqIDwgbGVuICYmIG1hdGNoZXJGcm9tVG9rZW5zKHRva2VucyA9IHRva2Vucy5zbGljZShqKSksIGogPCBsZW4gJiYgdG9TZWxlY3Rvcih0b2tlbnMpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbWF0Y2hlcnMucHVzaChtYXRjaGVyKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZWxlbWVudE1hdGNoZXIobWF0Y2hlcnMpO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBtYXRjaGVyRnJvbUdyb3VwTWF0Y2hlcnMoZWxlbWVudE1hdGNoZXJzLCBzZXRNYXRjaGVycykge1xuICAgICAgICB2YXIgYnlTZXQgPSBzZXRNYXRjaGVycy5sZW5ndGggPiAwLFxuICAgICAgICAgICAgYnlFbGVtZW50ID0gZWxlbWVudE1hdGNoZXJzLmxlbmd0aCA+IDAsXG4gICAgICAgICAgICBzdXBlck1hdGNoZXIgPSBmdW5jdGlvbiBzdXBlck1hdGNoZXIoc2VlZCwgY29udGV4dCwgeG1sLCByZXN1bHRzLCBvdXRlcm1vc3QpIHtcbiAgICAgICAgICB2YXIgZWxlbSxcbiAgICAgICAgICAgICAgaixcbiAgICAgICAgICAgICAgbWF0Y2hlcixcbiAgICAgICAgICAgICAgbWF0Y2hlZENvdW50ID0gMCxcbiAgICAgICAgICAgICAgaSA9IFwiMFwiLFxuICAgICAgICAgICAgICB1bm1hdGNoZWQgPSBzZWVkICYmIFtdLFxuICAgICAgICAgICAgICBzZXRNYXRjaGVkID0gW10sXG4gICAgICAgICAgICAgIGNvbnRleHRCYWNrdXAgPSBvdXRlcm1vc3RDb250ZXh0LFxuICAgICAgICAgICAgICAvLyBXZSBtdXN0IGFsd2F5cyBoYXZlIGVpdGhlciBzZWVkIGVsZW1lbnRzIG9yIG91dGVybW9zdCBjb250ZXh0XG4gICAgICAgICAgZWxlbXMgPSBzZWVkIHx8IGJ5RWxlbWVudCAmJiBFeHByLmZpbmRbXCJUQUdcIl0oXCIqXCIsIG91dGVybW9zdCksXG4gICAgICAgICAgICAgIC8vIFVzZSBpbnRlZ2VyIGRpcnJ1bnMgaWZmIHRoaXMgaXMgdGhlIG91dGVybW9zdCBtYXRjaGVyXG4gICAgICAgICAgZGlycnVuc1VuaXF1ZSA9IGRpcnJ1bnMgKz0gY29udGV4dEJhY2t1cCA9PSBudWxsID8gMSA6IE1hdGgucmFuZG9tKCkgfHwgMC4xLFxuICAgICAgICAgICAgICBsZW4gPSBlbGVtcy5sZW5ndGg7XG5cbiAgICAgICAgICBpZiAob3V0ZXJtb3N0KSB7XG4gICAgICAgICAgICBvdXRlcm1vc3RDb250ZXh0ID0gY29udGV4dCA9PT0gZG9jdW1lbnQgfHwgY29udGV4dCB8fCBvdXRlcm1vc3Q7XG4gICAgICAgICAgfSAvLyBBZGQgZWxlbWVudHMgcGFzc2luZyBlbGVtZW50TWF0Y2hlcnMgZGlyZWN0bHkgdG8gcmVzdWx0c1xuICAgICAgICAgIC8vIFN1cHBvcnQ6IElFPDksIFNhZmFyaVxuICAgICAgICAgIC8vIFRvbGVyYXRlIE5vZGVMaXN0IHByb3BlcnRpZXMgKElFOiBcImxlbmd0aFwiOyBTYWZhcmk6IDxudW1iZXI+KSBtYXRjaGluZyBlbGVtZW50cyBieSBpZFxuXG5cbiAgICAgICAgICBmb3IgKDsgaSAhPT0gbGVuICYmIChlbGVtID0gZWxlbXNbaV0pICE9IG51bGw7IGkrKykge1xuICAgICAgICAgICAgaWYgKGJ5RWxlbWVudCAmJiBlbGVtKSB7XG4gICAgICAgICAgICAgIGogPSAwO1xuXG4gICAgICAgICAgICAgIGlmICghY29udGV4dCAmJiBlbGVtLm93bmVyRG9jdW1lbnQgIT09IGRvY3VtZW50KSB7XG4gICAgICAgICAgICAgICAgc2V0RG9jdW1lbnQoZWxlbSk7XG4gICAgICAgICAgICAgICAgeG1sID0gIWRvY3VtZW50SXNIVE1MO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgd2hpbGUgKG1hdGNoZXIgPSBlbGVtZW50TWF0Y2hlcnNbaisrXSkge1xuICAgICAgICAgICAgICAgIGlmIChtYXRjaGVyKGVsZW0sIGNvbnRleHQgfHwgZG9jdW1lbnQsIHhtbCkpIHtcbiAgICAgICAgICAgICAgICAgIHJlc3VsdHMucHVzaChlbGVtKTtcbiAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGlmIChvdXRlcm1vc3QpIHtcbiAgICAgICAgICAgICAgICBkaXJydW5zID0gZGlycnVuc1VuaXF1ZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSAvLyBUcmFjayB1bm1hdGNoZWQgZWxlbWVudHMgZm9yIHNldCBmaWx0ZXJzXG5cblxuICAgICAgICAgICAgaWYgKGJ5U2V0KSB7XG4gICAgICAgICAgICAgIC8vIFRoZXkgd2lsbCBoYXZlIGdvbmUgdGhyb3VnaCBhbGwgcG9zc2libGUgbWF0Y2hlcnNcbiAgICAgICAgICAgICAgaWYgKGVsZW0gPSAhbWF0Y2hlciAmJiBlbGVtKSB7XG4gICAgICAgICAgICAgICAgbWF0Y2hlZENvdW50LS07XG4gICAgICAgICAgICAgIH0gLy8gTGVuZ3RoZW4gdGhlIGFycmF5IGZvciBldmVyeSBlbGVtZW50LCBtYXRjaGVkIG9yIG5vdFxuXG5cbiAgICAgICAgICAgICAgaWYgKHNlZWQpIHtcbiAgICAgICAgICAgICAgICB1bm1hdGNoZWQucHVzaChlbGVtKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gLy8gYGlgIGlzIG5vdyB0aGUgY291bnQgb2YgZWxlbWVudHMgdmlzaXRlZCBhYm92ZSwgYW5kIGFkZGluZyBpdCB0byBgbWF0Y2hlZENvdW50YFxuICAgICAgICAgIC8vIG1ha2VzIHRoZSBsYXR0ZXIgbm9ubmVnYXRpdmUuXG5cblxuICAgICAgICAgIG1hdGNoZWRDb3VudCArPSBpOyAvLyBBcHBseSBzZXQgZmlsdGVycyB0byB1bm1hdGNoZWQgZWxlbWVudHNcbiAgICAgICAgICAvLyBOT1RFOiBUaGlzIGNhbiBiZSBza2lwcGVkIGlmIHRoZXJlIGFyZSBubyB1bm1hdGNoZWQgZWxlbWVudHMgKGkuZS4sIGBtYXRjaGVkQ291bnRgXG4gICAgICAgICAgLy8gZXF1YWxzIGBpYCksIHVubGVzcyB3ZSBkaWRuJ3QgdmlzaXQgX2FueV8gZWxlbWVudHMgaW4gdGhlIGFib3ZlIGxvb3AgYmVjYXVzZSB3ZSBoYXZlXG4gICAgICAgICAgLy8gbm8gZWxlbWVudCBtYXRjaGVycyBhbmQgbm8gc2VlZC5cbiAgICAgICAgICAvLyBJbmNyZW1lbnRpbmcgYW4gaW5pdGlhbGx5LXN0cmluZyBcIjBcIiBgaWAgYWxsb3dzIGBpYCB0byByZW1haW4gYSBzdHJpbmcgb25seSBpbiB0aGF0XG4gICAgICAgICAgLy8gY2FzZSwgd2hpY2ggd2lsbCByZXN1bHQgaW4gYSBcIjAwXCIgYG1hdGNoZWRDb3VudGAgdGhhdCBkaWZmZXJzIGZyb20gYGlgIGJ1dCBpcyBhbHNvXG4gICAgICAgICAgLy8gbnVtZXJpY2FsbHkgemVyby5cblxuICAgICAgICAgIGlmIChieVNldCAmJiBpICE9PSBtYXRjaGVkQ291bnQpIHtcbiAgICAgICAgICAgIGogPSAwO1xuXG4gICAgICAgICAgICB3aGlsZSAobWF0Y2hlciA9IHNldE1hdGNoZXJzW2orK10pIHtcbiAgICAgICAgICAgICAgbWF0Y2hlcih1bm1hdGNoZWQsIHNldE1hdGNoZWQsIGNvbnRleHQsIHhtbCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChzZWVkKSB7XG4gICAgICAgICAgICAgIC8vIFJlaW50ZWdyYXRlIGVsZW1lbnQgbWF0Y2hlcyB0byBlbGltaW5hdGUgdGhlIG5lZWQgZm9yIHNvcnRpbmdcbiAgICAgICAgICAgICAgaWYgKG1hdGNoZWRDb3VudCA+IDApIHtcbiAgICAgICAgICAgICAgICB3aGlsZSAoaS0tKSB7XG4gICAgICAgICAgICAgICAgICBpZiAoISh1bm1hdGNoZWRbaV0gfHwgc2V0TWF0Y2hlZFtpXSkpIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0TWF0Y2hlZFtpXSA9IHBvcC5jYWxsKHJlc3VsdHMpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSAvLyBEaXNjYXJkIGluZGV4IHBsYWNlaG9sZGVyIHZhbHVlcyB0byBnZXQgb25seSBhY3R1YWwgbWF0Y2hlc1xuXG5cbiAgICAgICAgICAgICAgc2V0TWF0Y2hlZCA9IGNvbmRlbnNlKHNldE1hdGNoZWQpO1xuICAgICAgICAgICAgfSAvLyBBZGQgbWF0Y2hlcyB0byByZXN1bHRzXG5cblxuICAgICAgICAgICAgcHVzaC5hcHBseShyZXN1bHRzLCBzZXRNYXRjaGVkKTsgLy8gU2VlZGxlc3Mgc2V0IG1hdGNoZXMgc3VjY2VlZGluZyBtdWx0aXBsZSBzdWNjZXNzZnVsIG1hdGNoZXJzIHN0aXB1bGF0ZSBzb3J0aW5nXG5cbiAgICAgICAgICAgIGlmIChvdXRlcm1vc3QgJiYgIXNlZWQgJiYgc2V0TWF0Y2hlZC5sZW5ndGggPiAwICYmIG1hdGNoZWRDb3VudCArIHNldE1hdGNoZXJzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgU2l6emxlLnVuaXF1ZVNvcnQocmVzdWx0cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSAvLyBPdmVycmlkZSBtYW5pcHVsYXRpb24gb2YgZ2xvYmFscyBieSBuZXN0ZWQgbWF0Y2hlcnNcblxuXG4gICAgICAgICAgaWYgKG91dGVybW9zdCkge1xuICAgICAgICAgICAgZGlycnVucyA9IGRpcnJ1bnNVbmlxdWU7XG4gICAgICAgICAgICBvdXRlcm1vc3RDb250ZXh0ID0gY29udGV4dEJhY2t1cDtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gdW5tYXRjaGVkO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBieVNldCA/IG1hcmtGdW5jdGlvbihzdXBlck1hdGNoZXIpIDogc3VwZXJNYXRjaGVyO1xuICAgICAgfVxuXG4gICAgICBjb21waWxlID0gU2l6emxlLmNvbXBpbGUgPSBmdW5jdGlvbiAoc2VsZWN0b3IsIG1hdGNoXG4gICAgICAvKiBJbnRlcm5hbCBVc2UgT25seSAqL1xuICAgICAgKSB7XG4gICAgICAgIHZhciBpLFxuICAgICAgICAgICAgc2V0TWF0Y2hlcnMgPSBbXSxcbiAgICAgICAgICAgIGVsZW1lbnRNYXRjaGVycyA9IFtdLFxuICAgICAgICAgICAgY2FjaGVkID0gY29tcGlsZXJDYWNoZVtzZWxlY3RvciArIFwiIFwiXTtcblxuICAgICAgICBpZiAoIWNhY2hlZCkge1xuICAgICAgICAgIC8vIEdlbmVyYXRlIGEgZnVuY3Rpb24gb2YgcmVjdXJzaXZlIGZ1bmN0aW9ucyB0aGF0IGNhbiBiZSB1c2VkIHRvIGNoZWNrIGVhY2ggZWxlbWVudFxuICAgICAgICAgIGlmICghbWF0Y2gpIHtcbiAgICAgICAgICAgIG1hdGNoID0gdG9rZW5pemUoc2VsZWN0b3IpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGkgPSBtYXRjaC5sZW5ndGg7XG5cbiAgICAgICAgICB3aGlsZSAoaS0tKSB7XG4gICAgICAgICAgICBjYWNoZWQgPSBtYXRjaGVyRnJvbVRva2VucyhtYXRjaFtpXSk7XG5cbiAgICAgICAgICAgIGlmIChjYWNoZWRbZXhwYW5kb10pIHtcbiAgICAgICAgICAgICAgc2V0TWF0Y2hlcnMucHVzaChjYWNoZWQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgZWxlbWVudE1hdGNoZXJzLnB1c2goY2FjaGVkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IC8vIENhY2hlIHRoZSBjb21waWxlZCBmdW5jdGlvblxuXG5cbiAgICAgICAgICBjYWNoZWQgPSBjb21waWxlckNhY2hlKHNlbGVjdG9yLCBtYXRjaGVyRnJvbUdyb3VwTWF0Y2hlcnMoZWxlbWVudE1hdGNoZXJzLCBzZXRNYXRjaGVycykpOyAvLyBTYXZlIHNlbGVjdG9yIGFuZCB0b2tlbml6YXRpb25cblxuICAgICAgICAgIGNhY2hlZC5zZWxlY3RvciA9IHNlbGVjdG9yO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGNhY2hlZDtcbiAgICAgIH07XG4gICAgICAvKipcbiAgICAgICAqIEEgbG93LWxldmVsIHNlbGVjdGlvbiBmdW5jdGlvbiB0aGF0IHdvcmtzIHdpdGggU2l6emxlJ3MgY29tcGlsZWRcbiAgICAgICAqICBzZWxlY3RvciBmdW5jdGlvbnNcbiAgICAgICAqIEBwYXJhbSB7U3RyaW5nfEZ1bmN0aW9ufSBzZWxlY3RvciBBIHNlbGVjdG9yIG9yIGEgcHJlLWNvbXBpbGVkXG4gICAgICAgKiAgc2VsZWN0b3IgZnVuY3Rpb24gYnVpbHQgd2l0aCBTaXp6bGUuY29tcGlsZVxuICAgICAgICogQHBhcmFtIHtFbGVtZW50fSBjb250ZXh0XG4gICAgICAgKiBAcGFyYW0ge0FycmF5fSBbcmVzdWx0c11cbiAgICAgICAqIEBwYXJhbSB7QXJyYXl9IFtzZWVkXSBBIHNldCBvZiBlbGVtZW50cyB0byBtYXRjaCBhZ2FpbnN0XG4gICAgICAgKi9cblxuXG4gICAgICBzZWxlY3QgPSBTaXp6bGUuc2VsZWN0ID0gZnVuY3Rpb24gKHNlbGVjdG9yLCBjb250ZXh0LCByZXN1bHRzLCBzZWVkKSB7XG4gICAgICAgIHZhciBpLFxuICAgICAgICAgICAgdG9rZW5zLFxuICAgICAgICAgICAgdG9rZW4sXG4gICAgICAgICAgICB0eXBlLFxuICAgICAgICAgICAgZmluZCxcbiAgICAgICAgICAgIGNvbXBpbGVkID0gdHlwZW9mIHNlbGVjdG9yID09PSBcImZ1bmN0aW9uXCIgJiYgc2VsZWN0b3IsXG4gICAgICAgICAgICBtYXRjaCA9ICFzZWVkICYmIHRva2VuaXplKHNlbGVjdG9yID0gY29tcGlsZWQuc2VsZWN0b3IgfHwgc2VsZWN0b3IpO1xuICAgICAgICByZXN1bHRzID0gcmVzdWx0cyB8fCBbXTsgLy8gVHJ5IHRvIG1pbmltaXplIG9wZXJhdGlvbnMgaWYgdGhlcmUgaXMgb25seSBvbmUgc2VsZWN0b3IgaW4gdGhlIGxpc3QgYW5kIG5vIHNlZWRcbiAgICAgICAgLy8gKHRoZSBsYXR0ZXIgb2Ygd2hpY2ggZ3VhcmFudGVlcyB1cyBjb250ZXh0KVxuXG4gICAgICAgIGlmIChtYXRjaC5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAvLyBSZWR1Y2UgY29udGV4dCBpZiB0aGUgbGVhZGluZyBjb21wb3VuZCBzZWxlY3RvciBpcyBhbiBJRFxuICAgICAgICAgIHRva2VucyA9IG1hdGNoWzBdID0gbWF0Y2hbMF0uc2xpY2UoMCk7XG5cbiAgICAgICAgICBpZiAodG9rZW5zLmxlbmd0aCA+IDIgJiYgKHRva2VuID0gdG9rZW5zWzBdKS50eXBlID09PSBcIklEXCIgJiYgY29udGV4dC5ub2RlVHlwZSA9PT0gOSAmJiBkb2N1bWVudElzSFRNTCAmJiBFeHByLnJlbGF0aXZlW3Rva2Vuc1sxXS50eXBlXSkge1xuICAgICAgICAgICAgY29udGV4dCA9IChFeHByLmZpbmRbXCJJRFwiXSh0b2tlbi5tYXRjaGVzWzBdLnJlcGxhY2UocnVuZXNjYXBlLCBmdW5lc2NhcGUpLCBjb250ZXh0KSB8fCBbXSlbMF07XG5cbiAgICAgICAgICAgIGlmICghY29udGV4dCkge1xuICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0czsgLy8gUHJlY29tcGlsZWQgbWF0Y2hlcnMgd2lsbCBzdGlsbCB2ZXJpZnkgYW5jZXN0cnksIHNvIHN0ZXAgdXAgYSBsZXZlbFxuICAgICAgICAgICAgfSBlbHNlIGlmIChjb21waWxlZCkge1xuICAgICAgICAgICAgICBjb250ZXh0ID0gY29udGV4dC5wYXJlbnROb2RlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzZWxlY3RvciA9IHNlbGVjdG9yLnNsaWNlKHRva2Vucy5zaGlmdCgpLnZhbHVlLmxlbmd0aCk7XG4gICAgICAgICAgfSAvLyBGZXRjaCBhIHNlZWQgc2V0IGZvciByaWdodC10by1sZWZ0IG1hdGNoaW5nXG5cblxuICAgICAgICAgIGkgPSBtYXRjaEV4cHJbXCJuZWVkc0NvbnRleHRcIl0udGVzdChzZWxlY3RvcikgPyAwIDogdG9rZW5zLmxlbmd0aDtcblxuICAgICAgICAgIHdoaWxlIChpLS0pIHtcbiAgICAgICAgICAgIHRva2VuID0gdG9rZW5zW2ldOyAvLyBBYm9ydCBpZiB3ZSBoaXQgYSBjb21iaW5hdG9yXG5cbiAgICAgICAgICAgIGlmIChFeHByLnJlbGF0aXZlW3R5cGUgPSB0b2tlbi50eXBlXSkge1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGZpbmQgPSBFeHByLmZpbmRbdHlwZV0pIHtcbiAgICAgICAgICAgICAgLy8gU2VhcmNoLCBleHBhbmRpbmcgY29udGV4dCBmb3IgbGVhZGluZyBzaWJsaW5nIGNvbWJpbmF0b3JzXG4gICAgICAgICAgICAgIGlmIChzZWVkID0gZmluZCh0b2tlbi5tYXRjaGVzWzBdLnJlcGxhY2UocnVuZXNjYXBlLCBmdW5lc2NhcGUpLCByc2libGluZy50ZXN0KHRva2Vuc1swXS50eXBlKSAmJiB0ZXN0Q29udGV4dChjb250ZXh0LnBhcmVudE5vZGUpIHx8IGNvbnRleHQpKSB7XG4gICAgICAgICAgICAgICAgLy8gSWYgc2VlZCBpcyBlbXB0eSBvciBubyB0b2tlbnMgcmVtYWluLCB3ZSBjYW4gcmV0dXJuIGVhcmx5XG4gICAgICAgICAgICAgICAgdG9rZW5zLnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgICAgICBzZWxlY3RvciA9IHNlZWQubGVuZ3RoICYmIHRvU2VsZWN0b3IodG9rZW5zKTtcblxuICAgICAgICAgICAgICAgIGlmICghc2VsZWN0b3IpIHtcbiAgICAgICAgICAgICAgICAgIHB1c2guYXBwbHkocmVzdWx0cywgc2VlZCk7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSAvLyBDb21waWxlIGFuZCBleGVjdXRlIGEgZmlsdGVyaW5nIGZ1bmN0aW9uIGlmIG9uZSBpcyBub3QgcHJvdmlkZWRcbiAgICAgICAgLy8gUHJvdmlkZSBgbWF0Y2hgIHRvIGF2b2lkIHJldG9rZW5pemF0aW9uIGlmIHdlIG1vZGlmaWVkIHRoZSBzZWxlY3RvciBhYm92ZVxuXG5cbiAgICAgICAgKGNvbXBpbGVkIHx8IGNvbXBpbGUoc2VsZWN0b3IsIG1hdGNoKSkoc2VlZCwgY29udGV4dCwgIWRvY3VtZW50SXNIVE1MLCByZXN1bHRzLCAhY29udGV4dCB8fCByc2libGluZy50ZXN0KHNlbGVjdG9yKSAmJiB0ZXN0Q29udGV4dChjb250ZXh0LnBhcmVudE5vZGUpIHx8IGNvbnRleHQpO1xuICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICAgIH07IC8vIE9uZS10aW1lIGFzc2lnbm1lbnRzXG4gICAgICAvLyBTb3J0IHN0YWJpbGl0eVxuXG5cbiAgICAgIHN1cHBvcnQuc29ydFN0YWJsZSA9IGV4cGFuZG8uc3BsaXQoXCJcIikuc29ydChzb3J0T3JkZXIpLmpvaW4oXCJcIikgPT09IGV4cGFuZG87IC8vIFN1cHBvcnQ6IENocm9tZSAxNC0zNStcbiAgICAgIC8vIEFsd2F5cyBhc3N1bWUgZHVwbGljYXRlcyBpZiB0aGV5IGFyZW4ndCBwYXNzZWQgdG8gdGhlIGNvbXBhcmlzb24gZnVuY3Rpb25cblxuICAgICAgc3VwcG9ydC5kZXRlY3REdXBsaWNhdGVzID0gISFoYXNEdXBsaWNhdGU7IC8vIEluaXRpYWxpemUgYWdhaW5zdCB0aGUgZGVmYXVsdCBkb2N1bWVudFxuXG4gICAgICBzZXREb2N1bWVudCgpOyAvLyBTdXBwb3J0OiBXZWJraXQ8NTM3LjMyIC0gU2FmYXJpIDYuMC4zL0Nocm9tZSAyNSAoZml4ZWQgaW4gQ2hyb21lIDI3KVxuICAgICAgLy8gRGV0YWNoZWQgbm9kZXMgY29uZm91bmRpbmdseSBmb2xsb3cgKmVhY2ggb3RoZXIqXG5cbiAgICAgIHN1cHBvcnQuc29ydERldGFjaGVkID0gYXNzZXJ0KGZ1bmN0aW9uIChlbCkge1xuICAgICAgICAvLyBTaG91bGQgcmV0dXJuIDEsIGJ1dCByZXR1cm5zIDQgKGZvbGxvd2luZylcbiAgICAgICAgcmV0dXJuIGVsLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJmaWVsZHNldFwiKSkgJiAxO1xuICAgICAgfSk7IC8vIFN1cHBvcnQ6IElFPDhcbiAgICAgIC8vIFByZXZlbnQgYXR0cmlidXRlL3Byb3BlcnR5IFwiaW50ZXJwb2xhdGlvblwiXG4gICAgICAvLyBodHRwczovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L21zNTM2NDI5JTI4VlMuODUlMjkuYXNweFxuXG4gICAgICBpZiAoIWFzc2VydChmdW5jdGlvbiAoZWwpIHtcbiAgICAgICAgZWwuaW5uZXJIVE1MID0gQUdQb2xpY3kuY3JlYXRlSFRNTChcIjxhIGhyZWY9JyMnPjwvYT5cIik7XG4gICAgICAgIHJldHVybiBlbC5maXJzdENoaWxkLmdldEF0dHJpYnV0ZShcImhyZWZcIikgPT09IFwiI1wiO1xuICAgICAgfSkpIHtcbiAgICAgICAgYWRkSGFuZGxlKFwidHlwZXxocmVmfGhlaWdodHx3aWR0aFwiLCBmdW5jdGlvbiAoZWxlbSwgbmFtZSwgaXNYTUwpIHtcbiAgICAgICAgICBpZiAoIWlzWE1MKSB7XG4gICAgICAgICAgICByZXR1cm4gZWxlbS5nZXRBdHRyaWJ1dGUobmFtZSwgbmFtZS50b0xvd2VyQ2FzZSgpID09PSBcInR5cGVcIiA/IDEgOiAyKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSAvLyBTdXBwb3J0OiBJRTw5XG4gICAgICAvLyBVc2UgZGVmYXVsdFZhbHVlIGluIHBsYWNlIG9mIGdldEF0dHJpYnV0ZShcInZhbHVlXCIpXG5cblxuICAgICAgaWYgKCFzdXBwb3J0LmF0dHJpYnV0ZXMgfHwgIWFzc2VydChmdW5jdGlvbiAoZWwpIHtcbiAgICAgICAgZWwuaW5uZXJIVE1MID0gQUdQb2xpY3kuY3JlYXRlSFRNTChcIjxpbnB1dC8+XCIpO1xuICAgICAgICBlbC5maXJzdENoaWxkLnNldEF0dHJpYnV0ZShcInZhbHVlXCIsIFwiXCIpO1xuICAgICAgICByZXR1cm4gZWwuZmlyc3RDaGlsZC5nZXRBdHRyaWJ1dGUoXCJ2YWx1ZVwiKSA9PT0gXCJcIjtcbiAgICAgIH0pKSB7XG4gICAgICAgIGFkZEhhbmRsZShcInZhbHVlXCIsIGZ1bmN0aW9uIChlbGVtLCBuYW1lLCBpc1hNTCkge1xuICAgICAgICAgIGlmICghaXNYTUwgJiYgZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSBcImlucHV0XCIpIHtcbiAgICAgICAgICAgIHJldHVybiBlbGVtLmRlZmF1bHRWYWx1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSAvLyBTdXBwb3J0OiBJRTw5XG4gICAgICAvLyBVc2UgZ2V0QXR0cmlidXRlTm9kZSB0byBmZXRjaCBib29sZWFucyB3aGVuIGdldEF0dHJpYnV0ZSBsaWVzXG5cblxuICAgICAgaWYgKCFhc3NlcnQoZnVuY3Rpb24gKGVsKSB7XG4gICAgICAgIHJldHVybiBlbC5nZXRBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiKSA9PSBudWxsO1xuICAgICAgfSkpIHtcbiAgICAgICAgYWRkSGFuZGxlKGJvb2xlYW5zLCBmdW5jdGlvbiAoZWxlbSwgbmFtZSwgaXNYTUwpIHtcbiAgICAgICAgICB2YXIgdmFsO1xuXG4gICAgICAgICAgaWYgKCFpc1hNTCkge1xuICAgICAgICAgICAgcmV0dXJuIGVsZW1bbmFtZV0gPT09IHRydWUgPyBuYW1lLnRvTG93ZXJDYXNlKCkgOiAodmFsID0gZWxlbS5nZXRBdHRyaWJ1dGVOb2RlKG5hbWUpKSAmJiB2YWwuc3BlY2lmaWVkID8gdmFsLnZhbHVlIDogbnVsbDtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSAvLyBFWFBPU0VcbiAgICAgIC8vIERvIG5vdCBleHBvc2UgU2l6emxlIHRvIHRoZSBnbG9iYWwgc2NvcGUgaW4gdGhlIGNhc2Ugb2YgQWRHdWFyZCBFeHRlbmRlZENzcyBidWlsZFxuXG5cbiAgICAgIHJldHVybiBTaXp6bGU7IC8vIEVYUE9TRVxuICAgIH0od2luZG93KTsgLy8+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj5cblxuICB9XG5cbiAgcmV0dXJuIFNpenpsZTtcbn07XG5cbi8qIGpzaGludCBpZ25vcmU6ZW5kICovXG5cbi8qKlxuICogQ29weXJpZ2h0IDIwMTYgQWRndWFyZCBTb2Z0d2FyZSBMdGRcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBDbGFzcyB0aGF0IGV4dGVuZHMgU2l6emxlIGFuZCBhZGRzIHN1cHBvcnQgZm9yIFwibWF0Y2hlcy1jc3NcIiBwc2V1ZG8gZWxlbWVudC5cbiAqL1xuXG52YXIgU3R5bGVQcm9wZXJ0eU1hdGNoZXIgPSBmdW5jdGlvbiAod2luZG93KSB7XG4gIHZhciBpc1BoYW50b20gPSAhIXdpbmRvdy5fcGhhbnRvbTtcbiAgdmFyIHVzZUZhbGxiYWNrID0gaXNQaGFudG9tICYmICEhd2luZG93LmdldE1hdGNoZWRDU1NSdWxlcztcbiAgLyoqXG4gICAqIFVucXVvdGVzIHNwZWNpZmllZCB2YWx1ZVxuICAgKiBXZWJraXQtYmFzZWQgYnJvd3NlcnMgc2luZ2xlcXVvdGVzIDxzdHJpbmc+IGNvbnRlbnQgcHJvcGVydHkgdmFsdWVzXG4gICAqIE90aGVyIGJyb3dzZXJzIGRvdWJsZXF1b3RlcyBjb250ZW50IHByb3BlcnR5IHZhbHVlcy5cbiAgICovXG5cbiAgdmFyIHJlbW92ZUNvbnRlbnRRdW90ZXMgPSBmdW5jdGlvbiByZW1vdmVDb250ZW50UXVvdGVzKHZhbHVlKSB7XG4gICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgIHJldHVybiB2YWx1ZS5yZXBsYWNlKC9eKFtcIiddKShbXFxzXFxTXSopXFwxJC8sICckMicpO1xuICAgIH1cblxuICAgIHJldHVybiB2YWx1ZTtcbiAgfTtcblxuICB2YXIgZ2V0Q29tcHV0ZWRTdHlsZSA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlLmJpbmQod2luZG93KTtcbiAgdmFyIGdldE1hdGNoZWRDU1NSdWxlcyA9IHVzZUZhbGxiYWNrID8gd2luZG93LmdldE1hdGNoZWRDU1NSdWxlcy5iaW5kKHdpbmRvdykgOiBudWxsO1xuICAvKipcbiAgICogVGhlcmUgaXMgYW4gaXNzdWUgaW4gYnJvd3NlcnMgYmFzZWQgb24gb2xkIHdlYmtpdDpcbiAgICogZ2V0Q29tcHV0ZWRTdHlsZShlbCwgXCI6YmVmb3JlXCIpIGlzIGVtcHR5IGlmIGVsZW1lbnQgaXMgbm90IHZpc2libGUuXG4gICAqXG4gICAqIFRvIGNpcmN1bXZlbnQgdGhpcyBpc3N1ZSB3ZSB1c2UgZ2V0TWF0Y2hlZENTU1J1bGVzIGluc3RlYWQuXG4gICAqXG4gICAqIEl0IGFwcGVhcnMgdGhhdCBnZXRNYXRjaGVkQ1NTUnVsZXMgc29ydHMgdGhlIENTUyBydWxlc1xuICAgKiBpbiBpbmNyZWFzaW5nIG9yZGVyIG9mIHNwZWNpZml0aWVzIG9mIGNvcnJlc3BvbmRpbmcgc2VsZWN0b3JzLlxuICAgKiBXZSBwaWNrIHRoZSBjc3MgcnVsZSB0aGF0IGlzIGJlaW5nIGFwcGxpZWQgdG8gYW4gZWxlbWVudCBiYXNlZCBvbiB0aGlzIGFzc3VtcHRpb24uXG4gICAqXG4gICAqIEBwYXJhbSBlbGVtZW50ICAgICAgIERPTSBub2RlXG4gICAqIEBwYXJhbSBwc2V1ZG9FbGVtZW50IE9wdGlvbmFsIHBzZXVkb0VsZW1lbnQgbmFtZVxuICAgKiBAcGFyYW0gcHJvcGVydHlOYW1lICBDU1MgcHJvcGVydHkgbmFtZVxuICAgKi9cblxuICB2YXIgZ2V0Q29tcHV0ZWRTdHlsZVByb3BlcnR5VmFsdWUgPSBmdW5jdGlvbiBnZXRDb21wdXRlZFN0eWxlUHJvcGVydHlWYWx1ZShlbGVtZW50LCBwc2V1ZG9FbGVtZW50LCBwcm9wZXJ0eU5hbWUpIHtcbiAgICB2YXIgdmFsdWUgPSAnJztcblxuICAgIGlmICh1c2VGYWxsYmFjayAmJiBwc2V1ZG9FbGVtZW50KSB7XG4gICAgICB2YXIgY3NzUnVsZXMgPSBnZXRNYXRjaGVkQ1NTUnVsZXMoZWxlbWVudCwgcHNldWRvRWxlbWVudCkgfHwgW107XG4gICAgICB2YXIgaSA9IGNzc1J1bGVzLmxlbmd0aDtcblxuICAgICAgd2hpbGUgKGktLSA+IDAgJiYgIXZhbHVlKSB7XG4gICAgICAgIHZhbHVlID0gY3NzUnVsZXNbaV0uc3R5bGUuZ2V0UHJvcGVydHlWYWx1ZShwcm9wZXJ0eU5hbWUpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgc3R5bGUgPSBnZXRDb21wdXRlZFN0eWxlKGVsZW1lbnQsIHBzZXVkb0VsZW1lbnQpO1xuXG4gICAgICBpZiAoc3R5bGUpIHtcbiAgICAgICAgdmFsdWUgPSBzdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKHByb3BlcnR5TmFtZSk7IC8vIGh0dHBzOi8vYnVncy53ZWJraXQub3JnL3Nob3dfYnVnLmNnaT9pZD05MzQ0NVxuXG4gICAgICAgIGlmIChwcm9wZXJ0eU5hbWUgPT09ICdvcGFjaXR5JyAmJiB1dGlscy5pc1NhZmFyaUJyb3dzZXIpIHtcbiAgICAgICAgICB2YWx1ZSA9IChNYXRoLnJvdW5kKHBhcnNlRmxvYXQodmFsdWUpICogMTAwKSAvIDEwMCkudG9TdHJpbmcoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChwcm9wZXJ0eU5hbWUgPT09ICdjb250ZW50Jykge1xuICAgICAgdmFsdWUgPSByZW1vdmVDb250ZW50UXVvdGVzKHZhbHVlKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdmFsdWU7XG4gIH07XG4gIC8qKlxuICAgKiBBZGRzIHVybCBwYXJhbWV0ZXIgcXVvdGVzIGZvciBub24tcmVnZXggcGF0dGVyblxuICAgKiBAcGFyYW0ge3N0cmluZ30gcGF0dGVyblxuICAgKi9cblxuXG4gIHZhciBhZGRVcmxRdW90ZXMgPSBmdW5jdGlvbiBhZGRVcmxRdW90ZXMocGF0dGVybikge1xuICAgIC8vIGZvciByZWdleCBwYXR0ZXJuc1xuICAgIGlmIChwYXR0ZXJuWzBdID09PSAnLycgJiYgcGF0dGVybltwYXR0ZXJuLmxlbmd0aCAtIDFdID09PSAnLycgJiYgcGF0dGVybi5pbmRleE9mKCdcXFxcXCInKSA8IDEwKSB7XG4gICAgICAvLyBlLmcuIC9edXJsXFxcXChbYS16XXs0fTpbYS16XXs1fS9cbiAgICAgIC8vIG9yIC9edXJsXFxcXChkYXRhXFxcXDpcXFxcaW1hZ2VcXFxcL2dpZjtiYXNlNjQuKy9cbiAgICAgIHZhciByZSA9IC8oXFxeKT91cmwoXFxcXCk/XFxcXFxcKChcXHd8XFxbXFx3KS9nO1xuICAgICAgcmV0dXJuIHBhdHRlcm4ucmVwbGFjZShyZSwgJyQxdXJsJDJcXFxcXFwoXFxcXFwiPyQzJyk7XG4gICAgfSAvLyBmb3Igbm9uLXJlZ2V4IHBhdHRlcm5zXG5cblxuICAgIGlmIChwYXR0ZXJuLmluZGV4T2YoJ3VybChcIicpID09PSAtMSkge1xuICAgICAgdmFyIF9yZSA9IC91cmxcXCgoLio/KVxcKS9nO1xuICAgICAgcmV0dXJuIHBhdHRlcm4ucmVwbGFjZShfcmUsICd1cmwoXCIkMVwiKScpO1xuICAgIH1cblxuICAgIHJldHVybiBwYXR0ZXJuO1xuICB9O1xuICAvKipcbiAgICogQ2xhc3MgdGhhdCBtYXRjaGVzIGVsZW1lbnQgc3R5bGUgYWdhaW5zdCB0aGUgc3BlY2lmaWVkIGV4cHJlc3Npb25cbiAgICogQG1lbWJlciB7c3RyaW5nfSBwcm9wZXJ0eU5hbWVcbiAgICogQG1lbWJlciB7c3RyaW5nfSBwc2V1ZG9FbGVtZW50XG4gICAqIEBtZW1iZXIge1JlZ0V4cH0gcmVnZXhcbiAgICovXG5cblxuICB2YXIgTWF0Y2hlciA9IGZ1bmN0aW9uIE1hdGNoZXIocHJvcGVydHlGaWx0ZXIsIHBzZXVkb0VsZW1lbnQpIHtcbiAgICB0aGlzLnBzZXVkb0VsZW1lbnQgPSBwc2V1ZG9FbGVtZW50O1xuXG4gICAgdHJ5IHtcbiAgICAgIHZhciBpbmRleCA9IHByb3BlcnR5RmlsdGVyLmluZGV4T2YoJzonKTtcbiAgICAgIHRoaXMucHJvcGVydHlOYW1lID0gcHJvcGVydHlGaWx0ZXIuc3Vic3RyaW5nKDAsIGluZGV4KS50cmltKCk7XG4gICAgICB2YXIgcGF0dGVybiA9IHByb3BlcnR5RmlsdGVyLnN1YnN0cmluZyhpbmRleCArIDEpLnRyaW0oKTtcbiAgICAgIHBhdHRlcm4gPSBhZGRVcmxRdW90ZXMocGF0dGVybik7IC8vIFVuZXNjYXBpbmcgcGF0dGVyblxuICAgICAgLy8gRm9yIG5vbi1yZWdleCBwYXR0ZXJucywgKCwpLFssXSBzaG91bGQgYmUgdW5lc2NhcGVkLCBiZWNhdXNlIHdlIHJlcXVpcmUgZXNjYXBpbmcgdGhlbSBpbiBmaWx0ZXIgcnVsZXMuXG4gICAgICAvLyBGb3IgcmVnZXggcGF0dGVybnMsIFwiLFxcIHNob3VsZCBiZSBlc2NhcGVkLCBiZWNhdXNlIHdlIG1hbnVhbGx5IGVzY2FwZSB0aG9zZSBpbiBleHRlbmRlZC1jc3Mtc2VsZWN0b3IuanMuXG5cbiAgICAgIGlmICgvXlxcLy4qXFwvJC8udGVzdChwYXR0ZXJuKSkge1xuICAgICAgICBwYXR0ZXJuID0gcGF0dGVybi5zbGljZSgxLCAtMSk7XG4gICAgICAgIHRoaXMucmVnZXggPSB1dGlscy5wc2V1ZG9BcmdUb1JlZ2V4KHBhdHRlcm4pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcGF0dGVybiA9IHBhdHRlcm4ucmVwbGFjZSgvXFxcXChbXFxcXCgpW1xcXVwiXSkvZywgJyQxJyk7XG4gICAgICAgIHRoaXMucmVnZXggPSB1dGlscy5jcmVhdGVVUkxSZWdleChwYXR0ZXJuKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChleCkge1xuICAgICAgdXRpbHMubG9nRXJyb3IoXCJTdHlsZVByb3BlcnR5TWF0Y2hlcjogaW52YWxpZCBtYXRjaCBzdHJpbmcgXCIuY29uY2F0KHByb3BlcnR5RmlsdGVyKSk7XG4gICAgfVxuICB9O1xuICAvKipcbiAgICogRnVuY3Rpb24gdG8gY2hlY2sgaWYgZWxlbWVudCBDU1MgcHJvcGVydHkgbWF0Y2hlcyBmaWx0ZXIgcGF0dGVyblxuICAgKiBAcGFyYW0ge0VsZW1lbnR9IGVsZW1lbnQgdG8gY2hlY2tcbiAgICovXG5cblxuICBNYXRjaGVyLnByb3RvdHlwZS5tYXRjaGVzID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICBpZiAoIXRoaXMucmVnZXggfHwgIXRoaXMucHJvcGVydHlOYW1lKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgdmFyIHZhbHVlID0gZ2V0Q29tcHV0ZWRTdHlsZVByb3BlcnR5VmFsdWUoZWxlbWVudCwgdGhpcy5wc2V1ZG9FbGVtZW50LCB0aGlzLnByb3BlcnR5TmFtZSk7XG4gICAgcmV0dXJuIHZhbHVlICYmIHRoaXMucmVnZXgudGVzdCh2YWx1ZSk7XG4gIH07XG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgbmV3IHBzZXVkby1jbGFzcyBhbmQgcmVnaXN0ZXJzIGl0IGluIFNpenpsZVxuICAgKi9cblxuXG4gIHZhciBleHRlbmRTaXp6bGUgPSBmdW5jdGlvbiBleHRlbmRTaXp6bGUoc2l6emxlKSB7XG4gICAgLy8gRmlyc3Qgb2YgYWxsIHdlIHNob3VsZCBwcmVwYXJlIFNpenpsZSBlbmdpbmVcbiAgICBzaXp6bGUuc2VsZWN0b3JzLnBzZXVkb3NbJ21hdGNoZXMtY3NzJ10gPSBzaXp6bGUuc2VsZWN0b3JzLmNyZWF0ZVBzZXVkbyhmdW5jdGlvbiAocHJvcGVydHlGaWx0ZXIpIHtcbiAgICAgIHZhciBtYXRjaGVyID0gbmV3IE1hdGNoZXIocHJvcGVydHlGaWx0ZXIpO1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgIHJldHVybiBtYXRjaGVyLm1hdGNoZXMoZWxlbWVudCk7XG4gICAgICB9O1xuICAgIH0pO1xuICAgIHNpenpsZS5zZWxlY3RvcnMucHNldWRvc1snbWF0Y2hlcy1jc3MtYmVmb3JlJ10gPSBzaXp6bGUuc2VsZWN0b3JzLmNyZWF0ZVBzZXVkbyhmdW5jdGlvbiAocHJvcGVydHlGaWx0ZXIpIHtcbiAgICAgIHZhciBtYXRjaGVyID0gbmV3IE1hdGNoZXIocHJvcGVydHlGaWx0ZXIsICc6YmVmb3JlJyk7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIG1hdGNoZXIubWF0Y2hlcyhlbGVtZW50KTtcbiAgICAgIH07XG4gICAgfSk7XG4gICAgc2l6emxlLnNlbGVjdG9ycy5wc2V1ZG9zWydtYXRjaGVzLWNzcy1hZnRlciddID0gc2l6emxlLnNlbGVjdG9ycy5jcmVhdGVQc2V1ZG8oZnVuY3Rpb24gKHByb3BlcnR5RmlsdGVyKSB7XG4gICAgICB2YXIgbWF0Y2hlciA9IG5ldyBNYXRjaGVyKHByb3BlcnR5RmlsdGVyLCAnOmFmdGVyJyk7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIG1hdGNoZXIubWF0Y2hlcyhlbGVtZW50KTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH07IC8vIEVYUE9TRVxuXG5cbiAgcmV0dXJuIHtcbiAgICBleHRlbmRTaXp6bGU6IGV4dGVuZFNpenpsZVxuICB9O1xufSh3aW5kb3cpO1xuXG4vKipcbiAqIENvcHlyaWdodCAyMDE2IEFkZ3VhcmQgU29mdHdhcmUgTHRkXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbnZhciBtYXRjaGVyVXRpbHMgPSB7fTtcbm1hdGNoZXJVdGlscy5NdXRhdGlvbk9ic2VydmVyID0gd2luZG93Lk11dGF0aW9uT2JzZXJ2ZXIgfHwgd2luZG93LldlYktpdE11dGF0aW9uT2JzZXJ2ZXI7XG4vKipcbiAqIFBhcnNlcyBhcmd1bWVudCBvZiBtYXRjaGVyIHBzZXVkbyAoZm9yIG1hdGNoZXMtYXR0ciBhbmQgbWF0Y2hlcy1wcm9wZXJ0eSlcbiAqIEBwYXJhbSB7c3RyaW5nfSBtYXRjaGVyRmlsdGVyIGFyZ3VtZW50IG9mIHBzZXVkbyBjbGFzc1xuICogQHJldHVybnMge0FycmF5fVxuICovXG5cbm1hdGNoZXJVdGlscy5wYXJzZU1hdGNoZXJGaWx0ZXIgPSBmdW5jdGlvbiAobWF0Y2hlckZpbHRlcikge1xuICB2YXIgRlVMTF9NQVRDSF9NQVJLRVIgPSAnXCI9XCInO1xuICB2YXIgcmF3QXJncyA9IFtdO1xuXG4gIGlmIChtYXRjaGVyRmlsdGVyLmluZGV4T2YoRlVMTF9NQVRDSF9NQVJLRVIpID09PSAtMSkge1xuICAgIC8vIGlmIHRoZXJlIGlzIG9ubHkgb25lIHBzZXVkbyBhcmdcbiAgICAvLyBlLmcuIDptYXRjaGVzLWF0dHIoXCJkYXRhLW5hbWVcIikgb3IgOm1hdGNoZXMtcHJvcGVydHkoXCJpbm5lci5wcm9wXCIpXG4gICAgLy8gU2l6emxlIHdpbGwgcGFyc2UgaXQgYW5kIGdldCByaWQgb2YgcXVvdGVzXG4gICAgLy8gc28gaXQgbWlnaHQgYmUgdmFsaWQgYXJnIGFscmVhZHkgd2l0aG91dCB0aGVtXG4gICAgcmF3QXJncy5wdXNoKG1hdGNoZXJGaWx0ZXIpO1xuICB9IGVsc2Uge1xuICAgIG1hdGNoZXJGaWx0ZXIuc3BsaXQoJz0nKS5mb3JFYWNoKGZ1bmN0aW9uIChhcmcpIHtcbiAgICAgIGlmIChhcmdbMF0gPT09ICdcIicgJiYgYXJnW2FyZy5sZW5ndGggLSAxXSA9PT0gJ1wiJykge1xuICAgICAgICByYXdBcmdzLnB1c2goYXJnLnNsaWNlKDEsIC0xKSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4gcmF3QXJncztcbn07XG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IEFyZ0RhdGFcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBhcmdcbiAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gaXNSZWdleHBcbiAqL1xuXG4vKipcbiAqIFBhcnNlcyByYXcgbWF0Y2hlciBhcmdcbiAqIEBwYXJhbSB7c3RyaW5nfSByYXdBcmdcbiAqIEByZXR1cm5zIHtBcmdEYXRhfVxuICovXG5cblxubWF0Y2hlclV0aWxzLnBhcnNlUmF3TWF0Y2hlckFyZyA9IGZ1bmN0aW9uIChyYXdBcmcpIHtcbiAgdmFyIGFyZyA9IHJhd0FyZztcbiAgdmFyIGlzUmVnZXhwID0gISFyYXdBcmcgJiYgcmF3QXJnWzBdID09PSAnLycgJiYgcmF3QXJnW3Jhd0FyZy5sZW5ndGggLSAxXSA9PT0gJy8nO1xuXG4gIGlmIChpc1JlZ2V4cCkge1xuICAgIC8vIHRvIGF2b2lkIGF0IGxlYXN0IHN1Y2ggY2FzZSDigJQgOm1hdGNoZXMtcHJvcGVydHkoXCIvL1wiKVxuICAgIGlmIChyYXdBcmcubGVuZ3RoID4gMikge1xuICAgICAgYXJnID0gdXRpbHMudG9SZWdFeHAocmF3QXJnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCByZWdleHA6IFwiLmNvbmNhdChyYXdBcmcpKTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4ge1xuICAgIGFyZzogYXJnLFxuICAgIGlzUmVnZXhwOiBpc1JlZ2V4cFxuICB9O1xufTtcbi8qKlxuICogQHR5cGVkZWYgQ2hhaW5cbiAqIEBwcm9wZXJ0eSB7T2JqZWN0fSBiYXNlXG4gKiBAcHJvcGVydHkge3N0cmluZ30gcHJvcFxuICogQHByb3BlcnR5IHtzdHJpbmd9IHZhbHVlXG4gKi9cblxuLyoqXG4gKiBDaGVja3MgaWYgdGhlIHByb3BlcnR5IGV4aXN0cyBpbiB0aGUgYmFzZSBvYmplY3QgKHJlY3Vyc2l2ZWx5KS5cbiAqIEBwYXJhbSB7T2JqZWN0fSBiYXNlXG4gKiBAcGFyYW0ge0FyZ0RhdGFbXX0gY2hhaW4gYXJyYXkgb2Ygb2JqZWN0cyAtIHBhcnNlZCBzdHJpbmcgcHJvcGVydHkgY2hhaW5cbiAqIEBwYXJhbSB7QXJyYXl9IFtvdXRwdXQ9W11dIHJlc3VsdCBhY2NcbiAqIEByZXR1cm5zIHtDaGFpbltdfSBhcnJheSBvZiBvYmplY3RzXG4gKi9cblxuXG5tYXRjaGVyVXRpbHMuZmlsdGVyUm9vdHNCeVJlZ2V4cENoYWluID0gZnVuY3Rpb24gKGJhc2UsIGNoYWluKSB7XG4gIHZhciBvdXRwdXQgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IFtdO1xuICB2YXIgdGVtcFByb3AgPSBjaGFpblswXTtcblxuICBpZiAoY2hhaW4ubGVuZ3RoID09PSAxKSB7XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXJlc3RyaWN0ZWQtc3ludGF4XG4gICAgZm9yICh2YXIga2V5IGluIGJhc2UpIHtcbiAgICAgIGlmICh0ZW1wUHJvcC5pc1JlZ2V4cCkge1xuICAgICAgICBpZiAodGVtcFByb3AuYXJnLnRlc3Qoa2V5KSkge1xuICAgICAgICAgIG91dHB1dC5wdXNoKHtcbiAgICAgICAgICAgIGJhc2U6IGJhc2UsXG4gICAgICAgICAgICBwcm9wOiBrZXksXG4gICAgICAgICAgICB2YWx1ZTogYmFzZVtrZXldXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAodGVtcFByb3AuYXJnID09PSBrZXkpIHtcbiAgICAgICAgb3V0cHV0LnB1c2goe1xuICAgICAgICAgIGJhc2U6IGJhc2UsXG4gICAgICAgICAgcHJvcDogdGVtcFByb3AuYXJnLFxuICAgICAgICAgIHZhbHVlOiBiYXNlW2tleV1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIG91dHB1dDtcbiAgfSAvLyBpZiB0aGVyZSBpcyBhIHJlZ2V4cCBwcm9wIGluIGlucHV0IGNoYWluXG4gIC8vIGUuZy4gJ3VuaXQuL15hZC4rLy5zcmMnIGZvciAndW5pdC5hZC0xZ2YyLnNyYyB1bml0LmFkLWZnZDM0LnNyYycpLFxuICAvLyBldmVyeSBiYXNlIGtleXMgc2hvdWxkIGJlIHRlc3RlZCBieSByZWdleHAgYW5kIGl0IGNhbiBiZSBtb3JlIHRoYXQgb25lIHJlc3VsdHNcblxuXG4gIGlmICh0ZW1wUHJvcC5pc1JlZ2V4cCkge1xuICAgIHZhciBuZXh0UHJvcCA9IGNoYWluLnNsaWNlKDEpO1xuICAgIHZhciBiYXNlS2V5cyA9IFtdOyAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcmVzdHJpY3RlZC1zeW50YXhcblxuICAgIGZvciAodmFyIF9rZXkgaW4gYmFzZSkge1xuICAgICAgaWYgKHRlbXBQcm9wLmFyZy50ZXN0KF9rZXkpKSB7XG4gICAgICAgIGJhc2VLZXlzLnB1c2goX2tleSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgYmFzZUtleXMuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICB2YXIgaXRlbSA9IGJhc2Vba2V5XTtcbiAgICAgIG1hdGNoZXJVdGlscy5maWx0ZXJSb290c0J5UmVnZXhwQ2hhaW4oaXRlbSwgbmV4dFByb3AsIG91dHB1dCk7XG4gICAgfSk7XG4gIH0gLy8gYXZvaWQgVHlwZUVycm9yIHdoaWxlIGFjY2Vzc2luZyB0byBudWxsLXByb3AncyBjaGlsZFxuXG5cbiAgaWYgKGJhc2UgPT09IG51bGwpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgbmV4dEJhc2UgPSBiYXNlW3RlbXBQcm9wLmFyZ107XG4gIGNoYWluID0gY2hhaW4uc2xpY2UoMSk7XG5cbiAgaWYgKG5leHRCYXNlICE9PSB1bmRlZmluZWQpIHtcbiAgICBtYXRjaGVyVXRpbHMuZmlsdGVyUm9vdHNCeVJlZ2V4cENoYWluKG5leHRCYXNlLCBjaGFpbiwgb3V0cHV0KTtcbiAgfVxuXG4gIHJldHVybiBvdXRwdXQ7XG59O1xuLyoqXG4gKiBWYWxpZGF0ZXMgcGFyc2VkIGFyZ3Mgb2YgbWF0Y2hlcy1wcm9wZXJ0eSBwc2V1ZG9cbiAqIEBwYXJhbSB7Li4uQXJnRGF0YX0gYXJnc1xuICovXG5cblxubWF0Y2hlclV0aWxzLnZhbGlkYXRlUHJvcE1hdGNoZXJBcmdzID0gZnVuY3Rpb24gKCkge1xuICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShfbGVuKSwgX2tleTIgPSAwOyBfa2V5MiA8IF9sZW47IF9rZXkyKyspIHtcbiAgICBhcmdzW19rZXkyXSA9IGFyZ3VtZW50c1tfa2V5Ml07XG4gIH1cblxuICBmb3IgKHZhciBpID0gMDsgaSA8IGFyZ3MubGVuZ3RoOyBpICs9IDEpIHtcbiAgICBpZiAoYXJnc1tpXS5pc1JlZ2V4cCkge1xuICAgICAgaWYgKCF1dGlscy5zdGFydHNXaXRoKGFyZ3NbaV0uYXJnLnRvU3RyaW5nKCksICcvJykgfHwgIXV0aWxzLmVuZHNXaXRoKGFyZ3NbaV0uYXJnLnRvU3RyaW5nKCksICcvJykpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfSAvLyBzaW1wbGUgYXJnIGNoZWNrIGlmIGl0IGlzIG5vdCBhIHJlZ2V4cFxuXG4gICAgfSBlbHNlIGlmICghL15bXFx3LV0rJC8udGVzdChhcmdzW2ldLmFyZykpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gdHJ1ZTtcbn07XG5cbi8qKlxuICogQ2xhc3MgdGhhdCBleHRlbmRzIFNpenpsZSBhbmQgYWRkcyBzdXBwb3J0IGZvciBcIm1hdGNoZXMtYXR0clwiIHBzZXVkbyBlbGVtZW50LlxuICovXG5cbnZhciBBdHRyaWJ1dGVzTWF0Y2hlciA9IGZ1bmN0aW9uICgpIHtcbiAgLyoqXG4gICAqIENsYXNzIHRoYXQgbWF0Y2hlcyBlbGVtZW50IGF0dHJpYnV0ZXMgYWdhaW5zdCB0aGUgc3BlY2lmaWVkIGV4cHJlc3Npb25zXG4gICAqIEBwYXJhbSB7QXJnRGF0YX0gbmFtZUFyZyAtIHBhcnNlZCBuYW1lIGFyZ3VtZW50XG4gICAqIEBwYXJhbSB7QXJnRGF0YX0gdmFsdWVBcmcgLSBwYXJzZWQgdmFsdWUgYXJndW1lbnRcbiAgICogQHBhcmFtIHtzdHJpbmd9IHBzZXVkb0VsZW1lbnRcbiAgICogQGNvbnN0cnVjdG9yXG4gICAqXG4gICAqIEBtZW1iZXIge3N0cmluZ3xSZWdFeHB9IGF0dHJOYW1lXG4gICAqIEBtZW1iZXIge2Jvb2xlYW59IGlzUmVnZXhwTmFtZVxuICAgKiBAbWVtYmVyIHtzdHJpbmd8UmVnRXhwfSBhdHRyVmFsdWVcbiAgICogQG1lbWJlciB7Ym9vbGVhbn0gaXNSZWdleHBWYWx1ZVxuICAgKi9cbiAgdmFyIEF0dHJNYXRjaGVyID0gZnVuY3Rpb24gQXR0ck1hdGNoZXIobmFtZUFyZywgdmFsdWVBcmcsIHBzZXVkb0VsZW1lbnQpIHtcbiAgICB0aGlzLnBzZXVkb0VsZW1lbnQgPSBwc2V1ZG9FbGVtZW50O1xuICAgIHRoaXMuYXR0ck5hbWUgPSBuYW1lQXJnLmFyZztcbiAgICB0aGlzLmlzUmVnZXhwTmFtZSA9IG5hbWVBcmcuaXNSZWdleHA7XG4gICAgdGhpcy5hdHRyVmFsdWUgPSB2YWx1ZUFyZy5hcmc7XG4gICAgdGhpcy5pc1JlZ2V4cFZhbHVlID0gdmFsdWVBcmcuaXNSZWdleHA7XG4gIH07XG4gIC8qKlxuICAgKiBGdW5jdGlvbiB0byBjaGVjayBpZiBlbGVtZW50IGF0dHJpYnV0ZXMgbWF0Y2hlcyBmaWx0ZXIgcGF0dGVyblxuICAgKiBAcGFyYW0ge0VsZW1lbnR9IGVsZW1lbnQgdG8gY2hlY2tcbiAgICovXG5cblxuICBBdHRyTWF0Y2hlci5wcm90b3R5cGUubWF0Y2hlcyA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgdmFyIGVsQXR0cnMgPSBlbGVtZW50LmF0dHJpYnV0ZXM7XG5cbiAgICBpZiAoZWxBdHRycy5sZW5ndGggPT09IDAgfHwgIXRoaXMuYXR0ck5hbWUpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICB2YXIgaSA9IDA7XG5cbiAgICB3aGlsZSAoaSA8IGVsQXR0cnMubGVuZ3RoKSB7XG4gICAgICB2YXIgYXR0ciA9IGVsQXR0cnNbaV07XG4gICAgICB2YXIgbWF0Y2hlZCA9IGZhbHNlO1xuICAgICAgdmFyIGF0dHJOYW1lTWF0Y2hlZCA9IHRoaXMuaXNSZWdleHBOYW1lID8gdGhpcy5hdHRyTmFtZS50ZXN0KGF0dHIubmFtZSkgOiB0aGlzLmF0dHJOYW1lID09PSBhdHRyLm5hbWU7XG5cbiAgICAgIGlmICghdGhpcy5hdHRyVmFsdWUpIHtcbiAgICAgICAgLy8gZm9yIDptYXRjaGVzLWF0dHIoXCIvcmVnZXgvXCIpIG9yIDptYXRjaGVzLWF0dHIoXCJhdHRyLW5hbWVcIilcbiAgICAgICAgbWF0Y2hlZCA9IGF0dHJOYW1lTWF0Y2hlZDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBhdHRyVmFsdWVNYXRjaGVkID0gdGhpcy5pc1JlZ2V4cFZhbHVlID8gdGhpcy5hdHRyVmFsdWUudGVzdChhdHRyLnZhbHVlKSA6IHRoaXMuYXR0clZhbHVlID09PSBhdHRyLnZhbHVlO1xuICAgICAgICBtYXRjaGVkID0gYXR0ck5hbWVNYXRjaGVkICYmIGF0dHJWYWx1ZU1hdGNoZWQ7XG4gICAgICB9XG5cbiAgICAgIGlmIChtYXRjaGVkKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuXG4gICAgICBpICs9IDE7XG4gICAgfVxuICB9O1xuICAvKipcbiAgICogQ3JlYXRlcyBhIG5ldyBwc2V1ZG8tY2xhc3MgYW5kIHJlZ2lzdGVycyBpdCBpbiBTaXp6bGVcbiAgICovXG5cblxuICB2YXIgZXh0ZW5kU2l6emxlID0gZnVuY3Rpb24gZXh0ZW5kU2l6emxlKHNpenpsZSkge1xuICAgIC8vIEZpcnN0IG9mIGFsbCB3ZSBzaG91bGQgcHJlcGFyZSBTaXp6bGUgZW5naW5lXG4gICAgc2l6emxlLnNlbGVjdG9ycy5wc2V1ZG9zWydtYXRjaGVzLWF0dHInXSA9IHNpenpsZS5zZWxlY3RvcnMuY3JlYXRlUHNldWRvKGZ1bmN0aW9uIChhdHRyRmlsdGVyKSB7XG4gICAgICB2YXIgX21hdGNoZXJVdGlscyRwYXJzZU1hID0gbWF0Y2hlclV0aWxzLnBhcnNlTWF0Y2hlckZpbHRlcihhdHRyRmlsdGVyKSxcbiAgICAgICAgICBfbWF0Y2hlclV0aWxzJHBhcnNlTWEyID0gX3NsaWNlZFRvQXJyYXkoX21hdGNoZXJVdGlscyRwYXJzZU1hLCAyKSxcbiAgICAgICAgICByYXdOYW1lID0gX21hdGNoZXJVdGlscyRwYXJzZU1hMlswXSxcbiAgICAgICAgICByYXdWYWx1ZSA9IF9tYXRjaGVyVXRpbHMkcGFyc2VNYTJbMV07XG5cbiAgICAgIHZhciBuYW1lQXJnID0gbWF0Y2hlclV0aWxzLnBhcnNlUmF3TWF0Y2hlckFyZyhyYXdOYW1lKTtcbiAgICAgIHZhciB2YWx1ZUFyZyA9IG1hdGNoZXJVdGlscy5wYXJzZVJhd01hdGNoZXJBcmcocmF3VmFsdWUpO1xuXG4gICAgICBpZiAoIWF0dHJGaWx0ZXIgfHwgIW1hdGNoZXJVdGlscy52YWxpZGF0ZVByb3BNYXRjaGVyQXJncyhuYW1lQXJnLCB2YWx1ZUFyZykpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBhcmd1bWVudCBvZiA6bWF0Y2hlcy1hdHRyIHBzZXVkbyBjbGFzczogXCIuY29uY2F0KGF0dHJGaWx0ZXIpKTtcbiAgICAgIH1cblxuICAgICAgdmFyIG1hdGNoZXIgPSBuZXcgQXR0ck1hdGNoZXIobmFtZUFyZywgdmFsdWVBcmcpO1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgIHJldHVybiBtYXRjaGVyLm1hdGNoZXMoZWxlbWVudCk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9OyAvLyBFWFBPU0VcblxuXG4gIHJldHVybiB7XG4gICAgZXh0ZW5kU2l6emxlOiBleHRlbmRTaXp6bGVcbiAgfTtcbn0oKTtcblxuLyoqXG4gKiBQYXJzZXMgcmF3IHByb3BlcnR5IGFyZ1xuICogQHBhcmFtIHtzdHJpbmd9IGlucHV0XG4gKiBAcmV0dXJucyB7QXJnRGF0YVtdfSBhcnJheSBvZiBvYmplY3RzXG4gKi9cblxudmFyIHBhcnNlUmF3UHJvcENoYWluID0gZnVuY3Rpb24gcGFyc2VSYXdQcm9wQ2hhaW4oaW5wdXQpIHtcbiAgdmFyIFBST1BTX0RJVklERVIgPSAnLic7XG4gIHZhciBSRUdFWFBfTUFSS0VSID0gJy8nO1xuICB2YXIgcHJvcHNBcnIgPSBbXTtcbiAgdmFyIHN0ciA9IGlucHV0O1xuXG4gIHdoaWxlIChzdHIubGVuZ3RoID4gMCkge1xuICAgIGlmICh1dGlscy5zdGFydHNXaXRoKHN0ciwgUFJPUFNfRElWSURFUikpIHtcbiAgICAgIC8vIGZvciBjYXNlcyBsaWtlICcucHJvcC5pZCcgYW5kICduZXN0ZWQuLnRlc3QnXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGNoYWluIHByb3BlcnR5OiBcIi5jb25jYXQoaW5wdXQpKTtcbiAgICB9XG5cbiAgICBpZiAoIXV0aWxzLnN0YXJ0c1dpdGgoc3RyLCBSRUdFWFBfTUFSS0VSKSkge1xuICAgICAgdmFyIGlzUmVnZXhwID0gZmFsc2U7XG4gICAgICB2YXIgZGl2aWRlckluZGV4ID0gc3RyLmluZGV4T2YoUFJPUFNfRElWSURFUik7XG5cbiAgICAgIGlmIChzdHIuaW5kZXhPZihQUk9QU19ESVZJREVSKSA9PT0gLTEpIHtcbiAgICAgICAgLy8gaWYgdGhlcmUgaXMgbm8gJy4nIGxlZnQgaW4gc3RyXG4gICAgICAgIC8vIHRha2UgdGhlIHJlc3Qgb2Ygc3RyIGFzIHByb3BcbiAgICAgICAgcHJvcHNBcnIucHVzaCh7XG4gICAgICAgICAgYXJnOiBzdHIsXG4gICAgICAgICAgaXNSZWdleHA6IGlzUmVnZXhwXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gcHJvcHNBcnI7XG4gICAgICB9IC8vIGVsc2UgdGFrZSBwcm9wIGZyb20gc3RyXG5cblxuICAgICAgdmFyIHByb3AgPSBzdHIuc2xpY2UoMCwgZGl2aWRlckluZGV4KTsgLy8gZm9yIGNhc2VzIGxpa2UgJ2FzYWRmLj8rLy50ZXN0J1xuXG4gICAgICBpZiAocHJvcC5pbmRleE9mKFJFR0VYUF9NQVJLRVIpID4gLTEpIHtcbiAgICAgICAgLy8gcHJvcCBpcyAnPysvJ1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGNoYWluIHByb3BlcnR5OiBcIi5jb25jYXQocHJvcCkpO1xuICAgICAgfVxuXG4gICAgICBwcm9wc0Fyci5wdXNoKHtcbiAgICAgICAgYXJnOiBwcm9wLFxuICAgICAgICBpc1JlZ2V4cDogaXNSZWdleHBcbiAgICAgIH0pOyAvLyBkZWxldGUgcHJvcCBmcm9tIHN0clxuXG4gICAgICBzdHIgPSBzdHIuc2xpY2UoZGl2aWRlckluZGV4KTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gZGVhbCB3aXRoIHJlZ2V4cFxuICAgICAgdmFyIHByb3BDaHVua3MgPSBbXTtcbiAgICAgIHByb3BDaHVua3MucHVzaChzdHIuc2xpY2UoMCwgMSkpOyAvLyBpZiBzdHIgc3RhcnRzIHdpdGggJy8nLCBkZWxldGUgaXQgZnJvbSBzdHIgYW5kIGZpbmQgY2xvc2luZyByZWdleHAgc2xhc2guXG4gICAgICAvLyBub3RlIHRoYXQgY2hhaW5lZCBwcm9wZXJ0eSBuYW1lIGNhbiBub3QgaW5jbHVkZSAnLycgb3IgJy4nXG4gICAgICAvLyBzbyB0aGVyZSBpcyBubyBjaGVja2luZyBmb3IgZXNjYXBlZCBjaGFyYWN0ZXJzXG5cbiAgICAgIHN0ciA9IHN0ci5zbGljZSgxKTtcbiAgICAgIHZhciByZWdleEVuZEluZGV4ID0gc3RyLmluZGV4T2YoUkVHRVhQX01BUktFUik7XG5cbiAgICAgIGlmIChyZWdleEVuZEluZGV4IDwgMSkge1xuICAgICAgICAvLyByZWdleHAgc2hvdWxkIGJlIGF0IGxlYXN0ID09PSAnLy4vJ1xuICAgICAgICAvLyBzbyB3ZSBzaG91bGQgYXZvaWQgYXJncyBsaWtlICcvaWQnIGFuZCAndGVzdC4vLy5pZCdcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCByZWdleHA6IFwiLmNvbmNhdChSRUdFWFBfTUFSS0VSKS5jb25jYXQoc3RyKSk7XG4gICAgICB9XG5cbiAgICAgIHZhciBfaXNSZWdleHAgPSB0cnVlOyAvLyB0YWtlIHRoZSByZXN0IHJlZ2V4cCBwYXJ0XG5cbiAgICAgIHByb3BDaHVua3MucHVzaChzdHIuc2xpY2UoMCwgcmVnZXhFbmRJbmRleCArIDEpKTtcblxuICAgICAgdmFyIF9wcm9wID0gdXRpbHMudG9SZWdFeHAocHJvcENodW5rcy5qb2luKCcnKSk7XG5cbiAgICAgIHByb3BzQXJyLnB1c2goe1xuICAgICAgICBhcmc6IF9wcm9wLFxuICAgICAgICBpc1JlZ2V4cDogX2lzUmVnZXhwXG4gICAgICB9KTsgLy8gZGVsZXRlIHByb3AgZnJvbSBzdHJcblxuICAgICAgc3RyID0gc3RyLnNsaWNlKHJlZ2V4RW5kSW5kZXggKyAxKTtcbiAgICB9XG5cbiAgICBpZiAoIXN0cikge1xuICAgICAgcmV0dXJuIHByb3BzQXJyO1xuICAgIH0gLy8gc3RyIHNob3VsZCBiZSBsaWtlICcubmV4dFByb3AnIG5vd1xuICAgIC8vIHNvICd6eC5wcm9wJyBvciAnLicgaXMgaW52YWxpZFxuXG5cbiAgICBpZiAoIXV0aWxzLnN0YXJ0c1dpdGgoc3RyLCBQUk9QU19ESVZJREVSKSB8fCB1dGlscy5zdGFydHNXaXRoKHN0ciwgUFJPUFNfRElWSURFUikgJiYgc3RyLmxlbmd0aCA9PT0gMSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBjaGFpbiBwcm9wZXJ0eTogXCIuY29uY2F0KGlucHV0KSk7XG4gICAgfVxuXG4gICAgc3RyID0gc3RyLnNsaWNlKDEpO1xuICB9XG59O1xuXG52YXIgY29udmVydFR5cGVGcm9tU3RyID0gZnVuY3Rpb24gY29udmVydFR5cGVGcm9tU3RyKHZhbHVlKSB7XG4gIHZhciBudW1WYWx1ZSA9IE51bWJlcih2YWx1ZSk7XG4gIHZhciBvdXRwdXQ7XG5cbiAgaWYgKCFOdW1iZXIuaXNOYU4obnVtVmFsdWUpKSB7XG4gICAgb3V0cHV0ID0gbnVtVmFsdWU7XG4gIH0gZWxzZSB7XG4gICAgc3dpdGNoICh2YWx1ZSkge1xuICAgICAgY2FzZSAndW5kZWZpbmVkJzpcbiAgICAgICAgb3V0cHV0ID0gdW5kZWZpbmVkO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAnbnVsbCc6XG4gICAgICAgIG91dHB1dCA9IG51bGw7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlICd0cnVlJzpcbiAgICAgICAgb3V0cHV0ID0gdHJ1ZTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgJ2ZhbHNlJzpcbiAgICAgICAgb3V0cHV0ID0gZmFsc2U7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBkZWZhdWx0OlxuICAgICAgICBvdXRwdXQgPSB2YWx1ZTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gb3V0cHV0O1xufTtcblxudmFyIGNvbnZlcnRUeXBlSW50b1N0ciA9IGZ1bmN0aW9uIGNvbnZlcnRUeXBlSW50b1N0cih2YWx1ZSkge1xuICB2YXIgb3V0cHV0O1xuXG4gIHN3aXRjaCAodmFsdWUpIHtcbiAgICBjYXNlIHVuZGVmaW5lZDpcbiAgICAgIG91dHB1dCA9ICd1bmRlZmluZWQnO1xuICAgICAgYnJlYWs7XG5cbiAgICBjYXNlIG51bGw6XG4gICAgICBvdXRwdXQgPSAnbnVsbCc7XG4gICAgICBicmVhaztcblxuICAgIGRlZmF1bHQ6XG4gICAgICBvdXRwdXQgPSB2YWx1ZS50b1N0cmluZygpO1xuICB9XG5cbiAgcmV0dXJuIG91dHB1dDtcbn07XG4vKipcbiAqIENsYXNzIHRoYXQgZXh0ZW5kcyBTaXp6bGUgYW5kIGFkZHMgc3VwcG9ydCBmb3IgXCJtYXRjaGVzLXByb3BlcnR5XCIgcHNldWRvIGVsZW1lbnQuXG4gKi9cblxuXG52YXIgRWxlbWVudFByb3BlcnR5TWF0Y2hlciA9IGZ1bmN0aW9uICgpIHtcbiAgLyoqXG4gICAqIENsYXNzIHRoYXQgbWF0Y2hlcyBlbGVtZW50IHByb3BlcnRpZXMgYWdhaW5zdCB0aGUgc3BlY2lmaWVkIGV4cHJlc3Npb25zXG4gICAqIEBwYXJhbSB7QXJnRGF0YVtdfSBwcm9wc0NoYWluQXJnIC0gYXJyYXkgb2YgcGFyc2VkIHByb3BzIGNoYWluIG9iamVjdHNcbiAgICogQHBhcmFtIHtBcmdEYXRhfSB2YWx1ZUFyZyAtIHBhcnNlZCB2YWx1ZSBhcmd1bWVudFxuICAgKiBAcGFyYW0ge3N0cmluZ30gcHNldWRvRWxlbWVudFxuICAgKiBAY29uc3RydWN0b3JcbiAgICpcbiAgICogQG1lbWJlciB7QXJyYXl9IGNoYWluZWRQcm9wc1xuICAgKiBAbWVtYmVyIHtib29sZWFufSBpc1JlZ2V4cE5hbWVcbiAgICogQG1lbWJlciB7c3RyaW5nfFJlZ0V4cH0gcHJvcFZhbHVlXG4gICAqIEBtZW1iZXIge2Jvb2xlYW59IGlzUmVnZXhwVmFsdWVcbiAgICovXG4gIHZhciBQcm9wTWF0Y2hlciA9IGZ1bmN0aW9uIFByb3BNYXRjaGVyKHByb3BzQ2hhaW5BcmcsIHZhbHVlQXJnLCBwc2V1ZG9FbGVtZW50KSB7XG4gICAgdGhpcy5wc2V1ZG9FbGVtZW50ID0gcHNldWRvRWxlbWVudDtcbiAgICB0aGlzLmNoYWluZWRQcm9wcyA9IHByb3BzQ2hhaW5Bcmc7XG4gICAgdGhpcy5wcm9wVmFsdWUgPSB2YWx1ZUFyZy5hcmc7XG4gICAgdGhpcy5pc1JlZ2V4cFZhbHVlID0gdmFsdWVBcmcuaXNSZWdleHA7XG4gIH07XG4gIC8qKlxuICAgKiBGdW5jdGlvbiB0byBjaGVjayBpZiBlbGVtZW50IHByb3BlcnRpZXMgbWF0Y2hlcyBmaWx0ZXIgcGF0dGVyblxuICAgKiBAcGFyYW0ge0VsZW1lbnR9IGVsZW1lbnQgdG8gY2hlY2tcbiAgICovXG5cblxuICBQcm9wTWF0Y2hlci5wcm90b3R5cGUubWF0Y2hlcyA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgdmFyIG93bmVyT2JqQXJyID0gbWF0Y2hlclV0aWxzLmZpbHRlclJvb3RzQnlSZWdleHBDaGFpbihlbGVtZW50LCB0aGlzLmNoYWluZWRQcm9wcyk7XG5cbiAgICBpZiAob3duZXJPYmpBcnIubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgdmFyIG1hdGNoZWQgPSB0cnVlO1xuXG4gICAgaWYgKHRoaXMucHJvcFZhbHVlKSB7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG93bmVyT2JqQXJyLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgIHZhciByZWFsVmFsdWUgPSBvd25lck9iakFycltpXS52YWx1ZTtcblxuICAgICAgICBpZiAodGhpcy5pc1JlZ2V4cFZhbHVlKSB7XG4gICAgICAgICAgbWF0Y2hlZCA9IHRoaXMucHJvcFZhbHVlLnRlc3QoY29udmVydFR5cGVJbnRvU3RyKHJlYWxWYWx1ZSkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIGhhbmRsZSAnbnVsbCcgYW5kICd1bmRlZmluZWQnIHByb3BlcnR5IHZhbHVlcyBzZXQgYXMgc3RyaW5nXG4gICAgICAgICAgaWYgKHJlYWxWYWx1ZSA9PT0gJ251bGwnIHx8IHJlYWxWYWx1ZSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIG1hdGNoZWQgPSB0aGlzLnByb3BWYWx1ZSA9PT0gcmVhbFZhbHVlO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgbWF0Y2hlZCA9IGNvbnZlcnRUeXBlRnJvbVN0cih0aGlzLnByb3BWYWx1ZSkgPT09IHJlYWxWYWx1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChtYXRjaGVkKSB7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gbWF0Y2hlZDtcbiAgfTtcbiAgLyoqXG4gICAqIENyZWF0ZXMgYSBuZXcgcHNldWRvLWNsYXNzIGFuZCByZWdpc3RlcnMgaXQgaW4gU2l6emxlXG4gICAqL1xuXG5cbiAgdmFyIGV4dGVuZFNpenpsZSA9IGZ1bmN0aW9uIGV4dGVuZFNpenpsZShzaXp6bGUpIHtcbiAgICAvLyBGaXJzdCBvZiBhbGwgd2Ugc2hvdWxkIHByZXBhcmUgU2l6emxlIGVuZ2luZVxuICAgIHNpenpsZS5zZWxlY3RvcnMucHNldWRvc1snbWF0Y2hlcy1wcm9wZXJ0eSddID0gc2l6emxlLnNlbGVjdG9ycy5jcmVhdGVQc2V1ZG8oZnVuY3Rpb24gKHByb3BlcnR5RmlsdGVyKSB7XG4gICAgICBpZiAoIXByb3BlcnR5RmlsdGVyKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gYXJndW1lbnQgaXMgZ2l2ZW4gZm9yIDptYXRjaGVzLXByb3BlcnR5IHBzZXVkbyBjbGFzcycpO1xuICAgICAgfVxuXG4gICAgICB2YXIgX21hdGNoZXJVdGlscyRwYXJzZU1hID0gbWF0Y2hlclV0aWxzLnBhcnNlTWF0Y2hlckZpbHRlcihwcm9wZXJ0eUZpbHRlciksXG4gICAgICAgICAgX21hdGNoZXJVdGlscyRwYXJzZU1hMiA9IF9zbGljZWRUb0FycmF5KF9tYXRjaGVyVXRpbHMkcGFyc2VNYSwgMiksXG4gICAgICAgICAgcmF3UHJvcCA9IF9tYXRjaGVyVXRpbHMkcGFyc2VNYTJbMF0sXG4gICAgICAgICAgcmF3VmFsdWUgPSBfbWF0Y2hlclV0aWxzJHBhcnNlTWEyWzFdOyAvLyBjaGFpbmVkIHByb3BlcnR5IG5hbWUgY2FuIG5vdCBpbmNsdWRlICcvJyBvciAnLidcbiAgICAgIC8vIHNvIHJlZ2V4IHByb3AgbmFtZXMgd2l0aCBzdWNoIGVzY2FwZWQgY2hhcmFjdGVycyBhcmUgaW52YWxpZFxuXG5cbiAgICAgIGlmIChyYXdQcm9wLmluZGV4T2YoJ1xcXFwvJykgPiAtMSB8fCByYXdQcm9wLmluZGV4T2YoJ1xcXFwuJykgPiAtMSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHByb3BlcnR5IG5hbWU6IFwiLmNvbmNhdChyYXdQcm9wKSk7XG4gICAgICB9XG5cbiAgICAgIHZhciBwcm9wc0NoYWluQXJnID0gcGFyc2VSYXdQcm9wQ2hhaW4ocmF3UHJvcCk7XG4gICAgICB2YXIgdmFsdWVBcmcgPSBtYXRjaGVyVXRpbHMucGFyc2VSYXdNYXRjaGVyQXJnKHJhd1ZhbHVlKTtcbiAgICAgIHZhciBwcm9wc1RvVmFsaWRhdGUgPSBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KHByb3BzQ2hhaW5BcmcpLCBbdmFsdWVBcmddKTtcblxuICAgICAgaWYgKCFtYXRjaGVyVXRpbHMudmFsaWRhdGVQcm9wTWF0Y2hlckFyZ3MocHJvcHNUb1ZhbGlkYXRlKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGFyZ3VtZW50IG9mIDptYXRjaGVzLXByb3BlcnR5IHBzZXVkbyBjbGFzczogXCIuY29uY2F0KHByb3BlcnR5RmlsdGVyKSk7XG4gICAgICB9XG5cbiAgICAgIHZhciBtYXRjaGVyID0gbmV3IFByb3BNYXRjaGVyKHByb3BzQ2hhaW5BcmcsIHZhbHVlQXJnKTtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICByZXR1cm4gbWF0Y2hlci5tYXRjaGVzKGVsZW1lbnQpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfTsgLy8gRVhQT1NFXG5cblxuICByZXR1cm4ge1xuICAgIGV4dGVuZFNpenpsZTogZXh0ZW5kU2l6emxlXG4gIH07XG59KCk7XG5cbi8qKlxuICogQ29weXJpZ2h0IDIwMjAgQWRndWFyZCBTb2Z0d2FyZSBMdGRcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBDbGFzcyB0aGF0IGV4dGVuZHMgU2l6emxlIGFuZCBhZGRzIHN1cHBvcnQgZm9yIDppcygpIHBzZXVkbyBlbGVtZW50LlxuICovXG5cbnZhciBJc0FueU1hdGNoZXIgPSBmdW5jdGlvbiAoKSB7XG4gIC8qKlxuICAgKiBDbGFzcyB0aGF0IG1hdGNoZXMgZWxlbWVudCBieSBvbmUgb2YgdGhlIHNlbGVjdG9yc1xuICAgKiBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9DU1MvOmlzXG4gICAqIEBwYXJhbSB7QXJyYXl9IHNlbGVjdG9yc1xuICAgKiBAcGFyYW0ge3N0cmluZ30gcHNldWRvRWxlbWVudFxuICAgKiBAY29uc3RydWN0b3JcbiAgICovXG4gIHZhciBJc01hdGNoZXIgPSBmdW5jdGlvbiBJc01hdGNoZXIoc2VsZWN0b3JzLCBwc2V1ZG9FbGVtZW50KSB7XG4gICAgdGhpcy5zZWxlY3RvcnMgPSBzZWxlY3RvcnM7XG4gICAgdGhpcy5wc2V1ZG9FbGVtZW50ID0gcHNldWRvRWxlbWVudDtcbiAgfTtcbiAgLyoqXG4gICAqIEZ1bmN0aW9uIHRvIGNoZWNrIGlmIGVsZW1lbnQgY2FuIGJlIG1hdGNoZWQgYnkgYW55IHBhc3NlZCBzZWxlY3RvclxuICAgKiBAcGFyYW0ge0VsZW1lbnR9IGVsZW1lbnQgdG8gY2hlY2tcbiAgICovXG5cblxuICBJc01hdGNoZXIucHJvdG90eXBlLm1hdGNoZXMgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgIHZhciBpc01hdGNoZWQgPSAhIXRoaXMuc2VsZWN0b3JzLmZpbmQoZnVuY3Rpb24gKHNlbGVjdG9yKSB7XG4gICAgICB2YXIgbm9kZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9yKTtcbiAgICAgIHJldHVybiBBcnJheS5mcm9tKG5vZGVzKS5maW5kKGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgIHJldHVybiBub2RlID09PSBlbGVtZW50O1xuICAgICAgfSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIGlzTWF0Y2hlZDtcbiAgfTtcbiAgLyoqXG4gICAqIENyZWF0ZXMgYSBuZXcgcHNldWRvLWNsYXNzIGFuZCByZWdpc3RlcnMgaXQgaW4gU2l6emxlXG4gICAqL1xuXG5cbiAgdmFyIGV4dGVuZFNpenpsZSA9IGZ1bmN0aW9uIGV4dGVuZFNpenpsZShzaXp6bGUpIHtcbiAgICAvLyBGaXJzdCBvZiBhbGwgd2Ugc2hvdWxkIHByZXBhcmUgU2l6emxlIGVuZ2luZVxuICAgIHNpenpsZS5zZWxlY3RvcnMucHNldWRvc1snaXMnXSA9IHNpenpsZS5zZWxlY3RvcnMuY3JlYXRlUHNldWRvKGZ1bmN0aW9uIChpbnB1dCkge1xuICAgICAgaWYgKGlucHV0ID09PSAnJykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGFyZ3VtZW50IG9mIDppcyBwc2V1ZG8tY2xhc3M6IFwiLmNvbmNhdChpbnB1dCkpO1xuICAgICAgfVxuXG4gICAgICB2YXIgc2VsZWN0b3JzID0gaW5wdXQuc3BsaXQoJywnKS5tYXAoZnVuY3Rpb24gKHMpIHtcbiAgICAgICAgcmV0dXJuIHMudHJpbSgpO1xuICAgICAgfSk7IC8vIGNvbGxlY3QgdmFsaWQgc2VsZWN0b3JzIGFuZCBsb2cgYWJvdXQgaW52YWxpZCBvbmVzXG5cbiAgICAgIHZhciB2YWxpZFNlbGVjdG9ycyA9IHNlbGVjdG9ycy5yZWR1Y2UoZnVuY3Rpb24gKGFjYywgc2VsZWN0b3IpIHtcbiAgICAgICAgaWYgKGNzc1V0aWxzLmlzU2ltcGxlU2VsZWN0b3JWYWxpZChzZWxlY3RvcikpIHtcbiAgICAgICAgICBhY2MucHVzaChzZWxlY3Rvcik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdXRpbHMubG9nSW5mbyhcIkludmFsaWQgc2VsZWN0b3IgcGFzc2VkIHRvIDppcygpIHBzZXVkby1jbGFzczogJ1wiLmNvbmNhdChzZWxlY3RvciwgXCInXCIpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBhY2M7XG4gICAgICB9LCBbXSk7XG4gICAgICB2YXIgbWF0Y2hlciA9IG5ldyBJc01hdGNoZXIodmFsaWRTZWxlY3RvcnMpO1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgIHJldHVybiBtYXRjaGVyLm1hdGNoZXMoZWxlbWVudCk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgZXh0ZW5kU2l6emxlOiBleHRlbmRTaXp6bGVcbiAgfTtcbn0oKTtcblxuLyoqXG4gKiBDb3B5cmlnaHQgMjAyMSBBZGd1YXJkIFNvZnR3YXJlIEx0ZFxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEV4dGVuZGVkIHNlbGVjdG9yIGZhY3RvcnkgbW9kdWxlLCBmb3IgY3JlYXRpbmcgZXh0ZW5kZWQgc2VsZWN0b3IgY2xhc3Nlcy5cbiAqXG4gKiBFeHRlbmRlZCBzZWxlY3Rpb24gY2FwYWJpbGl0aWVzIGRlc2NyaXB0aW9uOlxuICogaHR0cHM6Ly9naXRodWIuY29tL0FkZ3VhcmRUZWFtL0V4dGVuZGVkQ3NzL2Jsb2IvbWFzdGVyL1JFQURNRS5tZFxuICovXG5cbnZhciBFeHRlbmRlZFNlbGVjdG9yRmFjdG9yeSA9IGZ1bmN0aW9uICgpIHtcbiAgLy8gd2hpbGUgYWRkaW5nIG5ldyBtYXJrZXJzLCBjb25zdGFudHMgaW4gb3RoZXIgQWRHdWFyZCByZXBvcyBzaG91bGQgYmUgY29ycmVjdGVkXG4gIC8vIEFkR3VhcmQgYnJvd3NlciBleHRlbnNpb24gOiBDc3NGaWx0ZXJSdWxlLlNVUFBPUlRFRF9QU0VVRE9fQ0xBU1NFUyBhbmQgQ3NzRmlsdGVyUnVsZS5FWFRFTkRFRF9DU1NfTUFSS0VSU1xuICAvLyB0c3VybGZpbHRlciwgU2FmYXJpQ29udmVydGVyTGliIDogRVhUX0NTU19QU0VVRE9fSU5ESUNBVE9SU1xuICB2YXIgUFNFVURPX0VYVEVOU0lPTlNfTUFSS0VSUyA9IFsnOmhhcycsICc6Y29udGFpbnMnLCAnOmhhcy10ZXh0JywgJzptYXRjaGVzLWNzcycsICc6LWFicC1oYXMnLCAnOi1hYnAtaGFzLXRleHQnLCAnOmlmJywgJzppZi1ub3QnLCAnOnhwYXRoJywgJzpudGgtYW5jZXN0b3InLCAnOnVwd2FyZCcsICc6cmVtb3ZlJywgJzptYXRjaGVzLWF0dHInLCAnOm1hdGNoZXMtcHJvcGVydHknLCAnOi1hYnAtY29udGFpbnMnLCAnOmlzJ107XG4gIHZhciBpbml0aWFsaXplZCA9IGZhbHNlO1xuICB2YXIgU2l6emxlO1xuICAvKipcbiAgICogTGF6eSBpbml0aWFsaXphdGlvbiBvZiB0aGUgRXh0ZW5kZWRTZWxlY3RvckZhY3RvcnkgYW5kIG9iamVjdHMgdGhhdCBtaWdodCBiZSBuZWNlc3NhcnkgZm9yIGNyZWF0aW5nIGFuZCBhcHBseWluZyBzdHlsZXMuXG4gICAqIFRoaXMgbWV0aG9kIGV4dGVuZHMgU2l6emxlIGVuZ2luZSB0aGF0IHdlIHVzZSB1bmRlciB0aGUgaG9vZCB3aXRoIG91ciBjdXN0b20gcHNldWRvLWNsYXNzZXMuXG4gICAqL1xuXG4gIGZ1bmN0aW9uIGluaXRpYWxpemUoKSB7XG4gICAgaWYgKGluaXRpYWxpemVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaW5pdGlhbGl6ZWQgPSB0cnVlOyAvLyBPdXIgdmVyc2lvbiBvZiBTaXp6bGUgaXMgaW5pdGlhbGl6ZWQgbGF6aWx5IGFzIHdlbGxcblxuICAgIFNpenpsZSA9IGluaXRpYWxpemVTaXp6bGUoKTsgLy8gQWRkIDptYXRjaGVzLWNzcy0qKCkgc3VwcG9ydFxuXG4gICAgU3R5bGVQcm9wZXJ0eU1hdGNoZXIuZXh0ZW5kU2l6emxlKFNpenpsZSk7IC8vIEFkZCA6bWF0Y2hlcy1hdHRyKCkgc3VwcG9ydFxuXG4gICAgQXR0cmlidXRlc01hdGNoZXIuZXh0ZW5kU2l6emxlKFNpenpsZSk7IC8vIEFkZCA6bWF0Y2hlcy1wcm9wZXJ0eSgpIHN1cHBvcnRcblxuICAgIEVsZW1lbnRQcm9wZXJ0eU1hdGNoZXIuZXh0ZW5kU2l6emxlKFNpenpsZSk7IC8vIEFkZCA6aXMoKSBzdXBwb3J0XG5cbiAgICBJc0FueU1hdGNoZXIuZXh0ZW5kU2l6emxlKFNpenpsZSk7IC8vIEFkZCA6Y29udGFpbnMsIDpoYXMtdGV4dCwgOi1hYnAtY29udGFpbnMgc3VwcG9ydFxuXG4gICAgdmFyIGNvbnRhaW5zUHNldWRvID0gU2l6emxlLnNlbGVjdG9ycy5jcmVhdGVQc2V1ZG8oZnVuY3Rpb24gKHRleHQpIHtcbiAgICAgIGlmICgvXlxccypcXC8uKlxcL1tnbWlzdXldKlxccyokLy50ZXN0KHRleHQpKSB7XG4gICAgICAgIHRleHQgPSB0ZXh0LnRyaW0oKTtcbiAgICAgICAgdmFyIGZsYWdzSW5kZXggPSB0ZXh0Lmxhc3RJbmRleE9mKCcvJyk7XG4gICAgICAgIHZhciBmbGFncyA9IHRleHQuc3Vic3RyaW5nKGZsYWdzSW5kZXggKyAxKTtcbiAgICAgICAgdGV4dCA9IHRleHQuc3Vic3RyKDAsIGZsYWdzSW5kZXggKyAxKS5zbGljZSgxLCAtMSkucmVwbGFjZSgvXFxcXChbXFxcXFwiXSkvZywgJyQxJyk7XG4gICAgICAgIHZhciByZWdleDtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgIHJlZ2V4ID0gbmV3IFJlZ0V4cCh0ZXh0LCBmbGFncyk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGFyZ3VtZW50IG9mIDpjb250YWlucyBwc2V1ZG8gY2xhc3M6IFwiLmNvbmNhdCh0ZXh0KSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGVsZW0pIHtcbiAgICAgICAgICB2YXIgZWxlbVRleHRDb250ZW50ID0gdXRpbHMubm9kZVRleHRDb250ZW50R2V0dGVyLmFwcGx5KGVsZW0pO1xuICAgICAgICAgIHJldHVybiByZWdleC50ZXN0KGVsZW1UZXh0Q29udGVudCk7XG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoL1xcXFwoW1xcXFwoKVtcXF1cIl0pL2csICckMScpO1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICAgIHZhciBlbGVtVGV4dENvbnRlbnQgPSB1dGlscy5ub2RlVGV4dENvbnRlbnRHZXR0ZXIuYXBwbHkoZWxlbSk7XG4gICAgICAgIHJldHVybiBlbGVtVGV4dENvbnRlbnQuaW5kZXhPZih0ZXh0KSA+IC0xO1xuICAgICAgfTtcbiAgICB9KTtcbiAgICBTaXp6bGUuc2VsZWN0b3JzLnBzZXVkb3NbJ2NvbnRhaW5zJ10gPSBjb250YWluc1BzZXVkbztcbiAgICBTaXp6bGUuc2VsZWN0b3JzLnBzZXVkb3NbJ2hhcy10ZXh0J10gPSBjb250YWluc1BzZXVkbztcbiAgICBTaXp6bGUuc2VsZWN0b3JzLnBzZXVkb3NbJy1hYnAtY29udGFpbnMnXSA9IGNvbnRhaW5zUHNldWRvOyAvLyBBZGQgOmlmLCA6LWFicC1oYXMgc3VwcG9ydFxuXG4gICAgU2l6emxlLnNlbGVjdG9ycy5wc2V1ZG9zWydpZiddID0gU2l6emxlLnNlbGVjdG9ycy5wc2V1ZG9zWydoYXMnXTtcbiAgICBTaXp6bGUuc2VsZWN0b3JzLnBzZXVkb3NbJy1hYnAtaGFzJ10gPSBTaXp6bGUuc2VsZWN0b3JzLnBzZXVkb3NbJ2hhcyddOyAvLyBBZGQgOmlmLW5vdCBzdXBwb3J0XG5cbiAgICBTaXp6bGUuc2VsZWN0b3JzLnBzZXVkb3NbJ2lmLW5vdCddID0gU2l6emxlLnNlbGVjdG9ycy5jcmVhdGVQc2V1ZG8oZnVuY3Rpb24gKHNlbGVjdG9yKSB7XG4gICAgICBpZiAodHlwZW9mIHNlbGVjdG9yID09PSAnc3RyaW5nJykge1xuICAgICAgICBTaXp6bGUuY29tcGlsZShzZWxlY3Rvcik7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICByZXR1cm4gU2l6emxlKHNlbGVjdG9yLCBlbGVtKS5sZW5ndGggPT09IDA7XG4gICAgICB9O1xuICAgIH0pO1xuICAgIHJlZ2lzdGVyUGFyc2VyT25seVRva2VucygpO1xuICB9XG4gIC8qKlxuICAgKiBSZWdpc3RyYXRlIGN1c3RvbSB0b2tlbnMgZm9yIHBhcnNlci5cbiAgICogTmVlZGVkIGZvciBwcm9wZXIgd29yayBvZiBwc2V1ZG9zOlxuICAgKiBmb3IgY2hlY2tpbmcgaWYgdGhlIHRva2VuIGlzIGxhc3QgYW5kIHBzZXVkby1jbGFzcyBhcmd1bWVudHMgdmFsaWRhdGlvblxuICAgKi9cblxuXG4gIGZ1bmN0aW9uIHJlZ2lzdGVyUGFyc2VyT25seVRva2VucygpIHtcbiAgICBTaXp6bGUuc2VsZWN0b3JzLnBzZXVkb3NbJ3hwYXRoJ10gPSBTaXp6bGUuc2VsZWN0b3JzLmNyZWF0ZVBzZXVkbyhmdW5jdGlvbiAoc2VsZWN0b3IpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGRvY3VtZW50LmNyZWF0ZUV4cHJlc3Npb24oc2VsZWN0b3IsIG51bGwpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGFyZ3VtZW50IG9mIDp4cGF0aCBwc2V1ZG8gY2xhc3M6IFwiLmNvbmNhdChzZWxlY3RvcikpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH07XG4gICAgfSk7XG4gICAgU2l6emxlLnNlbGVjdG9ycy5wc2V1ZG9zWydudGgtYW5jZXN0b3InXSA9IFNpenpsZS5zZWxlY3RvcnMuY3JlYXRlUHNldWRvKGZ1bmN0aW9uIChzZWxlY3Rvcikge1xuICAgICAgdmFyIGRlZXAgPSBOdW1iZXIoc2VsZWN0b3IpO1xuXG4gICAgICBpZiAoTnVtYmVyLmlzTmFOKGRlZXApIHx8IGRlZXAgPCAxIHx8IGRlZXAgPj0gMjU2KSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgYXJndW1lbnQgb2YgOm50aC1hbmNlc3RvciBwc2V1ZG8gY2xhc3M6IFwiLmNvbmNhdChzZWxlY3RvcikpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH07XG4gICAgfSk7XG4gICAgU2l6emxlLnNlbGVjdG9ycy5wc2V1ZG9zWyd1cHdhcmQnXSA9IFNpenpsZS5zZWxlY3RvcnMuY3JlYXRlUHNldWRvKGZ1bmN0aW9uIChpbnB1dCkge1xuICAgICAgaWYgKGlucHV0ID09PSAnJykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGFyZ3VtZW50IG9mIDp1cHdhcmQgcHNldWRvIGNsYXNzOiBcIi5jb25jYXQoaW5wdXQpKTtcbiAgICAgIH0gZWxzZSBpZiAoTnVtYmVyLmlzSW50ZWdlcigraW5wdXQpICYmICgraW5wdXQgPCAxIHx8ICtpbnB1dCA+PSAyNTYpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgYXJndW1lbnQgb2YgOnVwd2FyZCBwc2V1ZG8gY2xhc3M6IFwiLmNvbmNhdChpbnB1dCkpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH07XG4gICAgfSk7XG4gICAgU2l6emxlLnNlbGVjdG9ycy5wc2V1ZG9zWydyZW1vdmUnXSA9IFNpenpsZS5zZWxlY3RvcnMuY3JlYXRlUHNldWRvKGZ1bmN0aW9uIChpbnB1dCkge1xuICAgICAgaWYgKGlucHV0ICE9PSAnJykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGFyZ3VtZW50IG9mIDpyZW1vdmUgcHNldWRvIGNsYXNzOiBcIi5jb25jYXQoaW5wdXQpKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG4gIC8qKlxuICAgKiBDaGVja3MgaWYgc3BlY2lmaWVkIHRva2VuIGNhbiBiZSB1c2VkIGJ5IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwuXG4gICAqL1xuXG5cbiAgZnVuY3Rpb24gaXNTaW1wbGVUb2tlbih0b2tlbikge1xuICAgIHZhciB0eXBlID0gdG9rZW4udHlwZTtcblxuICAgIGlmICh0eXBlID09PSAnSUQnIHx8IHR5cGUgPT09ICdDTEFTUycgfHwgdHlwZSA9PT0gJ0FUVFInIHx8IHR5cGUgPT09ICdUQUcnIHx8IHR5cGUgPT09ICdDSElMRCcpIHtcbiAgICAgIC8vIGtub3duIHNpbXBsZSB0b2tlbnNcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIGlmICh0eXBlID09PSAnUFNFVURPJykge1xuICAgICAgLy8gY2hlY2sgaWYgdmFsdWUgY29udGFpbnMgYW55IG9mIGV4dGVuZGVkIHBzZXVkbyBjbGFzc2VzXG4gICAgICB2YXIgaSA9IFBTRVVET19FWFRFTlNJT05TX01BUktFUlMubGVuZ3RoO1xuXG4gICAgICB3aGlsZSAoaS0tKSB7XG4gICAgICAgIGlmICh0b2tlbi52YWx1ZS5pbmRleE9mKFBTRVVET19FWFRFTlNJT05TX01BUktFUlNbaV0pID49IDApIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSAvLyBhbGwgb3RoZXJzIGFyZW4ndCBzaW1wbGVcblxuXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIC8qKlxuICAgKiBDaGVja3MgaWYgc3BlY2lmaWVkIHRva2VuIGlzIGEgY29tYmluYXRvclxuICAgKi9cblxuXG4gIGZ1bmN0aW9uIGlzUmVsYXRpb25Ub2tlbih0b2tlbikge1xuICAgIHZhciB0eXBlID0gdG9rZW4udHlwZTtcbiAgICByZXR1cm4gdHlwZSA9PT0gJyAnIHx8IHR5cGUgPT09ICc+JyB8fCB0eXBlID09PSAnKycgfHwgdHlwZSA9PT0gJ34nO1xuICB9XG4gIC8qKlxuICAgKiBFeHRlbmRlZFNlbGVjdG9yUGFyc2VyIGlzIGEgaGVscGVyIGNsYXNzIGZvciBjcmVhdGluZyB2YXJpb3VzIHNlbGVjdG9yIGluc3RhbmNlcyB3aGljaFxuICAgKiBhbGwgc2hhcmVzIGEgbWV0aG9kIGBxdWVyeVNlbGVjdG9yQWxsKClgIGFuZCBgbWF0Y2hlcygpYCBpbXBsZW1lbnRpbmcgZGlmZmVyZW50IHNlYXJjaCBzdHJhdGVnaWVzXG4gICAqIGRlcGVuZGluZyBvbiBhIHR5cGUgb2Ygc2VsZWN0b3IuXG4gICAqXG4gICAqIEN1cnJlbnRseSwgdGhlcmUgYXJlIDMgdHlwZXM6XG4gICAqICBBIHRyYWl0LWxlc3MgZXh0ZW5kZWQgc2VsZWN0b3JcbiAgICogICAgLSB3ZSBkaXJlY3RseSBmZWVkIHNlbGVjdG9yIHN0cmluZ3MgdG8gU2l6emxlLlxuICAgKiAgQSBzcGxpdHRlZCBleHRlbmRlZCBzZWxlY3RvclxuICAgKiAgICAtIHN1Y2ggYXMgI2NvbnRhaW5lciAjZmVlZEl0ZW06aGFzKC5hZHMpLCB3aGVyZSBpdCBpcyBzcGxpdHRlZCB0byBgI2NvbnRhaW5lcmAgYW5kIGAjZmVlZEl0ZW06aGFzKC5hZHMpYC5cbiAgICovXG5cblxuICBmdW5jdGlvbiBFeHRlbmRlZFNlbGVjdG9yUGFyc2VyKHNlbGVjdG9yVGV4dCwgdG9rZW5zLCBkZWJ1Zykge1xuICAgIGluaXRpYWxpemUoKTtcblxuICAgIGlmICh0eXBlb2YgdG9rZW5zID09PSAndW5kZWZpbmVkJykge1xuICAgICAgdGhpcy5zZWxlY3RvclRleHQgPSBjc3NVdGlscy5ub3JtYWxpemUoc2VsZWN0b3JUZXh0KTsgLy8gUGFzc2luZyBgcmV0dXJuVW5zb3J0ZWRgIGluIG9yZGVyIHRvIHJlY2VpdmUgdG9rZW5zIGluIHRoZSBvcmRlciB0aGF0J3MgdmFsaWQgZm9yIHRoZSBicm93c2VyXG4gICAgICAvLyBJbiBTaXp6bGUgaW50ZXJuYWxseSwgdGhlIHRva2VucyBhcmUgcmUtc29ydGVkOiBodHRwczovL2dpdGh1Yi5jb20vQWRndWFyZFRlYW0vRXh0ZW5kZWRDc3MvaXNzdWVzLzU1XG5cbiAgICAgIHRoaXMudG9rZW5zID0gU2l6emxlLnRva2VuaXplKHRoaXMuc2VsZWN0b3JUZXh0LCBmYWxzZSwge1xuICAgICAgICByZXR1cm5VbnNvcnRlZDogdHJ1ZVxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2VsZWN0b3JUZXh0ID0gc2VsZWN0b3JUZXh0O1xuICAgICAgdGhpcy50b2tlbnMgPSB0b2tlbnM7XG4gICAgfVxuXG4gICAgaWYgKGRlYnVnID09PSB0cnVlKSB7XG4gICAgICB0aGlzLmRlYnVnID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICBFeHRlbmRlZFNlbGVjdG9yUGFyc2VyLnByb3RvdHlwZSA9IHtcbiAgICAvKipcbiAgICAgKiBUaGUgbWFpbiBtZXRob2QsIGNyZWF0ZXMgYSBzZWxlY3RvciBpbnN0YW5jZSBkZXBlbmRpbmcgb24gdGhlIHR5cGUgb2YgYSBzZWxlY3Rvci5cbiAgICAgKiBAcHVibGljXG4gICAgICovXG4gICAgY3JlYXRlU2VsZWN0b3I6IGZ1bmN0aW9uIGNyZWF0ZVNlbGVjdG9yKCkge1xuICAgICAgdmFyIGRlYnVnID0gdGhpcy5kZWJ1ZztcbiAgICAgIHZhciB0b2tlbnMgPSB0aGlzLnRva2VucztcbiAgICAgIHZhciBzZWxlY3RvclRleHQgPSB0aGlzLnNlbGVjdG9yVGV4dDtcblxuICAgICAgaWYgKHRva2Vucy5sZW5ndGggIT09IDEpIHtcbiAgICAgICAgLy8gQ29tbWEtc2VwYXJhdGUgc2VsZWN0b3IgLSBjYW4ndCBvcHRpbWl6ZSBmdXJ0aGVyXG4gICAgICAgIHJldHVybiBuZXcgVHJhaXRMZXNzU2VsZWN0b3Ioc2VsZWN0b3JUZXh0LCBkZWJ1Zyk7XG4gICAgICB9XG5cbiAgICAgIHZhciB4cGF0aFBhcnQgPSB0aGlzLmdldFhwYXRoUGFydCgpO1xuXG4gICAgICBpZiAodHlwZW9mIHhwYXRoUGFydCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBYcGF0aFNlbGVjdG9yKHNlbGVjdG9yVGV4dCwgeHBhdGhQYXJ0LCBkZWJ1Zyk7XG4gICAgICB9XG5cbiAgICAgIHZhciB1cHdhcmRQYXJ0ID0gdGhpcy5nZXRVcHdhcmRQYXJ0KCk7XG5cbiAgICAgIGlmICh0eXBlb2YgdXB3YXJkUGFydCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgdmFyIG91dHB1dDtcbiAgICAgICAgdmFyIHVwd2FyZERlZXAgPSBwYXJzZUludCh1cHdhcmRQYXJ0LCAxMCk7IC8vIGlmIHVwd2FyZCBwYXJhbWV0ZXIgaXMgbm90IGEgbnVtYmVyLCB3ZSBjb25zaWRlciBpdCBhcyBhIHNlbGVjdG9yXG5cbiAgICAgICAgaWYgKE51bWJlci5pc05hTih1cHdhcmREZWVwKSkge1xuICAgICAgICAgIG91dHB1dCA9IG5ldyBVcHdhcmRTZWxlY3RvcihzZWxlY3RvclRleHQsIHVwd2FyZFBhcnQsIGRlYnVnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyB1cHdhcmQgd29ya3MgbGlrZSBudGgtYW5jZXN0b3JcbiAgICAgICAgICB2YXIgeHBhdGggPSB0aGlzLmNvbnZlcnROdGhBbmNlc3RvclRva2VuKHVwd2FyZERlZXApO1xuICAgICAgICAgIG91dHB1dCA9IG5ldyBYcGF0aFNlbGVjdG9yKHNlbGVjdG9yVGV4dCwgeHBhdGgsIGRlYnVnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBvdXRwdXQ7XG4gICAgICB9IC8vIGFyZ3VtZW50IG9mIHBzZXVkby1jbGFzcyByZW1vdmU7XG4gICAgICAvLyBpdCdzIGRlZmluZWQgb25seSBpZiByZW1vdmUgaXMgcGFyc2VkIGFzIGxhc3QgdG9rZW5cbiAgICAgIC8vIGFuZCBpdCdzIHZhbGlkIG9ubHkgaWYgcmVtb3ZlIGFyZyBpcyBlbXB0eSBzdHJpbmdcblxuXG4gICAgICB2YXIgcmVtb3ZlUGFydCA9IHRoaXMuZ2V0UmVtb3ZlUGFydCgpO1xuXG4gICAgICBpZiAodHlwZW9mIHJlbW92ZVBhcnQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIHZhciBoYXNWYWxpZFJlbW92ZVBhcnQgPSByZW1vdmVQYXJ0ID09PSAnJztcbiAgICAgICAgcmV0dXJuIG5ldyBSZW1vdmVTZWxlY3RvcihzZWxlY3RvclRleHQsIGhhc1ZhbGlkUmVtb3ZlUGFydCwgZGVidWcpO1xuICAgICAgfVxuXG4gICAgICB0b2tlbnMgPSB0b2tlbnNbMF07XG4gICAgICB2YXIgbCA9IHRva2Vucy5sZW5ndGg7XG4gICAgICB2YXIgbGFzdFJlbFRva2VuSW5kID0gdGhpcy5nZXRTcGxpdFBvaW50KCk7XG5cbiAgICAgIGlmICh0eXBlb2YgbGFzdFJlbFRva2VuSW5kID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3JUZXh0KTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgIHJldHVybiBuZXcgVHJhaXRMZXNzU2VsZWN0b3Ioc2VsZWN0b3JUZXh0LCBkZWJ1Zyk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbmV3IE5vdEFuRXh0ZW5kZWRTZWxlY3RvcihzZWxlY3RvclRleHQsIGRlYnVnKTtcbiAgICAgIH1cblxuICAgICAgdmFyIHNpbXBsZSA9ICcnO1xuICAgICAgdmFyIHJlbGF0aW9uID0gbnVsbDtcbiAgICAgIHZhciBjb21wbGV4ID0gJyc7XG4gICAgICB2YXIgaSA9IDA7XG5cbiAgICAgIGZvciAoOyBpIDwgbGFzdFJlbFRva2VuSW5kOyBpKyspIHtcbiAgICAgICAgLy8gYnVpbGQgc2ltcGxlIHBhcnRcbiAgICAgICAgc2ltcGxlICs9IHRva2Vuc1tpXS52YWx1ZTtcbiAgICAgIH1cblxuICAgICAgaWYgKGkgPiAwKSB7XG4gICAgICAgIC8vIGJ1aWxkIHJlbGF0aW9uIHBhcnRcbiAgICAgICAgcmVsYXRpb24gPSB0b2tlbnNbaSsrXS50eXBlO1xuICAgICAgfSAvLyBpIGlzIHBvaW50aW5nIHRvIHRoZSBzdGFydCBvZiBhIGNvbXBsZXggcGFydC5cblxuXG4gICAgICBmb3IgKDsgaSA8IGw7IGkrKykge1xuICAgICAgICBjb21wbGV4ICs9IHRva2Vuc1tpXS52YWx1ZTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGxhc3RSZWxUb2tlbkluZCA9PT0gLTEgPyBuZXcgVHJhaXRMZXNzU2VsZWN0b3Ioc2VsZWN0b3JUZXh0LCBkZWJ1ZykgOiBuZXcgU3BsaXR0ZWRTZWxlY3RvcihzZWxlY3RvclRleHQsIHNpbXBsZSwgcmVsYXRpb24sIGNvbXBsZXgsIGRlYnVnKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcmV0dXJuIHtudW1iZXJ8dW5kZWZpbmVkfSBBbiBpbmRleCBvZiBhIHRva2VuIHRoYXQgaXMgc3BsaXQgcG9pbnQuXG4gICAgICogcmV0dXJucyB1bmRlZmluZWQgaWYgdGhlIHNlbGVjdG9yIGRvZXMgbm90IGNvbnRhaW4gYW55IGNvbXBsZXggdG9rZW5zXG4gICAgICogb3IgaXQgaXMgbm90IGVsaWdpYmxlIGZvciBzcGxpdHRpbmcuXG4gICAgICogT3RoZXJ3aXNlIHJldHVybnMgYW4gaW50ZWdlciBpbmRpY2F0aW5nIHRoZSBpbmRleCBvZiB0aGUgbGFzdCByZWxhdGlvbiB0b2tlbi5cbiAgICAgKi9cbiAgICBnZXRTcGxpdFBvaW50OiBmdW5jdGlvbiBnZXRTcGxpdFBvaW50KCkge1xuICAgICAgdmFyIHRva2VucyA9IHRoaXMudG9rZW5zWzBdOyAvLyBXZSBzcGxpdCBzZWxlY3RvciBvbmx5IHdoZW4gdGhlIGxhc3QgY29tcG91bmQgc2VsZWN0b3JcbiAgICAgIC8vIGlzIHRoZSBvbmx5IGV4dGVuZGVkIHNlbGVjdG9yLlxuXG4gICAgICB2YXIgbGF0ZXN0UmVsYXRpb25Ub2tlbkluZGV4ID0gLTE7XG4gICAgICB2YXIgaGF2ZU1ldENvbXBsZXhUb2tlbiA9IGZhbHNlO1xuXG4gICAgICBmb3IgKHZhciBpID0gMCwgbCA9IHRva2Vucy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcbiAgICAgICAgdmFyIHRva2VuID0gdG9rZW5zW2ldO1xuXG4gICAgICAgIGlmIChpc1JlbGF0aW9uVG9rZW4odG9rZW4pKSB7XG4gICAgICAgICAgaWYgKGhhdmVNZXRDb21wbGV4VG9rZW4pIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBsYXRlc3RSZWxhdGlvblRva2VuSW5kZXggPSBpO1xuICAgICAgICB9IGVsc2UgaWYgKCFpc1NpbXBsZVRva2VuKHRva2VuKSkge1xuICAgICAgICAgIGhhdmVNZXRDb21wbGV4VG9rZW4gPSB0cnVlO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmICghaGF2ZU1ldENvbXBsZXhUb2tlbikge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBsYXRlc3RSZWxhdGlvblRva2VuSW5kZXg7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHJldHVybiB7c3RyaW5nfHVuZGVmaW5lZH0geHBhdGggc2VsZWN0b3IgcGFydCBpZiBleGlzdHNcbiAgICAgKiByZXR1cm5zIHVuZGVmaW5lZCBpZiB0aGUgc2VsZWN0b3IgZG9lcyBub3QgY29udGFpbiB4cGF0aCB0b2tlbnNcbiAgICAgKi9cbiAgICBnZXRYcGF0aFBhcnQ6IGZ1bmN0aW9uIGdldFhwYXRoUGFydCgpIHtcbiAgICAgIHZhciB0b2tlbnMgPSB0aGlzLnRva2Vuc1swXTtcblxuICAgICAgZm9yICh2YXIgaSA9IDAsIHRva2Vuc0xlbmd0aCA9IHRva2Vucy5sZW5ndGg7IGkgPCB0b2tlbnNMZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgdG9rZW4gPSB0b2tlbnNbaV07XG5cbiAgICAgICAgaWYgKHRva2VuLnR5cGUgPT09ICdQU0VVRE8nKSB7XG4gICAgICAgICAgdmFyIG1hdGNoZXMgPSB0b2tlbi5tYXRjaGVzO1xuXG4gICAgICAgICAgaWYgKG1hdGNoZXMgJiYgbWF0Y2hlcy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICBpZiAobWF0Y2hlc1swXSA9PT0gJ3hwYXRoJykge1xuICAgICAgICAgICAgICBpZiAodGhpcy5pc0xhc3RUb2tlbih0b2tlbnMsIGkpKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHBzZXVkbzogXFwnOnhwYXRoXFwnIHNob3VsZCBiZSBhdCB0aGUgZW5kIG9mIHRoZSBzZWxlY3RvcicpO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoZXNbMV07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChtYXRjaGVzWzBdID09PSAnbnRoLWFuY2VzdG9yJykge1xuICAgICAgICAgICAgICBpZiAodGhpcy5pc0xhc3RUb2tlbih0b2tlbnMsIGkpKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHBzZXVkbzogXFwnOm50aC1hbmNlc3RvclxcJyBzaG91bGQgYmUgYXQgdGhlIGVuZCBvZiB0aGUgc2VsZWN0b3InKTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIHZhciBkZWVwID0gbWF0Y2hlc1sxXTtcblxuICAgICAgICAgICAgICBpZiAoZGVlcCA+IDAgJiYgZGVlcCA8IDI1Nikge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbnZlcnROdGhBbmNlc3RvclRva2VuKGRlZXApO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIGNvbnZlcnRzIG50aC1hbmNlc3Rvci91cHdhcmQgZGVlcCB2YWx1ZSB0byB4cGF0aCBlcXVpdmFsZW50XG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGRlZXBcbiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9XG4gICAgICovXG4gICAgY29udmVydE50aEFuY2VzdG9yVG9rZW46IGZ1bmN0aW9uIGNvbnZlcnROdGhBbmNlc3RvclRva2VuKGRlZXApIHtcbiAgICAgIHZhciByZXN1bHQgPSAnLi4nO1xuXG4gICAgICB3aGlsZSAoZGVlcCA+IDEpIHtcbiAgICAgICAgcmVzdWx0ICs9ICcvLi4nO1xuICAgICAgICBkZWVwLS07XG4gICAgICB9XG5cbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiB0aGUgdG9rZW4gaXMgbGFzdCxcbiAgICAgKiBleGNlcHQgb2YgcmVtb3ZlIHBzZXVkby1jbGFzc1xuICAgICAqIEBwYXJhbSB7QXJyYXl9IHRva2Vuc1xuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBpIGluZGV4IG9mIHRva2VuXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59XG4gICAgICovXG4gICAgaXNMYXN0VG9rZW46IGZ1bmN0aW9uIGlzTGFzdFRva2VuKHRva2VucywgaSkge1xuICAgICAgLy8gY2hlY2sgaWQgdGhlIG5leHQgcGFyc2VkIHRva2VuIGlzIHJlbW92ZSBwc2V1ZG9cbiAgICAgIHZhciBpc05leHRSZW1vdmVUb2tlbiA9IHRva2Vuc1tpICsgMV0gJiYgdG9rZW5zW2kgKyAxXS50eXBlID09PSAnUFNFVURPJyAmJiB0b2tlbnNbaSArIDFdLm1hdGNoZXMgJiYgdG9rZW5zW2kgKyAxXS5tYXRjaGVzWzBdID09PSAncmVtb3ZlJzsgLy8gY2hlY2sgaWYgdGhlIHRva2VuIGlzIGxhc3RcbiAgICAgIC8vIGFuZCBpZiBpdCBpcyBub3QgY2hlY2sgaWYgaXQgaXMgcmVtb3ZlIG9uZVxuICAgICAgLy8gd2hpY2ggc2hvdWxkIGJlIHNraXBwZWRcblxuICAgICAgcmV0dXJuIGkgKyAxICE9PSB0b2tlbnMubGVuZ3RoICYmICFpc05leHRSZW1vdmVUb2tlbjtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcmV0dXJuIHtzdHJpbmd8dW5kZWZpbmVkfSB1cHdhcmQgcGFyYW1ldGVyXG4gICAgICogb3IgdW5kZWZpbmVkIGlmIHRoZSBpbnB1dCBkb2VzIG5vdCBjb250YWluIHVwd2FyZCB0b2tlbnNcbiAgICAgKi9cbiAgICBnZXRVcHdhcmRQYXJ0OiBmdW5jdGlvbiBnZXRVcHdhcmRQYXJ0KCkge1xuICAgICAgdmFyIHRva2VucyA9IHRoaXMudG9rZW5zWzBdO1xuXG4gICAgICBmb3IgKHZhciBpID0gMCwgdG9rZW5zTGVuZ3RoID0gdG9rZW5zLmxlbmd0aDsgaSA8IHRva2Vuc0xlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZhciB0b2tlbiA9IHRva2Vuc1tpXTtcblxuICAgICAgICBpZiAodG9rZW4udHlwZSA9PT0gJ1BTRVVETycpIHtcbiAgICAgICAgICB2YXIgbWF0Y2hlcyA9IHRva2VuLm1hdGNoZXM7XG5cbiAgICAgICAgICBpZiAobWF0Y2hlcyAmJiBtYXRjaGVzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgIGlmIChtYXRjaGVzWzBdID09PSAndXB3YXJkJykge1xuICAgICAgICAgICAgICBpZiAodGhpcy5pc0xhc3RUb2tlbih0b2tlbnMsIGkpKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHBzZXVkbzogXFwnOnVwd2FyZFxcJyBzaG91bGQgYmUgYXQgdGhlIGVuZCBvZiB0aGUgc2VsZWN0b3InKTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIHJldHVybiBtYXRjaGVzWzFdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEByZXR1cm4ge3N0cmluZ3x1bmRlZmluZWR9IHJlbW92ZSBwYXJhbWV0ZXJcbiAgICAgKiBvciB1bmRlZmluZWQgaWYgdGhlIGlucHV0IGRvZXMgbm90IGNvbnRhaW4gcmVtb3ZlIHRva2Vuc1xuICAgICAqL1xuICAgIGdldFJlbW92ZVBhcnQ6IGZ1bmN0aW9uIGdldFJlbW92ZVBhcnQoKSB7XG4gICAgICB2YXIgdG9rZW5zID0gdGhpcy50b2tlbnNbMF07XG5cbiAgICAgIGZvciAodmFyIGkgPSAwLCB0b2tlbnNMZW5ndGggPSB0b2tlbnMubGVuZ3RoOyBpIDwgdG9rZW5zTGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIHRva2VuID0gdG9rZW5zW2ldO1xuXG4gICAgICAgIGlmICh0b2tlbi50eXBlID09PSAnUFNFVURPJykge1xuICAgICAgICAgIHZhciBtYXRjaGVzID0gdG9rZW4ubWF0Y2hlcztcblxuICAgICAgICAgIGlmIChtYXRjaGVzICYmIG1hdGNoZXMubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgaWYgKG1hdGNoZXNbMF0gPT09ICdyZW1vdmUnKSB7XG4gICAgICAgICAgICAgIGlmIChpICsgMSAhPT0gdG9rZW5zTGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHBzZXVkbzogXFwnOnJlbW92ZVxcJyBzaG91bGQgYmUgYXQgdGhlIGVuZCBvZiB0aGUgc2VsZWN0b3InKTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIHJldHVybiBtYXRjaGVzWzFdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgdmFyIGdsb2JhbERlYnVnZ2luZ0ZsYWcgPSBmYWxzZTtcblxuICBmdW5jdGlvbiBpc0RlYnVnZ2luZygpIHtcbiAgICByZXR1cm4gZ2xvYmFsRGVidWdnaW5nRmxhZyB8fCB0aGlzLmRlYnVnO1xuICB9XG4gIC8qKlxuICAgKiBUaGlzIGNsYXNzIHJlcHJlc2VudHMgYSBzZWxlY3RvciB3aGljaCBpcyBub3QgYW4gZXh0ZW5kZWQgc2VsZWN0b3IuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBzZWxlY3RvclRleHRcbiAgICogQHBhcmFtIHtib29sZWFuPX0gZGVidWdcbiAgICogQGZpbmFsXG4gICAqL1xuXG5cbiAgZnVuY3Rpb24gTm90QW5FeHRlbmRlZFNlbGVjdG9yKHNlbGVjdG9yVGV4dCwgZGVidWcpIHtcbiAgICB0aGlzLnNlbGVjdG9yVGV4dCA9IHNlbGVjdG9yVGV4dDtcbiAgICB0aGlzLmRlYnVnID0gZGVidWc7XG4gIH1cblxuICBOb3RBbkV4dGVuZGVkU2VsZWN0b3IucHJvdG90eXBlID0ge1xuICAgIHF1ZXJ5U2VsZWN0b3JBbGw6IGZ1bmN0aW9uIHF1ZXJ5U2VsZWN0b3JBbGwoKSB7XG4gICAgICByZXR1cm4gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCh0aGlzLnNlbGVjdG9yVGV4dCk7XG4gICAgfSxcbiAgICBtYXRjaGVzOiBmdW5jdGlvbiBtYXRjaGVzKGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiBlbGVtZW50W3V0aWxzLm1hdGNoZXNQcm9wZXJ0eU5hbWVdKHRoaXMuc2VsZWN0b3JUZXh0KTtcbiAgICB9LFxuICAgIGlzRGVidWdnaW5nOiBpc0RlYnVnZ2luZ1xuICB9O1xuICAvKipcbiAgICogQSB0cmFpdC1sZXNzIGV4dGVuZGVkIHNlbGVjdG9yIGNsYXNzLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gc2VsZWN0b3JUZXh0XG4gICAqIEBwYXJhbSB7Ym9vbGVhbj19IGRlYnVnXG4gICAqIEBjb25zdHJ1Y3RvclxuICAgKi9cblxuICBmdW5jdGlvbiBUcmFpdExlc3NTZWxlY3RvcihzZWxlY3RvclRleHQsIGRlYnVnKSB7XG4gICAgdGhpcy5zZWxlY3RvclRleHQgPSBzZWxlY3RvclRleHQ7XG4gICAgdGhpcy5kZWJ1ZyA9IGRlYnVnO1xuICAgIFNpenpsZS5jb21waWxlKHNlbGVjdG9yVGV4dCk7XG4gIH1cblxuICBUcmFpdExlc3NTZWxlY3Rvci5wcm90b3R5cGUgPSB7XG4gICAgcXVlcnlTZWxlY3RvckFsbDogZnVuY3Rpb24gcXVlcnlTZWxlY3RvckFsbCgpIHtcbiAgICAgIHJldHVybiBTaXp6bGUodGhpcy5zZWxlY3RvclRleHQpO1xuICAgIH0sXG5cbiAgICAvKiogQGZpbmFsICovXG4gICAgbWF0Y2hlczogZnVuY3Rpb24gbWF0Y2hlcyhlbGVtZW50KSB7XG4gICAgICByZXR1cm4gU2l6emxlLm1hdGNoZXNTZWxlY3RvcihlbGVtZW50LCB0aGlzLnNlbGVjdG9yVGV4dCk7XG4gICAgfSxcblxuICAgIC8qKiBAZmluYWwgKi9cbiAgICBpc0RlYnVnZ2luZzogaXNEZWJ1Z2dpbmdcbiAgfTtcbiAgLyoqXG4gICAqIFBhcmVudGFsIGNsYXNzIGZvciBzdWNoIHBzZXVkby1jbGFzc2VzIGFzIHhwYXRoLCB1cHdhcmQsIHJlbW92ZVxuICAgKiB3aGljaCBhcmUgbGltaXRlZCB0byBiZSB0aGUgbGFzdCBvbmUgdG9rZW4gaW4gc2VsZWN0b3JcbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IHNlbGVjdG9yVGV4dFxuICAgKiBAcGFyYW0ge3N0cmluZ30gcHNldWRvQ2xhc3NBcmcgcHNldWRvLWNsYXNzIGFyZ1xuICAgKiBAcGFyYW0ge2Jvb2xlYW49fSBkZWJ1Z1xuICAgKiBAY29uc3RydWN0b3JcbiAgICovXG5cbiAgZnVuY3Rpb24gQmFzZUxhc3RBcmd1bWVudFNlbGVjdG9yKHNlbGVjdG9yVGV4dCwgcHNldWRvQ2xhc3NBcmcsIGRlYnVnKSB7XG4gICAgdGhpcy5zZWxlY3RvclRleHQgPSBzZWxlY3RvclRleHQ7XG4gICAgdGhpcy5wc2V1ZG9DbGFzc0FyZyA9IHBzZXVkb0NsYXNzQXJnO1xuICAgIHRoaXMuZGVidWcgPSBkZWJ1ZztcbiAgICBTaXp6bGUuY29tcGlsZSh0aGlzLnNlbGVjdG9yVGV4dCk7XG4gIH1cblxuICBCYXNlTGFzdEFyZ3VtZW50U2VsZWN0b3IucHJvdG90eXBlID0ge1xuICAgIHF1ZXJ5U2VsZWN0b3JBbGw6IGZ1bmN0aW9uIHF1ZXJ5U2VsZWN0b3JBbGwoKSB7XG4gICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICB2YXIgcmVzdWx0Tm9kZXMgPSBbXTtcbiAgICAgIHZhciBzaW1wbGVOb2RlcztcblxuICAgICAgaWYgKHRoaXMuc2VsZWN0b3JUZXh0KSB7XG4gICAgICAgIHNpbXBsZU5vZGVzID0gU2l6emxlKHRoaXMuc2VsZWN0b3JUZXh0KTtcblxuICAgICAgICBpZiAoIXNpbXBsZU5vZGVzIHx8ICFzaW1wbGVOb2Rlcy5sZW5ndGgpIHtcbiAgICAgICAgICByZXR1cm4gcmVzdWx0Tm9kZXM7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNpbXBsZU5vZGVzID0gW2RvY3VtZW50XTtcbiAgICAgIH1cblxuICAgICAgc2ltcGxlTm9kZXMuZm9yRWFjaChmdW5jdGlvbiAobm9kZSkge1xuICAgICAgICBfdGhpcy5zZWFyY2hSZXN1bHROb2Rlcyhub2RlLCBfdGhpcy5wc2V1ZG9DbGFzc0FyZywgcmVzdWx0Tm9kZXMpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gU2l6emxlLnVuaXF1ZVNvcnQocmVzdWx0Tm9kZXMpO1xuICAgIH0sXG5cbiAgICAvKiogQGZpbmFsICovXG4gICAgbWF0Y2hlczogZnVuY3Rpb24gbWF0Y2hlcyhlbGVtZW50KSB7XG4gICAgICB2YXIgcmVzdWx0cyA9IHRoaXMucXVlcnlTZWxlY3RvckFsbCgpO1xuICAgICAgcmV0dXJuIHJlc3VsdHMuaW5kZXhPZihlbGVtZW50KSA+IC0xO1xuICAgIH0sXG5cbiAgICAvKiogQGZpbmFsICovXG4gICAgaXNEZWJ1Z2dpbmc6IGlzRGVidWdnaW5nLFxuXG4gICAgLyoqXG4gICAgICogUHJpbWl0aXZlIG1ldGhvZCB0aGF0IHJldHVybnMgYWxsIG5vZGVzIGlmIHBzZXVkby1jbGFzcyBhcmcgaXMgZGVmaW5lZC5cbiAgICAgKiBUaGF0IGxvZ2ljIHdvcmtzIGZvciByZW1vdmUgcHNldWRvLWNsYXNzLFxuICAgICAqIGJ1dCBmb3Igb3RoZXJzIGl0IHNob3VsZCBiZSBvdmVycmlkZGVuLlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBub2RlIGNvbnRleHQgZWxlbWVudFxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBwc2V1ZG9DbGFzc0FyZyBwc2V1ZG8tY2xhc3MgYXJndW1lbnRcbiAgICAgKiBAcGFyYW0ge0FycmF5fSByZXN1bHRcbiAgICAgKi9cbiAgICBzZWFyY2hSZXN1bHROb2RlczogZnVuY3Rpb24gc2VhcmNoUmVzdWx0Tm9kZXMobm9kZSwgcHNldWRvQ2xhc3NBcmcsIHJlc3VsdCkge1xuICAgICAgaWYgKHBzZXVkb0NsYXNzQXJnKSB7XG4gICAgICAgIHJlc3VsdC5wdXNoKG5vZGUpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgLyoqXG4gICAqIFhwYXRoIHNlbGVjdG9yIGNsYXNzXG4gICAqIExpbWl0ZWQgdG8gc3VwcG9ydCAneHBhdGgnIHRvIGJlIG9ubHkgdGhlIGxhc3Qgb25lIHRva2VuIGluIHNlbGVjdG9yXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBzZWxlY3RvclRleHRcbiAgICogQHBhcmFtIHtzdHJpbmd9IHhwYXRoIHZhbHVlXG4gICAqIEBwYXJhbSB7Ym9vbGVhbj19IGRlYnVnXG4gICAqIEBjb25zdHJ1Y3RvclxuICAgKiBAYXVnbWVudHMgQmFzZUxhc3RBcmd1bWVudFNlbGVjdG9yXG4gICAqL1xuXG4gIGZ1bmN0aW9uIFhwYXRoU2VsZWN0b3Ioc2VsZWN0b3JUZXh0LCB4cGF0aCwgZGVidWcpIHtcbiAgICB2YXIgTk9fU0VMRUNUT1JfTUFSS0VSID0gJzp4cGF0aCgvLyc7XG4gICAgdmFyIEJPRFlfU0VMRUNUT1JfUkVQTEFDRVIgPSAnYm9keTp4cGF0aCgvLyc7XG4gICAgdmFyIG1vZGlmaWVkU2VsZWN0b3JUZXh0ID0gc2VsZWN0b3JUZXh0OyAvLyBOb3JtYWxseSwgYSBwc2V1ZG8tY2xhc3MgaXMgYXBwbGllZCB0byBub2RlcyBzZWxlY3RlZCBieSBhIHNlbGVjdG9yIC0tIHNlbGVjdG9yOnhwYXRoKC4uLikuXG4gICAgLy8gSG93ZXZlciwgOnhwYXRoIGlzIHNwZWNpYWwgYXMgdGhlIHNlbGVjdG9yIGNhbiBiZSBvbW1pdGVkLlxuICAgIC8vIEZvciBhbnkgb3RoZXIgcHNldWRvLWNsYXNzIHRoYXQgd291bGQgbWVhbiBcImFwcGx5IHRvIEFMTCBET00gbm9kZXNcIixcbiAgICAvLyBidXQgaW4gY2FzZSBvZiA6eHBhdGggaXQganVzdCBtZWFucyBcImFwcGx5IG1lIHRvIHRoZSBkb2N1bWVudFwiLlxuXG4gICAgaWYgKHV0aWxzLnN0YXJ0c1dpdGgoc2VsZWN0b3JUZXh0LCBOT19TRUxFQ1RPUl9NQVJLRVIpKSB7XG4gICAgICBtb2RpZmllZFNlbGVjdG9yVGV4dCA9IHNlbGVjdG9yVGV4dC5yZXBsYWNlKE5PX1NFTEVDVE9SX01BUktFUiwgQk9EWV9TRUxFQ1RPUl9SRVBMQUNFUik7XG4gICAgfVxuXG4gICAgQmFzZUxhc3RBcmd1bWVudFNlbGVjdG9yLmNhbGwodGhpcywgbW9kaWZpZWRTZWxlY3RvclRleHQsIHhwYXRoLCBkZWJ1Zyk7XG4gIH1cblxuICBYcGF0aFNlbGVjdG9yLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoQmFzZUxhc3RBcmd1bWVudFNlbGVjdG9yLnByb3RvdHlwZSk7XG4gIFhwYXRoU2VsZWN0b3IucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gWHBhdGhTZWxlY3RvcjtcbiAgLyoqXG4gICAqIEFwcGxpZXMgeHBhdGggcHNldWRvLWNsYXNzIHRvIHByb3ZpZGVkIGNvbnRleHQgbm9kZVxuICAgKiBAcGFyYW0ge09iamVjdH0gbm9kZSBjb250ZXh0IGVsZW1lbnRcbiAgICogQHBhcmFtIHtzdHJpbmd9IHBzZXVkb0NsYXNzQXJnIHhwYXRoXG4gICAqIEBwYXJhbSB7QXJyYXl9IHJlc3VsdFxuICAgKiBAb3ZlcnJpZGVcbiAgICovXG5cbiAgWHBhdGhTZWxlY3Rvci5wcm90b3R5cGUuc2VhcmNoUmVzdWx0Tm9kZXMgPSBmdW5jdGlvbiAobm9kZSwgcHNldWRvQ2xhc3NBcmcsIHJlc3VsdCkge1xuICAgIHZhciB4cGF0aFJlc3VsdCA9IGRvY3VtZW50LmV2YWx1YXRlKHBzZXVkb0NsYXNzQXJnLCBub2RlLCBudWxsLCBYUGF0aFJlc3VsdC5VTk9SREVSRURfTk9ERV9JVEVSQVRPUl9UWVBFLCBudWxsKTtcbiAgICB2YXIgaU5vZGU7IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25kLWFzc2lnblxuXG4gICAgd2hpbGUgKGlOb2RlID0geHBhdGhSZXN1bHQuaXRlcmF0ZU5leHQoKSkge1xuICAgICAgcmVzdWx0LnB1c2goaU5vZGUpO1xuICAgIH1cbiAgfTtcbiAgLyoqXG4gICAqIFVwd2FyZCBzZWxlY3RvciBjbGFzc1xuICAgKiBMaW1pdGVkIHRvIHN1cHBvcnQgJ3Vwd2FyZCcgdG8gYmUgb25seSB0aGUgbGFzdCBvbmUgdG9rZW4gaW4gc2VsZWN0b3JcbiAgICogQHBhcmFtIHtzdHJpbmd9IHNlbGVjdG9yVGV4dFxuICAgKiBAcGFyYW0ge3N0cmluZ30gdXB3YXJkU2VsZWN0b3IgdmFsdWVcbiAgICogQHBhcmFtIHtib29sZWFuPX0gZGVidWdcbiAgICogQGNvbnN0cnVjdG9yXG4gICAqIEBhdWdtZW50cyBCYXNlTGFzdEFyZ3VtZW50U2VsZWN0b3JcbiAgICovXG5cblxuICBmdW5jdGlvbiBVcHdhcmRTZWxlY3RvcihzZWxlY3RvclRleHQsIHVwd2FyZFNlbGVjdG9yLCBkZWJ1Zykge1xuICAgIEJhc2VMYXN0QXJndW1lbnRTZWxlY3Rvci5jYWxsKHRoaXMsIHNlbGVjdG9yVGV4dCwgdXB3YXJkU2VsZWN0b3IsIGRlYnVnKTtcbiAgfVxuXG4gIFVwd2FyZFNlbGVjdG9yLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoQmFzZUxhc3RBcmd1bWVudFNlbGVjdG9yLnByb3RvdHlwZSk7XG4gIFVwd2FyZFNlbGVjdG9yLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFVwd2FyZFNlbGVjdG9yO1xuICAvKipcbiAgICogQXBwbGllcyB1cHdhcmQgcHNldWRvLWNsYXNzIHRvIHByb3ZpZGVkIGNvbnRleHQgbm9kZVxuICAgKiBAcGFyYW0ge09iamVjdH0gbm9kZSBjb250ZXh0IGVsZW1lbnRcbiAgICogQHBhcmFtIHtzdHJpbmd9IHVwd2FyZFNlbGVjdG9yIHVwd2FyZCBzZWxlY3RvclxuICAgKiBAcGFyYW0ge0FycmF5fSByZXN1bHRcbiAgICogQG92ZXJyaWRlXG4gICAqL1xuXG4gIFVwd2FyZFNlbGVjdG9yLnByb3RvdHlwZS5zZWFyY2hSZXN1bHROb2RlcyA9IGZ1bmN0aW9uIChub2RlLCB1cHdhcmRTZWxlY3RvciwgcmVzdWx0KSB7XG4gICAgaWYgKHVwd2FyZFNlbGVjdG9yICE9PSAnJykge1xuICAgICAgdmFyIHBhcmVudCA9IG5vZGUucGFyZW50RWxlbWVudDtcblxuICAgICAgaWYgKHBhcmVudCA9PT0gbnVsbCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIG5vZGUgPSBwYXJlbnQuY2xvc2VzdCh1cHdhcmRTZWxlY3Rvcik7XG5cbiAgICAgIGlmIChub2RlID09PSBudWxsKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXN1bHQucHVzaChub2RlKTtcbiAgfTtcbiAgLyoqXG4gICAqIFJlbW92ZSBzZWxlY3RvciBjbGFzc1xuICAgKiBMaW1pdGVkIHRvIHN1cHBvcnQgJ3JlbW92ZScgdG8gYmUgb25seSB0aGUgbGFzdCBvbmUgdG9rZW4gaW4gc2VsZWN0b3JcbiAgICogQHBhcmFtIHtzdHJpbmd9IHNlbGVjdG9yVGV4dFxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IGhhc1ZhbGlkUmVtb3ZlUGFydFxuICAgKiBAcGFyYW0ge2Jvb2xlYW49fSBkZWJ1Z1xuICAgKiBAY29uc3RydWN0b3JcbiAgICogQGF1Z21lbnRzIEJhc2VMYXN0QXJndW1lbnRTZWxlY3RvclxuICAgKi9cblxuXG4gIGZ1bmN0aW9uIFJlbW92ZVNlbGVjdG9yKHNlbGVjdG9yVGV4dCwgaGFzVmFsaWRSZW1vdmVQYXJ0LCBkZWJ1Zykge1xuICAgIHZhciBSRU1PVkVfUFNFVURPX01BUktFUiA9ICc6cmVtb3ZlKCknO1xuICAgIHZhciByZW1vdmVNYXJrZXJJbmRleCA9IHNlbGVjdG9yVGV4dC5pbmRleE9mKFJFTU9WRV9QU0VVRE9fTUFSS0VSKTsgLy8gZGVsZXRpbmcgcmVtb3ZlIHBhcnQgb2YgcnVsZSBpbnN0ZWFkIG9mIHdoaWNoXG4gICAgLy8gcHNldWRvLXByb3BlcnR5IHByb3BlcnR5ICdyZW1vdmUnIHdpbGwgYmUgYWRkZWQgYnkgRXh0ZW5kZWRDc3NQYXJzZXJcblxuICAgIHZhciBtb2RpZmllZFNlbGVjdG9yVGV4dCA9IHNlbGVjdG9yVGV4dC5zbGljZSgwLCByZW1vdmVNYXJrZXJJbmRleCk7XG4gICAgQmFzZUxhc3RBcmd1bWVudFNlbGVjdG9yLmNhbGwodGhpcywgbW9kaWZpZWRTZWxlY3RvclRleHQsIGhhc1ZhbGlkUmVtb3ZlUGFydCwgZGVidWcpOyAvLyBtYXJrIGV4dGVuZGVkU2VsZWN0b3IgYXMgUmVtb3ZlIG9uZSBmb3IgRXh0ZW5kZWRDc3NQYXJzZXJcblxuICAgIHRoaXMuaXNSZW1vdmVTZWxlY3RvciA9IHRydWU7XG4gIH1cblxuICBSZW1vdmVTZWxlY3Rvci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEJhc2VMYXN0QXJndW1lbnRTZWxlY3Rvci5wcm90b3R5cGUpO1xuICBSZW1vdmVTZWxlY3Rvci5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBSZW1vdmVTZWxlY3RvcjtcbiAgLyoqXG4gICAqIEEgc3BsaXR0ZWQgZXh0ZW5kZWQgc2VsZWN0b3IgY2xhc3MuXG4gICAqXG4gICAqICNjb250YWluZXIgI2ZlZWRJdGVtOmhhcyguYWRzKVxuICAgKiArLS0tLS0tLS0rICAgICAgICAgICAgICAgICAgICAgc2ltcGxlXG4gICAqICAgICAgICAgICArICAgICAgICAgICAgICAgICAgICByZWxhdGlvblxuICAgKiAgICAgICAgICAgICstLS0tLS0tLS0tLS0tLS0tLSsgY29tcGxleFxuICAgKiBXZSBzcGxpdCBzZWxlY3RvciBvbmx5IHdoZW4gdGhlIGxhc3Qgc2VsZWN0b3IgaXMgY29tcGxleFxuICAgKiBAcGFyYW0ge3N0cmluZ30gc2VsZWN0b3JUZXh0XG4gICAqIEBwYXJhbSB7c3RyaW5nfSBzaW1wbGVcbiAgICogQHBhcmFtIHtzdHJpbmd9IHJlbGF0aW9uXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBjb21wbGV4XG4gICAqIEBwYXJhbSB7Ym9vbGVhbj19IGRlYnVnXG4gICAqIEBjb25zdHJ1Y3RvclxuICAgKiBAZXh0ZW5kcyBUcmFpdExlc3NTZWxlY3RvclxuICAgKi9cblxuICBmdW5jdGlvbiBTcGxpdHRlZFNlbGVjdG9yKHNlbGVjdG9yVGV4dCwgc2ltcGxlLCByZWxhdGlvbiwgY29tcGxleCwgZGVidWcpIHtcbiAgICBUcmFpdExlc3NTZWxlY3Rvci5jYWxsKHRoaXMsIHNlbGVjdG9yVGV4dCwgZGVidWcpO1xuICAgIHRoaXMuc2ltcGxlID0gc2ltcGxlO1xuICAgIHRoaXMucmVsYXRpb24gPSByZWxhdGlvbjtcbiAgICB0aGlzLmNvbXBsZXggPSBjb21wbGV4O1xuICAgIFNpenpsZS5jb21waWxlKGNvbXBsZXgpO1xuICB9XG5cbiAgU3BsaXR0ZWRTZWxlY3Rvci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKFRyYWl0TGVzc1NlbGVjdG9yLnByb3RvdHlwZSk7XG4gIFNwbGl0dGVkU2VsZWN0b3IucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gU3BsaXR0ZWRTZWxlY3RvcjtcbiAgLyoqIEBvdmVycmlkZSAqL1xuXG4gIFNwbGl0dGVkU2VsZWN0b3IucHJvdG90eXBlLnF1ZXJ5U2VsZWN0b3JBbGwgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIF90aGlzMiA9IHRoaXM7XG5cbiAgICB2YXIgcmVzdWx0Tm9kZXMgPSBbXTtcbiAgICB2YXIgc2ltcGxlTm9kZXM7XG4gICAgdmFyIHNpbXBsZSA9IHRoaXMuc2ltcGxlO1xuICAgIHZhciByZWxhdGlvbjtcblxuICAgIGlmIChzaW1wbGUpIHtcbiAgICAgIC8vIEZpcnN0IHdlIHVzZSBzaW1wbGUgc2VsZWN0b3IgdG8gbmFycm93IG91ciBzZWFyY2hcbiAgICAgIHNpbXBsZU5vZGVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzaW1wbGUpO1xuXG4gICAgICBpZiAoIXNpbXBsZU5vZGVzIHx8ICFzaW1wbGVOb2Rlcy5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIHJlc3VsdE5vZGVzO1xuICAgICAgfVxuXG4gICAgICByZWxhdGlvbiA9IHRoaXMucmVsYXRpb247XG4gICAgfSBlbHNlIHtcbiAgICAgIHNpbXBsZU5vZGVzID0gW2RvY3VtZW50XTtcbiAgICAgIHJlbGF0aW9uID0gJyAnO1xuICAgIH1cblxuICAgIHN3aXRjaCAocmVsYXRpb24pIHtcbiAgICAgIGNhc2UgJyAnOlxuICAgICAgICBzaW1wbGVOb2Rlcy5mb3JFYWNoKGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgICAgX3RoaXMyLnJlbGF0aXZlU2VhcmNoKG5vZGUsIHJlc3VsdE5vZGVzKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlICc+JzpcbiAgICAgICAge1xuICAgICAgICAgIHNpbXBsZU5vZGVzLmZvckVhY2goZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgICAgICAgIE9iamVjdC52YWx1ZXMobm9kZS5jaGlsZHJlbikuZm9yRWFjaChmdW5jdGlvbiAoY2hpbGROb2RlKSB7XG4gICAgICAgICAgICAgIGlmIChfdGhpczIubWF0Y2hlcyhjaGlsZE5vZGUpKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0Tm9kZXMucHVzaChjaGlsZE5vZGUpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICBjYXNlICcrJzpcbiAgICAgICAge1xuICAgICAgICAgIHNpbXBsZU5vZGVzLmZvckVhY2goZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgICAgICAgIHZhciBwYXJlbnROb2RlID0gbm9kZS5wYXJlbnROb2RlO1xuICAgICAgICAgICAgT2JqZWN0LnZhbHVlcyhwYXJlbnROb2RlLmNoaWxkcmVuKS5mb3JFYWNoKGZ1bmN0aW9uIChjaGlsZE5vZGUpIHtcbiAgICAgICAgICAgICAgaWYgKF90aGlzMi5tYXRjaGVzKGNoaWxkTm9kZSkgJiYgY2hpbGROb2RlLnByZXZpb3VzRWxlbWVudFNpYmxpbmcgPT09IG5vZGUpIHtcbiAgICAgICAgICAgICAgICByZXN1bHROb2Rlcy5wdXNoKGNoaWxkTm9kZSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgIGNhc2UgJ34nOlxuICAgICAgICB7XG4gICAgICAgICAgc2ltcGxlTm9kZXMuZm9yRWFjaChmdW5jdGlvbiAobm9kZSkge1xuICAgICAgICAgICAgdmFyIHBhcmVudE5vZGUgPSBub2RlLnBhcmVudE5vZGU7XG4gICAgICAgICAgICBPYmplY3QudmFsdWVzKHBhcmVudE5vZGUuY2hpbGRyZW4pLmZvckVhY2goZnVuY3Rpb24gKGNoaWxkTm9kZSkge1xuICAgICAgICAgICAgICBpZiAoX3RoaXMyLm1hdGNoZXMoY2hpbGROb2RlKSAmJiBub2RlLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKGNoaWxkTm9kZSkgPT09IDQpIHtcbiAgICAgICAgICAgICAgICByZXN1bHROb2Rlcy5wdXNoKGNoaWxkTm9kZSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIFNpenpsZS51bmlxdWVTb3J0KHJlc3VsdE5vZGVzKTtcbiAgfTtcbiAgLyoqXG4gICAqIFBlcmZvcm1zIGEgc2VhcmNoIG9mIFwiY29tcGxleFwiIHBhcnQgcmVsYXRpdmUgdG8gcmVzdWx0cyBmb3IgdGhlIFwic2ltcGxlXCIgcGFydC5cbiAgICogQHBhcmFtIHtOb2RlfSBub2RlIGEgbm9kZSBtYXRjaGluZyB0aGUgXCJzaW1wbGVcIiBwYXJ0LlxuICAgKiBAcGFyYW0ge05vZGVbXX0gcmVzdWx0IGFuIGFycmF5IHRvIGFwcGVuZCBzZWFyY2ggcmVzdWx0LlxuICAgKi9cblxuXG4gIFNwbGl0dGVkU2VsZWN0b3IucHJvdG90eXBlLnJlbGF0aXZlU2VhcmNoID0gZnVuY3Rpb24gKG5vZGUsIHJlc3VsdHMpIHtcbiAgICBTaXp6bGUodGhpcy5jb21wbGV4LCBub2RlLCByZXN1bHRzKTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIC8qKlxuICAgICAqIFdyYXBzIHRoZSBpbm5lciBjbGFzcyBzbyB0aGF0IHRoZSBpbnN0YW5jZSBpcyBub3QgZXhwb3NlZC5cbiAgICAgKi9cbiAgICBjcmVhdGVTZWxlY3RvcjogZnVuY3Rpb24gY3JlYXRlU2VsZWN0b3Ioc2VsZWN0b3IsIHRva2VucywgZGVidWcpIHtcbiAgICAgIHJldHVybiBuZXcgRXh0ZW5kZWRTZWxlY3RvclBhcnNlcihzZWxlY3RvciwgdG9rZW5zLCBkZWJ1ZykuY3JlYXRlU2VsZWN0b3IoKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogTWFyayBldmVyeSBzZWxlY3RvciBhcyBhIHNlbGVjdG9yIGJlaW5nIGRlYnVnZ2VkLCBzbyB0aGF0IHRpbWluZyBpbmZvcm1hdGlvblxuICAgICAqIGZvciB0aGUgc2VsZWN0b3IgaXMgcHJpbnRlZCB0byB0aGUgY29uc29sZS5cbiAgICAgKi9cbiAgICBlbmFibGVHbG9iYWxEZWJ1Z2dpbmc6IGZ1bmN0aW9uIGVuYWJsZUdsb2JhbERlYnVnZ2luZygpIHtcbiAgICAgIGdsb2JhbERlYnVnZ2luZ0ZsYWcgPSB0cnVlO1xuICAgIH1cbiAgfTtcbn0oKTtcblxuLyoqXG4gKiBDb3B5cmlnaHQgMjAxNiBBZGd1YXJkIFNvZnR3YXJlIEx0ZFxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEEgaGVscGVyIGNsYXNzIHRoYXQgcGFyc2VzIHN0eWxlc2hlZXRzIGNvbnRhaW5pbmcgZXh0ZW5kZWQgc2VsZWN0b3JzXG4gKiBpbnRvIEV4dGVuZGVkU2VsZWN0b3IgaW5zdGFuY2VzIGFuZCBrZXktdmFsdWUgbWFwcyBvZiBzdHlsZSBkZWNsYXJhdGlvbnMuXG4gKiBQbGVhc2Ugbm90ZSwgdGhhdCBpdCBkb2VzIG5vdCBzdXBwb3J0IGFueSBjb21wbGV4IHRoaW5ncyBsaWtlIG1lZGlhIHF1ZXJpZXMgYW5kIHN1Y2guXG4gKi9cblxudmFyIEV4dGVuZGVkQ3NzUGFyc2VyID0gZnVuY3Rpb24gKCkge1xuICB2YXIgcmVEZWNsRW5kID0gL1s7fV0vZztcbiAgdmFyIHJlRGVjbERpdmlkZXIgPSAvWzs6fV0vZztcbiAgdmFyIHJlTm9uV2hpdGVzcGFjZSA9IC9cXFMvZztcbiAgdmFyIFNpenpsZTtcbiAgLyoqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBjc3NUZXh0XG4gICAqIEBjb25zdHJ1Y3RvclxuICAgKi9cblxuICBmdW5jdGlvbiBQYXJzZXIoY3NzVGV4dCkge1xuICAgIHRoaXMuY3NzVGV4dCA9IGNzc1RleHQ7XG4gIH1cblxuICBQYXJzZXIucHJvdG90eXBlID0ge1xuICAgIGVycm9yOiBmdW5jdGlvbiBlcnJvcihwb3NpdGlvbikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ3NzUGFyc2VyOiBwYXJzZSBlcnJvciBhdCBwb3NpdGlvbiBcIi5jb25jYXQodGhpcy5wb3NPZmZzZXQgKyBwb3NpdGlvbikpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBWYWxpZGF0ZXMgdGhhdCB0aGUgdG9rZW5zIGNvcnJlc3BvbmQgdG8gYSB2YWxpZCBzZWxlY3Rvci5cbiAgICAgKiBTaXp6bGUgaXMgZGlmZmVyZW50IGZyb20gYnJvd3NlcnMgYW5kIHNvbWUgc2VsZWN0b3JzIHRoYXQgaXQgdG9sZXJhdGVzIGFyZW4ndCBhY3R1YWxseSB2YWxpZC5cbiAgICAgKiBGb3IgaW5zdGFuY2UsIFwiZGl2ID5cIiB3b24ndCB3b3JrIGluIGEgYnJvd3NlciwgYnV0IGl0IHdpbGwgaW4gU2l6emxlIChpdCdkIGJlIHRoZSBzYW1lIGFzIFwiZGl2ID4gKlwiKS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7Kn0gc2VsZWN0b3JzIEFuIGFycmF5IG9mIFNlbGVjdG9yRGF0YSAoc2VsZWN0b3IsIGdyb3VwcylcbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gZmFsc2UgaWYgYW55IG9mIHRoZSBncm91cHMgYXJlIGludmFsaWRcbiAgICAgKi9cbiAgICB2YWxpZGF0ZVNlbGVjdG9yczogZnVuY3Rpb24gdmFsaWRhdGVTZWxlY3RvcnMoc2VsZWN0b3JzKSB7XG4gICAgICB2YXIgaVNlbGVjdG9ycyA9IHNlbGVjdG9ycy5sZW5ndGg7XG5cbiAgICAgIHdoaWxlIChpU2VsZWN0b3JzLS0pIHtcbiAgICAgICAgdmFyIGdyb3VwcyA9IHNlbGVjdG9yc1tpU2VsZWN0b3JzXS5ncm91cHM7XG4gICAgICAgIHZhciBpR3JvdXBzID0gZ3JvdXBzLmxlbmd0aDtcblxuICAgICAgICB3aGlsZSAoaUdyb3Vwcy0tKSB7XG4gICAgICAgICAgdmFyIHRva2VucyA9IGdyb3Vwc1tpR3JvdXBzXTtcbiAgICAgICAgICB2YXIgbGFzdFRva2VuID0gdG9rZW5zW3Rva2Vucy5sZW5ndGggLSAxXTtcblxuICAgICAgICAgIGlmIChTaXp6bGUuc2VsZWN0b3JzLnJlbGF0aXZlW2xhc3RUb2tlbi50eXBlXSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogUGFyc2VzIGEgc3R5bGVzaGVldCBhbmQgcmV0dXJucyBhIGxpc3Qgb2YgcGFpcnMgb2YgYW4gRXh0ZW5kZWRTZWxlY3RvciBhbmQgYSBzdHlsZXMgbWFwLlxuICAgICAqIFRoaXMgbWV0aG9kIHdpbGwgdGhyb3cgYW4gZXJyb3IgaW4gY2FzZSBvZiBhbiBvYnZpb3VzbHkgaW52YWxpZCBpbnB1dC5cbiAgICAgKiBJZiBhbnkgb2YgdGhlIHNlbGVjdG9ycyB1c2VkIGluIHRoZSBzdHlsZXNoZWV0IGNhbm5vdCBiZSBjb21waWxlZCBpbnRvIGFuIEV4dGVuZGVkU2VsZWN0b3IsXG4gICAgICogaXQgd2lsbCBiZSBpZ25vcmVkLlxuICAgICAqXG4gICAgICogQHR5cGVkZWYge09iamVjdH0gRXh0ZW5kZWRTdHlsZVxuICAgICAqIEBwcm9wZXJ0eSB7T2JqZWN0fSBzZWxlY3RvciBBbiBpbnN0YW5jZSBvZiB0aGUge0BsaW5rIEV4dGVuZGVkU2VsZWN0b3J9IGNsYXNzXG4gICAgICogQHByb3BlcnR5IHtPYmplY3R9IHN0eWxlTWFwIEEgbWFwIG9mIHN0eWxlcyBwYXJzZWRcbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtBcnJheS48RXh0ZW5kZWRTdHlsZT59IEFuIGFycmF5IG9mIHRoZSBzdHlsZXMgcGFyc2VkXG4gICAgICovXG4gICAgcGFyc2VDc3M6IGZ1bmN0aW9uIHBhcnNlQ3NzKCkge1xuICAgICAgdGhpcy5wb3NPZmZzZXQgPSAwO1xuXG4gICAgICBpZiAoIXRoaXMuY3NzVGV4dCkge1xuICAgICAgICB0aGlzLmVycm9yKDApO1xuICAgICAgfVxuXG4gICAgICB2YXIgcmVzdWx0cyA9IFtdO1xuXG4gICAgICB3aGlsZSAodGhpcy5jc3NUZXh0KSB7XG4gICAgICAgIC8vIEFwcGx5IHRvbGVyYW50IHRva2VuaXphdGlvbi5cbiAgICAgICAgdmFyIHBhcnNlUmVzdWx0ID0gU2l6emxlLnRva2VuaXplKHRoaXMuY3NzVGV4dCwgZmFsc2UsIHtcbiAgICAgICAgICB0b2xlcmFudDogdHJ1ZSxcbiAgICAgICAgICByZXR1cm5VbnNvcnRlZDogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgICAgdmFyIHNlbGVjdG9yRGF0YSA9IHBhcnNlUmVzdWx0LnNlbGVjdG9ycztcbiAgICAgICAgdGhpcy5uZXh0SW5kZXggPSBwYXJzZVJlc3VsdC5uZXh0SW5kZXg7XG5cbiAgICAgICAgaWYgKHRoaXMuY3NzVGV4dC5jaGFyQ29kZUF0KHRoaXMubmV4dEluZGV4KSAhPT0gMTIzIHx8XG4gICAgICAgIC8qIGNoYXJDb2RlIG9mICd7JyAqL1xuICAgICAgICAhdGhpcy52YWxpZGF0ZVNlbGVjdG9ycyhzZWxlY3RvckRhdGEpKSB7XG4gICAgICAgICAgdGhpcy5lcnJvcih0aGlzLm5leHRJbmRleCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLm5leHRJbmRleCsrOyAvLyBNb3ZlIHRoZSBwb2ludGVyIHRvIHRoZSBzdGFydCBvZiBzdHlsZSBkZWNsYXJhdGlvbi5cblxuICAgICAgICB2YXIgc3R5bGVNYXAgPSB0aGlzLnBhcnNlTmV4dFN0eWxlKCk7XG4gICAgICAgIHZhciBkZWJ1ZyA9IGZhbHNlOyAvLyBJZiB0aGVyZSBpcyBhIHN0eWxlIHByb3BlcnR5ICdkZWJ1ZycsIG1hcmsgdGhlIHNlbGVjdG9yXG4gICAgICAgIC8vIGFzIGEgZGVidWdnYWJsZSBzZWxlY3RvciwgYW5kIGRlbGV0ZSB0aGUgc3R5bGUgZGVjbGFyYXRpb24uXG5cbiAgICAgICAgdmFyIGRlYnVnUHJvcGVydHlWYWx1ZSA9IHN0eWxlTWFwWydkZWJ1ZyddO1xuXG4gICAgICAgIGlmICh0eXBlb2YgZGVidWdQcm9wZXJ0eVZhbHVlICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgIGlmIChkZWJ1Z1Byb3BlcnR5VmFsdWUgPT09ICdnbG9iYWwnKSB7XG4gICAgICAgICAgICBFeHRlbmRlZFNlbGVjdG9yRmFjdG9yeS5lbmFibGVHbG9iYWxEZWJ1Z2dpbmcoKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBkZWJ1ZyA9IHRydWU7XG4gICAgICAgICAgZGVsZXRlIHN0eWxlTWFwWydkZWJ1ZyddO1xuICAgICAgICB9IC8vIENyZWF0aW5nIGFuIEV4dGVuZGVkU2VsZWN0b3IgaW5zdGFuY2UgZm9yIGV2ZXJ5IHNlbGVjdG9yIHdlIGdvdCBmcm9tIFNpenpsZS50b2tlbml6ZS5cbiAgICAgICAgLy8gVGhpcyBpcyBxdWl0ZSBpbXBvcnRhbnQgYXMgU2l6emxlIGRvZXMgYSBwb29yIGpvYiBhdCBleGVjdXRpbmcgc2VsZWN0b3JzIGxpa2UgXCJzZWxlY3RvcjEsIHNlbGVjdG9yMlwiLlxuXG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBzZWxlY3RvckRhdGEubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG4gICAgICAgICAgdmFyIGRhdGEgPSBzZWxlY3RvckRhdGFbaV07XG5cbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgdmFyIGV4dGVuZGVkU2VsZWN0b3IgPSBFeHRlbmRlZFNlbGVjdG9yRmFjdG9yeS5jcmVhdGVTZWxlY3RvcihkYXRhLnNlbGVjdG9yVGV4dCwgZGF0YS5ncm91cHMsIGRlYnVnKTtcblxuICAgICAgICAgICAgaWYgKGV4dGVuZGVkU2VsZWN0b3IucHNldWRvQ2xhc3NBcmcgJiYgZXh0ZW5kZWRTZWxlY3Rvci5pc1JlbW92ZVNlbGVjdG9yKSB7XG4gICAgICAgICAgICAgIC8vIGlmIHRoZXJlIGlzIHJlbW92ZSBwc2V1ZG8tY2xhc3MgaW4gcnVsZSxcbiAgICAgICAgICAgICAgLy8gdGhlIGVsZW1lbnQgd2lsbCBiZSByZW1vdmVkIGFuZCBubyBvdGhlciBzdHlsZXMgd2lsbCBiZSBhcHBsaWVkXG4gICAgICAgICAgICAgIHN0eWxlTWFwWydyZW1vdmUnXSA9ICd0cnVlJztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmVzdWx0cy5wdXNoKHtcbiAgICAgICAgICAgICAgc2VsZWN0b3I6IGV4dGVuZGVkU2VsZWN0b3IsXG4gICAgICAgICAgICAgIHN0eWxlOiBzdHlsZU1hcFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSBjYXRjaCAoZXgpIHtcbiAgICAgICAgICAgIHV0aWxzLmxvZ0Vycm9yKFwiRXh0ZW5kZWRDc3NQYXJzZXI6IGlnbm9yaW5nIGludmFsaWQgc2VsZWN0b3IgXCIuY29uY2F0KGRhdGEuc2VsZWN0b3JUZXh0KSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiByZXN1bHRzO1xuICAgIH0sXG4gICAgcGFyc2VOZXh0U3R5bGU6IGZ1bmN0aW9uIHBhcnNlTmV4dFN0eWxlKCkge1xuICAgICAgdmFyIHN0eWxlTWFwID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICAgIHZhciBicmFja2V0UG9zID0gdGhpcy5wYXJzZVVudGlsQ2xvc2luZ0JyYWNrZXQoc3R5bGVNYXApOyAvLyBDdXQgb3V0IG1hdGNoZWQgcG9ydGlvbiBmcm9tIGNzc1RleHQuXG5cbiAgICAgIHJlTm9uV2hpdGVzcGFjZS5sYXN0SW5kZXggPSBicmFja2V0UG9zICsgMTtcbiAgICAgIHZhciBtYXRjaCA9IHJlTm9uV2hpdGVzcGFjZS5leGVjKHRoaXMuY3NzVGV4dCk7XG5cbiAgICAgIGlmIChtYXRjaCA9PT0gbnVsbCkge1xuICAgICAgICB0aGlzLmNzc1RleHQgPSAnJztcbiAgICAgICAgcmV0dXJuIHN0eWxlTWFwO1xuICAgICAgfVxuXG4gICAgICB2YXIgbWF0Y2hQb3MgPSBtYXRjaC5pbmRleDtcbiAgICAgIHRoaXMuY3NzVGV4dCA9IHRoaXMuY3NzVGV4dC5zbGljZShtYXRjaFBvcyk7XG4gICAgICB0aGlzLnBvc09mZnNldCArPSBtYXRjaFBvcztcbiAgICAgIHJldHVybiBzdHlsZU1hcDtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQHJldHVybiB7bnVtYmVyfSBhbiBpbmRleCBvZiB0aGUgbmV4dCAnfScgaW4gYHRoaXMuY3NzVGV4dGAuXG4gICAgICovXG4gICAgcGFyc2VVbnRpbENsb3NpbmdCcmFja2V0OiBmdW5jdGlvbiBwYXJzZVVudGlsQ2xvc2luZ0JyYWNrZXQoc3R5bGVNYXApIHtcbiAgICAgIC8vIEV4cGVjdHMgXCI6XCIsIFwiO1wiLCBhbmQgXCJ9XCIuXG4gICAgICByZURlY2xEaXZpZGVyLmxhc3RJbmRleCA9IHRoaXMubmV4dEluZGV4O1xuICAgICAgdmFyIG1hdGNoID0gcmVEZWNsRGl2aWRlci5leGVjKHRoaXMuY3NzVGV4dCk7XG5cbiAgICAgIGlmIChtYXRjaCA9PT0gbnVsbCkge1xuICAgICAgICB0aGlzLmVycm9yKHRoaXMubmV4dEluZGV4KTtcbiAgICAgIH1cblxuICAgICAgdmFyIG1hdGNoUG9zID0gbWF0Y2guaW5kZXg7XG4gICAgICB2YXIgbWF0Y2hlZCA9IG1hdGNoWzBdO1xuXG4gICAgICBpZiAobWF0Y2hlZCA9PT0gJ30nKSB7XG4gICAgICAgIHJldHVybiBtYXRjaFBvcztcbiAgICAgIH1cblxuICAgICAgaWYgKG1hdGNoZWQgPT09ICc6Jykge1xuICAgICAgICB2YXIgY29sb25JbmRleCA9IG1hdGNoUG9zOyAvLyBFeHBlY3RzIFwiO1wiIGFuZCBcIn1cIi5cblxuICAgICAgICByZURlY2xFbmQubGFzdEluZGV4ID0gY29sb25JbmRleDtcbiAgICAgICAgbWF0Y2ggPSByZURlY2xFbmQuZXhlYyh0aGlzLmNzc1RleHQpO1xuXG4gICAgICAgIGlmIChtYXRjaCA9PT0gbnVsbCkge1xuICAgICAgICAgIHRoaXMuZXJyb3IoY29sb25JbmRleCk7XG4gICAgICAgIH1cblxuICAgICAgICBtYXRjaFBvcyA9IG1hdGNoLmluZGV4O1xuICAgICAgICBtYXRjaGVkID0gbWF0Y2hbMF07IC8vIFBvcHVsYXRlcyB0aGUgYHN0eWxlTWFwYCBrZXktdmFsdWUgbWFwLlxuXG4gICAgICAgIHZhciBwcm9wZXJ0eSA9IHRoaXMuY3NzVGV4dC5zbGljZSh0aGlzLm5leHRJbmRleCwgY29sb25JbmRleCkudHJpbSgpO1xuICAgICAgICB2YXIgdmFsdWUgPSB0aGlzLmNzc1RleHQuc2xpY2UoY29sb25JbmRleCArIDEsIG1hdGNoUG9zKS50cmltKCk7XG4gICAgICAgIHN0eWxlTWFwW3Byb3BlcnR5XSA9IHZhbHVlOyAvLyBJZiBmb3VuZCBcIn1cIiwgcmUtcnVuIHRoZSBvdXRlciBsb29wLlxuXG4gICAgICAgIGlmIChtYXRjaGVkID09PSAnfScpIHtcbiAgICAgICAgICByZXR1cm4gbWF0Y2hQb3M7XG4gICAgICAgIH1cbiAgICAgIH0gLy8gbWF0Y2hQb3MgaXMgdGhlIHBvc2l0aW9uIG9mIHRoZSBuZXh0ICc7Jy5cbiAgICAgIC8vIEluY3JlYXNlICduZXh0SW5kZXgnIGFuZCByZS1ydW4gdGhlIGxvb3AuXG5cblxuICAgICAgdGhpcy5uZXh0SW5kZXggPSBtYXRjaFBvcyArIDE7XG4gICAgICByZXR1cm4gdGhpcy5wYXJzZVVudGlsQ2xvc2luZ0JyYWNrZXQoc3R5bGVNYXApOyAvLyBTaG91bGQgYmUgYSBzdWJqZWN0IG9mIHRhaWwtY2FsbCBvcHRpbWl6YXRpb24uXG4gICAgfVxuICB9O1xuICByZXR1cm4ge1xuICAgIHBhcnNlQ3NzOiBmdW5jdGlvbiBwYXJzZUNzcyhjc3NUZXh0KSB7XG4gICAgICBTaXp6bGUgPSBpbml0aWFsaXplU2l6emxlKCk7XG4gICAgICByZXR1cm4gbmV3IFBhcnNlcihjc3NVdGlscy5ub3JtYWxpemUoY3NzVGV4dCkpLnBhcnNlQ3NzKCk7XG4gICAgfVxuICB9O1xufSgpO1xuXG4vKipcbiAqIFRoaXMgY2FsbGJhY2sgaXMgdXNlZCB0byBnZXQgYWZmZWN0ZWQgbm9kZSBlbGVtZW50cyBhbmQgaGFuZGxlIHN0eWxlIHByb3BlcnRpZXNcbiAqIGJlZm9yZSB0aGV5IGFyZSBhcHBsaWVkIHRvIHRoZW0gaWYgaXQgaXMgbmVjZXNzYXJ5XG4gKiBAY2FsbGJhY2sgYmVmb3JlU3R5bGVBcHBsaWVkXG4gKiBAcGFyYW0ge29iamVjdH0gYWZmZWN0ZWRFbGVtZW50IC0gT2JqZWN0IGNvbnRhaW5pbmcgRE9NIG5vZGUgYW5kIHJ1bGUgdG8gYmUgYXBwbGllZFxuICogQHJldHVybiB7b2JqZWN0fSBhZmZlY3RlZEVsZW1lbnQgLSBTYW1lIG9yIG1vZGlmaWVkIG9iamVjdCBjb250YWluaW5nIERPTSBub2RlIGFuZCBydWxlIHRvIGJlIGFwcGxpZWRcbiAqL1xuXG4vKipcbiAqIEV4dGVuZGVkIGNzcyBjbGFzc1xuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWd1cmF0aW9uXG4gKiBAcGFyYW0ge3N0cmluZ30gY29uZmlndXJhdGlvbi5zdHlsZVNoZWV0IC0gdGhlIENTUyBzdHlsZXNoZWV0IHRleHRcbiAqIEBwYXJhbSB7YmVmb3JlU3R5bGVBcHBsaWVkfSBbY29uZmlndXJhdGlvbi5iZWZvcmVTdHlsZUFwcGxpZWRdIC0gdGhlIGNhbGxiYWNrIHRoYXQgaGFuZGxlcyBhZmZlY3RlZCBlbGVtZW50c1xuICogQGNvbnN0cnVjdG9yXG4gKi9cblxuZnVuY3Rpb24gRXh0ZW5kZWRDc3MoY29uZmlndXJhdGlvbikge1xuICBpZiAoIWNvbmZpZ3VyYXRpb24pIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0NvbmZpZ3VyYXRpb24gaXMgbm90IHByb3ZpZGVkLicpO1xuICB9XG5cbiAgdmFyIHN0eWxlU2hlZXQgPSBjb25maWd1cmF0aW9uLnN0eWxlU2hlZXQ7XG4gIHZhciBiZWZvcmVTdHlsZUFwcGxpZWQgPSBjb25maWd1cmF0aW9uLmJlZm9yZVN0eWxlQXBwbGllZDtcblxuICBpZiAoYmVmb3JlU3R5bGVBcHBsaWVkICYmIHR5cGVvZiBiZWZvcmVTdHlsZUFwcGxpZWQgIT09ICdmdW5jdGlvbicpIHtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LWxlblxuICAgIHRocm93IG5ldyBFcnJvcihcIldyb25nIGNvbmZpZ3VyYXRpb24uIFR5cGUgb2YgJ2JlZm9yZVN0eWxlQXBwbGllZCcgZmllbGQgc2hvdWxkIGJlIGEgZnVuY3Rpb24sIHJlY2VpdmVkOiBcIi5jb25jYXQoX3R5cGVvZihiZWZvcmVTdHlsZUFwcGxpZWQpKSk7XG4gIH0gLy8gV2UgdXNlIEV2ZW50VHJhY2tlciB0byB0cmFjayB0aGUgZXZlbnQgdGhhdCBpcyBsaWtlbHkgdG8gY2F1c2UgdGhlIG11dGF0aW9uLlxuICAvLyBUaGUgcHJvYmxlbSBpcyB0aGF0IHdlIGNhbm5vdCB1c2UgYHdpbmRvdy5ldmVudGAgZGlyZWN0bHkgZnJvbSB0aGUgbXV0YXRpb24gb2JzZXJ2ZXIgY2FsbFxuICAvLyBhcyB3ZSdyZSBub3QgaW4gdGhlIGV2ZW50IGhhbmRsZXIgY29udGV4dCBhbnltb3JlLlxuXG5cbiAgdmFyIEV2ZW50VHJhY2tlciA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgaWdub3JlZEV2ZW50VHlwZXMgPSBbJ21vdXNlb3ZlcicsICdtb3VzZWxlYXZlJywgJ21vdXNlZW50ZXInLCAnbW91c2VvdXQnXTtcbiAgICB2YXIgTEFTVF9FVkVOVF9USU1FT1VUX01TID0gMTA7XG4gICAgdmFyIEVWRU5UUyA9IFsvLyBrZXlib2FyZCBldmVudHNcbiAgICAna2V5ZG93bicsICdrZXlwcmVzcycsICdrZXl1cCcsIC8vIG1vdXNlIGV2ZW50c1xuICAgICdhdXhjbGljaycsICdjbGljaycsICdjb250ZXh0bWVudScsICdkYmxjbGljaycsICdtb3VzZWRvd24nLCAnbW91c2VlbnRlcicsICdtb3VzZWxlYXZlJywgJ21vdXNlbW92ZScsICdtb3VzZW92ZXInLCAnbW91c2VvdXQnLCAnbW91c2V1cCcsICdwb2ludGVybG9ja2NoYW5nZScsICdwb2ludGVybG9ja2Vycm9yJywgJ3NlbGVjdCcsICd3aGVlbCddOyAvLyAnd2hlZWwnIGV2ZW50IG1ha2VzIHNjcm9sbGluZyBpbiBTYWZhcmkgdHdpdGNoeVxuICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9BZGd1YXJkVGVhbS9FeHRlbmRlZENzcy9pc3N1ZXMvMTIwXG5cbiAgICB2YXIgc2FmYXJpUHJvYmxlbWF0aWNFdmVudHMgPSBbJ3doZWVsJ107XG4gICAgdmFyIHRyYWNrZWRFdmVudHMgPSB1dGlscy5pc1NhZmFyaUJyb3dzZXIgPyBFVkVOVFMuZmlsdGVyKGZ1bmN0aW9uIChlbCkge1xuICAgICAgcmV0dXJuICEoc2FmYXJpUHJvYmxlbWF0aWNFdmVudHMuaW5kZXhPZihlbCkgPiAtMSk7XG4gICAgfSkgOiBFVkVOVFM7XG4gICAgdmFyIGxhc3RFdmVudFR5cGU7XG4gICAgdmFyIGxhc3RFdmVudFRpbWU7XG5cbiAgICB2YXIgdHJhY2tFdmVudCA9IGZ1bmN0aW9uIHRyYWNrRXZlbnQoZSkge1xuICAgICAgbGFzdEV2ZW50VHlwZSA9IGUudHlwZTtcbiAgICAgIGxhc3RFdmVudFRpbWUgPSBEYXRlLm5vdygpO1xuICAgIH07XG5cbiAgICB0cmFja2VkRXZlbnRzLmZvckVhY2goZnVuY3Rpb24gKGV2TmFtZSkge1xuICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoZXZOYW1lLCB0cmFja0V2ZW50LCB0cnVlKTtcbiAgICB9KTtcblxuICAgIHZhciBnZXRMYXN0RXZlbnRUeXBlID0gZnVuY3Rpb24gZ2V0TGFzdEV2ZW50VHlwZSgpIHtcbiAgICAgIHJldHVybiBsYXN0RXZlbnRUeXBlO1xuICAgIH07XG5cbiAgICB2YXIgZ2V0VGltZVNpbmNlTGFzdEV2ZW50ID0gZnVuY3Rpb24gZ2V0VGltZVNpbmNlTGFzdEV2ZW50KCkge1xuICAgICAgcmV0dXJuIERhdGUubm93KCkgLSBsYXN0RXZlbnRUaW1lO1xuICAgIH07XG5cbiAgICByZXR1cm4ge1xuICAgICAgaXNJZ25vcmVkRXZlbnRUeXBlOiBmdW5jdGlvbiBpc0lnbm9yZWRFdmVudFR5cGUoKSB7XG4gICAgICAgIHJldHVybiBpZ25vcmVkRXZlbnRUeXBlcy5pbmRleE9mKGdldExhc3RFdmVudFR5cGUoKSkgPiAtMSAmJiBnZXRUaW1lU2luY2VMYXN0RXZlbnQoKSA8IExBU1RfRVZFTlRfVElNRU9VVF9NUztcbiAgICAgIH1cbiAgICB9O1xuICB9KCk7XG5cbiAgdmFyIHJ1bGVzID0gW107XG4gIHZhciBhZmZlY3RlZEVsZW1lbnRzID0gW107XG4gIHZhciByZW1vdmFsc1N0YXRpc3RpYyA9IHt9O1xuICB2YXIgZG9tT2JzZXJ2ZWQ7XG4gIHZhciBldmVudExpc3RlbmVyU3VwcG9ydGVkID0gd2luZG93LmFkZEV2ZW50TGlzdGVuZXI7XG4gIHZhciBkb21NdXRhdGlvbk9ic2VydmVyO1xuXG4gIGZ1bmN0aW9uIG9ic2VydmVEb2N1bWVudChjYWxsYmFjaykge1xuICAgIC8vIFdlIGFyZSB0cnlpbmcgdG8gbGltaXQgdGhlIG51bWJlciBvZiBjYWxsYmFjayBjYWxscyBieSBub3QgY2FsbGluZyBpdCBvbiBhbGwga2luZCBvZiBcImhvdmVyXCIgZXZlbnRzLlxuICAgIC8vIFRoZSByYXRpb25hbGUgYmVoaW5kIHRoaXMgaXMgdGhhdCBcImhvdmVyXCIgZXZlbnRzIG9mdGVuIGNhdXNlIGF0dHJpYnV0ZXMgbW9kaWZpY2F0aW9uLFxuICAgIC8vIGJ1dCByZS1hcHBseWluZyBleHRDU1MgcnVsZXMgd2lsbCBiZSB1c2VsZXNzIGFzIHRoZXNlIGF0dHJpYnV0ZSBjaGFuZ2VzIGFyZSB1c3VhbGx5IHRyYW5zaWVudC5cbiAgICB2YXIgaXNJZ25vcmVkTXV0YXRpb24gPSBmdW5jdGlvbiBpc0lnbm9yZWRNdXRhdGlvbihtdXRhdGlvbnMpIHtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbXV0YXRpb25zLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgIGlmIChtdXRhdGlvbnMudHlwZSAhPT0gJ2F0dHJpYnV0ZXMnKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH07XG5cbiAgICBpZiAodXRpbHMuTXV0YXRpb25PYnNlcnZlcikge1xuICAgICAgZG9tTXV0YXRpb25PYnNlcnZlciA9IG5ldyB1dGlscy5NdXRhdGlvbk9ic2VydmVyKGZ1bmN0aW9uIChtdXRhdGlvbnMpIHtcbiAgICAgICAgaWYgKCFtdXRhdGlvbnMgfHwgbXV0YXRpb25zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChFdmVudFRyYWNrZXIuaXNJZ25vcmVkRXZlbnRUeXBlKCkgJiYgaXNJZ25vcmVkTXV0YXRpb24obXV0YXRpb25zKSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICB9KTtcbiAgICAgIGRvbU11dGF0aW9uT2JzZXJ2ZXIub2JzZXJ2ZShkb2N1bWVudCwge1xuICAgICAgICBjaGlsZExpc3Q6IHRydWUsXG4gICAgICAgIHN1YnRyZWU6IHRydWUsXG4gICAgICAgIGF0dHJpYnV0ZXM6IHRydWUsXG4gICAgICAgIGF0dHJpYnV0ZUZpbHRlcjogWydpZCcsICdjbGFzcyddXG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKGV2ZW50TGlzdGVuZXJTdXBwb3J0ZWQpIHtcbiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTU5vZGVJbnNlcnRlZCcsIGNhbGxiYWNrLCBmYWxzZSk7XG4gICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Ob2RlUmVtb3ZlZCcsIGNhbGxiYWNrLCBmYWxzZSk7XG4gICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01BdHRyTW9kaWZpZWQnLCBjYWxsYmFjaywgZmFsc2UpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGRpc2Nvbm5lY3REb2N1bWVudChjYWxsYmFjaykge1xuICAgIGlmIChkb21NdXRhdGlvbk9ic2VydmVyKSB7XG4gICAgICBkb21NdXRhdGlvbk9ic2VydmVyLmRpc2Nvbm5lY3QoKTtcbiAgICB9IGVsc2UgaWYgKGV2ZW50TGlzdGVuZXJTdXBwb3J0ZWQpIHtcbiAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ0RPTU5vZGVJbnNlcnRlZCcsIGNhbGxiYWNrLCBmYWxzZSk7XG4gICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdET01Ob2RlUmVtb3ZlZCcsIGNhbGxiYWNrLCBmYWxzZSk7XG4gICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdET01BdHRyTW9kaWZpZWQnLCBjYWxsYmFjaywgZmFsc2UpO1xuICAgIH1cbiAgfVxuXG4gIHZhciBNQVhfU1RZTEVfUFJPVEVDVElPTl9DT1VOVCA9IDUwO1xuICB2YXIgcHJvdGVjdGlvbk9ic2VydmVyT3B0aW9uID0ge1xuICAgIGF0dHJpYnV0ZXM6IHRydWUsXG4gICAgYXR0cmlidXRlT2xkVmFsdWU6IHRydWUsXG4gICAgYXR0cmlidXRlRmlsdGVyOiBbJ3N0eWxlJ11cbiAgfTtcbiAgLyoqXG4gICAqIENyZWF0ZXMgTXV0YXRpb25PYnNlcnZlciBwcm90ZWN0aW9uIGZ1bmN0aW9uXG4gICAqXG4gICAqIEBwYXJhbSBzdHlsZXNcbiAgICogQHJldHVybiB7cHJvdGVjdGlvbkZ1bmN0aW9ufVxuICAgKi9cblxuICBmdW5jdGlvbiBjcmVhdGVQcm90ZWN0aW9uRnVuY3Rpb24oc3R5bGVzKSB7XG4gICAgZnVuY3Rpb24gcHJvdGVjdGlvbkZ1bmN0aW9uKG11dGF0aW9ucywgb2JzZXJ2ZXIpIHtcbiAgICAgIGlmICghbXV0YXRpb25zLmxlbmd0aCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHZhciBtdXRhdGlvbiA9IG11dGF0aW9uc1swXTtcbiAgICAgIHZhciB0YXJnZXQgPSBtdXRhdGlvbi50YXJnZXQ7XG4gICAgICBvYnNlcnZlci5kaXNjb25uZWN0KCk7XG4gICAgICBzdHlsZXMuZm9yRWFjaChmdW5jdGlvbiAoc3R5bGUpIHtcbiAgICAgICAgc2V0U3R5bGVUb0VsZW1lbnQodGFyZ2V0LCBzdHlsZSk7XG4gICAgICB9KTtcblxuICAgICAgaWYgKCsrb2JzZXJ2ZXIuc3R5bGVQcm90ZWN0aW9uQ291bnQgPCBNQVhfU1RZTEVfUFJPVEVDVElPTl9DT1VOVCkge1xuICAgICAgICBvYnNlcnZlci5vYnNlcnZlKHRhcmdldCwgcHJvdGVjdGlvbk9ic2VydmVyT3B0aW9uKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHV0aWxzLmxvZ0Vycm9yKCdFeHRlbmRlZENzczogaW5maW5pdGUgbG9vcCBwcm90ZWN0aW9uIGZvciBzdHlsZScpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBwcm90ZWN0aW9uRnVuY3Rpb247XG4gIH1cbiAgLyoqXG4gICAqIFNldHMgdXAgYSBNdXRhdGlvbk9ic2VydmVyIHdoaWNoIHByb3RlY3RzIHN0eWxlIGF0dHJpYnV0ZXMgZnJvbSBjaGFuZ2VzXG4gICAqIEBwYXJhbSBub2RlIERPTSBub2RlXG4gICAqIEBwYXJhbSBydWxlcyBydWxlc1xuICAgKiBAcmV0dXJucyBNdXRhdGlvbiBvYnNlcnZlciB1c2VkIHRvIHByb3RlY3QgYXR0cmlidXRlIG9yIG51bGwgaWYgdGhlcmUncyBub3RoaW5nIHRvIHByb3RlY3RcbiAgICovXG5cblxuICBmdW5jdGlvbiBwcm90ZWN0U3R5bGVBdHRyaWJ1dGUobm9kZSwgcnVsZXMpIHtcbiAgICBpZiAoIXV0aWxzLk11dGF0aW9uT2JzZXJ2ZXIpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHZhciBzdHlsZXMgPSBydWxlcy5tYXAoZnVuY3Rpb24gKHIpIHtcbiAgICAgIHJldHVybiByLnN0eWxlO1xuICAgIH0pO1xuICAgIHZhciBwcm90ZWN0aW9uT2JzZXJ2ZXIgPSBuZXcgdXRpbHMuTXV0YXRpb25PYnNlcnZlcihjcmVhdGVQcm90ZWN0aW9uRnVuY3Rpb24oc3R5bGVzKSk7XG4gICAgcHJvdGVjdGlvbk9ic2VydmVyLm9ic2VydmUobm9kZSwgcHJvdGVjdGlvbk9ic2VydmVyT3B0aW9uKTsgLy8gQWRkcyBhbiBleHBhbmRvIHRvIHRoZSBvYnNlcnZlciB0byBrZWVwICdzdHlsZSBmaXggY291bnRzJy5cblxuICAgIHByb3RlY3Rpb25PYnNlcnZlci5zdHlsZVByb3RlY3Rpb25Db3VudCA9IDA7XG4gICAgcmV0dXJuIHByb3RlY3Rpb25PYnNlcnZlcjtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlbW92ZVN1ZmZpeChzdHIsIHN1ZmZpeCkge1xuICAgIHZhciBpbmRleCA9IHN0ci5pbmRleE9mKHN1ZmZpeCwgc3RyLmxlbmd0aCAtIHN1ZmZpeC5sZW5ndGgpO1xuXG4gICAgaWYgKGluZGV4ID49IDApIHtcbiAgICAgIHJldHVybiBzdHIuc3Vic3RyaW5nKDAsIGluZGV4KTtcbiAgICB9XG5cbiAgICByZXR1cm4gc3RyO1xuICB9XG4gIC8qKlxuICAgKiBGaW5kcyBhZmZlY3RlZEVsZW1lbnQgb2JqZWN0IGZvciB0aGUgc3BlY2lmaWVkIERPTSBub2RlXG4gICAqIEBwYXJhbSBub2RlICBET00gbm9kZVxuICAgKiBAcmV0dXJucyAgICAgYWZmZWN0ZWRFbGVtZW50IGZvdW5kIG9yIG51bGxcbiAgICovXG5cblxuICBmdW5jdGlvbiBmaW5kQWZmZWN0ZWRFbGVtZW50KG5vZGUpIHtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFmZmVjdGVkRWxlbWVudHMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgIGlmIChhZmZlY3RlZEVsZW1lbnRzW2ldLm5vZGUgPT09IG5vZGUpIHtcbiAgICAgICAgcmV0dXJuIGFmZmVjdGVkRWxlbWVudHNbaV07XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBmdW5jdGlvbiByZW1vdmVFbGVtZW50KGFmZmVjdGVkRWxlbWVudCkge1xuICAgIHZhciBub2RlID0gYWZmZWN0ZWRFbGVtZW50Lm5vZGU7XG4gICAgYWZmZWN0ZWRFbGVtZW50LnJlbW92ZWQgPSB0cnVlO1xuICAgIHZhciBlbGVtZW50U2VsZWN0b3IgPSB1dGlscy5nZXROb2RlU2VsZWN0b3Iobm9kZSk7IC8vIGNoZWNrIGlmIHRoZSBlbGVtZW50IGhhcyBiZWVuIGFscmVhZHkgcmVtb3ZlZCBlYXJsaWVyXG5cbiAgICB2YXIgZWxlbWVudFJlbW92YWxzQ291bnRlciA9IHJlbW92YWxzU3RhdGlzdGljW2VsZW1lbnRTZWxlY3Rvcl0gfHwgMDsgLy8gaWYgcmVtb3ZhbHMgYXR0ZW1wdHMgaGFwcGVuZWQgbW9yZSB0aGFuIHNwZWNpZmllZCB3ZSBkbyBub3QgdHJ5IHRvIHJlbW92ZSBub2RlIGFnYWluXG5cbiAgICBpZiAoZWxlbWVudFJlbW92YWxzQ291bnRlciA+IE1BWF9TVFlMRV9QUk9URUNUSU9OX0NPVU5UKSB7XG4gICAgICB1dGlscy5sb2dFcnJvcignRXh0ZW5kZWRDc3M6IGluZmluaXRlIGxvb3AgcHJvdGVjdGlvbiBmb3IgU0VMRUNUT1InLCBlbGVtZW50U2VsZWN0b3IpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChub2RlLnBhcmVudE5vZGUpIHtcbiAgICAgIG5vZGUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChub2RlKTtcbiAgICAgIHJlbW92YWxzU3RhdGlzdGljW2VsZW1lbnRTZWxlY3Rvcl0gPSBlbGVtZW50UmVtb3ZhbHNDb3VudGVyICsgMTtcbiAgICB9XG4gIH1cbiAgLyoqXG4gICAqIEFwcGxpZXMgc3R5bGUgdG8gdGhlIHNwZWNpZmllZCBET00gbm9kZVxuICAgKiBAcGFyYW0gYWZmZWN0ZWRFbGVtZW50IE9iamVjdCBjb250YWluaW5nIERPTSBub2RlIGFuZCBydWxlIHRvIGJlIGFwcGxpZWRcbiAgICovXG5cblxuICBmdW5jdGlvbiBhcHBseVN0eWxlKGFmZmVjdGVkRWxlbWVudCkge1xuICAgIGlmIChhZmZlY3RlZEVsZW1lbnQucHJvdGVjdGlvbk9ic2VydmVyKSB7XG4gICAgICAvLyBTdHlsZSBpcyBhbHJlYWR5IGFwcGxpZWQgYW5kIHByb3RlY3RlZCBieSB0aGUgb2JzZXJ2ZXJcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoYmVmb3JlU3R5bGVBcHBsaWVkKSB7XG4gICAgICBhZmZlY3RlZEVsZW1lbnQgPSBiZWZvcmVTdHlsZUFwcGxpZWQoYWZmZWN0ZWRFbGVtZW50KTtcblxuICAgICAgaWYgKCFhZmZlY3RlZEVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cblxuICAgIHZhciBfYWZmZWN0ZWRFbGVtZW50ID0gYWZmZWN0ZWRFbGVtZW50LFxuICAgICAgICBub2RlID0gX2FmZmVjdGVkRWxlbWVudC5ub2RlO1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhZmZlY3RlZEVsZW1lbnQucnVsZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBzdHlsZSA9IGFmZmVjdGVkRWxlbWVudC5ydWxlc1tpXS5zdHlsZTtcblxuICAgICAgaWYgKHN0eWxlWydyZW1vdmUnXSA9PT0gJ3RydWUnKSB7XG4gICAgICAgIHJlbW92ZUVsZW1lbnQoYWZmZWN0ZWRFbGVtZW50KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBzZXRTdHlsZVRvRWxlbWVudChub2RlLCBzdHlsZSk7XG4gICAgfVxuICB9XG4gIC8qKlxuICAgKiBTZXRzIHN0eWxlIHRvIHRoZSBzcGVjaWZpZWQgRE9NIG5vZGVcbiAgICogQHBhcmFtIG5vZGUgZWxlbWVudFxuICAgKiBAcGFyYW0gc3R5bGUgc3R5bGVcbiAgICovXG5cblxuICBmdW5jdGlvbiBzZXRTdHlsZVRvRWxlbWVudChub2RlLCBzdHlsZSkge1xuICAgIE9iamVjdC5rZXlzKHN0eWxlKS5mb3JFYWNoKGZ1bmN0aW9uIChwcm9wKSB7XG4gICAgICAvLyBBcHBseSB0aGlzIHN0eWxlIG9ubHkgdG8gZXhpc3RpbmcgcHJvcGVydGllc1xuICAgICAgLy8gV2UgY2FuJ3QgdXNlIGhhc093blByb3BlcnR5IGhlcmUgKGRvZXMgbm90IHdvcmsgaW4gRkYpXG4gICAgICBpZiAodHlwZW9mIG5vZGUuc3R5bGUuZ2V0UHJvcGVydHlWYWx1ZShwcm9wKSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgdmFyIHZhbHVlID0gc3R5bGVbcHJvcF07IC8vIEZpcnN0IHdlIHNob3VsZCByZW1vdmUgIWltcG9ydGFudCBhdHRyaWJ1dGUgKG9yIGl0IHdvbid0IGJlIGFwcGxpZWQnKVxuXG4gICAgICAgIHZhbHVlID0gcmVtb3ZlU3VmZml4KHZhbHVlLnRyaW0oKSwgJyFpbXBvcnRhbnQnKS50cmltKCk7XG4gICAgICAgIG5vZGUuc3R5bGUuc2V0UHJvcGVydHkocHJvcCwgdmFsdWUsICdpbXBvcnRhbnQnKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuICAvKipcbiAgICogUmV2ZXJ0cyBzdHlsZSBmb3IgdGhlIGFmZmVjdGVkIG9iamVjdFxuICAgKi9cblxuXG4gIGZ1bmN0aW9uIHJldmVydFN0eWxlKGFmZmVjdGVkRWxlbWVudCkge1xuICAgIGlmIChhZmZlY3RlZEVsZW1lbnQucHJvdGVjdGlvbk9ic2VydmVyKSB7XG4gICAgICBhZmZlY3RlZEVsZW1lbnQucHJvdGVjdGlvbk9ic2VydmVyLmRpc2Nvbm5lY3QoKTtcbiAgICB9XG5cbiAgICBhZmZlY3RlZEVsZW1lbnQubm9kZS5zdHlsZS5jc3NUZXh0ID0gYWZmZWN0ZWRFbGVtZW50Lm9yaWdpbmFsU3R5bGU7XG4gIH1cbiAgLyoqXG4gICAqIEFwcGxpZXMgc3BlY2lmaWVkIHJ1bGUgYW5kIHJldHVybnMgbGlzdCBvZiBlbGVtZW50cyBhZmZlY3RlZFxuICAgKiBAcGFyYW0gcnVsZSBSdWxlIHRvIGFwcGx5XG4gICAqIEByZXR1cm5zIExpc3Qgb2YgZWxlbWVudHMgYWZmZWN0ZWQgYnkgdGhpcyBydWxlXG4gICAqL1xuXG5cbiAgZnVuY3Rpb24gYXBwbHlSdWxlKHJ1bGUpIHtcbiAgICB2YXIgZGVidWcgPSBydWxlLnNlbGVjdG9yLmlzRGVidWdnaW5nKCk7XG4gICAgdmFyIHN0YXJ0O1xuXG4gICAgaWYgKGRlYnVnKSB7XG4gICAgICBzdGFydCA9IHV0aWxzLkFzeW5jV3JhcHBlci5ub3coKTtcbiAgICB9XG5cbiAgICB2YXIgc2VsZWN0b3IgPSBydWxlLnNlbGVjdG9yO1xuICAgIHZhciBub2RlcyA9IHNlbGVjdG9yLnF1ZXJ5U2VsZWN0b3JBbGwoKTtcbiAgICBub2Rlcy5mb3JFYWNoKGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICB2YXIgYWZmZWN0ZWRFbGVtZW50ID0gZmluZEFmZmVjdGVkRWxlbWVudChub2RlKTtcblxuICAgICAgaWYgKGFmZmVjdGVkRWxlbWVudCkge1xuICAgICAgICBhZmZlY3RlZEVsZW1lbnQucnVsZXMucHVzaChydWxlKTtcbiAgICAgICAgYXBwbHlTdHlsZShhZmZlY3RlZEVsZW1lbnQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gQXBwbHlpbmcgc3R5bGUgZmlyc3QgdGltZVxuICAgICAgICB2YXIgb3JpZ2luYWxTdHlsZSA9IG5vZGUuc3R5bGUuY3NzVGV4dDtcbiAgICAgICAgYWZmZWN0ZWRFbGVtZW50ID0ge1xuICAgICAgICAgIG5vZGU6IG5vZGUsXG4gICAgICAgICAgLy8gYWZmZWN0ZWQgRE9NIG5vZGVcbiAgICAgICAgICBydWxlczogW3J1bGVdLFxuICAgICAgICAgIC8vIHJ1bGVzIHRvIGJlIGFwcGxpZWRcbiAgICAgICAgICBvcmlnaW5hbFN0eWxlOiBvcmlnaW5hbFN0eWxlLFxuICAgICAgICAgIC8vIG9yaWdpbmFsIG5vZGUgc3R5bGVcbiAgICAgICAgICBwcm90ZWN0aW9uT2JzZXJ2ZXI6IG51bGwgLy8gc3R5bGUgYXR0cmlidXRlIG9ic2VydmVyXG5cbiAgICAgICAgfTtcbiAgICAgICAgYXBwbHlTdHlsZShhZmZlY3RlZEVsZW1lbnQpO1xuICAgICAgICBhZmZlY3RlZEVsZW1lbnRzLnB1c2goYWZmZWN0ZWRFbGVtZW50KTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGlmIChkZWJ1Zykge1xuICAgICAgdmFyIGVsYXBzZWQgPSB1dGlscy5Bc3luY1dyYXBwZXIubm93KCkgLSBzdGFydDtcblxuICAgICAgaWYgKCEoJ3RpbWluZ1N0YXRzJyBpbiBydWxlKSkge1xuICAgICAgICBydWxlLnRpbWluZ1N0YXRzID0gbmV3IHV0aWxzLlN0YXRzKCk7XG4gICAgICB9XG5cbiAgICAgIHJ1bGUudGltaW5nU3RhdHMucHVzaChlbGFwc2VkKTtcbiAgICB9XG5cbiAgICByZXR1cm4gbm9kZXM7XG4gIH1cbiAgLyoqXG4gICAqIEFwcGxpZXMgZmlsdGVyaW5nIHJ1bGVzXG4gICAqL1xuXG5cbiAgZnVuY3Rpb24gYXBwbHlSdWxlcygpIHtcbiAgICB2YXIgZWxlbWVudHNJbmRleCA9IFtdOyAvLyBzb21lIHJ1bGVzIGNvdWxkIG1ha2UgY2FsbCAtIHNlbGVjdG9yLnF1ZXJ5U2VsZWN0b3JBbGwoKSB0ZW1wb3JhcmlseSB0byBjaGFuZ2Ugbm9kZSBpZCBhdHRyaWJ1dGVcbiAgICAvLyB0aGlzIGNhdXNlZCBNdXRhdGlvbk9ic2VydmVyIHRvIGNhbGwgcmVjdXJzaXZlbHlcbiAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vQWRndWFyZFRlYW0vRXh0ZW5kZWRDc3MvaXNzdWVzLzgxXG5cbiAgICBzdG9wT2JzZXJ2ZSgpO1xuICAgIHJ1bGVzLmZvckVhY2goZnVuY3Rpb24gKHJ1bGUpIHtcbiAgICAgIHZhciBub2RlcyA9IGFwcGx5UnVsZShydWxlKTtcbiAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KGVsZW1lbnRzSW5kZXgsIG5vZGVzKTtcbiAgICB9KTsgLy8gTm93IHJldmVydCBzdHlsZXMgZm9yIGVsZW1lbnRzIHdoaWNoIGFyZSBubyBtb3JlIGFmZmVjdGVkXG5cbiAgICB2YXIgbCA9IGFmZmVjdGVkRWxlbWVudHMubGVuZ3RoOyAvLyBkbyBub3RoaW5nIGlmIHRoZXJlIGlzIG5vIGVsZW1lbnRzIHRvIHByb2Nlc3NcblxuICAgIGlmIChlbGVtZW50c0luZGV4Lmxlbmd0aCA+IDApIHtcbiAgICAgIHdoaWxlIChsLS0pIHtcbiAgICAgICAgdmFyIG9iaiA9IGFmZmVjdGVkRWxlbWVudHNbbF07XG5cbiAgICAgICAgaWYgKGVsZW1lbnRzSW5kZXguaW5kZXhPZihvYmoubm9kZSkgPT09IC0xKSB7XG4gICAgICAgICAgLy8gVGltZSB0byByZXZlcnQgc3R5bGVcbiAgICAgICAgICByZXZlcnRTdHlsZShvYmopO1xuICAgICAgICAgIGFmZmVjdGVkRWxlbWVudHMuc3BsaWNlKGwsIDEpO1xuICAgICAgICB9IGVsc2UgaWYgKCFvYmoucmVtb3ZlZCkge1xuICAgICAgICAgIC8vIEFkZCBzdHlsZSBwcm90ZWN0aW9uIG9ic2VydmVyXG4gICAgICAgICAgLy8gUHJvdGVjdCBcInN0eWxlXCIgYXR0cmlidXRlIGZyb20gY2hhbmdlc1xuICAgICAgICAgIGlmICghb2JqLnByb3RlY3Rpb25PYnNlcnZlcikge1xuICAgICAgICAgICAgb2JqLnByb3RlY3Rpb25PYnNlcnZlciA9IHByb3RlY3RTdHlsZUF0dHJpYnV0ZShvYmoubm9kZSwgb2JqLnJ1bGVzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IC8vIEFmdGVyIHN0eWxlcyBhcmUgYXBwbGllZCB3ZSBjYW4gc3RhcnQgb2JzZXJ2ZSBhZ2FpblxuXG5cbiAgICBvYnNlcnZlKCk7XG4gICAgcHJpbnRUaW1pbmdJbmZvKCk7XG4gIH1cblxuICB2YXIgQVBQTFlfUlVMRVNfREVMQVkgPSAxNTA7XG4gIHZhciBhcHBseVJ1bGVzU2NoZWR1bGVyID0gbmV3IHV0aWxzLkFzeW5jV3JhcHBlcihhcHBseVJ1bGVzLCBBUFBMWV9SVUxFU19ERUxBWSk7XG4gIHZhciBtYWluQ2FsbGJhY2sgPSBhcHBseVJ1bGVzU2NoZWR1bGVyLnJ1bi5iaW5kKGFwcGx5UnVsZXNTY2hlZHVsZXIpO1xuXG4gIGZ1bmN0aW9uIG9ic2VydmUoKSB7XG4gICAgaWYgKGRvbU9ic2VydmVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfSAvLyBIYW5kbGUgZHluYW1pY2FsbHkgYWRkZWQgZWxlbWVudHNcblxuXG4gICAgZG9tT2JzZXJ2ZWQgPSB0cnVlO1xuICAgIG9ic2VydmVEb2N1bWVudChtYWluQ2FsbGJhY2spO1xuICB9XG5cbiAgZnVuY3Rpb24gc3RvcE9ic2VydmUoKSB7XG4gICAgaWYgKCFkb21PYnNlcnZlZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGRvbU9ic2VydmVkID0gZmFsc2U7XG4gICAgZGlzY29ubmVjdERvY3VtZW50KG1haW5DYWxsYmFjayk7XG4gIH1cblxuICBmdW5jdGlvbiBhcHBseSgpIHtcbiAgICBhcHBseVJ1bGVzKCk7XG5cbiAgICBpZiAoZG9jdW1lbnQucmVhZHlTdGF0ZSAhPT0gJ2NvbXBsZXRlJykge1xuICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGFwcGx5UnVsZXMpO1xuICAgIH1cbiAgfVxuICAvKipcbiAgICogRGlzcG9zZXMgRXh0ZW5kZWRDc3MgYW5kIHJlbW92ZXMgb3VyIHN0eWxlcyBmcm9tIG1hdGNoZWQgZWxlbWVudHNcbiAgICovXG5cblxuICBmdW5jdGlvbiBkaXNwb3NlKCkge1xuICAgIHN0b3BPYnNlcnZlKCk7XG4gICAgYWZmZWN0ZWRFbGVtZW50cy5mb3JFYWNoKGZ1bmN0aW9uIChvYmopIHtcbiAgICAgIHJldmVydFN0eWxlKG9iaik7XG4gICAgfSk7XG4gIH1cblxuICB2YXIgdGltaW5nc1ByaW50ZWQgPSBmYWxzZTtcbiAgLyoqXG4gICAqIFByaW50cyB0aW1pbmcgaW5mb3JtYXRpb24gZm9yIGFsbCBzZWxlY3RvcnMgbWFya2VkIGFzIFwiZGVidWdcIlxuICAgKi9cblxuICBmdW5jdGlvbiBwcmludFRpbWluZ0luZm8oKSB7XG4gICAgaWYgKHRpbWluZ3NQcmludGVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGltaW5nc1ByaW50ZWQgPSB0cnVlO1xuICAgIHZhciB0aW1pbmdzID0gcnVsZXMuZmlsdGVyKGZ1bmN0aW9uIChydWxlKSB7XG4gICAgICByZXR1cm4gcnVsZS5zZWxlY3Rvci5pc0RlYnVnZ2luZygpO1xuICAgIH0pLm1hcChmdW5jdGlvbiAocnVsZSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc2VsZWN0b3JUZXh0OiBydWxlLnNlbGVjdG9yLnNlbGVjdG9yVGV4dCxcbiAgICAgICAgdGltaW5nU3RhdHM6IHJ1bGUudGltaW5nU3RhdHNcbiAgICAgIH07XG4gICAgfSk7XG5cbiAgICBpZiAodGltaW5ncy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybjtcbiAgICB9IC8vIEFkZCBsb2NhdGlvbi5ocmVmIHRvIHRoZSBtZXNzYWdlIHRvIGRpc3Rpbmd1aXNoIGZyYW1lc1xuXG5cbiAgICB1dGlscy5sb2dJbmZvKCdbRXh0ZW5kZWRDc3NdIFRpbWluZ3MgZm9yICVvOlxcbiVvIChpbiBtaWxsaXNlY29uZHMpJywgd2luZG93LmxvY2F0aW9uLmhyZWYsIHRpbWluZ3MpO1xuICB9IC8vIEZpcnN0IG9mIGFsbCBwYXJzZSB0aGUgc3R5bGVzaGVldFxuXG5cbiAgcnVsZXMgPSBFeHRlbmRlZENzc1BhcnNlci5wYXJzZUNzcyhzdHlsZVNoZWV0KTsgLy8gRVhQT1NFXG5cbiAgdGhpcy5kaXNwb3NlID0gZGlzcG9zZTtcbiAgdGhpcy5hcHBseSA9IGFwcGx5O1xuICAvKiogRXhwb3NlZCBmb3IgdGVzdGluZyBwdXJwb3NlcyBvbmx5ICovXG5cbiAgdGhpcy5fZ2V0QWZmZWN0ZWRFbGVtZW50cyA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gYWZmZWN0ZWRFbGVtZW50cztcbiAgfTtcbn1cbi8qKlxuICogRXhwb3NlIHF1ZXJ5U2VsZWN0b3JBbGwgZm9yIGRlYnVnZ2luZyBhbmQgdmFsaWRhdGluZyBzZWxlY3RvcnNcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gc2VsZWN0b3JUZXh0IHNlbGVjdG9yIHRleHRcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gbm9UaW1pbmcgaWYgdHJ1ZSAtLSBkbyBub3QgcHJpbnQgdGhlIHRpbWluZyB0byB0aGUgY29uc29sZVxuICogQHJldHVybnMge0FycmF5PE5vZGU+fE5vZGVMaXN0fSBhIGxpc3Qgb2YgZWxlbWVudHMgZm91bmRcbiAqIEB0aHJvd3MgV2lsbCB0aHJvdyBhbiBlcnJvciBpZiB0aGUgYXJndW1lbnQgaXMgbm90IGEgdmFsaWQgc2VsZWN0b3JcbiAqL1xuXG5cbkV4dGVuZGVkQ3NzLnF1ZXJ5ID0gZnVuY3Rpb24gKHNlbGVjdG9yVGV4dCwgbm9UaW1pbmcpIHtcbiAgaWYgKHR5cGVvZiBzZWxlY3RvclRleHQgIT09ICdzdHJpbmcnKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdTZWxlY3RvciB0ZXh0IGlzIGVtcHR5Jyk7XG4gIH1cblxuICB2YXIgbm93ID0gdXRpbHMuQXN5bmNXcmFwcGVyLm5vdztcbiAgdmFyIHN0YXJ0ID0gbm93KCk7XG5cbiAgdHJ5IHtcbiAgICByZXR1cm4gRXh0ZW5kZWRTZWxlY3RvckZhY3RvcnkuY3JlYXRlU2VsZWN0b3Ioc2VsZWN0b3JUZXh0KS5xdWVyeVNlbGVjdG9yQWxsKCk7XG4gIH0gZmluYWxseSB7XG4gICAgdmFyIGVuZCA9IG5vdygpO1xuXG4gICAgaWYgKCFub1RpbWluZykge1xuICAgICAgdXRpbHMubG9nSW5mbyhcIltFeHRlbmRlZENzc10gRWxhcHNlZDogXCIuY29uY2F0KE1hdGgucm91bmQoKGVuZCAtIHN0YXJ0KSAqIDEwMDApLCBcIiBcXHUwM0JDcy5cIikpO1xuICAgIH1cbiAgfVxufTtcblxuZXhwb3J0IGRlZmF1bHQgRXh0ZW5kZWRDc3M7XG4iLCIvKipcbiAqIENvcHlyaWdodCAoYykgMjAxNC1wcmVzZW50LCBGYWNlYm9vaywgSW5jLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICovXG5cbnZhciBydW50aW1lID0gKGZ1bmN0aW9uIChleHBvcnRzKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBPcCA9IE9iamVjdC5wcm90b3R5cGU7XG4gIHZhciBoYXNPd24gPSBPcC5oYXNPd25Qcm9wZXJ0eTtcbiAgdmFyIHVuZGVmaW5lZDsgLy8gTW9yZSBjb21wcmVzc2libGUgdGhhbiB2b2lkIDAuXG4gIHZhciAkU3ltYm9sID0gdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiID8gU3ltYm9sIDoge307XG4gIHZhciBpdGVyYXRvclN5bWJvbCA9ICRTeW1ib2wuaXRlcmF0b3IgfHwgXCJAQGl0ZXJhdG9yXCI7XG4gIHZhciBhc3luY0l0ZXJhdG9yU3ltYm9sID0gJFN5bWJvbC5hc3luY0l0ZXJhdG9yIHx8IFwiQEBhc3luY0l0ZXJhdG9yXCI7XG4gIHZhciB0b1N0cmluZ1RhZ1N5bWJvbCA9ICRTeW1ib2wudG9TdHJpbmdUYWcgfHwgXCJAQHRvU3RyaW5nVGFnXCI7XG5cbiAgZnVuY3Rpb24gZGVmaW5lKG9iaiwga2V5LCB2YWx1ZSkge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwge1xuICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgIHdyaXRhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgcmV0dXJuIG9ialtrZXldO1xuICB9XG4gIHRyeSB7XG4gICAgLy8gSUUgOCBoYXMgYSBicm9rZW4gT2JqZWN0LmRlZmluZVByb3BlcnR5IHRoYXQgb25seSB3b3JrcyBvbiBET00gb2JqZWN0cy5cbiAgICBkZWZpbmUoe30sIFwiXCIpO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBkZWZpbmUgPSBmdW5jdGlvbihvYmosIGtleSwgdmFsdWUpIHtcbiAgICAgIHJldHVybiBvYmpba2V5XSA9IHZhbHVlO1xuICAgIH07XG4gIH1cblxuICBmdW5jdGlvbiB3cmFwKGlubmVyRm4sIG91dGVyRm4sIHNlbGYsIHRyeUxvY3NMaXN0KSB7XG4gICAgLy8gSWYgb3V0ZXJGbiBwcm92aWRlZCBhbmQgb3V0ZXJGbi5wcm90b3R5cGUgaXMgYSBHZW5lcmF0b3IsIHRoZW4gb3V0ZXJGbi5wcm90b3R5cGUgaW5zdGFuY2VvZiBHZW5lcmF0b3IuXG4gICAgdmFyIHByb3RvR2VuZXJhdG9yID0gb3V0ZXJGbiAmJiBvdXRlckZuLnByb3RvdHlwZSBpbnN0YW5jZW9mIEdlbmVyYXRvciA/IG91dGVyRm4gOiBHZW5lcmF0b3I7XG4gICAgdmFyIGdlbmVyYXRvciA9IE9iamVjdC5jcmVhdGUocHJvdG9HZW5lcmF0b3IucHJvdG90eXBlKTtcbiAgICB2YXIgY29udGV4dCA9IG5ldyBDb250ZXh0KHRyeUxvY3NMaXN0IHx8IFtdKTtcblxuICAgIC8vIFRoZSAuX2ludm9rZSBtZXRob2QgdW5pZmllcyB0aGUgaW1wbGVtZW50YXRpb25zIG9mIHRoZSAubmV4dCxcbiAgICAvLyAudGhyb3csIGFuZCAucmV0dXJuIG1ldGhvZHMuXG4gICAgZ2VuZXJhdG9yLl9pbnZva2UgPSBtYWtlSW52b2tlTWV0aG9kKGlubmVyRm4sIHNlbGYsIGNvbnRleHQpO1xuXG4gICAgcmV0dXJuIGdlbmVyYXRvcjtcbiAgfVxuICBleHBvcnRzLndyYXAgPSB3cmFwO1xuXG4gIC8vIFRyeS9jYXRjaCBoZWxwZXIgdG8gbWluaW1pemUgZGVvcHRpbWl6YXRpb25zLiBSZXR1cm5zIGEgY29tcGxldGlvblxuICAvLyByZWNvcmQgbGlrZSBjb250ZXh0LnRyeUVudHJpZXNbaV0uY29tcGxldGlvbi4gVGhpcyBpbnRlcmZhY2UgY291bGRcbiAgLy8gaGF2ZSBiZWVuIChhbmQgd2FzIHByZXZpb3VzbHkpIGRlc2lnbmVkIHRvIHRha2UgYSBjbG9zdXJlIHRvIGJlXG4gIC8vIGludm9rZWQgd2l0aG91dCBhcmd1bWVudHMsIGJ1dCBpbiBhbGwgdGhlIGNhc2VzIHdlIGNhcmUgYWJvdXQgd2VcbiAgLy8gYWxyZWFkeSBoYXZlIGFuIGV4aXN0aW5nIG1ldGhvZCB3ZSB3YW50IHRvIGNhbGwsIHNvIHRoZXJlJ3Mgbm8gbmVlZFxuICAvLyB0byBjcmVhdGUgYSBuZXcgZnVuY3Rpb24gb2JqZWN0LiBXZSBjYW4gZXZlbiBnZXQgYXdheSB3aXRoIGFzc3VtaW5nXG4gIC8vIHRoZSBtZXRob2QgdGFrZXMgZXhhY3RseSBvbmUgYXJndW1lbnQsIHNpbmNlIHRoYXQgaGFwcGVucyB0byBiZSB0cnVlXG4gIC8vIGluIGV2ZXJ5IGNhc2UsIHNvIHdlIGRvbid0IGhhdmUgdG8gdG91Y2ggdGhlIGFyZ3VtZW50cyBvYmplY3QuIFRoZVxuICAvLyBvbmx5IGFkZGl0aW9uYWwgYWxsb2NhdGlvbiByZXF1aXJlZCBpcyB0aGUgY29tcGxldGlvbiByZWNvcmQsIHdoaWNoXG4gIC8vIGhhcyBhIHN0YWJsZSBzaGFwZSBhbmQgc28gaG9wZWZ1bGx5IHNob3VsZCBiZSBjaGVhcCB0byBhbGxvY2F0ZS5cbiAgZnVuY3Rpb24gdHJ5Q2F0Y2goZm4sIG9iaiwgYXJnKSB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiB7IHR5cGU6IFwibm9ybWFsXCIsIGFyZzogZm4uY2FsbChvYmosIGFyZykgfTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIHJldHVybiB7IHR5cGU6IFwidGhyb3dcIiwgYXJnOiBlcnIgfTtcbiAgICB9XG4gIH1cblxuICB2YXIgR2VuU3RhdGVTdXNwZW5kZWRTdGFydCA9IFwic3VzcGVuZGVkU3RhcnRcIjtcbiAgdmFyIEdlblN0YXRlU3VzcGVuZGVkWWllbGQgPSBcInN1c3BlbmRlZFlpZWxkXCI7XG4gIHZhciBHZW5TdGF0ZUV4ZWN1dGluZyA9IFwiZXhlY3V0aW5nXCI7XG4gIHZhciBHZW5TdGF0ZUNvbXBsZXRlZCA9IFwiY29tcGxldGVkXCI7XG5cbiAgLy8gUmV0dXJuaW5nIHRoaXMgb2JqZWN0IGZyb20gdGhlIGlubmVyRm4gaGFzIHRoZSBzYW1lIGVmZmVjdCBhc1xuICAvLyBicmVha2luZyBvdXQgb2YgdGhlIGRpc3BhdGNoIHN3aXRjaCBzdGF0ZW1lbnQuXG4gIHZhciBDb250aW51ZVNlbnRpbmVsID0ge307XG5cbiAgLy8gRHVtbXkgY29uc3RydWN0b3IgZnVuY3Rpb25zIHRoYXQgd2UgdXNlIGFzIHRoZSAuY29uc3RydWN0b3IgYW5kXG4gIC8vIC5jb25zdHJ1Y3Rvci5wcm90b3R5cGUgcHJvcGVydGllcyBmb3IgZnVuY3Rpb25zIHRoYXQgcmV0dXJuIEdlbmVyYXRvclxuICAvLyBvYmplY3RzLiBGb3IgZnVsbCBzcGVjIGNvbXBsaWFuY2UsIHlvdSBtYXkgd2lzaCB0byBjb25maWd1cmUgeW91clxuICAvLyBtaW5pZmllciBub3QgdG8gbWFuZ2xlIHRoZSBuYW1lcyBvZiB0aGVzZSB0d28gZnVuY3Rpb25zLlxuICBmdW5jdGlvbiBHZW5lcmF0b3IoKSB7fVxuICBmdW5jdGlvbiBHZW5lcmF0b3JGdW5jdGlvbigpIHt9XG4gIGZ1bmN0aW9uIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlKCkge31cblxuICAvLyBUaGlzIGlzIGEgcG9seWZpbGwgZm9yICVJdGVyYXRvclByb3RvdHlwZSUgZm9yIGVudmlyb25tZW50cyB0aGF0XG4gIC8vIGRvbid0IG5hdGl2ZWx5IHN1cHBvcnQgaXQuXG4gIHZhciBJdGVyYXRvclByb3RvdHlwZSA9IHt9O1xuICBJdGVyYXRvclByb3RvdHlwZVtpdGVyYXRvclN5bWJvbF0gPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgdmFyIGdldFByb3RvID0gT2JqZWN0LmdldFByb3RvdHlwZU9mO1xuICB2YXIgTmF0aXZlSXRlcmF0b3JQcm90b3R5cGUgPSBnZXRQcm90byAmJiBnZXRQcm90byhnZXRQcm90byh2YWx1ZXMoW10pKSk7XG4gIGlmIChOYXRpdmVJdGVyYXRvclByb3RvdHlwZSAmJlxuICAgICAgTmF0aXZlSXRlcmF0b3JQcm90b3R5cGUgIT09IE9wICYmXG4gICAgICBoYXNPd24uY2FsbChOYXRpdmVJdGVyYXRvclByb3RvdHlwZSwgaXRlcmF0b3JTeW1ib2wpKSB7XG4gICAgLy8gVGhpcyBlbnZpcm9ubWVudCBoYXMgYSBuYXRpdmUgJUl0ZXJhdG9yUHJvdG90eXBlJTsgdXNlIGl0IGluc3RlYWRcbiAgICAvLyBvZiB0aGUgcG9seWZpbGwuXG4gICAgSXRlcmF0b3JQcm90b3R5cGUgPSBOYXRpdmVJdGVyYXRvclByb3RvdHlwZTtcbiAgfVxuXG4gIHZhciBHcCA9IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLnByb3RvdHlwZSA9XG4gICAgR2VuZXJhdG9yLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoSXRlcmF0b3JQcm90b3R5cGUpO1xuICBHZW5lcmF0b3JGdW5jdGlvbi5wcm90b3R5cGUgPSBHcC5jb25zdHJ1Y3RvciA9IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlO1xuICBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IEdlbmVyYXRvckZ1bmN0aW9uO1xuICBHZW5lcmF0b3JGdW5jdGlvbi5kaXNwbGF5TmFtZSA9IGRlZmluZShcbiAgICBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSxcbiAgICB0b1N0cmluZ1RhZ1N5bWJvbCxcbiAgICBcIkdlbmVyYXRvckZ1bmN0aW9uXCJcbiAgKTtcblxuICAvLyBIZWxwZXIgZm9yIGRlZmluaW5nIHRoZSAubmV4dCwgLnRocm93LCBhbmQgLnJldHVybiBtZXRob2RzIG9mIHRoZVxuICAvLyBJdGVyYXRvciBpbnRlcmZhY2UgaW4gdGVybXMgb2YgYSBzaW5nbGUgLl9pbnZva2UgbWV0aG9kLlxuICBmdW5jdGlvbiBkZWZpbmVJdGVyYXRvck1ldGhvZHMocHJvdG90eXBlKSB7XG4gICAgW1wibmV4dFwiLCBcInRocm93XCIsIFwicmV0dXJuXCJdLmZvckVhY2goZnVuY3Rpb24obWV0aG9kKSB7XG4gICAgICBkZWZpbmUocHJvdG90eXBlLCBtZXRob2QsIGZ1bmN0aW9uKGFyZykge1xuICAgICAgICByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgYXJnKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgZXhwb3J0cy5pc0dlbmVyYXRvckZ1bmN0aW9uID0gZnVuY3Rpb24oZ2VuRnVuKSB7XG4gICAgdmFyIGN0b3IgPSB0eXBlb2YgZ2VuRnVuID09PSBcImZ1bmN0aW9uXCIgJiYgZ2VuRnVuLmNvbnN0cnVjdG9yO1xuICAgIHJldHVybiBjdG9yXG4gICAgICA/IGN0b3IgPT09IEdlbmVyYXRvckZ1bmN0aW9uIHx8XG4gICAgICAgIC8vIEZvciB0aGUgbmF0aXZlIEdlbmVyYXRvckZ1bmN0aW9uIGNvbnN0cnVjdG9yLCB0aGUgYmVzdCB3ZSBjYW5cbiAgICAgICAgLy8gZG8gaXMgdG8gY2hlY2sgaXRzIC5uYW1lIHByb3BlcnR5LlxuICAgICAgICAoY3Rvci5kaXNwbGF5TmFtZSB8fCBjdG9yLm5hbWUpID09PSBcIkdlbmVyYXRvckZ1bmN0aW9uXCJcbiAgICAgIDogZmFsc2U7XG4gIH07XG5cbiAgZXhwb3J0cy5tYXJrID0gZnVuY3Rpb24oZ2VuRnVuKSB7XG4gICAgaWYgKE9iamVjdC5zZXRQcm90b3R5cGVPZikge1xuICAgICAgT2JqZWN0LnNldFByb3RvdHlwZU9mKGdlbkZ1biwgR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBnZW5GdW4uX19wcm90b19fID0gR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGU7XG4gICAgICBkZWZpbmUoZ2VuRnVuLCB0b1N0cmluZ1RhZ1N5bWJvbCwgXCJHZW5lcmF0b3JGdW5jdGlvblwiKTtcbiAgICB9XG4gICAgZ2VuRnVuLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoR3ApO1xuICAgIHJldHVybiBnZW5GdW47XG4gIH07XG5cbiAgLy8gV2l0aGluIHRoZSBib2R5IG9mIGFueSBhc3luYyBmdW5jdGlvbiwgYGF3YWl0IHhgIGlzIHRyYW5zZm9ybWVkIHRvXG4gIC8vIGB5aWVsZCByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoeClgLCBzbyB0aGF0IHRoZSBydW50aW1lIGNhbiB0ZXN0XG4gIC8vIGBoYXNPd24uY2FsbCh2YWx1ZSwgXCJfX2F3YWl0XCIpYCB0byBkZXRlcm1pbmUgaWYgdGhlIHlpZWxkZWQgdmFsdWUgaXNcbiAgLy8gbWVhbnQgdG8gYmUgYXdhaXRlZC5cbiAgZXhwb3J0cy5hd3JhcCA9IGZ1bmN0aW9uKGFyZykge1xuICAgIHJldHVybiB7IF9fYXdhaXQ6IGFyZyB9O1xuICB9O1xuXG4gIGZ1bmN0aW9uIEFzeW5jSXRlcmF0b3IoZ2VuZXJhdG9yLCBQcm9taXNlSW1wbCkge1xuICAgIGZ1bmN0aW9uIGludm9rZShtZXRob2QsIGFyZywgcmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICB2YXIgcmVjb3JkID0gdHJ5Q2F0Y2goZ2VuZXJhdG9yW21ldGhvZF0sIGdlbmVyYXRvciwgYXJnKTtcbiAgICAgIGlmIChyZWNvcmQudHlwZSA9PT0gXCJ0aHJvd1wiKSB7XG4gICAgICAgIHJlamVjdChyZWNvcmQuYXJnKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciByZXN1bHQgPSByZWNvcmQuYXJnO1xuICAgICAgICB2YXIgdmFsdWUgPSByZXN1bHQudmFsdWU7XG4gICAgICAgIGlmICh2YWx1ZSAmJlxuICAgICAgICAgICAgdHlwZW9mIHZhbHVlID09PSBcIm9iamVjdFwiICYmXG4gICAgICAgICAgICBoYXNPd24uY2FsbCh2YWx1ZSwgXCJfX2F3YWl0XCIpKSB7XG4gICAgICAgICAgcmV0dXJuIFByb21pc2VJbXBsLnJlc29sdmUodmFsdWUuX19hd2FpdCkudGhlbihmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgICAgaW52b2tlKFwibmV4dFwiLCB2YWx1ZSwgcmVzb2x2ZSwgcmVqZWN0KTtcbiAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgICAgIGludm9rZShcInRocm93XCIsIGVyciwgcmVzb2x2ZSwgcmVqZWN0KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBQcm9taXNlSW1wbC5yZXNvbHZlKHZhbHVlKS50aGVuKGZ1bmN0aW9uKHVud3JhcHBlZCkge1xuICAgICAgICAgIC8vIFdoZW4gYSB5aWVsZGVkIFByb21pc2UgaXMgcmVzb2x2ZWQsIGl0cyBmaW5hbCB2YWx1ZSBiZWNvbWVzXG4gICAgICAgICAgLy8gdGhlIC52YWx1ZSBvZiB0aGUgUHJvbWlzZTx7dmFsdWUsZG9uZX0+IHJlc3VsdCBmb3IgdGhlXG4gICAgICAgICAgLy8gY3VycmVudCBpdGVyYXRpb24uXG4gICAgICAgICAgcmVzdWx0LnZhbHVlID0gdW53cmFwcGVkO1xuICAgICAgICAgIHJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgfSwgZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAgICAgICAvLyBJZiBhIHJlamVjdGVkIFByb21pc2Ugd2FzIHlpZWxkZWQsIHRocm93IHRoZSByZWplY3Rpb24gYmFja1xuICAgICAgICAgIC8vIGludG8gdGhlIGFzeW5jIGdlbmVyYXRvciBmdW5jdGlvbiBzbyBpdCBjYW4gYmUgaGFuZGxlZCB0aGVyZS5cbiAgICAgICAgICByZXR1cm4gaW52b2tlKFwidGhyb3dcIiwgZXJyb3IsIHJlc29sdmUsIHJlamVjdCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIHZhciBwcmV2aW91c1Byb21pc2U7XG5cbiAgICBmdW5jdGlvbiBlbnF1ZXVlKG1ldGhvZCwgYXJnKSB7XG4gICAgICBmdW5jdGlvbiBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZygpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlSW1wbChmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICBpbnZva2UobWV0aG9kLCBhcmcsIHJlc29sdmUsIHJlamVjdCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcHJldmlvdXNQcm9taXNlID1cbiAgICAgICAgLy8gSWYgZW5xdWV1ZSBoYXMgYmVlbiBjYWxsZWQgYmVmb3JlLCB0aGVuIHdlIHdhbnQgdG8gd2FpdCB1bnRpbFxuICAgICAgICAvLyBhbGwgcHJldmlvdXMgUHJvbWlzZXMgaGF2ZSBiZWVuIHJlc29sdmVkIGJlZm9yZSBjYWxsaW5nIGludm9rZSxcbiAgICAgICAgLy8gc28gdGhhdCByZXN1bHRzIGFyZSBhbHdheXMgZGVsaXZlcmVkIGluIHRoZSBjb3JyZWN0IG9yZGVyLiBJZlxuICAgICAgICAvLyBlbnF1ZXVlIGhhcyBub3QgYmVlbiBjYWxsZWQgYmVmb3JlLCB0aGVuIGl0IGlzIGltcG9ydGFudCB0b1xuICAgICAgICAvLyBjYWxsIGludm9rZSBpbW1lZGlhdGVseSwgd2l0aG91dCB3YWl0aW5nIG9uIGEgY2FsbGJhY2sgdG8gZmlyZSxcbiAgICAgICAgLy8gc28gdGhhdCB0aGUgYXN5bmMgZ2VuZXJhdG9yIGZ1bmN0aW9uIGhhcyB0aGUgb3Bwb3J0dW5pdHkgdG8gZG9cbiAgICAgICAgLy8gYW55IG5lY2Vzc2FyeSBzZXR1cCBpbiBhIHByZWRpY3RhYmxlIHdheS4gVGhpcyBwcmVkaWN0YWJpbGl0eVxuICAgICAgICAvLyBpcyB3aHkgdGhlIFByb21pc2UgY29uc3RydWN0b3Igc3luY2hyb25vdXNseSBpbnZva2VzIGl0c1xuICAgICAgICAvLyBleGVjdXRvciBjYWxsYmFjaywgYW5kIHdoeSBhc3luYyBmdW5jdGlvbnMgc3luY2hyb25vdXNseVxuICAgICAgICAvLyBleGVjdXRlIGNvZGUgYmVmb3JlIHRoZSBmaXJzdCBhd2FpdC4gU2luY2Ugd2UgaW1wbGVtZW50IHNpbXBsZVxuICAgICAgICAvLyBhc3luYyBmdW5jdGlvbnMgaW4gdGVybXMgb2YgYXN5bmMgZ2VuZXJhdG9ycywgaXQgaXMgZXNwZWNpYWxseVxuICAgICAgICAvLyBpbXBvcnRhbnQgdG8gZ2V0IHRoaXMgcmlnaHQsIGV2ZW4gdGhvdWdoIGl0IHJlcXVpcmVzIGNhcmUuXG4gICAgICAgIHByZXZpb3VzUHJvbWlzZSA/IHByZXZpb3VzUHJvbWlzZS50aGVuKFxuICAgICAgICAgIGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnLFxuICAgICAgICAgIC8vIEF2b2lkIHByb3BhZ2F0aW5nIGZhaWx1cmVzIHRvIFByb21pc2VzIHJldHVybmVkIGJ5IGxhdGVyXG4gICAgICAgICAgLy8gaW52b2NhdGlvbnMgb2YgdGhlIGl0ZXJhdG9yLlxuICAgICAgICAgIGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnXG4gICAgICAgICkgOiBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZygpO1xuICAgIH1cblxuICAgIC8vIERlZmluZSB0aGUgdW5pZmllZCBoZWxwZXIgbWV0aG9kIHRoYXQgaXMgdXNlZCB0byBpbXBsZW1lbnQgLm5leHQsXG4gICAgLy8gLnRocm93LCBhbmQgLnJldHVybiAoc2VlIGRlZmluZUl0ZXJhdG9yTWV0aG9kcykuXG4gICAgdGhpcy5faW52b2tlID0gZW5xdWV1ZTtcbiAgfVxuXG4gIGRlZmluZUl0ZXJhdG9yTWV0aG9kcyhBc3luY0l0ZXJhdG9yLnByb3RvdHlwZSk7XG4gIEFzeW5jSXRlcmF0b3IucHJvdG90eXBlW2FzeW5jSXRlcmF0b3JTeW1ib2xdID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuICBleHBvcnRzLkFzeW5jSXRlcmF0b3IgPSBBc3luY0l0ZXJhdG9yO1xuXG4gIC8vIE5vdGUgdGhhdCBzaW1wbGUgYXN5bmMgZnVuY3Rpb25zIGFyZSBpbXBsZW1lbnRlZCBvbiB0b3Agb2ZcbiAgLy8gQXN5bmNJdGVyYXRvciBvYmplY3RzOyB0aGV5IGp1c3QgcmV0dXJuIGEgUHJvbWlzZSBmb3IgdGhlIHZhbHVlIG9mXG4gIC8vIHRoZSBmaW5hbCByZXN1bHQgcHJvZHVjZWQgYnkgdGhlIGl0ZXJhdG9yLlxuICBleHBvcnRzLmFzeW5jID0gZnVuY3Rpb24oaW5uZXJGbiwgb3V0ZXJGbiwgc2VsZiwgdHJ5TG9jc0xpc3QsIFByb21pc2VJbXBsKSB7XG4gICAgaWYgKFByb21pc2VJbXBsID09PSB2b2lkIDApIFByb21pc2VJbXBsID0gUHJvbWlzZTtcblxuICAgIHZhciBpdGVyID0gbmV3IEFzeW5jSXRlcmF0b3IoXG4gICAgICB3cmFwKGlubmVyRm4sIG91dGVyRm4sIHNlbGYsIHRyeUxvY3NMaXN0KSxcbiAgICAgIFByb21pc2VJbXBsXG4gICAgKTtcblxuICAgIHJldHVybiBleHBvcnRzLmlzR2VuZXJhdG9yRnVuY3Rpb24ob3V0ZXJGbilcbiAgICAgID8gaXRlciAvLyBJZiBvdXRlckZuIGlzIGEgZ2VuZXJhdG9yLCByZXR1cm4gdGhlIGZ1bGwgaXRlcmF0b3IuXG4gICAgICA6IGl0ZXIubmV4dCgpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XG4gICAgICAgICAgcmV0dXJuIHJlc3VsdC5kb25lID8gcmVzdWx0LnZhbHVlIDogaXRlci5uZXh0KCk7XG4gICAgICAgIH0pO1xuICB9O1xuXG4gIGZ1bmN0aW9uIG1ha2VJbnZva2VNZXRob2QoaW5uZXJGbiwgc2VsZiwgY29udGV4dCkge1xuICAgIHZhciBzdGF0ZSA9IEdlblN0YXRlU3VzcGVuZGVkU3RhcnQ7XG5cbiAgICByZXR1cm4gZnVuY3Rpb24gaW52b2tlKG1ldGhvZCwgYXJnKSB7XG4gICAgICBpZiAoc3RhdGUgPT09IEdlblN0YXRlRXhlY3V0aW5nKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkdlbmVyYXRvciBpcyBhbHJlYWR5IHJ1bm5pbmdcIik7XG4gICAgICB9XG5cbiAgICAgIGlmIChzdGF0ZSA9PT0gR2VuU3RhdGVDb21wbGV0ZWQpIHtcbiAgICAgICAgaWYgKG1ldGhvZCA9PT0gXCJ0aHJvd1wiKSB7XG4gICAgICAgICAgdGhyb3cgYXJnO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQmUgZm9yZ2l2aW5nLCBwZXIgMjUuMy4zLjMuMyBvZiB0aGUgc3BlYzpcbiAgICAgICAgLy8gaHR0cHM6Ly9wZW9wbGUubW96aWxsYS5vcmcvfmpvcmVuZG9yZmYvZXM2LWRyYWZ0Lmh0bWwjc2VjLWdlbmVyYXRvcnJlc3VtZVxuICAgICAgICByZXR1cm4gZG9uZVJlc3VsdCgpO1xuICAgICAgfVxuXG4gICAgICBjb250ZXh0Lm1ldGhvZCA9IG1ldGhvZDtcbiAgICAgIGNvbnRleHQuYXJnID0gYXJnO1xuXG4gICAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICB2YXIgZGVsZWdhdGUgPSBjb250ZXh0LmRlbGVnYXRlO1xuICAgICAgICBpZiAoZGVsZWdhdGUpIHtcbiAgICAgICAgICB2YXIgZGVsZWdhdGVSZXN1bHQgPSBtYXliZUludm9rZURlbGVnYXRlKGRlbGVnYXRlLCBjb250ZXh0KTtcbiAgICAgICAgICBpZiAoZGVsZWdhdGVSZXN1bHQpIHtcbiAgICAgICAgICAgIGlmIChkZWxlZ2F0ZVJlc3VsdCA9PT0gQ29udGludWVTZW50aW5lbCkgY29udGludWU7XG4gICAgICAgICAgICByZXR1cm4gZGVsZWdhdGVSZXN1bHQ7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNvbnRleHQubWV0aG9kID09PSBcIm5leHRcIikge1xuICAgICAgICAgIC8vIFNldHRpbmcgY29udGV4dC5fc2VudCBmb3IgbGVnYWN5IHN1cHBvcnQgb2YgQmFiZWwnc1xuICAgICAgICAgIC8vIGZ1bmN0aW9uLnNlbnQgaW1wbGVtZW50YXRpb24uXG4gICAgICAgICAgY29udGV4dC5zZW50ID0gY29udGV4dC5fc2VudCA9IGNvbnRleHQuYXJnO1xuXG4gICAgICAgIH0gZWxzZSBpZiAoY29udGV4dC5tZXRob2QgPT09IFwidGhyb3dcIikge1xuICAgICAgICAgIGlmIChzdGF0ZSA9PT0gR2VuU3RhdGVTdXNwZW5kZWRTdGFydCkge1xuICAgICAgICAgICAgc3RhdGUgPSBHZW5TdGF0ZUNvbXBsZXRlZDtcbiAgICAgICAgICAgIHRocm93IGNvbnRleHQuYXJnO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnRleHQuZGlzcGF0Y2hFeGNlcHRpb24oY29udGV4dC5hcmcpO1xuXG4gICAgICAgIH0gZWxzZSBpZiAoY29udGV4dC5tZXRob2QgPT09IFwicmV0dXJuXCIpIHtcbiAgICAgICAgICBjb250ZXh0LmFicnVwdChcInJldHVyblwiLCBjb250ZXh0LmFyZyk7XG4gICAgICAgIH1cblxuICAgICAgICBzdGF0ZSA9IEdlblN0YXRlRXhlY3V0aW5nO1xuXG4gICAgICAgIHZhciByZWNvcmQgPSB0cnlDYXRjaChpbm5lckZuLCBzZWxmLCBjb250ZXh0KTtcbiAgICAgICAgaWYgKHJlY29yZC50eXBlID09PSBcIm5vcm1hbFwiKSB7XG4gICAgICAgICAgLy8gSWYgYW4gZXhjZXB0aW9uIGlzIHRocm93biBmcm9tIGlubmVyRm4sIHdlIGxlYXZlIHN0YXRlID09PVxuICAgICAgICAgIC8vIEdlblN0YXRlRXhlY3V0aW5nIGFuZCBsb29wIGJhY2sgZm9yIGFub3RoZXIgaW52b2NhdGlvbi5cbiAgICAgICAgICBzdGF0ZSA9IGNvbnRleHQuZG9uZVxuICAgICAgICAgICAgPyBHZW5TdGF0ZUNvbXBsZXRlZFxuICAgICAgICAgICAgOiBHZW5TdGF0ZVN1c3BlbmRlZFlpZWxkO1xuXG4gICAgICAgICAgaWYgKHJlY29yZC5hcmcgPT09IENvbnRpbnVlU2VudGluZWwpIHtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB2YWx1ZTogcmVjb3JkLmFyZyxcbiAgICAgICAgICAgIGRvbmU6IGNvbnRleHQuZG9uZVxuICAgICAgICAgIH07XG5cbiAgICAgICAgfSBlbHNlIGlmIChyZWNvcmQudHlwZSA9PT0gXCJ0aHJvd1wiKSB7XG4gICAgICAgICAgc3RhdGUgPSBHZW5TdGF0ZUNvbXBsZXRlZDtcbiAgICAgICAgICAvLyBEaXNwYXRjaCB0aGUgZXhjZXB0aW9uIGJ5IGxvb3BpbmcgYmFjayBhcm91bmQgdG8gdGhlXG4gICAgICAgICAgLy8gY29udGV4dC5kaXNwYXRjaEV4Y2VwdGlvbihjb250ZXh0LmFyZykgY2FsbCBhYm92ZS5cbiAgICAgICAgICBjb250ZXh0Lm1ldGhvZCA9IFwidGhyb3dcIjtcbiAgICAgICAgICBjb250ZXh0LmFyZyA9IHJlY29yZC5hcmc7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgLy8gQ2FsbCBkZWxlZ2F0ZS5pdGVyYXRvcltjb250ZXh0Lm1ldGhvZF0oY29udGV4dC5hcmcpIGFuZCBoYW5kbGUgdGhlXG4gIC8vIHJlc3VsdCwgZWl0aGVyIGJ5IHJldHVybmluZyBhIHsgdmFsdWUsIGRvbmUgfSByZXN1bHQgZnJvbSB0aGVcbiAgLy8gZGVsZWdhdGUgaXRlcmF0b3IsIG9yIGJ5IG1vZGlmeWluZyBjb250ZXh0Lm1ldGhvZCBhbmQgY29udGV4dC5hcmcsXG4gIC8vIHNldHRpbmcgY29udGV4dC5kZWxlZ2F0ZSB0byBudWxsLCBhbmQgcmV0dXJuaW5nIHRoZSBDb250aW51ZVNlbnRpbmVsLlxuICBmdW5jdGlvbiBtYXliZUludm9rZURlbGVnYXRlKGRlbGVnYXRlLCBjb250ZXh0KSB7XG4gICAgdmFyIG1ldGhvZCA9IGRlbGVnYXRlLml0ZXJhdG9yW2NvbnRleHQubWV0aG9kXTtcbiAgICBpZiAobWV0aG9kID09PSB1bmRlZmluZWQpIHtcbiAgICAgIC8vIEEgLnRocm93IG9yIC5yZXR1cm4gd2hlbiB0aGUgZGVsZWdhdGUgaXRlcmF0b3IgaGFzIG5vIC50aHJvd1xuICAgICAgLy8gbWV0aG9kIGFsd2F5cyB0ZXJtaW5hdGVzIHRoZSB5aWVsZCogbG9vcC5cbiAgICAgIGNvbnRleHQuZGVsZWdhdGUgPSBudWxsO1xuXG4gICAgICBpZiAoY29udGV4dC5tZXRob2QgPT09IFwidGhyb3dcIikge1xuICAgICAgICAvLyBOb3RlOiBbXCJyZXR1cm5cIl0gbXVzdCBiZSB1c2VkIGZvciBFUzMgcGFyc2luZyBjb21wYXRpYmlsaXR5LlxuICAgICAgICBpZiAoZGVsZWdhdGUuaXRlcmF0b3JbXCJyZXR1cm5cIl0pIHtcbiAgICAgICAgICAvLyBJZiB0aGUgZGVsZWdhdGUgaXRlcmF0b3IgaGFzIGEgcmV0dXJuIG1ldGhvZCwgZ2l2ZSBpdCBhXG4gICAgICAgICAgLy8gY2hhbmNlIHRvIGNsZWFuIHVwLlxuICAgICAgICAgIGNvbnRleHQubWV0aG9kID0gXCJyZXR1cm5cIjtcbiAgICAgICAgICBjb250ZXh0LmFyZyA9IHVuZGVmaW5lZDtcbiAgICAgICAgICBtYXliZUludm9rZURlbGVnYXRlKGRlbGVnYXRlLCBjb250ZXh0KTtcblxuICAgICAgICAgIGlmIChjb250ZXh0Lm1ldGhvZCA9PT0gXCJ0aHJvd1wiKSB7XG4gICAgICAgICAgICAvLyBJZiBtYXliZUludm9rZURlbGVnYXRlKGNvbnRleHQpIGNoYW5nZWQgY29udGV4dC5tZXRob2QgZnJvbVxuICAgICAgICAgICAgLy8gXCJyZXR1cm5cIiB0byBcInRocm93XCIsIGxldCB0aGF0IG92ZXJyaWRlIHRoZSBUeXBlRXJyb3IgYmVsb3cuXG4gICAgICAgICAgICByZXR1cm4gQ29udGludWVTZW50aW5lbDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBjb250ZXh0Lm1ldGhvZCA9IFwidGhyb3dcIjtcbiAgICAgICAgY29udGV4dC5hcmcgPSBuZXcgVHlwZUVycm9yKFxuICAgICAgICAgIFwiVGhlIGl0ZXJhdG9yIGRvZXMgbm90IHByb3ZpZGUgYSAndGhyb3cnIG1ldGhvZFwiKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7XG4gICAgfVxuXG4gICAgdmFyIHJlY29yZCA9IHRyeUNhdGNoKG1ldGhvZCwgZGVsZWdhdGUuaXRlcmF0b3IsIGNvbnRleHQuYXJnKTtcblxuICAgIGlmIChyZWNvcmQudHlwZSA9PT0gXCJ0aHJvd1wiKSB7XG4gICAgICBjb250ZXh0Lm1ldGhvZCA9IFwidGhyb3dcIjtcbiAgICAgIGNvbnRleHQuYXJnID0gcmVjb3JkLmFyZztcbiAgICAgIGNvbnRleHQuZGVsZWdhdGUgPSBudWxsO1xuICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7XG4gICAgfVxuXG4gICAgdmFyIGluZm8gPSByZWNvcmQuYXJnO1xuXG4gICAgaWYgKCEgaW5mbykge1xuICAgICAgY29udGV4dC5tZXRob2QgPSBcInRocm93XCI7XG4gICAgICBjb250ZXh0LmFyZyA9IG5ldyBUeXBlRXJyb3IoXCJpdGVyYXRvciByZXN1bHQgaXMgbm90IGFuIG9iamVjdFwiKTtcbiAgICAgIGNvbnRleHQuZGVsZWdhdGUgPSBudWxsO1xuICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7XG4gICAgfVxuXG4gICAgaWYgKGluZm8uZG9uZSkge1xuICAgICAgLy8gQXNzaWduIHRoZSByZXN1bHQgb2YgdGhlIGZpbmlzaGVkIGRlbGVnYXRlIHRvIHRoZSB0ZW1wb3JhcnlcbiAgICAgIC8vIHZhcmlhYmxlIHNwZWNpZmllZCBieSBkZWxlZ2F0ZS5yZXN1bHROYW1lIChzZWUgZGVsZWdhdGVZaWVsZCkuXG4gICAgICBjb250ZXh0W2RlbGVnYXRlLnJlc3VsdE5hbWVdID0gaW5mby52YWx1ZTtcblxuICAgICAgLy8gUmVzdW1lIGV4ZWN1dGlvbiBhdCB0aGUgZGVzaXJlZCBsb2NhdGlvbiAoc2VlIGRlbGVnYXRlWWllbGQpLlxuICAgICAgY29udGV4dC5uZXh0ID0gZGVsZWdhdGUubmV4dExvYztcblxuICAgICAgLy8gSWYgY29udGV4dC5tZXRob2Qgd2FzIFwidGhyb3dcIiBidXQgdGhlIGRlbGVnYXRlIGhhbmRsZWQgdGhlXG4gICAgICAvLyBleGNlcHRpb24sIGxldCB0aGUgb3V0ZXIgZ2VuZXJhdG9yIHByb2NlZWQgbm9ybWFsbHkuIElmXG4gICAgICAvLyBjb250ZXh0Lm1ldGhvZCB3YXMgXCJuZXh0XCIsIGZvcmdldCBjb250ZXh0LmFyZyBzaW5jZSBpdCBoYXMgYmVlblxuICAgICAgLy8gXCJjb25zdW1lZFwiIGJ5IHRoZSBkZWxlZ2F0ZSBpdGVyYXRvci4gSWYgY29udGV4dC5tZXRob2Qgd2FzXG4gICAgICAvLyBcInJldHVyblwiLCBhbGxvdyB0aGUgb3JpZ2luYWwgLnJldHVybiBjYWxsIHRvIGNvbnRpbnVlIGluIHRoZVxuICAgICAgLy8gb3V0ZXIgZ2VuZXJhdG9yLlxuICAgICAgaWYgKGNvbnRleHQubWV0aG9kICE9PSBcInJldHVyblwiKSB7XG4gICAgICAgIGNvbnRleHQubWV0aG9kID0gXCJuZXh0XCI7XG4gICAgICAgIGNvbnRleHQuYXJnID0gdW5kZWZpbmVkO1xuICAgICAgfVxuXG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFJlLXlpZWxkIHRoZSByZXN1bHQgcmV0dXJuZWQgYnkgdGhlIGRlbGVnYXRlIG1ldGhvZC5cbiAgICAgIHJldHVybiBpbmZvO1xuICAgIH1cblxuICAgIC8vIFRoZSBkZWxlZ2F0ZSBpdGVyYXRvciBpcyBmaW5pc2hlZCwgc28gZm9yZ2V0IGl0IGFuZCBjb250aW51ZSB3aXRoXG4gICAgLy8gdGhlIG91dGVyIGdlbmVyYXRvci5cbiAgICBjb250ZXh0LmRlbGVnYXRlID0gbnVsbDtcbiAgICByZXR1cm4gQ29udGludWVTZW50aW5lbDtcbiAgfVxuXG4gIC8vIERlZmluZSBHZW5lcmF0b3IucHJvdG90eXBlLntuZXh0LHRocm93LHJldHVybn0gaW4gdGVybXMgb2YgdGhlXG4gIC8vIHVuaWZpZWQgLl9pbnZva2UgaGVscGVyIG1ldGhvZC5cbiAgZGVmaW5lSXRlcmF0b3JNZXRob2RzKEdwKTtcblxuICBkZWZpbmUoR3AsIHRvU3RyaW5nVGFnU3ltYm9sLCBcIkdlbmVyYXRvclwiKTtcblxuICAvLyBBIEdlbmVyYXRvciBzaG91bGQgYWx3YXlzIHJldHVybiBpdHNlbGYgYXMgdGhlIGl0ZXJhdG9yIG9iamVjdCB3aGVuIHRoZVxuICAvLyBAQGl0ZXJhdG9yIGZ1bmN0aW9uIGlzIGNhbGxlZCBvbiBpdC4gU29tZSBicm93c2VycycgaW1wbGVtZW50YXRpb25zIG9mIHRoZVxuICAvLyBpdGVyYXRvciBwcm90b3R5cGUgY2hhaW4gaW5jb3JyZWN0bHkgaW1wbGVtZW50IHRoaXMsIGNhdXNpbmcgdGhlIEdlbmVyYXRvclxuICAvLyBvYmplY3QgdG8gbm90IGJlIHJldHVybmVkIGZyb20gdGhpcyBjYWxsLiBUaGlzIGVuc3VyZXMgdGhhdCBkb2Vzbid0IGhhcHBlbi5cbiAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9mYWNlYm9vay9yZWdlbmVyYXRvci9pc3N1ZXMvMjc0IGZvciBtb3JlIGRldGFpbHMuXG4gIEdwW2l0ZXJhdG9yU3ltYm9sXSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIEdwLnRvU3RyaW5nID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIFwiW29iamVjdCBHZW5lcmF0b3JdXCI7XG4gIH07XG5cbiAgZnVuY3Rpb24gcHVzaFRyeUVudHJ5KGxvY3MpIHtcbiAgICB2YXIgZW50cnkgPSB7IHRyeUxvYzogbG9jc1swXSB9O1xuXG4gICAgaWYgKDEgaW4gbG9jcykge1xuICAgICAgZW50cnkuY2F0Y2hMb2MgPSBsb2NzWzFdO1xuICAgIH1cblxuICAgIGlmICgyIGluIGxvY3MpIHtcbiAgICAgIGVudHJ5LmZpbmFsbHlMb2MgPSBsb2NzWzJdO1xuICAgICAgZW50cnkuYWZ0ZXJMb2MgPSBsb2NzWzNdO1xuICAgIH1cblxuICAgIHRoaXMudHJ5RW50cmllcy5wdXNoKGVudHJ5KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlc2V0VHJ5RW50cnkoZW50cnkpIHtcbiAgICB2YXIgcmVjb3JkID0gZW50cnkuY29tcGxldGlvbiB8fCB7fTtcbiAgICByZWNvcmQudHlwZSA9IFwibm9ybWFsXCI7XG4gICAgZGVsZXRlIHJlY29yZC5hcmc7XG4gICAgZW50cnkuY29tcGxldGlvbiA9IHJlY29yZDtcbiAgfVxuXG4gIGZ1bmN0aW9uIENvbnRleHQodHJ5TG9jc0xpc3QpIHtcbiAgICAvLyBUaGUgcm9vdCBlbnRyeSBvYmplY3QgKGVmZmVjdGl2ZWx5IGEgdHJ5IHN0YXRlbWVudCB3aXRob3V0IGEgY2F0Y2hcbiAgICAvLyBvciBhIGZpbmFsbHkgYmxvY2spIGdpdmVzIHVzIGEgcGxhY2UgdG8gc3RvcmUgdmFsdWVzIHRocm93biBmcm9tXG4gICAgLy8gbG9jYXRpb25zIHdoZXJlIHRoZXJlIGlzIG5vIGVuY2xvc2luZyB0cnkgc3RhdGVtZW50LlxuICAgIHRoaXMudHJ5RW50cmllcyA9IFt7IHRyeUxvYzogXCJyb290XCIgfV07XG4gICAgdHJ5TG9jc0xpc3QuZm9yRWFjaChwdXNoVHJ5RW50cnksIHRoaXMpO1xuICAgIHRoaXMucmVzZXQodHJ1ZSk7XG4gIH1cblxuICBleHBvcnRzLmtleXMgPSBmdW5jdGlvbihvYmplY3QpIHtcbiAgICB2YXIga2V5cyA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvYmplY3QpIHtcbiAgICAgIGtleXMucHVzaChrZXkpO1xuICAgIH1cbiAgICBrZXlzLnJldmVyc2UoKTtcblxuICAgIC8vIFJhdGhlciB0aGFuIHJldHVybmluZyBhbiBvYmplY3Qgd2l0aCBhIG5leHQgbWV0aG9kLCB3ZSBrZWVwXG4gICAgLy8gdGhpbmdzIHNpbXBsZSBhbmQgcmV0dXJuIHRoZSBuZXh0IGZ1bmN0aW9uIGl0c2VsZi5cbiAgICByZXR1cm4gZnVuY3Rpb24gbmV4dCgpIHtcbiAgICAgIHdoaWxlIChrZXlzLmxlbmd0aCkge1xuICAgICAgICB2YXIga2V5ID0ga2V5cy5wb3AoKTtcbiAgICAgICAgaWYgKGtleSBpbiBvYmplY3QpIHtcbiAgICAgICAgICBuZXh0LnZhbHVlID0ga2V5O1xuICAgICAgICAgIG5leHQuZG9uZSA9IGZhbHNlO1xuICAgICAgICAgIHJldHVybiBuZXh0O1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFRvIGF2b2lkIGNyZWF0aW5nIGFuIGFkZGl0aW9uYWwgb2JqZWN0LCB3ZSBqdXN0IGhhbmcgdGhlIC52YWx1ZVxuICAgICAgLy8gYW5kIC5kb25lIHByb3BlcnRpZXMgb2ZmIHRoZSBuZXh0IGZ1bmN0aW9uIG9iamVjdCBpdHNlbGYuIFRoaXNcbiAgICAgIC8vIGFsc28gZW5zdXJlcyB0aGF0IHRoZSBtaW5pZmllciB3aWxsIG5vdCBhbm9ueW1pemUgdGhlIGZ1bmN0aW9uLlxuICAgICAgbmV4dC5kb25lID0gdHJ1ZTtcbiAgICAgIHJldHVybiBuZXh0O1xuICAgIH07XG4gIH07XG5cbiAgZnVuY3Rpb24gdmFsdWVzKGl0ZXJhYmxlKSB7XG4gICAgaWYgKGl0ZXJhYmxlKSB7XG4gICAgICB2YXIgaXRlcmF0b3JNZXRob2QgPSBpdGVyYWJsZVtpdGVyYXRvclN5bWJvbF07XG4gICAgICBpZiAoaXRlcmF0b3JNZXRob2QpIHtcbiAgICAgICAgcmV0dXJuIGl0ZXJhdG9yTWV0aG9kLmNhbGwoaXRlcmFibGUpO1xuICAgICAgfVxuXG4gICAgICBpZiAodHlwZW9mIGl0ZXJhYmxlLm5leHQgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICByZXR1cm4gaXRlcmFibGU7XG4gICAgICB9XG5cbiAgICAgIGlmICghaXNOYU4oaXRlcmFibGUubGVuZ3RoKSkge1xuICAgICAgICB2YXIgaSA9IC0xLCBuZXh0ID0gZnVuY3Rpb24gbmV4dCgpIHtcbiAgICAgICAgICB3aGlsZSAoKytpIDwgaXRlcmFibGUubGVuZ3RoKSB7XG4gICAgICAgICAgICBpZiAoaGFzT3duLmNhbGwoaXRlcmFibGUsIGkpKSB7XG4gICAgICAgICAgICAgIG5leHQudmFsdWUgPSBpdGVyYWJsZVtpXTtcbiAgICAgICAgICAgICAgbmV4dC5kb25lID0gZmFsc2U7XG4gICAgICAgICAgICAgIHJldHVybiBuZXh0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIG5leHQudmFsdWUgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgbmV4dC5kb25lID0gdHJ1ZTtcblxuICAgICAgICAgIHJldHVybiBuZXh0O1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBuZXh0Lm5leHQgPSBuZXh0O1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFJldHVybiBhbiBpdGVyYXRvciB3aXRoIG5vIHZhbHVlcy5cbiAgICByZXR1cm4geyBuZXh0OiBkb25lUmVzdWx0IH07XG4gIH1cbiAgZXhwb3J0cy52YWx1ZXMgPSB2YWx1ZXM7XG5cbiAgZnVuY3Rpb24gZG9uZVJlc3VsdCgpIHtcbiAgICByZXR1cm4geyB2YWx1ZTogdW5kZWZpbmVkLCBkb25lOiB0cnVlIH07XG4gIH1cblxuICBDb250ZXh0LnByb3RvdHlwZSA9IHtcbiAgICBjb25zdHJ1Y3RvcjogQ29udGV4dCxcblxuICAgIHJlc2V0OiBmdW5jdGlvbihza2lwVGVtcFJlc2V0KSB7XG4gICAgICB0aGlzLnByZXYgPSAwO1xuICAgICAgdGhpcy5uZXh0ID0gMDtcbiAgICAgIC8vIFJlc2V0dGluZyBjb250ZXh0Ll9zZW50IGZvciBsZWdhY3kgc3VwcG9ydCBvZiBCYWJlbCdzXG4gICAgICAvLyBmdW5jdGlvbi5zZW50IGltcGxlbWVudGF0aW9uLlxuICAgICAgdGhpcy5zZW50ID0gdGhpcy5fc2VudCA9IHVuZGVmaW5lZDtcbiAgICAgIHRoaXMuZG9uZSA9IGZhbHNlO1xuICAgICAgdGhpcy5kZWxlZ2F0ZSA9IG51bGw7XG5cbiAgICAgIHRoaXMubWV0aG9kID0gXCJuZXh0XCI7XG4gICAgICB0aGlzLmFyZyA9IHVuZGVmaW5lZDtcblxuICAgICAgdGhpcy50cnlFbnRyaWVzLmZvckVhY2gocmVzZXRUcnlFbnRyeSk7XG5cbiAgICAgIGlmICghc2tpcFRlbXBSZXNldCkge1xuICAgICAgICBmb3IgKHZhciBuYW1lIGluIHRoaXMpIHtcbiAgICAgICAgICAvLyBOb3Qgc3VyZSBhYm91dCB0aGUgb3B0aW1hbCBvcmRlciBvZiB0aGVzZSBjb25kaXRpb25zOlxuICAgICAgICAgIGlmIChuYW1lLmNoYXJBdCgwKSA9PT0gXCJ0XCIgJiZcbiAgICAgICAgICAgICAgaGFzT3duLmNhbGwodGhpcywgbmFtZSkgJiZcbiAgICAgICAgICAgICAgIWlzTmFOKCtuYW1lLnNsaWNlKDEpKSkge1xuICAgICAgICAgICAgdGhpc1tuYW1lXSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuXG4gICAgc3RvcDogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLmRvbmUgPSB0cnVlO1xuXG4gICAgICB2YXIgcm9vdEVudHJ5ID0gdGhpcy50cnlFbnRyaWVzWzBdO1xuICAgICAgdmFyIHJvb3RSZWNvcmQgPSByb290RW50cnkuY29tcGxldGlvbjtcbiAgICAgIGlmIChyb290UmVjb3JkLnR5cGUgPT09IFwidGhyb3dcIikge1xuICAgICAgICB0aHJvdyByb290UmVjb3JkLmFyZztcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRoaXMucnZhbDtcbiAgICB9LFxuXG4gICAgZGlzcGF0Y2hFeGNlcHRpb246IGZ1bmN0aW9uKGV4Y2VwdGlvbikge1xuICAgICAgaWYgKHRoaXMuZG9uZSkge1xuICAgICAgICB0aHJvdyBleGNlcHRpb247XG4gICAgICB9XG5cbiAgICAgIHZhciBjb250ZXh0ID0gdGhpcztcbiAgICAgIGZ1bmN0aW9uIGhhbmRsZShsb2MsIGNhdWdodCkge1xuICAgICAgICByZWNvcmQudHlwZSA9IFwidGhyb3dcIjtcbiAgICAgICAgcmVjb3JkLmFyZyA9IGV4Y2VwdGlvbjtcbiAgICAgICAgY29udGV4dC5uZXh0ID0gbG9jO1xuXG4gICAgICAgIGlmIChjYXVnaHQpIHtcbiAgICAgICAgICAvLyBJZiB0aGUgZGlzcGF0Y2hlZCBleGNlcHRpb24gd2FzIGNhdWdodCBieSBhIGNhdGNoIGJsb2NrLFxuICAgICAgICAgIC8vIHRoZW4gbGV0IHRoYXQgY2F0Y2ggYmxvY2sgaGFuZGxlIHRoZSBleGNlcHRpb24gbm9ybWFsbHkuXG4gICAgICAgICAgY29udGV4dC5tZXRob2QgPSBcIm5leHRcIjtcbiAgICAgICAgICBjb250ZXh0LmFyZyA9IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAhISBjYXVnaHQ7XG4gICAgICB9XG5cbiAgICAgIGZvciAodmFyIGkgPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHtcbiAgICAgICAgdmFyIGVudHJ5ID0gdGhpcy50cnlFbnRyaWVzW2ldO1xuICAgICAgICB2YXIgcmVjb3JkID0gZW50cnkuY29tcGxldGlvbjtcblxuICAgICAgICBpZiAoZW50cnkudHJ5TG9jID09PSBcInJvb3RcIikge1xuICAgICAgICAgIC8vIEV4Y2VwdGlvbiB0aHJvd24gb3V0c2lkZSBvZiBhbnkgdHJ5IGJsb2NrIHRoYXQgY291bGQgaGFuZGxlXG4gICAgICAgICAgLy8gaXQsIHNvIHNldCB0aGUgY29tcGxldGlvbiB2YWx1ZSBvZiB0aGUgZW50aXJlIGZ1bmN0aW9uIHRvXG4gICAgICAgICAgLy8gdGhyb3cgdGhlIGV4Y2VwdGlvbi5cbiAgICAgICAgICByZXR1cm4gaGFuZGxlKFwiZW5kXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGVudHJ5LnRyeUxvYyA8PSB0aGlzLnByZXYpIHtcbiAgICAgICAgICB2YXIgaGFzQ2F0Y2ggPSBoYXNPd24uY2FsbChlbnRyeSwgXCJjYXRjaExvY1wiKTtcbiAgICAgICAgICB2YXIgaGFzRmluYWxseSA9IGhhc093bi5jYWxsKGVudHJ5LCBcImZpbmFsbHlMb2NcIik7XG5cbiAgICAgICAgICBpZiAoaGFzQ2F0Y2ggJiYgaGFzRmluYWxseSkge1xuICAgICAgICAgICAgaWYgKHRoaXMucHJldiA8IGVudHJ5LmNhdGNoTG9jKSB7XG4gICAgICAgICAgICAgIHJldHVybiBoYW5kbGUoZW50cnkuY2F0Y2hMb2MsIHRydWUpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnByZXYgPCBlbnRyeS5maW5hbGx5TG9jKSB7XG4gICAgICAgICAgICAgIHJldHVybiBoYW5kbGUoZW50cnkuZmluYWxseUxvYyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICB9IGVsc2UgaWYgKGhhc0NhdGNoKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5wcmV2IDwgZW50cnkuY2F0Y2hMb2MpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZShlbnRyeS5jYXRjaExvYywgdHJ1ZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICB9IGVsc2UgaWYgKGhhc0ZpbmFsbHkpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnByZXYgPCBlbnRyeS5maW5hbGx5TG9jKSB7XG4gICAgICAgICAgICAgIHJldHVybiBoYW5kbGUoZW50cnkuZmluYWxseUxvYyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwidHJ5IHN0YXRlbWVudCB3aXRob3V0IGNhdGNoIG9yIGZpbmFsbHlcIik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcblxuICAgIGFicnVwdDogZnVuY3Rpb24odHlwZSwgYXJnKSB7XG4gICAgICBmb3IgKHZhciBpID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7XG4gICAgICAgIHZhciBlbnRyeSA9IHRoaXMudHJ5RW50cmllc1tpXTtcbiAgICAgICAgaWYgKGVudHJ5LnRyeUxvYyA8PSB0aGlzLnByZXYgJiZcbiAgICAgICAgICAgIGhhc093bi5jYWxsKGVudHJ5LCBcImZpbmFsbHlMb2NcIikgJiZcbiAgICAgICAgICAgIHRoaXMucHJldiA8IGVudHJ5LmZpbmFsbHlMb2MpIHtcbiAgICAgICAgICB2YXIgZmluYWxseUVudHJ5ID0gZW50cnk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKGZpbmFsbHlFbnRyeSAmJlxuICAgICAgICAgICh0eXBlID09PSBcImJyZWFrXCIgfHxcbiAgICAgICAgICAgdHlwZSA9PT0gXCJjb250aW51ZVwiKSAmJlxuICAgICAgICAgIGZpbmFsbHlFbnRyeS50cnlMb2MgPD0gYXJnICYmXG4gICAgICAgICAgYXJnIDw9IGZpbmFsbHlFbnRyeS5maW5hbGx5TG9jKSB7XG4gICAgICAgIC8vIElnbm9yZSB0aGUgZmluYWxseSBlbnRyeSBpZiBjb250cm9sIGlzIG5vdCBqdW1waW5nIHRvIGFcbiAgICAgICAgLy8gbG9jYXRpb24gb3V0c2lkZSB0aGUgdHJ5L2NhdGNoIGJsb2NrLlxuICAgICAgICBmaW5hbGx5RW50cnkgPSBudWxsO1xuICAgICAgfVxuXG4gICAgICB2YXIgcmVjb3JkID0gZmluYWxseUVudHJ5ID8gZmluYWxseUVudHJ5LmNvbXBsZXRpb24gOiB7fTtcbiAgICAgIHJlY29yZC50eXBlID0gdHlwZTtcbiAgICAgIHJlY29yZC5hcmcgPSBhcmc7XG5cbiAgICAgIGlmIChmaW5hbGx5RW50cnkpIHtcbiAgICAgICAgdGhpcy5tZXRob2QgPSBcIm5leHRcIjtcbiAgICAgICAgdGhpcy5uZXh0ID0gZmluYWxseUVudHJ5LmZpbmFsbHlMb2M7XG4gICAgICAgIHJldHVybiBDb250aW51ZVNlbnRpbmVsO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcy5jb21wbGV0ZShyZWNvcmQpO1xuICAgIH0sXG5cbiAgICBjb21wbGV0ZTogZnVuY3Rpb24ocmVjb3JkLCBhZnRlckxvYykge1xuICAgICAgaWYgKHJlY29yZC50eXBlID09PSBcInRocm93XCIpIHtcbiAgICAgICAgdGhyb3cgcmVjb3JkLmFyZztcbiAgICAgIH1cblxuICAgICAgaWYgKHJlY29yZC50eXBlID09PSBcImJyZWFrXCIgfHxcbiAgICAgICAgICByZWNvcmQudHlwZSA9PT0gXCJjb250aW51ZVwiKSB7XG4gICAgICAgIHRoaXMubmV4dCA9IHJlY29yZC5hcmc7XG4gICAgICB9IGVsc2UgaWYgKHJlY29yZC50eXBlID09PSBcInJldHVyblwiKSB7XG4gICAgICAgIHRoaXMucnZhbCA9IHRoaXMuYXJnID0gcmVjb3JkLmFyZztcbiAgICAgICAgdGhpcy5tZXRob2QgPSBcInJldHVyblwiO1xuICAgICAgICB0aGlzLm5leHQgPSBcImVuZFwiO1xuICAgICAgfSBlbHNlIGlmIChyZWNvcmQudHlwZSA9PT0gXCJub3JtYWxcIiAmJiBhZnRlckxvYykge1xuICAgICAgICB0aGlzLm5leHQgPSBhZnRlckxvYztcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7XG4gICAgfSxcblxuICAgIGZpbmlzaDogZnVuY3Rpb24oZmluYWxseUxvYykge1xuICAgICAgZm9yICh2YXIgaSA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge1xuICAgICAgICB2YXIgZW50cnkgPSB0aGlzLnRyeUVudHJpZXNbaV07XG4gICAgICAgIGlmIChlbnRyeS5maW5hbGx5TG9jID09PSBmaW5hbGx5TG9jKSB7XG4gICAgICAgICAgdGhpcy5jb21wbGV0ZShlbnRyeS5jb21wbGV0aW9uLCBlbnRyeS5hZnRlckxvYyk7XG4gICAgICAgICAgcmVzZXRUcnlFbnRyeShlbnRyeSk7XG4gICAgICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuXG4gICAgXCJjYXRjaFwiOiBmdW5jdGlvbih0cnlMb2MpIHtcbiAgICAgIGZvciAodmFyIGkgPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHtcbiAgICAgICAgdmFyIGVudHJ5ID0gdGhpcy50cnlFbnRyaWVzW2ldO1xuICAgICAgICBpZiAoZW50cnkudHJ5TG9jID09PSB0cnlMb2MpIHtcbiAgICAgICAgICB2YXIgcmVjb3JkID0gZW50cnkuY29tcGxldGlvbjtcbiAgICAgICAgICBpZiAocmVjb3JkLnR5cGUgPT09IFwidGhyb3dcIikge1xuICAgICAgICAgICAgdmFyIHRocm93biA9IHJlY29yZC5hcmc7XG4gICAgICAgICAgICByZXNldFRyeUVudHJ5KGVudHJ5KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHRocm93bjtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBUaGUgY29udGV4dC5jYXRjaCBtZXRob2QgbXVzdCBvbmx5IGJlIGNhbGxlZCB3aXRoIGEgbG9jYXRpb25cbiAgICAgIC8vIGFyZ3VtZW50IHRoYXQgY29ycmVzcG9uZHMgdG8gYSBrbm93biBjYXRjaCBibG9jay5cbiAgICAgIHRocm93IG5ldyBFcnJvcihcImlsbGVnYWwgY2F0Y2ggYXR0ZW1wdFwiKTtcbiAgICB9LFxuXG4gICAgZGVsZWdhdGVZaWVsZDogZnVuY3Rpb24oaXRlcmFibGUsIHJlc3VsdE5hbWUsIG5leHRMb2MpIHtcbiAgICAgIHRoaXMuZGVsZWdhdGUgPSB7XG4gICAgICAgIGl0ZXJhdG9yOiB2YWx1ZXMoaXRlcmFibGUpLFxuICAgICAgICByZXN1bHROYW1lOiByZXN1bHROYW1lLFxuICAgICAgICBuZXh0TG9jOiBuZXh0TG9jXG4gICAgICB9O1xuXG4gICAgICBpZiAodGhpcy5tZXRob2QgPT09IFwibmV4dFwiKSB7XG4gICAgICAgIC8vIERlbGliZXJhdGVseSBmb3JnZXQgdGhlIGxhc3Qgc2VudCB2YWx1ZSBzbyB0aGF0IHdlIGRvbid0XG4gICAgICAgIC8vIGFjY2lkZW50YWxseSBwYXNzIGl0IG9uIHRvIHRoZSBkZWxlZ2F0ZS5cbiAgICAgICAgdGhpcy5hcmcgPSB1bmRlZmluZWQ7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBDb250aW51ZVNlbnRpbmVsO1xuICAgIH1cbiAgfTtcblxuICAvLyBSZWdhcmRsZXNzIG9mIHdoZXRoZXIgdGhpcyBzY3JpcHQgaXMgZXhlY3V0aW5nIGFzIGEgQ29tbW9uSlMgbW9kdWxlXG4gIC8vIG9yIG5vdCwgcmV0dXJuIHRoZSBydW50aW1lIG9iamVjdCBzbyB0aGF0IHdlIGNhbiBkZWNsYXJlIHRoZSB2YXJpYWJsZVxuICAvLyByZWdlbmVyYXRvclJ1bnRpbWUgaW4gdGhlIG91dGVyIHNjb3BlLCB3aGljaCBhbGxvd3MgdGhpcyBtb2R1bGUgdG8gYmVcbiAgLy8gaW5qZWN0ZWQgZWFzaWx5IGJ5IGBiaW4vcmVnZW5lcmF0b3IgLS1pbmNsdWRlLXJ1bnRpbWUgc2NyaXB0LmpzYC5cbiAgcmV0dXJuIGV4cG9ydHM7XG5cbn0oXG4gIC8vIElmIHRoaXMgc2NyaXB0IGlzIGV4ZWN1dGluZyBhcyBhIENvbW1vbkpTIG1vZHVsZSwgdXNlIG1vZHVsZS5leHBvcnRzXG4gIC8vIGFzIHRoZSByZWdlbmVyYXRvclJ1bnRpbWUgbmFtZXNwYWNlLiBPdGhlcndpc2UgY3JlYXRlIGEgbmV3IGVtcHR5XG4gIC8vIG9iamVjdC4gRWl0aGVyIHdheSwgdGhlIHJlc3VsdGluZyBvYmplY3Qgd2lsbCBiZSB1c2VkIHRvIGluaXRpYWxpemVcbiAgLy8gdGhlIHJlZ2VuZXJhdG9yUnVudGltZSB2YXJpYWJsZSBhdCB0aGUgdG9wIG9mIHRoaXMgZmlsZS5cbiAgdHlwZW9mIG1vZHVsZSA9PT0gXCJvYmplY3RcIiA/IG1vZHVsZS5leHBvcnRzIDoge31cbikpO1xuXG50cnkge1xuICByZWdlbmVyYXRvclJ1bnRpbWUgPSBydW50aW1lO1xufSBjYXRjaCAoYWNjaWRlbnRhbFN0cmljdE1vZGUpIHtcbiAgLy8gVGhpcyBtb2R1bGUgc2hvdWxkIG5vdCBiZSBydW5uaW5nIGluIHN0cmljdCBtb2RlLCBzbyB0aGUgYWJvdmVcbiAgLy8gYXNzaWdubWVudCBzaG91bGQgYWx3YXlzIHdvcmsgdW5sZXNzIHNvbWV0aGluZyBpcyBtaXNjb25maWd1cmVkLiBKdXN0XG4gIC8vIGluIGNhc2UgcnVudGltZS5qcyBhY2NpZGVudGFsbHkgcnVucyBpbiBzdHJpY3QgbW9kZSwgd2UgY2FuIGVzY2FwZVxuICAvLyBzdHJpY3QgbW9kZSB1c2luZyBhIGdsb2JhbCBGdW5jdGlvbiBjYWxsLiBUaGlzIGNvdWxkIGNvbmNlaXZhYmx5IGZhaWxcbiAgLy8gaWYgYSBDb250ZW50IFNlY3VyaXR5IFBvbGljeSBmb3JiaWRzIHVzaW5nIEZ1bmN0aW9uLCBidXQgaW4gdGhhdCBjYXNlXG4gIC8vIHRoZSBwcm9wZXIgc29sdXRpb24gaXMgdG8gZml4IHRoZSBhY2NpZGVudGFsIHN0cmljdCBtb2RlIHByb2JsZW0uIElmXG4gIC8vIHlvdSd2ZSBtaXNjb25maWd1cmVkIHlvdXIgYnVuZGxlciB0byBmb3JjZSBzdHJpY3QgbW9kZSBhbmQgYXBwbGllZCBhXG4gIC8vIENTUCB0byBmb3JiaWQgRnVuY3Rpb24sIGFuZCB5b3UncmUgbm90IHdpbGxpbmcgdG8gZml4IGVpdGhlciBvZiB0aG9zZVxuICAvLyBwcm9ibGVtcywgcGxlYXNlIGRldGFpbCB5b3VyIHVuaXF1ZSBwcmVkaWNhbWVudCBpbiBhIEdpdEh1YiBpc3N1ZS5cbiAgRnVuY3Rpb24oXCJyXCIsIFwicmVnZW5lcmF0b3JSdW50aW1lID0gclwiKShydW50aW1lKTtcbn1cbiIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuXG5leHBvcnRzLmJyb3dzZXIgPSByZXF1aXJlKFwid2ViZXh0ZW5zaW9uLXBvbHlmaWxsXCIpO1xuIiwiKGZ1bmN0aW9uIChnbG9iYWwsIGZhY3RvcnkpIHtcbiAgaWYgKHR5cGVvZiBkZWZpbmUgPT09IFwiZnVuY3Rpb25cIiAmJiBkZWZpbmUuYW1kKSB7XG4gICAgZGVmaW5lKFwid2ViZXh0ZW5zaW9uLXBvbHlmaWxsXCIsIFtcIm1vZHVsZVwiXSwgZmFjdG9yeSk7XG4gIH0gZWxzZSBpZiAodHlwZW9mIGV4cG9ydHMgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICBmYWN0b3J5KG1vZHVsZSk7XG4gIH0gZWxzZSB7XG4gICAgdmFyIG1vZCA9IHtcbiAgICAgIGV4cG9ydHM6IHt9XG4gICAgfTtcbiAgICBmYWN0b3J5KG1vZCk7XG4gICAgZ2xvYmFsLmJyb3dzZXIgPSBtb2QuZXhwb3J0cztcbiAgfVxufSkodHlwZW9mIGdsb2JhbFRoaXMgIT09IFwidW5kZWZpbmVkXCIgPyBnbG9iYWxUaGlzIDogdHlwZW9mIHNlbGYgIT09IFwidW5kZWZpbmVkXCIgPyBzZWxmIDogdGhpcywgZnVuY3Rpb24gKG1vZHVsZSkge1xuICAvKiB3ZWJleHRlbnNpb24tcG9seWZpbGwgLSB2MC43LjAgLSBUdWUgTm92IDEwIDIwMjAgMjA6MjQ6MDQgKi9cblxuICAvKiAtKi0gTW9kZTogaW5kZW50LXRhYnMtbW9kZTogbmlsOyBqcy1pbmRlbnQtbGV2ZWw6IDIgLSotICovXG5cbiAgLyogdmltOiBzZXQgc3RzPTIgc3c9MiBldCB0dz04MDogKi9cblxuICAvKiBUaGlzIFNvdXJjZSBDb2RlIEZvcm0gaXMgc3ViamVjdCB0byB0aGUgdGVybXMgb2YgdGhlIE1vemlsbGEgUHVibGljXG4gICAqIExpY2Vuc2UsIHYuIDIuMC4gSWYgYSBjb3B5IG9mIHRoZSBNUEwgd2FzIG5vdCBkaXN0cmlidXRlZCB3aXRoIHRoaXNcbiAgICogZmlsZSwgWW91IGNhbiBvYnRhaW4gb25lIGF0IGh0dHA6Ly9tb3ppbGxhLm9yZy9NUEwvMi4wLy4gKi9cbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgaWYgKHR5cGVvZiBicm93c2VyID09PSBcInVuZGVmaW5lZFwiIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZihicm93c2VyKSAhPT0gT2JqZWN0LnByb3RvdHlwZSkge1xuICAgIGNvbnN0IENIUk9NRV9TRU5EX01FU1NBR0VfQ0FMTEJBQ0tfTk9fUkVTUE9OU0VfTUVTU0FHRSA9IFwiVGhlIG1lc3NhZ2UgcG9ydCBjbG9zZWQgYmVmb3JlIGEgcmVzcG9uc2Ugd2FzIHJlY2VpdmVkLlwiO1xuICAgIGNvbnN0IFNFTkRfUkVTUE9OU0VfREVQUkVDQVRJT05fV0FSTklORyA9IFwiUmV0dXJuaW5nIGEgUHJvbWlzZSBpcyB0aGUgcHJlZmVycmVkIHdheSB0byBzZW5kIGEgcmVwbHkgZnJvbSBhbiBvbk1lc3NhZ2Uvb25NZXNzYWdlRXh0ZXJuYWwgbGlzdGVuZXIsIGFzIHRoZSBzZW5kUmVzcG9uc2Ugd2lsbCBiZSByZW1vdmVkIGZyb20gdGhlIHNwZWNzIChTZWUgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZG9jcy9Nb3ppbGxhL0FkZC1vbnMvV2ViRXh0ZW5zaW9ucy9BUEkvcnVudGltZS9vbk1lc3NhZ2UpXCI7IC8vIFdyYXBwaW5nIHRoZSBidWxrIG9mIHRoaXMgcG9seWZpbGwgaW4gYSBvbmUtdGltZS11c2UgZnVuY3Rpb24gaXMgYSBtaW5vclxuICAgIC8vIG9wdGltaXphdGlvbiBmb3IgRmlyZWZveC4gU2luY2UgU3BpZGVybW9ua2V5IGRvZXMgbm90IGZ1bGx5IHBhcnNlIHRoZVxuICAgIC8vIGNvbnRlbnRzIG9mIGEgZnVuY3Rpb24gdW50aWwgdGhlIGZpcnN0IHRpbWUgaXQncyBjYWxsZWQsIGFuZCBzaW5jZSBpdCB3aWxsXG4gICAgLy8gbmV2ZXIgYWN0dWFsbHkgbmVlZCB0byBiZSBjYWxsZWQsIHRoaXMgYWxsb3dzIHRoZSBwb2x5ZmlsbCB0byBiZSBpbmNsdWRlZFxuICAgIC8vIGluIEZpcmVmb3ggbmVhcmx5IGZvciBmcmVlLlxuXG4gICAgY29uc3Qgd3JhcEFQSXMgPSBleHRlbnNpb25BUElzID0+IHtcbiAgICAgIC8vIE5PVEU6IGFwaU1ldGFkYXRhIGlzIGFzc29jaWF0ZWQgdG8gdGhlIGNvbnRlbnQgb2YgdGhlIGFwaS1tZXRhZGF0YS5qc29uIGZpbGVcbiAgICAgIC8vIGF0IGJ1aWxkIHRpbWUgYnkgcmVwbGFjaW5nIHRoZSBmb2xsb3dpbmcgXCJpbmNsdWRlXCIgd2l0aCB0aGUgY29udGVudCBvZiB0aGVcbiAgICAgIC8vIEpTT04gZmlsZS5cbiAgICAgIGNvbnN0IGFwaU1ldGFkYXRhID0ge1xuICAgICAgICBcImFsYXJtc1wiOiB7XG4gICAgICAgICAgXCJjbGVhclwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImNsZWFyQWxsXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAwLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDBcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiZ2V0XCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAwLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiZ2V0QWxsXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAwLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDBcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIFwiYm9va21hcmtzXCI6IHtcbiAgICAgICAgICBcImNyZWF0ZVwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImdldFwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImdldENoaWxkcmVuXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiZ2V0UmVjZW50XCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiZ2V0U3ViVHJlZVwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImdldFRyZWVcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDAsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMFxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJtb3ZlXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAyLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDJcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwicmVtb3ZlXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwicmVtb3ZlVHJlZVwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInNlYXJjaFwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInVwZGF0ZVwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMixcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAyXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBcImJyb3dzZXJBY3Rpb25cIjoge1xuICAgICAgICAgIFwiZGlzYWJsZVwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJmYWxsYmFja1RvTm9DYWxsYmFja1wiOiB0cnVlXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImVuYWJsZVwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJmYWxsYmFja1RvTm9DYWxsYmFja1wiOiB0cnVlXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImdldEJhZGdlQmFja2dyb3VuZENvbG9yXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiZ2V0QmFkZ2VUZXh0XCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiZ2V0UG9wdXBcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJnZXRUaXRsZVwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcIm9wZW5Qb3B1cFwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAwXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInNldEJhZGdlQmFja2dyb3VuZENvbG9yXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDEsXG4gICAgICAgICAgICBcImZhbGxiYWNrVG9Ob0NhbGxiYWNrXCI6IHRydWVcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwic2V0QmFkZ2VUZXh0XCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDEsXG4gICAgICAgICAgICBcImZhbGxiYWNrVG9Ob0NhbGxiYWNrXCI6IHRydWVcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwic2V0SWNvblwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInNldFBvcHVwXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDEsXG4gICAgICAgICAgICBcImZhbGxiYWNrVG9Ob0NhbGxiYWNrXCI6IHRydWVcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwic2V0VGl0bGVcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwiZmFsbGJhY2tUb05vQ2FsbGJhY2tcIjogdHJ1ZVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgXCJicm93c2luZ0RhdGFcIjoge1xuICAgICAgICAgIFwicmVtb3ZlXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAyLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDJcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwicmVtb3ZlQ2FjaGVcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJyZW1vdmVDb29raWVzXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwicmVtb3ZlRG93bmxvYWRzXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwicmVtb3ZlRm9ybURhdGFcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJyZW1vdmVIaXN0b3J5XCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwicmVtb3ZlTG9jYWxTdG9yYWdlXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwicmVtb3ZlUGFzc3dvcmRzXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwicmVtb3ZlUGx1Z2luRGF0YVwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInNldHRpbmdzXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAwLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDBcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIFwiY29tbWFuZHNcIjoge1xuICAgICAgICAgIFwiZ2V0QWxsXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAwLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDBcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIFwiY29udGV4dE1lbnVzXCI6IHtcbiAgICAgICAgICBcInJlbW92ZVwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInJlbW92ZUFsbFwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAwXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInVwZGF0ZVwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMixcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAyXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBcImNvb2tpZXNcIjoge1xuICAgICAgICAgIFwiZ2V0XCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiZ2V0QWxsXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiZ2V0QWxsQ29va2llU3RvcmVzXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAwLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDBcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwicmVtb3ZlXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwic2V0XCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIFwiZGV2dG9vbHNcIjoge1xuICAgICAgICAgIFwiaW5zcGVjdGVkV2luZG93XCI6IHtcbiAgICAgICAgICAgIFwiZXZhbFwiOiB7XG4gICAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgICBcIm1heEFyZ3NcIjogMixcbiAgICAgICAgICAgICAgXCJzaW5nbGVDYWxsYmFja0FyZ1wiOiBmYWxzZVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJwYW5lbHNcIjoge1xuICAgICAgICAgICAgXCJjcmVhdGVcIjoge1xuICAgICAgICAgICAgICBcIm1pbkFyZ3NcIjogMyxcbiAgICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDMsXG4gICAgICAgICAgICAgIFwic2luZ2xlQ2FsbGJhY2tBcmdcIjogdHJ1ZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwiZWxlbWVudHNcIjoge1xuICAgICAgICAgICAgICBcImNyZWF0ZVNpZGViYXJQYW5lXCI6IHtcbiAgICAgICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBcImRvd25sb2Fkc1wiOiB7XG4gICAgICAgICAgXCJjYW5jZWxcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJkb3dubG9hZFwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImVyYXNlXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiZ2V0RmlsZUljb25cIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMlxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJvcGVuXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDEsXG4gICAgICAgICAgICBcImZhbGxiYWNrVG9Ob0NhbGxiYWNrXCI6IHRydWVcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwicGF1c2VcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJyZW1vdmVGaWxlXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwicmVzdW1lXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwic2VhcmNoXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwic2hvd1wiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJmYWxsYmFja1RvTm9DYWxsYmFja1wiOiB0cnVlXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBcImV4dGVuc2lvblwiOiB7XG4gICAgICAgICAgXCJpc0FsbG93ZWRGaWxlU2NoZW1lQWNjZXNzXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAwLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDBcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiaXNBbGxvd2VkSW5jb2duaXRvQWNjZXNzXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAwLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDBcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIFwiaGlzdG9yeVwiOiB7XG4gICAgICAgICAgXCJhZGRVcmxcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJkZWxldGVBbGxcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDAsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMFxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJkZWxldGVSYW5nZVwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImRlbGV0ZVVybFwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImdldFZpc2l0c1wiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInNlYXJjaFwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBcImkxOG5cIjoge1xuICAgICAgICAgIFwiZGV0ZWN0TGFuZ3VhZ2VcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJnZXRBY2NlcHRMYW5ndWFnZXNcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDAsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMFxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgXCJpZGVudGl0eVwiOiB7XG4gICAgICAgICAgXCJsYXVuY2hXZWJBdXRoRmxvd1wiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBcImlkbGVcIjoge1xuICAgICAgICAgIFwicXVlcnlTdGF0ZVwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBcIm1hbmFnZW1lbnRcIjoge1xuICAgICAgICAgIFwiZ2V0XCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiZ2V0QWxsXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAwLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDBcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiZ2V0U2VsZlwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAwXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInNldEVuYWJsZWRcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDIsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMlxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJ1bmluc3RhbGxTZWxmXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAwLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIFwibm90aWZpY2F0aW9uc1wiOiB7XG4gICAgICAgICAgXCJjbGVhclwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImNyZWF0ZVwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAyXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImdldEFsbFwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAwXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImdldFBlcm1pc3Npb25MZXZlbFwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAwXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInVwZGF0ZVwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMixcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAyXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBcInBhZ2VBY3Rpb25cIjoge1xuICAgICAgICAgIFwiZ2V0UG9wdXBcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJnZXRUaXRsZVwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImhpZGVcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwiZmFsbGJhY2tUb05vQ2FsbGJhY2tcIjogdHJ1ZVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJzZXRJY29uXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwic2V0UG9wdXBcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwiZmFsbGJhY2tUb05vQ2FsbGJhY2tcIjogdHJ1ZVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJzZXRUaXRsZVwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJmYWxsYmFja1RvTm9DYWxsYmFja1wiOiB0cnVlXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInNob3dcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwiZmFsbGJhY2tUb05vQ2FsbGJhY2tcIjogdHJ1ZVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgXCJwZXJtaXNzaW9uc1wiOiB7XG4gICAgICAgICAgXCJjb250YWluc1wiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImdldEFsbFwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAwXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInJlbW92ZVwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInJlcXVlc3RcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgXCJydW50aW1lXCI6IHtcbiAgICAgICAgICBcImdldEJhY2tncm91bmRQYWdlXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAwLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDBcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiZ2V0UGxhdGZvcm1JbmZvXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAwLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDBcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwib3Blbk9wdGlvbnNQYWdlXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAwLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDBcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwicmVxdWVzdFVwZGF0ZUNoZWNrXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAwLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDBcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwic2VuZE1lc3NhZ2VcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogM1xuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJzZW5kTmF0aXZlTWVzc2FnZVwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMixcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAyXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInNldFVuaW5zdGFsbFVSTFwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBcInNlc3Npb25zXCI6IHtcbiAgICAgICAgICBcImdldERldmljZXNcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDAsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJnZXRSZWNlbnRseUNsb3NlZFwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInJlc3RvcmVcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDAsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgXCJzdG9yYWdlXCI6IHtcbiAgICAgICAgICBcImxvY2FsXCI6IHtcbiAgICAgICAgICAgIFwiY2xlYXJcIjoge1xuICAgICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDBcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcImdldFwiOiB7XG4gICAgICAgICAgICAgIFwibWluQXJnc1wiOiAwLFxuICAgICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwiZ2V0Qnl0ZXNJblVzZVwiOiB7XG4gICAgICAgICAgICAgIFwibWluQXJnc1wiOiAwLFxuICAgICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwicmVtb3ZlXCI6IHtcbiAgICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJzZXRcIjoge1xuICAgICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIFwibWFuYWdlZFwiOiB7XG4gICAgICAgICAgICBcImdldFwiOiB7XG4gICAgICAgICAgICAgIFwibWluQXJnc1wiOiAwLFxuICAgICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwiZ2V0Qnl0ZXNJblVzZVwiOiB7XG4gICAgICAgICAgICAgIFwibWluQXJnc1wiOiAwLFxuICAgICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJzeW5jXCI6IHtcbiAgICAgICAgICAgIFwiY2xlYXJcIjoge1xuICAgICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDBcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcImdldFwiOiB7XG4gICAgICAgICAgICAgIFwibWluQXJnc1wiOiAwLFxuICAgICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwiZ2V0Qnl0ZXNJblVzZVwiOiB7XG4gICAgICAgICAgICAgIFwibWluQXJnc1wiOiAwLFxuICAgICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwicmVtb3ZlXCI6IHtcbiAgICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJzZXRcIjoge1xuICAgICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIFwidGFic1wiOiB7XG4gICAgICAgICAgXCJjYXB0dXJlVmlzaWJsZVRhYlwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAyXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImNyZWF0ZVwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImRldGVjdExhbmd1YWdlXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAwLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiZGlzY2FyZFwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImR1cGxpY2F0ZVwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImV4ZWN1dGVTY3JpcHRcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMlxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJnZXRcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJnZXRDdXJyZW50XCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAwLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDBcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiZ2V0Wm9vbVwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImdldFpvb21TZXR0aW5nc1wiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImdvQmFja1wiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImdvRm9yd2FyZFwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImhpZ2hsaWdodFwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImluc2VydENTU1wiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAyXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcIm1vdmVcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDIsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMlxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJxdWVyeVwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInJlbG9hZFwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAyXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInJlbW92ZVwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInJlbW92ZUNTU1wiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAyXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInNlbmRNZXNzYWdlXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAyLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDNcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwic2V0Wm9vbVwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAyXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInNldFpvb21TZXR0aW5nc1wiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAyXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInVwZGF0ZVwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAyXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBcInRvcFNpdGVzXCI6IHtcbiAgICAgICAgICBcImdldFwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAwXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBcIndlYk5hdmlnYXRpb25cIjoge1xuICAgICAgICAgIFwiZ2V0QWxsRnJhbWVzXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiZ2V0RnJhbWVcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgXCJ3ZWJSZXF1ZXN0XCI6IHtcbiAgICAgICAgICBcImhhbmRsZXJCZWhhdmlvckNoYW5nZWRcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDAsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMFxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgXCJ3aW5kb3dzXCI6IHtcbiAgICAgICAgICBcImNyZWF0ZVwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImdldFwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAyXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImdldEFsbFwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImdldEN1cnJlbnRcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDAsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJnZXRMYXN0Rm9jdXNlZFwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInJlbW92ZVwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInVwZGF0ZVwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMixcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAyXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBpZiAoT2JqZWN0LmtleXMoYXBpTWV0YWRhdGEpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJhcGktbWV0YWRhdGEuanNvbiBoYXMgbm90IGJlZW4gaW5jbHVkZWQgaW4gYnJvd3Nlci1wb2x5ZmlsbFwiKTtcbiAgICAgIH1cbiAgICAgIC8qKlxuICAgICAgICogQSBXZWFrTWFwIHN1YmNsYXNzIHdoaWNoIGNyZWF0ZXMgYW5kIHN0b3JlcyBhIHZhbHVlIGZvciBhbnkga2V5IHdoaWNoIGRvZXNcbiAgICAgICAqIG5vdCBleGlzdCB3aGVuIGFjY2Vzc2VkLCBidXQgYmVoYXZlcyBleGFjdGx5IGFzIGFuIG9yZGluYXJ5IFdlYWtNYXBcbiAgICAgICAqIG90aGVyd2lzZS5cbiAgICAgICAqXG4gICAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBjcmVhdGVJdGVtXG4gICAgICAgKiAgICAgICAgQSBmdW5jdGlvbiB3aGljaCB3aWxsIGJlIGNhbGxlZCBpbiBvcmRlciB0byBjcmVhdGUgdGhlIHZhbHVlIGZvciBhbnlcbiAgICAgICAqICAgICAgICBrZXkgd2hpY2ggZG9lcyBub3QgZXhpc3QsIHRoZSBmaXJzdCB0aW1lIGl0IGlzIGFjY2Vzc2VkLiBUaGVcbiAgICAgICAqICAgICAgICBmdW5jdGlvbiByZWNlaXZlcywgYXMgaXRzIG9ubHkgYXJndW1lbnQsIHRoZSBrZXkgYmVpbmcgY3JlYXRlZC5cbiAgICAgICAqL1xuXG5cbiAgICAgIGNsYXNzIERlZmF1bHRXZWFrTWFwIGV4dGVuZHMgV2Vha01hcCB7XG4gICAgICAgIGNvbnN0cnVjdG9yKGNyZWF0ZUl0ZW0sIGl0ZW1zID0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgc3VwZXIoaXRlbXMpO1xuICAgICAgICAgIHRoaXMuY3JlYXRlSXRlbSA9IGNyZWF0ZUl0ZW07XG4gICAgICAgIH1cblxuICAgICAgICBnZXQoa2V5KSB7XG4gICAgICAgICAgaWYgKCF0aGlzLmhhcyhrZXkpKSB7XG4gICAgICAgICAgICB0aGlzLnNldChrZXksIHRoaXMuY3JlYXRlSXRlbShrZXkpKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gc3VwZXIuZ2V0KGtleSk7XG4gICAgICAgIH1cblxuICAgICAgfVxuICAgICAgLyoqXG4gICAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIGdpdmVuIG9iamVjdCBpcyBhbiBvYmplY3Qgd2l0aCBhIGB0aGVuYCBtZXRob2QsIGFuZCBjYW5cbiAgICAgICAqIHRoZXJlZm9yZSBiZSBhc3N1bWVkIHRvIGJlaGF2ZSBhcyBhIFByb21pc2UuXG4gICAgICAgKlxuICAgICAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gdGVzdC5cbiAgICAgICAqIEByZXR1cm5zIHtib29sZWFufSBUcnVlIGlmIHRoZSB2YWx1ZSBpcyB0aGVuYWJsZS5cbiAgICAgICAqL1xuXG5cbiAgICAgIGNvbnN0IGlzVGhlbmFibGUgPSB2YWx1ZSA9PiB7XG4gICAgICAgIHJldHVybiB2YWx1ZSAmJiB0eXBlb2YgdmFsdWUgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIHZhbHVlLnRoZW4gPT09IFwiZnVuY3Rpb25cIjtcbiAgICAgIH07XG4gICAgICAvKipcbiAgICAgICAqIENyZWF0ZXMgYW5kIHJldHVybnMgYSBmdW5jdGlvbiB3aGljaCwgd2hlbiBjYWxsZWQsIHdpbGwgcmVzb2x2ZSBvciByZWplY3RcbiAgICAgICAqIHRoZSBnaXZlbiBwcm9taXNlIGJhc2VkIG9uIGhvdyBpdCBpcyBjYWxsZWQ6XG4gICAgICAgKlxuICAgICAgICogLSBJZiwgd2hlbiBjYWxsZWQsIGBjaHJvbWUucnVudGltZS5sYXN0RXJyb3JgIGNvbnRhaW5zIGEgbm9uLW51bGwgb2JqZWN0LFxuICAgICAgICogICB0aGUgcHJvbWlzZSBpcyByZWplY3RlZCB3aXRoIHRoYXQgdmFsdWUuXG4gICAgICAgKiAtIElmIHRoZSBmdW5jdGlvbiBpcyBjYWxsZWQgd2l0aCBleGFjdGx5IG9uZSBhcmd1bWVudCwgdGhlIHByb21pc2UgaXNcbiAgICAgICAqICAgcmVzb2x2ZWQgdG8gdGhhdCB2YWx1ZS5cbiAgICAgICAqIC0gT3RoZXJ3aXNlLCB0aGUgcHJvbWlzZSBpcyByZXNvbHZlZCB0byBhbiBhcnJheSBjb250YWluaW5nIGFsbCBvZiB0aGVcbiAgICAgICAqICAgZnVuY3Rpb24ncyBhcmd1bWVudHMuXG4gICAgICAgKlxuICAgICAgICogQHBhcmFtIHtvYmplY3R9IHByb21pc2VcbiAgICAgICAqICAgICAgICBBbiBvYmplY3QgY29udGFpbmluZyB0aGUgcmVzb2x1dGlvbiBhbmQgcmVqZWN0aW9uIGZ1bmN0aW9ucyBvZiBhXG4gICAgICAgKiAgICAgICAgcHJvbWlzZS5cbiAgICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IHByb21pc2UucmVzb2x2ZVxuICAgICAgICogICAgICAgIFRoZSBwcm9taXNlJ3MgcmVzb2x1dGlvbiBmdW5jdGlvbi5cbiAgICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IHByb21pc2UucmVqZWN0aW9uXG4gICAgICAgKiAgICAgICAgVGhlIHByb21pc2UncyByZWplY3Rpb24gZnVuY3Rpb24uXG4gICAgICAgKiBAcGFyYW0ge29iamVjdH0gbWV0YWRhdGFcbiAgICAgICAqICAgICAgICBNZXRhZGF0YSBhYm91dCB0aGUgd3JhcHBlZCBtZXRob2Qgd2hpY2ggaGFzIGNyZWF0ZWQgdGhlIGNhbGxiYWNrLlxuICAgICAgICogQHBhcmFtIHtpbnRlZ2VyfSBtZXRhZGF0YS5tYXhSZXNvbHZlZEFyZ3NcbiAgICAgICAqICAgICAgICBUaGUgbWF4aW11bSBudW1iZXIgb2YgYXJndW1lbnRzIHdoaWNoIG1heSBiZSBwYXNzZWQgdG8gdGhlXG4gICAgICAgKiAgICAgICAgY2FsbGJhY2sgY3JlYXRlZCBieSB0aGUgd3JhcHBlZCBhc3luYyBmdW5jdGlvbi5cbiAgICAgICAqXG4gICAgICAgKiBAcmV0dXJucyB7ZnVuY3Rpb259XG4gICAgICAgKiAgICAgICAgVGhlIGdlbmVyYXRlZCBjYWxsYmFjayBmdW5jdGlvbi5cbiAgICAgICAqL1xuXG5cbiAgICAgIGNvbnN0IG1ha2VDYWxsYmFjayA9IChwcm9taXNlLCBtZXRhZGF0YSkgPT4ge1xuICAgICAgICByZXR1cm4gKC4uLmNhbGxiYWNrQXJncykgPT4ge1xuICAgICAgICAgIGlmIChleHRlbnNpb25BUElzLnJ1bnRpbWUubGFzdEVycm9yKSB7XG4gICAgICAgICAgICBwcm9taXNlLnJlamVjdChleHRlbnNpb25BUElzLnJ1bnRpbWUubGFzdEVycm9yKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKG1ldGFkYXRhLnNpbmdsZUNhbGxiYWNrQXJnIHx8IGNhbGxiYWNrQXJncy5sZW5ndGggPD0gMSAmJiBtZXRhZGF0YS5zaW5nbGVDYWxsYmFja0FyZyAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgIHByb21pc2UucmVzb2x2ZShjYWxsYmFja0FyZ3NbMF0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBwcm9taXNlLnJlc29sdmUoY2FsbGJhY2tBcmdzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9O1xuXG4gICAgICBjb25zdCBwbHVyYWxpemVBcmd1bWVudHMgPSBudW1BcmdzID0+IG51bUFyZ3MgPT0gMSA/IFwiYXJndW1lbnRcIiA6IFwiYXJndW1lbnRzXCI7XG4gICAgICAvKipcbiAgICAgICAqIENyZWF0ZXMgYSB3cmFwcGVyIGZ1bmN0aW9uIGZvciBhIG1ldGhvZCB3aXRoIHRoZSBnaXZlbiBuYW1lIGFuZCBtZXRhZGF0YS5cbiAgICAgICAqXG4gICAgICAgKiBAcGFyYW0ge3N0cmluZ30gbmFtZVxuICAgICAgICogICAgICAgIFRoZSBuYW1lIG9mIHRoZSBtZXRob2Qgd2hpY2ggaXMgYmVpbmcgd3JhcHBlZC5cbiAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSBtZXRhZGF0YVxuICAgICAgICogICAgICAgIE1ldGFkYXRhIGFib3V0IHRoZSBtZXRob2QgYmVpbmcgd3JhcHBlZC5cbiAgICAgICAqIEBwYXJhbSB7aW50ZWdlcn0gbWV0YWRhdGEubWluQXJnc1xuICAgICAgICogICAgICAgIFRoZSBtaW5pbXVtIG51bWJlciBvZiBhcmd1bWVudHMgd2hpY2ggbXVzdCBiZSBwYXNzZWQgdG8gdGhlXG4gICAgICAgKiAgICAgICAgZnVuY3Rpb24uIElmIGNhbGxlZCB3aXRoIGZld2VyIHRoYW4gdGhpcyBudW1iZXIgb2YgYXJndW1lbnRzLCB0aGVcbiAgICAgICAqICAgICAgICB3cmFwcGVyIHdpbGwgcmFpc2UgYW4gZXhjZXB0aW9uLlxuICAgICAgICogQHBhcmFtIHtpbnRlZ2VyfSBtZXRhZGF0YS5tYXhBcmdzXG4gICAgICAgKiAgICAgICAgVGhlIG1heGltdW0gbnVtYmVyIG9mIGFyZ3VtZW50cyB3aGljaCBtYXkgYmUgcGFzc2VkIHRvIHRoZVxuICAgICAgICogICAgICAgIGZ1bmN0aW9uLiBJZiBjYWxsZWQgd2l0aCBtb3JlIHRoYW4gdGhpcyBudW1iZXIgb2YgYXJndW1lbnRzLCB0aGVcbiAgICAgICAqICAgICAgICB3cmFwcGVyIHdpbGwgcmFpc2UgYW4gZXhjZXB0aW9uLlxuICAgICAgICogQHBhcmFtIHtpbnRlZ2VyfSBtZXRhZGF0YS5tYXhSZXNvbHZlZEFyZ3NcbiAgICAgICAqICAgICAgICBUaGUgbWF4aW11bSBudW1iZXIgb2YgYXJndW1lbnRzIHdoaWNoIG1heSBiZSBwYXNzZWQgdG8gdGhlXG4gICAgICAgKiAgICAgICAgY2FsbGJhY2sgY3JlYXRlZCBieSB0aGUgd3JhcHBlZCBhc3luYyBmdW5jdGlvbi5cbiAgICAgICAqXG4gICAgICAgKiBAcmV0dXJucyB7ZnVuY3Rpb24ob2JqZWN0LCAuLi4qKX1cbiAgICAgICAqICAgICAgIFRoZSBnZW5lcmF0ZWQgd3JhcHBlciBmdW5jdGlvbi5cbiAgICAgICAqL1xuXG5cbiAgICAgIGNvbnN0IHdyYXBBc3luY0Z1bmN0aW9uID0gKG5hbWUsIG1ldGFkYXRhKSA9PiB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBhc3luY0Z1bmN0aW9uV3JhcHBlcih0YXJnZXQsIC4uLmFyZ3MpIHtcbiAgICAgICAgICBpZiAoYXJncy5sZW5ndGggPCBtZXRhZGF0YS5taW5BcmdzKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEV4cGVjdGVkIGF0IGxlYXN0ICR7bWV0YWRhdGEubWluQXJnc30gJHtwbHVyYWxpemVBcmd1bWVudHMobWV0YWRhdGEubWluQXJncyl9IGZvciAke25hbWV9KCksIGdvdCAke2FyZ3MubGVuZ3RofWApO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChhcmdzLmxlbmd0aCA+IG1ldGFkYXRhLm1heEFyZ3MpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRXhwZWN0ZWQgYXQgbW9zdCAke21ldGFkYXRhLm1heEFyZ3N9ICR7cGx1cmFsaXplQXJndW1lbnRzKG1ldGFkYXRhLm1heEFyZ3MpfSBmb3IgJHtuYW1lfSgpLCBnb3QgJHthcmdzLmxlbmd0aH1gKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgaWYgKG1ldGFkYXRhLmZhbGxiYWNrVG9Ob0NhbGxiYWNrKSB7XG4gICAgICAgICAgICAgIC8vIFRoaXMgQVBJIG1ldGhvZCBoYXMgY3VycmVudGx5IG5vIGNhbGxiYWNrIG9uIENocm9tZSwgYnV0IGl0IHJldHVybiBhIHByb21pc2Ugb24gRmlyZWZveCxcbiAgICAgICAgICAgICAgLy8gYW5kIHNvIHRoZSBwb2x5ZmlsbCB3aWxsIHRyeSB0byBjYWxsIGl0IHdpdGggYSBjYWxsYmFjayBmaXJzdCwgYW5kIGl0IHdpbGwgZmFsbGJhY2tcbiAgICAgICAgICAgICAgLy8gdG8gbm90IHBhc3NpbmcgdGhlIGNhbGxiYWNrIGlmIHRoZSBmaXJzdCBjYWxsIGZhaWxzLlxuICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHRhcmdldFtuYW1lXSguLi5hcmdzLCBtYWtlQ2FsbGJhY2soe1xuICAgICAgICAgICAgICAgICAgcmVzb2x2ZSxcbiAgICAgICAgICAgICAgICAgIHJlamVjdFxuICAgICAgICAgICAgICAgIH0sIG1ldGFkYXRhKSk7XG4gICAgICAgICAgICAgIH0gY2F0Y2ggKGNiRXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYCR7bmFtZX0gQVBJIG1ldGhvZCBkb2Vzbid0IHNlZW0gdG8gc3VwcG9ydCB0aGUgY2FsbGJhY2sgcGFyYW1ldGVyLCBgICsgXCJmYWxsaW5nIGJhY2sgdG8gY2FsbCBpdCB3aXRob3V0IGEgY2FsbGJhY2s6IFwiLCBjYkVycm9yKTtcbiAgICAgICAgICAgICAgICB0YXJnZXRbbmFtZV0oLi4uYXJncyk7IC8vIFVwZGF0ZSB0aGUgQVBJIG1ldGhvZCBtZXRhZGF0YSwgc28gdGhhdCB0aGUgbmV4dCBBUEkgY2FsbHMgd2lsbCBub3QgdHJ5IHRvXG4gICAgICAgICAgICAgICAgLy8gdXNlIHRoZSB1bnN1cHBvcnRlZCBjYWxsYmFjayBhbnltb3JlLlxuXG4gICAgICAgICAgICAgICAgbWV0YWRhdGEuZmFsbGJhY2tUb05vQ2FsbGJhY2sgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBtZXRhZGF0YS5ub0NhbGxiYWNrID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAobWV0YWRhdGEubm9DYWxsYmFjaykge1xuICAgICAgICAgICAgICB0YXJnZXRbbmFtZV0oLi4uYXJncyk7XG4gICAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRhcmdldFtuYW1lXSguLi5hcmdzLCBtYWtlQ2FsbGJhY2soe1xuICAgICAgICAgICAgICAgIHJlc29sdmUsXG4gICAgICAgICAgICAgICAgcmVqZWN0XG4gICAgICAgICAgICAgIH0sIG1ldGFkYXRhKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgICAgLyoqXG4gICAgICAgKiBXcmFwcyBhbiBleGlzdGluZyBtZXRob2Qgb2YgdGhlIHRhcmdldCBvYmplY3QsIHNvIHRoYXQgY2FsbHMgdG8gaXQgYXJlXG4gICAgICAgKiBpbnRlcmNlcHRlZCBieSB0aGUgZ2l2ZW4gd3JhcHBlciBmdW5jdGlvbi4gVGhlIHdyYXBwZXIgZnVuY3Rpb24gcmVjZWl2ZXMsXG4gICAgICAgKiBhcyBpdHMgZmlyc3QgYXJndW1lbnQsIHRoZSBvcmlnaW5hbCBgdGFyZ2V0YCBvYmplY3QsIGZvbGxvd2VkIGJ5IGVhY2ggb2ZcbiAgICAgICAqIHRoZSBhcmd1bWVudHMgcGFzc2VkIHRvIHRoZSBvcmlnaW5hbCBtZXRob2QuXG4gICAgICAgKlxuICAgICAgICogQHBhcmFtIHtvYmplY3R9IHRhcmdldFxuICAgICAgICogICAgICAgIFRoZSBvcmlnaW5hbCB0YXJnZXQgb2JqZWN0IHRoYXQgdGhlIHdyYXBwZWQgbWV0aG9kIGJlbG9uZ3MgdG8uXG4gICAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBtZXRob2RcbiAgICAgICAqICAgICAgICBUaGUgbWV0aG9kIGJlaW5nIHdyYXBwZWQuIFRoaXMgaXMgdXNlZCBhcyB0aGUgdGFyZ2V0IG9mIHRoZSBQcm94eVxuICAgICAgICogICAgICAgIG9iamVjdCB3aGljaCBpcyBjcmVhdGVkIHRvIHdyYXAgdGhlIG1ldGhvZC5cbiAgICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IHdyYXBwZXJcbiAgICAgICAqICAgICAgICBUaGUgd3JhcHBlciBmdW5jdGlvbiB3aGljaCBpcyBjYWxsZWQgaW4gcGxhY2Ugb2YgYSBkaXJlY3QgaW52b2NhdGlvblxuICAgICAgICogICAgICAgIG9mIHRoZSB3cmFwcGVkIG1ldGhvZC5cbiAgICAgICAqXG4gICAgICAgKiBAcmV0dXJucyB7UHJveHk8ZnVuY3Rpb24+fVxuICAgICAgICogICAgICAgIEEgUHJveHkgb2JqZWN0IGZvciB0aGUgZ2l2ZW4gbWV0aG9kLCB3aGljaCBpbnZva2VzIHRoZSBnaXZlbiB3cmFwcGVyXG4gICAgICAgKiAgICAgICAgbWV0aG9kIGluIGl0cyBwbGFjZS5cbiAgICAgICAqL1xuXG5cbiAgICAgIGNvbnN0IHdyYXBNZXRob2QgPSAodGFyZ2V0LCBtZXRob2QsIHdyYXBwZXIpID0+IHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm94eShtZXRob2QsIHtcbiAgICAgICAgICBhcHBseSh0YXJnZXRNZXRob2QsIHRoaXNPYmosIGFyZ3MpIHtcbiAgICAgICAgICAgIHJldHVybiB3cmFwcGVyLmNhbGwodGhpc09iaiwgdGFyZ2V0LCAuLi5hcmdzKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgfSk7XG4gICAgICB9O1xuXG4gICAgICBsZXQgaGFzT3duUHJvcGVydHkgPSBGdW5jdGlvbi5jYWxsLmJpbmQoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSk7XG4gICAgICAvKipcbiAgICAgICAqIFdyYXBzIGFuIG9iamVjdCBpbiBhIFByb3h5IHdoaWNoIGludGVyY2VwdHMgYW5kIHdyYXBzIGNlcnRhaW4gbWV0aG9kc1xuICAgICAgICogYmFzZWQgb24gdGhlIGdpdmVuIGB3cmFwcGVyc2AgYW5kIGBtZXRhZGF0YWAgb2JqZWN0cy5cbiAgICAgICAqXG4gICAgICAgKiBAcGFyYW0ge29iamVjdH0gdGFyZ2V0XG4gICAgICAgKiAgICAgICAgVGhlIHRhcmdldCBvYmplY3QgdG8gd3JhcC5cbiAgICAgICAqXG4gICAgICAgKiBAcGFyYW0ge29iamVjdH0gW3dyYXBwZXJzID0ge31dXG4gICAgICAgKiAgICAgICAgQW4gb2JqZWN0IHRyZWUgY29udGFpbmluZyB3cmFwcGVyIGZ1bmN0aW9ucyBmb3Igc3BlY2lhbCBjYXNlcy4gQW55XG4gICAgICAgKiAgICAgICAgZnVuY3Rpb24gcHJlc2VudCBpbiB0aGlzIG9iamVjdCB0cmVlIGlzIGNhbGxlZCBpbiBwbGFjZSBvZiB0aGVcbiAgICAgICAqICAgICAgICBtZXRob2QgaW4gdGhlIHNhbWUgbG9jYXRpb24gaW4gdGhlIGB0YXJnZXRgIG9iamVjdCB0cmVlLiBUaGVzZVxuICAgICAgICogICAgICAgIHdyYXBwZXIgbWV0aG9kcyBhcmUgaW52b2tlZCBhcyBkZXNjcmliZWQgaW4ge0BzZWUgd3JhcE1ldGhvZH0uXG4gICAgICAgKlxuICAgICAgICogQHBhcmFtIHtvYmplY3R9IFttZXRhZGF0YSA9IHt9XVxuICAgICAgICogICAgICAgIEFuIG9iamVjdCB0cmVlIGNvbnRhaW5pbmcgbWV0YWRhdGEgdXNlZCB0byBhdXRvbWF0aWNhbGx5IGdlbmVyYXRlXG4gICAgICAgKiAgICAgICAgUHJvbWlzZS1iYXNlZCB3cmFwcGVyIGZ1bmN0aW9ucyBmb3IgYXN5bmNocm9ub3VzLiBBbnkgZnVuY3Rpb24gaW5cbiAgICAgICAqICAgICAgICB0aGUgYHRhcmdldGAgb2JqZWN0IHRyZWUgd2hpY2ggaGFzIGEgY29ycmVzcG9uZGluZyBtZXRhZGF0YSBvYmplY3RcbiAgICAgICAqICAgICAgICBpbiB0aGUgc2FtZSBsb2NhdGlvbiBpbiB0aGUgYG1ldGFkYXRhYCB0cmVlIGlzIHJlcGxhY2VkIHdpdGggYW5cbiAgICAgICAqICAgICAgICBhdXRvbWF0aWNhbGx5LWdlbmVyYXRlZCB3cmFwcGVyIGZ1bmN0aW9uLCBhcyBkZXNjcmliZWQgaW5cbiAgICAgICAqICAgICAgICB7QHNlZSB3cmFwQXN5bmNGdW5jdGlvbn1cbiAgICAgICAqXG4gICAgICAgKiBAcmV0dXJucyB7UHJveHk8b2JqZWN0Pn1cbiAgICAgICAqL1xuXG4gICAgICBjb25zdCB3cmFwT2JqZWN0ID0gKHRhcmdldCwgd3JhcHBlcnMgPSB7fSwgbWV0YWRhdGEgPSB7fSkgPT4ge1xuICAgICAgICBsZXQgY2FjaGUgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuICAgICAgICBsZXQgaGFuZGxlcnMgPSB7XG4gICAgICAgICAgaGFzKHByb3h5VGFyZ2V0LCBwcm9wKSB7XG4gICAgICAgICAgICByZXR1cm4gcHJvcCBpbiB0YXJnZXQgfHwgcHJvcCBpbiBjYWNoZTtcbiAgICAgICAgICB9LFxuXG4gICAgICAgICAgZ2V0KHByb3h5VGFyZ2V0LCBwcm9wLCByZWNlaXZlcikge1xuICAgICAgICAgICAgaWYgKHByb3AgaW4gY2FjaGUpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGNhY2hlW3Byb3BdO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIShwcm9wIGluIHRhcmdldCkpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbGV0IHZhbHVlID0gdGFyZ2V0W3Byb3BdO1xuXG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgICAgLy8gVGhpcyBpcyBhIG1ldGhvZCBvbiB0aGUgdW5kZXJseWluZyBvYmplY3QuIENoZWNrIGlmIHdlIG5lZWQgdG8gZG9cbiAgICAgICAgICAgICAgLy8gYW55IHdyYXBwaW5nLlxuICAgICAgICAgICAgICBpZiAodHlwZW9mIHdyYXBwZXJzW3Byb3BdID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgICAgICAvLyBXZSBoYXZlIGEgc3BlY2lhbC1jYXNlIHdyYXBwZXIgZm9yIHRoaXMgbWV0aG9kLlxuICAgICAgICAgICAgICAgIHZhbHVlID0gd3JhcE1ldGhvZCh0YXJnZXQsIHRhcmdldFtwcm9wXSwgd3JhcHBlcnNbcHJvcF0pO1xuICAgICAgICAgICAgICB9IGVsc2UgaWYgKGhhc093blByb3BlcnR5KG1ldGFkYXRhLCBwcm9wKSkge1xuICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgYW4gYXN5bmMgbWV0aG9kIHRoYXQgd2UgaGF2ZSBtZXRhZGF0YSBmb3IuIENyZWF0ZSBhXG4gICAgICAgICAgICAgICAgLy8gUHJvbWlzZSB3cmFwcGVyIGZvciBpdC5cbiAgICAgICAgICAgICAgICBsZXQgd3JhcHBlciA9IHdyYXBBc3luY0Z1bmN0aW9uKHByb3AsIG1ldGFkYXRhW3Byb3BdKTtcbiAgICAgICAgICAgICAgICB2YWx1ZSA9IHdyYXBNZXRob2QodGFyZ2V0LCB0YXJnZXRbcHJvcF0sIHdyYXBwZXIpO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgYSBtZXRob2QgdGhhdCB3ZSBkb24ndCBrbm93IG9yIGNhcmUgYWJvdXQuIFJldHVybiB0aGVcbiAgICAgICAgICAgICAgICAvLyBvcmlnaW5hbCBtZXRob2QsIGJvdW5kIHRvIHRoZSB1bmRlcmx5aW5nIG9iamVjdC5cbiAgICAgICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLmJpbmQodGFyZ2V0KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09IFwib2JqZWN0XCIgJiYgdmFsdWUgIT09IG51bGwgJiYgKGhhc093blByb3BlcnR5KHdyYXBwZXJzLCBwcm9wKSB8fCBoYXNPd25Qcm9wZXJ0eShtZXRhZGF0YSwgcHJvcCkpKSB7XG4gICAgICAgICAgICAgIC8vIFRoaXMgaXMgYW4gb2JqZWN0IHRoYXQgd2UgbmVlZCB0byBkbyBzb21lIHdyYXBwaW5nIGZvciB0aGUgY2hpbGRyZW5cbiAgICAgICAgICAgICAgLy8gb2YuIENyZWF0ZSBhIHN1Yi1vYmplY3Qgd3JhcHBlciBmb3IgaXQgd2l0aCB0aGUgYXBwcm9wcmlhdGUgY2hpbGRcbiAgICAgICAgICAgICAgLy8gbWV0YWRhdGEuXG4gICAgICAgICAgICAgIHZhbHVlID0gd3JhcE9iamVjdCh2YWx1ZSwgd3JhcHBlcnNbcHJvcF0sIG1ldGFkYXRhW3Byb3BdKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaGFzT3duUHJvcGVydHkobWV0YWRhdGEsIFwiKlwiKSkge1xuICAgICAgICAgICAgICAvLyBXcmFwIGFsbCBwcm9wZXJ0aWVzIGluICogbmFtZXNwYWNlLlxuICAgICAgICAgICAgICB2YWx1ZSA9IHdyYXBPYmplY3QodmFsdWUsIHdyYXBwZXJzW3Byb3BdLCBtZXRhZGF0YVtcIipcIl0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgLy8gV2UgZG9uJ3QgbmVlZCB0byBkbyBhbnkgd3JhcHBpbmcgZm9yIHRoaXMgcHJvcGVydHksXG4gICAgICAgICAgICAgIC8vIHNvIGp1c3QgZm9yd2FyZCBhbGwgYWNjZXNzIHRvIHRoZSB1bmRlcmx5aW5nIG9iamVjdC5cbiAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGNhY2hlLCBwcm9wLCB7XG4gICAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG5cbiAgICAgICAgICAgICAgICBnZXQoKSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gdGFyZ2V0W3Byb3BdO1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBzZXQodmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgIHRhcmdldFtwcm9wXSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjYWNoZVtwcm9wXSA9IHZhbHVlO1xuICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICAgIH0sXG5cbiAgICAgICAgICBzZXQocHJveHlUYXJnZXQsIHByb3AsIHZhbHVlLCByZWNlaXZlcikge1xuICAgICAgICAgICAgaWYgKHByb3AgaW4gY2FjaGUpIHtcbiAgICAgICAgICAgICAgY2FjaGVbcHJvcF0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRhcmdldFtwcm9wXSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICB9LFxuXG4gICAgICAgICAgZGVmaW5lUHJvcGVydHkocHJveHlUYXJnZXQsIHByb3AsIGRlc2MpIHtcbiAgICAgICAgICAgIHJldHVybiBSZWZsZWN0LmRlZmluZVByb3BlcnR5KGNhY2hlLCBwcm9wLCBkZXNjKTtcbiAgICAgICAgICB9LFxuXG4gICAgICAgICAgZGVsZXRlUHJvcGVydHkocHJveHlUYXJnZXQsIHByb3ApIHtcbiAgICAgICAgICAgIHJldHVybiBSZWZsZWN0LmRlbGV0ZVByb3BlcnR5KGNhY2hlLCBwcm9wKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgfTsgLy8gUGVyIGNvbnRyYWN0IG9mIHRoZSBQcm94eSBBUEksIHRoZSBcImdldFwiIHByb3h5IGhhbmRsZXIgbXVzdCByZXR1cm4gdGhlXG4gICAgICAgIC8vIG9yaWdpbmFsIHZhbHVlIG9mIHRoZSB0YXJnZXQgaWYgdGhhdCB2YWx1ZSBpcyBkZWNsYXJlZCByZWFkLW9ubHkgYW5kXG4gICAgICAgIC8vIG5vbi1jb25maWd1cmFibGUuIEZvciB0aGlzIHJlYXNvbiwgd2UgY3JlYXRlIGFuIG9iamVjdCB3aXRoIHRoZVxuICAgICAgICAvLyBwcm90b3R5cGUgc2V0IHRvIGB0YXJnZXRgIGluc3RlYWQgb2YgdXNpbmcgYHRhcmdldGAgZGlyZWN0bHkuXG4gICAgICAgIC8vIE90aGVyd2lzZSB3ZSBjYW5ub3QgcmV0dXJuIGEgY3VzdG9tIG9iamVjdCBmb3IgQVBJcyB0aGF0XG4gICAgICAgIC8vIGFyZSBkZWNsYXJlZCByZWFkLW9ubHkgYW5kIG5vbi1jb25maWd1cmFibGUsIHN1Y2ggYXMgYGNocm9tZS5kZXZ0b29sc2AuXG4gICAgICAgIC8vXG4gICAgICAgIC8vIFRoZSBwcm94eSBoYW5kbGVycyB0aGVtc2VsdmVzIHdpbGwgc3RpbGwgdXNlIHRoZSBvcmlnaW5hbCBgdGFyZ2V0YFxuICAgICAgICAvLyBpbnN0ZWFkIG9mIHRoZSBgcHJveHlUYXJnZXRgLCBzbyB0aGF0IHRoZSBtZXRob2RzIGFuZCBwcm9wZXJ0aWVzIGFyZVxuICAgICAgICAvLyBkZXJlZmVyZW5jZWQgdmlhIHRoZSBvcmlnaW5hbCB0YXJnZXRzLlxuXG4gICAgICAgIGxldCBwcm94eVRhcmdldCA9IE9iamVjdC5jcmVhdGUodGFyZ2V0KTtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm94eShwcm94eVRhcmdldCwgaGFuZGxlcnMpO1xuICAgICAgfTtcbiAgICAgIC8qKlxuICAgICAgICogQ3JlYXRlcyBhIHNldCBvZiB3cmFwcGVyIGZ1bmN0aW9ucyBmb3IgYW4gZXZlbnQgb2JqZWN0LCB3aGljaCBoYW5kbGVzXG4gICAgICAgKiB3cmFwcGluZyBvZiBsaXN0ZW5lciBmdW5jdGlvbnMgdGhhdCB0aG9zZSBtZXNzYWdlcyBhcmUgcGFzc2VkLlxuICAgICAgICpcbiAgICAgICAqIEEgc2luZ2xlIHdyYXBwZXIgaXMgY3JlYXRlZCBmb3IgZWFjaCBsaXN0ZW5lciBmdW5jdGlvbiwgYW5kIHN0b3JlZCBpbiBhXG4gICAgICAgKiBtYXAuIFN1YnNlcXVlbnQgY2FsbHMgdG8gYGFkZExpc3RlbmVyYCwgYGhhc0xpc3RlbmVyYCwgb3IgYHJlbW92ZUxpc3RlbmVyYFxuICAgICAgICogcmV0cmlldmUgdGhlIG9yaWdpbmFsIHdyYXBwZXIsIHNvIHRoYXQgIGF0dGVtcHRzIHRvIHJlbW92ZSBhXG4gICAgICAgKiBwcmV2aW91c2x5LWFkZGVkIGxpc3RlbmVyIHdvcmsgYXMgZXhwZWN0ZWQuXG4gICAgICAgKlxuICAgICAgICogQHBhcmFtIHtEZWZhdWx0V2Vha01hcDxmdW5jdGlvbiwgZnVuY3Rpb24+fSB3cmFwcGVyTWFwXG4gICAgICAgKiAgICAgICAgQSBEZWZhdWx0V2Vha01hcCBvYmplY3Qgd2hpY2ggd2lsbCBjcmVhdGUgdGhlIGFwcHJvcHJpYXRlIHdyYXBwZXJcbiAgICAgICAqICAgICAgICBmb3IgYSBnaXZlbiBsaXN0ZW5lciBmdW5jdGlvbiB3aGVuIG9uZSBkb2VzIG5vdCBleGlzdCwgYW5kIHJldHJpZXZlXG4gICAgICAgKiAgICAgICAgYW4gZXhpc3Rpbmcgb25lIHdoZW4gaXQgZG9lcy5cbiAgICAgICAqXG4gICAgICAgKiBAcmV0dXJucyB7b2JqZWN0fVxuICAgICAgICovXG5cblxuICAgICAgY29uc3Qgd3JhcEV2ZW50ID0gd3JhcHBlck1hcCA9PiAoe1xuICAgICAgICBhZGRMaXN0ZW5lcih0YXJnZXQsIGxpc3RlbmVyLCAuLi5hcmdzKSB7XG4gICAgICAgICAgdGFyZ2V0LmFkZExpc3RlbmVyKHdyYXBwZXJNYXAuZ2V0KGxpc3RlbmVyKSwgLi4uYXJncyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaGFzTGlzdGVuZXIodGFyZ2V0LCBsaXN0ZW5lcikge1xuICAgICAgICAgIHJldHVybiB0YXJnZXQuaGFzTGlzdGVuZXIod3JhcHBlck1hcC5nZXQobGlzdGVuZXIpKTtcbiAgICAgICAgfSxcblxuICAgICAgICByZW1vdmVMaXN0ZW5lcih0YXJnZXQsIGxpc3RlbmVyKSB7XG4gICAgICAgICAgdGFyZ2V0LnJlbW92ZUxpc3RlbmVyKHdyYXBwZXJNYXAuZ2V0KGxpc3RlbmVyKSk7XG4gICAgICAgIH1cblxuICAgICAgfSk7IC8vIEtlZXAgdHJhY2sgaWYgdGhlIGRlcHJlY2F0aW9uIHdhcm5pbmcgaGFzIGJlZW4gbG9nZ2VkIGF0IGxlYXN0IG9uY2UuXG5cblxuICAgICAgbGV0IGxvZ2dlZFNlbmRSZXNwb25zZURlcHJlY2F0aW9uV2FybmluZyA9IGZhbHNlO1xuICAgICAgY29uc3Qgb25NZXNzYWdlV3JhcHBlcnMgPSBuZXcgRGVmYXVsdFdlYWtNYXAobGlzdGVuZXIgPT4ge1xuICAgICAgICBpZiAodHlwZW9mIGxpc3RlbmVyICE9PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICByZXR1cm4gbGlzdGVuZXI7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdyYXBzIGEgbWVzc2FnZSBsaXN0ZW5lciBmdW5jdGlvbiBzbyB0aGF0IGl0IG1heSBzZW5kIHJlc3BvbnNlcyBiYXNlZCBvblxuICAgICAgICAgKiBpdHMgcmV0dXJuIHZhbHVlLCByYXRoZXIgdGhhbiBieSByZXR1cm5pbmcgYSBzZW50aW5lbCB2YWx1ZSBhbmQgY2FsbGluZyBhXG4gICAgICAgICAqIGNhbGxiYWNrLiBJZiB0aGUgbGlzdGVuZXIgZnVuY3Rpb24gcmV0dXJucyBhIFByb21pc2UsIHRoZSByZXNwb25zZSBpc1xuICAgICAgICAgKiBzZW50IHdoZW4gdGhlIHByb21pc2UgZWl0aGVyIHJlc29sdmVzIG9yIHJlamVjdHMuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSB7Kn0gbWVzc2FnZVxuICAgICAgICAgKiAgICAgICAgVGhlIG1lc3NhZ2Ugc2VudCBieSB0aGUgb3RoZXIgZW5kIG9mIHRoZSBjaGFubmVsLlxuICAgICAgICAgKiBAcGFyYW0ge29iamVjdH0gc2VuZGVyXG4gICAgICAgICAqICAgICAgICBEZXRhaWxzIGFib3V0IHRoZSBzZW5kZXIgb2YgdGhlIG1lc3NhZ2UuXG4gICAgICAgICAqIEBwYXJhbSB7ZnVuY3Rpb24oKil9IHNlbmRSZXNwb25zZVxuICAgICAgICAgKiAgICAgICAgQSBjYWxsYmFjayB3aGljaCwgd2hlbiBjYWxsZWQgd2l0aCBhbiBhcmJpdHJhcnkgYXJndW1lbnQsIHNlbmRzXG4gICAgICAgICAqICAgICAgICB0aGF0IHZhbHVlIGFzIGEgcmVzcG9uc2UuXG4gICAgICAgICAqIEByZXR1cm5zIHtib29sZWFufVxuICAgICAgICAgKiAgICAgICAgVHJ1ZSBpZiB0aGUgd3JhcHBlZCBsaXN0ZW5lciByZXR1cm5lZCBhIFByb21pc2UsIHdoaWNoIHdpbGwgbGF0ZXJcbiAgICAgICAgICogICAgICAgIHlpZWxkIGEgcmVzcG9uc2UuIEZhbHNlIG90aGVyd2lzZS5cbiAgICAgICAgICovXG5cblxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gb25NZXNzYWdlKG1lc3NhZ2UsIHNlbmRlciwgc2VuZFJlc3BvbnNlKSB7XG4gICAgICAgICAgbGV0IGRpZENhbGxTZW5kUmVzcG9uc2UgPSBmYWxzZTtcbiAgICAgICAgICBsZXQgd3JhcHBlZFNlbmRSZXNwb25zZTtcbiAgICAgICAgICBsZXQgc2VuZFJlc3BvbnNlUHJvbWlzZSA9IG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgICAgICAgICAgd3JhcHBlZFNlbmRSZXNwb25zZSA9IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICBpZiAoIWxvZ2dlZFNlbmRSZXNwb25zZURlcHJlY2F0aW9uV2FybmluZykge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihTRU5EX1JFU1BPTlNFX0RFUFJFQ0FUSU9OX1dBUk5JTkcsIG5ldyBFcnJvcigpLnN0YWNrKTtcbiAgICAgICAgICAgICAgICBsb2dnZWRTZW5kUmVzcG9uc2VEZXByZWNhdGlvbldhcm5pbmcgPSB0cnVlO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgZGlkQ2FsbFNlbmRSZXNwb25zZSA9IHRydWU7XG4gICAgICAgICAgICAgIHJlc29sdmUocmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBsZXQgcmVzdWx0O1xuXG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJlc3VsdCA9IGxpc3RlbmVyKG1lc3NhZ2UsIHNlbmRlciwgd3JhcHBlZFNlbmRSZXNwb25zZSk7XG4gICAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICByZXN1bHQgPSBQcm9taXNlLnJlamVjdChlcnIpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnN0IGlzUmVzdWx0VGhlbmFibGUgPSByZXN1bHQgIT09IHRydWUgJiYgaXNUaGVuYWJsZShyZXN1bHQpOyAvLyBJZiB0aGUgbGlzdGVuZXIgZGlkbid0IHJldHVybmVkIHRydWUgb3IgYSBQcm9taXNlLCBvciBjYWxsZWRcbiAgICAgICAgICAvLyB3cmFwcGVkU2VuZFJlc3BvbnNlIHN5bmNocm9ub3VzbHksIHdlIGNhbiBleGl0IGVhcmxpZXJcbiAgICAgICAgICAvLyBiZWNhdXNlIHRoZXJlIHdpbGwgYmUgbm8gcmVzcG9uc2Ugc2VudCBmcm9tIHRoaXMgbGlzdGVuZXIuXG5cbiAgICAgICAgICBpZiAocmVzdWx0ICE9PSB0cnVlICYmICFpc1Jlc3VsdFRoZW5hYmxlICYmICFkaWRDYWxsU2VuZFJlc3BvbnNlKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfSAvLyBBIHNtYWxsIGhlbHBlciB0byBzZW5kIHRoZSBtZXNzYWdlIGlmIHRoZSBwcm9taXNlIHJlc29sdmVzXG4gICAgICAgICAgLy8gYW5kIGFuIGVycm9yIGlmIHRoZSBwcm9taXNlIHJlamVjdHMgKGEgd3JhcHBlZCBzZW5kTWVzc2FnZSBoYXNcbiAgICAgICAgICAvLyB0byB0cmFuc2xhdGUgdGhlIG1lc3NhZ2UgaW50byBhIHJlc29sdmVkIHByb21pc2Ugb3IgYSByZWplY3RlZFxuICAgICAgICAgIC8vIHByb21pc2UpLlxuXG5cbiAgICAgICAgICBjb25zdCBzZW5kUHJvbWlzZWRSZXN1bHQgPSBwcm9taXNlID0+IHtcbiAgICAgICAgICAgIHByb21pc2UudGhlbihtc2cgPT4ge1xuICAgICAgICAgICAgICAvLyBzZW5kIHRoZSBtZXNzYWdlIHZhbHVlLlxuICAgICAgICAgICAgICBzZW5kUmVzcG9uc2UobXNnKTtcbiAgICAgICAgICAgIH0sIGVycm9yID0+IHtcbiAgICAgICAgICAgICAgLy8gU2VuZCBhIEpTT04gcmVwcmVzZW50YXRpb24gb2YgdGhlIGVycm9yIGlmIHRoZSByZWplY3RlZCB2YWx1ZVxuICAgICAgICAgICAgICAvLyBpcyBhbiBpbnN0YW5jZSBvZiBlcnJvciwgb3IgdGhlIG9iamVjdCBpdHNlbGYgb3RoZXJ3aXNlLlxuICAgICAgICAgICAgICBsZXQgbWVzc2FnZTtcblxuICAgICAgICAgICAgICBpZiAoZXJyb3IgJiYgKGVycm9yIGluc3RhbmNlb2YgRXJyb3IgfHwgdHlwZW9mIGVycm9yLm1lc3NhZ2UgPT09IFwic3RyaW5nXCIpKSB7XG4gICAgICAgICAgICAgICAgbWVzc2FnZSA9IGVycm9yLm1lc3NhZ2U7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbWVzc2FnZSA9IFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZFwiO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgc2VuZFJlc3BvbnNlKHtcbiAgICAgICAgICAgICAgICBfX21veldlYkV4dGVuc2lvblBvbHlmaWxsUmVqZWN0X186IHRydWUsXG4gICAgICAgICAgICAgICAgbWVzc2FnZVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pLmNhdGNoKGVyciA9PiB7XG4gICAgICAgICAgICAgIC8vIFByaW50IGFuIGVycm9yIG9uIHRoZSBjb25zb2xlIGlmIHVuYWJsZSB0byBzZW5kIHRoZSByZXNwb25zZS5cbiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBzZW5kIG9uTWVzc2FnZSByZWplY3RlZCByZXBseVwiLCBlcnIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfTsgLy8gSWYgdGhlIGxpc3RlbmVyIHJldHVybmVkIGEgUHJvbWlzZSwgc2VuZCB0aGUgcmVzb2x2ZWQgdmFsdWUgYXMgYVxuICAgICAgICAgIC8vIHJlc3VsdCwgb3RoZXJ3aXNlIHdhaXQgdGhlIHByb21pc2UgcmVsYXRlZCB0byB0aGUgd3JhcHBlZFNlbmRSZXNwb25zZVxuICAgICAgICAgIC8vIGNhbGxiYWNrIHRvIHJlc29sdmUgYW5kIHNlbmQgaXQgYXMgYSByZXNwb25zZS5cblxuXG4gICAgICAgICAgaWYgKGlzUmVzdWx0VGhlbmFibGUpIHtcbiAgICAgICAgICAgIHNlbmRQcm9taXNlZFJlc3VsdChyZXN1bHQpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzZW5kUHJvbWlzZWRSZXN1bHQoc2VuZFJlc3BvbnNlUHJvbWlzZSk7XG4gICAgICAgICAgfSAvLyBMZXQgQ2hyb21lIGtub3cgdGhhdCB0aGUgbGlzdGVuZXIgaXMgcmVwbHlpbmcuXG5cblxuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9O1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHdyYXBwZWRTZW5kTWVzc2FnZUNhbGxiYWNrID0gKHtcbiAgICAgICAgcmVqZWN0LFxuICAgICAgICByZXNvbHZlXG4gICAgICB9LCByZXBseSkgPT4ge1xuICAgICAgICBpZiAoZXh0ZW5zaW9uQVBJcy5ydW50aW1lLmxhc3RFcnJvcikge1xuICAgICAgICAgIC8vIERldGVjdCB3aGVuIG5vbmUgb2YgdGhlIGxpc3RlbmVycyByZXBsaWVkIHRvIHRoZSBzZW5kTWVzc2FnZSBjYWxsIGFuZCByZXNvbHZlXG4gICAgICAgICAgLy8gdGhlIHByb21pc2UgdG8gdW5kZWZpbmVkIGFzIGluIEZpcmVmb3guXG4gICAgICAgICAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9tb3ppbGxhL3dlYmV4dGVuc2lvbi1wb2x5ZmlsbC9pc3N1ZXMvMTMwXG4gICAgICAgICAgaWYgKGV4dGVuc2lvbkFQSXMucnVudGltZS5sYXN0RXJyb3IubWVzc2FnZSA9PT0gQ0hST01FX1NFTkRfTUVTU0FHRV9DQUxMQkFDS19OT19SRVNQT05TRV9NRVNTQUdFKSB7XG4gICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlamVjdChleHRlbnNpb25BUElzLnJ1bnRpbWUubGFzdEVycm9yKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAocmVwbHkgJiYgcmVwbHkuX19tb3pXZWJFeHRlbnNpb25Qb2x5ZmlsbFJlamVjdF9fKSB7XG4gICAgICAgICAgLy8gQ29udmVydCBiYWNrIHRoZSBKU09OIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBlcnJvciBpbnRvXG4gICAgICAgICAgLy8gYW4gRXJyb3IgaW5zdGFuY2UuXG4gICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcihyZXBseS5tZXNzYWdlKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzb2x2ZShyZXBseSk7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHdyYXBwZWRTZW5kTWVzc2FnZSA9IChuYW1lLCBtZXRhZGF0YSwgYXBpTmFtZXNwYWNlT2JqLCAuLi5hcmdzKSA9PiB7XG4gICAgICAgIGlmIChhcmdzLmxlbmd0aCA8IG1ldGFkYXRhLm1pbkFyZ3MpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEV4cGVjdGVkIGF0IGxlYXN0ICR7bWV0YWRhdGEubWluQXJnc30gJHtwbHVyYWxpemVBcmd1bWVudHMobWV0YWRhdGEubWluQXJncyl9IGZvciAke25hbWV9KCksIGdvdCAke2FyZ3MubGVuZ3RofWApO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGFyZ3MubGVuZ3RoID4gbWV0YWRhdGEubWF4QXJncykge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRXhwZWN0ZWQgYXQgbW9zdCAke21ldGFkYXRhLm1heEFyZ3N9ICR7cGx1cmFsaXplQXJndW1lbnRzKG1ldGFkYXRhLm1heEFyZ3MpfSBmb3IgJHtuYW1lfSgpLCBnb3QgJHthcmdzLmxlbmd0aH1gKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgY29uc3Qgd3JhcHBlZENiID0gd3JhcHBlZFNlbmRNZXNzYWdlQ2FsbGJhY2suYmluZChudWxsLCB7XG4gICAgICAgICAgICByZXNvbHZlLFxuICAgICAgICAgICAgcmVqZWN0XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgYXJncy5wdXNoKHdyYXBwZWRDYik7XG4gICAgICAgICAgYXBpTmFtZXNwYWNlT2JqLnNlbmRNZXNzYWdlKC4uLmFyZ3MpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHN0YXRpY1dyYXBwZXJzID0ge1xuICAgICAgICBydW50aW1lOiB7XG4gICAgICAgICAgb25NZXNzYWdlOiB3cmFwRXZlbnQob25NZXNzYWdlV3JhcHBlcnMpLFxuICAgICAgICAgIG9uTWVzc2FnZUV4dGVybmFsOiB3cmFwRXZlbnQob25NZXNzYWdlV3JhcHBlcnMpLFxuICAgICAgICAgIHNlbmRNZXNzYWdlOiB3cmFwcGVkU2VuZE1lc3NhZ2UuYmluZChudWxsLCBcInNlbmRNZXNzYWdlXCIsIHtcbiAgICAgICAgICAgIG1pbkFyZ3M6IDEsXG4gICAgICAgICAgICBtYXhBcmdzOiAzXG4gICAgICAgICAgfSlcbiAgICAgICAgfSxcbiAgICAgICAgdGFiczoge1xuICAgICAgICAgIHNlbmRNZXNzYWdlOiB3cmFwcGVkU2VuZE1lc3NhZ2UuYmluZChudWxsLCBcInNlbmRNZXNzYWdlXCIsIHtcbiAgICAgICAgICAgIG1pbkFyZ3M6IDIsXG4gICAgICAgICAgICBtYXhBcmdzOiAzXG4gICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIGNvbnN0IHNldHRpbmdNZXRhZGF0YSA9IHtcbiAgICAgICAgY2xlYXI6IHtcbiAgICAgICAgICBtaW5BcmdzOiAxLFxuICAgICAgICAgIG1heEFyZ3M6IDFcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0OiB7XG4gICAgICAgICAgbWluQXJnczogMSxcbiAgICAgICAgICBtYXhBcmdzOiAxXG4gICAgICAgIH0sXG4gICAgICAgIHNldDoge1xuICAgICAgICAgIG1pbkFyZ3M6IDEsXG4gICAgICAgICAgbWF4QXJnczogMVxuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgYXBpTWV0YWRhdGEucHJpdmFjeSA9IHtcbiAgICAgICAgbmV0d29yazoge1xuICAgICAgICAgIFwiKlwiOiBzZXR0aW5nTWV0YWRhdGFcbiAgICAgICAgfSxcbiAgICAgICAgc2VydmljZXM6IHtcbiAgICAgICAgICBcIipcIjogc2V0dGluZ01ldGFkYXRhXG4gICAgICAgIH0sXG4gICAgICAgIHdlYnNpdGVzOiB7XG4gICAgICAgICAgXCIqXCI6IHNldHRpbmdNZXRhZGF0YVxuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHdyYXBPYmplY3QoZXh0ZW5zaW9uQVBJcywgc3RhdGljV3JhcHBlcnMsIGFwaU1ldGFkYXRhKTtcbiAgICB9O1xuXG4gICAgaWYgKHR5cGVvZiBjaHJvbWUgIT0gXCJvYmplY3RcIiB8fCAhY2hyb21lIHx8ICFjaHJvbWUucnVudGltZSB8fCAhY2hyb21lLnJ1bnRpbWUuaWQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlRoaXMgc2NyaXB0IHNob3VsZCBvbmx5IGJlIGxvYWRlZCBpbiBhIGJyb3dzZXIgZXh0ZW5zaW9uLlwiKTtcbiAgICB9IC8vIFRoZSBidWlsZCBwcm9jZXNzIGFkZHMgYSBVTUQgd3JhcHBlciBhcm91bmQgdGhpcyBmaWxlLCB3aGljaCBtYWtlcyB0aGVcbiAgICAvLyBgbW9kdWxlYCB2YXJpYWJsZSBhdmFpbGFibGUuXG5cblxuICAgIG1vZHVsZS5leHBvcnRzID0gd3JhcEFQSXMoY2hyb21lKTtcbiAgfSBlbHNlIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IGJyb3dzZXI7XG4gIH1cbn0pO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YnJvd3Nlci1wb2x5ZmlsbC5qcy5tYXBcbiIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4iLCIvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuX193ZWJwYWNrX3JlcXVpcmVfXy5uID0gKG1vZHVsZSkgPT4ge1xuXHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cblx0XHQoKSA9PiAobW9kdWxlWydkZWZhdWx0J10pIDpcblx0XHQoKSA9PiAobW9kdWxlKTtcblx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgeyBhOiBnZXR0ZXIgfSk7XG5cdHJldHVybiBnZXR0ZXI7XG59OyIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18ubyA9IChvYmosIHByb3ApID0+IChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKSkiLCIvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSAoZXhwb3J0cykgPT4ge1xuXHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcblx0fVxuXHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xufTsiLCJpbXBvcnQgeyBjb250ZW50IH0gZnJvbSAnLi4vLi4vcGFnZXMvY29udGVudCc7XG5cbmNvbnRlbnQuaW5pdCgpO1xuIl0sInNvdXJjZVJvb3QiOiIifQ==
=======
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9hZHZhbmNlZC1hZGJsb2NrZXItd2ViLWV4dGVuc2lvbi8uL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yLmpzIiwid2VicGFjazovL2FkdmFuY2VkLWFkYmxvY2tlci13ZWItZXh0ZW5zaW9uLy4vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL3JlZ2VuZXJhdG9yL2luZGV4LmpzIiwid2VicGFjazovL2FkdmFuY2VkLWFkYmxvY2tlci13ZWItZXh0ZW5zaW9uLy4vc3JjL3BhZ2VzL2NvbW1vbi9jb25zdGFudHMudHMiLCJ3ZWJwYWNrOi8vYWR2YW5jZWQtYWRibG9ja2VyLXdlYi1leHRlbnNpb24vLi9zcmMvcGFnZXMvY29udGVudC9jb250ZW50LnRzIiwid2VicGFjazovL2FkdmFuY2VkLWFkYmxvY2tlci13ZWItZXh0ZW5zaW9uLy4vbm9kZV9tb2R1bGVzL2V4dGVuZGVkLWNzcy9kaXN0L2V4dGVuZGVkLWNzcy5lc20uanMiLCJ3ZWJwYWNrOi8vYWR2YW5jZWQtYWRibG9ja2VyLXdlYi1leHRlbnNpb24vLi9ub2RlX21vZHVsZXMvcmVnZW5lcmF0b3ItcnVudGltZS9ydW50aW1lLmpzIiwid2VicGFjazovL2FkdmFuY2VkLWFkYmxvY2tlci13ZWItZXh0ZW5zaW9uLy4vbm9kZV9tb2R1bGVzL3NjcmlwdGxldHMvZGlzdC9janMvc2NyaXB0bGV0cy5janMuanMiLCJ3ZWJwYWNrOi8vYWR2YW5jZWQtYWRibG9ja2VyLXdlYi1leHRlbnNpb24vLi9ub2RlX21vZHVsZXMvd2ViZXh0ZW5zaW9uLXBvbHlmaWxsLXRzL2xpYi9pbmRleC5qcyIsIndlYnBhY2s6Ly9hZHZhbmNlZC1hZGJsb2NrZXItd2ViLWV4dGVuc2lvbi8uL25vZGVfbW9kdWxlcy93ZWJleHRlbnNpb24tcG9seWZpbGwvZGlzdC9icm93c2VyLXBvbHlmaWxsLmpzIiwid2VicGFjazovL2FkdmFuY2VkLWFkYmxvY2tlci13ZWItZXh0ZW5zaW9uL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL2FkdmFuY2VkLWFkYmxvY2tlci13ZWItZXh0ZW5zaW9uL3dlYnBhY2svcnVudGltZS9jb21wYXQgZ2V0IGRlZmF1bHQgZXhwb3J0Iiwid2VicGFjazovL2FkdmFuY2VkLWFkYmxvY2tlci13ZWItZXh0ZW5zaW9uL3dlYnBhY2svcnVudGltZS9kZWZpbmUgcHJvcGVydHkgZ2V0dGVycyIsIndlYnBhY2s6Ly9hZHZhbmNlZC1hZGJsb2NrZXItd2ViLWV4dGVuc2lvbi93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIiwid2VicGFjazovL2FkdmFuY2VkLWFkYmxvY2tlci13ZWItZXh0ZW5zaW9uL3dlYnBhY2svcnVudGltZS9tYWtlIG5hbWVzcGFjZSBvYmplY3QiLCJ3ZWJwYWNrOi8vYWR2YW5jZWQtYWRibG9ja2VyLXdlYi1leHRlbnNpb24vLi9zcmMvdGFyZ2V0cy9jb250ZW50L2luZGV4LnRzIl0sIm5hbWVzIjpbIk1lc3NhZ2VzVG9OYXRpdmVBcHAiLCJNZXNzYWdlc1RvQmFja2dyb3VuZFBhZ2UiLCJNZXNzYWdlc1RvQ29udGVudFNjcmlwdCIsIkFwcGVhcmFuY2VUaGVtZSIsIkFQUEVBUkFOQ0VfVEhFTUVfREVGQVVMVCIsIlN5c3RlbSIsImxvZ01lc3NhZ2UiLCJ2ZXJib3NlIiwibWVzc2FnZSIsImNvbnNvbGUiLCJsb2ciLCJnZXRTZWxlY3RvcnNBbmRTY3JpcHRzIiwiYnJvd3NlciIsInR5cGUiLCJkYXRhIiwidXJsIiwid2luZG93IiwibG9jYXRpb24iLCJocmVmIiwicmVzcG9uc2UiLCJKU09OIiwicGFyc2UiLCJleGVjdXRlU2NyaXB0cyIsInNjcmlwdHMiLCJ1bnNoaWZ0IiwicHVzaCIsInNjcmlwdFRhZyIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsInNldEF0dHJpYnV0ZSIsInRleHRDb250ZW50Iiwiam9pbiIsInBhcmVudCIsImhlYWQiLCJkb2N1bWVudEVsZW1lbnQiLCJhcHBlbmRDaGlsZCIsInBhcmVudE5vZGUiLCJyZW1vdmVDaGlsZCIsImFwcGx5U2NyaXB0cyIsImxlbmd0aCIsInJldmVyc2UiLCJwcm90ZWN0U3R5bGVFbGVtZW50Q29udGVudCIsInByb3RlY3RTdHlsZUVsIiwiTXV0YXRpb25PYnNlcnZlciIsIldlYktpdE11dGF0aW9uT2JzZXJ2ZXIiLCJpbm5lck9ic2VydmVyIiwibXV0YXRpb25zIiwiaSIsIm0iLCJoYXNBdHRyaWJ1dGUiLCJnZXRBdHRyaWJ1dGUiLCJyZW1vdmVBdHRyaWJ1dGUiLCJpc1Byb3RlY3RTdHlsZUVsTW9kaWZpZWQiLCJyZW1vdmVkTm9kZXMiLCJqIiwib2xkVmFsdWUiLCJvYnNlcnZlIiwiY2hpbGRMaXN0IiwiY2hhcmFjdGVyRGF0YSIsInN1YnRyZWUiLCJjaGFyYWN0ZXJEYXRhT2xkVmFsdWUiLCJhcHBseUNzcyIsInN0eWxlU2VsZWN0b3JzIiwic3R5bGVFbGVtZW50Iiwic2VsZWN0b3JzIiwibWFwIiwicyIsInRyaW0iLCJmb3JFYWNoIiwic2VsZWN0b3IiLCJzaGVldCIsImluc2VydFJ1bGUiLCJhcHBseUV4dGVuZGVkQ3NzIiwiZXh0ZW5kZWRDc3MiLCJleHRjc3MiLCJFeHRlbmRlZENzcyIsInN0eWxlU2hlZXQiLCJmaWx0ZXIiLCJhcHBseSIsImFwcGx5U2NyaXB0bGV0cyIsInNjcmlwdGxldHNEYXRhIiwic2NyaXB0bGV0RXhlY3V0YWJsZVNjcmlwdHMiLCJwYXJhbSIsImVuZ2luZSIsImNvZGUiLCJzY3JpcHRsZXRzIiwiYWRnIiwiYXBwbHlBZHZhbmNlZEJsb2NraW5nRGF0YSIsInNlbGVjdG9yc0FuZFNjcmlwdHMiLCJjc3NJbmplY3QiLCJjc3NFeHRlbmRlZCIsImluaXQiLCJIVE1MRG9jdW1lbnQiLCJpbmRleE9mIiwic3RhcnRHZXR0aW5nU2NyaXB0cyIsIkRhdGUiLCJub3ciLCJjb250ZW50Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNI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QTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUEsbUJBQW1CLGtDQUFrQztBQUNyRDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDOztBQUVoQztBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBLDJCQUEyQjtBQUMzQjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSyxFQUFFOztBQUVQLG9DQUFvQzs7QUFFcEM7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7O0FBR0w7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOzs7QUFHTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBLEtBQUs7OztBQUdMO0FBQ0EsR0FBRzs7O0FBR0gsaURBQWlEOztBQUVqRDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLE9BQU87QUFDbEIsV0FBVyxRQUFRO0FBQ25CLGFBQWEscUJBQXFCO0FBQ2xDO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLGlFQUFlLFdBQVcsRUFBQzs7Ozs7Ozs7Ozs7QUNwckszQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsZ0JBQWdCO0FBQ2hCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWM7QUFDZCxLQUFLO0FBQ0wsY0FBYztBQUNkO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseURBQXlEO0FBQ3pEO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWTtBQUNaOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQSxXQUFXO0FBQ1g7O0FBRUE7QUFDQTtBQUNBLHdDQUF3QyxXQUFXO0FBQ25EO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSwyQkFBMkI7QUFDM0I7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBLFNBQVM7QUFDVDtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0Esb0NBQW9DLGNBQWM7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsaUNBQWlDLGtCQUFrQjtBQUNuRDtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsaUJBQWlCOztBQUVqQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsaUJBQWlCO0FBQ3pDO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7O0FBRUE7QUFDQSxZQUFZO0FBQ1o7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQSw4Q0FBOEMsUUFBUTtBQUN0RDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7O0FBRUEsV0FBVztBQUNYO0FBQ0E7QUFDQTs7QUFFQSxXQUFXO0FBQ1g7QUFDQTtBQUNBOztBQUVBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQSw4Q0FBOEMsUUFBUTtBQUN0RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBOztBQUVBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBLDhD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Q0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBOztBQUVBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLDJDQUEyQyw4QkFBOEI7O0FBRXpFO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsV0FBVyxFQUFFO0FBQ2IsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVyxFQUFFO0FBQ2IsYUFBYTtBQUNiOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLGNBQWM7QUFDekIsYUFBYTtBQUNiOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7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QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxPQUFPO0FBQ1A7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsT0FBTztBQUNQO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrREFBa0Q7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLHNDQUFzQztBQUN0Qzs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsOEJBQThCOztBQUU5Qjs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxLQUFLO0FBQ0w7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSwwRkFBMEYsYUFBYTtBQUN2RztBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxREFBcUQ7QUFDckQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFD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Q0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQztBQUNoQztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtHQUFrRzs7QUFFbEc7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsT0FBTztBQUNQO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0EsR0FBRztBQUNIO0FBQ0EsR0FBRztBQUNIO0FBQ0EsR0FBRztBQUNIO0FBQ0EsR0FBRztBQUNIO0FBQ0EsR0FBRztBQUNIO0FBQ0EsR0FBRztBQUNIO0FBQ0EsR0FBRztBQUNIO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQSxHQUFHO0FBQ0g7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0M7QUFDaEM7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1R0FBdUc7QUFDdkc7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsT0FBTztBQUNQO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLG9CQUFvQjtBQUNwQixvQkFBb0I7QUFDcEIsaUJBQWlCO0FBQ2pCLHVCQUF1QjtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsNEJBQTRCO0FBQzVCOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUEscUJBQXFCLDJCQUEyQjtBQUNoRDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsMEZBQTBGLGFBQWE7QUFDdkc7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsNEZBQTRGLGFBQWE7QUFDekc7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLG1CQUFtQix1QkFBdUI7QUFDMUM7QUFDQTs7QUFFQSxxQkFBcUIsbUJBQW1CO0FBQ3hDO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7O0FBRUEsMEZBQTBGLGFBQWE7QUFDdkc7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0Esc0NBQXNDOztBQUV0Qzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLDRCQUE0Qjs7QUFFNUI7O0FBRUE7QUFDQTs7QUFFQSx1RUFBdUUsYUFBYTtBQUNwRjtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxRUFBcUUsYUFBYTtBQUNsRjtBQUNBOztBQUVBLG9CQUFvQjtBQUNwQjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLGNBQWM7QUFDekI7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsY0FBYzs7QUFFZDs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLElBQUk7O0FBRUo7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUEsbUJBQW1CLHVCQUF1QjtBQUMxQztBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQSxvQkFBb0Isa0JBQWtCO0FBQ3RDO0FBQ0EsNkJBQTZCLGtCQUFrQjtBQUMvQztBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTs7QUFFQSxVQUFVOztBQUVWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVMsZUFBZTs7QUFFeEI7O0FBRUE7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsYUFBYTtBQUNiOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLE9BQU87QUFDUDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLGFBQWE7QUFDYjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxPQUFPO0FBQ1A7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSztBQUNMOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0Esb0NBQW9DO0FBQ3BDOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxPQUFPO0FBQ1A7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsV0FBVzs7QUFFWDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBOztBQUVBLHVCQUF1QixxQkFBcUI7QUFDNUM7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxrQ0FBa0M7QUFDbEM7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlFQUF5RTtBQUN6RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSwwRkFBMEYsYUFBYTtBQUN2RztBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzRUFBc0U7QUFDdEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsMEZBQTBGLGFBQWE7QUFDdkc7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBLG1CQUFtQixXQUFXO0FBQzlCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHOzs7QUFHSDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzREFBc0QsUUFBUTtBQUM5RDtBQUNBO0FBQ0Esb0JBQW9CLHVCQUF1QjtBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNEQUFzRCxnQkFBZ0I7QUFDdEU7QUFDQTtBQUNBLG9CQUFvQixnQkFBZ0I7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7OztBQUdIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQSxtQkFBbUIsMEJBQTBCO0FBQzdDO0FBQ0E7QUFDQSw0T0FBNE87O0FBRTVPLGdGQUFnRjs7QUFFaEY7O0FBRUEsc0JBQXNCLHFCQUFxQjtBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYSxPQUFPO0FBQ3BCOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSx1RUFBdUUsYUFBYTtBQUNwRjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTs7O0FBR0o7QUFDQSxnQ0FBZ0M7O0FBRWhDLG1EQUFtRDs7QUFFbkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsSUFBSTtBQUNKOzs7QUFHQTtBQUNBO0FBQ0EsR0FBRzs7O0FBR0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLGlFQUFpRTs7QUFFakU7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsMEZBQTBGLGFBQWE7QUFDdkc7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLG1EQUFtRDtBQUNuRDs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxtREFBbUQ7QUFDbkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBLDRIQUE0SDs7QUFFNUg7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsT0FBTzs7QUFFUDtBQUNBO0FBQ0EsT0FBTztBQUNQOzs7QUFHQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBLDRIQUE0SDs7QUFFNUg7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsT0FBTzs7QUFFUDtBQUNBO0FBQ0EsT0FBTztBQUNQOzs7QUFHQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEVBQThFO0FBQzlFLDhFQUE4RTtBQUM5RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTCwyREFBMkQ7O0FBRTNEO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLHlDQUF5QztBQUN6QztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBLENBQUM7QUFDRDtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0EsQ0FBQztBQUNEO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVcsT0FBTztBQUNsQixZQUFZO0FBQ1o7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxzQ0FBc0MsSUFBSTtBQUMxQztBQUNBO0FBQ0EsV0FBVyxPQUFPO0FBQ2xCOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLE9BQU87QUFDbEI7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLE9BQU87QUFDbEI7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLE9BQU87QUFDbEI7OztBQUdBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxXQUFXLE9BQU87QUFDbEI7OztBQUdBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVcsT0FBTztBQUNsQixhQUFhO0FBQ2I7O0FBRUE7QUFDQTtBQUNB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QUNyRDtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsNEJBQTRCOzs7QUFHNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsa0NBQWtDOzs7QUFHbEM7QUFDQTs7QUFFQSxvQkFBb0I7OztBQUdwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1EQUFtRDtBQUNuRDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsVUFBVTtBQUNWLEtBQUs7O0FBRUw7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FB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QTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFHQUFxRzs7QUFFckc7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLENBQUM7OztBQUdEO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHLEVBQUU7O0FBRUw7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWM7QUFDZCxnQkFBZ0I7QUFDaEIsZUFBZTtBQUNmO0FBQ0EsR0FBRztBQUNIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBLDRDQUE0QyxnQkFBZ0I7QUFDNUQ7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDOztBQUVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDOztBQUVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDOztBQUVEO0FBQ0E7QUFDQSxDQUFDOztBQUVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQSxDQUFDOztBQUVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUI7O0FBRW5CO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUI7O0FBRXZCO0FBQ0E7QUFDQTs7QUFFQSxZQUFZLGFBQWE7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQSxZQUFZLGFBQWE7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEtBQUs7OztBQUdMLFVBQVUsYUFBYTtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRztBQUNIOzs7QUFHQTs7QUFFQSxRQUFRLGFBQWE7QUFDckI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7OztBQUdILDZDQUE2Qzs7QUFFN0MsOEJBQThCOztBQUU5QjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7O0FBRUEsNEJBQTRCO0FBQzVCOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBO0FBQ0E7QUFDQSxDQUFDOztBQUVEO0FBQ0E7QUFDQSxDQUFDOztBQUVEO0FBQ0E7QUFDQSxrQkFBa0I7O0FBRWxCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQjs7QUFFMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDREQUE0RDs7QUFFNUQ7QUFDQSx3QkFBd0I7O0FBRXhCOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7OztBQUdIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRzs7O0FBR0g7QUFDQTtBQUNBO0FBQ0EsK0NBQStDOztBQUUvQztBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBO0FBQ0E7O0FBRUE7OztBQUdBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQyxjQUFjOzs7QUFHZjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUI7O0FBRXZCLGVBQWUsV0FBVztBQUMxQix5Q0FBeUM7O0FBRXpDLDRCQUE0Qjs7QUFFNUI7QUFDQTtBQUNBLEdBQUc7OztBQUdIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQjs7QUFFbEIsZUFBZSxXQUFXO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHOzs7QUFHSDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0EsR0FBRzs7O0FBR0g7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCOztBQUV2QixlQUFlLFdBQVc7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRzs7O0FBR0g7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEseUNBQXlDLGdCQUFnQjtBQUN6RDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLDJDQUEyQztBQUMzQztBQUNBOztBQUVBO0FBQ0EscUVBQXFFO0FBQ3JFOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQzs7QUFFRDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEseUNBQXlDLGdCQUFnQjtBQUN6RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEseUNBQXlDLGdCQUFnQjtBQUN6RDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQzs7QUFFRDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQzs7QUFFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCOztBQUVBO0FBQ0E7QUFDQSwyQ0FBMkM7O0FBRTNDO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7O0FBRXJCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDOztBQUVELFlBQVk7QUFDWjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNILDJDQUEyQyx5Q0FBeUMsaUJBQWlCO0FBQ3JHOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTs7O0FBR0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDOztBQUVEO0FBQ0E7QUFDQTtBQUNBLENBQUM7O0FBRUQ7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUNBQXVDLEVBQUU7QUFDekM7QUFDQSxzQ0FBc0MsRUFBRSxlQUFlLEVBQUUsWUFBWTs7QUFFckU7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBLE1BQU07QUFDTjtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7O0FBR0E7QUFDQTs7QUFFQSx1Q0FBdUM7O0FBRXZDOztBQUVBLGVBQWUsU0FBUztBQUN4QjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYztBQUNkOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsbURBQW1ELHFCQUFxQjtBQUN4RTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsNkNBQTZDO0FBQzdDOztBQUVBOztBQUVBLCtDQUErQyxrQkFBa0I7QUFDakU7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0Esc0JBQXNCO0FBQ3RCO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQSw4Q0FBOEMsa0JBQWtCO0FBQ2hFO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxrREFBa0Qsa0JBQWtCO0FBQ3BFO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSx5Q0FBeUM7QUFDekM7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLHdEQUF3RDtBQUN4RCxTQUFTO0FBQ1Q7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBOztBQUVBLGdCQUFnQixlQUFlO0FBQy9COztBQUVBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTs7QUFFQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCO0FBQzFCO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEtBQUs7QUFDTCxNQUFNO0FBQ047QUFDQTtBQUNBLFVBQVU7O0FBRVY7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBLDRFQUE0RTtBQUM1RSxPQUFPO0FBQ1A7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7OztBQUdMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTzs7O0FBR1A7QUFDQSxLQUFLOzs7QUFHTDtBQUNBO0FBQ0E7QUFDQSw4QkFBOEI7O0FBRTlCLDBGQUEwRjtBQUMxRixPQUFPO0FBQ1A7QUFDQSw0REFBNEQ7QUFDNUQsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQsT0FBTztBQUNQO0FBQ0EsT0FBTzs7QUFFUCxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQjtBQUNsQiwwQkFBMEI7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsdUJBQXVCOztBQUV2QiwwQkFBMEI7QUFDMUI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLDREQUE0RCxzQkFBc0I7QUFDbEY7O0FBRUE7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWCxtRUFBbUU7QUFDbkUsU0FBUztBQUNUO0FBQ0E7QUFDQSxzQkFBc0I7QUFDdEI7QUFDQSxPQUFPO0FBQ1AsOERBQThEO0FBQzlELE9BQU87QUFDUDtBQUNBO0FBQ0Esb0JBQW9CO0FBQ3BCO0FBQ0EsS0FBSztBQUNMLGNBQWM7QUFDZCxPQUFPO0FBQ1A7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0EsR0FBRzs7O0FBR0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBLEdBQUc7QUFDSDtBQUNBLEdBQUc7QUFDSDtBQUNBLEdBQUc7QUFDSDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0RBQStEO0FBQy9EOztBQUVBLG9FQUFvRSwwQkFBMEI7QUFDOUY7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFQTtBQUNBLCtFQUErRTtBQUMvRTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7O0FBRVg7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPOzs7QUFHUDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7OztBQUdIOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQSxnREFBZ0QsZ0JBQWdCO0FBQ2hFO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBOztBQUVBO0FBQ0EsSUFBSTs7QUFFSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsdUNBQXVDLGdCQUFnQjtBQUN2RDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDOzs7QUFHRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUEsc0RBQXNELGdCQUFnQjtBQUN0RTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLENBQUM7OztBQUdEO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7OztBQUdEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQzs7O0FBR0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJDQUEyQyxNQUFNO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBLENBQUM7OztBQUdEO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FB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LFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNY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akY7V0FDQTtXQUNBLEU7Ozs7O1dDUEEsd0Y7Ozs7O1dDQUE7V0FDQTtXQUNBO1dBQ0Esc0RBQXNELGtCQUFrQjtXQUN4RTtXQUNBLCtDQUErQyxjQUFjO1dBQzdELEU7Ozs7Ozs7Ozs7Ozs7QUNOQTtBQUVBTSx3REFBQSxHIiwiZmlsZSI6ImNvbnRlbnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJmdW5jdGlvbiBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csIGtleSwgYXJnKSB7XG4gIHRyeSB7XG4gICAgdmFyIGluZm8gPSBnZW5ba2V5XShhcmcpO1xuICAgIHZhciB2YWx1ZSA9IGluZm8udmFsdWU7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmVqZWN0KGVycm9yKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBpZiAoaW5mby5kb25lKSB7XG4gICAgcmVzb2x2ZSh2YWx1ZSk7XG4gIH0gZWxzZSB7XG4gICAgUHJvbWlzZS5yZXNvbHZlKHZhbHVlKS50aGVuKF9uZXh0LCBfdGhyb3cpO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIF9hc3luY1RvR2VuZXJhdG9yKGZuKSB7XG4gIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzLFxuICAgICAgICBhcmdzID0gYXJndW1lbnRzO1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICB2YXIgZ2VuID0gZm4uYXBwbHkoc2VsZiwgYXJncyk7XG5cbiAgICAgIGZ1bmN0aW9uIF9uZXh0KHZhbHVlKSB7XG4gICAgICAgIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgXCJuZXh0XCIsIHZhbHVlKTtcbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gX3Rocm93KGVycikge1xuICAgICAgICBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csIFwidGhyb3dcIiwgZXJyKTtcbiAgICAgIH1cblxuICAgICAgX25leHQodW5kZWZpbmVkKTtcbiAgICB9KTtcbiAgfTtcbn0iLCJtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoXCJyZWdlbmVyYXRvci1ydW50aW1lXCIpO1xuIiwiZXhwb3J0IGVudW0gTWVzc2FnZXNUb05hdGl2ZUFwcCB7XG4gICAgV3JpdGVJbk5hdGl2ZUxvZyA9ICd3cml0ZUluTmF0aXZlTG9nJyxcbiAgICBHZXRCbG9ja2luZ0RhdGEgPSAnZ2V0QmxvY2tpbmdEYXRhJyxcbiAgICBBZGRUb1VzZXJSdWxlcyA9ICdhZGRUb1VzZXJSdWxlcycsXG4gICAgSXNQcm90ZWN0aW9uRW5hYmxlZCA9ICdpc1Byb3RlY3Rpb25FbmFibGVkJyxcbiAgICBFbmFibGVQcm90ZWN0aW9uID0gJ2VuYWJsZVByb3RlY3Rpb24nLFxuICAgIERpc2FibGVQcm90ZWN0aW9uID0gJ2Rpc2FibGVQcm90ZWN0aW9uJyxcbiAgICBIYXNVc2VyUnVsZXNCeVNpdGUgPSAnaGFzVXNlclJ1bGVzQnlTaXRlJyxcbiAgICBSZW1vdmVVc2VyUnVsZXNCeVNpdGUgPSAncmVtb3ZlVXNlclJ1bGVzQnlTaXRlJyxcbiAgICBSZXBvcnRQcm9ibGVtID0gJ3JlcG9ydFByb2JsZW0nLFxuICAgIElzUHJlbWl1bSA9ICdpc1ByZW1pdW0nLFxuICAgIEdldEFwcGVhcmFuY2VUaGVtZSA9ICdnZXRBcHBlYXJhbmNlVGhlbWUnLFxuICAgIEFyZUNvbnRlbnRCbG9ja2Vyc0VuYWJsZWQgPSAnYXJlQ29udGVudEJsb2NrZXJzRW5hYmxlZCcsXG4gICAgVXBncmFkZU1lID0gJ3VwZ3JhZGVNZScsXG59XG5cbmV4cG9ydCBlbnVtIE1lc3NhZ2VzVG9CYWNrZ3JvdW5kUGFnZSB7XG4gICAgT3BlbkFzc2lzdGFudCA9ICdvcGVuX2Fzc2lzdGFudCcsXG4gICAgR2V0U2NyaXB0c0FuZFNlbGVjdG9ycyA9ICdnZXRfc2NyaXB0c19hbmRfc2VsZWN0b3JzJyxcbiAgICBBZGRSdWxlID0gJ2FkZF9ydWxlJyxcbiAgICBHZXRQb3B1cERhdGEgPSAnZ2V0X3BvcHVwX2RhdGEnLFxuICAgIFNldFBlcm1pc3Npb25zTW9kYWxWaWV3ZWQgPSAnc2V0X3Blcm1pc3Npb25zX21vZGFsX3ZpZXdlZCcsXG4gICAgU2V0UHJvdGVjdGlvblN0YXR1cyA9ICdzZXRfcHJvdGVjdGlvbl9zdGF0dXMnLFxuICAgIERlbGV0ZVVzZXJSdWxlc0J5VXJsID0gJ2RlbGV0ZV91c2VyX3J1bGVzX2J5X3VybCcsXG4gICAgUmVwb3J0UHJvYmxlbSA9ICdyZXBvcnRfcHJvYmxlbScsXG4gICAgVXBncmFkZUNsaWNrZWQgPSAndXBncmFkZV9jbGlja2VkJyxcbn1cblxuZXhwb3J0IGVudW0gTWVzc2FnZXNUb0NvbnRlbnRTY3JpcHQge1xuICAgIEluaXRBc3Npc3RhbnQgPSAnaW5pdF9hc3Npc3RhbnQnLFxufVxuXG5leHBvcnQgZW51bSBBcHBlYXJhbmNlVGhlbWUge1xuICAgIFN5c3RlbSA9ICdzeXN0ZW0nLFxuICAgIERhcmsgPSAnZGFyaycsXG4gICAgTGlnaHQgPSAnbGlnaHQnLFxufVxuXG5leHBvcnQgY29uc3QgQVBQRUFSQU5DRV9USEVNRV9ERUZBVUxUID0gQXBwZWFyYW5jZVRoZW1lLlN5c3RlbTtcbiIsIi8qIGVzbGludC1kaXNhYmxlIG5vLWNvbnNvbGUgKi9cbmltcG9ydCB7IGJyb3dzZXIgfSBmcm9tICd3ZWJleHRlbnNpb24tcG9seWZpbGwtdHMnO1xuaW1wb3J0IEV4dGVuZGVkQ3NzIGZyb20gJ2V4dGVuZGVkLWNzcyc7XG5pbXBvcnQgc2NyaXB0bGV0cyBmcm9tICdzY3JpcHRsZXRzJztcblxuaW1wb3J0IHsgTWVzc2FnZXNUb0JhY2tncm91bmRQYWdlIH0gZnJvbSAnLi4vY29tbW9uL2NvbnN0YW50cyc7XG5cbmludGVyZmFjZSBTZWxlY3RvcnNBbmRTY3JpcHRzIHtcbiAgICBzY3JpcHRzOiBzdHJpbmdbXSxcbiAgICBjc3NJbmplY3Q6IHN0cmluZ1tdLFxuICAgIGNzc0V4dGVuZGVkOiBzdHJpbmdbXSxcbiAgICBzY3JpcHRsZXRzOiBzdHJpbmdbXSxcbn1cblxuLyoqXG4gKiBMb2dzIGEgbWVzc2FnZSBpZiB2ZXJib3NlIGlzIHRydWVcbiAqXG4gKiBAcGFyYW0gdmVyYm9zZVxuICogQHBhcmFtIG1lc3NhZ2VcbiAqL1xuY29uc3QgbG9nTWVzc2FnZSA9ICh2ZXJib3NlOiBib29sZWFuLCBtZXNzYWdlOiBzdHJpbmcpID0+IHtcbiAgICBpZiAodmVyYm9zZSkge1xuICAgICAgICBjb25zb2xlLmxvZyhgKEFHKSAke21lc3NhZ2V9YCk7XG4gICAgfVxufTtcblxuY29uc3QgZ2V0U2VsZWN0b3JzQW5kU2NyaXB0cyA9IGFzeW5jICgpOiBQcm9taXNlPFNlbGVjdG9yc0FuZFNjcmlwdHMgfCBudWxsPiA9PiB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBicm93c2VyLnJ1bnRpbWUuc2VuZE1lc3NhZ2Uoe1xuICAgICAgICB0eXBlOiBNZXNzYWdlc1RvQmFja2dyb3VuZFBhZ2UuR2V0U2NyaXB0c0FuZFNlbGVjdG9ycyxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgdXJsOiB3aW5kb3cubG9jYXRpb24uaHJlZixcbiAgICAgICAgfSxcbiAgICB9KTtcblxuICAgIGlmIChyZXNwb25zZSA9PT0gbnVsbCkge1xuICAgICAgICBjb25zb2xlLmxvZygnQUc6IG5vIHNjcmlwdHMgYW5kIHNlbGVjdG9ycyByZWNlaXZlZCcpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShyZXNwb25zZSkgYXMgU2VsZWN0b3JzQW5kU2NyaXB0cztcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdBRzogZXJyb3Igb2NjdXJyZWQgb24gc2VsZWN0b3JzIGFuZCBzY3JpcHQganNvbiBwYXJzZScsIGUpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG59O1xuXG4vKipcbiAqIEV4ZWN1dGUgc2NyaXB0cyBpbiBhIHBhZ2UgY29udGV4dCBhbmQgY2xlYW51cCBpdHNlbGYgd2hlbiBleGVjdXRpb24gY29tcGxldGVzXG4gKiBAcGFyYW0gc2NyaXB0cyBTY3JpcHRzIGFycmF5IHRvIGV4ZWN1dGVcbiAqL1xuY29uc3QgZXhlY3V0ZVNjcmlwdHMgPSAoc2NyaXB0czogc3RyaW5nW10pID0+IHtcbiAgICAvLyBXcmFwIHdpdGggdHJ5IGNhdGNoXG4gICAgc2NyaXB0cy51bnNoaWZ0KCcoIGZ1bmN0aW9uICgpIHsgdHJ5IHsnKTtcbiAgICBzY3JpcHRzLnB1c2goXCJ9IGNhdGNoIChleCkgeyBjb25zb2xlLmVycm9yKCdFcnJvciBleGVjdXRpbmcgQUcganM6ICcgKyBleCk7IH0gfSkoKTtcIik7XG5cbiAgICBjb25zdCBzY3JpcHRUYWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcbiAgICBzY3JpcHRUYWcuc2V0QXR0cmlidXRlKCd0eXBlJywgJ3RleHQvamF2YXNjcmlwdCcpO1xuICAgIHNjcmlwdFRhZy50ZXh0Q29udGVudCA9IHNjcmlwdHMuam9pbignXFxyXFxuJyk7XG5cbiAgICBjb25zdCBwYXJlbnQgPSBkb2N1bWVudC5oZWFkIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDtcbiAgICBwYXJlbnQuYXBwZW5kQ2hpbGQoc2NyaXB0VGFnKTtcbiAgICBpZiAoc2NyaXB0VGFnLnBhcmVudE5vZGUpIHtcbiAgICAgICAgc2NyaXB0VGFnLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoc2NyaXB0VGFnKTtcbiAgICB9XG59O1xuXG4vKipcbiAqIEFwcGxpZXMgSlMgaW5qZWN0aW9ucy5cbiAqIEBwYXJhbSBzY3JpcHRzIEFycmF5IHdpdGggSlMgc2NyaXB0c1xuICogQHBhcmFtIHZlcmJvc2UgbG9nZ2luZ1xuICovXG5jb25zdCBhcHBseVNjcmlwdHMgPSAoc2NyaXB0czogc3RyaW5nW10sIHZlcmJvc2U6IGJvb2xlYW4pID0+IHtcbiAgICBpZiAoIXNjcmlwdHMgfHwgc2NyaXB0cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGxvZ01lc3NhZ2UodmVyYm9zZSwgYHNjcmlwdHMgbGVuZ3RoOiAke3NjcmlwdHMubGVuZ3RofWApO1xuICAgIGV4ZWN1dGVTY3JpcHRzKHNjcmlwdHMucmV2ZXJzZSgpKTtcbn07XG5cbi8qKlxuICogUHJvdGVjdHMgc3BlY2lmaWVkIHN0eWxlIGVsZW1lbnQgZnJvbSBjaGFuZ2VzIHRvIHRoZSBjdXJyZW50IGRvY3VtZW50XG4gKiBBZGQgYSBtdXRhdGlvbiBvYnNlcnZlciwgd2hpY2ggaXMgYWRkcyBvdXIgcnVsZXMgYWdhaW4gaWYgaXQgd2FzIHJlbW92ZWRcbiAqXG4gKiBAcGFyYW0gcHJvdGVjdFN0eWxlRWwgcHJvdGVjdGVkIHN0eWxlIGVsZW1lbnRcbiAqL1xuY29uc3QgcHJvdGVjdFN0eWxlRWxlbWVudENvbnRlbnQgPSAocHJvdGVjdFN0eWxlRWw6IE5vZGUpID0+IHtcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgY29uc3QgTXV0YXRpb25PYnNlcnZlciA9IHdpbmRvdy5NdXRhdGlvbk9ic2VydmVyIHx8IHdpbmRvdy5XZWJLaXRNdXRhdGlvbk9ic2VydmVyO1xuICAgIGlmICghTXV0YXRpb25PYnNlcnZlcikge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIC8qIG9ic2VydmVyLCB3aGljaCBvYnNlcnZlIHByb3RlY3RTdHlsZUVsIGlubmVyIGNoYW5nZXMsIHdpdGhvdXQgZGVsZXRpbmcgc3R5bGVFbCAqL1xuICAgIGNvbnN0IGlubmVyT2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcigoKG11dGF0aW9ucykgPT4ge1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG11dGF0aW9ucy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICAgICAgY29uc3QgbSA9IG11dGF0aW9uc1tpXTtcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgIGlmIChwcm90ZWN0U3R5bGVFbC5oYXNBdHRyaWJ1dGUoJ21vZCcpICYmIHByb3RlY3RTdHlsZUVsLmdldEF0dHJpYnV0ZSgnbW9kJykgPT09ICdpbm5lcicpIHtcbiAgICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICAgICAgcHJvdGVjdFN0eWxlRWwucmVtb3ZlQXR0cmlidXRlKCdtb2QnKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgcHJvdGVjdFN0eWxlRWwuc2V0QXR0cmlidXRlKCdtb2QnLCAnaW5uZXInKTtcbiAgICAgICAgICAgIGxldCBpc1Byb3RlY3RTdHlsZUVsTW9kaWZpZWQgPSBmYWxzZTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBmdXJ0aGVyLCB0aGVyZSBhcmUgdHdvIG11dHVhbGx5IGV4Y2x1c2l2ZSBzaXR1YXRpb25zOiBlaXRoZXIgdGhlcmUgd2VyZSBjaGFuZ2VzXG4gICAgICAgICAgICAgKiB0aGUgdGV4dCBvZiBwcm90ZWN0U3R5bGVFbCwgZWl0aGVyIHRoZXJlIHdhcyByZW1vdmVzIGEgd2hvbGUgY2hpbGQgXCJ0ZXh0XCJcbiAgICAgICAgICAgICAqIGVsZW1lbnQgb2YgcHJvdGVjdFN0eWxlRWwgd2UnbGwgcHJvY2VzcyBib3RoIG9mIHRoZW1cbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgaWYgKG0ucmVtb3ZlZE5vZGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IG0ucmVtb3ZlZE5vZGVzLmxlbmd0aDsgaiArPSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIGlzUHJvdGVjdFN0eWxlRWxNb2RpZmllZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHByb3RlY3RTdHlsZUVsLmFwcGVuZENoaWxkKG0ucmVtb3ZlZE5vZGVzW2pdKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG0ub2xkVmFsdWUpIHtcbiAgICAgICAgICAgICAgICBpc1Byb3RlY3RTdHlsZUVsTW9kaWZpZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1wYXJhbS1yZWFzc2lnblxuICAgICAgICAgICAgICAgIHByb3RlY3RTdHlsZUVsLnRleHRDb250ZW50ID0gbS5vbGRWYWx1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFpc1Byb3RlY3RTdHlsZUVsTW9kaWZpZWQpIHtcbiAgICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICAgICAgcHJvdGVjdFN0eWxlRWwucmVtb3ZlQXR0cmlidXRlKCdtb2QnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pKTtcblxuICAgIGlubmVyT2JzZXJ2ZXIub2JzZXJ2ZShwcm90ZWN0U3R5bGVFbCwge1xuICAgICAgICBjaGlsZExpc3Q6IHRydWUsXG4gICAgICAgIGNoYXJhY3RlckRhdGE6IHRydWUsXG4gICAgICAgIHN1YnRyZWU6IHRydWUsXG4gICAgICAgIGNoYXJhY3RlckRhdGFPbGRWYWx1ZTogdHJ1ZSxcbiAgICB9KTtcbn07XG5cbi8qKlxuICogQXBwbGllcyBjc3Mgc3R5bGVzaGVldFxuICogQHBhcmFtIHN0eWxlU2VsZWN0b3JzIEFycmF5IG9mIHN0eWxlc2hlZXRzIG9yIHNlbGVjdG9yc1xuICogQHBhcmFtIHZlcmJvc2UgbG9nZ2luZ1xuICovXG5jb25zdCBhcHBseUNzcyA9IChzdHlsZVNlbGVjdG9yczogc3RyaW5nW10sIHZlcmJvc2U6IGJvb2xlYW4pID0+IHtcbiAgICBjb25zb2xlLmxvZyhzdHlsZVNlbGVjdG9ycyk7XG4gICAgaWYgKCFzdHlsZVNlbGVjdG9ycyB8fCAhc3R5bGVTZWxlY3RvcnMubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZyhzdHlsZVNlbGVjdG9ycyk7XG5cbiAgICBsb2dNZXNzYWdlKHZlcmJvc2UsIGBjc3MgbGVuZ3RoOiAke3N0eWxlU2VsZWN0b3JzLmxlbmd0aH1gKTtcblxuICAgIGNvbnN0IHN0eWxlRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3N0eWxlJyk7XG4gICAgc3R5bGVFbGVtZW50LnNldEF0dHJpYnV0ZSgndHlwZScsICd0ZXh0L2NzcycpO1xuICAgIChkb2N1bWVudC5oZWFkIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCkuYXBwZW5kQ2hpbGQoc3R5bGVFbGVtZW50KTtcblxuICAgIGNvbnN0IHNlbGVjdG9ycyA9IHN0eWxlU2VsZWN0b3JzLm1hcCgocykgPT4gcy50cmltKCkpO1xuICAgIGNvbnNvbGUubG9nKHNlbGVjdG9ycyk7XG4gICAgc2VsZWN0b3JzLmZvckVhY2goKHNlbGVjdG9yKSA9PiB7XG4gICAgICAgIHN0eWxlRWxlbWVudC5zaGVldCEuaW5zZXJ0UnVsZShzZWxlY3Rvcik7XG4gICAgfSk7XG5cbiAgICBwcm90ZWN0U3R5bGVFbGVtZW50Q29udGVudChzdHlsZUVsZW1lbnQpO1xufTtcblxuLyoqXG4gKiBBcHBsaWVzIEV4dGVuZGVkIENzcyBzdHlsZXNoZWV0XG4gKlxuICogQHBhcmFtIGV4dGVuZGVkQ3NzIEFycmF5IHdpdGggRXh0ZW5kZWRDc3Mgc3R5bGVzaGVldHNcbiAqIEBwYXJhbSB2ZXJib3NlIGxvZ2dpbmdcbiAqL1xuY29uc3QgYXBwbHlFeHRlbmRlZENzcyA9IChleHRlbmRlZENzczogc3RyaW5nW10sIHZlcmJvc2U6IGJvb2xlYW4pID0+IHtcbiAgICBpZiAoIWV4dGVuZGVkQ3NzIHx8ICFleHRlbmRlZENzcy5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGxvZ01lc3NhZ2UodmVyYm9zZSwgYGV4dGVuZGVkIGNzcyBsZW5ndGg6ICR7ZXh0ZW5kZWRDc3MubGVuZ3RofWApO1xuICAgIGNvbnN0IGV4dGNzcyA9IG5ldyBFeHRlbmRlZENzcyh7XG4gICAgICAgIHN0eWxlU2hlZXQ6IGV4dGVuZGVkQ3NzXG4gICAgICAgICAgICAuZmlsdGVyKChzKSA9PiBzLmxlbmd0aCA+IDApXG4gICAgICAgICAgICAubWFwKChzKSA9PiBzLnRyaW0oKSlcbiAgICAgICAgICAgIC5tYXAoKHMpID0+IChzW3MubGVuZ3RoIC0gMV0gIT09ICd9JyA/IGAke3N9IHtkaXNwbGF5Om5vbmUhaW1wb3J0YW50O31gIDogcykpXG4gICAgICAgICAgICAuam9pbignXFxuJyksXG4gICAgfSk7XG4gICAgZXh0Y3NzLmFwcGx5KCk7XG59O1xuXG4vKipcbiAqIEFwcGxpZXMgc2NyaXB0bGV0c1xuICpcbiAqIEBwYXJhbSBzY3JpcHRsZXRzRGF0YSBBcnJheSB3aXRoIHNjcmlwdGxldHMgZGF0YVxuICogQHBhcmFtIHZlcmJvc2UgbG9nZ2luZ1xuICovXG5jb25zdCBhcHBseVNjcmlwdGxldHMgPSAoc2NyaXB0bGV0c0RhdGE6IHN0cmluZ1tdLCB2ZXJib3NlOiBib29sZWFuKSA9PiB7XG4gICAgaWYgKCFzY3JpcHRsZXRzRGF0YSB8fCAhc2NyaXB0bGV0c0RhdGEubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsb2dNZXNzYWdlKHZlcmJvc2UsIGBzY3JpcHRsZXRzIGxlbmd0aDogJHtzY3JpcHRsZXRzRGF0YS5sZW5ndGh9YCk7XG4gICAgY29uc3Qgc2NyaXB0bGV0RXhlY3V0YWJsZVNjcmlwdHMgPSBzY3JpcHRsZXRzRGF0YVxuICAgICAgICAubWFwKChzKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBwYXJhbSA9IEpTT04ucGFyc2Uocyk7XG4gICAgICAgICAgICBwYXJhbS5lbmdpbmUgPSAnc2FmYXJpLWV4dGVuc2lvbic7XG4gICAgICAgICAgICBpZiAodmVyYm9zZSkge1xuICAgICAgICAgICAgICAgIHBhcmFtLnZlcmJvc2UgPSB0cnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBjb2RlID0gc2NyaXB0bGV0cyAmJiBzY3JpcHRsZXRzLmludm9rZShwYXJhbSk7XG4gICAgICAgICAgICByZXR1cm4gY29kZSB8fCAnJztcbiAgICAgICAgfSk7XG5cbiAgICBjb25zb2xlLmxvZyhzY3JpcHRsZXRFeGVjdXRhYmxlU2NyaXB0cyk7XG4gICAgZXhlY3V0ZVNjcmlwdHMoc2NyaXB0bGV0RXhlY3V0YWJsZVNjcmlwdHMpO1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBjb25zb2xlLmxvZyh3aW5kb3cuYWRnKTtcbn07XG5cbi8qKlxuICogQXBwbGllcyBpbmplY3RlZCBzY3JpcHQgYW5kIGNzc1xuICpcbiAqIEBwYXJhbSBzZWxlY3RvcnNBbmRTY3JpcHRzXG4gKiBAcGFyYW0gdmVyYm9zZVxuICovXG5jb25zdCBhcHBseUFkdmFuY2VkQmxvY2tpbmdEYXRhID0gKHNlbGVjdG9yc0FuZFNjcmlwdHM6IFNlbGVjdG9yc0FuZFNjcmlwdHMsIHZlcmJvc2UgPSB0cnVlKSA9PiB7XG4gICAgbG9nTWVzc2FnZSh2ZXJib3NlLCAnQXBwbHlpbmcgc2NyaXB0cyBhbmQgY3NzLi4nKTtcbiAgICBsb2dNZXNzYWdlKHZlcmJvc2UsIGBGcmFtZSB1cmw6ICR7d2luZG93LmxvY2F0aW9uLmhyZWZ9YCk7XG5cbiAgICBhcHBseVNjcmlwdHMoc2VsZWN0b3JzQW5kU2NyaXB0cy5zY3JpcHRzLCB2ZXJib3NlKTtcbiAgICBhcHBseUNzcyhzZWxlY3RvcnNBbmRTY3JpcHRzLmNzc0luamVjdCwgdmVyYm9zZSk7XG4gICAgYXBwbHlFeHRlbmRlZENzcyhzZWxlY3RvcnNBbmRTY3JpcHRzLmNzc0V4dGVuZGVkLCB2ZXJib3NlKTtcbiAgICBhcHBseVNjcmlwdGxldHMoc2VsZWN0b3JzQW5kU2NyaXB0cy5zY3JpcHRsZXRzLCB2ZXJib3NlKTtcblxuICAgIGxvZ01lc3NhZ2UodmVyYm9zZSwgJ0FwcGx5aW5nIHNjcmlwdHMgYW5kIGNzcyAtIGRvbmUnKTtcbn07XG5cbmNvbnN0IGluaXQgPSBhc3luYyAoKSA9PiB7XG4gICAgaWYgKGRvY3VtZW50IGluc3RhbmNlb2YgSFRNTERvY3VtZW50KSB7XG4gICAgICAgIGlmICh3aW5kb3cubG9jYXRpb24uaHJlZiAmJiB3aW5kb3cubG9jYXRpb24uaHJlZi5pbmRleE9mKCdodHRwJykgPT09IDApIHtcbiAgICAgICAgICAgIGNvbnN0IHN0YXJ0R2V0dGluZ1NjcmlwdHMgPSBEYXRlLm5vdygpO1xuICAgICAgICAgICAgbGV0IHNlbGVjdG9yc0FuZFNjcmlwdHM7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHNlbGVjdG9yc0FuZFNjcmlwdHMgPSBhd2FpdCBnZXRTZWxlY3RvcnNBbmRTY3JpcHRzKCk7XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgVGltZSB0byBnZXQgc2VsZWN0b3JzIGFuZCBzY3JpcHRzIGZyb20gbmF0aXZlIHBhZ2UgdG8gY29udGVudCBzY3JpcHQ6ICR7RGF0ZS5ub3coKSAtIHN0YXJ0R2V0dGluZ1NjcmlwdHN9IG1zYCk7XG4gICAgICAgICAgICBpZiAoc2VsZWN0b3JzQW5kU2NyaXB0cykge1xuICAgICAgICAgICAgICAgIGFwcGx5QWR2YW5jZWRCbG9ja2luZ0RhdGEoc2VsZWN0b3JzQW5kU2NyaXB0cywgZmFsc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufTtcblxuZXhwb3J0IGNvbnN0IGNvbnRlbnQgPSB7XG4gICAgaW5pdCxcbn07XG4iLCIvKiEgZXh0ZW5kZWQtY3NzIC0gdjEuMy4xMiAtIE1vbiBNYXkgMzEgMjAyMVxuKiBodHRwczovL2dpdGh1Yi5jb20vQWRndWFyZFRlYW0vRXh0ZW5kZWRDc3NcbiogQ29weXJpZ2h0IChjKSAyMDIxIEFkR3VhcmQuIExpY2Vuc2VkIExHUEwtMy4wXG4qL1xuZnVuY3Rpb24gX3R5cGVvZihvYmopIHtcbiAgXCJAYmFiZWwvaGVscGVycyAtIHR5cGVvZlwiO1xuXG4gIGlmICh0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gXCJzeW1ib2xcIikge1xuICAgIF90eXBlb2YgPSBmdW5jdGlvbiAob2JqKSB7XG4gICAgICByZXR1cm4gdHlwZW9mIG9iajtcbiAgICB9O1xuICB9IGVsc2Uge1xuICAgIF90eXBlb2YgPSBmdW5jdGlvbiAob2JqKSB7XG4gICAgICByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyBcInN5bWJvbFwiIDogdHlwZW9mIG9iajtcbiAgICB9O1xuICB9XG5cbiAgcmV0dXJuIF90eXBlb2Yob2JqKTtcbn1cblxuZnVuY3Rpb24gX3NsaWNlZFRvQXJyYXkoYXJyLCBpKSB7XG4gIHJldHVybiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB8fCBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkoYXJyLCBpKSB8fCBfbm9uSXRlcmFibGVSZXN0KCk7XG59XG5cbmZ1bmN0aW9uIF90b0NvbnN1bWFibGVBcnJheShhcnIpIHtcbiAgcmV0dXJuIF9hcnJheVdpdGhvdXRIb2xlcyhhcnIpIHx8IF9pdGVyYWJsZVRvQXJyYXkoYXJyKSB8fCBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkoYXJyKSB8fCBfbm9uSXRlcmFibGVTcHJlYWQoKTtcbn1cblxuZnVuY3Rpb24gX2FycmF5V2l0aG91dEhvbGVzKGFycikge1xuICBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkoYXJyKTtcbn1cblxuZnVuY3Rpb24gX2FycmF5V2l0aEhvbGVzKGFycikge1xuICBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSByZXR1cm4gYXJyO1xufVxuXG5mdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5KGl0ZXIpIHtcbiAgaWYgKHR5cGVvZiBTeW1ib2wgIT09IFwidW5kZWZpbmVkXCIgJiYgU3ltYm9sLml0ZXJhdG9yIGluIE9iamVjdChpdGVyKSkgcmV0dXJuIEFycmF5LmZyb20oaXRlcik7XG59XG5cbmZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHtcbiAgaWYgKHR5cGVvZiBTeW1ib2wgPT09IFwidW5kZWZpbmVkXCIgfHwgIShTeW1ib2wuaXRlcmF0b3IgaW4gT2JqZWN0KGFycikpKSByZXR1cm47XG4gIHZhciBfYXJyID0gW107XG4gIHZhciBfbiA9IHRydWU7XG4gIHZhciBfZCA9IGZhbHNlO1xuICB2YXIgX2UgPSB1bmRlZmluZWQ7XG5cbiAgdHJ5IHtcbiAgICBmb3IgKHZhciBfaSA9IGFycltTeW1ib2wuaXRlcmF0b3JdKCksIF9zOyAhKF9uID0gKF9zID0gX2kubmV4dCgpKS5kb25lKTsgX24gPSB0cnVlKSB7XG4gICAgICBfYXJyLnB1c2goX3MudmFsdWUpO1xuXG4gICAgICBpZiAoaSAmJiBfYXJyLmxlbmd0aCA9PT0gaSkgYnJlYWs7XG4gICAgfVxuICB9IGNhdGNoIChlcnIpIHtcbiAgICBfZCA9IHRydWU7XG4gICAgX2UgPSBlcnI7XG4gIH0gZmluYWxseSB7XG4gICAgdHJ5IHtcbiAgICAgIGlmICghX24gJiYgX2lbXCJyZXR1cm5cIl0gIT0gbnVsbCkgX2lbXCJyZXR1cm5cIl0oKTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgaWYgKF9kKSB0aHJvdyBfZTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gX2Fycjtcbn1cblxuZnVuY3Rpb24gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8sIG1pbkxlbikge1xuICBpZiAoIW8pIHJldHVybjtcbiAgaWYgKHR5cGVvZiBvID09PSBcInN0cmluZ1wiKSByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTtcbiAgdmFyIG4gPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobykuc2xpY2UoOCwgLTEpO1xuICBpZiAobiA9PT0gXCJPYmplY3RcIiAmJiBvLmNvbnN0cnVjdG9yKSBuID0gby5jb25zdHJ1Y3Rvci5uYW1lO1xuICBpZiAobiA9PT0gXCJNYXBcIiB8fCBuID09PSBcIlNldFwiKSByZXR1cm4gQXJyYXkuZnJvbShvKTtcbiAgaWYgKG4gPT09IFwiQXJndW1lbnRzXCIgfHwgL14oPzpVaXxJKW50KD86OHwxNnwzMikoPzpDbGFtcGVkKT9BcnJheSQvLnRlc3QobikpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pO1xufVxuXG5mdW5jdGlvbiBfYXJyYXlMaWtlVG9BcnJheShhcnIsIGxlbikge1xuICBpZiAobGVuID09IG51bGwgfHwgbGVuID4gYXJyLmxlbmd0aCkgbGVuID0gYXJyLmxlbmd0aDtcblxuICBmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShsZW4pOyBpIDwgbGVuOyBpKyspIGFycjJbaV0gPSBhcnJbaV07XG5cbiAgcmV0dXJuIGFycjI7XG59XG5cbmZ1bmN0aW9uIF9ub25JdGVyYWJsZVNwcmVhZCgpIHtcbiAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkludmFsaWQgYXR0ZW1wdCB0byBzcHJlYWQgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxcbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC5cIik7XG59XG5cbmZ1bmN0aW9uIF9ub25JdGVyYWJsZVJlc3QoKSB7XG4gIHRocm93IG5ldyBUeXBlRXJyb3IoXCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxcbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC5cIik7XG59XG5cbi8qKlxuICogQ29weXJpZ2h0IDIwMTYgQWRndWFyZCBTb2Z0d2FyZSBMdGRcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG4vKiBlc2xpbnQtZGlzYWJsZSBuby1jb25zb2xlICovXG52YXIgdXRpbHMgPSB7fTtcbnV0aWxzLk11dGF0aW9uT2JzZXJ2ZXIgPSB3aW5kb3cuTXV0YXRpb25PYnNlcnZlciB8fCB3aW5kb3cuV2ViS2l0TXV0YXRpb25PYnNlcnZlcjtcbi8qKlxuICogU3RvcmVzIG5hdGl2ZSBOb2RlIHRleHRDb250ZW50IGdldHRlciB0byBiZSB1c2VkIGZvciBjb250YWlucyBwc2V1ZG8tY2xhc3NcbiAqIGJlY2F1c2UgZWxlbWVudHMnICd0ZXh0Q29udGVudCcgYW5kICdpbm5lclRleHQnIHByb3BlcnRpZXMgbWlnaHQgYmUgbW9ja2VkXG4gKiBodHRwczovL2dpdGh1Yi5jb20vQWRndWFyZFRlYW0vRXh0ZW5kZWRDc3MvaXNzdWVzLzEyN1xuICovXG5cbnV0aWxzLm5vZGVUZXh0Q29udGVudEdldHRlciA9IGZ1bmN0aW9uICgpIHtcbiAgdmFyIG5hdGl2ZU5vZGUgPSB3aW5kb3cuTm9kZSB8fCBOb2RlO1xuICByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihuYXRpdmVOb2RlLnByb3RvdHlwZSwgJ3RleHRDb250ZW50JykuZ2V0O1xufSgpO1xuXG51dGlscy5pc1NhZmFyaUJyb3dzZXIgPSBmdW5jdGlvbiAoKSB7XG4gIHZhciBpc0Nocm9tZSA9IG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignQ2hyb21lJykgPiAtMTtcbiAgdmFyIGlzU2FmYXJpID0gbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCdTYWZhcmknKSA+IC0xO1xuXG4gIGlmIChpc1NhZmFyaSkge1xuICAgIGlmIChpc0Nocm9tZSkge1xuICAgICAgLy8gQ2hyb21lIHNlZW1zIHRvIGhhdmUgYm90aCBDaHJvbWUgYW5kIFNhZmFyaSB1c2VyQWdlbnRzXG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICByZXR1cm4gZmFsc2U7XG59KCk7XG4vKipcbiAqIENvbnZlcnRzIHJlZ3VsYXIgZXhwcmVzc2lvbnMgcGFzc2VkIGFzIHBzZXVkbyBjbGFzcyBhcmd1bWVudHMgaW50byBSZWdFeHAgaW5zdGFuY2VzLlxuICogSGF2ZSB0byB1bmVzY2FwZSBkb3VibGVxdW90ZSBcIiBhcyB3ZWxsLCBiZWNhdXNlIHdlIGVzY2FwZSB0aGVtIHdoaWxlIGVuY2xvc2luZyBzdWNoXG4gKiBhcmd1bWVudHMgd2l0aCBkb3VibGVxdW90ZXMsIGFuZCBzaXp6bGUgZG9lcyBub3QgYXV0b21hdGljYWxseSB1bmVzY2FwZXMgdGhlbS5cbiAqL1xuXG5cbnV0aWxzLnBzZXVkb0FyZ1RvUmVnZXggPSBmdW5jdGlvbiAocmVnZXhTcmMsIGZsYWcpIHtcbiAgZmxhZyA9IGZsYWcgfHwgJ2knO1xuICByZWdleFNyYyA9IHJlZ2V4U3JjLnRyaW0oKS5yZXBsYWNlKC9cXFxcKFtcIlxcXFxdKS9nLCAnJDEnKTtcbiAgcmV0dXJuIG5ldyBSZWdFeHAocmVnZXhTcmMsIGZsYWcpO1xufTtcbi8qKlxuICogQ29udmVydHMgc3RyaW5nIHRvIHRoZSByZWdleHBcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHJcbiAqIEByZXR1cm5zIHtSZWdFeHB9XG4gKi9cblxuXG51dGlscy50b1JlZ0V4cCA9IGZ1bmN0aW9uIChzdHIpIHtcbiAgaWYgKHN0clswXSA9PT0gJy8nICYmIHN0cltzdHIubGVuZ3RoIC0gMV0gPT09ICcvJykge1xuICAgIHJldHVybiBuZXcgUmVnRXhwKHN0ci5zbGljZSgxLCAtMSkpO1xuICB9XG5cbiAgdmFyIGVzY2FwZWQgPSBzdHIucmVwbGFjZSgvWy4qKz9eJHt9KCl8W1xcXVxcXFxdL2csICdcXFxcJCYnKTtcbiAgcmV0dXJuIG5ldyBSZWdFeHAoZXNjYXBlZCk7XG59O1xuXG51dGlscy5zdGFydHNXaXRoID0gZnVuY3Rpb24gKHN0ciwgcHJlZml4KSB7XG4gIC8vIGlmIHN0ciA9PT0gJycsIChzdHIgJiYgZmFsc2UpIHdpbGwgcmV0dXJuICcnXG4gIC8vIHRoYXQncyB3aHkgaXQgaGFzIHRvIGJlICEhc3RyXG4gIHJldHVybiAhIXN0ciAmJiBzdHIuaW5kZXhPZihwcmVmaXgpID09PSAwO1xufTtcblxudXRpbHMuZW5kc1dpdGggPSBmdW5jdGlvbiAoc3RyLCBwb3N0Zml4KSB7XG4gIGlmICghc3RyIHx8ICFwb3N0Zml4KSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgaWYgKHN0ci5lbmRzV2l0aCkge1xuICAgIHJldHVybiBzdHIuZW5kc1dpdGgocG9zdGZpeCk7XG4gIH1cblxuICB2YXIgdCA9IFN0cmluZyhwb3N0Zml4KTtcbiAgdmFyIGluZGV4ID0gc3RyLmxhc3RJbmRleE9mKHQpO1xuICByZXR1cm4gaW5kZXggPj0gMCAmJiBpbmRleCA9PT0gc3RyLmxlbmd0aCAtIHQubGVuZ3RoO1xufTtcbi8qKlxuICogSGVscGVyIGZ1bmN0aW9uIGZvciBjcmVhdGluZyByZWd1bGFyIGV4cHJlc3Npb24gZnJvbSBhIHVybCBmaWx0ZXIgcnVsZSBzeW50YXguXG4gKi9cblxuXG51dGlscy5jcmVhdGVVUkxSZWdleCA9IGZ1bmN0aW9uICgpIHtcbiAgLy8gQ29uc3RhbnRzXG4gIHZhciByZWdleENvbmZpZ3VyYXRpb24gPSB7XG4gICAgbWFza1N0YXJ0VXJsOiAnfHwnLFxuICAgIG1hc2tQaXBlOiAnfCcsXG4gICAgbWFza1NlcGFyYXRvcjogJ14nLFxuICAgIG1hc2tBbnlTeW1ib2w6ICcqJyxcbiAgICByZWdleEFueVN5bWJvbDogJy4qJyxcbiAgICByZWdleFNlcGFyYXRvcjogJyhbXiBhLXpBLVowLTkuJV8tXXwkKScsXG4gICAgcmVnZXhTdGFydFVybDogJ14oaHR0cHxodHRwc3x3c3x3c3MpOi8vKFthLXowLTktXy5dK1xcXFwuKT8nLFxuICAgIHJlZ2V4U3RhcnRTdHJpbmc6ICdeJyxcbiAgICByZWdleEVuZFN0cmluZzogJyQnXG4gIH07IC8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL3JlZ2V4cFxuICAvLyBzaG91bGQgYmUgZXNjYXBlZCAuICogKyA/IF4gJCB7IH0gKCApIHwgWyBdIC8gXFxcbiAgLy8gZXhjZXB0IG9mICogfCBeXG5cbiAgdmFyIHNwZWNpYWxzID0gWycuJywgJysnLCAnPycsICckJywgJ3snLCAnfScsICcoJywgJyknLCAnWycsICddJywgJ1xcXFwnLCAnLyddO1xuICB2YXIgc3BlY2lhbHNSZWdleCA9IG5ldyBSZWdFeHAoXCJbXCIuY29uY2F0KHNwZWNpYWxzLmpvaW4oJ1xcXFwnKSwgXCJdXCIpLCAnZycpO1xuICAvKipcbiAgICogRXNjYXBlcyByZWd1bGFyIGV4cHJlc3Npb24gc3RyaW5nXG4gICAqL1xuXG4gIHZhciBlc2NhcGVSZWdFeHAgPSBmdW5jdGlvbiBlc2NhcGVSZWdFeHAoc3RyKSB7XG4gICAgcmV0dXJuIHN0ci5yZXBsYWNlKHNwZWNpYWxzUmVnZXgsICdcXFxcJCYnKTtcbiAgfTtcblxuICB2YXIgcmVwbGFjZUFsbCA9IGZ1bmN0aW9uIHJlcGxhY2VBbGwoc3RyLCBmaW5kLCByZXBsYWNlKSB7XG4gICAgaWYgKCFzdHIpIHtcbiAgICAgIHJldHVybiBzdHI7XG4gICAgfVxuXG4gICAgcmV0dXJuIHN0ci5zcGxpdChmaW5kKS5qb2luKHJlcGxhY2UpO1xuICB9O1xuICAvKipcbiAgICogTWFpbiBmdW5jdGlvbiB0aGF0IGNvbnZlcnRzIGEgdXJsIGZpbHRlciBydWxlIHN0cmluZyB0byBhIHJlZ2V4LlxuICAgKiBAcGFyYW0ge3N0cmluZ30gc3RyXG4gICAqIEByZXR1cm4ge1JlZ0V4cH1cbiAgICovXG5cblxuICB2YXIgY3JlYXRlUmVnZXhUZXh0ID0gZnVuY3Rpb24gY3JlYXRlUmVnZXhUZXh0KHN0cikge1xuICAgIHZhciByZWdleCA9IGVzY2FwZVJlZ0V4cChzdHIpO1xuXG4gICAgaWYgKHV0aWxzLnN0YXJ0c1dpdGgocmVnZXgsIHJlZ2V4Q29uZmlndXJhdGlvbi5tYXNrU3RhcnRVcmwpKSB7XG4gICAgICByZWdleCA9IHJlZ2V4LnN1YnN0cmluZygwLCByZWdleENvbmZpZ3VyYXRpb24ubWFza1N0YXJ0VXJsLmxlbmd0aCkgKyByZXBsYWNlQWxsKHJlZ2V4LnN1YnN0cmluZyhyZWdleENvbmZpZ3VyYXRpb24ubWFza1N0YXJ0VXJsLmxlbmd0aCwgcmVnZXgubGVuZ3RoIC0gMSksICdcXHwnLCAnXFxcXHwnKSArIHJlZ2V4LnN1YnN0cmluZyhyZWdleC5sZW5ndGggLSAxKTtcbiAgICB9IGVsc2UgaWYgKHV0aWxzLnN0YXJ0c1dpdGgocmVnZXgsIHJlZ2V4Q29uZmlndXJhdGlvbi5tYXNrUGlwZSkpIHtcbiAgICAgIHJlZ2V4ID0gcmVnZXguc3Vic3RyaW5nKDAsIHJlZ2V4Q29uZmlndXJhdGlvbi5tYXNrUGlwZS5sZW5ndGgpICsgcmVwbGFjZUFsbChyZWdleC5zdWJzdHJpbmcocmVnZXhDb25maWd1cmF0aW9uLm1hc2tQaXBlLmxlbmd0aCwgcmVnZXgubGVuZ3RoIC0gMSksICdcXHwnLCAnXFxcXHwnKSArIHJlZ2V4LnN1YnN0cmluZyhyZWdleC5sZW5ndGggLSAxKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVnZXggPSByZXBsYWNlQWxsKHJlZ2V4LnN1YnN0cmluZygwLCByZWdleC5sZW5ndGggLSAxKSwgJ1xcfCcsICdcXFxcfCcpICsgcmVnZXguc3Vic3RyaW5nKHJlZ2V4Lmxlbmd0aCAtIDEpO1xuICAgIH0gLy8gUmVwbGFjaW5nIHNwZWNpYWwgdXJsIG1hc2tzXG5cblxuICAgIHJlZ2V4ID0gcmVwbGFjZUFsbChyZWdleCwgcmVnZXhDb25maWd1cmF0aW9uLm1hc2tBbnlTeW1ib2wsIHJlZ2V4Q29uZmlndXJhdGlvbi5yZWdleEFueVN5bWJvbCk7XG4gICAgcmVnZXggPSByZXBsYWNlQWxsKHJlZ2V4LCByZWdleENvbmZpZ3VyYXRpb24ubWFza1NlcGFyYXRvciwgcmVnZXhDb25maWd1cmF0aW9uLnJlZ2V4U2VwYXJhdG9yKTtcblxuICAgIGlmICh1dGlscy5zdGFydHNXaXRoKHJlZ2V4LCByZWdleENvbmZpZ3VyYXRpb24ubWFza1N0YXJ0VXJsKSkge1xuICAgICAgcmVnZXggPSByZWdleENvbmZpZ3VyYXRpb24ucmVnZXhTdGFydFVybCArIHJlZ2V4LnN1YnN0cmluZyhyZWdleENvbmZpZ3VyYXRpb24ubWFza1N0YXJ0VXJsLmxlbmd0aCk7XG4gICAgfSBlbHNlIGlmICh1dGlscy5zdGFydHNXaXRoKHJlZ2V4LCByZWdleENvbmZpZ3VyYXRpb24ubWFza1BpcGUpKSB7XG4gICAgICByZWdleCA9IHJlZ2V4Q29uZmlndXJhdGlvbi5yZWdleFN0YXJ0U3RyaW5nICsgcmVnZXguc3Vic3RyaW5nKHJlZ2V4Q29uZmlndXJhdGlvbi5tYXNrUGlwZS5sZW5ndGgpO1xuICAgIH1cblxuICAgIGlmICh1dGlscy5lbmRzV2l0aChyZWdleCwgcmVnZXhDb25maWd1cmF0aW9uLm1hc2tQaXBlKSkge1xuICAgICAgcmVnZXggPSByZWdleC5zdWJzdHJpbmcoMCwgcmVnZXgubGVuZ3RoIC0gMSkgKyByZWdleENvbmZpZ3VyYXRpb24ucmVnZXhFbmRTdHJpbmc7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5ldyBSZWdFeHAocmVnZXgsICdpJyk7XG4gIH07XG5cbiAgcmV0dXJuIGNyZWF0ZVJlZ2V4VGV4dDtcbn0oKTtcbi8qKlxuICogQ3JlYXRlcyBhbiBvYmplY3QgaW1wbGVtZW50aW5nIExvY2F0aW9uIGludGVyZmFjZSBmcm9tIGEgdXJsLlxuICogQW4gYWx0ZXJuYXRpdmUgdG8gVVJMLlxuICogaHR0cHM6Ly9naXRodWIuY29tL0FkZ3VhcmRUZWFtL0ZpbmdlcnByaW50aW5nQmxvY2tlci9ibG9iL21hc3Rlci9zcmMvc2hhcmVkL3VybC50cyNMNjRcbiAqL1xuXG5cbnV0aWxzLmNyZWF0ZUxvY2F0aW9uID0gZnVuY3Rpb24gKGhyZWYpIHtcbiAgdmFyIGFuY2hvciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcbiAgYW5jaG9yLmhyZWYgPSBocmVmO1xuXG4gIGlmIChhbmNob3IuaG9zdCA9PT0gJycpIHtcbiAgICBhbmNob3IuaHJlZiA9IGFuY2hvci5ocmVmOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXNlbGYtYXNzaWduXG4gIH1cblxuICByZXR1cm4gYW5jaG9yO1xufTtcbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgQSBoYXMgdGhlIHNhbWUgb3JpZ2luIGFzIEIuXG4gKiBAcGFyYW0ge3N0cmluZ30gdXJsQSBsb2NhdGlvbi5ocmVmIG9mIEEuXG4gKiBAcGFyYW0ge0xvY2F0aW9ufSBsb2NhdGlvbkIgbG9jYXRpb24gb2YgQi5cbiAqIEBwYXJhbSB7c3RyaW5nfSBkb21haW5CIGRvY3VtZW50LmRvbWFpbiBvZiBCLlxuICogQHJldHVybiB7Ym9vbGVhbn1cbiAqL1xuXG5cbnV0aWxzLmlzU2FtZU9yaWdpbiA9IGZ1bmN0aW9uICh1cmxBLCBsb2NhdGlvbkIsIGRvbWFpbkIpIHtcbiAgdmFyIGxvY2F0aW9uQSA9IHV0aWxzLmNyZWF0ZUxvY2F0aW9uKHVybEEpOyAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tc2NyaXB0LXVybFxuXG4gIGlmIChsb2NhdGlvbkEucHJvdG9jb2wgPT09ICdqYXZhc2NyaXB0OicgfHwgbG9jYXRpb25BLmhyZWYgPT09ICdhYm91dDpibGFuaycpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIGlmIChsb2NhdGlvbkEucHJvdG9jb2wgPT09ICdkYXRhOicgfHwgbG9jYXRpb25BLnByb3RvY29sID09PSAnZmlsZTonKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgcmV0dXJuIGxvY2F0aW9uQS5ob3N0bmFtZSA9PT0gZG9tYWluQiAmJiBsb2NhdGlvbkEucG9ydCA9PT0gbG9jYXRpb25CLnBvcnQgJiYgbG9jYXRpb25BLnByb3RvY29sID09PSBsb2NhdGlvbkIucHJvdG9jb2w7XG59O1xuLyoqXG4gKiBBIGhlbHBlciBjbGFzcyB0byB0aHJvdHRsZSBmdW5jdGlvbiBjYWxscyB3aXRoIHNldFRpbWVvdXQgYW5kIHJlcXVlc3RBbmltYXRpb25GcmFtZS5cbiAqL1xuXG5cbnV0aWxzLkFzeW5jV3JhcHBlciA9IGZ1bmN0aW9uICgpIHtcbiAgLyoqXG4gICAqIFBoYW50b21KUyBwYXNzZXMgYSB3cm9uZyB0aW1lc3RhbXAgdG8gdGhlIHJlcXVlc3RBbmltYXRpb25GcmFtZSBjYWxsYmFjayBhbmQgdGhhdCBicmVha3MgdGhlIEFzeW5jV3JhcHBlciBsb2dpY1xuICAgKiBodHRwczovL2dpdGh1Yi5jb20vYXJpeWEvcGhhbnRvbWpzL2lzc3Vlcy8xNDgzMlxuICAgKi9cbiAgdmFyIHN1cHBvcnRlZCA9IHR5cGVvZiB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lICE9PSAndW5kZWZpbmVkJyAmJiAhL3BoYW50b20vaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpO1xuICB2YXIgckFGID0gc3VwcG9ydGVkID8gcmVxdWVzdEFuaW1hdGlvbkZyYW1lIDogc2V0VGltZW91dDtcbiAgdmFyIGNBRiA9IHN1cHBvcnRlZCA/IGNhbmNlbEFuaW1hdGlvbkZyYW1lIDogY2xlYXJUaW1lb3V0O1xuICB2YXIgcGVyZiA9IHN1cHBvcnRlZCA/IHBlcmZvcm1hbmNlIDogRGF0ZTtcbiAgLyoqXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrXG4gICAqIEBwYXJhbSB7bnVtYmVyfSB0aHJvdHRsZSBudW1iZXIsIHRoZSBwcm92aWRlZCBjYWxsYmFjayBzaG91bGQgYmUgZXhlY3V0ZWQgdHdpY2VcbiAgICogaW4gdGhpcyB0aW1lIGZyYW1lLlxuICAgKiBAY29uc3RydWN0b3JcbiAgICovXG5cbiAgZnVuY3Rpb24gQXN5bmNXcmFwcGVyKGNhbGxiYWNrLCB0aHJvdHRsZSkge1xuICAgIHRoaXMuY2FsbGJhY2sgPSBjYWxsYmFjaztcbiAgICB0aGlzLnRocm90dGxlID0gdGhyb3R0bGU7XG4gICAgdGhpcy53cmFwcGVkQ2FsbGJhY2sgPSB0aGlzLndyYXBwZWRDYWxsYmFjay5iaW5kKHRoaXMpO1xuXG4gICAgaWYgKHRoaXMud3JhcHBlZEFzYXBDYWxsYmFjaykge1xuICAgICAgdGhpcy53cmFwcGVkQXNhcENhbGxiYWNrID0gdGhpcy53cmFwcGVkQXNhcENhbGxiYWNrLmJpbmQodGhpcyk7XG4gICAgfVxuICB9XG4gIC8qKiBAcHJpdmF0ZSAqL1xuXG5cbiAgQXN5bmNXcmFwcGVyLnByb3RvdHlwZS53cmFwcGVkQ2FsbGJhY2sgPSBmdW5jdGlvbiAodHMpIHtcbiAgICB0aGlzLmxhc3RSdW4gPSBpc051bWJlcih0cykgPyB0cyA6IHBlcmYubm93KCk7XG4gICAgZGVsZXRlIHRoaXMuckFGaWQ7XG4gICAgZGVsZXRlIHRoaXMudGltZXJJZDtcbiAgICBkZWxldGUgdGhpcy5hc2FwU2NoZWR1bGVkO1xuICAgIHRoaXMuY2FsbGJhY2soKTtcbiAgfTtcbiAgLyoqIEBwcml2YXRlIEluZGljYXRlcyB3aGV0aGVyIHRoZXJlIGlzIGEgc2NoZWR1bGVkIGNhbGxiYWNrLiAqL1xuXG5cbiAgQXN5bmNXcmFwcGVyLnByb3RvdHlwZS5oYXNQZW5kaW5nQ2FsbGJhY2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGlzTnVtYmVyKHRoaXMuckFGaWQpIHx8IGlzTnVtYmVyKHRoaXMudGltZXJJZCk7XG4gIH07XG4gIC8qKlxuICAgKiBTY2hlZHVsZXMgYSBmdW5jdGlvbiBjYWxsIGJlZm9yZSB0aGUgbmV4dCBhbmltYXRpb24gZnJhbWUuXG4gICAqL1xuXG5cbiAgQXN5bmNXcmFwcGVyLnByb3RvdHlwZS5ydW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKHRoaXMuaGFzUGVuZGluZ0NhbGxiYWNrKCkpIHtcbiAgICAgIC8vIFRoZXJlIGlzIGEgcGVuZGluZyBleGVjdXRpb24gc2NoZWR1bGVkLlxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2YgdGhpcy5sYXN0UnVuICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgdmFyIGVsYXBzZWQgPSBwZXJmLm5vdygpIC0gdGhpcy5sYXN0UnVuO1xuXG4gICAgICBpZiAoZWxhcHNlZCA8IHRoaXMudGhyb3R0bGUpIHtcbiAgICAgICAgdGhpcy50aW1lcklkID0gc2V0VGltZW91dCh0aGlzLndyYXBwZWRDYWxsYmFjaywgdGhpcy50aHJvdHRsZSAtIGVsYXBzZWQpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5yQUZpZCA9IHJBRih0aGlzLndyYXBwZWRDYWxsYmFjayk7XG4gIH07XG4gIC8qKlxuICAgKiBTY2hlZHVsZXMgYSBmdW5jdGlvbiBjYWxsIGluIHRoZSBtb3N0IGltbWVuZW50IG1pY3JvdGFzay5cbiAgICogVGhpcyBjYW5ub3QgYmUgY2FuY2VsZWQuXG4gICAqL1xuXG5cbiAgQXN5bmNXcmFwcGVyLnByb3RvdHlwZS5ydW5Bc2FwID0gZnVuY3Rpb24gKCkge1xuICAgIGlmICh0aGlzLmFzYXBTY2hlZHVsZWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmFzYXBTY2hlZHVsZWQgPSB0cnVlO1xuICAgIGNBRih0aGlzLnJBRmlkKTtcbiAgICBjbGVhclRpbWVvdXQodGhpcy50aW1lcklkKTtcblxuICAgIGlmICh1dGlscy5NdXRhdGlvbk9ic2VydmVyKSB7XG4gICAgICAvKipcbiAgICAgICAqIFVzaW5nIE11dGF0aW9uT2JzZXJ2ZXJzIHRvIGFjY2VzcyBtaWNyb3Rhc2sgcXVldWUgaXMgYSBzdGFuZGFyZCB0ZWNobmlxdWUsXG4gICAgICAgKiB1c2VkIGluIEFTQVAgbGlicmFyeVxuICAgICAgICoge0BsaW5rIGh0dHBzOi8vZ2l0aHViLmNvbS9rcmlza293YWwvYXNhcC9ibG9iL21hc3Rlci9icm93c2VyLXJhdy5qcyNMMTQwfVxuICAgICAgICovXG4gICAgICBpZiAoIXRoaXMubW8pIHtcbiAgICAgICAgdGhpcy5tbyA9IG5ldyB1dGlscy5NdXRhdGlvbk9ic2VydmVyKHRoaXMud3JhcHBlZENhbGxiYWNrKTtcbiAgICAgICAgdGhpcy5ub2RlID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoMSk7XG4gICAgICAgIHRoaXMubW8ub2JzZXJ2ZSh0aGlzLm5vZGUsIHtcbiAgICAgICAgICBjaGFyYWN0ZXJEYXRhOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICB0aGlzLm5vZGUubm9kZVZhbHVlID0gLXRoaXMubm9kZS5ub2RlVmFsdWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNldFRpbWVvdXQodGhpcy53cmFwcGVkQ2FsbGJhY2spO1xuICAgIH1cbiAgfTtcbiAgLyoqXG4gICAqIFJ1bnMgc2NoZWR1bGVkIGV4ZWN1dGlvbiBpbW1lZGlhdGVseSwgaWYgdGhlcmUgd2VyZSBhbnkuXG4gICAqL1xuXG5cbiAgQXN5bmNXcmFwcGVyLnByb3RvdHlwZS5ydW5JbW1lZGlhdGVseSA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAodGhpcy5oYXNQZW5kaW5nQ2FsbGJhY2soKSkge1xuICAgICAgY0FGKHRoaXMuckFGaWQpO1xuICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudGltZXJJZCk7XG4gICAgICBkZWxldGUgdGhpcy5yQUZpZDtcbiAgICAgIGRlbGV0ZSB0aGlzLnRpbWVySWQ7XG4gICAgICB0aGlzLndyYXBwZWRDYWxsYmFjaygpO1xuICAgIH1cbiAgfTtcblxuICBBc3luY1dyYXBwZXIubm93ID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBwZXJmLm5vdygpO1xuICB9O1xuXG4gIHJldHVybiBBc3luY1dyYXBwZXI7XG59KCk7XG4vKipcbiAqIFN0b3JlcyBuYXRpdmUgT2RQIHRvIGJlIHVzZWQgaW4gV2Vha01hcCBhbmQgU2V0IHBvbHlmaWxscy5cbiAqL1xuXG5cbnV0aWxzLmRlZmluZVByb3BlcnR5ID0gT2JqZWN0LmRlZmluZVByb3BlcnR5O1xudXRpbHMuV2Vha01hcCA9IHR5cGVvZiBXZWFrTWFwICE9PSAndW5kZWZpbmVkJyA/IFdlYWtNYXAgOiBmdW5jdGlvbiAoKSB7XG4gIC8qKiBPcmlnaW5hbGx5IGJhc2VkIG9uIHtAbGluayBodHRwczovL2dpdGh1Yi5jb20vUG9seW1lci9XZWFrTWFwfSAqL1xuICB2YXIgY291bnRlciA9IERhdGUubm93KCkgJSAxZTk7XG5cbiAgdmFyIFdlYWtNYXAgPSBmdW5jdGlvbiBXZWFrTWFwKCkge1xuICAgIHRoaXMubmFtZSA9IFwiX19zdFwiLmNvbmNhdChNYXRoLnJhbmRvbSgpICogMWU5ID4+PiAwKS5jb25jYXQoY291bnRlcisrLCBcIl9fXCIpO1xuICB9O1xuXG4gIFdlYWtNYXAucHJvdG90eXBlID0ge1xuICAgIHNldDogZnVuY3Rpb24gc2V0KGtleSwgdmFsdWUpIHtcbiAgICAgIHZhciBlbnRyeSA9IGtleVt0aGlzLm5hbWVdO1xuXG4gICAgICBpZiAoZW50cnkgJiYgZW50cnlbMF0gPT09IGtleSkge1xuICAgICAgICBlbnRyeVsxXSA9IHZhbHVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdXRpbHMuZGVmaW5lUHJvcGVydHkoa2V5LCB0aGlzLm5hbWUsIHtcbiAgICAgICAgICB2YWx1ZTogW2tleSwgdmFsdWVdLFxuICAgICAgICAgIHdyaXRhYmxlOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuICAgIGdldDogZnVuY3Rpb24gZ2V0KGtleSkge1xuICAgICAgdmFyIGVudHJ5ID0ga2V5W3RoaXMubmFtZV07XG4gICAgICByZXR1cm4gZW50cnkgJiYgZW50cnlbMF0gPT09IGtleSA/IGVudHJ5WzFdIDogdW5kZWZpbmVkO1xuICAgIH0sXG4gICAgZGVsZXRlOiBmdW5jdGlvbiBfZGVsZXRlKGtleSkge1xuICAgICAgdmFyIGVudHJ5ID0ga2V5W3RoaXMubmFtZV07XG5cbiAgICAgIGlmICghZW50cnkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuXG4gICAgICB2YXIgaGFzVmFsdWUgPSBlbnRyeVswXSA9PT0ga2V5O1xuICAgICAgZGVsZXRlIGVudHJ5WzBdO1xuICAgICAgZGVsZXRlIGVudHJ5WzFdO1xuICAgICAgcmV0dXJuIGhhc1ZhbHVlO1xuICAgIH0sXG4gICAgaGFzOiBmdW5jdGlvbiBoYXMoa2V5KSB7XG4gICAgICB2YXIgZW50cnkgPSBrZXlbdGhpcy5uYW1lXTtcblxuICAgICAgaWYgKCFlbnRyeSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBlbnRyeVswXSA9PT0ga2V5O1xuICAgIH1cbiAgfTtcbiAgcmV0dXJuIFdlYWtNYXA7XG59KCk7XG51dGlscy5TZXQgPSB0eXBlb2YgU2V0ICE9PSAndW5kZWZpbmVkJyA/IFNldCA6IGZ1bmN0aW9uICgpIHtcbiAgdmFyIGNvdW50ZXIgPSBEYXRlLm5vdygpICUgMWU5O1xuICAvKipcbiAgICogQSBwb2x5ZmlsbCB3aGljaCBjb3ZlcnMgb25seSB0aGUgYmFzaWMgdXNhZ2UuXG4gICAqIE9ubHkgc3VwcG9ydHMgbWV0aG9kcyB0aGF0IGFyZSBzdXBwb3J0ZWQgaW4gSUUxMS5cbiAgICoge0BsaW5rIGh0dHBzOi8vZG9jcy5taWNyb3NvZnQuY29tL2VuLXVzL3NjcmlwdGluZy9qYXZhc2NyaXB0L3JlZmVyZW5jZS9zZXQtb2JqZWN0LWphdmFzY3JpcHR9XG4gICAqIEFzc3VtZXMgdGhhdCAna2V5J3MgYXJlIGFsbCBvYmplY3RzLCBub3QgcHJpbWl0aXZlcyBzdWNoIGFzIGEgbnVtYmVyLlxuICAgKlxuICAgKiBAcGFyYW0ge0FycmF5fSBpdGVtcyBJbml0aWFsIGl0ZW1zIGluIHRoaXMgc2V0XG4gICAqL1xuXG4gIHZhciBTZXQgPSBmdW5jdGlvbiBTZXQoaXRlbXMpIHtcbiAgICB0aGlzLm5hbWUgPSBcIl9fc3RcIi5jb25jYXQoTWF0aC5yYW5kb20oKSAqIDFlOSA+Pj4gMCkuY29uY2F0KGNvdW50ZXIrKywgXCJfX1wiKTtcbiAgICB0aGlzLmtleXMgPSBbXTtcblxuICAgIGlmIChpdGVtcyAmJiBpdGVtcy5sZW5ndGgpIHtcbiAgICAgIHZhciBpSXRlbXMgPSBpdGVtcy5sZW5ndGg7XG5cbiAgICAgIHdoaWxlIChpSXRlbXMtLSkge1xuICAgICAgICB0aGlzLmFkZChpdGVtc1tpSXRlbXNdKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgU2V0LnByb3RvdHlwZSA9IHtcbiAgICBhZGQ6IGZ1bmN0aW9uIGFkZChrZXkpIHtcbiAgICAgIGlmICghaXNOdW1iZXIoa2V5W3RoaXMubmFtZV0pKSB7XG4gICAgICAgIHZhciBpbmRleCA9IHRoaXMua2V5cy5wdXNoKGtleSkgLSAxO1xuICAgICAgICB1dGlscy5kZWZpbmVQcm9wZXJ0eShrZXksIHRoaXMubmFtZSwge1xuICAgICAgICAgIHZhbHVlOiBpbmRleCxcbiAgICAgICAgICB3cml0YWJsZTogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGRlbGV0ZTogZnVuY3Rpb24gX2RlbGV0ZShrZXkpIHtcbiAgICAgIGlmIChpc051bWJlcihrZXlbdGhpcy5uYW1lXSkpIHtcbiAgICAgICAgdmFyIGluZGV4ID0ga2V5W3RoaXMubmFtZV07XG4gICAgICAgIGRlbGV0ZSB0aGlzLmtleXNbaW5kZXhdO1xuICAgICAgICBrZXlbdGhpcy5uYW1lXSA9IHVuZGVmaW5lZDtcbiAgICAgIH1cbiAgICB9LFxuICAgIGhhczogZnVuY3Rpb24gaGFzKGtleSkge1xuICAgICAgcmV0dXJuIGlzTnVtYmVyKGtleVt0aGlzLm5hbWVdKTtcbiAgICB9LFxuICAgIGNsZWFyOiBmdW5jdGlvbiBjbGVhcigpIHtcbiAgICAgIHRoaXMua2V5cy5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAga2V5W3RoaXMubmFtZV0gPSB1bmRlZmluZWQ7XG4gICAgICB9KTtcbiAgICAgIHRoaXMua2V5cy5sZW5ndGggPSAwO1xuICAgIH0sXG4gICAgZm9yRWFjaDogZnVuY3Rpb24gZm9yRWFjaChjYikge1xuICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgdGhpcy5rZXlzLmZvckVhY2goZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgIGNiKHZhbHVlLCB2YWx1ZSwgdGhhdCk7XG4gICAgICB9KTtcbiAgICB9XG4gIH07XG4gIHV0aWxzLmRlZmluZVByb3BlcnR5KFNldC5wcm90b3R5cGUsICdzaXplJywge1xuICAgIGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgLy8gU2tpcHMgaG9sZXMuXG4gICAgICByZXR1cm4gdGhpcy5rZXlzLnJlZHVjZShmdW5jdGlvbiAoYWNjKSB7XG4gICAgICAgIHJldHVybiBhY2MgKyAxO1xuICAgICAgfSwgMCk7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIFNldDtcbn0oKTtcbi8qKlxuICogVmVuZG9yLXNwZWNpZmljIEVsZW1lbnQucHJvdG90eXBlLm1hdGNoZXNcbiAqL1xuXG51dGlscy5tYXRjaGVzUHJvcGVydHlOYW1lID0gZnVuY3Rpb24gKCkge1xuICB2YXIgcHJvcHMgPSBbJ21hdGNoZXMnLCAnbWF0Y2hlc1NlbGVjdG9yJywgJ21vek1hdGNoZXNTZWxlY3RvcicsICdtc01hdGNoZXNTZWxlY3RvcicsICdvTWF0Y2hlc1NlbGVjdG9yJywgJ3dlYmtpdE1hdGNoZXNTZWxlY3RvciddO1xuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgNjsgaSsrKSB7XG4gICAgaWYgKEVsZW1lbnQucHJvdG90eXBlLmhhc093blByb3BlcnR5KHByb3BzW2ldKSkge1xuICAgICAgcmV0dXJuIHByb3BzW2ldO1xuICAgIH1cbiAgfVxufSgpO1xuLyoqXG4gKiBQcm92aWRlcyBzdGF0cyBpbmZvcm1hdGlvblxuICovXG5cblxudXRpbHMuU3RhdHMgPSBmdW5jdGlvbiAoKSB7XG4gIC8qKiBAbWVtYmVyIHtBcnJheTxudW1iZXI+fSAqL1xuICB0aGlzLmFycmF5ID0gW107XG4gIC8qKiBAbWVtYmVyIHtudW1iZXJ9ICovXG5cbiAgdGhpcy5sZW5ndGggPSAwO1xuICB2YXIgemVyb0Rlc2NyaXB0b3IgPSB7XG4gICAgdmFsdWU6IDAsXG4gICAgd3JpdGFibGU6IHRydWVcbiAgfTtcbiAgLyoqIEBtZW1iZXIge251bWJlcn0gQHByaXZhdGUgKi9cblxuICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgJ3N1bScsIHplcm9EZXNjcmlwdG9yKTtcbiAgLyoqIEBtZW1iZXIge251bWJlcn0gQHByaXZhdGUgKi9cblxuICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgJ3NxdWFyZWRTdW0nLCB6ZXJvRGVzY3JpcHRvcik7XG59O1xuLyoqXG4gKiBAcGFyYW0ge251bWJlcn0gZGF0YVBvaW50IGRhdGEgcG9pbnRcbiAqL1xuXG5cbnV0aWxzLlN0YXRzLnByb3RvdHlwZS5wdXNoID0gZnVuY3Rpb24gKGRhdGFQb2ludCkge1xuICB0aGlzLmFycmF5LnB1c2goZGF0YVBvaW50KTtcbiAgdGhpcy5sZW5ndGgrKztcbiAgdGhpcy5zdW0gKz0gZGF0YVBvaW50O1xuICB0aGlzLnNxdWFyZWRTdW0gKz0gZGF0YVBvaW50ICogZGF0YVBvaW50O1xuICAvKiogQG1lbWJlciB7bnVtYmVyfSAqL1xuXG4gIHRoaXMubWVhbiA9IHRoaXMuc3VtIC8gdGhpcy5sZW5ndGg7XG4gIC8qKiBAbWVtYmVyIHtudW1iZXJ9ICovXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1yZXN0cmljdGVkLXByb3BlcnRpZXNcblxuICB0aGlzLnN0ZGRldiA9IE1hdGguc3FydCh0aGlzLnNxdWFyZWRTdW0gLyB0aGlzLmxlbmd0aCAtIE1hdGgucG93KHRoaXMubWVhbiwgMikpO1xufTtcbi8qKiBTYWZlIGNvbnNvbGUuZXJyb3IgdmVyc2lvbiAqL1xuXG5cbnV0aWxzLmxvZ0Vycm9yID0gdHlwZW9mIGNvbnNvbGUgIT09ICd1bmRlZmluZWQnICYmIGNvbnNvbGUuZXJyb3IgJiYgRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQgJiYgY29uc29sZS5lcnJvci5iaW5kID8gY29uc29sZS5lcnJvci5iaW5kKHdpbmRvdy5jb25zb2xlKSA6IGNvbnNvbGUuZXJyb3I7XG4vKiogU2FmZSBjb25zb2xlLmluZm8gdmVyc2lvbiAqL1xuXG51dGlscy5sb2dJbmZvID0gdHlwZW9mIGNvbnNvbGUgIT09ICd1bmRlZmluZWQnICYmIGNvbnNvbGUuaW5mbyAmJiBGdW5jdGlvbi5wcm90b3R5cGUuYmluZCAmJiBjb25zb2xlLmluZm8uYmluZCA/IGNvbnNvbGUuaW5mby5iaW5kKHdpbmRvdy5jb25zb2xlKSA6IGNvbnNvbGUuaW5mbztcblxuZnVuY3Rpb24gaXNOdW1iZXIob2JqKSB7XG4gIHJldHVybiB0eXBlb2Ygb2JqID09PSAnbnVtYmVyJztcbn1cbi8qKlxuICogUmV0dXJucyBwYXRoIHRvIGVsZW1lbnQgd2Ugd2lsbCB1c2UgYXMgZWxlbWVudCBpZGVudGlmaWVyXG4gKiBAcGFyYW0ge0VsZW1lbnR9IGlucHV0RWxcbiAqIEByZXR1cm5zIHtzdHJpbmd9IC0gcGF0aCB0byB0aGUgZWxlbWVudFxuICovXG5cblxudXRpbHMuZ2V0Tm9kZVNlbGVjdG9yID0gZnVuY3Rpb24gKGlucHV0RWwpIHtcbiAgaWYgKCEoaW5wdXRFbCBpbnN0YW5jZW9mIEVsZW1lbnQpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdGdW5jdGlvbiByZWNlaXZlZCBhcmd1bWVudCB3aXRoIHdyb25nIHR5cGUnKTtcbiAgfVxuXG4gIHZhciBlbCA9IGlucHV0RWw7XG4gIHZhciBwYXRoID0gW107IC8vIHdlIG5lZWQgdG8gY2hlY2sgJyEhZWwnIGZpcnN0IGJlY2F1c2UgaXQgaXMgcG9zc2libGVcbiAgLy8gdGhhdCBzb21lIGFuY2VzdG9yIG9mIHRoZSBpbnB1dEVsIHdhcyByZW1vdmVkIGJlZm9yZSBpdFxuXG4gIHdoaWxlICghIWVsICYmIGVsLm5vZGVUeXBlID09PSBOb2RlLkVMRU1FTlRfTk9ERSkge1xuICAgIHZhciBzZWxlY3RvciA9IGVsLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7XG5cbiAgICBpZiAoZWwuaWQgJiYgdHlwZW9mIGVsLmlkID09PSAnc3RyaW5nJykge1xuICAgICAgc2VsZWN0b3IgKz0gXCIjXCIuY29uY2F0KGVsLmlkKTtcbiAgICAgIHBhdGgudW5zaGlmdChzZWxlY3Rvcik7XG4gICAgICBicmVhaztcbiAgICB9IGVsc2Uge1xuICAgICAgdmFyIHNpYmxpbmcgPSBlbDtcbiAgICAgIHZhciBudGggPSAxO1xuXG4gICAgICB3aGlsZSAoc2libGluZy5wcmV2aW91c1NpYmxpbmcpIHtcbiAgICAgICAgc2libGluZyA9IHNpYmxpbmcucHJldmlvdXNTaWJsaW5nO1xuXG4gICAgICAgIGlmIChzaWJsaW5nLm5vZGVUeXBlID09PSBOb2RlLkVMRU1FTlRfTk9ERSAmJiBzaWJsaW5nLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IHNlbGVjdG9yKSB7XG4gICAgICAgICAgbnRoKys7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKG50aCAhPT0gMSkge1xuICAgICAgICBzZWxlY3RvciArPSBcIjpudGgtb2YtdHlwZShcIi5jb25jYXQobnRoLCBcIilcIik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcGF0aC51bnNoaWZ0KHNlbGVjdG9yKTtcbiAgICBlbCA9IGVsLnBhcmVudE5vZGU7XG4gIH1cblxuICByZXR1cm4gcGF0aC5qb2luKCcgPiAnKTtcbn07XG5cbi8qKlxuICogQ29weXJpZ2h0IDIwMTYgQWRndWFyZCBTb2Z0d2FyZSBMdGRcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG4vKipcbiAqIEhlbHBlciBjbGFzcyBjc3MgdXRpbHNcbiAqXG4gKiBAdHlwZSB7e25vcm1hbGl6ZX19XG4gKi9cbnZhciBjc3NVdGlscyA9IGZ1bmN0aW9uICgpIHtcbiAgLyoqXG4gICAqIFJlZ2V4IHRoYXQgbWF0Y2hlcyBBZEd1YXJkJ3MgYmFja3dhcmQgY29tcGF0aWJsZSBzeW50YXhlcy5cbiAgICovXG4gIHZhciByZUF0dHJGYWxsYmFjayA9IC9cXFstKD86ZXh0fGFicCktKFthLXotX10rKT0oW1wiJ10pKCg/Oig/PShcXFxcPykpXFw0LikqPylcXDJcXF0vZztcbiAgLyoqXG4gICAqIENvbXBsZXggcmVwbGFjZW1lbnQgZnVuY3Rpb24uXG4gICAqIFVuZXNjYXBlcyBxdW90ZSBjaGFyYWN0ZXJzIGluc2lkZSBvZiBhbiBleHRlbmRlZCBzZWxlY3Rvci5cbiAgICpcbiAgICogQHBhcmFtIG1hdGNoICAgICBXaG9sZSBtYXRjaGVkIHN0cmluZ1xuICAgKiBAcGFyYW0gbmFtZSAgICAgIEdyb3VwIDFcbiAgICogQHBhcmFtIHF1b3RlQ2hhciBHcm91cCAyXG4gICAqIEBwYXJhbSB2YWx1ZSAgICAgR3JvdXAgM1xuICAgKi9cblxuICB2YXIgZXZhbHVhdGVNYXRjaCA9IGZ1bmN0aW9uIGV2YWx1YXRlTWF0Y2gobWF0Y2gsIG5hbWUsIHF1b3RlQ2hhciwgdmFsdWUpIHtcbiAgICAvLyBVbmVzY2FwZSBxdW90ZXNcbiAgICB2YXIgcmUgPSBuZXcgUmVnRXhwKFwiKFteXFxcXFxcXFxdfF4pXFxcXFxcXFxcIi5jb25jYXQocXVvdGVDaGFyKSwgJ2cnKTtcbiAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UocmUsIFwiJDFcIi5jb25jYXQocXVvdGVDaGFyKSk7XG4gICAgcmV0dXJuIFwiOlwiLmNvbmNhdChuYW1lLCBcIihcIikuY29uY2F0KHZhbHVlLCBcIilcIik7XG4gIH07IC8vIFNpenpsZSdzIHBhcnNpbmcgb2YgcHNldWRvIGNsYXNzIGFyZ3VtZW50cyBpcyBidWdneSBvbiBjZXJ0YWluIGNpcmN1bXN0YW5jZXNcbiAgLy8gV2Ugc3VwcG9ydCBmb2xsb3dpbmcgZm9ybSBvZiBhcmd1bWVudHM6XG4gIC8vIDEuIGZvciA6bWF0Y2hlcy1jc3MsIHRob3NlIG9mIGEgZm9ybSB7cHJvcGVydHlOYW1lfTogLy4qL1xuICAvLyAyLiBmb3IgOmNvbnRhaW5zLCB0aG9zZSBvZiBhIGZvcm0gLy4qL1xuICAvLyBXZSB0cmFuc2Zvcm0gc3VjaCBjYXNlcyBpbiBhIHdheSB0aGF0IFNpenpsZSBoYXMgbm8gYW1iaWd1aXR5IGluIHBhcnNpbmcgYXJndW1lbnRzLlxuXG5cbiAgdmFyIHJlTWF0Y2hlc0NzcyA9IC9cXDoobWF0Y2hlcy1jc3MoPzotYWZ0ZXJ8LWJlZm9yZSk/KVxcKChbYS16LVxcc10qXFw6XFxzKlxcLyg/OlxcXFwufFteXFwvXSkqP1xcL1xccyopXFwpL2c7XG4gIHZhciByZUNvbnRhaW5zID0gLzooPzotYWJwLSk/KGNvbnRhaW5zfGhhcy10ZXh0KVxcKChcXHMqXFwvKD86XFxcXC58W15cXC9dKSo/XFwvXFxzKilcXCkvZztcbiAgdmFyIHJlU2NvcGUgPSAvXFwoXFw6c2NvcGUgPi9nOyAvLyBOb3RlIHRoYXQgd2UgcmVxdWlyZSBgL2AgY2hhcmFjdGVyIGluIHJlZ3VsYXIgZXhwcmVzc2lvbnMgdG8gYmUgZXNjYXBlZC5cblxuICAvKipcbiAgICogVXNlZCBmb3IgcHJlLXByb2Nlc3NpbmcgcHNldWRvLWNsYXNzZXMgdmFsdWVzIHdpdGggYWJvdmUgdHdvIHJlZ2V4ZXMuXG4gICAqL1xuXG4gIHZhciBhZGRRdW90ZXMgPSBmdW5jdGlvbiBhZGRRdW90ZXMoXywgYzEsIGMyKSB7XG4gICAgcmV0dXJuIFwiOlwiLmNvbmNhdChjMSwgXCIoXFxcIlwiKS5jb25jYXQoYzIucmVwbGFjZSgvW1wiXFxcXF0vZywgJ1xcXFwkJicpLCBcIlxcXCIpXCIpO1xuICB9O1xuXG4gIHZhciBTQ09QRV9SRVBMQUNFUiA9ICcoPic7XG4gIC8qKlxuICAgKiBOb3JtYWxpemVzIHNwZWNpZmllZCBjc3MgdGV4dCBpbiBhIGZvcm0gdGhhdCBjYW4gYmUgcGFyc2VkIGJ5IHRoZVxuICAgKiBTaXp6bGUgZW5naW5lLlxuICAgKiBOb3JtYWxpemF0aW9uIG1lYW5zXG4gICAqICAxLiB0cmFuc2Zvcm1pbmcgWy1leHQtKj1cIlwiXSBhdHRyaWJ1dGVzIHRvIHBzZXVkbyBjbGFzc2VzXG4gICAqICAyLiBlbmNsb3NpbmcgcG9zc2libHkgYW1iaWd1b3VzIGFyZ3VtZW50cyBvZiBgOmNvbnRhaW5zYCxcbiAgICogICAgIGA6bWF0Y2hlcy1jc3NgIHBzZXVkbyBjbGFzc2VzIHdpdGggcXVvdGVzLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gY3NzVGV4dFxuICAgKiBAcmV0dXJuIHtzdHJpbmd9XG4gICAqL1xuXG4gIHZhciBub3JtYWxpemUgPSBmdW5jdGlvbiBub3JtYWxpemUoY3NzVGV4dCkge1xuICAgIHZhciBub3JtYWxpemVkQ3NzVGV4dCA9IGNzc1RleHQucmVwbGFjZShyZUF0dHJGYWxsYmFjaywgZXZhbHVhdGVNYXRjaCkucmVwbGFjZShyZU1hdGNoZXNDc3MsIGFkZFF1b3RlcykucmVwbGFjZShyZUNvbnRhaW5zLCBhZGRRdW90ZXMpLnJlcGxhY2UocmVTY29wZSwgU0NPUEVfUkVQTEFDRVIpO1xuICAgIHJldHVybiBub3JtYWxpemVkQ3NzVGV4dDtcbiAgfTtcblxuICB2YXIgaXNTaW1wbGVTZWxlY3RvclZhbGlkID0gZnVuY3Rpb24gaXNTaW1wbGVTZWxlY3RvclZhbGlkKHNlbGVjdG9yKSB7XG4gICAgdHJ5IHtcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIG5vcm1hbGl6ZTogbm9ybWFsaXplLFxuICAgIGlzU2ltcGxlU2VsZWN0b3JWYWxpZDogaXNTaW1wbGVTZWxlY3RvclZhbGlkXG4gIH07XG59KCk7XG5cbi8qIVxuICogU2l6emxlIENTUyBTZWxlY3RvciBFbmdpbmUgdjIuMy40LXByZS1hZGd1YXJkXG4gKiBodHRwczovL3NpenpsZWpzLmNvbS9cbiAqXG4gKiBDb3B5cmlnaHQgSlMgRm91bmRhdGlvbiBhbmQgb3RoZXIgY29udHJpYnV0b3JzXG4gKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2VcbiAqIGh0dHBzOi8vanMuZm91bmRhdGlvbi9cbiAqXG4gKiBEYXRlOiAyMDIwLTA4LTA0XG4gKi9cblxuLyoqXG4gKiBWZXJzaW9uIG9mIFNpenpsZSBwYXRjaGVkIGJ5IEFkR3VhcmQgaW4gb3JkZXIgdG8gYmUgdXNlZCBpbiB0aGUgRXh0ZW5kZWRDc3MgbW9kdWxlLlxuICogaHR0cHM6Ly9naXRodWIuY29tL0FkZ3VhcmRUZWFtL3NpenpsZS1leHRjc3NcbiAqXG4gKiBMb29rIGZvciBbQWRHdWFyZCBQYXRjaF0gYW5kIEFER1VBUkRfRVhUQ1NTIG1hcmtlcnMgdG8gZmluZCBvdXQgd2hhdCBleGFjdGx5IHdhcyBjaGFuZ2VkIGJ5IHVzLlxuICpcbiAqIEdsb2JhbCBjaGFuZ2VzOlxuICogMS4gQWRkZWQgYWRkaXRpb25hbCBwYXJhbWV0ZXJzIHRvIHRoZSBcIlNpenpsZS50b2tlbml6ZVwiIG1ldGhvZCBzbyB0aGF0IGl0IGNhbiBiZSB1c2VkIGZvciBzdHlsZXNoZWV0cyBwYXJzaW5nIGFuZCB2YWxpZGF0aW9uLlxuICogMi4gQWRkZWQgdG9rZW5zIHJlLXNvcnRpbmcgbWVjaGFuaXNtIGZvcmNpbmcgc2xvdyBwc2V1ZG9zIHRvIGJlIG1hdGNoZWQgbGFzdCAgKHNlZSBzb3J0VG9rZW5Hcm91cHMpLlxuICogMy4gRml4IHRoZSBub25uYXRpdmVTZWxlY3RvckNhY2hlIGNhY2hpbmcgLS0gdGhlcmUgd2FzIG5vIHZhbHVlIGNvcnJlc3BvbmRpbmcgdG8gYSBrZXkuXG4gKiA0LiBBZGRlZCBTaXp6bGUuY29tcGlsZSBjYWxsIHRvIHRoZSBgOmhhc2AgcHNldWRvIGRlZmluaXRpb24uXG4gKlxuICogQ2hhbmdlcyB0aGF0IGFyZSBhcHBsaWVkIHRvIHRoZSBBREdVQVJEX0VYVENTUyBidWlsZCBvbmx5OlxuICogMS4gRG8gbm90IGV4cG9zZSBTaXp6bGUgdG8gdGhlIGdsb2JhbCBzY29wZS4gSW5pdGlhbGl6ZSBpdCBsYXppbHkgdmlhIGluaXRpYWxpemVTaXp6bGUoKS5cbiAqIDIuIFJlbW92ZWQgOmNvbnRhaW5zIHBzZXVkbyBkZWNsYXJhdGlvbiAtLSBpdHMgc3ludGF4IGlzIGNoYW5nZWQgYW5kIGRlY2xhcmVkIG91dHNpZGUgb2YgU2l6emxlLlxuICogMy4gUmVtb3ZlZCBkZWNsYXJhdGlvbnMgZm9yIHRoZSBmb2xsb3dpbmcgbm9uLXN0YW5kYXJkIHBzZXVkbyBjbGFzc2VzOlxuICogOnBhcmVudCwgOmhlYWRlciwgOmlucHV0LCA6YnV0dG9uLCA6dGV4dCwgOmZpcnN0LCA6bGFzdCwgOmVxLFxuICogOmV2ZW4sIDpvZGQsIDpsdCwgOmd0LCA6bnRoLCA6cmFkaW8sIDpjaGVja2JveCwgOmZpbGUsXG4gKiA6cGFzc3dvcmQsIDppbWFnZSwgOnN1Ym1pdCwgOnJlc2V0XG4gKiA0LiBBZGRlZCBlczYgbW9kdWxlIGV4cG9ydFxuICovXG52YXIgU2l6emxlO1xuLyoqXG4gKiBJbml0aWFsaXplcyBTaXp6bGUgb2JqZWN0LlxuICogSW4gdGhlIGNhc2Ugb2YgQWRHdWFyZCBFeHRlbmRlZENzcyB3ZSB3YW50IHRvIGF2b2lkIGluaXRpYWxpemluZyBTaXp6bGUgcmlnaHQgYXdheVxuICogYW5kIGV4cG9zaW5nIGl0IHRvIHRoZSBnbG9iYWwgc2NvcGUuXG4gKi9cblxudmFyIGluaXRpYWxpemVTaXp6bGUgPSBmdW5jdGlvbiBpbml0aWFsaXplU2l6emxlKCkge1xuICAvLyBqc2hpbnQgaWdub3JlOmxpbmVcbiAgaWYgKCFTaXp6bGUpIHtcbiAgICAvLzw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PFxuICAgIFNpenpsZSA9IGZ1bmN0aW9uICh3aW5kb3cpIHtcbiAgICAgIHZhciBzdXBwb3J0LFxuICAgICAgICAgIEV4cHIsXG4gICAgICAgICAgZ2V0VGV4dCxcbiAgICAgICAgICBpc1hNTCxcbiAgICAgICAgICB0b2tlbml6ZSxcbiAgICAgICAgICBjb21waWxlLFxuICAgICAgICAgIHNlbGVjdCxcbiAgICAgICAgICBvdXRlcm1vc3RDb250ZXh0LFxuICAgICAgICAgIHNvcnRJbnB1dCxcbiAgICAgICAgICBoYXNEdXBsaWNhdGUsXG4gICAgICAgICAgLy8gTG9jYWwgZG9jdW1lbnQgdmFyc1xuICAgICAgc2V0RG9jdW1lbnQsXG4gICAgICAgICAgZG9jdW1lbnQsXG4gICAgICAgICAgZG9jRWxlbSxcbiAgICAgICAgICBkb2N1bWVudElzSFRNTCxcbiAgICAgICAgICByYnVnZ3lRU0EsXG4gICAgICAgICAgcmJ1Z2d5TWF0Y2hlcyxcbiAgICAgICAgICBtYXRjaGVzLFxuICAgICAgICAgIGNvbnRhaW5zLFxuICAgICAgICAgIC8vIEluc3RhbmNlLXNwZWNpZmljIGRhdGFcbiAgICAgIGV4cGFuZG8gPSBcInNpenpsZVwiICsgMSAqIG5ldyBEYXRlKCksXG4gICAgICAgICAgcHJlZmVycmVkRG9jID0gd2luZG93LmRvY3VtZW50LFxuICAgICAgICAgIGRpcnJ1bnMgPSAwLFxuICAgICAgICAgIGRvbmUgPSAwLFxuICAgICAgICAgIGNsYXNzQ2FjaGUgPSBjcmVhdGVDYWNoZSgpLFxuICAgICAgICAgIHRva2VuQ2FjaGUgPSBjcmVhdGVDYWNoZSgpLFxuICAgICAgICAgIGNvbXBpbGVyQ2FjaGUgPSBjcmVhdGVDYWNoZSgpLFxuICAgICAgICAgIG5vbm5hdGl2ZVNlbGVjdG9yQ2FjaGUgPSBjcmVhdGVDYWNoZSgpLFxuICAgICAgICAgIHNvcnRPcmRlciA9IGZ1bmN0aW9uIHNvcnRPcmRlcihhLCBiKSB7XG4gICAgICAgIGlmIChhID09PSBiKSB7XG4gICAgICAgICAgaGFzRHVwbGljYXRlID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAwO1xuICAgICAgfSxcbiAgICAgICAgICAvLyBJbnN0YW5jZSBtZXRob2RzXG4gICAgICBoYXNPd24gPSB7fS5oYXNPd25Qcm9wZXJ0eSxcbiAgICAgICAgICBhcnIgPSBbXSxcbiAgICAgICAgICBwb3AgPSBhcnIucG9wLFxuICAgICAgICAgIHB1c2hfbmF0aXZlID0gYXJyLnB1c2gsXG4gICAgICAgICAgcHVzaCA9IGFyci5wdXNoLFxuICAgICAgICAgIHNsaWNlID0gYXJyLnNsaWNlLFxuICAgICAgICAgIC8vIFVzZSBhIHN0cmlwcGVkLWRvd24gaW5kZXhPZiBhcyBpdCdzIGZhc3RlciB0aGFuIG5hdGl2ZVxuICAgICAgLy8gaHR0cHM6Ly9qc3BlcmYuY29tL3Rob3ItaW5kZXhvZi12cy1mb3IvNVxuICAgICAgaW5kZXhPZiA9IGZ1bmN0aW9uIGluZGV4T2YobGlzdCwgZWxlbSkge1xuICAgICAgICB2YXIgaSA9IDAsXG4gICAgICAgICAgICBsZW4gPSBsaXN0Lmxlbmd0aDtcblxuICAgICAgICBmb3IgKDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgaWYgKGxpc3RbaV0gPT09IGVsZW0pIHtcbiAgICAgICAgICAgIHJldHVybiBpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAtMTtcbiAgICAgIH0sXG4gICAgICAgICAgYm9vbGVhbnMgPSBcImNoZWNrZWR8c2VsZWN0ZWR8YXN5bmN8YXV0b2ZvY3VzfGF1dG9wbGF5fGNvbnRyb2xzfGRlZmVyfGRpc2FibGVkfGhpZGRlbnxpc21hcHxsb29wfG11bHRpcGxlfG9wZW58cmVhZG9ubHl8cmVxdWlyZWR8c2NvcGVkXCIsXG4gICAgICAgICAgLy8gUmVndWxhciBleHByZXNzaW9uc1xuICAgICAgLy8gaHR0cDovL3d3dy53My5vcmcvVFIvY3NzMy1zZWxlY3RvcnMvI3doaXRlc3BhY2VcbiAgICAgIHdoaXRlc3BhY2UgPSBcIltcXFxceDIwXFxcXHRcXFxcclxcXFxuXFxcXGZdXCIsXG4gICAgICAgICAgLy8gaHR0cDovL3d3dy53My5vcmcvVFIvQ1NTMjEvc3luZGF0YS5odG1sI3ZhbHVlLWRlZi1pZGVudGlmaWVyXG4gICAgICBpZGVudGlmaWVyID0gXCIoPzpcXFxcXFxcXC58W1xcXFx3LV18W15cXDAtXFxcXHhhMF0pK1wiLFxuICAgICAgICAgIC8vIEF0dHJpYnV0ZSBzZWxlY3RvcnM6IGh0dHA6Ly93d3cudzMub3JnL1RSL3NlbGVjdG9ycy8jYXR0cmlidXRlLXNlbGVjdG9yc1xuICAgICAgYXR0cmlidXRlcyA9IFwiXFxcXFtcIiArIHdoaXRlc3BhY2UgKyBcIiooXCIgKyBpZGVudGlmaWVyICsgXCIpKD86XCIgKyB3aGl0ZXNwYWNlICsgLy8gT3BlcmF0b3IgKGNhcHR1cmUgMilcbiAgICAgIFwiKihbKl4kfCF+XT89KVwiICsgd2hpdGVzcGFjZSArIC8vIFwiQXR0cmlidXRlIHZhbHVlcyBtdXN0IGJlIENTUyBpZGVudGlmaWVycyBbY2FwdHVyZSA1XSBvciBzdHJpbmdzIFtjYXB0dXJlIDMgb3IgY2FwdHVyZSA0XVwiXG4gICAgICBcIiooPzonKCg/OlxcXFxcXFxcLnxbXlxcXFxcXFxcJ10pKiknfFxcXCIoKD86XFxcXFxcXFwufFteXFxcXFxcXFxcXFwiXSkqKVxcXCJ8KFwiICsgaWRlbnRpZmllciArIFwiKSl8KVwiICsgd2hpdGVzcGFjZSArIFwiKlxcXFxdXCIsXG4gICAgICAgICAgcHNldWRvcyA9IFwiOihcIiArIGlkZW50aWZpZXIgKyBcIikoPzpcXFxcKChcIiArIC8vIFRvIHJlZHVjZSB0aGUgbnVtYmVyIG9mIHNlbGVjdG9ycyBuZWVkaW5nIHRva2VuaXplIGluIHRoZSBwcmVGaWx0ZXIsIHByZWZlciBhcmd1bWVudHM6XG4gICAgICAvLyAxLiBxdW90ZWQgKGNhcHR1cmUgMzsgY2FwdHVyZSA0IG9yIGNhcHR1cmUgNSlcbiAgICAgIFwiKCcoKD86XFxcXFxcXFwufFteXFxcXFxcXFwnXSkqKSd8XFxcIigoPzpcXFxcXFxcXC58W15cXFxcXFxcXFxcXCJdKSopXFxcIil8XCIgKyAvLyAyLiBzaW1wbGUgKGNhcHR1cmUgNilcbiAgICAgIFwiKCg/OlxcXFxcXFxcLnxbXlxcXFxcXFxcKClbXFxcXF1dfFwiICsgYXR0cmlidXRlcyArIFwiKSopfFwiICsgLy8gMy4gYW55dGhpbmcgZWxzZSAoY2FwdHVyZSAyKVxuICAgICAgXCIuKlwiICsgXCIpXFxcXCl8KVwiLFxuICAgICAgICAgIC8vIExlYWRpbmcgYW5kIG5vbi1lc2NhcGVkIHRyYWlsaW5nIHdoaXRlc3BhY2UsIGNhcHR1cmluZyBzb21lIG5vbi13aGl0ZXNwYWNlIGNoYXJhY3RlcnMgcHJlY2VkaW5nIHRoZSBsYXR0ZXJcbiAgICAgIHJ3aGl0ZXNwYWNlID0gbmV3IFJlZ0V4cCh3aGl0ZXNwYWNlICsgXCIrXCIsIFwiZ1wiKSxcbiAgICAgICAgICBydHJpbSA9IG5ldyBSZWdFeHAoXCJeXCIgKyB3aGl0ZXNwYWNlICsgXCIrfCgoPzpefFteXFxcXFxcXFxdKSg/OlxcXFxcXFxcLikqKVwiICsgd2hpdGVzcGFjZSArIFwiKyRcIiwgXCJnXCIpLFxuICAgICAgICAgIHJjb21tYSA9IG5ldyBSZWdFeHAoXCJeXCIgKyB3aGl0ZXNwYWNlICsgXCIqLFwiICsgd2hpdGVzcGFjZSArIFwiKlwiKSxcbiAgICAgICAgICByY29tYmluYXRvcnMgPSBuZXcgUmVnRXhwKFwiXlwiICsgd2hpdGVzcGFjZSArIFwiKihbPit+XXxcIiArIHdoaXRlc3BhY2UgKyBcIilcIiArIHdoaXRlc3BhY2UgKyBcIipcIiksXG4gICAgICAgICAgcnBzZXVkbyA9IG5ldyBSZWdFeHAocHNldWRvcyksXG4gICAgICAgICAgcmlkZW50aWZpZXIgPSBuZXcgUmVnRXhwKFwiXlwiICsgaWRlbnRpZmllciArIFwiJFwiKSxcbiAgICAgICAgICBtYXRjaEV4cHIgPSB7XG4gICAgICAgIFwiSURcIjogbmV3IFJlZ0V4cChcIl4jKFwiICsgaWRlbnRpZmllciArIFwiKVwiKSxcbiAgICAgICAgXCJDTEFTU1wiOiBuZXcgUmVnRXhwKFwiXlxcXFwuKFwiICsgaWRlbnRpZmllciArIFwiKVwiKSxcbiAgICAgICAgXCJUQUdcIjogbmV3IFJlZ0V4cChcIl4oXCIgKyBpZGVudGlmaWVyICsgXCJ8WypdKVwiKSxcbiAgICAgICAgXCJBVFRSXCI6IG5ldyBSZWdFeHAoXCJeXCIgKyBhdHRyaWJ1dGVzKSxcbiAgICAgICAgXCJQU0VVRE9cIjogbmV3IFJlZ0V4cChcIl5cIiArIHBzZXVkb3MpLFxuICAgICAgICBcIkNISUxEXCI6IG5ldyBSZWdFeHAoXCJeOihvbmx5fGZpcnN0fGxhc3R8bnRofG50aC1sYXN0KS0oY2hpbGR8b2YtdHlwZSkoPzpcXFxcKFwiICsgd2hpdGVzcGFjZSArIFwiKihldmVufG9kZHwoKFsrLV18KShcXFxcZCopbnwpXCIgKyB3aGl0ZXNwYWNlICsgXCIqKD86KFsrLV18KVwiICsgd2hpdGVzcGFjZSArIFwiKihcXFxcZCspfCkpXCIgKyB3aGl0ZXNwYWNlICsgXCIqXFxcXCl8KVwiLCBcImlcIiksXG4gICAgICAgIFwiYm9vbFwiOiBuZXcgUmVnRXhwKFwiXig/OlwiICsgYm9vbGVhbnMgKyBcIikkXCIsIFwiaVwiKSxcbiAgICAgICAgLy8gRm9yIHVzZSBpbiBsaWJyYXJpZXMgaW1wbGVtZW50aW5nIC5pcygpXG4gICAgICAgIC8vIFdlIHVzZSB0aGlzIGZvciBQT1MgbWF0Y2hpbmcgaW4gYHNlbGVjdGBcbiAgICAgICAgXCJuZWVkc0NvbnRleHRcIjogbmV3IFJlZ0V4cChcIl5cIiArIHdoaXRlc3BhY2UgKyBcIipbPit+XXw6KGV2ZW58b2RkfGVxfGd0fGx0fG50aHxmaXJzdHxsYXN0KSg/OlxcXFwoXCIgKyB3aGl0ZXNwYWNlICsgXCIqKCg/Oi1cXFxcZCk/XFxcXGQqKVwiICsgd2hpdGVzcGFjZSArIFwiKlxcXFwpfCkoPz1bXi1dfCQpXCIsIFwiaVwiKVxuICAgICAgfSxcbiAgICAgICAgICBybmF0aXZlID0gL15bXntdK1xce1xccypcXFtuYXRpdmUgXFx3LyxcbiAgICAgICAgICAvLyBFYXNpbHktcGFyc2VhYmxlL3JldHJpZXZhYmxlIElEIG9yIFRBRyBvciBDTEFTUyBzZWxlY3RvcnNcbiAgICAgIHJxdWlja0V4cHIgPSAvXig/OiMoW1xcdy1dKyl8KFxcdyspfFxcLihbXFx3LV0rKSkkLyxcbiAgICAgICAgICByc2libGluZyA9IC9bK35dLyxcbiAgICAgICAgICAvLyBDU1MgZXNjYXBlc1xuICAgICAgLy8gaHR0cDovL3d3dy53My5vcmcvVFIvQ1NTMjEvc3luZGF0YS5odG1sI2VzY2FwZWQtY2hhcmFjdGVyc1xuICAgICAgcnVuZXNjYXBlID0gbmV3IFJlZ0V4cChcIlxcXFxcXFxcKFtcXFxcZGEtZl17MSw2fVwiICsgd2hpdGVzcGFjZSArIFwiP3woXCIgKyB3aGl0ZXNwYWNlICsgXCIpfC4pXCIsIFwiaWdcIiksXG4gICAgICAgICAgZnVuZXNjYXBlID0gZnVuY3Rpb24gZnVuZXNjYXBlKF8sIGVzY2FwZWQsIGVzY2FwZWRXaGl0ZXNwYWNlKSB7XG4gICAgICAgIHZhciBoaWdoID0gXCIweFwiICsgZXNjYXBlZCAtIDB4MTAwMDA7IC8vIE5hTiBtZWFucyBub24tY29kZXBvaW50XG4gICAgICAgIC8vIFN1cHBvcnQ6IEZpcmVmb3g8MjRcbiAgICAgICAgLy8gV29ya2Fyb3VuZCBlcnJvbmVvdXMgbnVtZXJpYyBpbnRlcnByZXRhdGlvbiBvZiArXCIweFwiXG5cbiAgICAgICAgcmV0dXJuIGhpZ2ggIT09IGhpZ2ggfHwgZXNjYXBlZFdoaXRlc3BhY2UgPyBlc2NhcGVkIDogaGlnaCA8IDAgPyAvLyBCTVAgY29kZXBvaW50XG4gICAgICAgIFN0cmluZy5mcm9tQ2hhckNvZGUoaGlnaCArIDB4MTAwMDApIDogLy8gU3VwcGxlbWVudGFsIFBsYW5lIGNvZGVwb2ludCAoc3Vycm9nYXRlIHBhaXIpXG4gICAgICAgIFN0cmluZy5mcm9tQ2hhckNvZGUoaGlnaCA+PiAxMCB8IDB4RDgwMCwgaGlnaCAmIDB4M0ZGIHwgMHhEQzAwKTtcbiAgICAgIH0sXG4gICAgICAgICAgLy8gQ1NTIHN0cmluZy9pZGVudGlmaWVyIHNlcmlhbGl6YXRpb25cbiAgICAgIC8vIGh0dHBzOi8vZHJhZnRzLmNzc3dnLm9yZy9jc3NvbS8jY29tbW9uLXNlcmlhbGl6aW5nLWlkaW9tc1xuICAgICAgcmNzc2VzY2FwZSA9IC8oW1xcMC1cXHgxZlxceDdmXXxeLT9cXGQpfF4tJHxbXlxcMC1cXHgxZlxceDdmLVxcdUZGRkZcXHctXS9nLFxuICAgICAgICAgIGZjc3Nlc2NhcGUgPSBmdW5jdGlvbiBmY3NzZXNjYXBlKGNoLCBhc0NvZGVQb2ludCkge1xuICAgICAgICBpZiAoYXNDb2RlUG9pbnQpIHtcbiAgICAgICAgICAvLyBVKzAwMDAgTlVMTCBiZWNvbWVzIFUrRkZGRCBSRVBMQUNFTUVOVCBDSEFSQUNURVJcbiAgICAgICAgICBpZiAoY2ggPT09IFwiXFwwXCIpIHtcbiAgICAgICAgICAgIHJldHVybiBcIlxcdUZGRkRcIjtcbiAgICAgICAgICB9IC8vIENvbnRyb2wgY2hhcmFjdGVycyBhbmQgKGRlcGVuZGVudCB1cG9uIHBvc2l0aW9uKSBudW1iZXJzIGdldCBlc2NhcGVkIGFzIGNvZGUgcG9pbnRzXG5cblxuICAgICAgICAgIHJldHVybiBjaC5zbGljZSgwLCAtMSkgKyBcIlxcXFxcIiArIGNoLmNoYXJDb2RlQXQoY2gubGVuZ3RoIC0gMSkudG9TdHJpbmcoMTYpICsgXCIgXCI7XG4gICAgICAgIH0gLy8gT3RoZXIgcG90ZW50aWFsbHktc3BlY2lhbCBBU0NJSSBjaGFyYWN0ZXJzIGdldCBiYWNrc2xhc2gtZXNjYXBlZFxuXG5cbiAgICAgICAgcmV0dXJuIFwiXFxcXFwiICsgY2g7XG4gICAgICB9LFxuICAgICAgICAgIC8vIFVzZWQgZm9yIGlmcmFtZXNcbiAgICAgIC8vIFNlZSBzZXREb2N1bWVudCgpXG4gICAgICAvLyBSZW1vdmluZyB0aGUgZnVuY3Rpb24gd3JhcHBlciBjYXVzZXMgYSBcIlBlcm1pc3Npb24gRGVuaWVkXCJcbiAgICAgIC8vIGVycm9yIGluIElFXG4gICAgICB1bmxvYWRIYW5kbGVyID0gZnVuY3Rpb24gdW5sb2FkSGFuZGxlcigpIHtcbiAgICAgICAgc2V0RG9jdW1lbnQoKTtcbiAgICAgIH0sXG4gICAgICAgICAgaW5EaXNhYmxlZEZpZWxkc2V0ID0gYWRkQ29tYmluYXRvcihmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICByZXR1cm4gZWxlbS5kaXNhYmxlZCA9PT0gdHJ1ZSAmJiBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IFwiZmllbGRzZXRcIjtcbiAgICAgIH0sIHtcbiAgICAgICAgZGlyOiBcInBhcmVudE5vZGVcIixcbiAgICAgICAgbmV4dDogXCJsZWdlbmRcIlxuICAgICAgfSk7IC8vIE9wdGltaXplIGZvciBwdXNoLmFwcGx5KCBfLCBOb2RlTGlzdCApXG5cblxuICAgICAgdHJ5IHtcbiAgICAgICAgcHVzaC5hcHBseShhcnIgPSBzbGljZS5jYWxsKHByZWZlcnJlZERvYy5jaGlsZE5vZGVzKSwgcHJlZmVycmVkRG9jLmNoaWxkTm9kZXMpOyAvLyBTdXBwb3J0OiBBbmRyb2lkPDQuMFxuICAgICAgICAvLyBEZXRlY3Qgc2lsZW50bHkgZmFpbGluZyBwdXNoLmFwcGx5XG5cbiAgICAgICAgYXJyW3ByZWZlcnJlZERvYy5jaGlsZE5vZGVzLmxlbmd0aF0ubm9kZVR5cGU7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHB1c2ggPSB7XG4gICAgICAgICAgYXBwbHk6IGFyci5sZW5ndGggPyAvLyBMZXZlcmFnZSBzbGljZSBpZiBwb3NzaWJsZVxuICAgICAgICAgIGZ1bmN0aW9uICh0YXJnZXQsIGVscykge1xuICAgICAgICAgICAgcHVzaF9uYXRpdmUuYXBwbHkodGFyZ2V0LCBzbGljZS5jYWxsKGVscykpO1xuICAgICAgICAgIH0gOiAvLyBTdXBwb3J0OiBJRTw5XG4gICAgICAgICAgLy8gT3RoZXJ3aXNlIGFwcGVuZCBkaXJlY3RseVxuICAgICAgICAgIGZ1bmN0aW9uICh0YXJnZXQsIGVscykge1xuICAgICAgICAgICAgdmFyIGogPSB0YXJnZXQubGVuZ3RoLFxuICAgICAgICAgICAgICAgIGkgPSAwOyAvLyBDYW4ndCB0cnVzdCBOb2RlTGlzdC5sZW5ndGhcblxuICAgICAgICAgICAgd2hpbGUgKHRhcmdldFtqKytdID0gZWxzW2krK10pIHt9XG5cbiAgICAgICAgICAgIHRhcmdldC5sZW5ndGggPSBqIC0gMTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIFNpenpsZShzZWxlY3RvciwgY29udGV4dCwgcmVzdWx0cywgc2VlZCkge1xuICAgICAgICB2YXIgbSxcbiAgICAgICAgICAgIGksXG4gICAgICAgICAgICBlbGVtLFxuICAgICAgICAgICAgbmlkLFxuICAgICAgICAgICAgbWF0Y2gsXG4gICAgICAgICAgICBncm91cHMsXG4gICAgICAgICAgICBuZXdTZWxlY3RvcixcbiAgICAgICAgICAgIG5ld0NvbnRleHQgPSBjb250ZXh0ICYmIGNvbnRleHQub3duZXJEb2N1bWVudCxcbiAgICAgICAgICAgIC8vIG5vZGVUeXBlIGRlZmF1bHRzIHRvIDksIHNpbmNlIGNvbnRleHQgZGVmYXVsdHMgdG8gZG9jdW1lbnRcbiAgICAgICAgbm9kZVR5cGUgPSBjb250ZXh0ID8gY29udGV4dC5ub2RlVHlwZSA6IDk7XG4gICAgICAgIHJlc3VsdHMgPSByZXN1bHRzIHx8IFtdOyAvLyBSZXR1cm4gZWFybHkgZnJvbSBjYWxscyB3aXRoIGludmFsaWQgc2VsZWN0b3Igb3IgY29udGV4dFxuXG4gICAgICAgIGlmICh0eXBlb2Ygc2VsZWN0b3IgIT09IFwic3RyaW5nXCIgfHwgIXNlbGVjdG9yIHx8IG5vZGVUeXBlICE9PSAxICYmIG5vZGVUeXBlICE9PSA5ICYmIG5vZGVUeXBlICE9PSAxMSkge1xuICAgICAgICAgIHJldHVybiByZXN1bHRzO1xuICAgICAgICB9IC8vIFRyeSB0byBzaG9ydGN1dCBmaW5kIG9wZXJhdGlvbnMgKGFzIG9wcG9zZWQgdG8gZmlsdGVycykgaW4gSFRNTCBkb2N1bWVudHNcblxuXG4gICAgICAgIGlmICghc2VlZCkge1xuICAgICAgICAgIGlmICgoY29udGV4dCA/IGNvbnRleHQub3duZXJEb2N1bWVudCB8fCBjb250ZXh0IDogcHJlZmVycmVkRG9jKSAhPT0gZG9jdW1lbnQpIHtcbiAgICAgICAgICAgIHNldERvY3VtZW50KGNvbnRleHQpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnRleHQgPSBjb250ZXh0IHx8IGRvY3VtZW50O1xuXG4gICAgICAgICAgaWYgKGRvY3VtZW50SXNIVE1MKSB7XG4gICAgICAgICAgICAvLyBJZiB0aGUgc2VsZWN0b3IgaXMgc3VmZmljaWVudGx5IHNpbXBsZSwgdHJ5IHVzaW5nIGEgXCJnZXQqQnkqXCIgRE9NIG1ldGhvZFxuICAgICAgICAgICAgLy8gKGV4Y2VwdGluZyBEb2N1bWVudEZyYWdtZW50IGNvbnRleHQsIHdoZXJlIHRoZSBtZXRob2RzIGRvbid0IGV4aXN0KVxuICAgICAgICAgICAgaWYgKG5vZGVUeXBlICE9PSAxMSAmJiAobWF0Y2ggPSBycXVpY2tFeHByLmV4ZWMoc2VsZWN0b3IpKSkge1xuICAgICAgICAgICAgICAvLyBJRCBzZWxlY3RvclxuICAgICAgICAgICAgICBpZiAobSA9IG1hdGNoWzFdKSB7XG4gICAgICAgICAgICAgICAgLy8gRG9jdW1lbnQgY29udGV4dFxuICAgICAgICAgICAgICAgIGlmIChub2RlVHlwZSA9PT0gOSkge1xuICAgICAgICAgICAgICAgICAgaWYgKGVsZW0gPSBjb250ZXh0LmdldEVsZW1lbnRCeUlkKG0pKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFN1cHBvcnQ6IElFLCBPcGVyYSwgV2Via2l0XG4gICAgICAgICAgICAgICAgICAgIC8vIFRPRE86IGlkZW50aWZ5IHZlcnNpb25zXG4gICAgICAgICAgICAgICAgICAgIC8vIGdldEVsZW1lbnRCeUlkIGNhbiBtYXRjaCBlbGVtZW50cyBieSBuYW1lIGluc3RlYWQgb2YgSURcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVsZW0uaWQgPT09IG0pIHtcbiAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzLnB1c2goZWxlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHRzO1xuICAgICAgICAgICAgICAgICAgfSAvLyBFbGVtZW50IGNvbnRleHRcblxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAvLyBTdXBwb3J0OiBJRSwgT3BlcmEsIFdlYmtpdFxuICAgICAgICAgICAgICAgICAgLy8gVE9ETzogaWRlbnRpZnkgdmVyc2lvbnNcbiAgICAgICAgICAgICAgICAgIC8vIGdldEVsZW1lbnRCeUlkIGNhbiBtYXRjaCBlbGVtZW50cyBieSBuYW1lIGluc3RlYWQgb2YgSURcbiAgICAgICAgICAgICAgICAgIGlmIChuZXdDb250ZXh0ICYmIChlbGVtID0gbmV3Q29udGV4dC5nZXRFbGVtZW50QnlJZChtKSkgJiYgY29udGFpbnMoY29udGV4dCwgZWxlbSkgJiYgZWxlbS5pZCA9PT0gbSkge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRzLnB1c2goZWxlbSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHRzO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gLy8gVHlwZSBzZWxlY3RvclxuXG4gICAgICAgICAgICAgIH0gZWxzZSBpZiAobWF0Y2hbMl0pIHtcbiAgICAgICAgICAgICAgICBwdXNoLmFwcGx5KHJlc3VsdHMsIGNvbnRleHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoc2VsZWN0b3IpKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0czsgLy8gQ2xhc3Mgc2VsZWN0b3JcbiAgICAgICAgICAgICAgfSBlbHNlIGlmICgobSA9IG1hdGNoWzNdKSAmJiBzdXBwb3J0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUgJiYgY29udGV4dC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKSB7XG4gICAgICAgICAgICAgICAgcHVzaC5hcHBseShyZXN1bHRzLCBjb250ZXh0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUobSkpO1xuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHRzO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IC8vIFRha2UgYWR2YW50YWdlIG9mIHF1ZXJ5U2VsZWN0b3JBbGxcblxuXG4gICAgICAgICAgICBpZiAoc3VwcG9ydC5xc2EgJiYgIW5vbm5hdGl2ZVNlbGVjdG9yQ2FjaGVbc2VsZWN0b3IgKyBcIiBcIl0gJiYgKCFyYnVnZ3lRU0EgfHwgIXJidWdneVFTQS50ZXN0KHNlbGVjdG9yKSkpIHtcbiAgICAgICAgICAgICAgaWYgKG5vZGVUeXBlICE9PSAxKSB7XG4gICAgICAgICAgICAgICAgbmV3Q29udGV4dCA9IGNvbnRleHQ7XG4gICAgICAgICAgICAgICAgbmV3U2VsZWN0b3IgPSBzZWxlY3RvcjsgLy8gcVNBIGxvb2tzIG91dHNpZGUgRWxlbWVudCBjb250ZXh0LCB3aGljaCBpcyBub3Qgd2hhdCB3ZSB3YW50XG4gICAgICAgICAgICAgICAgLy8gVGhhbmtzIHRvIEFuZHJldyBEdXBvbnQgZm9yIHRoaXMgd29ya2Fyb3VuZCB0ZWNobmlxdWVcbiAgICAgICAgICAgICAgICAvLyBTdXBwb3J0OiBJRSA8PThcbiAgICAgICAgICAgICAgICAvLyBFeGNsdWRlIG9iamVjdCBlbGVtZW50c1xuICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNvbnRleHQubm9kZU5hbWUudG9Mb3dlckNhc2UoKSAhPT0gXCJvYmplY3RcIikge1xuICAgICAgICAgICAgICAgIC8vIENhcHR1cmUgdGhlIGNvbnRleHQgSUQsIHNldHRpbmcgaXQgZmlyc3QgaWYgbmVjZXNzYXJ5XG4gICAgICAgICAgICAgICAgaWYgKG5pZCA9IGNvbnRleHQuZ2V0QXR0cmlidXRlKFwiaWRcIikpIHtcbiAgICAgICAgICAgICAgICAgIG5pZCA9IG5pZC5yZXBsYWNlKHJjc3Nlc2NhcGUsIGZjc3Nlc2NhcGUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICBjb250ZXh0LnNldEF0dHJpYnV0ZShcImlkXCIsIG5pZCA9IGV4cGFuZG8pO1xuICAgICAgICAgICAgICAgIH0gLy8gUHJlZml4IGV2ZXJ5IHNlbGVjdG9yIGluIHRoZSBsaXN0XG5cblxuICAgICAgICAgICAgICAgIGdyb3VwcyA9IHRva2VuaXplKHNlbGVjdG9yKTtcbiAgICAgICAgICAgICAgICBpID0gZ3JvdXBzLmxlbmd0aDtcblxuICAgICAgICAgICAgICAgIHdoaWxlIChpLS0pIHtcbiAgICAgICAgICAgICAgICAgIGdyb3Vwc1tpXSA9IFwiI1wiICsgbmlkICsgXCIgXCIgKyB0b1NlbGVjdG9yKGdyb3Vwc1tpXSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgbmV3U2VsZWN0b3IgPSBncm91cHMuam9pbihcIixcIik7IC8vIEV4cGFuZCBjb250ZXh0IGZvciBzaWJsaW5nIHNlbGVjdG9yc1xuXG4gICAgICAgICAgICAgICAgbmV3Q29udGV4dCA9IHJzaWJsaW5nLnRlc3Qoc2VsZWN0b3IpICYmIHRlc3RDb250ZXh0KGNvbnRleHQucGFyZW50Tm9kZSkgfHwgY29udGV4dDtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGlmIChuZXdTZWxlY3Rvcikge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICBwdXNoLmFwcGx5KHJlc3VsdHMsIG5ld0NvbnRleHQucXVlcnlTZWxlY3RvckFsbChuZXdTZWxlY3RvcikpO1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAocXNhRXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgIC8vIFtBZEd1YXJkIFBhdGhdOiBGaXggdGhlIGNhY2hlIHZhbHVlXG4gICAgICAgICAgICAgICAgICBub25uYXRpdmVTZWxlY3RvckNhY2hlKHNlbGVjdG9yLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9IGZpbmFsbHkge1xuICAgICAgICAgICAgICAgICAgaWYgKG5pZCA9PT0gZXhwYW5kbykge1xuICAgICAgICAgICAgICAgICAgICBjb250ZXh0LnJlbW92ZUF0dHJpYnV0ZShcImlkXCIpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSAvLyBBbGwgb3RoZXJzXG5cblxuICAgICAgICByZXR1cm4gc2VsZWN0KHNlbGVjdG9yLnJlcGxhY2UocnRyaW0sIFwiJDFcIiksIGNvbnRleHQsIHJlc3VsdHMsIHNlZWQpO1xuICAgICAgfVxuICAgICAgLyoqXG4gICAgICAgKiBDcmVhdGUga2V5LXZhbHVlIGNhY2hlcyBvZiBsaW1pdGVkIHNpemVcbiAgICAgICAqIEByZXR1cm5zIHtmdW5jdGlvbihzdHJpbmcsIG9iamVjdCl9IFJldHVybnMgdGhlIE9iamVjdCBkYXRhIGFmdGVyIHN0b3JpbmcgaXQgb24gaXRzZWxmIHdpdGhcbiAgICAgICAqXHRwcm9wZXJ0eSBuYW1lIHRoZSAoc3BhY2Utc3VmZml4ZWQpIHN0cmluZyBhbmQgKGlmIHRoZSBjYWNoZSBpcyBsYXJnZXIgdGhhbiBFeHByLmNhY2hlTGVuZ3RoKVxuICAgICAgICpcdGRlbGV0aW5nIHRoZSBvbGRlc3QgZW50cnlcbiAgICAgICAqL1xuXG5cbiAgICAgIGZ1bmN0aW9uIGNyZWF0ZUNhY2hlKCkge1xuICAgICAgICB2YXIga2V5cyA9IFtdO1xuXG4gICAgICAgIGZ1bmN0aW9uIGNhY2hlKGtleSwgdmFsdWUpIHtcbiAgICAgICAgICAvLyBVc2UgKGtleSArIFwiIFwiKSB0byBhdm9pZCBjb2xsaXNpb24gd2l0aCBuYXRpdmUgcHJvdG90eXBlIHByb3BlcnRpZXMgKHNlZSBJc3N1ZSAjMTU3KVxuICAgICAgICAgIGlmIChrZXlzLnB1c2goa2V5ICsgXCIgXCIpID4gRXhwci5jYWNoZUxlbmd0aCkge1xuICAgICAgICAgICAgLy8gT25seSBrZWVwIHRoZSBtb3N0IHJlY2VudCBlbnRyaWVzXG4gICAgICAgICAgICBkZWxldGUgY2FjaGVba2V5cy5zaGlmdCgpXTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gY2FjaGVba2V5ICsgXCIgXCJdID0gdmFsdWU7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gY2FjaGU7XG4gICAgICB9XG4gICAgICAvKipcbiAgICAgICAqIE1hcmsgYSBmdW5jdGlvbiBmb3Igc3BlY2lhbCB1c2UgYnkgU2l6emxlXG4gICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbiBUaGUgZnVuY3Rpb24gdG8gbWFya1xuICAgICAgICovXG5cblxuICAgICAgZnVuY3Rpb24gbWFya0Z1bmN0aW9uKGZuKSB7XG4gICAgICAgIGZuW2V4cGFuZG9dID0gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIGZuO1xuICAgICAgfVxuICAgICAgLyoqXG4gICAgICAgKiBTdXBwb3J0IHRlc3RpbmcgdXNpbmcgYW4gZWxlbWVudFxuICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZm4gUGFzc2VkIHRoZSBjcmVhdGVkIGVsZW1lbnQgYW5kIHJldHVybnMgYSBib29sZWFuIHJlc3VsdFxuICAgICAgICovXG5cblxuICAgICAgZnVuY3Rpb24gYXNzZXJ0KGZuKSB7XG4gICAgICAgIHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJmaWVsZHNldFwiKTtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgIHJldHVybiAhIWZuKGVsKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgICAvLyBSZW1vdmUgZnJvbSBpdHMgcGFyZW50IGJ5IGRlZmF1bHRcbiAgICAgICAgICBpZiAoZWwucGFyZW50Tm9kZSkge1xuICAgICAgICAgICAgZWwucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChlbCk7XG4gICAgICAgICAgfSAvLyByZWxlYXNlIG1lbW9yeSBpbiBJRVxuXG5cbiAgICAgICAgICBlbCA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIC8qKlxuICAgICAgICogQWRkcyB0aGUgc2FtZSBoYW5kbGVyIGZvciBhbGwgb2YgdGhlIHNwZWNpZmllZCBhdHRyc1xuICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGF0dHJzIFBpcGUtc2VwYXJhdGVkIGxpc3Qgb2YgYXR0cmlidXRlc1xuICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gaGFuZGxlciBUaGUgbWV0aG9kIHRoYXQgd2lsbCBiZSBhcHBsaWVkXG4gICAgICAgKi9cblxuXG4gICAgICBmdW5jdGlvbiBhZGRIYW5kbGUoYXR0cnMsIGhhbmRsZXIpIHtcbiAgICAgICAgdmFyIGFyciA9IGF0dHJzLnNwbGl0KFwifFwiKSxcbiAgICAgICAgICAgIGkgPSBhcnIubGVuZ3RoO1xuXG4gICAgICAgIHdoaWxlIChpLS0pIHtcbiAgICAgICAgICBFeHByLmF0dHJIYW5kbGVbYXJyW2ldXSA9IGhhbmRsZXI7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIC8qKlxuICAgICAgICogQ2hlY2tzIGRvY3VtZW50IG9yZGVyIG9mIHR3byBzaWJsaW5nc1xuICAgICAgICogQHBhcmFtIHtFbGVtZW50fSBhXG4gICAgICAgKiBAcGFyYW0ge0VsZW1lbnR9IGJcbiAgICAgICAqIEByZXR1cm5zIHtOdW1iZXJ9IFJldHVybnMgbGVzcyB0aGFuIDAgaWYgYSBwcmVjZWRlcyBiLCBncmVhdGVyIHRoYW4gMCBpZiBhIGZvbGxvd3MgYlxuICAgICAgICovXG5cblxuICAgICAgZnVuY3Rpb24gc2libGluZ0NoZWNrKGEsIGIpIHtcbiAgICAgICAgdmFyIGN1ciA9IGIgJiYgYSxcbiAgICAgICAgICAgIGRpZmYgPSBjdXIgJiYgYS5ub2RlVHlwZSA9PT0gMSAmJiBiLm5vZGVUeXBlID09PSAxICYmIGEuc291cmNlSW5kZXggLSBiLnNvdXJjZUluZGV4OyAvLyBVc2UgSUUgc291cmNlSW5kZXggaWYgYXZhaWxhYmxlIG9uIGJvdGggbm9kZXNcblxuICAgICAgICBpZiAoZGlmZikge1xuICAgICAgICAgIHJldHVybiBkaWZmO1xuICAgICAgICB9IC8vIENoZWNrIGlmIGIgZm9sbG93cyBhXG5cblxuICAgICAgICBpZiAoY3VyKSB7XG4gICAgICAgICAgd2hpbGUgKGN1ciA9IGN1ci5uZXh0U2libGluZykge1xuICAgICAgICAgICAgaWYgKGN1ciA9PT0gYikge1xuICAgICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGEgPyAxIDogLTE7XG4gICAgICB9XG4gICAgICAvKipcbiAgICAgICAqIFJldHVybnMgYSBmdW5jdGlvbiB0byB1c2UgaW4gcHNldWRvcyBmb3IgOmVuYWJsZWQvOmRpc2FibGVkXG4gICAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IGRpc2FibGVkIHRydWUgZm9yIDpkaXNhYmxlZDsgZmFsc2UgZm9yIDplbmFibGVkXG4gICAgICAgKi9cblxuXG4gICAgICBmdW5jdGlvbiBjcmVhdGVEaXNhYmxlZFBzZXVkbyhkaXNhYmxlZCkge1xuICAgICAgICAvLyBLbm93biA6ZGlzYWJsZWQgZmFsc2UgcG9zaXRpdmVzOiBmaWVsZHNldFtkaXNhYmxlZF0gPiBsZWdlbmQ6bnRoLW9mLXR5cGUobisyKSA6Y2FuLWRpc2FibGVcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICAgICAgLy8gT25seSBjZXJ0YWluIGVsZW1lbnRzIGNhbiBtYXRjaCA6ZW5hYmxlZCBvciA6ZGlzYWJsZWRcbiAgICAgICAgICAvLyBodHRwczovL2h0bWwuc3BlYy53aGF0d2cub3JnL211bHRpcGFnZS9zY3JpcHRpbmcuaHRtbCNzZWxlY3Rvci1lbmFibGVkXG4gICAgICAgICAgLy8gaHR0cHM6Ly9odG1sLnNwZWMud2hhdHdnLm9yZy9tdWx0aXBhZ2Uvc2NyaXB0aW5nLmh0bWwjc2VsZWN0b3ItZGlzYWJsZWRcbiAgICAgICAgICBpZiAoXCJmb3JtXCIgaW4gZWxlbSkge1xuICAgICAgICAgICAgLy8gQ2hlY2sgZm9yIGluaGVyaXRlZCBkaXNhYmxlZG5lc3Mgb24gcmVsZXZhbnQgbm9uLWRpc2FibGVkIGVsZW1lbnRzOlxuICAgICAgICAgICAgLy8gKiBsaXN0ZWQgZm9ybS1hc3NvY2lhdGVkIGVsZW1lbnRzIGluIGEgZGlzYWJsZWQgZmllbGRzZXRcbiAgICAgICAgICAgIC8vICAgaHR0cHM6Ly9odG1sLnNwZWMud2hhdHdnLm9yZy9tdWx0aXBhZ2UvZm9ybXMuaHRtbCNjYXRlZ29yeS1saXN0ZWRcbiAgICAgICAgICAgIC8vICAgaHR0cHM6Ly9odG1sLnNwZWMud2hhdHdnLm9yZy9tdWx0aXBhZ2UvZm9ybXMuaHRtbCNjb25jZXB0LWZlLWRpc2FibGVkXG4gICAgICAgICAgICAvLyAqIG9wdGlvbiBlbGVtZW50cyBpbiBhIGRpc2FibGVkIG9wdGdyb3VwXG4gICAgICAgICAgICAvLyAgIGh0dHBzOi8vaHRtbC5zcGVjLndoYXR3Zy5vcmcvbXVsdGlwYWdlL2Zvcm1zLmh0bWwjY29uY2VwdC1vcHRpb24tZGlzYWJsZWRcbiAgICAgICAgICAgIC8vIEFsbCBzdWNoIGVsZW1lbnRzIGhhdmUgYSBcImZvcm1cIiBwcm9wZXJ0eS5cbiAgICAgICAgICAgIGlmIChlbGVtLnBhcmVudE5vZGUgJiYgZWxlbS5kaXNhYmxlZCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgLy8gT3B0aW9uIGVsZW1lbnRzIGRlZmVyIHRvIGEgcGFyZW50IG9wdGdyb3VwIGlmIHByZXNlbnRcbiAgICAgICAgICAgICAgaWYgKFwibGFiZWxcIiBpbiBlbGVtKSB7XG4gICAgICAgICAgICAgICAgaWYgKFwibGFiZWxcIiBpbiBlbGVtLnBhcmVudE5vZGUpIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtLnBhcmVudE5vZGUuZGlzYWJsZWQgPT09IGRpc2FibGVkO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbS5kaXNhYmxlZCA9PT0gZGlzYWJsZWQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9IC8vIFN1cHBvcnQ6IElFIDYgLSAxMVxuICAgICAgICAgICAgICAvLyBVc2UgdGhlIGlzRGlzYWJsZWQgc2hvcnRjdXQgcHJvcGVydHkgdG8gY2hlY2sgZm9yIGRpc2FibGVkIGZpZWxkc2V0IGFuY2VzdG9yc1xuXG5cbiAgICAgICAgICAgICAgcmV0dXJuIGVsZW0uaXNEaXNhYmxlZCA9PT0gZGlzYWJsZWQgfHwgLy8gV2hlcmUgdGhlcmUgaXMgbm8gaXNEaXNhYmxlZCwgY2hlY2sgbWFudWFsbHlcblxuICAgICAgICAgICAgICAvKiBqc2hpbnQgLVcwMTggKi9cbiAgICAgICAgICAgICAgZWxlbS5pc0Rpc2FibGVkICE9PSAhZGlzYWJsZWQgJiYgaW5EaXNhYmxlZEZpZWxkc2V0KGVsZW0pID09PSBkaXNhYmxlZDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGVsZW0uZGlzYWJsZWQgPT09IGRpc2FibGVkOyAvLyBUcnkgdG8gd2lubm93IG91dCBlbGVtZW50cyB0aGF0IGNhbid0IGJlIGRpc2FibGVkIGJlZm9yZSB0cnVzdGluZyB0aGUgZGlzYWJsZWQgcHJvcGVydHkuXG4gICAgICAgICAgICAvLyBTb21lIHZpY3RpbXMgZ2V0IGNhdWdodCBpbiBvdXIgbmV0IChsYWJlbCwgbGVnZW5kLCBtZW51LCB0cmFjayksIGJ1dCBpdCBzaG91bGRuJ3RcbiAgICAgICAgICAgIC8vIGV2ZW4gZXhpc3Qgb24gdGhlbSwgbGV0IGFsb25lIGhhdmUgYSBib29sZWFuIHZhbHVlLlxuICAgICAgICAgIH0gZWxzZSBpZiAoXCJsYWJlbFwiIGluIGVsZW0pIHtcbiAgICAgICAgICAgIHJldHVybiBlbGVtLmRpc2FibGVkID09PSBkaXNhYmxlZDtcbiAgICAgICAgICB9IC8vIFJlbWFpbmluZyBlbGVtZW50cyBhcmUgbmVpdGhlciA6ZW5hYmxlZCBub3IgOmRpc2FibGVkXG5cblxuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIC8qKlxuICAgICAgICogQ2hlY2tzIGEgbm9kZSBmb3IgdmFsaWRpdHkgYXMgYSBTaXp6bGUgY29udGV4dFxuICAgICAgICogQHBhcmFtIHtFbGVtZW50fE9iamVjdD19IGNvbnRleHRcbiAgICAgICAqIEByZXR1cm5zIHtFbGVtZW50fE9iamVjdHxCb29sZWFufSBUaGUgaW5wdXQgbm9kZSBpZiBhY2NlcHRhYmxlLCBvdGhlcndpc2UgYSBmYWxzeSB2YWx1ZVxuICAgICAgICovXG5cblxuICAgICAgZnVuY3Rpb24gdGVzdENvbnRleHQoY29udGV4dCkge1xuICAgICAgICByZXR1cm4gY29udGV4dCAmJiB0eXBlb2YgY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSAhPT0gXCJ1bmRlZmluZWRcIiAmJiBjb250ZXh0O1xuICAgICAgfSAvLyBFeHBvc2Ugc3VwcG9ydCB2YXJzIGZvciBjb252ZW5pZW5jZVxuXG5cbiAgICAgIHN1cHBvcnQgPSBTaXp6bGUuc3VwcG9ydCA9IHt9O1xuICAgICAgLyoqXG4gICAgICAgKiBEZXRlY3RzIFhNTCBub2Rlc1xuICAgICAgICogQHBhcmFtIHtFbGVtZW50fE9iamVjdH0gZWxlbSBBbiBlbGVtZW50IG9yIGEgZG9jdW1lbnRcbiAgICAgICAqIEByZXR1cm5zIHtCb29sZWFufSBUcnVlIGlmZiBlbGVtIGlzIGEgbm9uLUhUTUwgWE1MIG5vZGVcbiAgICAgICAqL1xuXG4gICAgICBpc1hNTCA9IFNpenpsZS5pc1hNTCA9IGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICAgIC8vIGRvY3VtZW50RWxlbWVudCBpcyB2ZXJpZmllZCBmb3IgY2FzZXMgd2hlcmUgaXQgZG9lc24ndCB5ZXQgZXhpc3RcbiAgICAgICAgLy8gKHN1Y2ggYXMgbG9hZGluZyBpZnJhbWVzIGluIElFIC0gIzQ4MzMpXG4gICAgICAgIHZhciBkb2N1bWVudEVsZW1lbnQgPSBlbGVtICYmIChlbGVtLm93bmVyRG9jdW1lbnQgfHwgZWxlbSkuZG9jdW1lbnRFbGVtZW50O1xuICAgICAgICByZXR1cm4gZG9jdW1lbnRFbGVtZW50ID8gZG9jdW1lbnRFbGVtZW50Lm5vZGVOYW1lICE9PSBcIkhUTUxcIiA6IGZhbHNlO1xuICAgICAgfTtcbiAgICAgIC8qKlxuICAgICAgICogU2V0cyBkb2N1bWVudC1yZWxhdGVkIHZhcmlhYmxlcyBvbmNlIGJhc2VkIG9uIHRoZSBjdXJyZW50IGRvY3VtZW50XG4gICAgICAgKiBAcGFyYW0ge0VsZW1lbnR8T2JqZWN0fSBbZG9jXSBBbiBlbGVtZW50IG9yIGRvY3VtZW50IG9iamVjdCB0byB1c2UgdG8gc2V0IHRoZSBkb2N1bWVudFxuICAgICAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgY3VycmVudCBkb2N1bWVudFxuICAgICAgICovXG5cblxuICAgICAgc2V0RG9jdW1lbnQgPSBTaXp6bGUuc2V0RG9jdW1lbnQgPSBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgICB2YXIgaGFzQ29tcGFyZSxcbiAgICAgICAgICAgIHN1YldpbmRvdyxcbiAgICAgICAgICAgIGRvYyA9IG5vZGUgPyBub2RlLm93bmVyRG9jdW1lbnQgfHwgbm9kZSA6IHByZWZlcnJlZERvYzsgLy8gUmV0dXJuIGVhcmx5IGlmIGRvYyBpcyBpbnZhbGlkIG9yIGFscmVhZHkgc2VsZWN0ZWRcblxuICAgICAgICBpZiAoZG9jID09PSBkb2N1bWVudCB8fCBkb2Mubm9kZVR5cGUgIT09IDkgfHwgIWRvYy5kb2N1bWVudEVsZW1lbnQpIHtcbiAgICAgICAgICByZXR1cm4gZG9jdW1lbnQ7XG4gICAgICAgIH0gLy8gVXBkYXRlIGdsb2JhbCB2YXJpYWJsZXNcblxuXG4gICAgICAgIGRvY3VtZW50ID0gZG9jO1xuICAgICAgICBkb2NFbGVtID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50O1xuICAgICAgICBkb2N1bWVudElzSFRNTCA9ICFpc1hNTChkb2N1bWVudCk7IC8vIFN1cHBvcnQ6IElFIDktMTEsIEVkZ2VcbiAgICAgICAgLy8gQWNjZXNzaW5nIGlmcmFtZSBkb2N1bWVudHMgYWZ0ZXIgdW5sb2FkIHRocm93cyBcInBlcm1pc3Npb24gZGVuaWVkXCIgZXJyb3JzIChqUXVlcnkgIzEzOTM2KVxuXG4gICAgICAgIGlmIChwcmVmZXJyZWREb2MgIT09IGRvY3VtZW50ICYmIChzdWJXaW5kb3cgPSBkb2N1bWVudC5kZWZhdWx0VmlldykgJiYgc3ViV2luZG93LnRvcCAhPT0gc3ViV2luZG93KSB7XG4gICAgICAgICAgLy8gU3VwcG9ydDogSUUgMTEsIEVkZ2VcbiAgICAgICAgICBpZiAoc3ViV2luZG93LmFkZEV2ZW50TGlzdGVuZXIpIHtcbiAgICAgICAgICAgIHN1YldpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwidW5sb2FkXCIsIHVubG9hZEhhbmRsZXIsIGZhbHNlKTsgLy8gU3VwcG9ydDogSUUgOSAtIDEwIG9ubHlcbiAgICAgICAgICB9IGVsc2UgaWYgKHN1YldpbmRvdy5hdHRhY2hFdmVudCkge1xuICAgICAgICAgICAgc3ViV2luZG93LmF0dGFjaEV2ZW50KFwib251bmxvYWRcIiwgdW5sb2FkSGFuZGxlcik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8qIEF0dHJpYnV0ZXNcbiAgICAgICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuICAgICAgICAvLyBTdXBwb3J0OiBJRTw4XG4gICAgICAgIC8vIFZlcmlmeSB0aGF0IGdldEF0dHJpYnV0ZSByZWFsbHkgcmV0dXJucyBhdHRyaWJ1dGVzIGFuZCBub3QgcHJvcGVydGllc1xuICAgICAgICAvLyAoZXhjZXB0aW5nIElFOCBib29sZWFucylcblxuXG4gICAgICAgIHN1cHBvcnQuYXR0cmlidXRlcyA9IGFzc2VydChmdW5jdGlvbiAoZWwpIHtcbiAgICAgICAgICBlbC5jbGFzc05hbWUgPSBcImlcIjtcbiAgICAgICAgICByZXR1cm4gIWVsLmdldEF0dHJpYnV0ZShcImNsYXNzTmFtZVwiKTtcbiAgICAgICAgfSk7XG4gICAgICAgIC8qIGdldEVsZW1lbnQocylCeSpcbiAgICAgICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuICAgICAgICAvLyBDaGVjayBpZiBnZXRFbGVtZW50c0J5VGFnTmFtZShcIipcIikgcmV0dXJucyBvbmx5IGVsZW1lbnRzXG5cbiAgICAgICAgc3VwcG9ydC5nZXRFbGVtZW50c0J5VGFnTmFtZSA9IGFzc2VydChmdW5jdGlvbiAoZWwpIHtcbiAgICAgICAgICBlbC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVDb21tZW50KFwiXCIpKTtcbiAgICAgICAgICByZXR1cm4gIWVsLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiKlwiKS5sZW5ndGg7XG4gICAgICAgIH0pOyAvLyBTdXBwb3J0OiBJRTw5XG5cbiAgICAgICAgc3VwcG9ydC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lID0gcm5hdGl2ZS50ZXN0KGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUpOyAvLyBTdXBwb3J0OiBJRTwxMFxuICAgICAgICAvLyBDaGVjayBpZiBnZXRFbGVtZW50QnlJZCByZXR1cm5zIGVsZW1lbnRzIGJ5IG5hbWVcbiAgICAgICAgLy8gVGhlIGJyb2tlbiBnZXRFbGVtZW50QnlJZCBtZXRob2RzIGRvbid0IHBpY2sgdXAgcHJvZ3JhbW1hdGljYWxseS1zZXQgbmFtZXMsXG4gICAgICAgIC8vIHNvIHVzZSBhIHJvdW5kYWJvdXQgZ2V0RWxlbWVudHNCeU5hbWUgdGVzdFxuXG4gICAgICAgIHN1cHBvcnQuZ2V0QnlJZCA9IGFzc2VydChmdW5jdGlvbiAoZWwpIHtcbiAgICAgICAgICBkb2NFbGVtLmFwcGVuZENoaWxkKGVsKS5pZCA9IGV4cGFuZG87XG4gICAgICAgICAgcmV0dXJuICFkb2N1bWVudC5nZXRFbGVtZW50c0J5TmFtZSB8fCAhZG9jdW1lbnQuZ2V0RWxlbWVudHNCeU5hbWUoZXhwYW5kbykubGVuZ3RoO1xuICAgICAgICB9KTsgLy8gSUQgZmlsdGVyIGFuZCBmaW5kXG5cbiAgICAgICAgaWYgKHN1cHBvcnQuZ2V0QnlJZCkge1xuICAgICAgICAgIEV4cHIuZmlsdGVyW1wiSURcIl0gPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgICAgIHZhciBhdHRySWQgPSBpZC5yZXBsYWNlKHJ1bmVzY2FwZSwgZnVuZXNjYXBlKTtcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICAgICAgICByZXR1cm4gZWxlbS5nZXRBdHRyaWJ1dGUoXCJpZFwiKSA9PT0gYXR0cklkO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgRXhwci5maW5kW1wiSURcIl0gPSBmdW5jdGlvbiAoaWQsIGNvbnRleHQpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgY29udGV4dC5nZXRFbGVtZW50QnlJZCAhPT0gXCJ1bmRlZmluZWRcIiAmJiBkb2N1bWVudElzSFRNTCkge1xuICAgICAgICAgICAgICB2YXIgZWxlbSA9IGNvbnRleHQuZ2V0RWxlbWVudEJ5SWQoaWQpO1xuICAgICAgICAgICAgICByZXR1cm4gZWxlbSA/IFtlbGVtXSA6IFtdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgRXhwci5maWx0ZXJbXCJJRFwiXSA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgdmFyIGF0dHJJZCA9IGlkLnJlcGxhY2UocnVuZXNjYXBlLCBmdW5lc2NhcGUpO1xuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICAgICAgICAgIHZhciBub2RlID0gdHlwZW9mIGVsZW0uZ2V0QXR0cmlidXRlTm9kZSAhPT0gXCJ1bmRlZmluZWRcIiAmJiBlbGVtLmdldEF0dHJpYnV0ZU5vZGUoXCJpZFwiKTtcbiAgICAgICAgICAgICAgcmV0dXJuIG5vZGUgJiYgbm9kZS52YWx1ZSA9PT0gYXR0cklkO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9OyAvLyBTdXBwb3J0OiBJRSA2IC0gNyBvbmx5XG4gICAgICAgICAgLy8gZ2V0RWxlbWVudEJ5SWQgaXMgbm90IHJlbGlhYmxlIGFzIGEgZmluZCBzaG9ydGN1dFxuXG5cbiAgICAgICAgICBFeHByLmZpbmRbXCJJRFwiXSA9IGZ1bmN0aW9uIChpZCwgY29udGV4dCkge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBjb250ZXh0LmdldEVsZW1lbnRCeUlkICE9PSBcInVuZGVmaW5lZFwiICYmIGRvY3VtZW50SXNIVE1MKSB7XG4gICAgICAgICAgICAgIHZhciBub2RlLFxuICAgICAgICAgICAgICAgICAgaSxcbiAgICAgICAgICAgICAgICAgIGVsZW1zLFxuICAgICAgICAgICAgICAgICAgZWxlbSA9IGNvbnRleHQuZ2V0RWxlbWVudEJ5SWQoaWQpO1xuXG4gICAgICAgICAgICAgIGlmIChlbGVtKSB7XG4gICAgICAgICAgICAgICAgLy8gVmVyaWZ5IHRoZSBpZCBhdHRyaWJ1dGVcbiAgICAgICAgICAgICAgICBub2RlID0gZWxlbS5nZXRBdHRyaWJ1dGVOb2RlKFwiaWRcIik7XG5cbiAgICAgICAgICAgICAgICBpZiAobm9kZSAmJiBub2RlLnZhbHVlID09PSBpZCkge1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIFtlbGVtXTtcbiAgICAgICAgICAgICAgICB9IC8vIEZhbGwgYmFjayBvbiBnZXRFbGVtZW50c0J5TmFtZVxuXG5cbiAgICAgICAgICAgICAgICBlbGVtcyA9IGNvbnRleHQuZ2V0RWxlbWVudHNCeU5hbWUoaWQpO1xuICAgICAgICAgICAgICAgIGkgPSAwO1xuXG4gICAgICAgICAgICAgICAgd2hpbGUgKGVsZW0gPSBlbGVtc1tpKytdKSB7XG4gICAgICAgICAgICAgICAgICBub2RlID0gZWxlbS5nZXRBdHRyaWJ1dGVOb2RlKFwiaWRcIik7XG5cbiAgICAgICAgICAgICAgICAgIGlmIChub2RlICYmIG5vZGUudmFsdWUgPT09IGlkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbZWxlbV07XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH07XG4gICAgICAgIH0gLy8gVGFnXG5cblxuICAgICAgICBFeHByLmZpbmRbXCJUQUdcIl0gPSBzdXBwb3J0LmdldEVsZW1lbnRzQnlUYWdOYW1lID8gZnVuY3Rpb24gKHRhZywgY29udGV4dCkge1xuICAgICAgICAgIGlmICh0eXBlb2YgY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAgICAgcmV0dXJuIGNvbnRleHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUodGFnKTsgLy8gRG9jdW1lbnRGcmFnbWVudCBub2RlcyBkb24ndCBoYXZlIGdFQlROXG4gICAgICAgICAgfSBlbHNlIGlmIChzdXBwb3J0LnFzYSkge1xuICAgICAgICAgICAgcmV0dXJuIGNvbnRleHQucXVlcnlTZWxlY3RvckFsbCh0YWcpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSA6IGZ1bmN0aW9uICh0YWcsIGNvbnRleHQpIHtcbiAgICAgICAgICB2YXIgZWxlbSxcbiAgICAgICAgICAgICAgdG1wID0gW10sXG4gICAgICAgICAgICAgIGkgPSAwLFxuICAgICAgICAgICAgICAvLyBCeSBoYXBweSBjb2luY2lkZW5jZSwgYSAoYnJva2VuKSBnRUJUTiBhcHBlYXJzIG9uIERvY3VtZW50RnJhZ21lbnQgbm9kZXMgdG9vXG4gICAgICAgICAgcmVzdWx0cyA9IGNvbnRleHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUodGFnKTsgLy8gRmlsdGVyIG91dCBwb3NzaWJsZSBjb21tZW50c1xuXG4gICAgICAgICAgaWYgKHRhZyA9PT0gXCIqXCIpIHtcbiAgICAgICAgICAgIHdoaWxlIChlbGVtID0gcmVzdWx0c1tpKytdKSB7XG4gICAgICAgICAgICAgIGlmIChlbGVtLm5vZGVUeXBlID09PSAxKSB7XG4gICAgICAgICAgICAgICAgdG1wLnB1c2goZWxlbSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHRtcDtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICAgICAgfTsgLy8gQ2xhc3NcblxuICAgICAgICBFeHByLmZpbmRbXCJDTEFTU1wiXSA9IHN1cHBvcnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSAmJiBmdW5jdGlvbiAoY2xhc3NOYW1lLCBjb250ZXh0KSB7XG4gICAgICAgICAgaWYgKHR5cGVvZiBjb250ZXh0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUgIT09IFwidW5kZWZpbmVkXCIgJiYgZG9jdW1lbnRJc0hUTUwpIHtcbiAgICAgICAgICAgIHJldHVybiBjb250ZXh0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoY2xhc3NOYW1lKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIC8qIFFTQS9tYXRjaGVzU2VsZWN0b3JcbiAgICAgICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuICAgICAgICAvLyBRU0EgYW5kIG1hdGNoZXNTZWxlY3RvciBzdXBwb3J0XG4gICAgICAgIC8vIG1hdGNoZXNTZWxlY3Rvcig6YWN0aXZlKSByZXBvcnRzIGZhbHNlIHdoZW4gdHJ1ZSAoSUU5L09wZXJhIDExLjUpXG5cblxuICAgICAgICByYnVnZ3lNYXRjaGVzID0gW107IC8vIHFTYSg6Zm9jdXMpIHJlcG9ydHMgZmFsc2Ugd2hlbiB0cnVlIChDaHJvbWUgMjEpXG4gICAgICAgIC8vIFdlIGFsbG93IHRoaXMgYmVjYXVzZSBvZiBhIGJ1ZyBpbiBJRTgvOSB0aGF0IHRocm93cyBhbiBlcnJvclxuICAgICAgICAvLyB3aGVuZXZlciBgZG9jdW1lbnQuYWN0aXZlRWxlbWVudGAgaXMgYWNjZXNzZWQgb24gYW4gaWZyYW1lXG4gICAgICAgIC8vIFNvLCB3ZSBhbGxvdyA6Zm9jdXMgdG8gcGFzcyB0aHJvdWdoIFFTQSBhbGwgdGhlIHRpbWUgdG8gYXZvaWQgdGhlIElFIGVycm9yXG4gICAgICAgIC8vIFNlZSBodHRwczovL2J1Z3MuanF1ZXJ5LmNvbS90aWNrZXQvMTMzNzhcblxuICAgICAgICByYnVnZ3lRU0EgPSBbXTtcblxuICAgICAgICBpZiAoc3VwcG9ydC5xc2EgPSBybmF0aXZlLnRlc3QoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCkpIHtcbiAgICAgICAgICAvLyBCdWlsZCBRU0EgcmVnZXhcbiAgICAgICAgICAvLyBSZWdleCBzdHJhdGVneSBhZG9wdGVkIGZyb20gRGllZ28gUGVyaW5pXG4gICAgICAgICAgYXNzZXJ0KGZ1bmN0aW9uIChlbCkge1xuICAgICAgICAgICAgLy8gU2VsZWN0IGlzIHNldCB0byBlbXB0eSBzdHJpbmcgb24gcHVycG9zZVxuICAgICAgICAgICAgLy8gVGhpcyBpcyB0byB0ZXN0IElFJ3MgdHJlYXRtZW50IG9mIG5vdCBleHBsaWNpdGx5XG4gICAgICAgICAgICAvLyBzZXR0aW5nIGEgYm9vbGVhbiBjb250ZW50IGF0dHJpYnV0ZSxcbiAgICAgICAgICAgIC8vIHNpbmNlIGl0cyBwcmVzZW5jZSBzaG91bGQgYmUgZW5vdWdoXG4gICAgICAgICAgICAvLyBodHRwczovL2J1Z3MuanF1ZXJ5LmNvbS90aWNrZXQvMTIzNTlcbiAgICAgICAgICAgIGRvY0VsZW0uYXBwZW5kQ2hpbGQoZWwpLmlubmVySFRNTCA9IEFHUG9saWN5LmNyZWF0ZUhUTUwoXCI8YSBpZD0nXCIgKyBleHBhbmRvICsgXCInPjwvYT5cIiArIFwiPHNlbGVjdCBpZD0nXCIgKyBleHBhbmRvICsgXCItXFxyXFxcXCcgbXNhbGxvd2NhcHR1cmU9Jyc+XCIgKyBcIjxvcHRpb24gc2VsZWN0ZWQ9Jyc+PC9vcHRpb24+PC9zZWxlY3Q+XCIpOyAvLyBTdXBwb3J0OiBJRTgsIE9wZXJhIDExLTEyLjE2XG4gICAgICAgICAgICAvLyBOb3RoaW5nIHNob3VsZCBiZSBzZWxlY3RlZCB3aGVuIGVtcHR5IHN0cmluZ3MgZm9sbG93IF49IG9yICQ9IG9yICo9XG4gICAgICAgICAgICAvLyBUaGUgdGVzdCBhdHRyaWJ1dGUgbXVzdCBiZSB1bmtub3duIGluIE9wZXJhIGJ1dCBcInNhZmVcIiBmb3IgV2luUlRcbiAgICAgICAgICAgIC8vIGh0dHBzOi8vbXNkbi5taWNyb3NvZnQuY29tL2VuLXVzL2xpYnJhcnkvaWUvaGg0NjUzODguYXNweCNhdHRyaWJ1dGVfc2VjdGlvblxuXG4gICAgICAgICAgICBpZiAoZWwucXVlcnlTZWxlY3RvckFsbChcIlttc2FsbG93Y2FwdHVyZV49JyddXCIpLmxlbmd0aCkge1xuICAgICAgICAgICAgICByYnVnZ3lRU0EucHVzaChcIlsqXiRdPVwiICsgd2hpdGVzcGFjZSArIFwiKig/OicnfFxcXCJcXFwiKVwiKTtcbiAgICAgICAgICAgIH0gLy8gU3VwcG9ydDogSUU4XG4gICAgICAgICAgICAvLyBCb29sZWFuIGF0dHJpYnV0ZXMgYW5kIFwidmFsdWVcIiBhcmUgbm90IHRyZWF0ZWQgY29ycmVjdGx5XG5cblxuICAgICAgICAgICAgaWYgKCFlbC5xdWVyeVNlbGVjdG9yQWxsKFwiW3NlbGVjdGVkXVwiKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgcmJ1Z2d5UVNBLnB1c2goXCJcXFxcW1wiICsgd2hpdGVzcGFjZSArIFwiKig/OnZhbHVlfFwiICsgYm9vbGVhbnMgKyBcIilcIik7XG4gICAgICAgICAgICB9IC8vIFN1cHBvcnQ6IENocm9tZTwyOSwgQW5kcm9pZDw0LjQsIFNhZmFyaTw3LjArLCBpT1M8Ny4wKywgUGhhbnRvbUpTPDEuOS44K1xuXG5cbiAgICAgICAgICAgIGlmICghZWwucXVlcnlTZWxlY3RvckFsbChcIltpZH49XCIgKyBleHBhbmRvICsgXCItXVwiKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgcmJ1Z2d5UVNBLnB1c2goXCJ+PVwiKTtcbiAgICAgICAgICAgIH0gLy8gV2Via2l0L09wZXJhIC0gOmNoZWNrZWQgc2hvdWxkIHJldHVybiBzZWxlY3RlZCBvcHRpb24gZWxlbWVudHNcbiAgICAgICAgICAgIC8vIGh0dHA6Ly93d3cudzMub3JnL1RSLzIwMTEvUkVDLWNzczMtc2VsZWN0b3JzLTIwMTEwOTI5LyNjaGVja2VkXG4gICAgICAgICAgICAvLyBJRTggdGhyb3dzIGVycm9yIGhlcmUgYW5kIHdpbGwgbm90IHNlZSBsYXRlciB0ZXN0c1xuXG5cbiAgICAgICAgICAgIGlmICghZWwucXVlcnlTZWxlY3RvckFsbChcIjpjaGVja2VkXCIpLmxlbmd0aCkge1xuICAgICAgICAgICAgICByYnVnZ3lRU0EucHVzaChcIjpjaGVja2VkXCIpO1xuICAgICAgICAgICAgfSAvLyBTdXBwb3J0OiBTYWZhcmkgOCssIGlPUyA4K1xuICAgICAgICAgICAgLy8gaHR0cHM6Ly9idWdzLndlYmtpdC5vcmcvc2hvd19idWcuY2dpP2lkPTEzNjg1MVxuICAgICAgICAgICAgLy8gSW4tcGFnZSBgc2VsZWN0b3IjaWQgc2libGluZy1jb21iaW5hdG9yIHNlbGVjdG9yYCBmYWlsc1xuXG5cbiAgICAgICAgICAgIGlmICghZWwucXVlcnlTZWxlY3RvckFsbChcImEjXCIgKyBleHBhbmRvICsgXCIrKlwiKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgcmJ1Z2d5UVNBLnB1c2goXCIuIy4rWyt+XVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgICBhc3NlcnQoZnVuY3Rpb24gKGVsKSB7XG4gICAgICAgICAgICBlbC5pbm5lckhUTUwgPSBBR1BvbGljeS5jcmVhdGVIVE1MKFwiPGEgaHJlZj0nJyBkaXNhYmxlZD0nZGlzYWJsZWQnPjwvYT5cIiArIFwiPHNlbGVjdCBkaXNhYmxlZD0nZGlzYWJsZWQnPjxvcHRpb24vPjwvc2VsZWN0PlwiKTsgLy8gU3VwcG9ydDogV2luZG93cyA4IE5hdGl2ZSBBcHBzXG4gICAgICAgICAgICAvLyBUaGUgdHlwZSBhbmQgbmFtZSBhdHRyaWJ1dGVzIGFyZSByZXN0cmljdGVkIGR1cmluZyAuaW5uZXJIVE1MIGFzc2lnbm1lbnRcblxuICAgICAgICAgICAgdmFyIGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpO1xuICAgICAgICAgICAgaW5wdXQuc2V0QXR0cmlidXRlKFwidHlwZVwiLCBcImhpZGRlblwiKTtcbiAgICAgICAgICAgIGVsLmFwcGVuZENoaWxkKGlucHV0KS5zZXRBdHRyaWJ1dGUoXCJuYW1lXCIsIFwiRFwiKTsgLy8gU3VwcG9ydDogSUU4XG4gICAgICAgICAgICAvLyBFbmZvcmNlIGNhc2Utc2Vuc2l0aXZpdHkgb2YgbmFtZSBhdHRyaWJ1dGVcblxuICAgICAgICAgICAgaWYgKGVsLnF1ZXJ5U2VsZWN0b3JBbGwoXCJbbmFtZT1kXVwiKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgcmJ1Z2d5UVNBLnB1c2goXCJuYW1lXCIgKyB3aGl0ZXNwYWNlICsgXCIqWypeJHwhfl0/PVwiKTtcbiAgICAgICAgICAgIH0gLy8gRkYgMy41IC0gOmVuYWJsZWQvOmRpc2FibGVkIGFuZCBoaWRkZW4gZWxlbWVudHMgKGhpZGRlbiBlbGVtZW50cyBhcmUgc3RpbGwgZW5hYmxlZClcbiAgICAgICAgICAgIC8vIElFOCB0aHJvd3MgZXJyb3IgaGVyZSBhbmQgd2lsbCBub3Qgc2VlIGxhdGVyIHRlc3RzXG5cblxuICAgICAgICAgICAgaWYgKGVsLnF1ZXJ5U2VsZWN0b3JBbGwoXCI6ZW5hYmxlZFwiKS5sZW5ndGggIT09IDIpIHtcbiAgICAgICAgICAgICAgcmJ1Z2d5UVNBLnB1c2goXCI6ZW5hYmxlZFwiLCBcIjpkaXNhYmxlZFwiKTtcbiAgICAgICAgICAgIH0gLy8gU3VwcG9ydDogSUU5LTExK1xuICAgICAgICAgICAgLy8gSUUncyA6ZGlzYWJsZWQgc2VsZWN0b3IgZG9lcyBub3QgcGljayB1cCB0aGUgY2hpbGRyZW4gb2YgZGlzYWJsZWQgZmllbGRzZXRzXG5cblxuICAgICAgICAgICAgZG9jRWxlbS5hcHBlbmRDaGlsZChlbCkuZGlzYWJsZWQgPSB0cnVlO1xuXG4gICAgICAgICAgICBpZiAoZWwucXVlcnlTZWxlY3RvckFsbChcIjpkaXNhYmxlZFwiKS5sZW5ndGggIT09IDIpIHtcbiAgICAgICAgICAgICAgcmJ1Z2d5UVNBLnB1c2goXCI6ZW5hYmxlZFwiLCBcIjpkaXNhYmxlZFwiKTtcbiAgICAgICAgICAgIH0gLy8gT3BlcmEgMTAtMTEgZG9lcyBub3QgdGhyb3cgb24gcG9zdC1jb21tYSBpbnZhbGlkIHBzZXVkb3NcblxuXG4gICAgICAgICAgICBlbC5xdWVyeVNlbGVjdG9yQWxsKFwiKiw6eFwiKTtcbiAgICAgICAgICAgIHJidWdneVFTQS5wdXNoKFwiLC4qOlwiKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChzdXBwb3J0Lm1hdGNoZXNTZWxlY3RvciA9IHJuYXRpdmUudGVzdChtYXRjaGVzID0gZG9jRWxlbS5tYXRjaGVzIHx8IGRvY0VsZW0ud2Via2l0TWF0Y2hlc1NlbGVjdG9yIHx8IGRvY0VsZW0ubW96TWF0Y2hlc1NlbGVjdG9yIHx8IGRvY0VsZW0ub01hdGNoZXNTZWxlY3RvciB8fCBkb2NFbGVtLm1zTWF0Y2hlc1NlbGVjdG9yKSkge1xuICAgICAgICAgIGFzc2VydChmdW5jdGlvbiAoZWwpIHtcbiAgICAgICAgICAgIC8vIENoZWNrIHRvIHNlZSBpZiBpdCdzIHBvc3NpYmxlIHRvIGRvIG1hdGNoZXNTZWxlY3RvclxuICAgICAgICAgICAgLy8gb24gYSBkaXNjb25uZWN0ZWQgbm9kZSAoSUUgOSlcbiAgICAgICAgICAgIHN1cHBvcnQuZGlzY29ubmVjdGVkTWF0Y2ggPSBtYXRjaGVzLmNhbGwoZWwsIFwiKlwiKTsgLy8gVGhpcyBzaG91bGQgZmFpbCB3aXRoIGFuIGV4Y2VwdGlvblxuICAgICAgICAgICAgLy8gR2Vja28gZG9lcyBub3QgZXJyb3IsIHJldHVybnMgZmFsc2UgaW5zdGVhZFxuXG4gICAgICAgICAgICBtYXRjaGVzLmNhbGwoZWwsIFwiW3MhPScnXTp4XCIpO1xuICAgICAgICAgICAgcmJ1Z2d5TWF0Y2hlcy5wdXNoKFwiIT1cIiwgcHNldWRvcyk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByYnVnZ3lRU0EgPSByYnVnZ3lRU0EubGVuZ3RoICYmIG5ldyBSZWdFeHAocmJ1Z2d5UVNBLmpvaW4oXCJ8XCIpKTtcbiAgICAgICAgcmJ1Z2d5TWF0Y2hlcyA9IHJidWdneU1hdGNoZXMubGVuZ3RoICYmIG5ldyBSZWdFeHAocmJ1Z2d5TWF0Y2hlcy5qb2luKFwifFwiKSk7XG4gICAgICAgIC8qIENvbnRhaW5zXG4gICAgICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuICAgICAgICBoYXNDb21wYXJlID0gcm5hdGl2ZS50ZXN0KGRvY0VsZW0uY29tcGFyZURvY3VtZW50UG9zaXRpb24pOyAvLyBFbGVtZW50IGNvbnRhaW5zIGFub3RoZXJcbiAgICAgICAgLy8gUHVycG9zZWZ1bGx5IHNlbGYtZXhjbHVzaXZlXG4gICAgICAgIC8vIEFzIGluLCBhbiBlbGVtZW50IGRvZXMgbm90IGNvbnRhaW4gaXRzZWxmXG5cbiAgICAgICAgY29udGFpbnMgPSBoYXNDb21wYXJlIHx8IHJuYXRpdmUudGVzdChkb2NFbGVtLmNvbnRhaW5zKSA/IGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgICAgdmFyIGFkb3duID0gYS5ub2RlVHlwZSA9PT0gOSA/IGEuZG9jdW1lbnRFbGVtZW50IDogYSxcbiAgICAgICAgICAgICAgYnVwID0gYiAmJiBiLnBhcmVudE5vZGU7XG4gICAgICAgICAgcmV0dXJuIGEgPT09IGJ1cCB8fCAhIShidXAgJiYgYnVwLm5vZGVUeXBlID09PSAxICYmIChhZG93bi5jb250YWlucyA/IGFkb3duLmNvbnRhaW5zKGJ1cCkgOiBhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uICYmIGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24oYnVwKSAmIDE2KSk7XG4gICAgICAgIH0gOiBmdW5jdGlvbiAoYSwgYikge1xuICAgICAgICAgIGlmIChiKSB7XG4gICAgICAgICAgICB3aGlsZSAoYiA9IGIucGFyZW50Tm9kZSkge1xuICAgICAgICAgICAgICBpZiAoYiA9PT0gYSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9O1xuICAgICAgICAvKiBTb3J0aW5nXG4gICAgICAgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cbiAgICAgICAgLy8gRG9jdW1lbnQgb3JkZXIgc29ydGluZ1xuXG4gICAgICAgIHNvcnRPcmRlciA9IGhhc0NvbXBhcmUgPyBmdW5jdGlvbiAoYSwgYikge1xuICAgICAgICAgIC8vIEZsYWcgZm9yIGR1cGxpY2F0ZSByZW1vdmFsXG4gICAgICAgICAgaWYgKGEgPT09IGIpIHtcbiAgICAgICAgICAgIGhhc0R1cGxpY2F0ZSA9IHRydWU7XG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICB9IC8vIFNvcnQgb24gbWV0aG9kIGV4aXN0ZW5jZSBpZiBvbmx5IG9uZSBpbnB1dCBoYXMgY29tcGFyZURvY3VtZW50UG9zaXRpb25cblxuXG4gICAgICAgICAgdmFyIGNvbXBhcmUgPSAhYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiAtICFiLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uO1xuXG4gICAgICAgICAgaWYgKGNvbXBhcmUpIHtcbiAgICAgICAgICAgIHJldHVybiBjb21wYXJlO1xuICAgICAgICAgIH0gLy8gQ2FsY3VsYXRlIHBvc2l0aW9uIGlmIGJvdGggaW5wdXRzIGJlbG9uZyB0byB0aGUgc2FtZSBkb2N1bWVudFxuXG5cbiAgICAgICAgICBjb21wYXJlID0gKGEub3duZXJEb2N1bWVudCB8fCBhKSA9PT0gKGIub3duZXJEb2N1bWVudCB8fCBiKSA/IGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24oYikgOiAvLyBPdGhlcndpc2Ugd2Uga25vdyB0aGV5IGFyZSBkaXNjb25uZWN0ZWRcbiAgICAgICAgICAxOyAvLyBEaXNjb25uZWN0ZWQgbm9kZXNcblxuICAgICAgICAgIGlmIChjb21wYXJlICYgMSB8fCAhc3VwcG9ydC5zb3J0RGV0YWNoZWQgJiYgYi5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbihhKSA9PT0gY29tcGFyZSkge1xuICAgICAgICAgICAgLy8gQ2hvb3NlIHRoZSBmaXJzdCBlbGVtZW50IHRoYXQgaXMgcmVsYXRlZCB0byBvdXIgcHJlZmVycmVkIGRvY3VtZW50XG4gICAgICAgICAgICBpZiAoYSA9PT0gZG9jdW1lbnQgfHwgYS5vd25lckRvY3VtZW50ID09PSBwcmVmZXJyZWREb2MgJiYgY29udGFpbnMocHJlZmVycmVkRG9jLCBhKSkge1xuICAgICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChiID09PSBkb2N1bWVudCB8fCBiLm93bmVyRG9jdW1lbnQgPT09IHByZWZlcnJlZERvYyAmJiBjb250YWlucyhwcmVmZXJyZWREb2MsIGIpKSB7XG4gICAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICAgICAgfSAvLyBNYWludGFpbiBvcmlnaW5hbCBvcmRlclxuXG5cbiAgICAgICAgICAgIHJldHVybiBzb3J0SW5wdXQgPyBpbmRleE9mKHNvcnRJbnB1dCwgYSkgLSBpbmRleE9mKHNvcnRJbnB1dCwgYikgOiAwO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiBjb21wYXJlICYgNCA/IC0xIDogMTtcbiAgICAgICAgfSA6IGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgICAgLy8gRXhpdCBlYXJseSBpZiB0aGUgbm9kZXMgYXJlIGlkZW50aWNhbFxuICAgICAgICAgIGlmIChhID09PSBiKSB7XG4gICAgICAgICAgICBoYXNEdXBsaWNhdGUgPSB0cnVlO1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdmFyIGN1cixcbiAgICAgICAgICAgICAgaSA9IDAsXG4gICAgICAgICAgICAgIGF1cCA9IGEucGFyZW50Tm9kZSxcbiAgICAgICAgICAgICAgYnVwID0gYi5wYXJlbnROb2RlLFxuICAgICAgICAgICAgICBhcCA9IFthXSxcbiAgICAgICAgICAgICAgYnAgPSBbYl07IC8vIFBhcmVudGxlc3Mgbm9kZXMgYXJlIGVpdGhlciBkb2N1bWVudHMgb3IgZGlzY29ubmVjdGVkXG5cbiAgICAgICAgICBpZiAoIWF1cCB8fCAhYnVwKSB7XG4gICAgICAgICAgICByZXR1cm4gYSA9PT0gZG9jdW1lbnQgPyAtMSA6IGIgPT09IGRvY3VtZW50ID8gMSA6IGF1cCA/IC0xIDogYnVwID8gMSA6IHNvcnRJbnB1dCA/IGluZGV4T2Yoc29ydElucHV0LCBhKSAtIGluZGV4T2Yoc29ydElucHV0LCBiKSA6IDA7IC8vIElmIHRoZSBub2RlcyBhcmUgc2libGluZ3MsIHdlIGNhbiBkbyBhIHF1aWNrIGNoZWNrXG4gICAgICAgICAgfSBlbHNlIGlmIChhdXAgPT09IGJ1cCkge1xuICAgICAgICAgICAgcmV0dXJuIHNpYmxpbmdDaGVjayhhLCBiKTtcbiAgICAgICAgICB9IC8vIE90aGVyd2lzZSB3ZSBuZWVkIGZ1bGwgbGlzdHMgb2YgdGhlaXIgYW5jZXN0b3JzIGZvciBjb21wYXJpc29uXG5cblxuICAgICAgICAgIGN1ciA9IGE7XG5cbiAgICAgICAgICB3aGlsZSAoY3VyID0gY3VyLnBhcmVudE5vZGUpIHtcbiAgICAgICAgICAgIGFwLnVuc2hpZnQoY3VyKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBjdXIgPSBiO1xuXG4gICAgICAgICAgd2hpbGUgKGN1ciA9IGN1ci5wYXJlbnROb2RlKSB7XG4gICAgICAgICAgICBicC51bnNoaWZ0KGN1cik7XG4gICAgICAgICAgfSAvLyBXYWxrIGRvd24gdGhlIHRyZWUgbG9va2luZyBmb3IgYSBkaXNjcmVwYW5jeVxuXG5cbiAgICAgICAgICB3aGlsZSAoYXBbaV0gPT09IGJwW2ldKSB7XG4gICAgICAgICAgICBpKys7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIGkgPyAvLyBEbyBhIHNpYmxpbmcgY2hlY2sgaWYgdGhlIG5vZGVzIGhhdmUgYSBjb21tb24gYW5jZXN0b3JcbiAgICAgICAgICBzaWJsaW5nQ2hlY2soYXBbaV0sIGJwW2ldKSA6IC8vIE90aGVyd2lzZSBub2RlcyBpbiBvdXIgZG9jdW1lbnQgc29ydCBmaXJzdFxuICAgICAgICAgIGFwW2ldID09PSBwcmVmZXJyZWREb2MgPyAtMSA6IGJwW2ldID09PSBwcmVmZXJyZWREb2MgPyAxIDogMDtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGRvY3VtZW50O1xuICAgICAgfTtcblxuICAgICAgU2l6emxlLm1hdGNoZXMgPSBmdW5jdGlvbiAoZXhwciwgZWxlbWVudHMpIHtcbiAgICAgICAgcmV0dXJuIFNpenpsZShleHByLCBudWxsLCBudWxsLCBlbGVtZW50cyk7XG4gICAgICB9O1xuXG4gICAgICBTaXp6bGUubWF0Y2hlc1NlbGVjdG9yID0gZnVuY3Rpb24gKGVsZW0sIGV4cHIpIHtcbiAgICAgICAgLy8gU2V0IGRvY3VtZW50IHZhcnMgaWYgbmVlZGVkXG4gICAgICAgIGlmICgoZWxlbS5vd25lckRvY3VtZW50IHx8IGVsZW0pICE9PSBkb2N1bWVudCkge1xuICAgICAgICAgIHNldERvY3VtZW50KGVsZW0pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHN1cHBvcnQubWF0Y2hlc1NlbGVjdG9yICYmIGRvY3VtZW50SXNIVE1MICYmICFub25uYXRpdmVTZWxlY3RvckNhY2hlW2V4cHIgKyBcIiBcIl0gJiYgKCFyYnVnZ3lNYXRjaGVzIHx8ICFyYnVnZ3lNYXRjaGVzLnRlc3QoZXhwcikpICYmICghcmJ1Z2d5UVNBIHx8ICFyYnVnZ3lRU0EudGVzdChleHByKSkpIHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgdmFyIHJldCA9IG1hdGNoZXMuY2FsbChlbGVtLCBleHByKTsgLy8gSUUgOSdzIG1hdGNoZXNTZWxlY3RvciByZXR1cm5zIGZhbHNlIG9uIGRpc2Nvbm5lY3RlZCBub2Rlc1xuXG4gICAgICAgICAgICBpZiAocmV0IHx8IHN1cHBvcnQuZGlzY29ubmVjdGVkTWF0Y2ggfHwgLy8gQXMgd2VsbCwgZGlzY29ubmVjdGVkIG5vZGVzIGFyZSBzYWlkIHRvIGJlIGluIGEgZG9jdW1lbnRcbiAgICAgICAgICAgIC8vIGZyYWdtZW50IGluIElFIDlcbiAgICAgICAgICAgIGVsZW0uZG9jdW1lbnQgJiYgZWxlbS5kb2N1bWVudC5ub2RlVHlwZSAhPT0gMTEpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHJldDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAvLyBbQWRHdWFyZCBQYXRoXTogRml4IHRoZSBjYWNoZSB2YWx1ZVxuICAgICAgICAgICAgbm9ubmF0aXZlU2VsZWN0b3JDYWNoZShleHByLCB0cnVlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gU2l6emxlKGV4cHIsIGRvY3VtZW50LCBudWxsLCBbZWxlbV0pLmxlbmd0aCA+IDA7XG4gICAgICB9O1xuXG4gICAgICBTaXp6bGUuY29udGFpbnMgPSBmdW5jdGlvbiAoY29udGV4dCwgZWxlbSkge1xuICAgICAgICAvLyBTZXQgZG9jdW1lbnQgdmFycyBpZiBuZWVkZWRcbiAgICAgICAgaWYgKChjb250ZXh0Lm93bmVyRG9jdW1lbnQgfHwgY29udGV4dCkgIT09IGRvY3VtZW50KSB7XG4gICAgICAgICAgc2V0RG9jdW1lbnQoY29udGV4dCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gY29udGFpbnMoY29udGV4dCwgZWxlbSk7XG4gICAgICB9O1xuXG4gICAgICBTaXp6bGUuYXR0ciA9IGZ1bmN0aW9uIChlbGVtLCBuYW1lKSB7XG4gICAgICAgIC8vIFNldCBkb2N1bWVudCB2YXJzIGlmIG5lZWRlZFxuICAgICAgICBpZiAoKGVsZW0ub3duZXJEb2N1bWVudCB8fCBlbGVtKSAhPT0gZG9jdW1lbnQpIHtcbiAgICAgICAgICBzZXREb2N1bWVudChlbGVtKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBmbiA9IEV4cHIuYXR0ckhhbmRsZVtuYW1lLnRvTG93ZXJDYXNlKCldLFxuICAgICAgICAgICAgLy8gRG9uJ3QgZ2V0IGZvb2xlZCBieSBPYmplY3QucHJvdG90eXBlIHByb3BlcnRpZXMgKGpRdWVyeSAjMTM4MDcpXG4gICAgICAgIHZhbCA9IGZuICYmIGhhc093bi5jYWxsKEV4cHIuYXR0ckhhbmRsZSwgbmFtZS50b0xvd2VyQ2FzZSgpKSA/IGZuKGVsZW0sIG5hbWUsICFkb2N1bWVudElzSFRNTCkgOiB1bmRlZmluZWQ7XG4gICAgICAgIHJldHVybiB2YWwgIT09IHVuZGVmaW5lZCA/IHZhbCA6IHN1cHBvcnQuYXR0cmlidXRlcyB8fCAhZG9jdW1lbnRJc0hUTUwgPyBlbGVtLmdldEF0dHJpYnV0ZShuYW1lKSA6ICh2YWwgPSBlbGVtLmdldEF0dHJpYnV0ZU5vZGUobmFtZSkpICYmIHZhbC5zcGVjaWZpZWQgPyB2YWwudmFsdWUgOiBudWxsO1xuICAgICAgfTtcblxuICAgICAgU2l6emxlLmVzY2FwZSA9IGZ1bmN0aW9uIChzZWwpIHtcbiAgICAgICAgcmV0dXJuIChzZWwgKyBcIlwiKS5yZXBsYWNlKHJjc3Nlc2NhcGUsIGZjc3Nlc2NhcGUpO1xuICAgICAgfTtcblxuICAgICAgU2l6emxlLmVycm9yID0gZnVuY3Rpb24gKG1zZykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTeW50YXggZXJyb3IsIHVucmVjb2duaXplZCBleHByZXNzaW9uOiBcIiArIG1zZyk7XG4gICAgICB9O1xuICAgICAgLyoqXG4gICAgICAgKiBEb2N1bWVudCBzb3J0aW5nIGFuZCByZW1vdmluZyBkdXBsaWNhdGVzXG4gICAgICAgKiBAcGFyYW0ge0FycmF5TGlrZX0gcmVzdWx0c1xuICAgICAgICovXG5cblxuICAgICAgU2l6emxlLnVuaXF1ZVNvcnQgPSBmdW5jdGlvbiAocmVzdWx0cykge1xuICAgICAgICB2YXIgZWxlbSxcbiAgICAgICAgICAgIGR1cGxpY2F0ZXMgPSBbXSxcbiAgICAgICAgICAgIGogPSAwLFxuICAgICAgICAgICAgaSA9IDA7IC8vIFVubGVzcyB3ZSAqa25vdyogd2UgY2FuIGRldGVjdCBkdXBsaWNhdGVzLCBhc3N1bWUgdGhlaXIgcHJlc2VuY2VcblxuICAgICAgICBoYXNEdXBsaWNhdGUgPSAhc3VwcG9ydC5kZXRlY3REdXBsaWNhdGVzO1xuICAgICAgICBzb3J0SW5wdXQgPSAhc3VwcG9ydC5zb3J0U3RhYmxlICYmIHJlc3VsdHMuc2xpY2UoMCk7XG4gICAgICAgIHJlc3VsdHMuc29ydChzb3J0T3JkZXIpO1xuXG4gICAgICAgIGlmIChoYXNEdXBsaWNhdGUpIHtcbiAgICAgICAgICB3aGlsZSAoZWxlbSA9IHJlc3VsdHNbaSsrXSkge1xuICAgICAgICAgICAgaWYgKGVsZW0gPT09IHJlc3VsdHNbaV0pIHtcbiAgICAgICAgICAgICAgaiA9IGR1cGxpY2F0ZXMucHVzaChpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cbiAgICAgICAgICB3aGlsZSAoai0tKSB7XG4gICAgICAgICAgICByZXN1bHRzLnNwbGljZShkdXBsaWNhdGVzW2pdLCAxKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gLy8gQ2xlYXIgaW5wdXQgYWZ0ZXIgc29ydGluZyB0byByZWxlYXNlIG9iamVjdHNcbiAgICAgICAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9qcXVlcnkvc2l6emxlL3B1bGwvMjI1XG5cblxuICAgICAgICBzb3J0SW5wdXQgPSBudWxsO1xuICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICAgIH07XG4gICAgICAvKipcbiAgICAgICAqIFV0aWxpdHkgZnVuY3Rpb24gZm9yIHJldHJpZXZpbmcgdGhlIHRleHQgdmFsdWUgb2YgYW4gYXJyYXkgb2YgRE9NIG5vZGVzXG4gICAgICAgKiBAcGFyYW0ge0FycmF5fEVsZW1lbnR9IGVsZW1cbiAgICAgICAqL1xuXG5cbiAgICAgIGdldFRleHQgPSBTaXp6bGUuZ2V0VGV4dCA9IGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICAgIHZhciBub2RlLFxuICAgICAgICAgICAgcmV0ID0gXCJcIixcbiAgICAgICAgICAgIGkgPSAwLFxuICAgICAgICAgICAgbm9kZVR5cGUgPSBlbGVtLm5vZGVUeXBlO1xuXG4gICAgICAgIGlmICghbm9kZVR5cGUpIHtcbiAgICAgICAgICAvLyBJZiBubyBub2RlVHlwZSwgdGhpcyBpcyBleHBlY3RlZCB0byBiZSBhbiBhcnJheVxuICAgICAgICAgIHdoaWxlIChub2RlID0gZWxlbVtpKytdKSB7XG4gICAgICAgICAgICAvLyBEbyBub3QgdHJhdmVyc2UgY29tbWVudCBub2Rlc1xuICAgICAgICAgICAgcmV0ICs9IGdldFRleHQobm9kZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKG5vZGVUeXBlID09PSAxIHx8IG5vZGVUeXBlID09PSA5IHx8IG5vZGVUeXBlID09PSAxMSkge1xuICAgICAgICAgIC8vIFVzZSB0ZXh0Q29udGVudCBmb3IgZWxlbWVudHNcbiAgICAgICAgICAvLyBpbm5lclRleHQgdXNhZ2UgcmVtb3ZlZCBmb3IgY29uc2lzdGVuY3kgb2YgbmV3IGxpbmVzIChqUXVlcnkgIzExMTUzKVxuICAgICAgICAgIGlmICh0eXBlb2YgZWxlbS50ZXh0Q29udGVudCA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgcmV0dXJuIGVsZW0udGV4dENvbnRlbnQ7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIFRyYXZlcnNlIGl0cyBjaGlsZHJlblxuICAgICAgICAgICAgZm9yIChlbGVtID0gZWxlbS5maXJzdENoaWxkOyBlbGVtOyBlbGVtID0gZWxlbS5uZXh0U2libGluZykge1xuICAgICAgICAgICAgICByZXQgKz0gZ2V0VGV4dChlbGVtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAobm9kZVR5cGUgPT09IDMgfHwgbm9kZVR5cGUgPT09IDQpIHtcbiAgICAgICAgICByZXR1cm4gZWxlbS5ub2RlVmFsdWU7XG4gICAgICAgIH0gLy8gRG8gbm90IGluY2x1ZGUgY29tbWVudCBvciBwcm9jZXNzaW5nIGluc3RydWN0aW9uIG5vZGVzXG5cblxuICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgfTtcblxuICAgICAgRXhwciA9IFNpenpsZS5zZWxlY3RvcnMgPSB7XG4gICAgICAgIC8vIENhbiBiZSBhZGp1c3RlZCBieSB0aGUgdXNlclxuICAgICAgICBjYWNoZUxlbmd0aDogNTAsXG4gICAgICAgIGNyZWF0ZVBzZXVkbzogbWFya0Z1bmN0aW9uLFxuICAgICAgICBtYXRjaDogbWF0Y2hFeHByLFxuICAgICAgICBhdHRySGFuZGxlOiB7fSxcbiAgICAgICAgZmluZDoge30sXG4gICAgICAgIHJlbGF0aXZlOiB7XG4gICAgICAgICAgXCI+XCI6IHtcbiAgICAgICAgICAgIGRpcjogXCJwYXJlbnROb2RlXCIsXG4gICAgICAgICAgICBmaXJzdDogdHJ1ZVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCIgXCI6IHtcbiAgICAgICAgICAgIGRpcjogXCJwYXJlbnROb2RlXCJcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiK1wiOiB7XG4gICAgICAgICAgICBkaXI6IFwicHJldmlvdXNTaWJsaW5nXCIsXG4gICAgICAgICAgICBmaXJzdDogdHJ1ZVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJ+XCI6IHtcbiAgICAgICAgICAgIGRpcjogXCJwcmV2aW91c1NpYmxpbmdcIlxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgcHJlRmlsdGVyOiB7XG4gICAgICAgICAgXCJBVFRSXCI6IGZ1bmN0aW9uIEFUVFIobWF0Y2gpIHtcbiAgICAgICAgICAgIG1hdGNoWzFdID0gbWF0Y2hbMV0ucmVwbGFjZShydW5lc2NhcGUsIGZ1bmVzY2FwZSk7IC8vIE1vdmUgdGhlIGdpdmVuIHZhbHVlIHRvIG1hdGNoWzNdIHdoZXRoZXIgcXVvdGVkIG9yIHVucXVvdGVkXG5cbiAgICAgICAgICAgIG1hdGNoWzNdID0gKG1hdGNoWzNdIHx8IG1hdGNoWzRdIHx8IG1hdGNoWzVdIHx8IFwiXCIpLnJlcGxhY2UocnVuZXNjYXBlLCBmdW5lc2NhcGUpO1xuXG4gICAgICAgICAgICBpZiAobWF0Y2hbMl0gPT09IFwifj1cIikge1xuICAgICAgICAgICAgICBtYXRjaFszXSA9IFwiIFwiICsgbWF0Y2hbM10gKyBcIiBcIjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIG1hdGNoLnNsaWNlKDAsIDQpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJDSElMRFwiOiBmdW5jdGlvbiBDSElMRChtYXRjaCkge1xuICAgICAgICAgICAgLyogbWF0Y2hlcyBmcm9tIG1hdGNoRXhwcltcIkNISUxEXCJdXG4gICAgICAgICAgICBcdDEgdHlwZSAob25seXxudGh8Li4uKVxuICAgICAgICAgICAgXHQyIHdoYXQgKGNoaWxkfG9mLXR5cGUpXG4gICAgICAgICAgICBcdDMgYXJndW1lbnQgKGV2ZW58b2RkfFxcZCp8XFxkKm4oWystXVxcZCspP3wuLi4pXG4gICAgICAgICAgICBcdDQgeG4tY29tcG9uZW50IG9mIHhuK3kgYXJndW1lbnQgKFsrLV0/XFxkKm58KVxuICAgICAgICAgICAgXHQ1IHNpZ24gb2YgeG4tY29tcG9uZW50XG4gICAgICAgICAgICBcdDYgeCBvZiB4bi1jb21wb25lbnRcbiAgICAgICAgICAgIFx0NyBzaWduIG9mIHktY29tcG9uZW50XG4gICAgICAgICAgICBcdDggeSBvZiB5LWNvbXBvbmVudFxuICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIG1hdGNoWzFdID0gbWF0Y2hbMV0udG9Mb3dlckNhc2UoKTtcblxuICAgICAgICAgICAgaWYgKG1hdGNoWzFdLnNsaWNlKDAsIDMpID09PSBcIm50aFwiKSB7XG4gICAgICAgICAgICAgIC8vIG50aC0qIHJlcXVpcmVzIGFyZ3VtZW50XG4gICAgICAgICAgICAgIGlmICghbWF0Y2hbM10pIHtcbiAgICAgICAgICAgICAgICBTaXp6bGUuZXJyb3IobWF0Y2hbMF0pO1xuICAgICAgICAgICAgICB9IC8vIG51bWVyaWMgeCBhbmQgeSBwYXJhbWV0ZXJzIGZvciBFeHByLmZpbHRlci5DSElMRFxuICAgICAgICAgICAgICAvLyByZW1lbWJlciB0aGF0IGZhbHNlL3RydWUgY2FzdCByZXNwZWN0aXZlbHkgdG8gMC8xXG5cblxuICAgICAgICAgICAgICBtYXRjaFs0XSA9ICsobWF0Y2hbNF0gPyBtYXRjaFs1XSArIChtYXRjaFs2XSB8fCAxKSA6IDIgKiAobWF0Y2hbM10gPT09IFwiZXZlblwiIHx8IG1hdGNoWzNdID09PSBcIm9kZFwiKSk7XG4gICAgICAgICAgICAgIG1hdGNoWzVdID0gKyhtYXRjaFs3XSArIG1hdGNoWzhdIHx8IG1hdGNoWzNdID09PSBcIm9kZFwiKTsgLy8gb3RoZXIgdHlwZXMgcHJvaGliaXQgYXJndW1lbnRzXG4gICAgICAgICAgICB9IGVsc2UgaWYgKG1hdGNoWzNdKSB7XG4gICAgICAgICAgICAgIFNpenpsZS5lcnJvcihtYXRjaFswXSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBtYXRjaDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiUFNFVURPXCI6IGZ1bmN0aW9uIFBTRVVETyhtYXRjaCkge1xuICAgICAgICAgICAgdmFyIGV4Y2VzcyxcbiAgICAgICAgICAgICAgICB1bnF1b3RlZCA9ICFtYXRjaFs2XSAmJiBtYXRjaFsyXTtcblxuICAgICAgICAgICAgaWYgKG1hdGNoRXhwcltcIkNISUxEXCJdLnRlc3QobWF0Y2hbMF0pKSB7XG4gICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfSAvLyBBY2NlcHQgcXVvdGVkIGFyZ3VtZW50cyBhcy1pc1xuXG5cbiAgICAgICAgICAgIGlmIChtYXRjaFszXSkge1xuICAgICAgICAgICAgICBtYXRjaFsyXSA9IG1hdGNoWzRdIHx8IG1hdGNoWzVdIHx8IFwiXCI7IC8vIFN0cmlwIGV4Y2VzcyBjaGFyYWN0ZXJzIGZyb20gdW5xdW90ZWQgYXJndW1lbnRzXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHVucXVvdGVkICYmIHJwc2V1ZG8udGVzdCh1bnF1b3RlZCkgJiYgKCAvLyBHZXQgZXhjZXNzIGZyb20gdG9rZW5pemUgKHJlY3Vyc2l2ZWx5KVxuICAgICAgICAgICAgZXhjZXNzID0gdG9rZW5pemUodW5xdW90ZWQsIHRydWUpKSAmJiAoIC8vIGFkdmFuY2UgdG8gdGhlIG5leHQgY2xvc2luZyBwYXJlbnRoZXNpc1xuICAgICAgICAgICAgZXhjZXNzID0gdW5xdW90ZWQuaW5kZXhPZihcIilcIiwgdW5xdW90ZWQubGVuZ3RoIC0gZXhjZXNzKSAtIHVucXVvdGVkLmxlbmd0aCkpIHtcbiAgICAgICAgICAgICAgLy8gZXhjZXNzIGlzIGEgbmVnYXRpdmUgaW5kZXhcbiAgICAgICAgICAgICAgbWF0Y2hbMF0gPSBtYXRjaFswXS5zbGljZSgwLCBleGNlc3MpO1xuICAgICAgICAgICAgICBtYXRjaFsyXSA9IHVucXVvdGVkLnNsaWNlKDAsIGV4Y2Vzcyk7XG4gICAgICAgICAgICB9IC8vIFJldHVybiBvbmx5IGNhcHR1cmVzIG5lZWRlZCBieSB0aGUgcHNldWRvIGZpbHRlciBtZXRob2QgKHR5cGUgYW5kIGFyZ3VtZW50KVxuXG5cbiAgICAgICAgICAgIHJldHVybiBtYXRjaC5zbGljZSgwLCAzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGZpbHRlcjoge1xuICAgICAgICAgIFwiVEFHXCI6IGZ1bmN0aW9uIFRBRyhub2RlTmFtZVNlbGVjdG9yKSB7XG4gICAgICAgICAgICB2YXIgbm9kZU5hbWUgPSBub2RlTmFtZVNlbGVjdG9yLnJlcGxhY2UocnVuZXNjYXBlLCBmdW5lc2NhcGUpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICByZXR1cm4gbm9kZU5hbWVTZWxlY3RvciA9PT0gXCIqXCIgPyBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfSA6IGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICAgICAgICAgIHJldHVybiBlbGVtLm5vZGVOYW1lICYmIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gbm9kZU5hbWU7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJDTEFTU1wiOiBmdW5jdGlvbiBDTEFTUyhjbGFzc05hbWUpIHtcbiAgICAgICAgICAgIHZhciBwYXR0ZXJuID0gY2xhc3NDYWNoZVtjbGFzc05hbWUgKyBcIiBcIl07XG4gICAgICAgICAgICByZXR1cm4gcGF0dGVybiB8fCAocGF0dGVybiA9IG5ldyBSZWdFeHAoXCIoXnxcIiArIHdoaXRlc3BhY2UgKyBcIilcIiArIGNsYXNzTmFtZSArIFwiKFwiICsgd2hpdGVzcGFjZSArIFwifCQpXCIpKSAmJiBjbGFzc0NhY2hlKGNsYXNzTmFtZSwgZnVuY3Rpb24gKGVsZW0pIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHBhdHRlcm4udGVzdCh0eXBlb2YgZWxlbS5jbGFzc05hbWUgPT09IFwic3RyaW5nXCIgJiYgZWxlbS5jbGFzc05hbWUgfHwgdHlwZW9mIGVsZW0uZ2V0QXR0cmlidXRlICE9PSBcInVuZGVmaW5lZFwiICYmIGVsZW0uZ2V0QXR0cmlidXRlKFwiY2xhc3NcIikgfHwgXCJcIik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiQVRUUlwiOiBmdW5jdGlvbiBBVFRSKG5hbWUsIG9wZXJhdG9yLCBjaGVjaykge1xuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICAgICAgICAgIHZhciByZXN1bHQgPSBTaXp6bGUuYXR0cihlbGVtLCBuYW1lKTtcblxuICAgICAgICAgICAgICBpZiAocmVzdWx0ID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gb3BlcmF0b3IgPT09IFwiIT1cIjtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGlmICghb3BlcmF0b3IpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIHJlc3VsdCArPSBcIlwiO1xuICAgICAgICAgICAgICByZXR1cm4gb3BlcmF0b3IgPT09IFwiPVwiID8gcmVzdWx0ID09PSBjaGVjayA6IG9wZXJhdG9yID09PSBcIiE9XCIgPyByZXN1bHQgIT09IGNoZWNrIDogb3BlcmF0b3IgPT09IFwiXj1cIiA/IGNoZWNrICYmIHJlc3VsdC5pbmRleE9mKGNoZWNrKSA9PT0gMCA6IG9wZXJhdG9yID09PSBcIio9XCIgPyBjaGVjayAmJiByZXN1bHQuaW5kZXhPZihjaGVjaykgPiAtMSA6IG9wZXJhdG9yID09PSBcIiQ9XCIgPyBjaGVjayAmJiByZXN1bHQuc2xpY2UoLWNoZWNrLmxlbmd0aCkgPT09IGNoZWNrIDogb3BlcmF0b3IgPT09IFwifj1cIiA/IChcIiBcIiArIHJlc3VsdC5yZXBsYWNlKHJ3aGl0ZXNwYWNlLCBcIiBcIikgKyBcIiBcIikuaW5kZXhPZihjaGVjaykgPiAtMSA6IG9wZXJhdG9yID09PSBcInw9XCIgPyByZXN1bHQgPT09IGNoZWNrIHx8IHJlc3VsdC5zbGljZSgwLCBjaGVjay5sZW5ndGggKyAxKSA9PT0gY2hlY2sgKyBcIi1cIiA6IGZhbHNlO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiQ0hJTERcIjogZnVuY3Rpb24gQ0hJTEQodHlwZSwgd2hhdCwgYXJndW1lbnQsIGZpcnN0LCBsYXN0KSB7XG4gICAgICAgICAgICB2YXIgc2ltcGxlID0gdHlwZS5zbGljZSgwLCAzKSAhPT0gXCJudGhcIixcbiAgICAgICAgICAgICAgICBmb3J3YXJkID0gdHlwZS5zbGljZSgtNCkgIT09IFwibGFzdFwiLFxuICAgICAgICAgICAgICAgIG9mVHlwZSA9IHdoYXQgPT09IFwib2YtdHlwZVwiO1xuICAgICAgICAgICAgcmV0dXJuIGZpcnN0ID09PSAxICYmIGxhc3QgPT09IDAgPyAvLyBTaG9ydGN1dCBmb3IgOm50aC0qKG4pXG4gICAgICAgICAgICBmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICAgICAgICByZXR1cm4gISFlbGVtLnBhcmVudE5vZGU7XG4gICAgICAgICAgICB9IDogZnVuY3Rpb24gKGVsZW0sIGNvbnRleHQsIHhtbCkge1xuICAgICAgICAgICAgICB2YXIgY2FjaGUsXG4gICAgICAgICAgICAgICAgICB1bmlxdWVDYWNoZSxcbiAgICAgICAgICAgICAgICAgIG91dGVyQ2FjaGUsXG4gICAgICAgICAgICAgICAgICBub2RlLFxuICAgICAgICAgICAgICAgICAgbm9kZUluZGV4LFxuICAgICAgICAgICAgICAgICAgc3RhcnQsXG4gICAgICAgICAgICAgICAgICBkaXIgPSBzaW1wbGUgIT09IGZvcndhcmQgPyBcIm5leHRTaWJsaW5nXCIgOiBcInByZXZpb3VzU2libGluZ1wiLFxuICAgICAgICAgICAgICAgICAgcGFyZW50ID0gZWxlbS5wYXJlbnROb2RlLFxuICAgICAgICAgICAgICAgICAgbmFtZSA9IG9mVHlwZSAmJiBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCksXG4gICAgICAgICAgICAgICAgICB1c2VDYWNoZSA9ICF4bWwgJiYgIW9mVHlwZSxcbiAgICAgICAgICAgICAgICAgIGRpZmYgPSBmYWxzZTtcblxuICAgICAgICAgICAgICBpZiAocGFyZW50KSB7XG4gICAgICAgICAgICAgICAgLy8gOihmaXJzdHxsYXN0fG9ubHkpLShjaGlsZHxvZi10eXBlKVxuICAgICAgICAgICAgICAgIGlmIChzaW1wbGUpIHtcbiAgICAgICAgICAgICAgICAgIHdoaWxlIChkaXIpIHtcbiAgICAgICAgICAgICAgICAgICAgbm9kZSA9IGVsZW07XG5cbiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKG5vZGUgPSBub2RlW2Rpcl0pIHtcbiAgICAgICAgICAgICAgICAgICAgICBpZiAob2ZUeXBlID8gbm9kZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSBuYW1lIDogbm9kZS5ub2RlVHlwZSA9PT0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSAvLyBSZXZlcnNlIGRpcmVjdGlvbiBmb3IgOm9ubHktKiAoaWYgd2UgaGF2ZW4ndCB5ZXQgZG9uZSBzbylcblxuXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0ID0gZGlyID0gdHlwZSA9PT0gXCJvbmx5XCIgJiYgIXN0YXJ0ICYmIFwibmV4dFNpYmxpbmdcIjtcbiAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgc3RhcnQgPSBbZm9yd2FyZCA/IHBhcmVudC5maXJzdENoaWxkIDogcGFyZW50Lmxhc3RDaGlsZF07IC8vIG5vbi14bWwgOm50aC1jaGlsZCguLi4pIHN0b3JlcyBjYWNoZSBkYXRhIG9uIGBwYXJlbnRgXG5cbiAgICAgICAgICAgICAgICBpZiAoZm9yd2FyZCAmJiB1c2VDYWNoZSkge1xuICAgICAgICAgICAgICAgICAgLy8gU2VlayBgZWxlbWAgZnJvbSBhIHByZXZpb3VzbHktY2FjaGVkIGluZGV4XG4gICAgICAgICAgICAgICAgICAvLyAuLi5pbiBhIGd6aXAtZnJpZW5kbHkgd2F5XG4gICAgICAgICAgICAgICAgICBub2RlID0gcGFyZW50O1xuICAgICAgICAgICAgICAgICAgb3V0ZXJDYWNoZSA9IG5vZGVbZXhwYW5kb10gfHwgKG5vZGVbZXhwYW5kb10gPSB7fSk7IC8vIFN1cHBvcnQ6IElFIDw5IG9ubHlcbiAgICAgICAgICAgICAgICAgIC8vIERlZmVuZCBhZ2FpbnN0IGNsb25lZCBhdHRyb3BlcnRpZXMgKGpRdWVyeSBnaC0xNzA5KVxuXG4gICAgICAgICAgICAgICAgICB1bmlxdWVDYWNoZSA9IG91dGVyQ2FjaGVbbm9kZS51bmlxdWVJRF0gfHwgKG91dGVyQ2FjaGVbbm9kZS51bmlxdWVJRF0gPSB7fSk7XG4gICAgICAgICAgICAgICAgICBjYWNoZSA9IHVuaXF1ZUNhY2hlW3R5cGVdIHx8IFtdO1xuICAgICAgICAgICAgICAgICAgbm9kZUluZGV4ID0gY2FjaGVbMF0gPT09IGRpcnJ1bnMgJiYgY2FjaGVbMV07XG4gICAgICAgICAgICAgICAgICBkaWZmID0gbm9kZUluZGV4ICYmIGNhY2hlWzJdO1xuICAgICAgICAgICAgICAgICAgbm9kZSA9IG5vZGVJbmRleCAmJiBwYXJlbnQuY2hpbGROb2Rlc1tub2RlSW5kZXhdO1xuXG4gICAgICAgICAgICAgICAgICB3aGlsZSAobm9kZSA9ICsrbm9kZUluZGV4ICYmIG5vZGUgJiYgbm9kZVtkaXJdIHx8ICggLy8gRmFsbGJhY2sgdG8gc2Vla2luZyBgZWxlbWAgZnJvbSB0aGUgc3RhcnRcbiAgICAgICAgICAgICAgICAgIGRpZmYgPSBub2RlSW5kZXggPSAwKSB8fCBzdGFydC5wb3AoKSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBXaGVuIGZvdW5kLCBjYWNoZSBpbmRleGVzIG9uIGBwYXJlbnRgIGFuZCBicmVha1xuICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5ub2RlVHlwZSA9PT0gMSAmJiArK2RpZmYgJiYgbm9kZSA9PT0gZWxlbSkge1xuICAgICAgICAgICAgICAgICAgICAgIHVuaXF1ZUNhY2hlW3R5cGVdID0gW2RpcnJ1bnMsIG5vZGVJbmRleCwgZGlmZl07XG4gICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgLy8gVXNlIHByZXZpb3VzbHktY2FjaGVkIGVsZW1lbnQgaW5kZXggaWYgYXZhaWxhYmxlXG4gICAgICAgICAgICAgICAgICBpZiAodXNlQ2FjaGUpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gLi4uaW4gYSBnemlwLWZyaWVuZGx5IHdheVxuICAgICAgICAgICAgICAgICAgICBub2RlID0gZWxlbTtcbiAgICAgICAgICAgICAgICAgICAgb3V0ZXJDYWNoZSA9IG5vZGVbZXhwYW5kb10gfHwgKG5vZGVbZXhwYW5kb10gPSB7fSk7IC8vIFN1cHBvcnQ6IElFIDw5IG9ubHlcbiAgICAgICAgICAgICAgICAgICAgLy8gRGVmZW5kIGFnYWluc3QgY2xvbmVkIGF0dHJvcGVydGllcyAoalF1ZXJ5IGdoLTE3MDkpXG5cbiAgICAgICAgICAgICAgICAgICAgdW5pcXVlQ2FjaGUgPSBvdXRlckNhY2hlW25vZGUudW5pcXVlSURdIHx8IChvdXRlckNhY2hlW25vZGUudW5pcXVlSURdID0ge30pO1xuICAgICAgICAgICAgICAgICAgICBjYWNoZSA9IHVuaXF1ZUNhY2hlW3R5cGVdIHx8IFtdO1xuICAgICAgICAgICAgICAgICAgICBub2RlSW5kZXggPSBjYWNoZVswXSA9PT0gZGlycnVucyAmJiBjYWNoZVsxXTtcbiAgICAgICAgICAgICAgICAgICAgZGlmZiA9IG5vZGVJbmRleDtcbiAgICAgICAgICAgICAgICAgIH0gLy8geG1sIDpudGgtY2hpbGQoLi4uKVxuICAgICAgICAgICAgICAgICAgLy8gb3IgOm50aC1sYXN0LWNoaWxkKC4uLikgb3IgOm50aCgtbGFzdCk/LW9mLXR5cGUoLi4uKVxuXG5cbiAgICAgICAgICAgICAgICAgIGlmIChkaWZmID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBVc2UgdGhlIHNhbWUgbG9vcCBhcyBhYm92ZSB0byBzZWVrIGBlbGVtYCBmcm9tIHRoZSBzdGFydFxuICAgICAgICAgICAgICAgICAgICB3aGlsZSAobm9kZSA9ICsrbm9kZUluZGV4ICYmIG5vZGUgJiYgbm9kZVtkaXJdIHx8IChkaWZmID0gbm9kZUluZGV4ID0gMCkgfHwgc3RhcnQucG9wKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICBpZiAoKG9mVHlwZSA/IG5vZGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gbmFtZSA6IG5vZGUubm9kZVR5cGUgPT09IDEpICYmICsrZGlmZikge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2FjaGUgdGhlIGluZGV4IG9mIGVhY2ggZW5jb3VudGVyZWQgZWxlbWVudFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVzZUNhY2hlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIG91dGVyQ2FjaGUgPSBub2RlW2V4cGFuZG9dIHx8IChub2RlW2V4cGFuZG9dID0ge30pOyAvLyBTdXBwb3J0OiBJRSA8OSBvbmx5XG4gICAgICAgICAgICAgICAgICAgICAgICAgIC8vIERlZmVuZCBhZ2FpbnN0IGNsb25lZCBhdHRyb3BlcnRpZXMgKGpRdWVyeSBnaC0xNzA5KVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHVuaXF1ZUNhY2hlID0gb3V0ZXJDYWNoZVtub2RlLnVuaXF1ZUlEXSB8fCAob3V0ZXJDYWNoZVtub2RlLnVuaXF1ZUlEXSA9IHt9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdW5pcXVlQ2FjaGVbdHlwZV0gPSBbZGlycnVucywgZGlmZl07XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChub2RlID09PSBlbGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gLy8gSW5jb3Jwb3JhdGUgdGhlIG9mZnNldCwgdGhlbiBjaGVjayBhZ2FpbnN0IGN5Y2xlIHNpemVcblxuXG4gICAgICAgICAgICAgICAgZGlmZiAtPSBsYXN0O1xuICAgICAgICAgICAgICAgIHJldHVybiBkaWZmID09PSBmaXJzdCB8fCBkaWZmICUgZmlyc3QgPT09IDAgJiYgZGlmZiAvIGZpcnN0ID49IDA7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfSxcbiAgICAgICAgICBcIlBTRVVET1wiOiBmdW5jdGlvbiBQU0VVRE8ocHNldWRvLCBhcmd1bWVudCkge1xuICAgICAgICAgICAgLy8gcHNldWRvLWNsYXNzIG5hbWVzIGFyZSBjYXNlLWluc2Vuc2l0aXZlXG4gICAgICAgICAgICAvLyBodHRwOi8vd3d3LnczLm9yZy9UUi9zZWxlY3RvcnMvI3BzZXVkby1jbGFzc2VzXG4gICAgICAgICAgICAvLyBQcmlvcml0aXplIGJ5IGNhc2Ugc2Vuc2l0aXZpdHkgaW4gY2FzZSBjdXN0b20gcHNldWRvcyBhcmUgYWRkZWQgd2l0aCB1cHBlcmNhc2UgbGV0dGVyc1xuICAgICAgICAgICAgLy8gUmVtZW1iZXIgdGhhdCBzZXRGaWx0ZXJzIGluaGVyaXRzIGZyb20gcHNldWRvc1xuICAgICAgICAgICAgdmFyIGFyZ3MsXG4gICAgICAgICAgICAgICAgZm4gPSBFeHByLnBzZXVkb3NbcHNldWRvXSB8fCBFeHByLnNldEZpbHRlcnNbcHNldWRvLnRvTG93ZXJDYXNlKCldIHx8IFNpenpsZS5lcnJvcihcInVuc3VwcG9ydGVkIHBzZXVkbzogXCIgKyBwc2V1ZG8pOyAvLyBUaGUgdXNlciBtYXkgdXNlIGNyZWF0ZVBzZXVkbyB0byBpbmRpY2F0ZSB0aGF0XG4gICAgICAgICAgICAvLyBhcmd1bWVudHMgYXJlIG5lZWRlZCB0byBjcmVhdGUgdGhlIGZpbHRlciBmdW5jdGlvblxuICAgICAgICAgICAgLy8ganVzdCBhcyBTaXp6bGUgZG9lc1xuXG4gICAgICAgICAgICBpZiAoZm5bZXhwYW5kb10pIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGZuKGFyZ3VtZW50KTtcbiAgICAgICAgICAgIH0gLy8gQnV0IG1haW50YWluIHN1cHBvcnQgZm9yIG9sZCBzaWduYXR1cmVzXG5cblxuICAgICAgICAgICAgaWYgKGZuLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgYXJncyA9IFtwc2V1ZG8sIHBzZXVkbywgXCJcIiwgYXJndW1lbnRdO1xuICAgICAgICAgICAgICByZXR1cm4gRXhwci5zZXRGaWx0ZXJzLmhhc093blByb3BlcnR5KHBzZXVkby50b0xvd2VyQ2FzZSgpKSA/IG1hcmtGdW5jdGlvbihmdW5jdGlvbiAoc2VlZCwgbWF0Y2hlcykge1xuICAgICAgICAgICAgICAgIHZhciBpZHgsXG4gICAgICAgICAgICAgICAgICAgIG1hdGNoZWQgPSBmbihzZWVkLCBhcmd1bWVudCksXG4gICAgICAgICAgICAgICAgICAgIGkgPSBtYXRjaGVkLmxlbmd0aDtcblxuICAgICAgICAgICAgICAgIHdoaWxlIChpLS0pIHtcbiAgICAgICAgICAgICAgICAgIGlkeCA9IGluZGV4T2Yoc2VlZCwgbWF0Y2hlZFtpXSk7XG4gICAgICAgICAgICAgICAgICBzZWVkW2lkeF0gPSAhKG1hdGNoZXNbaWR4XSA9IG1hdGNoZWRbaV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSkgOiBmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmbihlbGVtLCAwLCBhcmdzKTtcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGZuO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgcHNldWRvczoge1xuICAgICAgICAgIC8vIFBvdGVudGlhbGx5IGNvbXBsZXggcHNldWRvc1xuICAgICAgICAgIFwibm90XCI6IG1hcmtGdW5jdGlvbihmdW5jdGlvbiAoc2VsZWN0b3IpIHtcbiAgICAgICAgICAgIC8vIFRyaW0gdGhlIHNlbGVjdG9yIHBhc3NlZCB0byBjb21waWxlXG4gICAgICAgICAgICAvLyB0byBhdm9pZCB0cmVhdGluZyBsZWFkaW5nIGFuZCB0cmFpbGluZ1xuICAgICAgICAgICAgLy8gc3BhY2VzIGFzIGNvbWJpbmF0b3JzXG4gICAgICAgICAgICB2YXIgaW5wdXQgPSBbXSxcbiAgICAgICAgICAgICAgICByZXN1bHRzID0gW10sXG4gICAgICAgICAgICAgICAgbWF0Y2hlciA9IGNvbXBpbGUoc2VsZWN0b3IucmVwbGFjZShydHJpbSwgXCIkMVwiKSk7XG4gICAgICAgICAgICByZXR1cm4gbWF0Y2hlcltleHBhbmRvXSA/IG1hcmtGdW5jdGlvbihmdW5jdGlvbiAoc2VlZCwgbWF0Y2hlcywgY29udGV4dCwgeG1sKSB7XG4gICAgICAgICAgICAgIHZhciBlbGVtLFxuICAgICAgICAgICAgICAgICAgdW5tYXRjaGVkID0gbWF0Y2hlcihzZWVkLCBudWxsLCB4bWwsIFtdKSxcbiAgICAgICAgICAgICAgICAgIGkgPSBzZWVkLmxlbmd0aDsgLy8gTWF0Y2ggZWxlbWVudHMgdW5tYXRjaGVkIGJ5IGBtYXRjaGVyYFxuXG4gICAgICAgICAgICAgIHdoaWxlIChpLS0pIHtcbiAgICAgICAgICAgICAgICBpZiAoZWxlbSA9IHVubWF0Y2hlZFtpXSkge1xuICAgICAgICAgICAgICAgICAgc2VlZFtpXSA9ICEobWF0Y2hlc1tpXSA9IGVsZW0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkgOiBmdW5jdGlvbiAoZWxlbSwgY29udGV4dCwgeG1sKSB7XG4gICAgICAgICAgICAgIGlucHV0WzBdID0gZWxlbTtcbiAgICAgICAgICAgICAgbWF0Y2hlcihpbnB1dCwgbnVsbCwgeG1sLCByZXN1bHRzKTsgLy8gRG9uJ3Qga2VlcCB0aGUgZWxlbWVudCAoaXNzdWUgIzI5OSlcblxuICAgICAgICAgICAgICBpbnB1dFswXSA9IG51bGw7XG4gICAgICAgICAgICAgIHJldHVybiAhcmVzdWx0cy5wb3AoKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfSksXG4gICAgICAgICAgXCJoYXNcIjogbWFya0Z1bmN0aW9uKGZ1bmN0aW9uIChzZWxlY3Rvcikge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBzZWxlY3RvciA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgICBTaXp6bGUuY29tcGlsZShzZWxlY3Rvcik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICAgICAgICByZXR1cm4gU2l6emxlKHNlbGVjdG9yLCBlbGVtKS5sZW5ndGggPiAwO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9KSxcbiAgICAgICAgICAvLyBSZW1vdmVkIDpjb250YWlucyBwc2V1ZG8tY2xhc3MgZGVjbGFyYXRpb25cbiAgICAgICAgICAvLyBcIldoZXRoZXIgYW4gZWxlbWVudCBpcyByZXByZXNlbnRlZCBieSBhIDpsYW5nKCkgc2VsZWN0b3JcbiAgICAgICAgICAvLyBpcyBiYXNlZCBzb2xlbHkgb24gdGhlIGVsZW1lbnQncyBsYW5ndWFnZSB2YWx1ZVxuICAgICAgICAgIC8vIGJlaW5nIGVxdWFsIHRvIHRoZSBpZGVudGlmaWVyIEMsXG4gICAgICAgICAgLy8gb3IgYmVnaW5uaW5nIHdpdGggdGhlIGlkZW50aWZpZXIgQyBpbW1lZGlhdGVseSBmb2xsb3dlZCBieSBcIi1cIi5cbiAgICAgICAgICAvLyBUaGUgbWF0Y2hpbmcgb2YgQyBhZ2FpbnN0IHRoZSBlbGVtZW50J3MgbGFuZ3VhZ2UgdmFsdWUgaXMgcGVyZm9ybWVkIGNhc2UtaW5zZW5zaXRpdmVseS5cbiAgICAgICAgICAvLyBUaGUgaWRlbnRpZmllciBDIGRvZXMgbm90IGhhdmUgdG8gYmUgYSB2YWxpZCBsYW5ndWFnZSBuYW1lLlwiXG4gICAgICAgICAgLy8gaHR0cDovL3d3dy53My5vcmcvVFIvc2VsZWN0b3JzLyNsYW5nLXBzZXVkb1xuICAgICAgICAgIFwibGFuZ1wiOiBtYXJrRnVuY3Rpb24oZnVuY3Rpb24gKGxhbmcpIHtcbiAgICAgICAgICAgIC8vIGxhbmcgdmFsdWUgbXVzdCBiZSBhIHZhbGlkIGlkZW50aWZpZXJcbiAgICAgICAgICAgIGlmICghcmlkZW50aWZpZXIudGVzdChsYW5nIHx8IFwiXCIpKSB7XG4gICAgICAgICAgICAgIFNpenpsZS5lcnJvcihcInVuc3VwcG9ydGVkIGxhbmc6IFwiICsgbGFuZyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGxhbmcgPSBsYW5nLnJlcGxhY2UocnVuZXNjYXBlLCBmdW5lc2NhcGUpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGVsZW0pIHtcbiAgICAgICAgICAgICAgdmFyIGVsZW1MYW5nO1xuXG4gICAgICAgICAgICAgIGRvIHtcbiAgICAgICAgICAgICAgICBpZiAoZWxlbUxhbmcgPSBkb2N1bWVudElzSFRNTCA/IGVsZW0ubGFuZyA6IGVsZW0uZ2V0QXR0cmlidXRlKFwieG1sOmxhbmdcIikgfHwgZWxlbS5nZXRBdHRyaWJ1dGUoXCJsYW5nXCIpKSB7XG4gICAgICAgICAgICAgICAgICBlbGVtTGFuZyA9IGVsZW1MYW5nLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbUxhbmcgPT09IGxhbmcgfHwgZWxlbUxhbmcuaW5kZXhPZihsYW5nICsgXCItXCIpID09PSAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSB3aGlsZSAoKGVsZW0gPSBlbGVtLnBhcmVudE5vZGUpICYmIGVsZW0ubm9kZVR5cGUgPT09IDEpO1xuXG4gICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfSksXG4gICAgICAgICAgLy8gTWlzY2VsbGFuZW91c1xuICAgICAgICAgIFwidGFyZ2V0XCI6IGZ1bmN0aW9uIHRhcmdldChlbGVtKSB7XG4gICAgICAgICAgICB2YXIgaGFzaCA9IHdpbmRvdy5sb2NhdGlvbiAmJiB3aW5kb3cubG9jYXRpb24uaGFzaDtcbiAgICAgICAgICAgIHJldHVybiBoYXNoICYmIGhhc2guc2xpY2UoMSkgPT09IGVsZW0uaWQ7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInJvb3RcIjogZnVuY3Rpb24gcm9vdChlbGVtKSB7XG4gICAgICAgICAgICByZXR1cm4gZWxlbSA9PT0gZG9jRWxlbTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiZm9jdXNcIjogZnVuY3Rpb24gZm9jdXMoZWxlbSkge1xuICAgICAgICAgICAgcmV0dXJuIGVsZW0gPT09IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgJiYgKCFkb2N1bWVudC5oYXNGb2N1cyB8fCBkb2N1bWVudC5oYXNGb2N1cygpKSAmJiAhIShlbGVtLnR5cGUgfHwgZWxlbS5ocmVmIHx8IH5lbGVtLnRhYkluZGV4KTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIC8vIEJvb2xlYW4gcHJvcGVydGllc1xuICAgICAgICAgIFwiZW5hYmxlZFwiOiBjcmVhdGVEaXNhYmxlZFBzZXVkbyhmYWxzZSksXG4gICAgICAgICAgXCJkaXNhYmxlZFwiOiBjcmVhdGVEaXNhYmxlZFBzZXVkbyh0cnVlKSxcbiAgICAgICAgICBcImNoZWNrZWRcIjogZnVuY3Rpb24gY2hlY2tlZChlbGVtKSB7XG4gICAgICAgICAgICAvLyBJbiBDU1MzLCA6Y2hlY2tlZCBzaG91bGQgcmV0dXJuIGJvdGggY2hlY2tlZCBhbmQgc2VsZWN0ZWQgZWxlbWVudHNcbiAgICAgICAgICAgIC8vIGh0dHA6Ly93d3cudzMub3JnL1RSLzIwMTEvUkVDLWNzczMtc2VsZWN0b3JzLTIwMTEwOTI5LyNjaGVja2VkXG4gICAgICAgICAgICB2YXIgbm9kZU5hbWUgPSBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICByZXR1cm4gbm9kZU5hbWUgPT09IFwiaW5wdXRcIiAmJiAhIWVsZW0uY2hlY2tlZCB8fCBub2RlTmFtZSA9PT0gXCJvcHRpb25cIiAmJiAhIWVsZW0uc2VsZWN0ZWQ7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInNlbGVjdGVkXCI6IGZ1bmN0aW9uIHNlbGVjdGVkKGVsZW0pIHtcbiAgICAgICAgICAgIC8vIEFjY2Vzc2luZyB0aGlzIHByb3BlcnR5IG1ha2VzIHNlbGVjdGVkLWJ5LWRlZmF1bHRcbiAgICAgICAgICAgIC8vIG9wdGlvbnMgaW4gU2FmYXJpIHdvcmsgcHJvcGVybHlcbiAgICAgICAgICAgIGlmIChlbGVtLnBhcmVudE5vZGUpIHtcbiAgICAgICAgICAgICAgZWxlbS5wYXJlbnROb2RlLnNlbGVjdGVkSW5kZXg7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBlbGVtLnNlbGVjdGVkID09PSB0cnVlO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgLy8gQ29udGVudHNcbiAgICAgICAgICBcImVtcHR5XCI6IGZ1bmN0aW9uIGVtcHR5KGVsZW0pIHtcbiAgICAgICAgICAgIC8vIGh0dHA6Ly93d3cudzMub3JnL1RSL3NlbGVjdG9ycy8jZW1wdHktcHNldWRvXG4gICAgICAgICAgICAvLyA6ZW1wdHkgaXMgbmVnYXRlZCBieSBlbGVtZW50ICgxKSBvciBjb250ZW50IG5vZGVzICh0ZXh0OiAzOyBjZGF0YTogNDsgZW50aXR5IHJlZjogNSksXG4gICAgICAgICAgICAvLyAgIGJ1dCBub3QgYnkgb3RoZXJzIChjb21tZW50OiA4OyBwcm9jZXNzaW5nIGluc3RydWN0aW9uOiA3OyBldGMuKVxuICAgICAgICAgICAgLy8gbm9kZVR5cGUgPCA2IHdvcmtzIGJlY2F1c2UgYXR0cmlidXRlcyAoMikgZG8gbm90IGFwcGVhciBhcyBjaGlsZHJlblxuICAgICAgICAgICAgZm9yIChlbGVtID0gZWxlbS5maXJzdENoaWxkOyBlbGVtOyBlbGVtID0gZWxlbS5uZXh0U2libGluZykge1xuICAgICAgICAgICAgICBpZiAoZWxlbS5ub2RlVHlwZSA8IDYpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgfSAvLyBSZW1vdmVkIGN1c3RvbSBwc2V1ZG8tY2xhc3Nlc1xuXG4gICAgICAgIH1cbiAgICAgIH07IC8vIFJlbW92ZWQgY3VzdG9tIHBzZXVkby1jbGFzc2VzXG4gICAgICAvLyBFYXN5IEFQSSBmb3IgY3JlYXRpbmcgbmV3IHNldEZpbHRlcnNcblxuICAgICAgZnVuY3Rpb24gc2V0RmlsdGVycygpIHt9XG5cbiAgICAgIHNldEZpbHRlcnMucHJvdG90eXBlID0gRXhwci5maWx0ZXJzID0gRXhwci5wc2V1ZG9zO1xuICAgICAgRXhwci5zZXRGaWx0ZXJzID0gbmV3IHNldEZpbHRlcnMoKTtcbiAgICAgIC8qKlxuICAgICAgICogW0FkR3VhcmQgUGF0Y2hdOlxuICAgICAgICogU29ydHMgdGhlIHRva2VucyBpbiBvcmRlciB0byBtaXRpZ2F0ZSB0aGUgcGVyZm9ybWFuY2UgaXNzdWVzIGNhdXNlZCBieSBtYXRjaGluZyBzbG93IHBzZXVkb3MgZmlyc3Q6XG4gICAgICAgKiBodHRwczovL2dpdGh1Yi5jb20vQWRndWFyZFRlYW0vRXh0ZW5kZWRDc3MvaXNzdWVzLzU1I2lzc3VlY29tbWVudC0zNjQwNTg3NDVcbiAgICAgICAqL1xuXG4gICAgICB2YXIgc29ydFRva2VuR3JvdXBzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAvKipcbiAgICAgICAgICogU3BsaXRzIGNvbXBvdW5kIHNlbGVjdG9yIGludG8gYSBsaXN0IG9mIHNpbXBsZSBzZWxlY3RvcnNcbiAgICAgICAgICpcbiAgICAgICAgICogQHBhcmFtIHsqfSB0b2tlbnMgVG9rZW5zIHRvIHNwbGl0IGludG8gZ3JvdXBzXG4gICAgICAgICAqIEByZXR1cm5zIGFuIGFycmF5IGNvbnNpc3Rpbmcgb2YgdG9rZW4gZ3JvdXBzIChhcnJheXMpIGFuZCByZWxhdGlvbiB0b2tlbnMuXG4gICAgICAgICAqL1xuICAgICAgICB2YXIgc3BsaXRDb21wb3VuZFNlbGVjdG9yID0gZnVuY3Rpb24gc3BsaXRDb21wb3VuZFNlbGVjdG9yKHRva2Vucykge1xuICAgICAgICAgIHZhciBncm91cHMgPSBbXTtcbiAgICAgICAgICB2YXIgY3VycmVudFRva2Vuc0dyb3VwID0gW107XG4gICAgICAgICAgdmFyIG1heElkeCA9IHRva2Vucy5sZW5ndGggLSAxO1xuXG4gICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPD0gbWF4SWR4OyBpKyspIHtcbiAgICAgICAgICAgIHZhciB0b2tlbiA9IHRva2Vuc1tpXTtcbiAgICAgICAgICAgIHZhciByZWxhdGl2ZSA9IFNpenpsZS5zZWxlY3RvcnMucmVsYXRpdmVbdG9rZW4udHlwZV07XG5cbiAgICAgICAgICAgIGlmIChyZWxhdGl2ZSkge1xuICAgICAgICAgICAgICBncm91cHMucHVzaChjdXJyZW50VG9rZW5zR3JvdXApO1xuICAgICAgICAgICAgICBncm91cHMucHVzaCh0b2tlbik7XG4gICAgICAgICAgICAgIGN1cnJlbnRUb2tlbnNHcm91cCA9IFtdO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgY3VycmVudFRva2Vuc0dyb3VwLnB1c2godG9rZW4pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoaSA9PT0gbWF4SWR4KSB7XG4gICAgICAgICAgICAgIGdyb3Vwcy5wdXNoKGN1cnJlbnRUb2tlbnNHcm91cCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIGdyb3VwcztcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgVE9LRU5fVFlQRVNfVkFMVUVTID0ge1xuICAgICAgICAgIC8vIG50aC1jaGlsZCwgZXRjLCBhbHdheXMgZ28gbGFzdFxuICAgICAgICAgIFwiQ0hJTERcIjogMTAwLFxuICAgICAgICAgIFwiSURcIjogOTAsXG4gICAgICAgICAgXCJDTEFTU1wiOiA4MCxcbiAgICAgICAgICBcIlRBR1wiOiA3MCxcbiAgICAgICAgICBcIkFUVFJcIjogNzAsXG4gICAgICAgICAgXCJQU0VVRE9cIjogNjBcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIFBPU0lUSU9OQUxfUFNFVURPUyA9IFtcIm50aFwiLCBcImZpcnN0XCIsIFwibGFzdFwiLCBcImVxXCIsIFwiZXZlblwiLCBcIm9kZFwiLCBcImx0XCIsIFwiZ3RcIiwgXCJub3RcIl07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBIGZ1bmN0aW9uIHRoYXQgZGVmaW5lcyB0aGUgc29ydCBvcmRlci5cbiAgICAgICAgICogUmV0dXJucyBhIHZhbHVlIGxlc3NlciB0aGFuIDAgaWYgXCJsZWZ0XCIgaXMgbGVzcyB0aGFuIFwicmlnaHRcIi5cbiAgICAgICAgICovXG5cbiAgICAgICAgdmFyIGNvbXBhcmVGdW5jdGlvbiA9IGZ1bmN0aW9uIGNvbXBhcmVGdW5jdGlvbihsZWZ0LCByaWdodCkge1xuICAgICAgICAgIHZhciBsZWZ0VmFsdWUgPSBUT0tFTl9UWVBFU19WQUxVRVNbbGVmdC50eXBlXTtcbiAgICAgICAgICB2YXIgcmlnaHRWYWx1ZSA9IFRPS0VOX1RZUEVTX1ZBTFVFU1tyaWdodC50eXBlXTtcbiAgICAgICAgICByZXR1cm4gbGVmdFZhbHVlIC0gcmlnaHRWYWx1ZTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIENoZWNrcyBpZiB0aGUgc3BlY2lmaWVkIHRva2VucyBncm91cCBpcyBzb3J0YWJsZS5cbiAgICAgICAgICogV2UgZG8gbm90IHJlLXNvcnQgdG9rZW5zIGluIGNhc2Ugb2YgYW55IHBvc2l0aW9uYWwgb3IgY2hpbGQgcHNldWRvcyBpbiB0aGUgZ3JvdXBcbiAgICAgICAgICovXG5cblxuICAgICAgICB2YXIgaXNTb3J0YWJsZSA9IGZ1bmN0aW9uIGlzU29ydGFibGUodG9rZW5zKSB7XG4gICAgICAgICAgdmFyIGlUb2tlbnMgPSB0b2tlbnMubGVuZ3RoO1xuXG4gICAgICAgICAgd2hpbGUgKGlUb2tlbnMtLSkge1xuICAgICAgICAgICAgdmFyIHRva2VuID0gdG9rZW5zW2lUb2tlbnNdO1xuXG4gICAgICAgICAgICBpZiAodG9rZW4udHlwZSA9PT0gXCJQU0VVRE9cIiAmJiBQT1NJVElPTkFMX1BTRVVET1MuaW5kZXhPZih0b2tlbi5tYXRjaGVzWzBdKSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodG9rZW4udHlwZSA9PT0gXCJDSElMRFwiKSB7XG4gICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNvcnRzIHRoZSB0b2tlbnMgaW4gb3JkZXIgdG8gbWl0aWdhdGUgdGhlIGlzc3VlcyBjYXVzZWQgYnkgdGhlIGxlZnQtdG8tcmlnaHQgbWF0Y2hpbmcuXG4gICAgICAgICAqIFRoZSBpZGVhIGlzIGNoYW5nZSB0aGUgdG9rZW5zIG9yZGVyIHNvIHRoYXQgU2l6emxlIHdhcyBtYXRjaGluZyBmYXN0IHNlbGVjdG9ycyBmaXJzdCAoaWQsIGNsYXNzKSxcbiAgICAgICAgICogYW5kIHNsb3cgc2VsZWN0b3JzIGFmdGVyIHRoYXQgKGFuZCBoZXJlIEkgbWVhbiBvdXIgc2xvdyBjdXN0b20gcHNldWRvIGNsYXNzZXMpLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAcGFyYW0ge0FycmF5fSB0b2tlbnMgQW4gYXJyYXkgb2YgdG9rZW5zIHRvIHNvcnRcbiAgICAgICAgICogQHJldHVybnMge0FycmF5fSBBIG5ldyByZS1zb3J0ZWQgYXJyYXlcbiAgICAgICAgICovXG5cblxuICAgICAgICB2YXIgc29ydFRva2VucyA9IGZ1bmN0aW9uIHNvcnRUb2tlbnModG9rZW5zKSB7XG4gICAgICAgICAgaWYgKCF0b2tlbnMgfHwgdG9rZW5zLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgcmV0dXJuIHRva2VucztcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB2YXIgc29ydGVkVG9rZW5zID0gW107XG4gICAgICAgICAgdmFyIGdyb3VwcyA9IHNwbGl0Q29tcG91bmRTZWxlY3Rvcih0b2tlbnMpO1xuXG4gICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBncm91cHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBncm91cCA9IGdyb3Vwc1tpXTtcblxuICAgICAgICAgICAgaWYgKGdyb3VwIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgICAgICAgaWYgKGlzU29ydGFibGUoZ3JvdXApKSB7XG4gICAgICAgICAgICAgICAgZ3JvdXAuc29ydChjb21wYXJlRnVuY3Rpb24pO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgc29ydGVkVG9rZW5zID0gc29ydGVkVG9rZW5zLmNvbmNhdChncm91cCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBzb3J0ZWRUb2tlbnMucHVzaChncm91cCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIHNvcnRlZFRva2VucztcbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNvcnRzIGV2ZXJ5IHRva2VucyBhcnJheSBpbnNpZGUgb2YgdGhlIHNwZWNpZmllZCBcImdyb3Vwc1wiIGFycmF5LlxuICAgICAgICAgKiBTZWUgXCJzb3J0VG9rZW5zXCIgbWV0aG9kcyBmb3IgbW9yZSBpbmZvcm1hdGlvbiBvbiBob3cgdG9rZW5zIGFyZSBzb3J0ZWQuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSB7QXJyYXl9IGdyb3VwcyBBbiBhcnJheSBvZiB0b2tlbnMgYXJyYXlzLlxuICAgICAgICAgKiBAcmV0dXJucyB7QXJyYXl9IEEgbmV3IGFycmF5IHRoYXQgY29uc2lzdHMgb2YgdGhlIHNhbWUgdG9rZW5zIGFycmF5cyBhZnRlciBzb3J0aW5nXG4gICAgICAgICAqL1xuXG5cbiAgICAgICAgdmFyIHNvcnRUb2tlbkdyb3VwcyA9IGZ1bmN0aW9uIHNvcnRUb2tlbkdyb3Vwcyhncm91cHMpIHtcbiAgICAgICAgICB2YXIgc29ydGVkR3JvdXBzID0gW107XG4gICAgICAgICAgdmFyIGxlbiA9IGdyb3Vwcy5sZW5ndGg7XG4gICAgICAgICAgdmFyIGkgPSAwO1xuXG4gICAgICAgICAgZm9yICg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgICAgc29ydGVkR3JvdXBzLnB1c2goc29ydFRva2Vucyhncm91cHNbaV0pKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gc29ydGVkR3JvdXBzO1xuICAgICAgICB9OyAvLyBFeHBvc2VcblxuXG4gICAgICAgIHJldHVybiBzb3J0VG9rZW5Hcm91cHM7XG4gICAgICB9KCk7XG4gICAgICAvKipcbiAgICAgICAqIENyZWF0ZXMgY3VzdG9tIHBvbGljeSB0byB1c2UgVHJ1c3RlZFR5cGVzIENTUCBwb2xpY3lcbiAgICAgICAqIGh0dHBzOi8vdzNjLmdpdGh1Yi5pby93ZWJhcHBzZWMtdHJ1c3RlZC10eXBlcy9kaXN0L3NwZWMvXG4gICAgICAgKi9cblxuXG4gICAgICB2YXIgQUdQb2xpY3kgPSBmdW5jdGlvbiBjcmVhdGVQb2xpY3koKSB7XG4gICAgICAgIHZhciBkZWZhdWx0UG9saWN5ID0ge1xuICAgICAgICAgIGNyZWF0ZUhUTUw6IGZ1bmN0aW9uIGNyZWF0ZUhUTUwoaW5wdXQpIHtcbiAgICAgICAgICAgIHJldHVybiBpbnB1dDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGNyZWF0ZVNjcmlwdDogZnVuY3Rpb24gY3JlYXRlU2NyaXB0KGlucHV0KSB7XG4gICAgICAgICAgICByZXR1cm4gaW5wdXQ7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBjcmVhdGVTY3JpcHRVUkw6IGZ1bmN0aW9uIGNyZWF0ZVNjcmlwdFVSTChpbnB1dCkge1xuICAgICAgICAgICAgcmV0dXJuIGlucHV0O1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBpZiAod2luZG93LnRydXN0ZWRUeXBlcyAmJiB3aW5kb3cudHJ1c3RlZFR5cGVzLmNyZWF0ZVBvbGljeSkge1xuICAgICAgICAgIHJldHVybiB3aW5kb3cudHJ1c3RlZFR5cGVzLmNyZWF0ZVBvbGljeShcIkFHUG9saWN5XCIsIGRlZmF1bHRQb2xpY3kpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGRlZmF1bHRQb2xpY3k7XG4gICAgICB9KCk7XG4gICAgICAvKipcbiAgICAgICAqIFtBZEd1YXJkIFBhdGNoXTpcbiAgICAgICAqIFJlbW92ZXMgdHJhaWxpbmcgc3BhY2VzIGZyb20gdGhlIHRva2VucyBsaXN0XG4gICAgICAgKlxuICAgICAgICogQHBhcmFtIHsqfSB0b2tlbnMgQW4gYXJyYXkgb2YgU2l6emxlIHRva2VucyB0byBwb3N0LXByb2Nlc3NcbiAgICAgICAqL1xuXG5cbiAgICAgIGZ1bmN0aW9uIHJlbW92ZVRyYWlsaW5nU3BhY2VzKHRva2Vucykge1xuICAgICAgICB2YXIgaVRva2VucyA9IHRva2Vucy5sZW5ndGg7XG5cbiAgICAgICAgd2hpbGUgKGlUb2tlbnMtLSkge1xuICAgICAgICAgIHZhciB0b2tlbiA9IHRva2Vuc1tpVG9rZW5zXTtcblxuICAgICAgICAgIGlmICh0b2tlbi50eXBlID09PSBcIiBcIikge1xuICAgICAgICAgICAgdG9rZW5zLmxlbmd0aCA9IGlUb2tlbnM7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgLyoqXG4gICAgICAgKiBbQWRHdWFyZCBQYXRjaF06XG4gICAgICAgKiBBbiBvYmplY3Qgd2l0aCB0aGUgaW5mb3JtYXRpb24gYWJvdXQgc2VsZWN0b3JzIGFuZCB0aGVpciB0b2tlbiByZXByZXNlbnRhdGlvblxuICAgICAgICogQHR5cGVkZWYge3tzZWxlY3RvclRleHQ6IHN0cmluZywgZ3JvdXBzOiBBcnJheX19IFNlbGVjdG9yRGF0YVxuICAgICAgICogQHByb3BlcnR5IHtzdHJpbmd9IHNlbGVjdG9yVGV4dCBBIENTUyBzZWxlY3RvciB0ZXh0XG4gICAgICAgKiBAcHJvcGVydHkge0FycmF5fSBncm91cHMgQW4gYXJyYXkgb2YgdG9rZW4gZ3JvdXBzIGNvcnJlc3BvbmRpbmcgdG8gdGhhdCBzZWxlY3RvclxuICAgICAgICovXG5cbiAgICAgIC8qKlxuICAgICAgICogW0FkR3VhcmQgUGF0Y2hdOlxuICAgICAgICogVGhpcyBtZXRob2QgcHJvY2Vzc2VzIHBhcnNlZCB0b2tlbiBncm91cHMsIGRpdmlkZXMgdGhlbSBpbnRvIGEgbnVtYmVyIG9mIHNlbGVjdG9yc1xuICAgICAgICogYW5kIG1ha2VzIHN1cmUgdGhhdCBlYWNoIHNlbGVjdG9yJ3MgdG9rZW5zIGFyZSBjYWNoZWQgcHJvcGVybHkgaW4gU2l6emxlLlxuICAgICAgICpcbiAgICAgICAqIEBwYXJhbSB7Kn0gZ3JvdXBzIFRva2VuIGdyb3VwcyAoc2VlIHtAbGluayBTaXp6bGUudG9rZW5pemV9KVxuICAgICAgICogQHJldHVybnMge0FycmF5LjxTZWxlY3RvckRhdGE+fSBBbiBhcnJheSBvZiBzZWxlY3RvcnMgZGF0YSB3ZSBnb3QgZnJvbSB0aGUgZ3JvdXBzXG4gICAgICAgKi9cblxuXG4gICAgICBmdW5jdGlvbiB0b2tlbkdyb3Vwc1RvU2VsZWN0b3JzKGdyb3Vwcykge1xuICAgICAgICAvLyBSZW1vdmUgdHJhaWxpbmcgc3BhY2VzIHdoaWNoIHdlIGNhbiBlbmNvdW50ZXIgaW4gdG9sZXJhbnQgbW9kZVxuICAgICAgICAvLyBXZSdyZSBkb2luZyBpdCBpbiB0b2xlcmFudCBtb2RlIG9ubHkgYXMgdGhpcyBpcyB0aGUgb25seSBjYXNlIHdoZW5cbiAgICAgICAgLy8gZW5jb3VudGVyaW5nIHRyYWlsaW5nIHNwYWNlcyBpcyBleHBlY3RlZFxuICAgICAgICByZW1vdmVUcmFpbGluZ1NwYWNlcyhncm91cHNbZ3JvdXBzLmxlbmd0aCAtIDFdKTsgLy8gV2UgbmVlZCBzb3J0ZWQgdG9rZW5zIHRvIG1ha2UgY2FjaGUgd29yayBwcm9wZXJseVxuXG4gICAgICAgIHZhciBzb3J0ZWRHcm91cHMgPSBzb3J0VG9rZW5Hcm91cHMoZ3JvdXBzKTtcbiAgICAgICAgdmFyIHNlbGVjdG9ycyA9IFtdO1xuXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZ3JvdXBzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgdmFyIHRva2VuR3JvdXBzID0gZ3JvdXBzW2ldO1xuICAgICAgICAgIHZhciBzZWxlY3RvclRleHQgPSB0b1NlbGVjdG9yKHRva2VuR3JvdXBzKTtcbiAgICAgICAgICBzZWxlY3RvcnMucHVzaCh7XG4gICAgICAgICAgICAvLyBTaXp6bGUgZXhwZWN0cyBhbiBhcnJheSBvZiB0b2tlbiBncm91cHMgd2hlbiBjb21waWxpbmcgYSBzZWxlY3RvclxuICAgICAgICAgICAgZ3JvdXBzOiBbdG9rZW5Hcm91cHNdLFxuICAgICAgICAgICAgc2VsZWN0b3JUZXh0OiBzZWxlY3RvclRleHRcbiAgICAgICAgICB9KTsgLy8gTm93IG1ha2Ugc3VyZSB0aGF0IHNlbGVjdG9yIHRva2VucyBhcmUgY2FjaGVkXG5cbiAgICAgICAgICB2YXIgdG9rZW5zQ2FjaGVJdGVtID0ge1xuICAgICAgICAgICAgZ3JvdXBzOiB0b2tlbkdyb3VwcyxcbiAgICAgICAgICAgIHNvcnRlZEdyb3VwczogW3NvcnRlZEdyb3Vwc1tpXV1cbiAgICAgICAgICB9O1xuICAgICAgICAgIHRva2VuQ2FjaGUoc2VsZWN0b3JUZXh0LCB0b2tlbnNDYWNoZUl0ZW0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHNlbGVjdG9ycztcbiAgICAgIH1cbiAgICAgIC8qKlxuICAgICAgICogW0FkR3VhcmQgUGF0Y2hdOlxuICAgICAgICogQWRkIGFuIGFkZGl0aW9uYWwgYXJndW1lbnQgZm9yIFNpenpsZS50b2tlbml6ZSB3aGljaCBpbmRpY2F0ZXMgdGhhdCBpdFxuICAgICAgICogc2hvdWxkIG5vdCB0aHJvdyBvbiBpbnZhbGlkIHRva2VucywgYW5kIGluc3RlYWQgc2hvdWxkIHJldHVybiB0b2tlbnNcbiAgICAgICAqIHRoYXQgaXQgaGFzIHByb2R1Y2VkIHNvIGZhci5cbiAgICAgICAqXG4gICAgICAgKiBPbmUgbW9yZSBhZGRpdGlvbmFsIGFyZ3VtZW50IHRoYXQgYWxsb3cgdG8gY2hvb3NlIGlmIHlvdSB3YW50IHRvIHJlY2VpdmUgc29ydGVkIG9yIHVuc29ydGVkIHRva2Vuc1xuICAgICAgICogVGhlIHByb2JsZW0gaXMgdGhhdCB0aGUgcmUtc29ydGVkIHNlbGVjdG9ycyBhcmUgdmFsaWQgZm9yIFNpenpsZSwgYnV0IG5vdCBmb3IgdGhlIGJyb3dzZXIuXG4gICAgICAgKiBvcHRpb25zLnJldHVyblVuc29ydGVkIC0tIHJldHVybiB1bnNvcnRlZCB0b2tlbnMgaWYgdHJ1ZS5cbiAgICAgICAqIG9wdGlvbnMuY2FjaGVPbmx5IC0tIHJldHVybiBjYWNoZWQgcmVzdWx0IG9ubHkuIFJlcXVpcmVkIGZvciB1bml0LXRlc3RzLlxuICAgICAgICpcbiAgICAgICAqIEBwYXJhbSB7Kn0gb3B0aW9ucyBPcHRpb25hbCBjb25maWd1cmF0aW9uIG9iamVjdCB3aXRoIHR3byBhZGRpdGlvbmFsIGZsYWdzXG4gICAgICAgKiAob3B0aW9ucy50b2xlcmFudCwgb3B0aW9ucy5yZXR1cm5VbnNvcnRlZCwgb3B0aW9ucy5jYWNoZU9ubHkpIC0tIHNlZSBwYXRjaGVzICM1IGFuZCAjNiBub3Rlc1xuICAgICAgICovXG5cblxuICAgICAgdG9rZW5pemUgPSBTaXp6bGUudG9rZW5pemUgPSBmdW5jdGlvbiAoc2VsZWN0b3IsIHBhcnNlT25seSwgb3B0aW9ucykge1xuICAgICAgICB2YXIgbWF0Y2hlZCxcbiAgICAgICAgICAgIG1hdGNoLFxuICAgICAgICAgICAgdG9rZW5zLFxuICAgICAgICAgICAgdHlwZSxcbiAgICAgICAgICAgIHNvRmFyLFxuICAgICAgICAgICAgZ3JvdXBzLFxuICAgICAgICAgICAgcHJlRmlsdGVycyxcbiAgICAgICAgICAgIGNhY2hlZCA9IHRva2VuQ2FjaGVbc2VsZWN0b3IgKyBcIiBcIl07XG4gICAgICAgIHZhciB0b2xlcmFudCA9IG9wdGlvbnMgJiYgb3B0aW9ucy50b2xlcmFudDtcbiAgICAgICAgdmFyIHJldHVyblVuc29ydGVkID0gb3B0aW9ucyAmJiBvcHRpb25zLnJldHVyblVuc29ydGVkO1xuICAgICAgICB2YXIgY2FjaGVPbmx5ID0gb3B0aW9ucyAmJiBvcHRpb25zLmNhY2hlT25seTtcblxuICAgICAgICBpZiAoY2FjaGVkKSB7XG4gICAgICAgICAgaWYgKHBhcnNlT25seSkge1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiAocmV0dXJuVW5zb3J0ZWQgPyBjYWNoZWQuZ3JvdXBzIDogY2FjaGVkLnNvcnRlZEdyb3Vwcykuc2xpY2UoMCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNhY2hlT25seSkge1xuICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgc29GYXIgPSBzZWxlY3RvcjtcbiAgICAgICAgZ3JvdXBzID0gW107XG4gICAgICAgIHByZUZpbHRlcnMgPSBFeHByLnByZUZpbHRlcjtcblxuICAgICAgICB3aGlsZSAoc29GYXIpIHtcbiAgICAgICAgICAvLyBDb21tYSBhbmQgZmlyc3QgcnVuXG4gICAgICAgICAgaWYgKCFtYXRjaGVkIHx8IChtYXRjaCA9IHJjb21tYS5leGVjKHNvRmFyKSkpIHtcbiAgICAgICAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICAgICAgICAvLyBEb24ndCBjb25zdW1lIHRyYWlsaW5nIGNvbW1hcyBhcyB2YWxpZFxuICAgICAgICAgICAgICBzb0ZhciA9IHNvRmFyLnNsaWNlKG1hdGNoWzBdLmxlbmd0aCkgfHwgc29GYXI7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGdyb3Vwcy5wdXNoKHRva2VucyA9IFtdKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBtYXRjaGVkID0gZmFsc2U7IC8vIENvbWJpbmF0b3JzXG5cbiAgICAgICAgICBpZiAobWF0Y2ggPSByY29tYmluYXRvcnMuZXhlYyhzb0ZhcikpIHtcbiAgICAgICAgICAgIG1hdGNoZWQgPSBtYXRjaC5zaGlmdCgpO1xuICAgICAgICAgICAgdG9rZW5zLnB1c2goe1xuICAgICAgICAgICAgICB2YWx1ZTogbWF0Y2hlZCxcbiAgICAgICAgICAgICAgLy8gQ2FzdCBkZXNjZW5kYW50IGNvbWJpbmF0b3JzIHRvIHNwYWNlXG4gICAgICAgICAgICAgIHR5cGU6IG1hdGNoWzBdLnJlcGxhY2UocnRyaW0sIFwiIFwiKVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBzb0ZhciA9IHNvRmFyLnNsaWNlKG1hdGNoZWQubGVuZ3RoKTtcbiAgICAgICAgICB9IC8vIEZpbHRlcnNcblxuXG4gICAgICAgICAgZm9yICh0eXBlIGluIEV4cHIuZmlsdGVyKSB7XG4gICAgICAgICAgICBpZiAoKG1hdGNoID0gbWF0Y2hFeHByW3R5cGVdLmV4ZWMoc29GYXIpKSAmJiAoIXByZUZpbHRlcnNbdHlwZV0gfHwgKG1hdGNoID0gcHJlRmlsdGVyc1t0eXBlXShtYXRjaCkpKSkge1xuICAgICAgICAgICAgICBtYXRjaGVkID0gbWF0Y2guc2hpZnQoKTtcbiAgICAgICAgICAgICAgdG9rZW5zLnB1c2goe1xuICAgICAgICAgICAgICAgIHZhbHVlOiBtYXRjaGVkLFxuICAgICAgICAgICAgICAgIHR5cGU6IHR5cGUsXG4gICAgICAgICAgICAgICAgbWF0Y2hlczogbWF0Y2hcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIHNvRmFyID0gc29GYXIuc2xpY2UobWF0Y2hlZC5sZW5ndGgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmICghbWF0Y2hlZCkge1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9IC8vIFJldHVybiB0aGUgbGVuZ3RoIG9mIHRoZSBpbnZhbGlkIGV4Y2Vzc1xuICAgICAgICAvLyBpZiB3ZSdyZSBqdXN0IHBhcnNpbmdcbiAgICAgICAgLy8gT3RoZXJ3aXNlLCB0aHJvdyBhbiBlcnJvciBvciByZXR1cm4gdG9rZW5zXG5cblxuICAgICAgICB2YXIgaW52YWxpZExlbiA9IHNvRmFyLmxlbmd0aDtcblxuICAgICAgICBpZiAocGFyc2VPbmx5KSB7XG4gICAgICAgICAgcmV0dXJuIGludmFsaWRMZW47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaW52YWxpZExlbiAhPT0gMCAmJiAhdG9sZXJhbnQpIHtcbiAgICAgICAgICBTaXp6bGUuZXJyb3Ioc2VsZWN0b3IpOyAvLyBUaHJvd3MgYW4gZXJyb3IuXG4gICAgICAgIH1cblxuICAgICAgICBpZiAodG9sZXJhbnQpIHtcbiAgICAgICAgICAvKipcbiAgICAgICAgICAgKiBbQWRHdWFyZCBQYXRjaF06XG4gICAgICAgICAgICogSW4gdG9sZXJhbnQgbW9kZSB3ZSByZXR1cm4gYSBzcGVjaWFsIG9iamVjdCB0aGF0IGNvbnN0aXN0cyBvZlxuICAgICAgICAgICAqIGFuIGFycmF5IG9mIHBhcnNlZCBzZWxlY3RvcnMgKGFuZCB0aGVpciB0b2tlbnMpIGFuZCBhIFwibmV4dEluZGV4XCIgZmllbGRcbiAgICAgICAgICAgKiB0aGF0IHBvaW50cyB0byBhbiBpbmRleCBhZnRlciB3aGljaCB3ZSdyZSBub3QgYWJsZSB0byBwYXJzZSBzZWxlY3RvcnMgZmFydGhlci5cbiAgICAgICAgICAgKi9cbiAgICAgICAgICB2YXIgbmV4dEluZGV4ID0gc2VsZWN0b3IubGVuZ3RoIC0gaW52YWxpZExlbjtcbiAgICAgICAgICB2YXIgc2VsZWN0b3JzID0gdG9rZW5Hcm91cHNUb1NlbGVjdG9ycyhncm91cHMpO1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzZWxlY3RvcnM6IHNlbGVjdG9ycyxcbiAgICAgICAgICAgIG5leHRJbmRleDogbmV4dEluZGV4XG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICAvKiogW0FkR3VhcmQgUGF0Y2hdOiBTb3J0aW5nIHRva2VucyAqL1xuXG5cbiAgICAgICAgdmFyIHNvcnRlZEdyb3VwcyA9IHNvcnRUb2tlbkdyb3Vwcyhncm91cHMpO1xuICAgICAgICAvKiogW0FkR3VhcmQgUGF0Y2hdOiBDaGFuZ2UgdGhlIHdheSB0b2tlbnMgYXJlIGNhY2hlZCAqL1xuXG4gICAgICAgIHZhciB0b2tlbnNDYWNoZUl0ZW0gPSB7XG4gICAgICAgICAgZ3JvdXBzOiBncm91cHMsXG4gICAgICAgICAgc29ydGVkR3JvdXBzOiBzb3J0ZWRHcm91cHNcbiAgICAgICAgfTtcbiAgICAgICAgdG9rZW5zQ2FjaGVJdGVtID0gdG9rZW5DYWNoZShzZWxlY3RvciwgdG9rZW5zQ2FjaGVJdGVtKTtcbiAgICAgICAgcmV0dXJuIChyZXR1cm5VbnNvcnRlZCA/IHRva2Vuc0NhY2hlSXRlbS5ncm91cHMgOiB0b2tlbnNDYWNoZUl0ZW0uc29ydGVkR3JvdXBzKS5zbGljZSgwKTtcbiAgICAgIH07XG5cbiAgICAgIGZ1bmN0aW9uIHRvU2VsZWN0b3IodG9rZW5zKSB7XG4gICAgICAgIHZhciBpID0gMCxcbiAgICAgICAgICAgIGxlbiA9IHRva2Vucy5sZW5ndGgsXG4gICAgICAgICAgICBzZWxlY3RvciA9IFwiXCI7XG5cbiAgICAgICAgZm9yICg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgIHNlbGVjdG9yICs9IHRva2Vuc1tpXS52YWx1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBzZWxlY3RvcjtcbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gYWRkQ29tYmluYXRvcihtYXRjaGVyLCBjb21iaW5hdG9yLCBiYXNlKSB7XG4gICAgICAgIHZhciBkaXIgPSBjb21iaW5hdG9yLmRpcixcbiAgICAgICAgICAgIHNraXAgPSBjb21iaW5hdG9yLm5leHQsXG4gICAgICAgICAgICBrZXkgPSBza2lwIHx8IGRpcixcbiAgICAgICAgICAgIGNoZWNrTm9uRWxlbWVudHMgPSBiYXNlICYmIGtleSA9PT0gXCJwYXJlbnROb2RlXCIsXG4gICAgICAgICAgICBkb25lTmFtZSA9IGRvbmUrKztcbiAgICAgICAgcmV0dXJuIGNvbWJpbmF0b3IuZmlyc3QgPyAvLyBDaGVjayBhZ2FpbnN0IGNsb3Nlc3QgYW5jZXN0b3IvcHJlY2VkaW5nIGVsZW1lbnRcbiAgICAgICAgZnVuY3Rpb24gKGVsZW0sIGNvbnRleHQsIHhtbCkge1xuICAgICAgICAgIHdoaWxlIChlbGVtID0gZWxlbVtkaXJdKSB7XG4gICAgICAgICAgICBpZiAoZWxlbS5ub2RlVHlwZSA9PT0gMSB8fCBjaGVja05vbkVsZW1lbnRzKSB7XG4gICAgICAgICAgICAgIHJldHVybiBtYXRjaGVyKGVsZW0sIGNvbnRleHQsIHhtbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9IDogLy8gQ2hlY2sgYWdhaW5zdCBhbGwgYW5jZXN0b3IvcHJlY2VkaW5nIGVsZW1lbnRzXG4gICAgICAgIGZ1bmN0aW9uIChlbGVtLCBjb250ZXh0LCB4bWwpIHtcbiAgICAgICAgICB2YXIgb2xkQ2FjaGUsXG4gICAgICAgICAgICAgIHVuaXF1ZUNhY2hlLFxuICAgICAgICAgICAgICBvdXRlckNhY2hlLFxuICAgICAgICAgICAgICBuZXdDYWNoZSA9IFtkaXJydW5zLCBkb25lTmFtZV07IC8vIFdlIGNhbid0IHNldCBhcmJpdHJhcnkgZGF0YSBvbiBYTUwgbm9kZXMsIHNvIHRoZXkgZG9uJ3QgYmVuZWZpdCBmcm9tIGNvbWJpbmF0b3IgY2FjaGluZ1xuXG4gICAgICAgICAgaWYgKHhtbCkge1xuICAgICAgICAgICAgd2hpbGUgKGVsZW0gPSBlbGVtW2Rpcl0pIHtcbiAgICAgICAgICAgICAgaWYgKGVsZW0ubm9kZVR5cGUgPT09IDEgfHwgY2hlY2tOb25FbGVtZW50cykge1xuICAgICAgICAgICAgICAgIGlmIChtYXRjaGVyKGVsZW0sIGNvbnRleHQsIHhtbCkpIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB3aGlsZSAoZWxlbSA9IGVsZW1bZGlyXSkge1xuICAgICAgICAgICAgICBpZiAoZWxlbS5ub2RlVHlwZSA9PT0gMSB8fCBjaGVja05vbkVsZW1lbnRzKSB7XG4gICAgICAgICAgICAgICAgb3V0ZXJDYWNoZSA9IGVsZW1bZXhwYW5kb10gfHwgKGVsZW1bZXhwYW5kb10gPSB7fSk7IC8vIFN1cHBvcnQ6IElFIDw5IG9ubHlcbiAgICAgICAgICAgICAgICAvLyBEZWZlbmQgYWdhaW5zdCBjbG9uZWQgYXR0cm9wZXJ0aWVzIChqUXVlcnkgZ2gtMTcwOSlcblxuICAgICAgICAgICAgICAgIHVuaXF1ZUNhY2hlID0gb3V0ZXJDYWNoZVtlbGVtLnVuaXF1ZUlEXSB8fCAob3V0ZXJDYWNoZVtlbGVtLnVuaXF1ZUlEXSA9IHt9KTtcblxuICAgICAgICAgICAgICAgIGlmIChza2lwICYmIHNraXAgPT09IGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSkge1xuICAgICAgICAgICAgICAgICAgZWxlbSA9IGVsZW1bZGlyXSB8fCBlbGVtO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoKG9sZENhY2hlID0gdW5pcXVlQ2FjaGVba2V5XSkgJiYgb2xkQ2FjaGVbMF0gPT09IGRpcnJ1bnMgJiYgb2xkQ2FjaGVbMV0gPT09IGRvbmVOYW1lKSB7XG4gICAgICAgICAgICAgICAgICAvLyBBc3NpZ24gdG8gbmV3Q2FjaGUgc28gcmVzdWx0cyBiYWNrLXByb3BhZ2F0ZSB0byBwcmV2aW91cyBlbGVtZW50c1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ld0NhY2hlWzJdID0gb2xkQ2FjaGVbMl07XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIC8vIFJldXNlIG5ld2NhY2hlIHNvIHJlc3VsdHMgYmFjay1wcm9wYWdhdGUgdG8gcHJldmlvdXMgZWxlbWVudHNcbiAgICAgICAgICAgICAgICAgIHVuaXF1ZUNhY2hlW2tleV0gPSBuZXdDYWNoZTsgLy8gQSBtYXRjaCBtZWFucyB3ZSdyZSBkb25lOyBhIGZhaWwgbWVhbnMgd2UgaGF2ZSB0byBrZWVwIGNoZWNraW5nXG5cbiAgICAgICAgICAgICAgICAgIGlmIChuZXdDYWNoZVsyXSA9IG1hdGNoZXIoZWxlbSwgY29udGV4dCwgeG1sKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIGVsZW1lbnRNYXRjaGVyKG1hdGNoZXJzKSB7XG4gICAgICAgIHJldHVybiBtYXRjaGVycy5sZW5ndGggPiAxID8gZnVuY3Rpb24gKGVsZW0sIGNvbnRleHQsIHhtbCkge1xuICAgICAgICAgIHZhciBpID0gbWF0Y2hlcnMubGVuZ3RoO1xuXG4gICAgICAgICAgd2hpbGUgKGktLSkge1xuICAgICAgICAgICAgaWYgKCFtYXRjaGVyc1tpXShlbGVtLCBjb250ZXh0LCB4bWwpKSB7XG4gICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSA6IG1hdGNoZXJzWzBdO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBtdWx0aXBsZUNvbnRleHRzKHNlbGVjdG9yLCBjb250ZXh0cywgcmVzdWx0cykge1xuICAgICAgICB2YXIgaSA9IDAsXG4gICAgICAgICAgICBsZW4gPSBjb250ZXh0cy5sZW5ndGg7XG5cbiAgICAgICAgZm9yICg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgIFNpenpsZShzZWxlY3RvciwgY29udGV4dHNbaV0sIHJlc3VsdHMpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIGNvbmRlbnNlKHVubWF0Y2hlZCwgbWFwLCBmaWx0ZXIsIGNvbnRleHQsIHhtbCkge1xuICAgICAgICB2YXIgZWxlbSxcbiAgICAgICAgICAgIG5ld1VubWF0Y2hlZCA9IFtdLFxuICAgICAgICAgICAgaSA9IDAsXG4gICAgICAgICAgICBsZW4gPSB1bm1hdGNoZWQubGVuZ3RoLFxuICAgICAgICAgICAgbWFwcGVkID0gbWFwICE9IG51bGw7XG5cbiAgICAgICAgZm9yICg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgIGlmIChlbGVtID0gdW5tYXRjaGVkW2ldKSB7XG4gICAgICAgICAgICBpZiAoIWZpbHRlciB8fCBmaWx0ZXIoZWxlbSwgY29udGV4dCwgeG1sKSkge1xuICAgICAgICAgICAgICBuZXdVbm1hdGNoZWQucHVzaChlbGVtKTtcblxuICAgICAgICAgICAgICBpZiAobWFwcGVkKSB7XG4gICAgICAgICAgICAgICAgbWFwLnB1c2goaSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbmV3VW5tYXRjaGVkO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBzZXRNYXRjaGVyKHByZUZpbHRlciwgc2VsZWN0b3IsIG1hdGNoZXIsIHBvc3RGaWx0ZXIsIHBvc3RGaW5kZXIsIHBvc3RTZWxlY3Rvcikge1xuICAgICAgICBpZiAocG9zdEZpbHRlciAmJiAhcG9zdEZpbHRlcltleHBhbmRvXSkge1xuICAgICAgICAgIHBvc3RGaWx0ZXIgPSBzZXRNYXRjaGVyKHBvc3RGaWx0ZXIpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHBvc3RGaW5kZXIgJiYgIXBvc3RGaW5kZXJbZXhwYW5kb10pIHtcbiAgICAgICAgICBwb3N0RmluZGVyID0gc2V0TWF0Y2hlcihwb3N0RmluZGVyLCBwb3N0U2VsZWN0b3IpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG1hcmtGdW5jdGlvbihmdW5jdGlvbiAoc2VlZCwgcmVzdWx0cywgY29udGV4dCwgeG1sKSB7XG4gICAgICAgICAgdmFyIHRlbXAsXG4gICAgICAgICAgICAgIGksXG4gICAgICAgICAgICAgIGVsZW0sXG4gICAgICAgICAgICAgIHByZU1hcCA9IFtdLFxuICAgICAgICAgICAgICBwb3N0TWFwID0gW10sXG4gICAgICAgICAgICAgIHByZWV4aXN0aW5nID0gcmVzdWx0cy5sZW5ndGgsXG4gICAgICAgICAgICAgIC8vIEdldCBpbml0aWFsIGVsZW1lbnRzIGZyb20gc2VlZCBvciBjb250ZXh0XG4gICAgICAgICAgZWxlbXMgPSBzZWVkIHx8IG11bHRpcGxlQ29udGV4dHMoc2VsZWN0b3IgfHwgXCIqXCIsIGNvbnRleHQubm9kZVR5cGUgPyBbY29udGV4dF0gOiBjb250ZXh0LCBbXSksXG4gICAgICAgICAgICAgIC8vIFByZWZpbHRlciB0byBnZXQgbWF0Y2hlciBpbnB1dCwgcHJlc2VydmluZyBhIG1hcCBmb3Igc2VlZC1yZXN1bHRzIHN5bmNocm9uaXphdGlvblxuICAgICAgICAgIG1hdGNoZXJJbiA9IHByZUZpbHRlciAmJiAoc2VlZCB8fCAhc2VsZWN0b3IpID8gY29uZGVuc2UoZWxlbXMsIHByZU1hcCwgcHJlRmlsdGVyLCBjb250ZXh0LCB4bWwpIDogZWxlbXMsXG4gICAgICAgICAgICAgIG1hdGNoZXJPdXQgPSBtYXRjaGVyID8gLy8gSWYgd2UgaGF2ZSBhIHBvc3RGaW5kZXIsIG9yIGZpbHRlcmVkIHNlZWQsIG9yIG5vbi1zZWVkIHBvc3RGaWx0ZXIgb3IgcHJlZXhpc3RpbmcgcmVzdWx0cyxcbiAgICAgICAgICBwb3N0RmluZGVyIHx8IChzZWVkID8gcHJlRmlsdGVyIDogcHJlZXhpc3RpbmcgfHwgcG9zdEZpbHRlcikgPyAvLyAuLi5pbnRlcm1lZGlhdGUgcHJvY2Vzc2luZyBpcyBuZWNlc3NhcnlcbiAgICAgICAgICBbXSA6IC8vIC4uLm90aGVyd2lzZSB1c2UgcmVzdWx0cyBkaXJlY3RseVxuICAgICAgICAgIHJlc3VsdHMgOiBtYXRjaGVySW47IC8vIEZpbmQgcHJpbWFyeSBtYXRjaGVzXG5cbiAgICAgICAgICBpZiAobWF0Y2hlcikge1xuICAgICAgICAgICAgbWF0Y2hlcihtYXRjaGVySW4sIG1hdGNoZXJPdXQsIGNvbnRleHQsIHhtbCk7XG4gICAgICAgICAgfSAvLyBBcHBseSBwb3N0RmlsdGVyXG5cblxuICAgICAgICAgIGlmIChwb3N0RmlsdGVyKSB7XG4gICAgICAgICAgICB0ZW1wID0gY29uZGVuc2UobWF0Y2hlck91dCwgcG9zdE1hcCk7XG4gICAgICAgICAgICBwb3N0RmlsdGVyKHRlbXAsIFtdLCBjb250ZXh0LCB4bWwpOyAvLyBVbi1tYXRjaCBmYWlsaW5nIGVsZW1lbnRzIGJ5IG1vdmluZyB0aGVtIGJhY2sgdG8gbWF0Y2hlckluXG5cbiAgICAgICAgICAgIGkgPSB0ZW1wLmxlbmd0aDtcblxuICAgICAgICAgICAgd2hpbGUgKGktLSkge1xuICAgICAgICAgICAgICBpZiAoZWxlbSA9IHRlbXBbaV0pIHtcbiAgICAgICAgICAgICAgICBtYXRjaGVyT3V0W3Bvc3RNYXBbaV1dID0gIShtYXRjaGVySW5bcG9zdE1hcFtpXV0gPSBlbGVtKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChzZWVkKSB7XG4gICAgICAgICAgICBpZiAocG9zdEZpbmRlciB8fCBwcmVGaWx0ZXIpIHtcbiAgICAgICAgICAgICAgaWYgKHBvc3RGaW5kZXIpIHtcbiAgICAgICAgICAgICAgICAvLyBHZXQgdGhlIGZpbmFsIG1hdGNoZXJPdXQgYnkgY29uZGVuc2luZyB0aGlzIGludGVybWVkaWF0ZSBpbnRvIHBvc3RGaW5kZXIgY29udGV4dHNcbiAgICAgICAgICAgICAgICB0ZW1wID0gW107XG4gICAgICAgICAgICAgICAgaSA9IG1hdGNoZXJPdXQubGVuZ3RoO1xuXG4gICAgICAgICAgICAgICAgd2hpbGUgKGktLSkge1xuICAgICAgICAgICAgICAgICAgaWYgKGVsZW0gPSBtYXRjaGVyT3V0W2ldKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFJlc3RvcmUgbWF0Y2hlckluIHNpbmNlIGVsZW0gaXMgbm90IHlldCBhIGZpbmFsIG1hdGNoXG4gICAgICAgICAgICAgICAgICAgIHRlbXAucHVzaChtYXRjaGVySW5baV0gPSBlbGVtKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBwb3N0RmluZGVyKG51bGwsIG1hdGNoZXJPdXQgPSBbXSwgdGVtcCwgeG1sKTtcbiAgICAgICAgICAgICAgfSAvLyBNb3ZlIG1hdGNoZWQgZWxlbWVudHMgZnJvbSBzZWVkIHRvIHJlc3VsdHMgdG8ga2VlcCB0aGVtIHN5bmNocm9uaXplZFxuXG5cbiAgICAgICAgICAgICAgaSA9IG1hdGNoZXJPdXQubGVuZ3RoO1xuXG4gICAgICAgICAgICAgIHdoaWxlIChpLS0pIHtcbiAgICAgICAgICAgICAgICBpZiAoKGVsZW0gPSBtYXRjaGVyT3V0W2ldKSAmJiAodGVtcCA9IHBvc3RGaW5kZXIgPyBpbmRleE9mKHNlZWQsIGVsZW0pIDogcHJlTWFwW2ldKSA+IC0xKSB7XG4gICAgICAgICAgICAgICAgICBzZWVkW3RlbXBdID0gIShyZXN1bHRzW3RlbXBdID0gZWxlbSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IC8vIEFkZCBlbGVtZW50cyB0byByZXN1bHRzLCB0aHJvdWdoIHBvc3RGaW5kZXIgaWYgZGVmaW5lZFxuXG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG1hdGNoZXJPdXQgPSBjb25kZW5zZShtYXRjaGVyT3V0ID09PSByZXN1bHRzID8gbWF0Y2hlck91dC5zcGxpY2UocHJlZXhpc3RpbmcsIG1hdGNoZXJPdXQubGVuZ3RoKSA6IG1hdGNoZXJPdXQpO1xuXG4gICAgICAgICAgICBpZiAocG9zdEZpbmRlcikge1xuICAgICAgICAgICAgICBwb3N0RmluZGVyKG51bGwsIHJlc3VsdHMsIG1hdGNoZXJPdXQsIHhtbCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBwdXNoLmFwcGx5KHJlc3VsdHMsIG1hdGNoZXJPdXQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIG1hdGNoZXJGcm9tVG9rZW5zKHRva2Vucykge1xuICAgICAgICB2YXIgY2hlY2tDb250ZXh0LFxuICAgICAgICAgICAgbWF0Y2hlcixcbiAgICAgICAgICAgIGosXG4gICAgICAgICAgICBsZW4gPSB0b2tlbnMubGVuZ3RoLFxuICAgICAgICAgICAgbGVhZGluZ1JlbGF0aXZlID0gRXhwci5yZWxhdGl2ZVt0b2tlbnNbMF0udHlwZV0sXG4gICAgICAgICAgICBpbXBsaWNpdFJlbGF0aXZlID0gbGVhZGluZ1JlbGF0aXZlIHx8IEV4cHIucmVsYXRpdmVbXCIgXCJdLFxuICAgICAgICAgICAgaSA9IGxlYWRpbmdSZWxhdGl2ZSA/IDEgOiAwLFxuICAgICAgICAgICAgLy8gVGhlIGZvdW5kYXRpb25hbCBtYXRjaGVyIGVuc3VyZXMgdGhhdCBlbGVtZW50cyBhcmUgcmVhY2hhYmxlIGZyb20gdG9wLWxldmVsIGNvbnRleHQocylcbiAgICAgICAgbWF0Y2hDb250ZXh0ID0gYWRkQ29tYmluYXRvcihmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICAgIHJldHVybiBlbGVtID09PSBjaGVja0NvbnRleHQ7XG4gICAgICAgIH0sIGltcGxpY2l0UmVsYXRpdmUsIHRydWUpLFxuICAgICAgICAgICAgbWF0Y2hBbnlDb250ZXh0ID0gYWRkQ29tYmluYXRvcihmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICAgIHJldHVybiBpbmRleE9mKGNoZWNrQ29udGV4dCwgZWxlbSkgPiAtMTtcbiAgICAgICAgfSwgaW1wbGljaXRSZWxhdGl2ZSwgdHJ1ZSksXG4gICAgICAgICAgICBtYXRjaGVycyA9IFtmdW5jdGlvbiAoZWxlbSwgY29udGV4dCwgeG1sKSB7XG4gICAgICAgICAgdmFyIHJldCA9ICFsZWFkaW5nUmVsYXRpdmUgJiYgKHhtbCB8fCBjb250ZXh0ICE9PSBvdXRlcm1vc3RDb250ZXh0KSB8fCAoKGNoZWNrQ29udGV4dCA9IGNvbnRleHQpLm5vZGVUeXBlID8gbWF0Y2hDb250ZXh0KGVsZW0sIGNvbnRleHQsIHhtbCkgOiBtYXRjaEFueUNvbnRleHQoZWxlbSwgY29udGV4dCwgeG1sKSk7IC8vIEF2b2lkIGhhbmdpbmcgb250byBlbGVtZW50IChpc3N1ZSAjMjk5KVxuXG4gICAgICAgICAgY2hlY2tDb250ZXh0ID0gbnVsbDtcbiAgICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgICB9XTtcblxuICAgICAgICBmb3IgKDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgaWYgKG1hdGNoZXIgPSBFeHByLnJlbGF0aXZlW3Rva2Vuc1tpXS50eXBlXSkge1xuICAgICAgICAgICAgbWF0Y2hlcnMgPSBbYWRkQ29tYmluYXRvcihlbGVtZW50TWF0Y2hlcihtYXRjaGVycyksIG1hdGNoZXIpXTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbWF0Y2hlciA9IEV4cHIuZmlsdGVyW3Rva2Vuc1tpXS50eXBlXS5hcHBseShudWxsLCB0b2tlbnNbaV0ubWF0Y2hlcyk7IC8vIFJldHVybiBzcGVjaWFsIHVwb24gc2VlaW5nIGEgcG9zaXRpb25hbCBtYXRjaGVyXG5cbiAgICAgICAgICAgIGlmIChtYXRjaGVyW2V4cGFuZG9dKSB7XG4gICAgICAgICAgICAgIC8vIEZpbmQgdGhlIG5leHQgcmVsYXRpdmUgb3BlcmF0b3IgKGlmIGFueSkgZm9yIHByb3BlciBoYW5kbGluZ1xuICAgICAgICAgICAgICBqID0gKytpO1xuXG4gICAgICAgICAgICAgIGZvciAoOyBqIDwgbGVuOyBqKyspIHtcbiAgICAgICAgICAgICAgICBpZiAoRXhwci5yZWxhdGl2ZVt0b2tlbnNbal0udHlwZV0pIHtcbiAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIHJldHVybiBzZXRNYXRjaGVyKGkgPiAxICYmIGVsZW1lbnRNYXRjaGVyKG1hdGNoZXJzKSwgaSA+IDEgJiYgdG9TZWxlY3RvciggLy8gSWYgdGhlIHByZWNlZGluZyB0b2tlbiB3YXMgYSBkZXNjZW5kYW50IGNvbWJpbmF0b3IsIGluc2VydCBhbiBpbXBsaWNpdCBhbnktZWxlbWVudCBgKmBcbiAgICAgICAgICAgICAgdG9rZW5zLnNsaWNlKDAsIGkgLSAxKS5jb25jYXQoe1xuICAgICAgICAgICAgICAgIHZhbHVlOiB0b2tlbnNbaSAtIDJdLnR5cGUgPT09IFwiIFwiID8gXCIqXCIgOiBcIlwiXG4gICAgICAgICAgICAgIH0pKS5yZXBsYWNlKHJ0cmltLCBcIiQxXCIpLCBtYXRjaGVyLCBpIDwgaiAmJiBtYXRjaGVyRnJvbVRva2Vucyh0b2tlbnMuc2xpY2UoaSwgaikpLCBqIDwgbGVuICYmIG1hdGNoZXJGcm9tVG9rZW5zKHRva2VucyA9IHRva2Vucy5zbGljZShqKSksIGogPCBsZW4gJiYgdG9TZWxlY3Rvcih0b2tlbnMpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbWF0Y2hlcnMucHVzaChtYXRjaGVyKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZWxlbWVudE1hdGNoZXIobWF0Y2hlcnMpO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBtYXRjaGVyRnJvbUdyb3VwTWF0Y2hlcnMoZWxlbWVudE1hdGNoZXJzLCBzZXRNYXRjaGVycykge1xuICAgICAgICB2YXIgYnlTZXQgPSBzZXRNYXRjaGVycy5sZW5ndGggPiAwLFxuICAgICAgICAgICAgYnlFbGVtZW50ID0gZWxlbWVudE1hdGNoZXJzLmxlbmd0aCA+IDAsXG4gICAgICAgICAgICBzdXBlck1hdGNoZXIgPSBmdW5jdGlvbiBzdXBlck1hdGNoZXIoc2VlZCwgY29udGV4dCwgeG1sLCByZXN1bHRzLCBvdXRlcm1vc3QpIHtcbiAgICAgICAgICB2YXIgZWxlbSxcbiAgICAgICAgICAgICAgaixcbiAgICAgICAgICAgICAgbWF0Y2hlcixcbiAgICAgICAgICAgICAgbWF0Y2hlZENvdW50ID0gMCxcbiAgICAgICAgICAgICAgaSA9IFwiMFwiLFxuICAgICAgICAgICAgICB1bm1hdGNoZWQgPSBzZWVkICYmIFtdLFxuICAgICAgICAgICAgICBzZXRNYXRjaGVkID0gW10sXG4gICAgICAgICAgICAgIGNvbnRleHRCYWNrdXAgPSBvdXRlcm1vc3RDb250ZXh0LFxuICAgICAgICAgICAgICAvLyBXZSBtdXN0IGFsd2F5cyBoYXZlIGVpdGhlciBzZWVkIGVsZW1lbnRzIG9yIG91dGVybW9zdCBjb250ZXh0XG4gICAgICAgICAgZWxlbXMgPSBzZWVkIHx8IGJ5RWxlbWVudCAmJiBFeHByLmZpbmRbXCJUQUdcIl0oXCIqXCIsIG91dGVybW9zdCksXG4gICAgICAgICAgICAgIC8vIFVzZSBpbnRlZ2VyIGRpcnJ1bnMgaWZmIHRoaXMgaXMgdGhlIG91dGVybW9zdCBtYXRjaGVyXG4gICAgICAgICAgZGlycnVuc1VuaXF1ZSA9IGRpcnJ1bnMgKz0gY29udGV4dEJhY2t1cCA9PSBudWxsID8gMSA6IE1hdGgucmFuZG9tKCkgfHwgMC4xLFxuICAgICAgICAgICAgICBsZW4gPSBlbGVtcy5sZW5ndGg7XG5cbiAgICAgICAgICBpZiAob3V0ZXJtb3N0KSB7XG4gICAgICAgICAgICBvdXRlcm1vc3RDb250ZXh0ID0gY29udGV4dCA9PT0gZG9jdW1lbnQgfHwgY29udGV4dCB8fCBvdXRlcm1vc3Q7XG4gICAgICAgICAgfSAvLyBBZGQgZWxlbWVudHMgcGFzc2luZyBlbGVtZW50TWF0Y2hlcnMgZGlyZWN0bHkgdG8gcmVzdWx0c1xuICAgICAgICAgIC8vIFN1cHBvcnQ6IElFPDksIFNhZmFyaVxuICAgICAgICAgIC8vIFRvbGVyYXRlIE5vZGVMaXN0IHByb3BlcnRpZXMgKElFOiBcImxlbmd0aFwiOyBTYWZhcmk6IDxudW1iZXI+KSBtYXRjaGluZyBlbGVtZW50cyBieSBpZFxuXG5cbiAgICAgICAgICBmb3IgKDsgaSAhPT0gbGVuICYmIChlbGVtID0gZWxlbXNbaV0pICE9IG51bGw7IGkrKykge1xuICAgICAgICAgICAgaWYgKGJ5RWxlbWVudCAmJiBlbGVtKSB7XG4gICAgICAgICAgICAgIGogPSAwO1xuXG4gICAgICAgICAgICAgIGlmICghY29udGV4dCAmJiBlbGVtLm93bmVyRG9jdW1lbnQgIT09IGRvY3VtZW50KSB7XG4gICAgICAgICAgICAgICAgc2V0RG9jdW1lbnQoZWxlbSk7XG4gICAgICAgICAgICAgICAgeG1sID0gIWRvY3VtZW50SXNIVE1MO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgd2hpbGUgKG1hdGNoZXIgPSBlbGVtZW50TWF0Y2hlcnNbaisrXSkge1xuICAgICAgICAgICAgICAgIGlmIChtYXRjaGVyKGVsZW0sIGNvbnRleHQgfHwgZG9jdW1lbnQsIHhtbCkpIHtcbiAgICAgICAgICAgICAgICAgIHJlc3VsdHMucHVzaChlbGVtKTtcbiAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGlmIChvdXRlcm1vc3QpIHtcbiAgICAgICAgICAgICAgICBkaXJydW5zID0gZGlycnVuc1VuaXF1ZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSAvLyBUcmFjayB1bm1hdGNoZWQgZWxlbWVudHMgZm9yIHNldCBmaWx0ZXJzXG5cblxuICAgICAgICAgICAgaWYgKGJ5U2V0KSB7XG4gICAgICAgICAgICAgIC8vIFRoZXkgd2lsbCBoYXZlIGdvbmUgdGhyb3VnaCBhbGwgcG9zc2libGUgbWF0Y2hlcnNcbiAgICAgICAgICAgICAgaWYgKGVsZW0gPSAhbWF0Y2hlciAmJiBlbGVtKSB7XG4gICAgICAgICAgICAgICAgbWF0Y2hlZENvdW50LS07XG4gICAgICAgICAgICAgIH0gLy8gTGVuZ3RoZW4gdGhlIGFycmF5IGZvciBldmVyeSBlbGVtZW50LCBtYXRjaGVkIG9yIG5vdFxuXG5cbiAgICAgICAgICAgICAgaWYgKHNlZWQpIHtcbiAgICAgICAgICAgICAgICB1bm1hdGNoZWQucHVzaChlbGVtKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gLy8gYGlgIGlzIG5vdyB0aGUgY291bnQgb2YgZWxlbWVudHMgdmlzaXRlZCBhYm92ZSwgYW5kIGFkZGluZyBpdCB0byBgbWF0Y2hlZENvdW50YFxuICAgICAgICAgIC8vIG1ha2VzIHRoZSBsYXR0ZXIgbm9ubmVnYXRpdmUuXG5cblxuICAgICAgICAgIG1hdGNoZWRDb3VudCArPSBpOyAvLyBBcHBseSBzZXQgZmlsdGVycyB0byB1bm1hdGNoZWQgZWxlbWVudHNcbiAgICAgICAgICAvLyBOT1RFOiBUaGlzIGNhbiBiZSBza2lwcGVkIGlmIHRoZXJlIGFyZSBubyB1bm1hdGNoZWQgZWxlbWVudHMgKGkuZS4sIGBtYXRjaGVkQ291bnRgXG4gICAgICAgICAgLy8gZXF1YWxzIGBpYCksIHVubGVzcyB3ZSBkaWRuJ3QgdmlzaXQgX2FueV8gZWxlbWVudHMgaW4gdGhlIGFib3ZlIGxvb3AgYmVjYXVzZSB3ZSBoYXZlXG4gICAgICAgICAgLy8gbm8gZWxlbWVudCBtYXRjaGVycyBhbmQgbm8gc2VlZC5cbiAgICAgICAgICAvLyBJbmNyZW1lbnRpbmcgYW4gaW5pdGlhbGx5LXN0cmluZyBcIjBcIiBgaWAgYWxsb3dzIGBpYCB0byByZW1haW4gYSBzdHJpbmcgb25seSBpbiB0aGF0XG4gICAgICAgICAgLy8gY2FzZSwgd2hpY2ggd2lsbCByZXN1bHQgaW4gYSBcIjAwXCIgYG1hdGNoZWRDb3VudGAgdGhhdCBkaWZmZXJzIGZyb20gYGlgIGJ1dCBpcyBhbHNvXG4gICAgICAgICAgLy8gbnVtZXJpY2FsbHkgemVyby5cblxuICAgICAgICAgIGlmIChieVNldCAmJiBpICE9PSBtYXRjaGVkQ291bnQpIHtcbiAgICAgICAgICAgIGogPSAwO1xuXG4gICAgICAgICAgICB3aGlsZSAobWF0Y2hlciA9IHNldE1hdGNoZXJzW2orK10pIHtcbiAgICAgICAgICAgICAgbWF0Y2hlcih1bm1hdGNoZWQsIHNldE1hdGNoZWQsIGNvbnRleHQsIHhtbCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChzZWVkKSB7XG4gICAgICAgICAgICAgIC8vIFJlaW50ZWdyYXRlIGVsZW1lbnQgbWF0Y2hlcyB0byBlbGltaW5hdGUgdGhlIG5lZWQgZm9yIHNvcnRpbmdcbiAgICAgICAgICAgICAgaWYgKG1hdGNoZWRDb3VudCA+IDApIHtcbiAgICAgICAgICAgICAgICB3aGlsZSAoaS0tKSB7XG4gICAgICAgICAgICAgICAgICBpZiAoISh1bm1hdGNoZWRbaV0gfHwgc2V0TWF0Y2hlZFtpXSkpIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0TWF0Y2hlZFtpXSA9IHBvcC5jYWxsKHJlc3VsdHMpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSAvLyBEaXNjYXJkIGluZGV4IHBsYWNlaG9sZGVyIHZhbHVlcyB0byBnZXQgb25seSBhY3R1YWwgbWF0Y2hlc1xuXG5cbiAgICAgICAgICAgICAgc2V0TWF0Y2hlZCA9IGNvbmRlbnNlKHNldE1hdGNoZWQpO1xuICAgICAgICAgICAgfSAvLyBBZGQgbWF0Y2hlcyB0byByZXN1bHRzXG5cblxuICAgICAgICAgICAgcHVzaC5hcHBseShyZXN1bHRzLCBzZXRNYXRjaGVkKTsgLy8gU2VlZGxlc3Mgc2V0IG1hdGNoZXMgc3VjY2VlZGluZyBtdWx0aXBsZSBzdWNjZXNzZnVsIG1hdGNoZXJzIHN0aXB1bGF0ZSBzb3J0aW5nXG5cbiAgICAgICAgICAgIGlmIChvdXRlcm1vc3QgJiYgIXNlZWQgJiYgc2V0TWF0Y2hlZC5sZW5ndGggPiAwICYmIG1hdGNoZWRDb3VudCArIHNldE1hdGNoZXJzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgU2l6emxlLnVuaXF1ZVNvcnQocmVzdWx0cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSAvLyBPdmVycmlkZSBtYW5pcHVsYXRpb24gb2YgZ2xvYmFscyBieSBuZXN0ZWQgbWF0Y2hlcnNcblxuXG4gICAgICAgICAgaWYgKG91dGVybW9zdCkge1xuICAgICAgICAgICAgZGlycnVucyA9IGRpcnJ1bnNVbmlxdWU7XG4gICAgICAgICAgICBvdXRlcm1vc3RDb250ZXh0ID0gY29udGV4dEJhY2t1cDtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gdW5tYXRjaGVkO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBieVNldCA/IG1hcmtGdW5jdGlvbihzdXBlck1hdGNoZXIpIDogc3VwZXJNYXRjaGVyO1xuICAgICAgfVxuXG4gICAgICBjb21waWxlID0gU2l6emxlLmNvbXBpbGUgPSBmdW5jdGlvbiAoc2VsZWN0b3IsIG1hdGNoXG4gICAgICAvKiBJbnRlcm5hbCBVc2UgT25seSAqL1xuICAgICAgKSB7XG4gICAgICAgIHZhciBpLFxuICAgICAgICAgICAgc2V0TWF0Y2hlcnMgPSBbXSxcbiAgICAgICAgICAgIGVsZW1lbnRNYXRjaGVycyA9IFtdLFxuICAgICAgICAgICAgY2FjaGVkID0gY29tcGlsZXJDYWNoZVtzZWxlY3RvciArIFwiIFwiXTtcblxuICAgICAgICBpZiAoIWNhY2hlZCkge1xuICAgICAgICAgIC8vIEdlbmVyYXRlIGEgZnVuY3Rpb24gb2YgcmVjdXJzaXZlIGZ1bmN0aW9ucyB0aGF0IGNhbiBiZSB1c2VkIHRvIGNoZWNrIGVhY2ggZWxlbWVudFxuICAgICAgICAgIGlmICghbWF0Y2gpIHtcbiAgICAgICAgICAgIG1hdGNoID0gdG9rZW5pemUoc2VsZWN0b3IpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGkgPSBtYXRjaC5sZW5ndGg7XG5cbiAgICAgICAgICB3aGlsZSAoaS0tKSB7XG4gICAgICAgICAgICBjYWNoZWQgPSBtYXRjaGVyRnJvbVRva2VucyhtYXRjaFtpXSk7XG5cbiAgICAgICAgICAgIGlmIChjYWNoZWRbZXhwYW5kb10pIHtcbiAgICAgICAgICAgICAgc2V0TWF0Y2hlcnMucHVzaChjYWNoZWQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgZWxlbWVudE1hdGNoZXJzLnB1c2goY2FjaGVkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IC8vIENhY2hlIHRoZSBjb21waWxlZCBmdW5jdGlvblxuXG5cbiAgICAgICAgICBjYWNoZWQgPSBjb21waWxlckNhY2hlKHNlbGVjdG9yLCBtYXRjaGVyRnJvbUdyb3VwTWF0Y2hlcnMoZWxlbWVudE1hdGNoZXJzLCBzZXRNYXRjaGVycykpOyAvLyBTYXZlIHNlbGVjdG9yIGFuZCB0b2tlbml6YXRpb25cblxuICAgICAgICAgIGNhY2hlZC5zZWxlY3RvciA9IHNlbGVjdG9yO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGNhY2hlZDtcbiAgICAgIH07XG4gICAgICAvKipcbiAgICAgICAqIEEgbG93LWxldmVsIHNlbGVjdGlvbiBmdW5jdGlvbiB0aGF0IHdvcmtzIHdpdGggU2l6emxlJ3MgY29tcGlsZWRcbiAgICAgICAqICBzZWxlY3RvciBmdW5jdGlvbnNcbiAgICAgICAqIEBwYXJhbSB7U3RyaW5nfEZ1bmN0aW9ufSBzZWxlY3RvciBBIHNlbGVjdG9yIG9yIGEgcHJlLWNvbXBpbGVkXG4gICAgICAgKiAgc2VsZWN0b3IgZnVuY3Rpb24gYnVpbHQgd2l0aCBTaXp6bGUuY29tcGlsZVxuICAgICAgICogQHBhcmFtIHtFbGVtZW50fSBjb250ZXh0XG4gICAgICAgKiBAcGFyYW0ge0FycmF5fSBbcmVzdWx0c11cbiAgICAgICAqIEBwYXJhbSB7QXJyYXl9IFtzZWVkXSBBIHNldCBvZiBlbGVtZW50cyB0byBtYXRjaCBhZ2FpbnN0XG4gICAgICAgKi9cblxuXG4gICAgICBzZWxlY3QgPSBTaXp6bGUuc2VsZWN0ID0gZnVuY3Rpb24gKHNlbGVjdG9yLCBjb250ZXh0LCByZXN1bHRzLCBzZWVkKSB7XG4gICAgICAgIHZhciBpLFxuICAgICAgICAgICAgdG9rZW5zLFxuICAgICAgICAgICAgdG9rZW4sXG4gICAgICAgICAgICB0eXBlLFxuICAgICAgICAgICAgZmluZCxcbiAgICAgICAgICAgIGNvbXBpbGVkID0gdHlwZW9mIHNlbGVjdG9yID09PSBcImZ1bmN0aW9uXCIgJiYgc2VsZWN0b3IsXG4gICAgICAgICAgICBtYXRjaCA9ICFzZWVkICYmIHRva2VuaXplKHNlbGVjdG9yID0gY29tcGlsZWQuc2VsZWN0b3IgfHwgc2VsZWN0b3IpO1xuICAgICAgICByZXN1bHRzID0gcmVzdWx0cyB8fCBbXTsgLy8gVHJ5IHRvIG1pbmltaXplIG9wZXJhdGlvbnMgaWYgdGhlcmUgaXMgb25seSBvbmUgc2VsZWN0b3IgaW4gdGhlIGxpc3QgYW5kIG5vIHNlZWRcbiAgICAgICAgLy8gKHRoZSBsYXR0ZXIgb2Ygd2hpY2ggZ3VhcmFudGVlcyB1cyBjb250ZXh0KVxuXG4gICAgICAgIGlmIChtYXRjaC5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAvLyBSZWR1Y2UgY29udGV4dCBpZiB0aGUgbGVhZGluZyBjb21wb3VuZCBzZWxlY3RvciBpcyBhbiBJRFxuICAgICAgICAgIHRva2VucyA9IG1hdGNoWzBdID0gbWF0Y2hbMF0uc2xpY2UoMCk7XG5cbiAgICAgICAgICBpZiAodG9rZW5zLmxlbmd0aCA+IDIgJiYgKHRva2VuID0gdG9rZW5zWzBdKS50eXBlID09PSBcIklEXCIgJiYgY29udGV4dC5ub2RlVHlwZSA9PT0gOSAmJiBkb2N1bWVudElzSFRNTCAmJiBFeHByLnJlbGF0aXZlW3Rva2Vuc1sxXS50eXBlXSkge1xuICAgICAgICAgICAgY29udGV4dCA9IChFeHByLmZpbmRbXCJJRFwiXSh0b2tlbi5tYXRjaGVzWzBdLnJlcGxhY2UocnVuZXNjYXBlLCBmdW5lc2NhcGUpLCBjb250ZXh0KSB8fCBbXSlbMF07XG5cbiAgICAgICAgICAgIGlmICghY29udGV4dCkge1xuICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0czsgLy8gUHJlY29tcGlsZWQgbWF0Y2hlcnMgd2lsbCBzdGlsbCB2ZXJpZnkgYW5jZXN0cnksIHNvIHN0ZXAgdXAgYSBsZXZlbFxuICAgICAgICAgICAgfSBlbHNlIGlmIChjb21waWxlZCkge1xuICAgICAgICAgICAgICBjb250ZXh0ID0gY29udGV4dC5wYXJlbnROb2RlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzZWxlY3RvciA9IHNlbGVjdG9yLnNsaWNlKHRva2Vucy5zaGlmdCgpLnZhbHVlLmxlbmd0aCk7XG4gICAgICAgICAgfSAvLyBGZXRjaCBhIHNlZWQgc2V0IGZvciByaWdodC10by1sZWZ0IG1hdGNoaW5nXG5cblxuICAgICAgICAgIGkgPSBtYXRjaEV4cHJbXCJuZWVkc0NvbnRleHRcIl0udGVzdChzZWxlY3RvcikgPyAwIDogdG9rZW5zLmxlbmd0aDtcblxuICAgICAgICAgIHdoaWxlIChpLS0pIHtcbiAgICAgICAgICAgIHRva2VuID0gdG9rZW5zW2ldOyAvLyBBYm9ydCBpZiB3ZSBoaXQgYSBjb21iaW5hdG9yXG5cbiAgICAgICAgICAgIGlmIChFeHByLnJlbGF0aXZlW3R5cGUgPSB0b2tlbi50eXBlXSkge1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGZpbmQgPSBFeHByLmZpbmRbdHlwZV0pIHtcbiAgICAgICAgICAgICAgLy8gU2VhcmNoLCBleHBhbmRpbmcgY29udGV4dCBmb3IgbGVhZGluZyBzaWJsaW5nIGNvbWJpbmF0b3JzXG4gICAgICAgICAgICAgIGlmIChzZWVkID0gZmluZCh0b2tlbi5tYXRjaGVzWzBdLnJlcGxhY2UocnVuZXNjYXBlLCBmdW5lc2NhcGUpLCByc2libGluZy50ZXN0KHRva2Vuc1swXS50eXBlKSAmJiB0ZXN0Q29udGV4dChjb250ZXh0LnBhcmVudE5vZGUpIHx8IGNvbnRleHQpKSB7XG4gICAgICAgICAgICAgICAgLy8gSWYgc2VlZCBpcyBlbXB0eSBvciBubyB0b2tlbnMgcmVtYWluLCB3ZSBjYW4gcmV0dXJuIGVhcmx5XG4gICAgICAgICAgICAgICAgdG9rZW5zLnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgICAgICBzZWxlY3RvciA9IHNlZWQubGVuZ3RoICYmIHRvU2VsZWN0b3IodG9rZW5zKTtcblxuICAgICAgICAgICAgICAgIGlmICghc2VsZWN0b3IpIHtcbiAgICAgICAgICAgICAgICAgIHB1c2guYXBwbHkocmVzdWx0cywgc2VlZCk7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSAvLyBDb21waWxlIGFuZCBleGVjdXRlIGEgZmlsdGVyaW5nIGZ1bmN0aW9uIGlmIG9uZSBpcyBub3QgcHJvdmlkZWRcbiAgICAgICAgLy8gUHJvdmlkZSBgbWF0Y2hgIHRvIGF2b2lkIHJldG9rZW5pemF0aW9uIGlmIHdlIG1vZGlmaWVkIHRoZSBzZWxlY3RvciBhYm92ZVxuXG5cbiAgICAgICAgKGNvbXBpbGVkIHx8IGNvbXBpbGUoc2VsZWN0b3IsIG1hdGNoKSkoc2VlZCwgY29udGV4dCwgIWRvY3VtZW50SXNIVE1MLCByZXN1bHRzLCAhY29udGV4dCB8fCByc2libGluZy50ZXN0KHNlbGVjdG9yKSAmJiB0ZXN0Q29udGV4dChjb250ZXh0LnBhcmVudE5vZGUpIHx8IGNvbnRleHQpO1xuICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICAgIH07IC8vIE9uZS10aW1lIGFzc2lnbm1lbnRzXG4gICAgICAvLyBTb3J0IHN0YWJpbGl0eVxuXG5cbiAgICAgIHN1cHBvcnQuc29ydFN0YWJsZSA9IGV4cGFuZG8uc3BsaXQoXCJcIikuc29ydChzb3J0T3JkZXIpLmpvaW4oXCJcIikgPT09IGV4cGFuZG87IC8vIFN1cHBvcnQ6IENocm9tZSAxNC0zNStcbiAgICAgIC8vIEFsd2F5cyBhc3N1bWUgZHVwbGljYXRlcyBpZiB0aGV5IGFyZW4ndCBwYXNzZWQgdG8gdGhlIGNvbXBhcmlzb24gZnVuY3Rpb25cblxuICAgICAgc3VwcG9ydC5kZXRlY3REdXBsaWNhdGVzID0gISFoYXNEdXBsaWNhdGU7IC8vIEluaXRpYWxpemUgYWdhaW5zdCB0aGUgZGVmYXVsdCBkb2N1bWVudFxuXG4gICAgICBzZXREb2N1bWVudCgpOyAvLyBTdXBwb3J0OiBXZWJraXQ8NTM3LjMyIC0gU2FmYXJpIDYuMC4zL0Nocm9tZSAyNSAoZml4ZWQgaW4gQ2hyb21lIDI3KVxuICAgICAgLy8gRGV0YWNoZWQgbm9kZXMgY29uZm91bmRpbmdseSBmb2xsb3cgKmVhY2ggb3RoZXIqXG5cbiAgICAgIHN1cHBvcnQuc29ydERldGFjaGVkID0gYXNzZXJ0KGZ1bmN0aW9uIChlbCkge1xuICAgICAgICAvLyBTaG91bGQgcmV0dXJuIDEsIGJ1dCByZXR1cm5zIDQgKGZvbGxvd2luZylcbiAgICAgICAgcmV0dXJuIGVsLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJmaWVsZHNldFwiKSkgJiAxO1xuICAgICAgfSk7IC8vIFN1cHBvcnQ6IElFPDhcbiAgICAgIC8vIFByZXZlbnQgYXR0cmlidXRlL3Byb3BlcnR5IFwiaW50ZXJwb2xhdGlvblwiXG4gICAgICAvLyBodHRwczovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L21zNTM2NDI5JTI4VlMuODUlMjkuYXNweFxuXG4gICAgICBpZiAoIWFzc2VydChmdW5jdGlvbiAoZWwpIHtcbiAgICAgICAgZWwuaW5uZXJIVE1MID0gQUdQb2xpY3kuY3JlYXRlSFRNTChcIjxhIGhyZWY9JyMnPjwvYT5cIik7XG4gICAgICAgIHJldHVybiBlbC5maXJzdENoaWxkLmdldEF0dHJpYnV0ZShcImhyZWZcIikgPT09IFwiI1wiO1xuICAgICAgfSkpIHtcbiAgICAgICAgYWRkSGFuZGxlKFwidHlwZXxocmVmfGhlaWdodHx3aWR0aFwiLCBmdW5jdGlvbiAoZWxlbSwgbmFtZSwgaXNYTUwpIHtcbiAgICAgICAgICBpZiAoIWlzWE1MKSB7XG4gICAgICAgICAgICByZXR1cm4gZWxlbS5nZXRBdHRyaWJ1dGUobmFtZSwgbmFtZS50b0xvd2VyQ2FzZSgpID09PSBcInR5cGVcIiA/IDEgOiAyKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSAvLyBTdXBwb3J0OiBJRTw5XG4gICAgICAvLyBVc2UgZGVmYXVsdFZhbHVlIGluIHBsYWNlIG9mIGdldEF0dHJpYnV0ZShcInZhbHVlXCIpXG5cblxuICAgICAgaWYgKCFzdXBwb3J0LmF0dHJpYnV0ZXMgfHwgIWFzc2VydChmdW5jdGlvbiAoZWwpIHtcbiAgICAgICAgZWwuaW5uZXJIVE1MID0gQUdQb2xpY3kuY3JlYXRlSFRNTChcIjxpbnB1dC8+XCIpO1xuICAgICAgICBlbC5maXJzdENoaWxkLnNldEF0dHJpYnV0ZShcInZhbHVlXCIsIFwiXCIpO1xuICAgICAgICByZXR1cm4gZWwuZmlyc3RDaGlsZC5nZXRBdHRyaWJ1dGUoXCJ2YWx1ZVwiKSA9PT0gXCJcIjtcbiAgICAgIH0pKSB7XG4gICAgICAgIGFkZEhhbmRsZShcInZhbHVlXCIsIGZ1bmN0aW9uIChlbGVtLCBuYW1lLCBpc1hNTCkge1xuICAgICAgICAgIGlmICghaXNYTUwgJiYgZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSBcImlucHV0XCIpIHtcbiAgICAgICAgICAgIHJldHVybiBlbGVtLmRlZmF1bHRWYWx1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSAvLyBTdXBwb3J0OiBJRTw5XG4gICAgICAvLyBVc2UgZ2V0QXR0cmlidXRlTm9kZSB0byBmZXRjaCBib29sZWFucyB3aGVuIGdldEF0dHJpYnV0ZSBsaWVzXG5cblxuICAgICAgaWYgKCFhc3NlcnQoZnVuY3Rpb24gKGVsKSB7XG4gICAgICAgIHJldHVybiBlbC5nZXRBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiKSA9PSBudWxsO1xuICAgICAgfSkpIHtcbiAgICAgICAgYWRkSGFuZGxlKGJvb2xlYW5zLCBmdW5jdGlvbiAoZWxlbSwgbmFtZSwgaXNYTUwpIHtcbiAgICAgICAgICB2YXIgdmFsO1xuXG4gICAgICAgICAgaWYgKCFpc1hNTCkge1xuICAgICAgICAgICAgcmV0dXJuIGVsZW1bbmFtZV0gPT09IHRydWUgPyBuYW1lLnRvTG93ZXJDYXNlKCkgOiAodmFsID0gZWxlbS5nZXRBdHRyaWJ1dGVOb2RlKG5hbWUpKSAmJiB2YWwuc3BlY2lmaWVkID8gdmFsLnZhbHVlIDogbnVsbDtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSAvLyBFWFBPU0VcbiAgICAgIC8vIERvIG5vdCBleHBvc2UgU2l6emxlIHRvIHRoZSBnbG9iYWwgc2NvcGUgaW4gdGhlIGNhc2Ugb2YgQWRHdWFyZCBFeHRlbmRlZENzcyBidWlsZFxuXG5cbiAgICAgIHJldHVybiBTaXp6bGU7IC8vIEVYUE9TRVxuICAgIH0od2luZG93KTsgLy8+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj5cblxuICB9XG5cbiAgcmV0dXJuIFNpenpsZTtcbn07XG5cbi8qIGpzaGludCBpZ25vcmU6ZW5kICovXG5cbi8qKlxuICogQ29weXJpZ2h0IDIwMTYgQWRndWFyZCBTb2Z0d2FyZSBMdGRcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBDbGFzcyB0aGF0IGV4dGVuZHMgU2l6emxlIGFuZCBhZGRzIHN1cHBvcnQgZm9yIFwibWF0Y2hlcy1jc3NcIiBwc2V1ZG8gZWxlbWVudC5cbiAqL1xuXG52YXIgU3R5bGVQcm9wZXJ0eU1hdGNoZXIgPSBmdW5jdGlvbiAod2luZG93KSB7XG4gIHZhciBpc1BoYW50b20gPSAhIXdpbmRvdy5fcGhhbnRvbTtcbiAgdmFyIHVzZUZhbGxiYWNrID0gaXNQaGFudG9tICYmICEhd2luZG93LmdldE1hdGNoZWRDU1NSdWxlcztcbiAgLyoqXG4gICAqIFVucXVvdGVzIHNwZWNpZmllZCB2YWx1ZVxuICAgKiBXZWJraXQtYmFzZWQgYnJvd3NlcnMgc2luZ2xlcXVvdGVzIDxzdHJpbmc+IGNvbnRlbnQgcHJvcGVydHkgdmFsdWVzXG4gICAqIE90aGVyIGJyb3dzZXJzIGRvdWJsZXF1b3RlcyBjb250ZW50IHByb3BlcnR5IHZhbHVlcy5cbiAgICovXG5cbiAgdmFyIHJlbW92ZUNvbnRlbnRRdW90ZXMgPSBmdW5jdGlvbiByZW1vdmVDb250ZW50UXVvdGVzKHZhbHVlKSB7XG4gICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgIHJldHVybiB2YWx1ZS5yZXBsYWNlKC9eKFtcIiddKShbXFxzXFxTXSopXFwxJC8sICckMicpO1xuICAgIH1cblxuICAgIHJldHVybiB2YWx1ZTtcbiAgfTtcblxuICB2YXIgZ2V0Q29tcHV0ZWRTdHlsZSA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlLmJpbmQod2luZG93KTtcbiAgdmFyIGdldE1hdGNoZWRDU1NSdWxlcyA9IHVzZUZhbGxiYWNrID8gd2luZG93LmdldE1hdGNoZWRDU1NSdWxlcy5iaW5kKHdpbmRvdykgOiBudWxsO1xuICAvKipcbiAgICogVGhlcmUgaXMgYW4gaXNzdWUgaW4gYnJvd3NlcnMgYmFzZWQgb24gb2xkIHdlYmtpdDpcbiAgICogZ2V0Q29tcHV0ZWRTdHlsZShlbCwgXCI6YmVmb3JlXCIpIGlzIGVtcHR5IGlmIGVsZW1lbnQgaXMgbm90IHZpc2libGUuXG4gICAqXG4gICAqIFRvIGNpcmN1bXZlbnQgdGhpcyBpc3N1ZSB3ZSB1c2UgZ2V0TWF0Y2hlZENTU1J1bGVzIGluc3RlYWQuXG4gICAqXG4gICAqIEl0IGFwcGVhcnMgdGhhdCBnZXRNYXRjaGVkQ1NTUnVsZXMgc29ydHMgdGhlIENTUyBydWxlc1xuICAgKiBpbiBpbmNyZWFzaW5nIG9yZGVyIG9mIHNwZWNpZml0aWVzIG9mIGNvcnJlc3BvbmRpbmcgc2VsZWN0b3JzLlxuICAgKiBXZSBwaWNrIHRoZSBjc3MgcnVsZSB0aGF0IGlzIGJlaW5nIGFwcGxpZWQgdG8gYW4gZWxlbWVudCBiYXNlZCBvbiB0aGlzIGFzc3VtcHRpb24uXG4gICAqXG4gICAqIEBwYXJhbSBlbGVtZW50ICAgICAgIERPTSBub2RlXG4gICAqIEBwYXJhbSBwc2V1ZG9FbGVtZW50IE9wdGlvbmFsIHBzZXVkb0VsZW1lbnQgbmFtZVxuICAgKiBAcGFyYW0gcHJvcGVydHlOYW1lICBDU1MgcHJvcGVydHkgbmFtZVxuICAgKi9cblxuICB2YXIgZ2V0Q29tcHV0ZWRTdHlsZVByb3BlcnR5VmFsdWUgPSBmdW5jdGlvbiBnZXRDb21wdXRlZFN0eWxlUHJvcGVydHlWYWx1ZShlbGVtZW50LCBwc2V1ZG9FbGVtZW50LCBwcm9wZXJ0eU5hbWUpIHtcbiAgICB2YXIgdmFsdWUgPSAnJztcblxuICAgIGlmICh1c2VGYWxsYmFjayAmJiBwc2V1ZG9FbGVtZW50KSB7XG4gICAgICB2YXIgY3NzUnVsZXMgPSBnZXRNYXRjaGVkQ1NTUnVsZXMoZWxlbWVudCwgcHNldWRvRWxlbWVudCkgfHwgW107XG4gICAgICB2YXIgaSA9IGNzc1J1bGVzLmxlbmd0aDtcblxuICAgICAgd2hpbGUgKGktLSA+IDAgJiYgIXZhbHVlKSB7XG4gICAgICAgIHZhbHVlID0gY3NzUnVsZXNbaV0uc3R5bGUuZ2V0UHJvcGVydHlWYWx1ZShwcm9wZXJ0eU5hbWUpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgc3R5bGUgPSBnZXRDb21wdXRlZFN0eWxlKGVsZW1lbnQsIHBzZXVkb0VsZW1lbnQpO1xuXG4gICAgICBpZiAoc3R5bGUpIHtcbiAgICAgICAgdmFsdWUgPSBzdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKHByb3BlcnR5TmFtZSk7IC8vIGh0dHBzOi8vYnVncy53ZWJraXQub3JnL3Nob3dfYnVnLmNnaT9pZD05MzQ0NVxuXG4gICAgICAgIGlmIChwcm9wZXJ0eU5hbWUgPT09ICdvcGFjaXR5JyAmJiB1dGlscy5pc1NhZmFyaUJyb3dzZXIpIHtcbiAgICAgICAgICB2YWx1ZSA9IChNYXRoLnJvdW5kKHBhcnNlRmxvYXQodmFsdWUpICogMTAwKSAvIDEwMCkudG9TdHJpbmcoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChwcm9wZXJ0eU5hbWUgPT09ICdjb250ZW50Jykge1xuICAgICAgdmFsdWUgPSByZW1vdmVDb250ZW50UXVvdGVzKHZhbHVlKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdmFsdWU7XG4gIH07XG4gIC8qKlxuICAgKiBBZGRzIHVybCBwYXJhbWV0ZXIgcXVvdGVzIGZvciBub24tcmVnZXggcGF0dGVyblxuICAgKiBAcGFyYW0ge3N0cmluZ30gcGF0dGVyblxuICAgKi9cblxuXG4gIHZhciBhZGRVcmxRdW90ZXMgPSBmdW5jdGlvbiBhZGRVcmxRdW90ZXMocGF0dGVybikge1xuICAgIC8vIGZvciByZWdleCBwYXR0ZXJuc1xuICAgIGlmIChwYXR0ZXJuWzBdID09PSAnLycgJiYgcGF0dGVybltwYXR0ZXJuLmxlbmd0aCAtIDFdID09PSAnLycgJiYgcGF0dGVybi5pbmRleE9mKCdcXFxcXCInKSA8IDEwKSB7XG4gICAgICAvLyBlLmcuIC9edXJsXFxcXChbYS16XXs0fTpbYS16XXs1fS9cbiAgICAgIC8vIG9yIC9edXJsXFxcXChkYXRhXFxcXDpcXFxcaW1hZ2VcXFxcL2dpZjtiYXNlNjQuKy9cbiAgICAgIHZhciByZSA9IC8oXFxeKT91cmwoXFxcXCk/XFxcXFxcKChcXHd8XFxbXFx3KS9nO1xuICAgICAgcmV0dXJuIHBhdHRlcm4ucmVwbGFjZShyZSwgJyQxdXJsJDJcXFxcXFwoXFxcXFwiPyQzJyk7XG4gICAgfSAvLyBmb3Igbm9uLXJlZ2V4IHBhdHRlcm5zXG5cblxuICAgIGlmIChwYXR0ZXJuLmluZGV4T2YoJ3VybChcIicpID09PSAtMSkge1xuICAgICAgdmFyIF9yZSA9IC91cmxcXCgoLio/KVxcKS9nO1xuICAgICAgcmV0dXJuIHBhdHRlcm4ucmVwbGFjZShfcmUsICd1cmwoXCIkMVwiKScpO1xuICAgIH1cblxuICAgIHJldHVybiBwYXR0ZXJuO1xuICB9O1xuICAvKipcbiAgICogQ2xhc3MgdGhhdCBtYXRjaGVzIGVsZW1lbnQgc3R5bGUgYWdhaW5zdCB0aGUgc3BlY2lmaWVkIGV4cHJlc3Npb25cbiAgICogQG1lbWJlciB7c3RyaW5nfSBwcm9wZXJ0eU5hbWVcbiAgICogQG1lbWJlciB7c3RyaW5nfSBwc2V1ZG9FbGVtZW50XG4gICAqIEBtZW1iZXIge1JlZ0V4cH0gcmVnZXhcbiAgICovXG5cblxuICB2YXIgTWF0Y2hlciA9IGZ1bmN0aW9uIE1hdGNoZXIocHJvcGVydHlGaWx0ZXIsIHBzZXVkb0VsZW1lbnQpIHtcbiAgICB0aGlzLnBzZXVkb0VsZW1lbnQgPSBwc2V1ZG9FbGVtZW50O1xuXG4gICAgdHJ5IHtcbiAgICAgIHZhciBpbmRleCA9IHByb3BlcnR5RmlsdGVyLmluZGV4T2YoJzonKTtcbiAgICAgIHRoaXMucHJvcGVydHlOYW1lID0gcHJvcGVydHlGaWx0ZXIuc3Vic3RyaW5nKDAsIGluZGV4KS50cmltKCk7XG4gICAgICB2YXIgcGF0dGVybiA9IHByb3BlcnR5RmlsdGVyLnN1YnN0cmluZyhpbmRleCArIDEpLnRyaW0oKTtcbiAgICAgIHBhdHRlcm4gPSBhZGRVcmxRdW90ZXMocGF0dGVybik7IC8vIFVuZXNjYXBpbmcgcGF0dGVyblxuICAgICAgLy8gRm9yIG5vbi1yZWdleCBwYXR0ZXJucywgKCwpLFssXSBzaG91bGQgYmUgdW5lc2NhcGVkLCBiZWNhdXNlIHdlIHJlcXVpcmUgZXNjYXBpbmcgdGhlbSBpbiBmaWx0ZXIgcnVsZXMuXG4gICAgICAvLyBGb3IgcmVnZXggcGF0dGVybnMsIFwiLFxcIHNob3VsZCBiZSBlc2NhcGVkLCBiZWNhdXNlIHdlIG1hbnVhbGx5IGVzY2FwZSB0aG9zZSBpbiBleHRlbmRlZC1jc3Mtc2VsZWN0b3IuanMuXG5cbiAgICAgIGlmICgvXlxcLy4qXFwvJC8udGVzdChwYXR0ZXJuKSkge1xuICAgICAgICBwYXR0ZXJuID0gcGF0dGVybi5zbGljZSgxLCAtMSk7XG4gICAgICAgIHRoaXMucmVnZXggPSB1dGlscy5wc2V1ZG9BcmdUb1JlZ2V4KHBhdHRlcm4pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcGF0dGVybiA9IHBhdHRlcm4ucmVwbGFjZSgvXFxcXChbXFxcXCgpW1xcXVwiXSkvZywgJyQxJyk7XG4gICAgICAgIHRoaXMucmVnZXggPSB1dGlscy5jcmVhdGVVUkxSZWdleChwYXR0ZXJuKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChleCkge1xuICAgICAgdXRpbHMubG9nRXJyb3IoXCJTdHlsZVByb3BlcnR5TWF0Y2hlcjogaW52YWxpZCBtYXRjaCBzdHJpbmcgXCIuY29uY2F0KHByb3BlcnR5RmlsdGVyKSk7XG4gICAgfVxuICB9O1xuICAvKipcbiAgICogRnVuY3Rpb24gdG8gY2hlY2sgaWYgZWxlbWVudCBDU1MgcHJvcGVydHkgbWF0Y2hlcyBmaWx0ZXIgcGF0dGVyblxuICAgKiBAcGFyYW0ge0VsZW1lbnR9IGVsZW1lbnQgdG8gY2hlY2tcbiAgICovXG5cblxuICBNYXRjaGVyLnByb3RvdHlwZS5tYXRjaGVzID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICBpZiAoIXRoaXMucmVnZXggfHwgIXRoaXMucHJvcGVydHlOYW1lKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgdmFyIHZhbHVlID0gZ2V0Q29tcHV0ZWRTdHlsZVByb3BlcnR5VmFsdWUoZWxlbWVudCwgdGhpcy5wc2V1ZG9FbGVtZW50LCB0aGlzLnByb3BlcnR5TmFtZSk7XG4gICAgcmV0dXJuIHZhbHVlICYmIHRoaXMucmVnZXgudGVzdCh2YWx1ZSk7XG4gIH07XG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgbmV3IHBzZXVkby1jbGFzcyBhbmQgcmVnaXN0ZXJzIGl0IGluIFNpenpsZVxuICAgKi9cblxuXG4gIHZhciBleHRlbmRTaXp6bGUgPSBmdW5jdGlvbiBleHRlbmRTaXp6bGUoc2l6emxlKSB7XG4gICAgLy8gRmlyc3Qgb2YgYWxsIHdlIHNob3VsZCBwcmVwYXJlIFNpenpsZSBlbmdpbmVcbiAgICBzaXp6bGUuc2VsZWN0b3JzLnBzZXVkb3NbJ21hdGNoZXMtY3NzJ10gPSBzaXp6bGUuc2VsZWN0b3JzLmNyZWF0ZVBzZXVkbyhmdW5jdGlvbiAocHJvcGVydHlGaWx0ZXIpIHtcbiAgICAgIHZhciBtYXRjaGVyID0gbmV3IE1hdGNoZXIocHJvcGVydHlGaWx0ZXIpO1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgIHJldHVybiBtYXRjaGVyLm1hdGNoZXMoZWxlbWVudCk7XG4gICAgICB9O1xuICAgIH0pO1xuICAgIHNpenpsZS5zZWxlY3RvcnMucHNldWRvc1snbWF0Y2hlcy1jc3MtYmVmb3JlJ10gPSBzaXp6bGUuc2VsZWN0b3JzLmNyZWF0ZVBzZXVkbyhmdW5jdGlvbiAocHJvcGVydHlGaWx0ZXIpIHtcbiAgICAgIHZhciBtYXRjaGVyID0gbmV3IE1hdGNoZXIocHJvcGVydHlGaWx0ZXIsICc6YmVmb3JlJyk7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIG1hdGNoZXIubWF0Y2hlcyhlbGVtZW50KTtcbiAgICAgIH07XG4gICAgfSk7XG4gICAgc2l6emxlLnNlbGVjdG9ycy5wc2V1ZG9zWydtYXRjaGVzLWNzcy1hZnRlciddID0gc2l6emxlLnNlbGVjdG9ycy5jcmVhdGVQc2V1ZG8oZnVuY3Rpb24gKHByb3BlcnR5RmlsdGVyKSB7XG4gICAgICB2YXIgbWF0Y2hlciA9IG5ldyBNYXRjaGVyKHByb3BlcnR5RmlsdGVyLCAnOmFmdGVyJyk7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIG1hdGNoZXIubWF0Y2hlcyhlbGVtZW50KTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH07IC8vIEVYUE9TRVxuXG5cbiAgcmV0dXJuIHtcbiAgICBleHRlbmRTaXp6bGU6IGV4dGVuZFNpenpsZVxuICB9O1xufSh3aW5kb3cpO1xuXG4vKipcbiAqIENvcHlyaWdodCAyMDE2IEFkZ3VhcmQgU29mdHdhcmUgTHRkXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbnZhciBtYXRjaGVyVXRpbHMgPSB7fTtcbm1hdGNoZXJVdGlscy5NdXRhdGlvbk9ic2VydmVyID0gd2luZG93Lk11dGF0aW9uT2JzZXJ2ZXIgfHwgd2luZG93LldlYktpdE11dGF0aW9uT2JzZXJ2ZXI7XG4vKipcbiAqIFBhcnNlcyBhcmd1bWVudCBvZiBtYXRjaGVyIHBzZXVkbyAoZm9yIG1hdGNoZXMtYXR0ciBhbmQgbWF0Y2hlcy1wcm9wZXJ0eSlcbiAqIEBwYXJhbSB7c3RyaW5nfSBtYXRjaGVyRmlsdGVyIGFyZ3VtZW50IG9mIHBzZXVkbyBjbGFzc1xuICogQHJldHVybnMge0FycmF5fVxuICovXG5cbm1hdGNoZXJVdGlscy5wYXJzZU1hdGNoZXJGaWx0ZXIgPSBmdW5jdGlvbiAobWF0Y2hlckZpbHRlcikge1xuICB2YXIgRlVMTF9NQVRDSF9NQVJLRVIgPSAnXCI9XCInO1xuICB2YXIgcmF3QXJncyA9IFtdO1xuXG4gIGlmIChtYXRjaGVyRmlsdGVyLmluZGV4T2YoRlVMTF9NQVRDSF9NQVJLRVIpID09PSAtMSkge1xuICAgIC8vIGlmIHRoZXJlIGlzIG9ubHkgb25lIHBzZXVkbyBhcmdcbiAgICAvLyBlLmcuIDptYXRjaGVzLWF0dHIoXCJkYXRhLW5hbWVcIikgb3IgOm1hdGNoZXMtcHJvcGVydHkoXCJpbm5lci5wcm9wXCIpXG4gICAgLy8gU2l6emxlIHdpbGwgcGFyc2UgaXQgYW5kIGdldCByaWQgb2YgcXVvdGVzXG4gICAgLy8gc28gaXQgbWlnaHQgYmUgdmFsaWQgYXJnIGFscmVhZHkgd2l0aG91dCB0aGVtXG4gICAgcmF3QXJncy5wdXNoKG1hdGNoZXJGaWx0ZXIpO1xuICB9IGVsc2Uge1xuICAgIG1hdGNoZXJGaWx0ZXIuc3BsaXQoJz0nKS5mb3JFYWNoKGZ1bmN0aW9uIChhcmcpIHtcbiAgICAgIGlmIChhcmdbMF0gPT09ICdcIicgJiYgYXJnW2FyZy5sZW5ndGggLSAxXSA9PT0gJ1wiJykge1xuICAgICAgICByYXdBcmdzLnB1c2goYXJnLnNsaWNlKDEsIC0xKSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4gcmF3QXJncztcbn07XG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IEFyZ0RhdGFcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBhcmdcbiAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gaXNSZWdleHBcbiAqL1xuXG4vKipcbiAqIFBhcnNlcyByYXcgbWF0Y2hlciBhcmdcbiAqIEBwYXJhbSB7c3RyaW5nfSByYXdBcmdcbiAqIEByZXR1cm5zIHtBcmdEYXRhfVxuICovXG5cblxubWF0Y2hlclV0aWxzLnBhcnNlUmF3TWF0Y2hlckFyZyA9IGZ1bmN0aW9uIChyYXdBcmcpIHtcbiAgdmFyIGFyZyA9IHJhd0FyZztcbiAgdmFyIGlzUmVnZXhwID0gISFyYXdBcmcgJiYgcmF3QXJnWzBdID09PSAnLycgJiYgcmF3QXJnW3Jhd0FyZy5sZW5ndGggLSAxXSA9PT0gJy8nO1xuXG4gIGlmIChpc1JlZ2V4cCkge1xuICAgIC8vIHRvIGF2b2lkIGF0IGxlYXN0IHN1Y2ggY2FzZSDigJQgOm1hdGNoZXMtcHJvcGVydHkoXCIvL1wiKVxuICAgIGlmIChyYXdBcmcubGVuZ3RoID4gMikge1xuICAgICAgYXJnID0gdXRpbHMudG9SZWdFeHAocmF3QXJnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCByZWdleHA6IFwiLmNvbmNhdChyYXdBcmcpKTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4ge1xuICAgIGFyZzogYXJnLFxuICAgIGlzUmVnZXhwOiBpc1JlZ2V4cFxuICB9O1xufTtcbi8qKlxuICogQHR5cGVkZWYgQ2hhaW5cbiAqIEBwcm9wZXJ0eSB7T2JqZWN0fSBiYXNlXG4gKiBAcHJvcGVydHkge3N0cmluZ30gcHJvcFxuICogQHByb3BlcnR5IHtzdHJpbmd9IHZhbHVlXG4gKi9cblxuLyoqXG4gKiBDaGVja3MgaWYgdGhlIHByb3BlcnR5IGV4aXN0cyBpbiB0aGUgYmFzZSBvYmplY3QgKHJlY3Vyc2l2ZWx5KS5cbiAqIEBwYXJhbSB7T2JqZWN0fSBiYXNlXG4gKiBAcGFyYW0ge0FyZ0RhdGFbXX0gY2hhaW4gYXJyYXkgb2Ygb2JqZWN0cyAtIHBhcnNlZCBzdHJpbmcgcHJvcGVydHkgY2hhaW5cbiAqIEBwYXJhbSB7QXJyYXl9IFtvdXRwdXQ9W11dIHJlc3VsdCBhY2NcbiAqIEByZXR1cm5zIHtDaGFpbltdfSBhcnJheSBvZiBvYmplY3RzXG4gKi9cblxuXG5tYXRjaGVyVXRpbHMuZmlsdGVyUm9vdHNCeVJlZ2V4cENoYWluID0gZnVuY3Rpb24gKGJhc2UsIGNoYWluKSB7XG4gIHZhciBvdXRwdXQgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IFtdO1xuICB2YXIgdGVtcFByb3AgPSBjaGFpblswXTtcblxuICBpZiAoY2hhaW4ubGVuZ3RoID09PSAxKSB7XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXJlc3RyaWN0ZWQtc3ludGF4XG4gICAgZm9yICh2YXIga2V5IGluIGJhc2UpIHtcbiAgICAgIGlmICh0ZW1wUHJvcC5pc1JlZ2V4cCkge1xuICAgICAgICBpZiAodGVtcFByb3AuYXJnLnRlc3Qoa2V5KSkge1xuICAgICAgICAgIG91dHB1dC5wdXNoKHtcbiAgICAgICAgICAgIGJhc2U6IGJhc2UsXG4gICAgICAgICAgICBwcm9wOiBrZXksXG4gICAgICAgICAgICB2YWx1ZTogYmFzZVtrZXldXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAodGVtcFByb3AuYXJnID09PSBrZXkpIHtcbiAgICAgICAgb3V0cHV0LnB1c2goe1xuICAgICAgICAgIGJhc2U6IGJhc2UsXG4gICAgICAgICAgcHJvcDogdGVtcFByb3AuYXJnLFxuICAgICAgICAgIHZhbHVlOiBiYXNlW2tleV1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIG91dHB1dDtcbiAgfSAvLyBpZiB0aGVyZSBpcyBhIHJlZ2V4cCBwcm9wIGluIGlucHV0IGNoYWluXG4gIC8vIGUuZy4gJ3VuaXQuL15hZC4rLy5zcmMnIGZvciAndW5pdC5hZC0xZ2YyLnNyYyB1bml0LmFkLWZnZDM0LnNyYycpLFxuICAvLyBldmVyeSBiYXNlIGtleXMgc2hvdWxkIGJlIHRlc3RlZCBieSByZWdleHAgYW5kIGl0IGNhbiBiZSBtb3JlIHRoYXQgb25lIHJlc3VsdHNcblxuXG4gIGlmICh0ZW1wUHJvcC5pc1JlZ2V4cCkge1xuICAgIHZhciBuZXh0UHJvcCA9IGNoYWluLnNsaWNlKDEpO1xuICAgIHZhciBiYXNlS2V5cyA9IFtdOyAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcmVzdHJpY3RlZC1zeW50YXhcblxuICAgIGZvciAodmFyIF9rZXkgaW4gYmFzZSkge1xuICAgICAgaWYgKHRlbXBQcm9wLmFyZy50ZXN0KF9rZXkpKSB7XG4gICAgICAgIGJhc2VLZXlzLnB1c2goX2tleSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgYmFzZUtleXMuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICB2YXIgaXRlbSA9IGJhc2Vba2V5XTtcbiAgICAgIG1hdGNoZXJVdGlscy5maWx0ZXJSb290c0J5UmVnZXhwQ2hhaW4oaXRlbSwgbmV4dFByb3AsIG91dHB1dCk7XG4gICAgfSk7XG4gIH0gLy8gYXZvaWQgVHlwZUVycm9yIHdoaWxlIGFjY2Vzc2luZyB0byBudWxsLXByb3AncyBjaGlsZFxuXG5cbiAgaWYgKGJhc2UgPT09IG51bGwpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgbmV4dEJhc2UgPSBiYXNlW3RlbXBQcm9wLmFyZ107XG4gIGNoYWluID0gY2hhaW4uc2xpY2UoMSk7XG5cbiAgaWYgKG5leHRCYXNlICE9PSB1bmRlZmluZWQpIHtcbiAgICBtYXRjaGVyVXRpbHMuZmlsdGVyUm9vdHNCeVJlZ2V4cENoYWluKG5leHRCYXNlLCBjaGFpbiwgb3V0cHV0KTtcbiAgfVxuXG4gIHJldHVybiBvdXRwdXQ7XG59O1xuLyoqXG4gKiBWYWxpZGF0ZXMgcGFyc2VkIGFyZ3Mgb2YgbWF0Y2hlcy1wcm9wZXJ0eSBwc2V1ZG9cbiAqIEBwYXJhbSB7Li4uQXJnRGF0YX0gYXJnc1xuICovXG5cblxubWF0Y2hlclV0aWxzLnZhbGlkYXRlUHJvcE1hdGNoZXJBcmdzID0gZnVuY3Rpb24gKCkge1xuICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShfbGVuKSwgX2tleTIgPSAwOyBfa2V5MiA8IF9sZW47IF9rZXkyKyspIHtcbiAgICBhcmdzW19rZXkyXSA9IGFyZ3VtZW50c1tfa2V5Ml07XG4gIH1cblxuICBmb3IgKHZhciBpID0gMDsgaSA8IGFyZ3MubGVuZ3RoOyBpICs9IDEpIHtcbiAgICBpZiAoYXJnc1tpXS5pc1JlZ2V4cCkge1xuICAgICAgaWYgKCF1dGlscy5zdGFydHNXaXRoKGFyZ3NbaV0uYXJnLnRvU3RyaW5nKCksICcvJykgfHwgIXV0aWxzLmVuZHNXaXRoKGFyZ3NbaV0uYXJnLnRvU3RyaW5nKCksICcvJykpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfSAvLyBzaW1wbGUgYXJnIGNoZWNrIGlmIGl0IGlzIG5vdCBhIHJlZ2V4cFxuXG4gICAgfSBlbHNlIGlmICghL15bXFx3LV0rJC8udGVzdChhcmdzW2ldLmFyZykpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gdHJ1ZTtcbn07XG5cbi8qKlxuICogQ2xhc3MgdGhhdCBleHRlbmRzIFNpenpsZSBhbmQgYWRkcyBzdXBwb3J0IGZvciBcIm1hdGNoZXMtYXR0clwiIHBzZXVkbyBlbGVtZW50LlxuICovXG5cbnZhciBBdHRyaWJ1dGVzTWF0Y2hlciA9IGZ1bmN0aW9uICgpIHtcbiAgLyoqXG4gICAqIENsYXNzIHRoYXQgbWF0Y2hlcyBlbGVtZW50IGF0dHJpYnV0ZXMgYWdhaW5zdCB0aGUgc3BlY2lmaWVkIGV4cHJlc3Npb25zXG4gICAqIEBwYXJhbSB7QXJnRGF0YX0gbmFtZUFyZyAtIHBhcnNlZCBuYW1lIGFyZ3VtZW50XG4gICAqIEBwYXJhbSB7QXJnRGF0YX0gdmFsdWVBcmcgLSBwYXJzZWQgdmFsdWUgYXJndW1lbnRcbiAgICogQHBhcmFtIHtzdHJpbmd9IHBzZXVkb0VsZW1lbnRcbiAgICogQGNvbnN0cnVjdG9yXG4gICAqXG4gICAqIEBtZW1iZXIge3N0cmluZ3xSZWdFeHB9IGF0dHJOYW1lXG4gICAqIEBtZW1iZXIge2Jvb2xlYW59IGlzUmVnZXhwTmFtZVxuICAgKiBAbWVtYmVyIHtzdHJpbmd8UmVnRXhwfSBhdHRyVmFsdWVcbiAgICogQG1lbWJlciB7Ym9vbGVhbn0gaXNSZWdleHBWYWx1ZVxuICAgKi9cbiAgdmFyIEF0dHJNYXRjaGVyID0gZnVuY3Rpb24gQXR0ck1hdGNoZXIobmFtZUFyZywgdmFsdWVBcmcsIHBzZXVkb0VsZW1lbnQpIHtcbiAgICB0aGlzLnBzZXVkb0VsZW1lbnQgPSBwc2V1ZG9FbGVtZW50O1xuICAgIHRoaXMuYXR0ck5hbWUgPSBuYW1lQXJnLmFyZztcbiAgICB0aGlzLmlzUmVnZXhwTmFtZSA9IG5hbWVBcmcuaXNSZWdleHA7XG4gICAgdGhpcy5hdHRyVmFsdWUgPSB2YWx1ZUFyZy5hcmc7XG4gICAgdGhpcy5pc1JlZ2V4cFZhbHVlID0gdmFsdWVBcmcuaXNSZWdleHA7XG4gIH07XG4gIC8qKlxuICAgKiBGdW5jdGlvbiB0byBjaGVjayBpZiBlbGVtZW50IGF0dHJpYnV0ZXMgbWF0Y2hlcyBmaWx0ZXIgcGF0dGVyblxuICAgKiBAcGFyYW0ge0VsZW1lbnR9IGVsZW1lbnQgdG8gY2hlY2tcbiAgICovXG5cblxuICBBdHRyTWF0Y2hlci5wcm90b3R5cGUubWF0Y2hlcyA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgdmFyIGVsQXR0cnMgPSBlbGVtZW50LmF0dHJpYnV0ZXM7XG5cbiAgICBpZiAoZWxBdHRycy5sZW5ndGggPT09IDAgfHwgIXRoaXMuYXR0ck5hbWUpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICB2YXIgaSA9IDA7XG5cbiAgICB3aGlsZSAoaSA8IGVsQXR0cnMubGVuZ3RoKSB7XG4gICAgICB2YXIgYXR0ciA9IGVsQXR0cnNbaV07XG4gICAgICB2YXIgbWF0Y2hlZCA9IGZhbHNlO1xuICAgICAgdmFyIGF0dHJOYW1lTWF0Y2hlZCA9IHRoaXMuaXNSZWdleHBOYW1lID8gdGhpcy5hdHRyTmFtZS50ZXN0KGF0dHIubmFtZSkgOiB0aGlzLmF0dHJOYW1lID09PSBhdHRyLm5hbWU7XG5cbiAgICAgIGlmICghdGhpcy5hdHRyVmFsdWUpIHtcbiAgICAgICAgLy8gZm9yIDptYXRjaGVzLWF0dHIoXCIvcmVnZXgvXCIpIG9yIDptYXRjaGVzLWF0dHIoXCJhdHRyLW5hbWVcIilcbiAgICAgICAgbWF0Y2hlZCA9IGF0dHJOYW1lTWF0Y2hlZDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBhdHRyVmFsdWVNYXRjaGVkID0gdGhpcy5pc1JlZ2V4cFZhbHVlID8gdGhpcy5hdHRyVmFsdWUudGVzdChhdHRyLnZhbHVlKSA6IHRoaXMuYXR0clZhbHVlID09PSBhdHRyLnZhbHVlO1xuICAgICAgICBtYXRjaGVkID0gYXR0ck5hbWVNYXRjaGVkICYmIGF0dHJWYWx1ZU1hdGNoZWQ7XG4gICAgICB9XG5cbiAgICAgIGlmIChtYXRjaGVkKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuXG4gICAgICBpICs9IDE7XG4gICAgfVxuICB9O1xuICAvKipcbiAgICogQ3JlYXRlcyBhIG5ldyBwc2V1ZG8tY2xhc3MgYW5kIHJlZ2lzdGVycyBpdCBpbiBTaXp6bGVcbiAgICovXG5cblxuICB2YXIgZXh0ZW5kU2l6emxlID0gZnVuY3Rpb24gZXh0ZW5kU2l6emxlKHNpenpsZSkge1xuICAgIC8vIEZpcnN0IG9mIGFsbCB3ZSBzaG91bGQgcHJlcGFyZSBTaXp6bGUgZW5naW5lXG4gICAgc2l6emxlLnNlbGVjdG9ycy5wc2V1ZG9zWydtYXRjaGVzLWF0dHInXSA9IHNpenpsZS5zZWxlY3RvcnMuY3JlYXRlUHNldWRvKGZ1bmN0aW9uIChhdHRyRmlsdGVyKSB7XG4gICAgICB2YXIgX21hdGNoZXJVdGlscyRwYXJzZU1hID0gbWF0Y2hlclV0aWxzLnBhcnNlTWF0Y2hlckZpbHRlcihhdHRyRmlsdGVyKSxcbiAgICAgICAgICBfbWF0Y2hlclV0aWxzJHBhcnNlTWEyID0gX3NsaWNlZFRvQXJyYXkoX21hdGNoZXJVdGlscyRwYXJzZU1hLCAyKSxcbiAgICAgICAgICByYXdOYW1lID0gX21hdGNoZXJVdGlscyRwYXJzZU1hMlswXSxcbiAgICAgICAgICByYXdWYWx1ZSA9IF9tYXRjaGVyVXRpbHMkcGFyc2VNYTJbMV07XG5cbiAgICAgIHZhciBuYW1lQXJnID0gbWF0Y2hlclV0aWxzLnBhcnNlUmF3TWF0Y2hlckFyZyhyYXdOYW1lKTtcbiAgICAgIHZhciB2YWx1ZUFyZyA9IG1hdGNoZXJVdGlscy5wYXJzZVJhd01hdGNoZXJBcmcocmF3VmFsdWUpO1xuXG4gICAgICBpZiAoIWF0dHJGaWx0ZXIgfHwgIW1hdGNoZXJVdGlscy52YWxpZGF0ZVByb3BNYXRjaGVyQXJncyhuYW1lQXJnLCB2YWx1ZUFyZykpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBhcmd1bWVudCBvZiA6bWF0Y2hlcy1hdHRyIHBzZXVkbyBjbGFzczogXCIuY29uY2F0KGF0dHJGaWx0ZXIpKTtcbiAgICAgIH1cblxuICAgICAgdmFyIG1hdGNoZXIgPSBuZXcgQXR0ck1hdGNoZXIobmFtZUFyZywgdmFsdWVBcmcpO1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgIHJldHVybiBtYXRjaGVyLm1hdGNoZXMoZWxlbWVudCk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9OyAvLyBFWFBPU0VcblxuXG4gIHJldHVybiB7XG4gICAgZXh0ZW5kU2l6emxlOiBleHRlbmRTaXp6bGVcbiAgfTtcbn0oKTtcblxuLyoqXG4gKiBQYXJzZXMgcmF3IHByb3BlcnR5IGFyZ1xuICogQHBhcmFtIHtzdHJpbmd9IGlucHV0XG4gKiBAcmV0dXJucyB7QXJnRGF0YVtdfSBhcnJheSBvZiBvYmplY3RzXG4gKi9cblxudmFyIHBhcnNlUmF3UHJvcENoYWluID0gZnVuY3Rpb24gcGFyc2VSYXdQcm9wQ2hhaW4oaW5wdXQpIHtcbiAgdmFyIFBST1BTX0RJVklERVIgPSAnLic7XG4gIHZhciBSRUdFWFBfTUFSS0VSID0gJy8nO1xuICB2YXIgcHJvcHNBcnIgPSBbXTtcbiAgdmFyIHN0ciA9IGlucHV0O1xuXG4gIHdoaWxlIChzdHIubGVuZ3RoID4gMCkge1xuICAgIGlmICh1dGlscy5zdGFydHNXaXRoKHN0ciwgUFJPUFNfRElWSURFUikpIHtcbiAgICAgIC8vIGZvciBjYXNlcyBsaWtlICcucHJvcC5pZCcgYW5kICduZXN0ZWQuLnRlc3QnXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGNoYWluIHByb3BlcnR5OiBcIi5jb25jYXQoaW5wdXQpKTtcbiAgICB9XG5cbiAgICBpZiAoIXV0aWxzLnN0YXJ0c1dpdGgoc3RyLCBSRUdFWFBfTUFSS0VSKSkge1xuICAgICAgdmFyIGlzUmVnZXhwID0gZmFsc2U7XG4gICAgICB2YXIgZGl2aWRlckluZGV4ID0gc3RyLmluZGV4T2YoUFJPUFNfRElWSURFUik7XG5cbiAgICAgIGlmIChzdHIuaW5kZXhPZihQUk9QU19ESVZJREVSKSA9PT0gLTEpIHtcbiAgICAgICAgLy8gaWYgdGhlcmUgaXMgbm8gJy4nIGxlZnQgaW4gc3RyXG4gICAgICAgIC8vIHRha2UgdGhlIHJlc3Qgb2Ygc3RyIGFzIHByb3BcbiAgICAgICAgcHJvcHNBcnIucHVzaCh7XG4gICAgICAgICAgYXJnOiBzdHIsXG4gICAgICAgICAgaXNSZWdleHA6IGlzUmVnZXhwXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gcHJvcHNBcnI7XG4gICAgICB9IC8vIGVsc2UgdGFrZSBwcm9wIGZyb20gc3RyXG5cblxuICAgICAgdmFyIHByb3AgPSBzdHIuc2xpY2UoMCwgZGl2aWRlckluZGV4KTsgLy8gZm9yIGNhc2VzIGxpa2UgJ2FzYWRmLj8rLy50ZXN0J1xuXG4gICAgICBpZiAocHJvcC5pbmRleE9mKFJFR0VYUF9NQVJLRVIpID4gLTEpIHtcbiAgICAgICAgLy8gcHJvcCBpcyAnPysvJ1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGNoYWluIHByb3BlcnR5OiBcIi5jb25jYXQocHJvcCkpO1xuICAgICAgfVxuXG4gICAgICBwcm9wc0Fyci5wdXNoKHtcbiAgICAgICAgYXJnOiBwcm9wLFxuICAgICAgICBpc1JlZ2V4cDogaXNSZWdleHBcbiAgICAgIH0pOyAvLyBkZWxldGUgcHJvcCBmcm9tIHN0clxuXG4gICAgICBzdHIgPSBzdHIuc2xpY2UoZGl2aWRlckluZGV4KTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gZGVhbCB3aXRoIHJlZ2V4cFxuICAgICAgdmFyIHByb3BDaHVua3MgPSBbXTtcbiAgICAgIHByb3BDaHVua3MucHVzaChzdHIuc2xpY2UoMCwgMSkpOyAvLyBpZiBzdHIgc3RhcnRzIHdpdGggJy8nLCBkZWxldGUgaXQgZnJvbSBzdHIgYW5kIGZpbmQgY2xvc2luZyByZWdleHAgc2xhc2guXG4gICAgICAvLyBub3RlIHRoYXQgY2hhaW5lZCBwcm9wZXJ0eSBuYW1lIGNhbiBub3QgaW5jbHVkZSAnLycgb3IgJy4nXG4gICAgICAvLyBzbyB0aGVyZSBpcyBubyBjaGVja2luZyBmb3IgZXNjYXBlZCBjaGFyYWN0ZXJzXG5cbiAgICAgIHN0ciA9IHN0ci5zbGljZSgxKTtcbiAgICAgIHZhciByZWdleEVuZEluZGV4ID0gc3RyLmluZGV4T2YoUkVHRVhQX01BUktFUik7XG5cbiAgICAgIGlmIChyZWdleEVuZEluZGV4IDwgMSkge1xuICAgICAgICAvLyByZWdleHAgc2hvdWxkIGJlIGF0IGxlYXN0ID09PSAnLy4vJ1xuICAgICAgICAvLyBzbyB3ZSBzaG91bGQgYXZvaWQgYXJncyBsaWtlICcvaWQnIGFuZCAndGVzdC4vLy5pZCdcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCByZWdleHA6IFwiLmNvbmNhdChSRUdFWFBfTUFSS0VSKS5jb25jYXQoc3RyKSk7XG4gICAgICB9XG5cbiAgICAgIHZhciBfaXNSZWdleHAgPSB0cnVlOyAvLyB0YWtlIHRoZSByZXN0IHJlZ2V4cCBwYXJ0XG5cbiAgICAgIHByb3BDaHVua3MucHVzaChzdHIuc2xpY2UoMCwgcmVnZXhFbmRJbmRleCArIDEpKTtcblxuICAgICAgdmFyIF9wcm9wID0gdXRpbHMudG9SZWdFeHAocHJvcENodW5rcy5qb2luKCcnKSk7XG5cbiAgICAgIHByb3BzQXJyLnB1c2goe1xuICAgICAgICBhcmc6IF9wcm9wLFxuICAgICAgICBpc1JlZ2V4cDogX2lzUmVnZXhwXG4gICAgICB9KTsgLy8gZGVsZXRlIHByb3AgZnJvbSBzdHJcblxuICAgICAgc3RyID0gc3RyLnNsaWNlKHJlZ2V4RW5kSW5kZXggKyAxKTtcbiAgICB9XG5cbiAgICBpZiAoIXN0cikge1xuICAgICAgcmV0dXJuIHByb3BzQXJyO1xuICAgIH0gLy8gc3RyIHNob3VsZCBiZSBsaWtlICcubmV4dFByb3AnIG5vd1xuICAgIC8vIHNvICd6eC5wcm9wJyBvciAnLicgaXMgaW52YWxpZFxuXG5cbiAgICBpZiAoIXV0aWxzLnN0YXJ0c1dpdGgoc3RyLCBQUk9QU19ESVZJREVSKSB8fCB1dGlscy5zdGFydHNXaXRoKHN0ciwgUFJPUFNfRElWSURFUikgJiYgc3RyLmxlbmd0aCA9PT0gMSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBjaGFpbiBwcm9wZXJ0eTogXCIuY29uY2F0KGlucHV0KSk7XG4gICAgfVxuXG4gICAgc3RyID0gc3RyLnNsaWNlKDEpO1xuICB9XG59O1xuXG52YXIgY29udmVydFR5cGVGcm9tU3RyID0gZnVuY3Rpb24gY29udmVydFR5cGVGcm9tU3RyKHZhbHVlKSB7XG4gIHZhciBudW1WYWx1ZSA9IE51bWJlcih2YWx1ZSk7XG4gIHZhciBvdXRwdXQ7XG5cbiAgaWYgKCFOdW1iZXIuaXNOYU4obnVtVmFsdWUpKSB7XG4gICAgb3V0cHV0ID0gbnVtVmFsdWU7XG4gIH0gZWxzZSB7XG4gICAgc3dpdGNoICh2YWx1ZSkge1xuICAgICAgY2FzZSAndW5kZWZpbmVkJzpcbiAgICAgICAgb3V0cHV0ID0gdW5kZWZpbmVkO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAnbnVsbCc6XG4gICAgICAgIG91dHB1dCA9IG51bGw7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlICd0cnVlJzpcbiAgICAgICAgb3V0cHV0ID0gdHJ1ZTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgJ2ZhbHNlJzpcbiAgICAgICAgb3V0cHV0ID0gZmFsc2U7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBkZWZhdWx0OlxuICAgICAgICBvdXRwdXQgPSB2YWx1ZTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gb3V0cHV0O1xufTtcblxudmFyIGNvbnZlcnRUeXBlSW50b1N0ciA9IGZ1bmN0aW9uIGNvbnZlcnRUeXBlSW50b1N0cih2YWx1ZSkge1xuICB2YXIgb3V0cHV0O1xuXG4gIHN3aXRjaCAodmFsdWUpIHtcbiAgICBjYXNlIHVuZGVmaW5lZDpcbiAgICAgIG91dHB1dCA9ICd1bmRlZmluZWQnO1xuICAgICAgYnJlYWs7XG5cbiAgICBjYXNlIG51bGw6XG4gICAgICBvdXRwdXQgPSAnbnVsbCc7XG4gICAgICBicmVhaztcblxuICAgIGRlZmF1bHQ6XG4gICAgICBvdXRwdXQgPSB2YWx1ZS50b1N0cmluZygpO1xuICB9XG5cbiAgcmV0dXJuIG91dHB1dDtcbn07XG4vKipcbiAqIENsYXNzIHRoYXQgZXh0ZW5kcyBTaXp6bGUgYW5kIGFkZHMgc3VwcG9ydCBmb3IgXCJtYXRjaGVzLXByb3BlcnR5XCIgcHNldWRvIGVsZW1lbnQuXG4gKi9cblxuXG52YXIgRWxlbWVudFByb3BlcnR5TWF0Y2hlciA9IGZ1bmN0aW9uICgpIHtcbiAgLyoqXG4gICAqIENsYXNzIHRoYXQgbWF0Y2hlcyBlbGVtZW50IHByb3BlcnRpZXMgYWdhaW5zdCB0aGUgc3BlY2lmaWVkIGV4cHJlc3Npb25zXG4gICAqIEBwYXJhbSB7QXJnRGF0YVtdfSBwcm9wc0NoYWluQXJnIC0gYXJyYXkgb2YgcGFyc2VkIHByb3BzIGNoYWluIG9iamVjdHNcbiAgICogQHBhcmFtIHtBcmdEYXRhfSB2YWx1ZUFyZyAtIHBhcnNlZCB2YWx1ZSBhcmd1bWVudFxuICAgKiBAcGFyYW0ge3N0cmluZ30gcHNldWRvRWxlbWVudFxuICAgKiBAY29uc3RydWN0b3JcbiAgICpcbiAgICogQG1lbWJlciB7QXJyYXl9IGNoYWluZWRQcm9wc1xuICAgKiBAbWVtYmVyIHtib29sZWFufSBpc1JlZ2V4cE5hbWVcbiAgICogQG1lbWJlciB7c3RyaW5nfFJlZ0V4cH0gcHJvcFZhbHVlXG4gICAqIEBtZW1iZXIge2Jvb2xlYW59IGlzUmVnZXhwVmFsdWVcbiAgICovXG4gIHZhciBQcm9wTWF0Y2hlciA9IGZ1bmN0aW9uIFByb3BNYXRjaGVyKHByb3BzQ2hhaW5BcmcsIHZhbHVlQXJnLCBwc2V1ZG9FbGVtZW50KSB7XG4gICAgdGhpcy5wc2V1ZG9FbGVtZW50ID0gcHNldWRvRWxlbWVudDtcbiAgICB0aGlzLmNoYWluZWRQcm9wcyA9IHByb3BzQ2hhaW5Bcmc7XG4gICAgdGhpcy5wcm9wVmFsdWUgPSB2YWx1ZUFyZy5hcmc7XG4gICAgdGhpcy5pc1JlZ2V4cFZhbHVlID0gdmFsdWVBcmcuaXNSZWdleHA7XG4gIH07XG4gIC8qKlxuICAgKiBGdW5jdGlvbiB0byBjaGVjayBpZiBlbGVtZW50IHByb3BlcnRpZXMgbWF0Y2hlcyBmaWx0ZXIgcGF0dGVyblxuICAgKiBAcGFyYW0ge0VsZW1lbnR9IGVsZW1lbnQgdG8gY2hlY2tcbiAgICovXG5cblxuICBQcm9wTWF0Y2hlci5wcm90b3R5cGUubWF0Y2hlcyA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgdmFyIG93bmVyT2JqQXJyID0gbWF0Y2hlclV0aWxzLmZpbHRlclJvb3RzQnlSZWdleHBDaGFpbihlbGVtZW50LCB0aGlzLmNoYWluZWRQcm9wcyk7XG5cbiAgICBpZiAob3duZXJPYmpBcnIubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgdmFyIG1hdGNoZWQgPSB0cnVlO1xuXG4gICAgaWYgKHRoaXMucHJvcFZhbHVlKSB7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG93bmVyT2JqQXJyLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgIHZhciByZWFsVmFsdWUgPSBvd25lck9iakFycltpXS52YWx1ZTtcblxuICAgICAgICBpZiAodGhpcy5pc1JlZ2V4cFZhbHVlKSB7XG4gICAgICAgICAgbWF0Y2hlZCA9IHRoaXMucHJvcFZhbHVlLnRlc3QoY29udmVydFR5cGVJbnRvU3RyKHJlYWxWYWx1ZSkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIGhhbmRsZSAnbnVsbCcgYW5kICd1bmRlZmluZWQnIHByb3BlcnR5IHZhbHVlcyBzZXQgYXMgc3RyaW5nXG4gICAgICAgICAgaWYgKHJlYWxWYWx1ZSA9PT0gJ251bGwnIHx8IHJlYWxWYWx1ZSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIG1hdGNoZWQgPSB0aGlzLnByb3BWYWx1ZSA9PT0gcmVhbFZhbHVlO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgbWF0Y2hlZCA9IGNvbnZlcnRUeXBlRnJvbVN0cih0aGlzLnByb3BWYWx1ZSkgPT09IHJlYWxWYWx1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChtYXRjaGVkKSB7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gbWF0Y2hlZDtcbiAgfTtcbiAgLyoqXG4gICAqIENyZWF0ZXMgYSBuZXcgcHNldWRvLWNsYXNzIGFuZCByZWdpc3RlcnMgaXQgaW4gU2l6emxlXG4gICAqL1xuXG5cbiAgdmFyIGV4dGVuZFNpenpsZSA9IGZ1bmN0aW9uIGV4dGVuZFNpenpsZShzaXp6bGUpIHtcbiAgICAvLyBGaXJzdCBvZiBhbGwgd2Ugc2hvdWxkIHByZXBhcmUgU2l6emxlIGVuZ2luZVxuICAgIHNpenpsZS5zZWxlY3RvcnMucHNldWRvc1snbWF0Y2hlcy1wcm9wZXJ0eSddID0gc2l6emxlLnNlbGVjdG9ycy5jcmVhdGVQc2V1ZG8oZnVuY3Rpb24gKHByb3BlcnR5RmlsdGVyKSB7XG4gICAgICBpZiAoIXByb3BlcnR5RmlsdGVyKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gYXJndW1lbnQgaXMgZ2l2ZW4gZm9yIDptYXRjaGVzLXByb3BlcnR5IHBzZXVkbyBjbGFzcycpO1xuICAgICAgfVxuXG4gICAgICB2YXIgX21hdGNoZXJVdGlscyRwYXJzZU1hID0gbWF0Y2hlclV0aWxzLnBhcnNlTWF0Y2hlckZpbHRlcihwcm9wZXJ0eUZpbHRlciksXG4gICAgICAgICAgX21hdGNoZXJVdGlscyRwYXJzZU1hMiA9IF9zbGljZWRUb0FycmF5KF9tYXRjaGVyVXRpbHMkcGFyc2VNYSwgMiksXG4gICAgICAgICAgcmF3UHJvcCA9IF9tYXRjaGVyVXRpbHMkcGFyc2VNYTJbMF0sXG4gICAgICAgICAgcmF3VmFsdWUgPSBfbWF0Y2hlclV0aWxzJHBhcnNlTWEyWzFdOyAvLyBjaGFpbmVkIHByb3BlcnR5IG5hbWUgY2FuIG5vdCBpbmNsdWRlICcvJyBvciAnLidcbiAgICAgIC8vIHNvIHJlZ2V4IHByb3AgbmFtZXMgd2l0aCBzdWNoIGVzY2FwZWQgY2hhcmFjdGVycyBhcmUgaW52YWxpZFxuXG5cbiAgICAgIGlmIChyYXdQcm9wLmluZGV4T2YoJ1xcXFwvJykgPiAtMSB8fCByYXdQcm9wLmluZGV4T2YoJ1xcXFwuJykgPiAtMSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHByb3BlcnR5IG5hbWU6IFwiLmNvbmNhdChyYXdQcm9wKSk7XG4gICAgICB9XG5cbiAgICAgIHZhciBwcm9wc0NoYWluQXJnID0gcGFyc2VSYXdQcm9wQ2hhaW4ocmF3UHJvcCk7XG4gICAgICB2YXIgdmFsdWVBcmcgPSBtYXRjaGVyVXRpbHMucGFyc2VSYXdNYXRjaGVyQXJnKHJhd1ZhbHVlKTtcbiAgICAgIHZhciBwcm9wc1RvVmFsaWRhdGUgPSBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KHByb3BzQ2hhaW5BcmcpLCBbdmFsdWVBcmddKTtcblxuICAgICAgaWYgKCFtYXRjaGVyVXRpbHMudmFsaWRhdGVQcm9wTWF0Y2hlckFyZ3MocHJvcHNUb1ZhbGlkYXRlKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGFyZ3VtZW50IG9mIDptYXRjaGVzLXByb3BlcnR5IHBzZXVkbyBjbGFzczogXCIuY29uY2F0KHByb3BlcnR5RmlsdGVyKSk7XG4gICAgICB9XG5cbiAgICAgIHZhciBtYXRjaGVyID0gbmV3IFByb3BNYXRjaGVyKHByb3BzQ2hhaW5BcmcsIHZhbHVlQXJnKTtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICByZXR1cm4gbWF0Y2hlci5tYXRjaGVzKGVsZW1lbnQpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfTsgLy8gRVhQT1NFXG5cblxuICByZXR1cm4ge1xuICAgIGV4dGVuZFNpenpsZTogZXh0ZW5kU2l6emxlXG4gIH07XG59KCk7XG5cbi8qKlxuICogQ29weXJpZ2h0IDIwMjAgQWRndWFyZCBTb2Z0d2FyZSBMdGRcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBDbGFzcyB0aGF0IGV4dGVuZHMgU2l6emxlIGFuZCBhZGRzIHN1cHBvcnQgZm9yIDppcygpIHBzZXVkbyBlbGVtZW50LlxuICovXG5cbnZhciBJc0FueU1hdGNoZXIgPSBmdW5jdGlvbiAoKSB7XG4gIC8qKlxuICAgKiBDbGFzcyB0aGF0IG1hdGNoZXMgZWxlbWVudCBieSBvbmUgb2YgdGhlIHNlbGVjdG9yc1xuICAgKiBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9DU1MvOmlzXG4gICAqIEBwYXJhbSB7QXJyYXl9IHNlbGVjdG9yc1xuICAgKiBAcGFyYW0ge3N0cmluZ30gcHNldWRvRWxlbWVudFxuICAgKiBAY29uc3RydWN0b3JcbiAgICovXG4gIHZhciBJc01hdGNoZXIgPSBmdW5jdGlvbiBJc01hdGNoZXIoc2VsZWN0b3JzLCBwc2V1ZG9FbGVtZW50KSB7XG4gICAgdGhpcy5zZWxlY3RvcnMgPSBzZWxlY3RvcnM7XG4gICAgdGhpcy5wc2V1ZG9FbGVtZW50ID0gcHNldWRvRWxlbWVudDtcbiAgfTtcbiAgLyoqXG4gICAqIEZ1bmN0aW9uIHRvIGNoZWNrIGlmIGVsZW1lbnQgY2FuIGJlIG1hdGNoZWQgYnkgYW55IHBhc3NlZCBzZWxlY3RvclxuICAgKiBAcGFyYW0ge0VsZW1lbnR9IGVsZW1lbnQgdG8gY2hlY2tcbiAgICovXG5cblxuICBJc01hdGNoZXIucHJvdG90eXBlLm1hdGNoZXMgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgIHZhciBpc01hdGNoZWQgPSAhIXRoaXMuc2VsZWN0b3JzLmZpbmQoZnVuY3Rpb24gKHNlbGVjdG9yKSB7XG4gICAgICB2YXIgbm9kZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9yKTtcbiAgICAgIHJldHVybiBBcnJheS5mcm9tKG5vZGVzKS5maW5kKGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgIHJldHVybiBub2RlID09PSBlbGVtZW50O1xuICAgICAgfSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIGlzTWF0Y2hlZDtcbiAgfTtcbiAgLyoqXG4gICAqIENyZWF0ZXMgYSBuZXcgcHNldWRvLWNsYXNzIGFuZCByZWdpc3RlcnMgaXQgaW4gU2l6emxlXG4gICAqL1xuXG5cbiAgdmFyIGV4dGVuZFNpenpsZSA9IGZ1bmN0aW9uIGV4dGVuZFNpenpsZShzaXp6bGUpIHtcbiAgICAvLyBGaXJzdCBvZiBhbGwgd2Ugc2hvdWxkIHByZXBhcmUgU2l6emxlIGVuZ2luZVxuICAgIHNpenpsZS5zZWxlY3RvcnMucHNldWRvc1snaXMnXSA9IHNpenpsZS5zZWxlY3RvcnMuY3JlYXRlUHNldWRvKGZ1bmN0aW9uIChpbnB1dCkge1xuICAgICAgaWYgKGlucHV0ID09PSAnJykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGFyZ3VtZW50IG9mIDppcyBwc2V1ZG8tY2xhc3M6IFwiLmNvbmNhdChpbnB1dCkpO1xuICAgICAgfVxuXG4gICAgICB2YXIgc2VsZWN0b3JzID0gaW5wdXQuc3BsaXQoJywnKS5tYXAoZnVuY3Rpb24gKHMpIHtcbiAgICAgICAgcmV0dXJuIHMudHJpbSgpO1xuICAgICAgfSk7IC8vIGNvbGxlY3QgdmFsaWQgc2VsZWN0b3JzIGFuZCBsb2cgYWJvdXQgaW52YWxpZCBvbmVzXG5cbiAgICAgIHZhciB2YWxpZFNlbGVjdG9ycyA9IHNlbGVjdG9ycy5yZWR1Y2UoZnVuY3Rpb24gKGFjYywgc2VsZWN0b3IpIHtcbiAgICAgICAgaWYgKGNzc1V0aWxzLmlzU2ltcGxlU2VsZWN0b3JWYWxpZChzZWxlY3RvcikpIHtcbiAgICAgICAgICBhY2MucHVzaChzZWxlY3Rvcik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdXRpbHMubG9nSW5mbyhcIkludmFsaWQgc2VsZWN0b3IgcGFzc2VkIHRvIDppcygpIHBzZXVkby1jbGFzczogJ1wiLmNvbmNhdChzZWxlY3RvciwgXCInXCIpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBhY2M7XG4gICAgICB9LCBbXSk7XG4gICAgICB2YXIgbWF0Y2hlciA9IG5ldyBJc01hdGNoZXIodmFsaWRTZWxlY3RvcnMpO1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgIHJldHVybiBtYXRjaGVyLm1hdGNoZXMoZWxlbWVudCk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgZXh0ZW5kU2l6emxlOiBleHRlbmRTaXp6bGVcbiAgfTtcbn0oKTtcblxuLyoqXG4gKiBDb3B5cmlnaHQgMjAyMSBBZGd1YXJkIFNvZnR3YXJlIEx0ZFxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEV4dGVuZGVkIHNlbGVjdG9yIGZhY3RvcnkgbW9kdWxlLCBmb3IgY3JlYXRpbmcgZXh0ZW5kZWQgc2VsZWN0b3IgY2xhc3Nlcy5cbiAqXG4gKiBFeHRlbmRlZCBzZWxlY3Rpb24gY2FwYWJpbGl0aWVzIGRlc2NyaXB0aW9uOlxuICogaHR0cHM6Ly9naXRodWIuY29tL0FkZ3VhcmRUZWFtL0V4dGVuZGVkQ3NzL2Jsb2IvbWFzdGVyL1JFQURNRS5tZFxuICovXG5cbnZhciBFeHRlbmRlZFNlbGVjdG9yRmFjdG9yeSA9IGZ1bmN0aW9uICgpIHtcbiAgLy8gd2hpbGUgYWRkaW5nIG5ldyBtYXJrZXJzLCBjb25zdGFudHMgaW4gb3RoZXIgQWRHdWFyZCByZXBvcyBzaG91bGQgYmUgY29ycmVjdGVkXG4gIC8vIEFkR3VhcmQgYnJvd3NlciBleHRlbnNpb24gOiBDc3NGaWx0ZXJSdWxlLlNVUFBPUlRFRF9QU0VVRE9fQ0xBU1NFUyBhbmQgQ3NzRmlsdGVyUnVsZS5FWFRFTkRFRF9DU1NfTUFSS0VSU1xuICAvLyB0c3VybGZpbHRlciwgU2FmYXJpQ29udmVydGVyTGliIDogRVhUX0NTU19QU0VVRE9fSU5ESUNBVE9SU1xuICB2YXIgUFNFVURPX0VYVEVOU0lPTlNfTUFSS0VSUyA9IFsnOmhhcycsICc6Y29udGFpbnMnLCAnOmhhcy10ZXh0JywgJzptYXRjaGVzLWNzcycsICc6LWFicC1oYXMnLCAnOi1hYnAtaGFzLXRleHQnLCAnOmlmJywgJzppZi1ub3QnLCAnOnhwYXRoJywgJzpudGgtYW5jZXN0b3InLCAnOnVwd2FyZCcsICc6cmVtb3ZlJywgJzptYXRjaGVzLWF0dHInLCAnOm1hdGNoZXMtcHJvcGVydHknLCAnOi1hYnAtY29udGFpbnMnLCAnOmlzJ107XG4gIHZhciBpbml0aWFsaXplZCA9IGZhbHNlO1xuICB2YXIgU2l6emxlO1xuICAvKipcbiAgICogTGF6eSBpbml0aWFsaXphdGlvbiBvZiB0aGUgRXh0ZW5kZWRTZWxlY3RvckZhY3RvcnkgYW5kIG9iamVjdHMgdGhhdCBtaWdodCBiZSBuZWNlc3NhcnkgZm9yIGNyZWF0aW5nIGFuZCBhcHBseWluZyBzdHlsZXMuXG4gICAqIFRoaXMgbWV0aG9kIGV4dGVuZHMgU2l6emxlIGVuZ2luZSB0aGF0IHdlIHVzZSB1bmRlciB0aGUgaG9vZCB3aXRoIG91ciBjdXN0b20gcHNldWRvLWNsYXNzZXMuXG4gICAqL1xuXG4gIGZ1bmN0aW9uIGluaXRpYWxpemUoKSB7XG4gICAgaWYgKGluaXRpYWxpemVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaW5pdGlhbGl6ZWQgPSB0cnVlOyAvLyBPdXIgdmVyc2lvbiBvZiBTaXp6bGUgaXMgaW5pdGlhbGl6ZWQgbGF6aWx5IGFzIHdlbGxcblxuICAgIFNpenpsZSA9IGluaXRpYWxpemVTaXp6bGUoKTsgLy8gQWRkIDptYXRjaGVzLWNzcy0qKCkgc3VwcG9ydFxuXG4gICAgU3R5bGVQcm9wZXJ0eU1hdGNoZXIuZXh0ZW5kU2l6emxlKFNpenpsZSk7IC8vIEFkZCA6bWF0Y2hlcy1hdHRyKCkgc3VwcG9ydFxuXG4gICAgQXR0cmlidXRlc01hdGNoZXIuZXh0ZW5kU2l6emxlKFNpenpsZSk7IC8vIEFkZCA6bWF0Y2hlcy1wcm9wZXJ0eSgpIHN1cHBvcnRcblxuICAgIEVsZW1lbnRQcm9wZXJ0eU1hdGNoZXIuZXh0ZW5kU2l6emxlKFNpenpsZSk7IC8vIEFkZCA6aXMoKSBzdXBwb3J0XG5cbiAgICBJc0FueU1hdGNoZXIuZXh0ZW5kU2l6emxlKFNpenpsZSk7IC8vIEFkZCA6Y29udGFpbnMsIDpoYXMtdGV4dCwgOi1hYnAtY29udGFpbnMgc3VwcG9ydFxuXG4gICAgdmFyIGNvbnRhaW5zUHNldWRvID0gU2l6emxlLnNlbGVjdG9ycy5jcmVhdGVQc2V1ZG8oZnVuY3Rpb24gKHRleHQpIHtcbiAgICAgIGlmICgvXlxccypcXC8uKlxcL1tnbWlzdXldKlxccyokLy50ZXN0KHRleHQpKSB7XG4gICAgICAgIHRleHQgPSB0ZXh0LnRyaW0oKTtcbiAgICAgICAgdmFyIGZsYWdzSW5kZXggPSB0ZXh0Lmxhc3RJbmRleE9mKCcvJyk7XG4gICAgICAgIHZhciBmbGFncyA9IHRleHQuc3Vic3RyaW5nKGZsYWdzSW5kZXggKyAxKTtcbiAgICAgICAgdGV4dCA9IHRleHQuc3Vic3RyKDAsIGZsYWdzSW5kZXggKyAxKS5zbGljZSgxLCAtMSkucmVwbGFjZSgvXFxcXChbXFxcXFwiXSkvZywgJyQxJyk7XG4gICAgICAgIHZhciByZWdleDtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgIHJlZ2V4ID0gbmV3IFJlZ0V4cCh0ZXh0LCBmbGFncyk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGFyZ3VtZW50IG9mIDpjb250YWlucyBwc2V1ZG8gY2xhc3M6IFwiLmNvbmNhdCh0ZXh0KSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGVsZW0pIHtcbiAgICAgICAgICB2YXIgZWxlbVRleHRDb250ZW50ID0gdXRpbHMubm9kZVRleHRDb250ZW50R2V0dGVyLmFwcGx5KGVsZW0pO1xuICAgICAgICAgIHJldHVybiByZWdleC50ZXN0KGVsZW1UZXh0Q29udGVudCk7XG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoL1xcXFwoW1xcXFwoKVtcXF1cIl0pL2csICckMScpO1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICAgIHZhciBlbGVtVGV4dENvbnRlbnQgPSB1dGlscy5ub2RlVGV4dENvbnRlbnRHZXR0ZXIuYXBwbHkoZWxlbSk7XG4gICAgICAgIHJldHVybiBlbGVtVGV4dENvbnRlbnQuaW5kZXhPZih0ZXh0KSA+IC0xO1xuICAgICAgfTtcbiAgICB9KTtcbiAgICBTaXp6bGUuc2VsZWN0b3JzLnBzZXVkb3NbJ2NvbnRhaW5zJ10gPSBjb250YWluc1BzZXVkbztcbiAgICBTaXp6bGUuc2VsZWN0b3JzLnBzZXVkb3NbJ2hhcy10ZXh0J10gPSBjb250YWluc1BzZXVkbztcbiAgICBTaXp6bGUuc2VsZWN0b3JzLnBzZXVkb3NbJy1hYnAtY29udGFpbnMnXSA9IGNvbnRhaW5zUHNldWRvOyAvLyBBZGQgOmlmLCA6LWFicC1oYXMgc3VwcG9ydFxuXG4gICAgU2l6emxlLnNlbGVjdG9ycy5wc2V1ZG9zWydpZiddID0gU2l6emxlLnNlbGVjdG9ycy5wc2V1ZG9zWydoYXMnXTtcbiAgICBTaXp6bGUuc2VsZWN0b3JzLnBzZXVkb3NbJy1hYnAtaGFzJ10gPSBTaXp6bGUuc2VsZWN0b3JzLnBzZXVkb3NbJ2hhcyddOyAvLyBBZGQgOmlmLW5vdCBzdXBwb3J0XG5cbiAgICBTaXp6bGUuc2VsZWN0b3JzLnBzZXVkb3NbJ2lmLW5vdCddID0gU2l6emxlLnNlbGVjdG9ycy5jcmVhdGVQc2V1ZG8oZnVuY3Rpb24gKHNlbGVjdG9yKSB7XG4gICAgICBpZiAodHlwZW9mIHNlbGVjdG9yID09PSAnc3RyaW5nJykge1xuICAgICAgICBTaXp6bGUuY29tcGlsZShzZWxlY3Rvcik7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICByZXR1cm4gU2l6emxlKHNlbGVjdG9yLCBlbGVtKS5sZW5ndGggPT09IDA7XG4gICAgICB9O1xuICAgIH0pO1xuICAgIHJlZ2lzdGVyUGFyc2VyT25seVRva2VucygpO1xuICB9XG4gIC8qKlxuICAgKiBSZWdpc3RyYXRlIGN1c3RvbSB0b2tlbnMgZm9yIHBhcnNlci5cbiAgICogTmVlZGVkIGZvciBwcm9wZXIgd29yayBvZiBwc2V1ZG9zOlxuICAgKiBmb3IgY2hlY2tpbmcgaWYgdGhlIHRva2VuIGlzIGxhc3QgYW5kIHBzZXVkby1jbGFzcyBhcmd1bWVudHMgdmFsaWRhdGlvblxuICAgKi9cblxuXG4gIGZ1bmN0aW9uIHJlZ2lzdGVyUGFyc2VyT25seVRva2VucygpIHtcbiAgICBTaXp6bGUuc2VsZWN0b3JzLnBzZXVkb3NbJ3hwYXRoJ10gPSBTaXp6bGUuc2VsZWN0b3JzLmNyZWF0ZVBzZXVkbyhmdW5jdGlvbiAoc2VsZWN0b3IpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGRvY3VtZW50LmNyZWF0ZUV4cHJlc3Npb24oc2VsZWN0b3IsIG51bGwpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGFyZ3VtZW50IG9mIDp4cGF0aCBwc2V1ZG8gY2xhc3M6IFwiLmNvbmNhdChzZWxlY3RvcikpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH07XG4gICAgfSk7XG4gICAgU2l6emxlLnNlbGVjdG9ycy5wc2V1ZG9zWydudGgtYW5jZXN0b3InXSA9IFNpenpsZS5zZWxlY3RvcnMuY3JlYXRlUHNldWRvKGZ1bmN0aW9uIChzZWxlY3Rvcikge1xuICAgICAgdmFyIGRlZXAgPSBOdW1iZXIoc2VsZWN0b3IpO1xuXG4gICAgICBpZiAoTnVtYmVyLmlzTmFOKGRlZXApIHx8IGRlZXAgPCAxIHx8IGRlZXAgPj0gMjU2KSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgYXJndW1lbnQgb2YgOm50aC1hbmNlc3RvciBwc2V1ZG8gY2xhc3M6IFwiLmNvbmNhdChzZWxlY3RvcikpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH07XG4gICAgfSk7XG4gICAgU2l6emxlLnNlbGVjdG9ycy5wc2V1ZG9zWyd1cHdhcmQnXSA9IFNpenpsZS5zZWxlY3RvcnMuY3JlYXRlUHNldWRvKGZ1bmN0aW9uIChpbnB1dCkge1xuICAgICAgaWYgKGlucHV0ID09PSAnJykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGFyZ3VtZW50IG9mIDp1cHdhcmQgcHNldWRvIGNsYXNzOiBcIi5jb25jYXQoaW5wdXQpKTtcbiAgICAgIH0gZWxzZSBpZiAoTnVtYmVyLmlzSW50ZWdlcigraW5wdXQpICYmICgraW5wdXQgPCAxIHx8ICtpbnB1dCA+PSAyNTYpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgYXJndW1lbnQgb2YgOnVwd2FyZCBwc2V1ZG8gY2xhc3M6IFwiLmNvbmNhdChpbnB1dCkpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH07XG4gICAgfSk7XG4gICAgU2l6emxlLnNlbGVjdG9ycy5wc2V1ZG9zWydyZW1vdmUnXSA9IFNpenpsZS5zZWxlY3RvcnMuY3JlYXRlUHNldWRvKGZ1bmN0aW9uIChpbnB1dCkge1xuICAgICAgaWYgKGlucHV0ICE9PSAnJykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGFyZ3VtZW50IG9mIDpyZW1vdmUgcHNldWRvIGNsYXNzOiBcIi5jb25jYXQoaW5wdXQpKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG4gIC8qKlxuICAgKiBDaGVja3MgaWYgc3BlY2lmaWVkIHRva2VuIGNhbiBiZSB1c2VkIGJ5IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwuXG4gICAqL1xuXG5cbiAgZnVuY3Rpb24gaXNTaW1wbGVUb2tlbih0b2tlbikge1xuICAgIHZhciB0eXBlID0gdG9rZW4udHlwZTtcblxuICAgIGlmICh0eXBlID09PSAnSUQnIHx8IHR5cGUgPT09ICdDTEFTUycgfHwgdHlwZSA9PT0gJ0FUVFInIHx8IHR5cGUgPT09ICdUQUcnIHx8IHR5cGUgPT09ICdDSElMRCcpIHtcbiAgICAgIC8vIGtub3duIHNpbXBsZSB0b2tlbnNcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIGlmICh0eXBlID09PSAnUFNFVURPJykge1xuICAgICAgLy8gY2hlY2sgaWYgdmFsdWUgY29udGFpbnMgYW55IG9mIGV4dGVuZGVkIHBzZXVkbyBjbGFzc2VzXG4gICAgICB2YXIgaSA9IFBTRVVET19FWFRFTlNJT05TX01BUktFUlMubGVuZ3RoO1xuXG4gICAgICB3aGlsZSAoaS0tKSB7XG4gICAgICAgIGlmICh0b2tlbi52YWx1ZS5pbmRleE9mKFBTRVVET19FWFRFTlNJT05TX01BUktFUlNbaV0pID49IDApIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSAvLyBhbGwgb3RoZXJzIGFyZW4ndCBzaW1wbGVcblxuXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIC8qKlxuICAgKiBDaGVja3MgaWYgc3BlY2lmaWVkIHRva2VuIGlzIGEgY29tYmluYXRvclxuICAgKi9cblxuXG4gIGZ1bmN0aW9uIGlzUmVsYXRpb25Ub2tlbih0b2tlbikge1xuICAgIHZhciB0eXBlID0gdG9rZW4udHlwZTtcbiAgICByZXR1cm4gdHlwZSA9PT0gJyAnIHx8IHR5cGUgPT09ICc+JyB8fCB0eXBlID09PSAnKycgfHwgdHlwZSA9PT0gJ34nO1xuICB9XG4gIC8qKlxuICAgKiBFeHRlbmRlZFNlbGVjdG9yUGFyc2VyIGlzIGEgaGVscGVyIGNsYXNzIGZvciBjcmVhdGluZyB2YXJpb3VzIHNlbGVjdG9yIGluc3RhbmNlcyB3aGljaFxuICAgKiBhbGwgc2hhcmVzIGEgbWV0aG9kIGBxdWVyeVNlbGVjdG9yQWxsKClgIGFuZCBgbWF0Y2hlcygpYCBpbXBsZW1lbnRpbmcgZGlmZmVyZW50IHNlYXJjaCBzdHJhdGVnaWVzXG4gICAqIGRlcGVuZGluZyBvbiBhIHR5cGUgb2Ygc2VsZWN0b3IuXG4gICAqXG4gICAqIEN1cnJlbnRseSwgdGhlcmUgYXJlIDMgdHlwZXM6XG4gICAqICBBIHRyYWl0LWxlc3MgZXh0ZW5kZWQgc2VsZWN0b3JcbiAgICogICAgLSB3ZSBkaXJlY3RseSBmZWVkIHNlbGVjdG9yIHN0cmluZ3MgdG8gU2l6emxlLlxuICAgKiAgQSBzcGxpdHRlZCBleHRlbmRlZCBzZWxlY3RvclxuICAgKiAgICAtIHN1Y2ggYXMgI2NvbnRhaW5lciAjZmVlZEl0ZW06aGFzKC5hZHMpLCB3aGVyZSBpdCBpcyBzcGxpdHRlZCB0byBgI2NvbnRhaW5lcmAgYW5kIGAjZmVlZEl0ZW06aGFzKC5hZHMpYC5cbiAgICovXG5cblxuICBmdW5jdGlvbiBFeHRlbmRlZFNlbGVjdG9yUGFyc2VyKHNlbGVjdG9yVGV4dCwgdG9rZW5zLCBkZWJ1Zykge1xuICAgIGluaXRpYWxpemUoKTtcblxuICAgIGlmICh0eXBlb2YgdG9rZW5zID09PSAndW5kZWZpbmVkJykge1xuICAgICAgdGhpcy5zZWxlY3RvclRleHQgPSBjc3NVdGlscy5ub3JtYWxpemUoc2VsZWN0b3JUZXh0KTsgLy8gUGFzc2luZyBgcmV0dXJuVW5zb3J0ZWRgIGluIG9yZGVyIHRvIHJlY2VpdmUgdG9rZW5zIGluIHRoZSBvcmRlciB0aGF0J3MgdmFsaWQgZm9yIHRoZSBicm93c2VyXG4gICAgICAvLyBJbiBTaXp6bGUgaW50ZXJuYWxseSwgdGhlIHRva2VucyBhcmUgcmUtc29ydGVkOiBodHRwczovL2dpdGh1Yi5jb20vQWRndWFyZFRlYW0vRXh0ZW5kZWRDc3MvaXNzdWVzLzU1XG5cbiAgICAgIHRoaXMudG9rZW5zID0gU2l6emxlLnRva2VuaXplKHRoaXMuc2VsZWN0b3JUZXh0LCBmYWxzZSwge1xuICAgICAgICByZXR1cm5VbnNvcnRlZDogdHJ1ZVxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2VsZWN0b3JUZXh0ID0gc2VsZWN0b3JUZXh0O1xuICAgICAgdGhpcy50b2tlbnMgPSB0b2tlbnM7XG4gICAgfVxuXG4gICAgaWYgKGRlYnVnID09PSB0cnVlKSB7XG4gICAgICB0aGlzLmRlYnVnID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICBFeHRlbmRlZFNlbGVjdG9yUGFyc2VyLnByb3RvdHlwZSA9IHtcbiAgICAvKipcbiAgICAgKiBUaGUgbWFpbiBtZXRob2QsIGNyZWF0ZXMgYSBzZWxlY3RvciBpbnN0YW5jZSBkZXBlbmRpbmcgb24gdGhlIHR5cGUgb2YgYSBzZWxlY3Rvci5cbiAgICAgKiBAcHVibGljXG4gICAgICovXG4gICAgY3JlYXRlU2VsZWN0b3I6IGZ1bmN0aW9uIGNyZWF0ZVNlbGVjdG9yKCkge1xuICAgICAgdmFyIGRlYnVnID0gdGhpcy5kZWJ1ZztcbiAgICAgIHZhciB0b2tlbnMgPSB0aGlzLnRva2VucztcbiAgICAgIHZhciBzZWxlY3RvclRleHQgPSB0aGlzLnNlbGVjdG9yVGV4dDtcblxuICAgICAgaWYgKHRva2Vucy5sZW5ndGggIT09IDEpIHtcbiAgICAgICAgLy8gQ29tbWEtc2VwYXJhdGUgc2VsZWN0b3IgLSBjYW4ndCBvcHRpbWl6ZSBmdXJ0aGVyXG4gICAgICAgIHJldHVybiBuZXcgVHJhaXRMZXNzU2VsZWN0b3Ioc2VsZWN0b3JUZXh0LCBkZWJ1Zyk7XG4gICAgICB9XG5cbiAgICAgIHZhciB4cGF0aFBhcnQgPSB0aGlzLmdldFhwYXRoUGFydCgpO1xuXG4gICAgICBpZiAodHlwZW9mIHhwYXRoUGFydCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBYcGF0aFNlbGVjdG9yKHNlbGVjdG9yVGV4dCwgeHBhdGhQYXJ0LCBkZWJ1Zyk7XG4gICAgICB9XG5cbiAgICAgIHZhciB1cHdhcmRQYXJ0ID0gdGhpcy5nZXRVcHdhcmRQYXJ0KCk7XG5cbiAgICAgIGlmICh0eXBlb2YgdXB3YXJkUGFydCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgdmFyIG91dHB1dDtcbiAgICAgICAgdmFyIHVwd2FyZERlZXAgPSBwYXJzZUludCh1cHdhcmRQYXJ0LCAxMCk7IC8vIGlmIHVwd2FyZCBwYXJhbWV0ZXIgaXMgbm90IGEgbnVtYmVyLCB3ZSBjb25zaWRlciBpdCBhcyBhIHNlbGVjdG9yXG5cbiAgICAgICAgaWYgKE51bWJlci5pc05hTih1cHdhcmREZWVwKSkge1xuICAgICAgICAgIG91dHB1dCA9IG5ldyBVcHdhcmRTZWxlY3RvcihzZWxlY3RvclRleHQsIHVwd2FyZFBhcnQsIGRlYnVnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyB1cHdhcmQgd29ya3MgbGlrZSBudGgtYW5jZXN0b3JcbiAgICAgICAgICB2YXIgeHBhdGggPSB0aGlzLmNvbnZlcnROdGhBbmNlc3RvclRva2VuKHVwd2FyZERlZXApO1xuICAgICAgICAgIG91dHB1dCA9IG5ldyBYcGF0aFNlbGVjdG9yKHNlbGVjdG9yVGV4dCwgeHBhdGgsIGRlYnVnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBvdXRwdXQ7XG4gICAgICB9IC8vIGFyZ3VtZW50IG9mIHBzZXVkby1jbGFzcyByZW1vdmU7XG4gICAgICAvLyBpdCdzIGRlZmluZWQgb25seSBpZiByZW1vdmUgaXMgcGFyc2VkIGFzIGxhc3QgdG9rZW5cbiAgICAgIC8vIGFuZCBpdCdzIHZhbGlkIG9ubHkgaWYgcmVtb3ZlIGFyZyBpcyBlbXB0eSBzdHJpbmdcblxuXG4gICAgICB2YXIgcmVtb3ZlUGFydCA9IHRoaXMuZ2V0UmVtb3ZlUGFydCgpO1xuXG4gICAgICBpZiAodHlwZW9mIHJlbW92ZVBhcnQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIHZhciBoYXNWYWxpZFJlbW92ZVBhcnQgPSByZW1vdmVQYXJ0ID09PSAnJztcbiAgICAgICAgcmV0dXJuIG5ldyBSZW1vdmVTZWxlY3RvcihzZWxlY3RvclRleHQsIGhhc1ZhbGlkUmVtb3ZlUGFydCwgZGVidWcpO1xuICAgICAgfVxuXG4gICAgICB0b2tlbnMgPSB0b2tlbnNbMF07XG4gICAgICB2YXIgbCA9IHRva2Vucy5sZW5ndGg7XG4gICAgICB2YXIgbGFzdFJlbFRva2VuSW5kID0gdGhpcy5nZXRTcGxpdFBvaW50KCk7XG5cbiAgICAgIGlmICh0eXBlb2YgbGFzdFJlbFRva2VuSW5kID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3JUZXh0KTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgIHJldHVybiBuZXcgVHJhaXRMZXNzU2VsZWN0b3Ioc2VsZWN0b3JUZXh0LCBkZWJ1Zyk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbmV3IE5vdEFuRXh0ZW5kZWRTZWxlY3RvcihzZWxlY3RvclRleHQsIGRlYnVnKTtcbiAgICAgIH1cblxuICAgICAgdmFyIHNpbXBsZSA9ICcnO1xuICAgICAgdmFyIHJlbGF0aW9uID0gbnVsbDtcbiAgICAgIHZhciBjb21wbGV4ID0gJyc7XG4gICAgICB2YXIgaSA9IDA7XG5cbiAgICAgIGZvciAoOyBpIDwgbGFzdFJlbFRva2VuSW5kOyBpKyspIHtcbiAgICAgICAgLy8gYnVpbGQgc2ltcGxlIHBhcnRcbiAgICAgICAgc2ltcGxlICs9IHRva2Vuc1tpXS52YWx1ZTtcbiAgICAgIH1cblxuICAgICAgaWYgKGkgPiAwKSB7XG4gICAgICAgIC8vIGJ1aWxkIHJlbGF0aW9uIHBhcnRcbiAgICAgICAgcmVsYXRpb24gPSB0b2tlbnNbaSsrXS50eXBlO1xuICAgICAgfSAvLyBpIGlzIHBvaW50aW5nIHRvIHRoZSBzdGFydCBvZiBhIGNvbXBsZXggcGFydC5cblxuXG4gICAgICBmb3IgKDsgaSA8IGw7IGkrKykge1xuICAgICAgICBjb21wbGV4ICs9IHRva2Vuc1tpXS52YWx1ZTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGxhc3RSZWxUb2tlbkluZCA9PT0gLTEgPyBuZXcgVHJhaXRMZXNzU2VsZWN0b3Ioc2VsZWN0b3JUZXh0LCBkZWJ1ZykgOiBuZXcgU3BsaXR0ZWRTZWxlY3RvcihzZWxlY3RvclRleHQsIHNpbXBsZSwgcmVsYXRpb24sIGNvbXBsZXgsIGRlYnVnKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcmV0dXJuIHtudW1iZXJ8dW5kZWZpbmVkfSBBbiBpbmRleCBvZiBhIHRva2VuIHRoYXQgaXMgc3BsaXQgcG9pbnQuXG4gICAgICogcmV0dXJucyB1bmRlZmluZWQgaWYgdGhlIHNlbGVjdG9yIGRvZXMgbm90IGNvbnRhaW4gYW55IGNvbXBsZXggdG9rZW5zXG4gICAgICogb3IgaXQgaXMgbm90IGVsaWdpYmxlIGZvciBzcGxpdHRpbmcuXG4gICAgICogT3RoZXJ3aXNlIHJldHVybnMgYW4gaW50ZWdlciBpbmRpY2F0aW5nIHRoZSBpbmRleCBvZiB0aGUgbGFzdCByZWxhdGlvbiB0b2tlbi5cbiAgICAgKi9cbiAgICBnZXRTcGxpdFBvaW50OiBmdW5jdGlvbiBnZXRTcGxpdFBvaW50KCkge1xuICAgICAgdmFyIHRva2VucyA9IHRoaXMudG9rZW5zWzBdOyAvLyBXZSBzcGxpdCBzZWxlY3RvciBvbmx5IHdoZW4gdGhlIGxhc3QgY29tcG91bmQgc2VsZWN0b3JcbiAgICAgIC8vIGlzIHRoZSBvbmx5IGV4dGVuZGVkIHNlbGVjdG9yLlxuXG4gICAgICB2YXIgbGF0ZXN0UmVsYXRpb25Ub2tlbkluZGV4ID0gLTE7XG4gICAgICB2YXIgaGF2ZU1ldENvbXBsZXhUb2tlbiA9IGZhbHNlO1xuXG4gICAgICBmb3IgKHZhciBpID0gMCwgbCA9IHRva2Vucy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcbiAgICAgICAgdmFyIHRva2VuID0gdG9rZW5zW2ldO1xuXG4gICAgICAgIGlmIChpc1JlbGF0aW9uVG9rZW4odG9rZW4pKSB7XG4gICAgICAgICAgaWYgKGhhdmVNZXRDb21wbGV4VG9rZW4pIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBsYXRlc3RSZWxhdGlvblRva2VuSW5kZXggPSBpO1xuICAgICAgICB9IGVsc2UgaWYgKCFpc1NpbXBsZVRva2VuKHRva2VuKSkge1xuICAgICAgICAgIGhhdmVNZXRDb21wbGV4VG9rZW4gPSB0cnVlO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmICghaGF2ZU1ldENvbXBsZXhUb2tlbikge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBsYXRlc3RSZWxhdGlvblRva2VuSW5kZXg7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHJldHVybiB7c3RyaW5nfHVuZGVmaW5lZH0geHBhdGggc2VsZWN0b3IgcGFydCBpZiBleGlzdHNcbiAgICAgKiByZXR1cm5zIHVuZGVmaW5lZCBpZiB0aGUgc2VsZWN0b3IgZG9lcyBub3QgY29udGFpbiB4cGF0aCB0b2tlbnNcbiAgICAgKi9cbiAgICBnZXRYcGF0aFBhcnQ6IGZ1bmN0aW9uIGdldFhwYXRoUGFydCgpIHtcbiAgICAgIHZhciB0b2tlbnMgPSB0aGlzLnRva2Vuc1swXTtcblxuICAgICAgZm9yICh2YXIgaSA9IDAsIHRva2Vuc0xlbmd0aCA9IHRva2Vucy5sZW5ndGg7IGkgPCB0b2tlbnNMZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgdG9rZW4gPSB0b2tlbnNbaV07XG5cbiAgICAgICAgaWYgKHRva2VuLnR5cGUgPT09ICdQU0VVRE8nKSB7XG4gICAgICAgICAgdmFyIG1hdGNoZXMgPSB0b2tlbi5tYXRjaGVzO1xuXG4gICAgICAgICAgaWYgKG1hdGNoZXMgJiYgbWF0Y2hlcy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICBpZiAobWF0Y2hlc1swXSA9PT0gJ3hwYXRoJykge1xuICAgICAgICAgICAgICBpZiAodGhpcy5pc0xhc3RUb2tlbih0b2tlbnMsIGkpKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHBzZXVkbzogXFwnOnhwYXRoXFwnIHNob3VsZCBiZSBhdCB0aGUgZW5kIG9mIHRoZSBzZWxlY3RvcicpO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoZXNbMV07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChtYXRjaGVzWzBdID09PSAnbnRoLWFuY2VzdG9yJykge1xuICAgICAgICAgICAgICBpZiAodGhpcy5pc0xhc3RUb2tlbih0b2tlbnMsIGkpKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHBzZXVkbzogXFwnOm50aC1hbmNlc3RvclxcJyBzaG91bGQgYmUgYXQgdGhlIGVuZCBvZiB0aGUgc2VsZWN0b3InKTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIHZhciBkZWVwID0gbWF0Y2hlc1sxXTtcblxuICAgICAgICAgICAgICBpZiAoZGVlcCA+IDAgJiYgZGVlcCA8IDI1Nikge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbnZlcnROdGhBbmNlc3RvclRva2VuKGRlZXApO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIGNvbnZlcnRzIG50aC1hbmNlc3Rvci91cHdhcmQgZGVlcCB2YWx1ZSB0byB4cGF0aCBlcXVpdmFsZW50XG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGRlZXBcbiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9XG4gICAgICovXG4gICAgY29udmVydE50aEFuY2VzdG9yVG9rZW46IGZ1bmN0aW9uIGNvbnZlcnROdGhBbmNlc3RvclRva2VuKGRlZXApIHtcbiAgICAgIHZhciByZXN1bHQgPSAnLi4nO1xuXG4gICAgICB3aGlsZSAoZGVlcCA+IDEpIHtcbiAgICAgICAgcmVzdWx0ICs9ICcvLi4nO1xuICAgICAgICBkZWVwLS07XG4gICAgICB9XG5cbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiB0aGUgdG9rZW4gaXMgbGFzdCxcbiAgICAgKiBleGNlcHQgb2YgcmVtb3ZlIHBzZXVkby1jbGFzc1xuICAgICAqIEBwYXJhbSB7QXJyYXl9IHRva2Vuc1xuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBpIGluZGV4IG9mIHRva2VuXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59XG4gICAgICovXG4gICAgaXNMYXN0VG9rZW46IGZ1bmN0aW9uIGlzTGFzdFRva2VuKHRva2VucywgaSkge1xuICAgICAgLy8gY2hlY2sgaWQgdGhlIG5leHQgcGFyc2VkIHRva2VuIGlzIHJlbW92ZSBwc2V1ZG9cbiAgICAgIHZhciBpc05leHRSZW1vdmVUb2tlbiA9IHRva2Vuc1tpICsgMV0gJiYgdG9rZW5zW2kgKyAxXS50eXBlID09PSAnUFNFVURPJyAmJiB0b2tlbnNbaSArIDFdLm1hdGNoZXMgJiYgdG9rZW5zW2kgKyAxXS5tYXRjaGVzWzBdID09PSAncmVtb3ZlJzsgLy8gY2hlY2sgaWYgdGhlIHRva2VuIGlzIGxhc3RcbiAgICAgIC8vIGFuZCBpZiBpdCBpcyBub3QgY2hlY2sgaWYgaXQgaXMgcmVtb3ZlIG9uZVxuICAgICAgLy8gd2hpY2ggc2hvdWxkIGJlIHNraXBwZWRcblxuICAgICAgcmV0dXJuIGkgKyAxICE9PSB0b2tlbnMubGVuZ3RoICYmICFpc05leHRSZW1vdmVUb2tlbjtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcmV0dXJuIHtzdHJpbmd8dW5kZWZpbmVkfSB1cHdhcmQgcGFyYW1ldGVyXG4gICAgICogb3IgdW5kZWZpbmVkIGlmIHRoZSBpbnB1dCBkb2VzIG5vdCBjb250YWluIHVwd2FyZCB0b2tlbnNcbiAgICAgKi9cbiAgICBnZXRVcHdhcmRQYXJ0OiBmdW5jdGlvbiBnZXRVcHdhcmRQYXJ0KCkge1xuICAgICAgdmFyIHRva2VucyA9IHRoaXMudG9rZW5zWzBdO1xuXG4gICAgICBmb3IgKHZhciBpID0gMCwgdG9rZW5zTGVuZ3RoID0gdG9rZW5zLmxlbmd0aDsgaSA8IHRva2Vuc0xlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZhciB0b2tlbiA9IHRva2Vuc1tpXTtcblxuICAgICAgICBpZiAodG9rZW4udHlwZSA9PT0gJ1BTRVVETycpIHtcbiAgICAgICAgICB2YXIgbWF0Y2hlcyA9IHRva2VuLm1hdGNoZXM7XG5cbiAgICAgICAgICBpZiAobWF0Y2hlcyAmJiBtYXRjaGVzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgIGlmIChtYXRjaGVzWzBdID09PSAndXB3YXJkJykge1xuICAgICAgICAgICAgICBpZiAodGhpcy5pc0xhc3RUb2tlbih0b2tlbnMsIGkpKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHBzZXVkbzogXFwnOnVwd2FyZFxcJyBzaG91bGQgYmUgYXQgdGhlIGVuZCBvZiB0aGUgc2VsZWN0b3InKTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIHJldHVybiBtYXRjaGVzWzFdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEByZXR1cm4ge3N0cmluZ3x1bmRlZmluZWR9IHJlbW92ZSBwYXJhbWV0ZXJcbiAgICAgKiBvciB1bmRlZmluZWQgaWYgdGhlIGlucHV0IGRvZXMgbm90IGNvbnRhaW4gcmVtb3ZlIHRva2Vuc1xuICAgICAqL1xuICAgIGdldFJlbW92ZVBhcnQ6IGZ1bmN0aW9uIGdldFJlbW92ZVBhcnQoKSB7XG4gICAgICB2YXIgdG9rZW5zID0gdGhpcy50b2tlbnNbMF07XG5cbiAgICAgIGZvciAodmFyIGkgPSAwLCB0b2tlbnNMZW5ndGggPSB0b2tlbnMubGVuZ3RoOyBpIDwgdG9rZW5zTGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIHRva2VuID0gdG9rZW5zW2ldO1xuXG4gICAgICAgIGlmICh0b2tlbi50eXBlID09PSAnUFNFVURPJykge1xuICAgICAgICAgIHZhciBtYXRjaGVzID0gdG9rZW4ubWF0Y2hlcztcblxuICAgICAgICAgIGlmIChtYXRjaGVzICYmIG1hdGNoZXMubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgaWYgKG1hdGNoZXNbMF0gPT09ICdyZW1vdmUnKSB7XG4gICAgICAgICAgICAgIGlmIChpICsgMSAhPT0gdG9rZW5zTGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHBzZXVkbzogXFwnOnJlbW92ZVxcJyBzaG91bGQgYmUgYXQgdGhlIGVuZCBvZiB0aGUgc2VsZWN0b3InKTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIHJldHVybiBtYXRjaGVzWzFdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgdmFyIGdsb2JhbERlYnVnZ2luZ0ZsYWcgPSBmYWxzZTtcblxuICBmdW5jdGlvbiBpc0RlYnVnZ2luZygpIHtcbiAgICByZXR1cm4gZ2xvYmFsRGVidWdnaW5nRmxhZyB8fCB0aGlzLmRlYnVnO1xuICB9XG4gIC8qKlxuICAgKiBUaGlzIGNsYXNzIHJlcHJlc2VudHMgYSBzZWxlY3RvciB3aGljaCBpcyBub3QgYW4gZXh0ZW5kZWQgc2VsZWN0b3IuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBzZWxlY3RvclRleHRcbiAgICogQHBhcmFtIHtib29sZWFuPX0gZGVidWdcbiAgICogQGZpbmFsXG4gICAqL1xuXG5cbiAgZnVuY3Rpb24gTm90QW5FeHRlbmRlZFNlbGVjdG9yKHNlbGVjdG9yVGV4dCwgZGVidWcpIHtcbiAgICB0aGlzLnNlbGVjdG9yVGV4dCA9IHNlbGVjdG9yVGV4dDtcbiAgICB0aGlzLmRlYnVnID0gZGVidWc7XG4gIH1cblxuICBOb3RBbkV4dGVuZGVkU2VsZWN0b3IucHJvdG90eXBlID0ge1xuICAgIHF1ZXJ5U2VsZWN0b3JBbGw6IGZ1bmN0aW9uIHF1ZXJ5U2VsZWN0b3JBbGwoKSB7XG4gICAgICByZXR1cm4gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCh0aGlzLnNlbGVjdG9yVGV4dCk7XG4gICAgfSxcbiAgICBtYXRjaGVzOiBmdW5jdGlvbiBtYXRjaGVzKGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiBlbGVtZW50W3V0aWxzLm1hdGNoZXNQcm9wZXJ0eU5hbWVdKHRoaXMuc2VsZWN0b3JUZXh0KTtcbiAgICB9LFxuICAgIGlzRGVidWdnaW5nOiBpc0RlYnVnZ2luZ1xuICB9O1xuICAvKipcbiAgICogQSB0cmFpdC1sZXNzIGV4dGVuZGVkIHNlbGVjdG9yIGNsYXNzLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gc2VsZWN0b3JUZXh0XG4gICAqIEBwYXJhbSB7Ym9vbGVhbj19IGRlYnVnXG4gICAqIEBjb25zdHJ1Y3RvclxuICAgKi9cblxuICBmdW5jdGlvbiBUcmFpdExlc3NTZWxlY3RvcihzZWxlY3RvclRleHQsIGRlYnVnKSB7XG4gICAgdGhpcy5zZWxlY3RvclRleHQgPSBzZWxlY3RvclRleHQ7XG4gICAgdGhpcy5kZWJ1ZyA9IGRlYnVnO1xuICAgIFNpenpsZS5jb21waWxlKHNlbGVjdG9yVGV4dCk7XG4gIH1cblxuICBUcmFpdExlc3NTZWxlY3Rvci5wcm90b3R5cGUgPSB7XG4gICAgcXVlcnlTZWxlY3RvckFsbDogZnVuY3Rpb24gcXVlcnlTZWxlY3RvckFsbCgpIHtcbiAgICAgIHJldHVybiBTaXp6bGUodGhpcy5zZWxlY3RvclRleHQpO1xuICAgIH0sXG5cbiAgICAvKiogQGZpbmFsICovXG4gICAgbWF0Y2hlczogZnVuY3Rpb24gbWF0Y2hlcyhlbGVtZW50KSB7XG4gICAgICByZXR1cm4gU2l6emxlLm1hdGNoZXNTZWxlY3RvcihlbGVtZW50LCB0aGlzLnNlbGVjdG9yVGV4dCk7XG4gICAgfSxcblxuICAgIC8qKiBAZmluYWwgKi9cbiAgICBpc0RlYnVnZ2luZzogaXNEZWJ1Z2dpbmdcbiAgfTtcbiAgLyoqXG4gICAqIFBhcmVudGFsIGNsYXNzIGZvciBzdWNoIHBzZXVkby1jbGFzc2VzIGFzIHhwYXRoLCB1cHdhcmQsIHJlbW92ZVxuICAgKiB3aGljaCBhcmUgbGltaXRlZCB0byBiZSB0aGUgbGFzdCBvbmUgdG9rZW4gaW4gc2VsZWN0b3JcbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IHNlbGVjdG9yVGV4dFxuICAgKiBAcGFyYW0ge3N0cmluZ30gcHNldWRvQ2xhc3NBcmcgcHNldWRvLWNsYXNzIGFyZ1xuICAgKiBAcGFyYW0ge2Jvb2xlYW49fSBkZWJ1Z1xuICAgKiBAY29uc3RydWN0b3JcbiAgICovXG5cbiAgZnVuY3Rpb24gQmFzZUxhc3RBcmd1bWVudFNlbGVjdG9yKHNlbGVjdG9yVGV4dCwgcHNldWRvQ2xhc3NBcmcsIGRlYnVnKSB7XG4gICAgdGhpcy5zZWxlY3RvclRleHQgPSBzZWxlY3RvclRleHQ7XG4gICAgdGhpcy5wc2V1ZG9DbGFzc0FyZyA9IHBzZXVkb0NsYXNzQXJnO1xuICAgIHRoaXMuZGVidWcgPSBkZWJ1ZztcbiAgICBTaXp6bGUuY29tcGlsZSh0aGlzLnNlbGVjdG9yVGV4dCk7XG4gIH1cblxuICBCYXNlTGFzdEFyZ3VtZW50U2VsZWN0b3IucHJvdG90eXBlID0ge1xuICAgIHF1ZXJ5U2VsZWN0b3JBbGw6IGZ1bmN0aW9uIHF1ZXJ5U2VsZWN0b3JBbGwoKSB7XG4gICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICB2YXIgcmVzdWx0Tm9kZXMgPSBbXTtcbiAgICAgIHZhciBzaW1wbGVOb2RlcztcblxuICAgICAgaWYgKHRoaXMuc2VsZWN0b3JUZXh0KSB7XG4gICAgICAgIHNpbXBsZU5vZGVzID0gU2l6emxlKHRoaXMuc2VsZWN0b3JUZXh0KTtcblxuICAgICAgICBpZiAoIXNpbXBsZU5vZGVzIHx8ICFzaW1wbGVOb2Rlcy5sZW5ndGgpIHtcbiAgICAgICAgICByZXR1cm4gcmVzdWx0Tm9kZXM7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNpbXBsZU5vZGVzID0gW2RvY3VtZW50XTtcbiAgICAgIH1cblxuICAgICAgc2ltcGxlTm9kZXMuZm9yRWFjaChmdW5jdGlvbiAobm9kZSkge1xuICAgICAgICBfdGhpcy5zZWFyY2hSZXN1bHROb2Rlcyhub2RlLCBfdGhpcy5wc2V1ZG9DbGFzc0FyZywgcmVzdWx0Tm9kZXMpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gU2l6emxlLnVuaXF1ZVNvcnQocmVzdWx0Tm9kZXMpO1xuICAgIH0sXG5cbiAgICAvKiogQGZpbmFsICovXG4gICAgbWF0Y2hlczogZnVuY3Rpb24gbWF0Y2hlcyhlbGVtZW50KSB7XG4gICAgICB2YXIgcmVzdWx0cyA9IHRoaXMucXVlcnlTZWxlY3RvckFsbCgpO1xuICAgICAgcmV0dXJuIHJlc3VsdHMuaW5kZXhPZihlbGVtZW50KSA+IC0xO1xuICAgIH0sXG5cbiAgICAvKiogQGZpbmFsICovXG4gICAgaXNEZWJ1Z2dpbmc6IGlzRGVidWdnaW5nLFxuXG4gICAgLyoqXG4gICAgICogUHJpbWl0aXZlIG1ldGhvZCB0aGF0IHJldHVybnMgYWxsIG5vZGVzIGlmIHBzZXVkby1jbGFzcyBhcmcgaXMgZGVmaW5lZC5cbiAgICAgKiBUaGF0IGxvZ2ljIHdvcmtzIGZvciByZW1vdmUgcHNldWRvLWNsYXNzLFxuICAgICAqIGJ1dCBmb3Igb3RoZXJzIGl0IHNob3VsZCBiZSBvdmVycmlkZGVuLlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBub2RlIGNvbnRleHQgZWxlbWVudFxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBwc2V1ZG9DbGFzc0FyZyBwc2V1ZG8tY2xhc3MgYXJndW1lbnRcbiAgICAgKiBAcGFyYW0ge0FycmF5fSByZXN1bHRcbiAgICAgKi9cbiAgICBzZWFyY2hSZXN1bHROb2RlczogZnVuY3Rpb24gc2VhcmNoUmVzdWx0Tm9kZXMobm9kZSwgcHNldWRvQ2xhc3NBcmcsIHJlc3VsdCkge1xuICAgICAgaWYgKHBzZXVkb0NsYXNzQXJnKSB7XG4gICAgICAgIHJlc3VsdC5wdXNoKG5vZGUpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgLyoqXG4gICAqIFhwYXRoIHNlbGVjdG9yIGNsYXNzXG4gICAqIExpbWl0ZWQgdG8gc3VwcG9ydCAneHBhdGgnIHRvIGJlIG9ubHkgdGhlIGxhc3Qgb25lIHRva2VuIGluIHNlbGVjdG9yXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBzZWxlY3RvclRleHRcbiAgICogQHBhcmFtIHtzdHJpbmd9IHhwYXRoIHZhbHVlXG4gICAqIEBwYXJhbSB7Ym9vbGVhbj19IGRlYnVnXG4gICAqIEBjb25zdHJ1Y3RvclxuICAgKiBAYXVnbWVudHMgQmFzZUxhc3RBcmd1bWVudFNlbGVjdG9yXG4gICAqL1xuXG4gIGZ1bmN0aW9uIFhwYXRoU2VsZWN0b3Ioc2VsZWN0b3JUZXh0LCB4cGF0aCwgZGVidWcpIHtcbiAgICB2YXIgTk9fU0VMRUNUT1JfTUFSS0VSID0gJzp4cGF0aCgvLyc7XG4gICAgdmFyIEJPRFlfU0VMRUNUT1JfUkVQTEFDRVIgPSAnYm9keTp4cGF0aCgvLyc7XG4gICAgdmFyIG1vZGlmaWVkU2VsZWN0b3JUZXh0ID0gc2VsZWN0b3JUZXh0OyAvLyBOb3JtYWxseSwgYSBwc2V1ZG8tY2xhc3MgaXMgYXBwbGllZCB0byBub2RlcyBzZWxlY3RlZCBieSBhIHNlbGVjdG9yIC0tIHNlbGVjdG9yOnhwYXRoKC4uLikuXG4gICAgLy8gSG93ZXZlciwgOnhwYXRoIGlzIHNwZWNpYWwgYXMgdGhlIHNlbGVjdG9yIGNhbiBiZSBvbW1pdGVkLlxuICAgIC8vIEZvciBhbnkgb3RoZXIgcHNldWRvLWNsYXNzIHRoYXQgd291bGQgbWVhbiBcImFwcGx5IHRvIEFMTCBET00gbm9kZXNcIixcbiAgICAvLyBidXQgaW4gY2FzZSBvZiA6eHBhdGggaXQganVzdCBtZWFucyBcImFwcGx5IG1lIHRvIHRoZSBkb2N1bWVudFwiLlxuXG4gICAgaWYgKHV0aWxzLnN0YXJ0c1dpdGgoc2VsZWN0b3JUZXh0LCBOT19TRUxFQ1RPUl9NQVJLRVIpKSB7XG4gICAgICBtb2RpZmllZFNlbGVjdG9yVGV4dCA9IHNlbGVjdG9yVGV4dC5yZXBsYWNlKE5PX1NFTEVDVE9SX01BUktFUiwgQk9EWV9TRUxFQ1RPUl9SRVBMQUNFUik7XG4gICAgfVxuXG4gICAgQmFzZUxhc3RBcmd1bWVudFNlbGVjdG9yLmNhbGwodGhpcywgbW9kaWZpZWRTZWxlY3RvclRleHQsIHhwYXRoLCBkZWJ1Zyk7XG4gIH1cblxuICBYcGF0aFNlbGVjdG9yLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoQmFzZUxhc3RBcmd1bWVudFNlbGVjdG9yLnByb3RvdHlwZSk7XG4gIFhwYXRoU2VsZWN0b3IucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gWHBhdGhTZWxlY3RvcjtcbiAgLyoqXG4gICAqIEFwcGxpZXMgeHBhdGggcHNldWRvLWNsYXNzIHRvIHByb3ZpZGVkIGNvbnRleHQgbm9kZVxuICAgKiBAcGFyYW0ge09iamVjdH0gbm9kZSBjb250ZXh0IGVsZW1lbnRcbiAgICogQHBhcmFtIHtzdHJpbmd9IHBzZXVkb0NsYXNzQXJnIHhwYXRoXG4gICAqIEBwYXJhbSB7QXJyYXl9IHJlc3VsdFxuICAgKiBAb3ZlcnJpZGVcbiAgICovXG5cbiAgWHBhdGhTZWxlY3Rvci5wcm90b3R5cGUuc2VhcmNoUmVzdWx0Tm9kZXMgPSBmdW5jdGlvbiAobm9kZSwgcHNldWRvQ2xhc3NBcmcsIHJlc3VsdCkge1xuICAgIHZhciB4cGF0aFJlc3VsdCA9IGRvY3VtZW50LmV2YWx1YXRlKHBzZXVkb0NsYXNzQXJnLCBub2RlLCBudWxsLCBYUGF0aFJlc3VsdC5VTk9SREVSRURfTk9ERV9JVEVSQVRPUl9UWVBFLCBudWxsKTtcbiAgICB2YXIgaU5vZGU7IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25kLWFzc2lnblxuXG4gICAgd2hpbGUgKGlOb2RlID0geHBhdGhSZXN1bHQuaXRlcmF0ZU5leHQoKSkge1xuICAgICAgcmVzdWx0LnB1c2goaU5vZGUpO1xuICAgIH1cbiAgfTtcbiAgLyoqXG4gICAqIFVwd2FyZCBzZWxlY3RvciBjbGFzc1xuICAgKiBMaW1pdGVkIHRvIHN1cHBvcnQgJ3Vwd2FyZCcgdG8gYmUgb25seSB0aGUgbGFzdCBvbmUgdG9rZW4gaW4gc2VsZWN0b3JcbiAgICogQHBhcmFtIHtzdHJpbmd9IHNlbGVjdG9yVGV4dFxuICAgKiBAcGFyYW0ge3N0cmluZ30gdXB3YXJkU2VsZWN0b3IgdmFsdWVcbiAgICogQHBhcmFtIHtib29sZWFuPX0gZGVidWdcbiAgICogQGNvbnN0cnVjdG9yXG4gICAqIEBhdWdtZW50cyBCYXNlTGFzdEFyZ3VtZW50U2VsZWN0b3JcbiAgICovXG5cblxuICBmdW5jdGlvbiBVcHdhcmRTZWxlY3RvcihzZWxlY3RvclRleHQsIHVwd2FyZFNlbGVjdG9yLCBkZWJ1Zykge1xuICAgIEJhc2VMYXN0QXJndW1lbnRTZWxlY3Rvci5jYWxsKHRoaXMsIHNlbGVjdG9yVGV4dCwgdXB3YXJkU2VsZWN0b3IsIGRlYnVnKTtcbiAgfVxuXG4gIFVwd2FyZFNlbGVjdG9yLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoQmFzZUxhc3RBcmd1bWVudFNlbGVjdG9yLnByb3RvdHlwZSk7XG4gIFVwd2FyZFNlbGVjdG9yLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFVwd2FyZFNlbGVjdG9yO1xuICAvKipcbiAgICogQXBwbGllcyB1cHdhcmQgcHNldWRvLWNsYXNzIHRvIHByb3ZpZGVkIGNvbnRleHQgbm9kZVxuICAgKiBAcGFyYW0ge09iamVjdH0gbm9kZSBjb250ZXh0IGVsZW1lbnRcbiAgICogQHBhcmFtIHtzdHJpbmd9IHVwd2FyZFNlbGVjdG9yIHVwd2FyZCBzZWxlY3RvclxuICAgKiBAcGFyYW0ge0FycmF5fSByZXN1bHRcbiAgICogQG92ZXJyaWRlXG4gICAqL1xuXG4gIFVwd2FyZFNlbGVjdG9yLnByb3RvdHlwZS5zZWFyY2hSZXN1bHROb2RlcyA9IGZ1bmN0aW9uIChub2RlLCB1cHdhcmRTZWxlY3RvciwgcmVzdWx0KSB7XG4gICAgaWYgKHVwd2FyZFNlbGVjdG9yICE9PSAnJykge1xuICAgICAgdmFyIHBhcmVudCA9IG5vZGUucGFyZW50RWxlbWVudDtcblxuICAgICAgaWYgKHBhcmVudCA9PT0gbnVsbCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIG5vZGUgPSBwYXJlbnQuY2xvc2VzdCh1cHdhcmRTZWxlY3Rvcik7XG5cbiAgICAgIGlmIChub2RlID09PSBudWxsKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXN1bHQucHVzaChub2RlKTtcbiAgfTtcbiAgLyoqXG4gICAqIFJlbW92ZSBzZWxlY3RvciBjbGFzc1xuICAgKiBMaW1pdGVkIHRvIHN1cHBvcnQgJ3JlbW92ZScgdG8gYmUgb25seSB0aGUgbGFzdCBvbmUgdG9rZW4gaW4gc2VsZWN0b3JcbiAgICogQHBhcmFtIHtzdHJpbmd9IHNlbGVjdG9yVGV4dFxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IGhhc1ZhbGlkUmVtb3ZlUGFydFxuICAgKiBAcGFyYW0ge2Jvb2xlYW49fSBkZWJ1Z1xuICAgKiBAY29uc3RydWN0b3JcbiAgICogQGF1Z21lbnRzIEJhc2VMYXN0QXJndW1lbnRTZWxlY3RvclxuICAgKi9cblxuXG4gIGZ1bmN0aW9uIFJlbW92ZVNlbGVjdG9yKHNlbGVjdG9yVGV4dCwgaGFzVmFsaWRSZW1vdmVQYXJ0LCBkZWJ1Zykge1xuICAgIHZhciBSRU1PVkVfUFNFVURPX01BUktFUiA9ICc6cmVtb3ZlKCknO1xuICAgIHZhciByZW1vdmVNYXJrZXJJbmRleCA9IHNlbGVjdG9yVGV4dC5pbmRleE9mKFJFTU9WRV9QU0VVRE9fTUFSS0VSKTsgLy8gZGVsZXRpbmcgcmVtb3ZlIHBhcnQgb2YgcnVsZSBpbnN0ZWFkIG9mIHdoaWNoXG4gICAgLy8gcHNldWRvLXByb3BlcnR5IHByb3BlcnR5ICdyZW1vdmUnIHdpbGwgYmUgYWRkZWQgYnkgRXh0ZW5kZWRDc3NQYXJzZXJcblxuICAgIHZhciBtb2RpZmllZFNlbGVjdG9yVGV4dCA9IHNlbGVjdG9yVGV4dC5zbGljZSgwLCByZW1vdmVNYXJrZXJJbmRleCk7XG4gICAgQmFzZUxhc3RBcmd1bWVudFNlbGVjdG9yLmNhbGwodGhpcywgbW9kaWZpZWRTZWxlY3RvclRleHQsIGhhc1ZhbGlkUmVtb3ZlUGFydCwgZGVidWcpOyAvLyBtYXJrIGV4dGVuZGVkU2VsZWN0b3IgYXMgUmVtb3ZlIG9uZSBmb3IgRXh0ZW5kZWRDc3NQYXJzZXJcblxuICAgIHRoaXMuaXNSZW1vdmVTZWxlY3RvciA9IHRydWU7XG4gIH1cblxuICBSZW1vdmVTZWxlY3Rvci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEJhc2VMYXN0QXJndW1lbnRTZWxlY3Rvci5wcm90b3R5cGUpO1xuICBSZW1vdmVTZWxlY3Rvci5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBSZW1vdmVTZWxlY3RvcjtcbiAgLyoqXG4gICAqIEEgc3BsaXR0ZWQgZXh0ZW5kZWQgc2VsZWN0b3IgY2xhc3MuXG4gICAqXG4gICAqICNjb250YWluZXIgI2ZlZWRJdGVtOmhhcyguYWRzKVxuICAgKiArLS0tLS0tLS0rICAgICAgICAgICAgICAgICAgICAgc2ltcGxlXG4gICAqICAgICAgICAgICArICAgICAgICAgICAgICAgICAgICByZWxhdGlvblxuICAgKiAgICAgICAgICAgICstLS0tLS0tLS0tLS0tLS0tLSsgY29tcGxleFxuICAgKiBXZSBzcGxpdCBzZWxlY3RvciBvbmx5IHdoZW4gdGhlIGxhc3Qgc2VsZWN0b3IgaXMgY29tcGxleFxuICAgKiBAcGFyYW0ge3N0cmluZ30gc2VsZWN0b3JUZXh0XG4gICAqIEBwYXJhbSB7c3RyaW5nfSBzaW1wbGVcbiAgICogQHBhcmFtIHtzdHJpbmd9IHJlbGF0aW9uXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBjb21wbGV4XG4gICAqIEBwYXJhbSB7Ym9vbGVhbj19IGRlYnVnXG4gICAqIEBjb25zdHJ1Y3RvclxuICAgKiBAZXh0ZW5kcyBUcmFpdExlc3NTZWxlY3RvclxuICAgKi9cblxuICBmdW5jdGlvbiBTcGxpdHRlZFNlbGVjdG9yKHNlbGVjdG9yVGV4dCwgc2ltcGxlLCByZWxhdGlvbiwgY29tcGxleCwgZGVidWcpIHtcbiAgICBUcmFpdExlc3NTZWxlY3Rvci5jYWxsKHRoaXMsIHNlbGVjdG9yVGV4dCwgZGVidWcpO1xuICAgIHRoaXMuc2ltcGxlID0gc2ltcGxlO1xuICAgIHRoaXMucmVsYXRpb24gPSByZWxhdGlvbjtcbiAgICB0aGlzLmNvbXBsZXggPSBjb21wbGV4O1xuICAgIFNpenpsZS5jb21waWxlKGNvbXBsZXgpO1xuICB9XG5cbiAgU3BsaXR0ZWRTZWxlY3Rvci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKFRyYWl0TGVzc1NlbGVjdG9yLnByb3RvdHlwZSk7XG4gIFNwbGl0dGVkU2VsZWN0b3IucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gU3BsaXR0ZWRTZWxlY3RvcjtcbiAgLyoqIEBvdmVycmlkZSAqL1xuXG4gIFNwbGl0dGVkU2VsZWN0b3IucHJvdG90eXBlLnF1ZXJ5U2VsZWN0b3JBbGwgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIF90aGlzMiA9IHRoaXM7XG5cbiAgICB2YXIgcmVzdWx0Tm9kZXMgPSBbXTtcbiAgICB2YXIgc2ltcGxlTm9kZXM7XG4gICAgdmFyIHNpbXBsZSA9IHRoaXMuc2ltcGxlO1xuICAgIHZhciByZWxhdGlvbjtcblxuICAgIGlmIChzaW1wbGUpIHtcbiAgICAgIC8vIEZpcnN0IHdlIHVzZSBzaW1wbGUgc2VsZWN0b3IgdG8gbmFycm93IG91ciBzZWFyY2hcbiAgICAgIHNpbXBsZU5vZGVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzaW1wbGUpO1xuXG4gICAgICBpZiAoIXNpbXBsZU5vZGVzIHx8ICFzaW1wbGVOb2Rlcy5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIHJlc3VsdE5vZGVzO1xuICAgICAgfVxuXG4gICAgICByZWxhdGlvbiA9IHRoaXMucmVsYXRpb247XG4gICAgfSBlbHNlIHtcbiAgICAgIHNpbXBsZU5vZGVzID0gW2RvY3VtZW50XTtcbiAgICAgIHJlbGF0aW9uID0gJyAnO1xuICAgIH1cblxuICAgIHN3aXRjaCAocmVsYXRpb24pIHtcbiAgICAgIGNhc2UgJyAnOlxuICAgICAgICBzaW1wbGVOb2Rlcy5mb3JFYWNoKGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgICAgX3RoaXMyLnJlbGF0aXZlU2VhcmNoKG5vZGUsIHJlc3VsdE5vZGVzKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlICc+JzpcbiAgICAgICAge1xuICAgICAgICAgIHNpbXBsZU5vZGVzLmZvckVhY2goZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgICAgICAgIE9iamVjdC52YWx1ZXMobm9kZS5jaGlsZHJlbikuZm9yRWFjaChmdW5jdGlvbiAoY2hpbGROb2RlKSB7XG4gICAgICAgICAgICAgIGlmIChfdGhpczIubWF0Y2hlcyhjaGlsZE5vZGUpKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0Tm9kZXMucHVzaChjaGlsZE5vZGUpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICBjYXNlICcrJzpcbiAgICAgICAge1xuICAgICAgICAgIHNpbXBsZU5vZGVzLmZvckVhY2goZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgICAgICAgIHZhciBwYXJlbnROb2RlID0gbm9kZS5wYXJlbnROb2RlO1xuICAgICAgICAgICAgT2JqZWN0LnZhbHVlcyhwYXJlbnROb2RlLmNoaWxkcmVuKS5mb3JFYWNoKGZ1bmN0aW9uIChjaGlsZE5vZGUpIHtcbiAgICAgICAgICAgICAgaWYgKF90aGlzMi5tYXRjaGVzKGNoaWxkTm9kZSkgJiYgY2hpbGROb2RlLnByZXZpb3VzRWxlbWVudFNpYmxpbmcgPT09IG5vZGUpIHtcbiAgICAgICAgICAgICAgICByZXN1bHROb2Rlcy5wdXNoKGNoaWxkTm9kZSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgIGNhc2UgJ34nOlxuICAgICAgICB7XG4gICAgICAgICAgc2ltcGxlTm9kZXMuZm9yRWFjaChmdW5jdGlvbiAobm9kZSkge1xuICAgICAgICAgICAgdmFyIHBhcmVudE5vZGUgPSBub2RlLnBhcmVudE5vZGU7XG4gICAgICAgICAgICBPYmplY3QudmFsdWVzKHBhcmVudE5vZGUuY2hpbGRyZW4pLmZvckVhY2goZnVuY3Rpb24gKGNoaWxkTm9kZSkge1xuICAgICAgICAgICAgICBpZiAoX3RoaXMyLm1hdGNoZXMoY2hpbGROb2RlKSAmJiBub2RlLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKGNoaWxkTm9kZSkgPT09IDQpIHtcbiAgICAgICAgICAgICAgICByZXN1bHROb2Rlcy5wdXNoKGNoaWxkTm9kZSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIFNpenpsZS51bmlxdWVTb3J0KHJlc3VsdE5vZGVzKTtcbiAgfTtcbiAgLyoqXG4gICAqIFBlcmZvcm1zIGEgc2VhcmNoIG9mIFwiY29tcGxleFwiIHBhcnQgcmVsYXRpdmUgdG8gcmVzdWx0cyBmb3IgdGhlIFwic2ltcGxlXCIgcGFydC5cbiAgICogQHBhcmFtIHtOb2RlfSBub2RlIGEgbm9kZSBtYXRjaGluZyB0aGUgXCJzaW1wbGVcIiBwYXJ0LlxuICAgKiBAcGFyYW0ge05vZGVbXX0gcmVzdWx0IGFuIGFycmF5IHRvIGFwcGVuZCBzZWFyY2ggcmVzdWx0LlxuICAgKi9cblxuXG4gIFNwbGl0dGVkU2VsZWN0b3IucHJvdG90eXBlLnJlbGF0aXZlU2VhcmNoID0gZnVuY3Rpb24gKG5vZGUsIHJlc3VsdHMpIHtcbiAgICBTaXp6bGUodGhpcy5jb21wbGV4LCBub2RlLCByZXN1bHRzKTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIC8qKlxuICAgICAqIFdyYXBzIHRoZSBpbm5lciBjbGFzcyBzbyB0aGF0IHRoZSBpbnN0YW5jZSBpcyBub3QgZXhwb3NlZC5cbiAgICAgKi9cbiAgICBjcmVhdGVTZWxlY3RvcjogZnVuY3Rpb24gY3JlYXRlU2VsZWN0b3Ioc2VsZWN0b3IsIHRva2VucywgZGVidWcpIHtcbiAgICAgIHJldHVybiBuZXcgRXh0ZW5kZWRTZWxlY3RvclBhcnNlcihzZWxlY3RvciwgdG9rZW5zLCBkZWJ1ZykuY3JlYXRlU2VsZWN0b3IoKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogTWFyayBldmVyeSBzZWxlY3RvciBhcyBhIHNlbGVjdG9yIGJlaW5nIGRlYnVnZ2VkLCBzbyB0aGF0IHRpbWluZyBpbmZvcm1hdGlvblxuICAgICAqIGZvciB0aGUgc2VsZWN0b3IgaXMgcHJpbnRlZCB0byB0aGUgY29uc29sZS5cbiAgICAgKi9cbiAgICBlbmFibGVHbG9iYWxEZWJ1Z2dpbmc6IGZ1bmN0aW9uIGVuYWJsZUdsb2JhbERlYnVnZ2luZygpIHtcbiAgICAgIGdsb2JhbERlYnVnZ2luZ0ZsYWcgPSB0cnVlO1xuICAgIH1cbiAgfTtcbn0oKTtcblxuLyoqXG4gKiBDb3B5cmlnaHQgMjAxNiBBZGd1YXJkIFNvZnR3YXJlIEx0ZFxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEEgaGVscGVyIGNsYXNzIHRoYXQgcGFyc2VzIHN0eWxlc2hlZXRzIGNvbnRhaW5pbmcgZXh0ZW5kZWQgc2VsZWN0b3JzXG4gKiBpbnRvIEV4dGVuZGVkU2VsZWN0b3IgaW5zdGFuY2VzIGFuZCBrZXktdmFsdWUgbWFwcyBvZiBzdHlsZSBkZWNsYXJhdGlvbnMuXG4gKiBQbGVhc2Ugbm90ZSwgdGhhdCBpdCBkb2VzIG5vdCBzdXBwb3J0IGFueSBjb21wbGV4IHRoaW5ncyBsaWtlIG1lZGlhIHF1ZXJpZXMgYW5kIHN1Y2guXG4gKi9cblxudmFyIEV4dGVuZGVkQ3NzUGFyc2VyID0gZnVuY3Rpb24gKCkge1xuICB2YXIgcmVEZWNsRW5kID0gL1s7fV0vZztcbiAgdmFyIHJlRGVjbERpdmlkZXIgPSAvWzs6fV0vZztcbiAgdmFyIHJlTm9uV2hpdGVzcGFjZSA9IC9cXFMvZztcbiAgdmFyIFNpenpsZTtcbiAgLyoqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBjc3NUZXh0XG4gICAqIEBjb25zdHJ1Y3RvclxuICAgKi9cblxuICBmdW5jdGlvbiBQYXJzZXIoY3NzVGV4dCkge1xuICAgIHRoaXMuY3NzVGV4dCA9IGNzc1RleHQ7XG4gIH1cblxuICBQYXJzZXIucHJvdG90eXBlID0ge1xuICAgIGVycm9yOiBmdW5jdGlvbiBlcnJvcihwb3NpdGlvbikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ3NzUGFyc2VyOiBwYXJzZSBlcnJvciBhdCBwb3NpdGlvbiBcIi5jb25jYXQodGhpcy5wb3NPZmZzZXQgKyBwb3NpdGlvbikpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBWYWxpZGF0ZXMgdGhhdCB0aGUgdG9rZW5zIGNvcnJlc3BvbmQgdG8gYSB2YWxpZCBzZWxlY3Rvci5cbiAgICAgKiBTaXp6bGUgaXMgZGlmZmVyZW50IGZyb20gYnJvd3NlcnMgYW5kIHNvbWUgc2VsZWN0b3JzIHRoYXQgaXQgdG9sZXJhdGVzIGFyZW4ndCBhY3R1YWxseSB2YWxpZC5cbiAgICAgKiBGb3IgaW5zdGFuY2UsIFwiZGl2ID5cIiB3b24ndCB3b3JrIGluIGEgYnJvd3NlciwgYnV0IGl0IHdpbGwgaW4gU2l6emxlIChpdCdkIGJlIHRoZSBzYW1lIGFzIFwiZGl2ID4gKlwiKS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7Kn0gc2VsZWN0b3JzIEFuIGFycmF5IG9mIFNlbGVjdG9yRGF0YSAoc2VsZWN0b3IsIGdyb3VwcylcbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gZmFsc2UgaWYgYW55IG9mIHRoZSBncm91cHMgYXJlIGludmFsaWRcbiAgICAgKi9cbiAgICB2YWxpZGF0ZVNlbGVjdG9yczogZnVuY3Rpb24gdmFsaWRhdGVTZWxlY3RvcnMoc2VsZWN0b3JzKSB7XG4gICAgICB2YXIgaVNlbGVjdG9ycyA9IHNlbGVjdG9ycy5sZW5ndGg7XG5cbiAgICAgIHdoaWxlIChpU2VsZWN0b3JzLS0pIHtcbiAgICAgICAgdmFyIGdyb3VwcyA9IHNlbGVjdG9yc1tpU2VsZWN0b3JzXS5ncm91cHM7XG4gICAgICAgIHZhciBpR3JvdXBzID0gZ3JvdXBzLmxlbmd0aDtcblxuICAgICAgICB3aGlsZSAoaUdyb3Vwcy0tKSB7XG4gICAgICAgICAgdmFyIHRva2VucyA9IGdyb3Vwc1tpR3JvdXBzXTtcbiAgICAgICAgICB2YXIgbGFzdFRva2VuID0gdG9rZW5zW3Rva2Vucy5sZW5ndGggLSAxXTtcblxuICAgICAgICAgIGlmIChTaXp6bGUuc2VsZWN0b3JzLnJlbGF0aXZlW2xhc3RUb2tlbi50eXBlXSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogUGFyc2VzIGEgc3R5bGVzaGVldCBhbmQgcmV0dXJucyBhIGxpc3Qgb2YgcGFpcnMgb2YgYW4gRXh0ZW5kZWRTZWxlY3RvciBhbmQgYSBzdHlsZXMgbWFwLlxuICAgICAqIFRoaXMgbWV0aG9kIHdpbGwgdGhyb3cgYW4gZXJyb3IgaW4gY2FzZSBvZiBhbiBvYnZpb3VzbHkgaW52YWxpZCBpbnB1dC5cbiAgICAgKiBJZiBhbnkgb2YgdGhlIHNlbGVjdG9ycyB1c2VkIGluIHRoZSBzdHlsZXNoZWV0IGNhbm5vdCBiZSBjb21waWxlZCBpbnRvIGFuIEV4dGVuZGVkU2VsZWN0b3IsXG4gICAgICogaXQgd2lsbCBiZSBpZ25vcmVkLlxuICAgICAqXG4gICAgICogQHR5cGVkZWYge09iamVjdH0gRXh0ZW5kZWRTdHlsZVxuICAgICAqIEBwcm9wZXJ0eSB7T2JqZWN0fSBzZWxlY3RvciBBbiBpbnN0YW5jZSBvZiB0aGUge0BsaW5rIEV4dGVuZGVkU2VsZWN0b3J9IGNsYXNzXG4gICAgICogQHByb3BlcnR5IHtPYmplY3R9IHN0eWxlTWFwIEEgbWFwIG9mIHN0eWxlcyBwYXJzZWRcbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtBcnJheS48RXh0ZW5kZWRTdHlsZT59IEFuIGFycmF5IG9mIHRoZSBzdHlsZXMgcGFyc2VkXG4gICAgICovXG4gICAgcGFyc2VDc3M6IGZ1bmN0aW9uIHBhcnNlQ3NzKCkge1xuICAgICAgdGhpcy5wb3NPZmZzZXQgPSAwO1xuXG4gICAgICBpZiAoIXRoaXMuY3NzVGV4dCkge1xuICAgICAgICB0aGlzLmVycm9yKDApO1xuICAgICAgfVxuXG4gICAgICB2YXIgcmVzdWx0cyA9IFtdO1xuXG4gICAgICB3aGlsZSAodGhpcy5jc3NUZXh0KSB7XG4gICAgICAgIC8vIEFwcGx5IHRvbGVyYW50IHRva2VuaXphdGlvbi5cbiAgICAgICAgdmFyIHBhcnNlUmVzdWx0ID0gU2l6emxlLnRva2VuaXplKHRoaXMuY3NzVGV4dCwgZmFsc2UsIHtcbiAgICAgICAgICB0b2xlcmFudDogdHJ1ZSxcbiAgICAgICAgICByZXR1cm5VbnNvcnRlZDogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgICAgdmFyIHNlbGVjdG9yRGF0YSA9IHBhcnNlUmVzdWx0LnNlbGVjdG9ycztcbiAgICAgICAgdGhpcy5uZXh0SW5kZXggPSBwYXJzZVJlc3VsdC5uZXh0SW5kZXg7XG5cbiAgICAgICAgaWYgKHRoaXMuY3NzVGV4dC5jaGFyQ29kZUF0KHRoaXMubmV4dEluZGV4KSAhPT0gMTIzIHx8XG4gICAgICAgIC8qIGNoYXJDb2RlIG9mICd7JyAqL1xuICAgICAgICAhdGhpcy52YWxpZGF0ZVNlbGVjdG9ycyhzZWxlY3RvckRhdGEpKSB7XG4gICAgICAgICAgdGhpcy5lcnJvcih0aGlzLm5leHRJbmRleCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLm5leHRJbmRleCsrOyAvLyBNb3ZlIHRoZSBwb2ludGVyIHRvIHRoZSBzdGFydCBvZiBzdHlsZSBkZWNsYXJhdGlvbi5cblxuICAgICAgICB2YXIgc3R5bGVNYXAgPSB0aGlzLnBhcnNlTmV4dFN0eWxlKCk7XG4gICAgICAgIHZhciBkZWJ1ZyA9IGZhbHNlOyAvLyBJZiB0aGVyZSBpcyBhIHN0eWxlIHByb3BlcnR5ICdkZWJ1ZycsIG1hcmsgdGhlIHNlbGVjdG9yXG4gICAgICAgIC8vIGFzIGEgZGVidWdnYWJsZSBzZWxlY3RvciwgYW5kIGRlbGV0ZSB0aGUgc3R5bGUgZGVjbGFyYXRpb24uXG5cbiAgICAgICAgdmFyIGRlYnVnUHJvcGVydHlWYWx1ZSA9IHN0eWxlTWFwWydkZWJ1ZyddO1xuXG4gICAgICAgIGlmICh0eXBlb2YgZGVidWdQcm9wZXJ0eVZhbHVlICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgIGlmIChkZWJ1Z1Byb3BlcnR5VmFsdWUgPT09ICdnbG9iYWwnKSB7XG4gICAgICAgICAgICBFeHRlbmRlZFNlbGVjdG9yRmFjdG9yeS5lbmFibGVHbG9iYWxEZWJ1Z2dpbmcoKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBkZWJ1ZyA9IHRydWU7XG4gICAgICAgICAgZGVsZXRlIHN0eWxlTWFwWydkZWJ1ZyddO1xuICAgICAgICB9IC8vIENyZWF0aW5nIGFuIEV4dGVuZGVkU2VsZWN0b3IgaW5zdGFuY2UgZm9yIGV2ZXJ5IHNlbGVjdG9yIHdlIGdvdCBmcm9tIFNpenpsZS50b2tlbml6ZS5cbiAgICAgICAgLy8gVGhpcyBpcyBxdWl0ZSBpbXBvcnRhbnQgYXMgU2l6emxlIGRvZXMgYSBwb29yIGpvYiBhdCBleGVjdXRpbmcgc2VsZWN0b3JzIGxpa2UgXCJzZWxlY3RvcjEsIHNlbGVjdG9yMlwiLlxuXG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBzZWxlY3RvckRhdGEubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG4gICAgICAgICAgdmFyIGRhdGEgPSBzZWxlY3RvckRhdGFbaV07XG5cbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgdmFyIGV4dGVuZGVkU2VsZWN0b3IgPSBFeHRlbmRlZFNlbGVjdG9yRmFjdG9yeS5jcmVhdGVTZWxlY3RvcihkYXRhLnNlbGVjdG9yVGV4dCwgZGF0YS5ncm91cHMsIGRlYnVnKTtcblxuICAgICAgICAgICAgaWYgKGV4dGVuZGVkU2VsZWN0b3IucHNldWRvQ2xhc3NBcmcgJiYgZXh0ZW5kZWRTZWxlY3Rvci5pc1JlbW92ZVNlbGVjdG9yKSB7XG4gICAgICAgICAgICAgIC8vIGlmIHRoZXJlIGlzIHJlbW92ZSBwc2V1ZG8tY2xhc3MgaW4gcnVsZSxcbiAgICAgICAgICAgICAgLy8gdGhlIGVsZW1lbnQgd2lsbCBiZSByZW1vdmVkIGFuZCBubyBvdGhlciBzdHlsZXMgd2lsbCBiZSBhcHBsaWVkXG4gICAgICAgICAgICAgIHN0eWxlTWFwWydyZW1vdmUnXSA9ICd0cnVlJztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmVzdWx0cy5wdXNoKHtcbiAgICAgICAgICAgICAgc2VsZWN0b3I6IGV4dGVuZGVkU2VsZWN0b3IsXG4gICAgICAgICAgICAgIHN0eWxlOiBzdHlsZU1hcFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSBjYXRjaCAoZXgpIHtcbiAgICAgICAgICAgIHV0aWxzLmxvZ0Vycm9yKFwiRXh0ZW5kZWRDc3NQYXJzZXI6IGlnbm9yaW5nIGludmFsaWQgc2VsZWN0b3IgXCIuY29uY2F0KGRhdGEuc2VsZWN0b3JUZXh0KSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiByZXN1bHRzO1xuICAgIH0sXG4gICAgcGFyc2VOZXh0U3R5bGU6IGZ1bmN0aW9uIHBhcnNlTmV4dFN0eWxlKCkge1xuICAgICAgdmFyIHN0eWxlTWFwID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICAgIHZhciBicmFja2V0UG9zID0gdGhpcy5wYXJzZVVudGlsQ2xvc2luZ0JyYWNrZXQoc3R5bGVNYXApOyAvLyBDdXQgb3V0IG1hdGNoZWQgcG9ydGlvbiBmcm9tIGNzc1RleHQuXG5cbiAgICAgIHJlTm9uV2hpdGVzcGFjZS5sYXN0SW5kZXggPSBicmFja2V0UG9zICsgMTtcbiAgICAgIHZhciBtYXRjaCA9IHJlTm9uV2hpdGVzcGFjZS5leGVjKHRoaXMuY3NzVGV4dCk7XG5cbiAgICAgIGlmIChtYXRjaCA9PT0gbnVsbCkge1xuICAgICAgICB0aGlzLmNzc1RleHQgPSAnJztcbiAgICAgICAgcmV0dXJuIHN0eWxlTWFwO1xuICAgICAgfVxuXG4gICAgICB2YXIgbWF0Y2hQb3MgPSBtYXRjaC5pbmRleDtcbiAgICAgIHRoaXMuY3NzVGV4dCA9IHRoaXMuY3NzVGV4dC5zbGljZShtYXRjaFBvcyk7XG4gICAgICB0aGlzLnBvc09mZnNldCArPSBtYXRjaFBvcztcbiAgICAgIHJldHVybiBzdHlsZU1hcDtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQHJldHVybiB7bnVtYmVyfSBhbiBpbmRleCBvZiB0aGUgbmV4dCAnfScgaW4gYHRoaXMuY3NzVGV4dGAuXG4gICAgICovXG4gICAgcGFyc2VVbnRpbENsb3NpbmdCcmFja2V0OiBmdW5jdGlvbiBwYXJzZVVudGlsQ2xvc2luZ0JyYWNrZXQoc3R5bGVNYXApIHtcbiAgICAgIC8vIEV4cGVjdHMgXCI6XCIsIFwiO1wiLCBhbmQgXCJ9XCIuXG4gICAgICByZURlY2xEaXZpZGVyLmxhc3RJbmRleCA9IHRoaXMubmV4dEluZGV4O1xuICAgICAgdmFyIG1hdGNoID0gcmVEZWNsRGl2aWRlci5leGVjKHRoaXMuY3NzVGV4dCk7XG5cbiAgICAgIGlmIChtYXRjaCA9PT0gbnVsbCkge1xuICAgICAgICB0aGlzLmVycm9yKHRoaXMubmV4dEluZGV4KTtcbiAgICAgIH1cblxuICAgICAgdmFyIG1hdGNoUG9zID0gbWF0Y2guaW5kZXg7XG4gICAgICB2YXIgbWF0Y2hlZCA9IG1hdGNoWzBdO1xuXG4gICAgICBpZiAobWF0Y2hlZCA9PT0gJ30nKSB7XG4gICAgICAgIHJldHVybiBtYXRjaFBvcztcbiAgICAgIH1cblxuICAgICAgaWYgKG1hdGNoZWQgPT09ICc6Jykge1xuICAgICAgICB2YXIgY29sb25JbmRleCA9IG1hdGNoUG9zOyAvLyBFeHBlY3RzIFwiO1wiIGFuZCBcIn1cIi5cblxuICAgICAgICByZURlY2xFbmQubGFzdEluZGV4ID0gY29sb25JbmRleDtcbiAgICAgICAgbWF0Y2ggPSByZURlY2xFbmQuZXhlYyh0aGlzLmNzc1RleHQpO1xuXG4gICAgICAgIGlmIChtYXRjaCA9PT0gbnVsbCkge1xuICAgICAgICAgIHRoaXMuZXJyb3IoY29sb25JbmRleCk7XG4gICAgICAgIH1cblxuICAgICAgICBtYXRjaFBvcyA9IG1hdGNoLmluZGV4O1xuICAgICAgICBtYXRjaGVkID0gbWF0Y2hbMF07IC8vIFBvcHVsYXRlcyB0aGUgYHN0eWxlTWFwYCBrZXktdmFsdWUgbWFwLlxuXG4gICAgICAgIHZhciBwcm9wZXJ0eSA9IHRoaXMuY3NzVGV4dC5zbGljZSh0aGlzLm5leHRJbmRleCwgY29sb25JbmRleCkudHJpbSgpO1xuICAgICAgICB2YXIgdmFsdWUgPSB0aGlzLmNzc1RleHQuc2xpY2UoY29sb25JbmRleCArIDEsIG1hdGNoUG9zKS50cmltKCk7XG4gICAgICAgIHN0eWxlTWFwW3Byb3BlcnR5XSA9IHZhbHVlOyAvLyBJZiBmb3VuZCBcIn1cIiwgcmUtcnVuIHRoZSBvdXRlciBsb29wLlxuXG4gICAgICAgIGlmIChtYXRjaGVkID09PSAnfScpIHtcbiAgICAgICAgICByZXR1cm4gbWF0Y2hQb3M7XG4gICAgICAgIH1cbiAgICAgIH0gLy8gbWF0Y2hQb3MgaXMgdGhlIHBvc2l0aW9uIG9mIHRoZSBuZXh0ICc7Jy5cbiAgICAgIC8vIEluY3JlYXNlICduZXh0SW5kZXgnIGFuZCByZS1ydW4gdGhlIGxvb3AuXG5cblxuICAgICAgdGhpcy5uZXh0SW5kZXggPSBtYXRjaFBvcyArIDE7XG4gICAgICByZXR1cm4gdGhpcy5wYXJzZVVudGlsQ2xvc2luZ0JyYWNrZXQoc3R5bGVNYXApOyAvLyBTaG91bGQgYmUgYSBzdWJqZWN0IG9mIHRhaWwtY2FsbCBvcHRpbWl6YXRpb24uXG4gICAgfVxuICB9O1xuICByZXR1cm4ge1xuICAgIHBhcnNlQ3NzOiBmdW5jdGlvbiBwYXJzZUNzcyhjc3NUZXh0KSB7XG4gICAgICBTaXp6bGUgPSBpbml0aWFsaXplU2l6emxlKCk7XG4gICAgICByZXR1cm4gbmV3IFBhcnNlcihjc3NVdGlscy5ub3JtYWxpemUoY3NzVGV4dCkpLnBhcnNlQ3NzKCk7XG4gICAgfVxuICB9O1xufSgpO1xuXG4vKipcbiAqIFRoaXMgY2FsbGJhY2sgaXMgdXNlZCB0byBnZXQgYWZmZWN0ZWQgbm9kZSBlbGVtZW50cyBhbmQgaGFuZGxlIHN0eWxlIHByb3BlcnRpZXNcbiAqIGJlZm9yZSB0aGV5IGFyZSBhcHBsaWVkIHRvIHRoZW0gaWYgaXQgaXMgbmVjZXNzYXJ5XG4gKiBAY2FsbGJhY2sgYmVmb3JlU3R5bGVBcHBsaWVkXG4gKiBAcGFyYW0ge29iamVjdH0gYWZmZWN0ZWRFbGVtZW50IC0gT2JqZWN0IGNvbnRhaW5pbmcgRE9NIG5vZGUgYW5kIHJ1bGUgdG8gYmUgYXBwbGllZFxuICogQHJldHVybiB7b2JqZWN0fSBhZmZlY3RlZEVsZW1lbnQgLSBTYW1lIG9yIG1vZGlmaWVkIG9iamVjdCBjb250YWluaW5nIERPTSBub2RlIGFuZCBydWxlIHRvIGJlIGFwcGxpZWRcbiAqL1xuXG4vKipcbiAqIEV4dGVuZGVkIGNzcyBjbGFzc1xuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWd1cmF0aW9uXG4gKiBAcGFyYW0ge3N0cmluZ30gY29uZmlndXJhdGlvbi5zdHlsZVNoZWV0IC0gdGhlIENTUyBzdHlsZXNoZWV0IHRleHRcbiAqIEBwYXJhbSB7YmVmb3JlU3R5bGVBcHBsaWVkfSBbY29uZmlndXJhdGlvbi5iZWZvcmVTdHlsZUFwcGxpZWRdIC0gdGhlIGNhbGxiYWNrIHRoYXQgaGFuZGxlcyBhZmZlY3RlZCBlbGVtZW50c1xuICogQGNvbnN0cnVjdG9yXG4gKi9cblxuZnVuY3Rpb24gRXh0ZW5kZWRDc3MoY29uZmlndXJhdGlvbikge1xuICBpZiAoIWNvbmZpZ3VyYXRpb24pIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0NvbmZpZ3VyYXRpb24gaXMgbm90IHByb3ZpZGVkLicpO1xuICB9XG5cbiAgdmFyIHN0eWxlU2hlZXQgPSBjb25maWd1cmF0aW9uLnN0eWxlU2hlZXQ7XG4gIHZhciBiZWZvcmVTdHlsZUFwcGxpZWQgPSBjb25maWd1cmF0aW9uLmJlZm9yZVN0eWxlQXBwbGllZDtcblxuICBpZiAoYmVmb3JlU3R5bGVBcHBsaWVkICYmIHR5cGVvZiBiZWZvcmVTdHlsZUFwcGxpZWQgIT09ICdmdW5jdGlvbicpIHtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LWxlblxuICAgIHRocm93IG5ldyBFcnJvcihcIldyb25nIGNvbmZpZ3VyYXRpb24uIFR5cGUgb2YgJ2JlZm9yZVN0eWxlQXBwbGllZCcgZmllbGQgc2hvdWxkIGJlIGEgZnVuY3Rpb24sIHJlY2VpdmVkOiBcIi5jb25jYXQoX3R5cGVvZihiZWZvcmVTdHlsZUFwcGxpZWQpKSk7XG4gIH0gLy8gV2UgdXNlIEV2ZW50VHJhY2tlciB0byB0cmFjayB0aGUgZXZlbnQgdGhhdCBpcyBsaWtlbHkgdG8gY2F1c2UgdGhlIG11dGF0aW9uLlxuICAvLyBUaGUgcHJvYmxlbSBpcyB0aGF0IHdlIGNhbm5vdCB1c2UgYHdpbmRvdy5ldmVudGAgZGlyZWN0bHkgZnJvbSB0aGUgbXV0YXRpb24gb2JzZXJ2ZXIgY2FsbFxuICAvLyBhcyB3ZSdyZSBub3QgaW4gdGhlIGV2ZW50IGhhbmRsZXIgY29udGV4dCBhbnltb3JlLlxuXG5cbiAgdmFyIEV2ZW50VHJhY2tlciA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgaWdub3JlZEV2ZW50VHlwZXMgPSBbJ21vdXNlb3ZlcicsICdtb3VzZWxlYXZlJywgJ21vdXNlZW50ZXInLCAnbW91c2VvdXQnXTtcbiAgICB2YXIgTEFTVF9FVkVOVF9USU1FT1VUX01TID0gMTA7XG4gICAgdmFyIEVWRU5UUyA9IFsvLyBrZXlib2FyZCBldmVudHNcbiAgICAna2V5ZG93bicsICdrZXlwcmVzcycsICdrZXl1cCcsIC8vIG1vdXNlIGV2ZW50c1xuICAgICdhdXhjbGljaycsICdjbGljaycsICdjb250ZXh0bWVudScsICdkYmxjbGljaycsICdtb3VzZWRvd24nLCAnbW91c2VlbnRlcicsICdtb3VzZWxlYXZlJywgJ21vdXNlbW92ZScsICdtb3VzZW92ZXInLCAnbW91c2VvdXQnLCAnbW91c2V1cCcsICdwb2ludGVybG9ja2NoYW5nZScsICdwb2ludGVybG9ja2Vycm9yJywgJ3NlbGVjdCcsICd3aGVlbCddOyAvLyAnd2hlZWwnIGV2ZW50IG1ha2VzIHNjcm9sbGluZyBpbiBTYWZhcmkgdHdpdGNoeVxuICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9BZGd1YXJkVGVhbS9FeHRlbmRlZENzcy9pc3N1ZXMvMTIwXG5cbiAgICB2YXIgc2FmYXJpUHJvYmxlbWF0aWNFdmVudHMgPSBbJ3doZWVsJ107XG4gICAgdmFyIHRyYWNrZWRFdmVudHMgPSB1dGlscy5pc1NhZmFyaUJyb3dzZXIgPyBFVkVOVFMuZmlsdGVyKGZ1bmN0aW9uIChlbCkge1xuICAgICAgcmV0dXJuICEoc2FmYXJpUHJvYmxlbWF0aWNFdmVudHMuaW5kZXhPZihlbCkgPiAtMSk7XG4gICAgfSkgOiBFVkVOVFM7XG4gICAgdmFyIGxhc3RFdmVudFR5cGU7XG4gICAgdmFyIGxhc3RFdmVudFRpbWU7XG5cbiAgICB2YXIgdHJhY2tFdmVudCA9IGZ1bmN0aW9uIHRyYWNrRXZlbnQoZSkge1xuICAgICAgbGFzdEV2ZW50VHlwZSA9IGUudHlwZTtcbiAgICAgIGxhc3RFdmVudFRpbWUgPSBEYXRlLm5vdygpO1xuICAgIH07XG5cbiAgICB0cmFja2VkRXZlbnRzLmZvckVhY2goZnVuY3Rpb24gKGV2TmFtZSkge1xuICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoZXZOYW1lLCB0cmFja0V2ZW50LCB0cnVlKTtcbiAgICB9KTtcblxuICAgIHZhciBnZXRMYXN0RXZlbnRUeXBlID0gZnVuY3Rpb24gZ2V0TGFzdEV2ZW50VHlwZSgpIHtcbiAgICAgIHJldHVybiBsYXN0RXZlbnRUeXBlO1xuICAgIH07XG5cbiAgICB2YXIgZ2V0VGltZVNpbmNlTGFzdEV2ZW50ID0gZnVuY3Rpb24gZ2V0VGltZVNpbmNlTGFzdEV2ZW50KCkge1xuICAgICAgcmV0dXJuIERhdGUubm93KCkgLSBsYXN0RXZlbnRUaW1lO1xuICAgIH07XG5cbiAgICByZXR1cm4ge1xuICAgICAgaXNJZ25vcmVkRXZlbnRUeXBlOiBmdW5jdGlvbiBpc0lnbm9yZWRFdmVudFR5cGUoKSB7XG4gICAgICAgIHJldHVybiBpZ25vcmVkRXZlbnRUeXBlcy5pbmRleE9mKGdldExhc3RFdmVudFR5cGUoKSkgPiAtMSAmJiBnZXRUaW1lU2luY2VMYXN0RXZlbnQoKSA8IExBU1RfRVZFTlRfVElNRU9VVF9NUztcbiAgICAgIH1cbiAgICB9O1xuICB9KCk7XG5cbiAgdmFyIHJ1bGVzID0gW107XG4gIHZhciBhZmZlY3RlZEVsZW1lbnRzID0gW107XG4gIHZhciByZW1vdmFsc1N0YXRpc3RpYyA9IHt9O1xuICB2YXIgZG9tT2JzZXJ2ZWQ7XG4gIHZhciBldmVudExpc3RlbmVyU3VwcG9ydGVkID0gd2luZG93LmFkZEV2ZW50TGlzdGVuZXI7XG4gIHZhciBkb21NdXRhdGlvbk9ic2VydmVyO1xuXG4gIGZ1bmN0aW9uIG9ic2VydmVEb2N1bWVudChjYWxsYmFjaykge1xuICAgIC8vIFdlIGFyZSB0cnlpbmcgdG8gbGltaXQgdGhlIG51bWJlciBvZiBjYWxsYmFjayBjYWxscyBieSBub3QgY2FsbGluZyBpdCBvbiBhbGwga2luZCBvZiBcImhvdmVyXCIgZXZlbnRzLlxuICAgIC8vIFRoZSByYXRpb25hbGUgYmVoaW5kIHRoaXMgaXMgdGhhdCBcImhvdmVyXCIgZXZlbnRzIG9mdGVuIGNhdXNlIGF0dHJpYnV0ZXMgbW9kaWZpY2F0aW9uLFxuICAgIC8vIGJ1dCByZS1hcHBseWluZyBleHRDU1MgcnVsZXMgd2lsbCBiZSB1c2VsZXNzIGFzIHRoZXNlIGF0dHJpYnV0ZSBjaGFuZ2VzIGFyZSB1c3VhbGx5IHRyYW5zaWVudC5cbiAgICB2YXIgaXNJZ25vcmVkTXV0YXRpb24gPSBmdW5jdGlvbiBpc0lnbm9yZWRNdXRhdGlvbihtdXRhdGlvbnMpIHtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbXV0YXRpb25zLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgIGlmIChtdXRhdGlvbnMudHlwZSAhPT0gJ2F0dHJpYnV0ZXMnKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH07XG5cbiAgICBpZiAodXRpbHMuTXV0YXRpb25PYnNlcnZlcikge1xuICAgICAgZG9tTXV0YXRpb25PYnNlcnZlciA9IG5ldyB1dGlscy5NdXRhdGlvbk9ic2VydmVyKGZ1bmN0aW9uIChtdXRhdGlvbnMpIHtcbiAgICAgICAgaWYgKCFtdXRhdGlvbnMgfHwgbXV0YXRpb25zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChFdmVudFRyYWNrZXIuaXNJZ25vcmVkRXZlbnRUeXBlKCkgJiYgaXNJZ25vcmVkTXV0YXRpb24obXV0YXRpb25zKSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICB9KTtcbiAgICAgIGRvbU11dGF0aW9uT2JzZXJ2ZXIub2JzZXJ2ZShkb2N1bWVudCwge1xuICAgICAgICBjaGlsZExpc3Q6IHRydWUsXG4gICAgICAgIHN1YnRyZWU6IHRydWUsXG4gICAgICAgIGF0dHJpYnV0ZXM6IHRydWUsXG4gICAgICAgIGF0dHJpYnV0ZUZpbHRlcjogWydpZCcsICdjbGFzcyddXG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKGV2ZW50TGlzdGVuZXJTdXBwb3J0ZWQpIHtcbiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTU5vZGVJbnNlcnRlZCcsIGNhbGxiYWNrLCBmYWxzZSk7XG4gICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Ob2RlUmVtb3ZlZCcsIGNhbGxiYWNrLCBmYWxzZSk7XG4gICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01BdHRyTW9kaWZpZWQnLCBjYWxsYmFjaywgZmFsc2UpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGRpc2Nvbm5lY3REb2N1bWVudChjYWxsYmFjaykge1xuICAgIGlmIChkb21NdXRhdGlvbk9ic2VydmVyKSB7XG4gICAgICBkb21NdXRhdGlvbk9ic2VydmVyLmRpc2Nvbm5lY3QoKTtcbiAgICB9IGVsc2UgaWYgKGV2ZW50TGlzdGVuZXJTdXBwb3J0ZWQpIHtcbiAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ0RPTU5vZGVJbnNlcnRlZCcsIGNhbGxiYWNrLCBmYWxzZSk7XG4gICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdET01Ob2RlUmVtb3ZlZCcsIGNhbGxiYWNrLCBmYWxzZSk7XG4gICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdET01BdHRyTW9kaWZpZWQnLCBjYWxsYmFjaywgZmFsc2UpO1xuICAgIH1cbiAgfVxuXG4gIHZhciBNQVhfU1RZTEVfUFJPVEVDVElPTl9DT1VOVCA9IDUwO1xuICB2YXIgcHJvdGVjdGlvbk9ic2VydmVyT3B0aW9uID0ge1xuICAgIGF0dHJpYnV0ZXM6IHRydWUsXG4gICAgYXR0cmlidXRlT2xkVmFsdWU6IHRydWUsXG4gICAgYXR0cmlidXRlRmlsdGVyOiBbJ3N0eWxlJ11cbiAgfTtcbiAgLyoqXG4gICAqIENyZWF0ZXMgTXV0YXRpb25PYnNlcnZlciBwcm90ZWN0aW9uIGZ1bmN0aW9uXG4gICAqXG4gICAqIEBwYXJhbSBzdHlsZXNcbiAgICogQHJldHVybiB7cHJvdGVjdGlvbkZ1bmN0aW9ufVxuICAgKi9cblxuICBmdW5jdGlvbiBjcmVhdGVQcm90ZWN0aW9uRnVuY3Rpb24oc3R5bGVzKSB7XG4gICAgZnVuY3Rpb24gcHJvdGVjdGlvbkZ1bmN0aW9uKG11dGF0aW9ucywgb2JzZXJ2ZXIpIHtcbiAgICAgIGlmICghbXV0YXRpb25zLmxlbmd0aCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHZhciBtdXRhdGlvbiA9IG11dGF0aW9uc1swXTtcbiAgICAgIHZhciB0YXJnZXQgPSBtdXRhdGlvbi50YXJnZXQ7XG4gICAgICBvYnNlcnZlci5kaXNjb25uZWN0KCk7XG4gICAgICBzdHlsZXMuZm9yRWFjaChmdW5jdGlvbiAoc3R5bGUpIHtcbiAgICAgICAgc2V0U3R5bGVUb0VsZW1lbnQodGFyZ2V0LCBzdHlsZSk7XG4gICAgICB9KTtcblxuICAgICAgaWYgKCsrb2JzZXJ2ZXIuc3R5bGVQcm90ZWN0aW9uQ291bnQgPCBNQVhfU1RZTEVfUFJPVEVDVElPTl9DT1VOVCkge1xuICAgICAgICBvYnNlcnZlci5vYnNlcnZlKHRhcmdldCwgcHJvdGVjdGlvbk9ic2VydmVyT3B0aW9uKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHV0aWxzLmxvZ0Vycm9yKCdFeHRlbmRlZENzczogaW5maW5pdGUgbG9vcCBwcm90ZWN0aW9uIGZvciBzdHlsZScpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBwcm90ZWN0aW9uRnVuY3Rpb247XG4gIH1cbiAgLyoqXG4gICAqIFNldHMgdXAgYSBNdXRhdGlvbk9ic2VydmVyIHdoaWNoIHByb3RlY3RzIHN0eWxlIGF0dHJpYnV0ZXMgZnJvbSBjaGFuZ2VzXG4gICAqIEBwYXJhbSBub2RlIERPTSBub2RlXG4gICAqIEBwYXJhbSBydWxlcyBydWxlc1xuICAgKiBAcmV0dXJucyBNdXRhdGlvbiBvYnNlcnZlciB1c2VkIHRvIHByb3RlY3QgYXR0cmlidXRlIG9yIG51bGwgaWYgdGhlcmUncyBub3RoaW5nIHRvIHByb3RlY3RcbiAgICovXG5cblxuICBmdW5jdGlvbiBwcm90ZWN0U3R5bGVBdHRyaWJ1dGUobm9kZSwgcnVsZXMpIHtcbiAgICBpZiAoIXV0aWxzLk11dGF0aW9uT2JzZXJ2ZXIpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHZhciBzdHlsZXMgPSBydWxlcy5tYXAoZnVuY3Rpb24gKHIpIHtcbiAgICAgIHJldHVybiByLnN0eWxlO1xuICAgIH0pO1xuICAgIHZhciBwcm90ZWN0aW9uT2JzZXJ2ZXIgPSBuZXcgdXRpbHMuTXV0YXRpb25PYnNlcnZlcihjcmVhdGVQcm90ZWN0aW9uRnVuY3Rpb24oc3R5bGVzKSk7XG4gICAgcHJvdGVjdGlvbk9ic2VydmVyLm9ic2VydmUobm9kZSwgcHJvdGVjdGlvbk9ic2VydmVyT3B0aW9uKTsgLy8gQWRkcyBhbiBleHBhbmRvIHRvIHRoZSBvYnNlcnZlciB0byBrZWVwICdzdHlsZSBmaXggY291bnRzJy5cblxuICAgIHByb3RlY3Rpb25PYnNlcnZlci5zdHlsZVByb3RlY3Rpb25Db3VudCA9IDA7XG4gICAgcmV0dXJuIHByb3RlY3Rpb25PYnNlcnZlcjtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlbW92ZVN1ZmZpeChzdHIsIHN1ZmZpeCkge1xuICAgIHZhciBpbmRleCA9IHN0ci5pbmRleE9mKHN1ZmZpeCwgc3RyLmxlbmd0aCAtIHN1ZmZpeC5sZW5ndGgpO1xuXG4gICAgaWYgKGluZGV4ID49IDApIHtcbiAgICAgIHJldHVybiBzdHIuc3Vic3RyaW5nKDAsIGluZGV4KTtcbiAgICB9XG5cbiAgICByZXR1cm4gc3RyO1xuICB9XG4gIC8qKlxuICAgKiBGaW5kcyBhZmZlY3RlZEVsZW1lbnQgb2JqZWN0IGZvciB0aGUgc3BlY2lmaWVkIERPTSBub2RlXG4gICAqIEBwYXJhbSBub2RlICBET00gbm9kZVxuICAgKiBAcmV0dXJucyAgICAgYWZmZWN0ZWRFbGVtZW50IGZvdW5kIG9yIG51bGxcbiAgICovXG5cblxuICBmdW5jdGlvbiBmaW5kQWZmZWN0ZWRFbGVtZW50KG5vZGUpIHtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFmZmVjdGVkRWxlbWVudHMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgIGlmIChhZmZlY3RlZEVsZW1lbnRzW2ldLm5vZGUgPT09IG5vZGUpIHtcbiAgICAgICAgcmV0dXJuIGFmZmVjdGVkRWxlbWVudHNbaV07XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBmdW5jdGlvbiByZW1vdmVFbGVtZW50KGFmZmVjdGVkRWxlbWVudCkge1xuICAgIHZhciBub2RlID0gYWZmZWN0ZWRFbGVtZW50Lm5vZGU7XG4gICAgYWZmZWN0ZWRFbGVtZW50LnJlbW92ZWQgPSB0cnVlO1xuICAgIHZhciBlbGVtZW50U2VsZWN0b3IgPSB1dGlscy5nZXROb2RlU2VsZWN0b3Iobm9kZSk7IC8vIGNoZWNrIGlmIHRoZSBlbGVtZW50IGhhcyBiZWVuIGFscmVhZHkgcmVtb3ZlZCBlYXJsaWVyXG5cbiAgICB2YXIgZWxlbWVudFJlbW92YWxzQ291bnRlciA9IHJlbW92YWxzU3RhdGlzdGljW2VsZW1lbnRTZWxlY3Rvcl0gfHwgMDsgLy8gaWYgcmVtb3ZhbHMgYXR0ZW1wdHMgaGFwcGVuZWQgbW9yZSB0aGFuIHNwZWNpZmllZCB3ZSBkbyBub3QgdHJ5IHRvIHJlbW92ZSBub2RlIGFnYWluXG5cbiAgICBpZiAoZWxlbWVudFJlbW92YWxzQ291bnRlciA+IE1BWF9TVFlMRV9QUk9URUNUSU9OX0NPVU5UKSB7XG4gICAgICB1dGlscy5sb2dFcnJvcignRXh0ZW5kZWRDc3M6IGluZmluaXRlIGxvb3AgcHJvdGVjdGlvbiBmb3IgU0VMRUNUT1InLCBlbGVtZW50U2VsZWN0b3IpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChub2RlLnBhcmVudE5vZGUpIHtcbiAgICAgIG5vZGUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChub2RlKTtcbiAgICAgIHJlbW92YWxzU3RhdGlzdGljW2VsZW1lbnRTZWxlY3Rvcl0gPSBlbGVtZW50UmVtb3ZhbHNDb3VudGVyICsgMTtcbiAgICB9XG4gIH1cbiAgLyoqXG4gICAqIEFwcGxpZXMgc3R5bGUgdG8gdGhlIHNwZWNpZmllZCBET00gbm9kZVxuICAgKiBAcGFyYW0gYWZmZWN0ZWRFbGVtZW50IE9iamVjdCBjb250YWluaW5nIERPTSBub2RlIGFuZCBydWxlIHRvIGJlIGFwcGxpZWRcbiAgICovXG5cblxuICBmdW5jdGlvbiBhcHBseVN0eWxlKGFmZmVjdGVkRWxlbWVudCkge1xuICAgIGlmIChhZmZlY3RlZEVsZW1lbnQucHJvdGVjdGlvbk9ic2VydmVyKSB7XG4gICAgICAvLyBTdHlsZSBpcyBhbHJlYWR5IGFwcGxpZWQgYW5kIHByb3RlY3RlZCBieSB0aGUgb2JzZXJ2ZXJcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoYmVmb3JlU3R5bGVBcHBsaWVkKSB7XG4gICAgICBhZmZlY3RlZEVsZW1lbnQgPSBiZWZvcmVTdHlsZUFwcGxpZWQoYWZmZWN0ZWRFbGVtZW50KTtcblxuICAgICAgaWYgKCFhZmZlY3RlZEVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cblxuICAgIHZhciBfYWZmZWN0ZWRFbGVtZW50ID0gYWZmZWN0ZWRFbGVtZW50LFxuICAgICAgICBub2RlID0gX2FmZmVjdGVkRWxlbWVudC5ub2RlO1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhZmZlY3RlZEVsZW1lbnQucnVsZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBzdHlsZSA9IGFmZmVjdGVkRWxlbWVudC5ydWxlc1tpXS5zdHlsZTtcblxuICAgICAgaWYgKHN0eWxlWydyZW1vdmUnXSA9PT0gJ3RydWUnKSB7XG4gICAgICAgIHJlbW92ZUVsZW1lbnQoYWZmZWN0ZWRFbGVtZW50KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBzZXRTdHlsZVRvRWxlbWVudChub2RlLCBzdHlsZSk7XG4gICAgfVxuICB9XG4gIC8qKlxuICAgKiBTZXRzIHN0eWxlIHRvIHRoZSBzcGVjaWZpZWQgRE9NIG5vZGVcbiAgICogQHBhcmFtIG5vZGUgZWxlbWVudFxuICAgKiBAcGFyYW0gc3R5bGUgc3R5bGVcbiAgICovXG5cblxuICBmdW5jdGlvbiBzZXRTdHlsZVRvRWxlbWVudChub2RlLCBzdHlsZSkge1xuICAgIE9iamVjdC5rZXlzKHN0eWxlKS5mb3JFYWNoKGZ1bmN0aW9uIChwcm9wKSB7XG4gICAgICAvLyBBcHBseSB0aGlzIHN0eWxlIG9ubHkgdG8gZXhpc3RpbmcgcHJvcGVydGllc1xuICAgICAgLy8gV2UgY2FuJ3QgdXNlIGhhc093blByb3BlcnR5IGhlcmUgKGRvZXMgbm90IHdvcmsgaW4gRkYpXG4gICAgICBpZiAodHlwZW9mIG5vZGUuc3R5bGUuZ2V0UHJvcGVydHlWYWx1ZShwcm9wKSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgdmFyIHZhbHVlID0gc3R5bGVbcHJvcF07IC8vIEZpcnN0IHdlIHNob3VsZCByZW1vdmUgIWltcG9ydGFudCBhdHRyaWJ1dGUgKG9yIGl0IHdvbid0IGJlIGFwcGxpZWQnKVxuXG4gICAgICAgIHZhbHVlID0gcmVtb3ZlU3VmZml4KHZhbHVlLnRyaW0oKSwgJyFpbXBvcnRhbnQnKS50cmltKCk7XG4gICAgICAgIG5vZGUuc3R5bGUuc2V0UHJvcGVydHkocHJvcCwgdmFsdWUsICdpbXBvcnRhbnQnKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuICAvKipcbiAgICogUmV2ZXJ0cyBzdHlsZSBmb3IgdGhlIGFmZmVjdGVkIG9iamVjdFxuICAgKi9cblxuXG4gIGZ1bmN0aW9uIHJldmVydFN0eWxlKGFmZmVjdGVkRWxlbWVudCkge1xuICAgIGlmIChhZmZlY3RlZEVsZW1lbnQucHJvdGVjdGlvbk9ic2VydmVyKSB7XG4gICAgICBhZmZlY3RlZEVsZW1lbnQucHJvdGVjdGlvbk9ic2VydmVyLmRpc2Nvbm5lY3QoKTtcbiAgICB9XG5cbiAgICBhZmZlY3RlZEVsZW1lbnQubm9kZS5zdHlsZS5jc3NUZXh0ID0gYWZmZWN0ZWRFbGVtZW50Lm9yaWdpbmFsU3R5bGU7XG4gIH1cbiAgLyoqXG4gICAqIEFwcGxpZXMgc3BlY2lmaWVkIHJ1bGUgYW5kIHJldHVybnMgbGlzdCBvZiBlbGVtZW50cyBhZmZlY3RlZFxuICAgKiBAcGFyYW0gcnVsZSBSdWxlIHRvIGFwcGx5XG4gICAqIEByZXR1cm5zIExpc3Qgb2YgZWxlbWVudHMgYWZmZWN0ZWQgYnkgdGhpcyBydWxlXG4gICAqL1xuXG5cbiAgZnVuY3Rpb24gYXBwbHlSdWxlKHJ1bGUpIHtcbiAgICB2YXIgZGVidWcgPSBydWxlLnNlbGVjdG9yLmlzRGVidWdnaW5nKCk7XG4gICAgdmFyIHN0YXJ0O1xuXG4gICAgaWYgKGRlYnVnKSB7XG4gICAgICBzdGFydCA9IHV0aWxzLkFzeW5jV3JhcHBlci5ub3coKTtcbiAgICB9XG5cbiAgICB2YXIgc2VsZWN0b3IgPSBydWxlLnNlbGVjdG9yO1xuICAgIHZhciBub2RlcyA9IHNlbGVjdG9yLnF1ZXJ5U2VsZWN0b3JBbGwoKTtcbiAgICBub2Rlcy5mb3JFYWNoKGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICB2YXIgYWZmZWN0ZWRFbGVtZW50ID0gZmluZEFmZmVjdGVkRWxlbWVudChub2RlKTtcblxuICAgICAgaWYgKGFmZmVjdGVkRWxlbWVudCkge1xuICAgICAgICBhZmZlY3RlZEVsZW1lbnQucnVsZXMucHVzaChydWxlKTtcbiAgICAgICAgYXBwbHlTdHlsZShhZmZlY3RlZEVsZW1lbnQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gQXBwbHlpbmcgc3R5bGUgZmlyc3QgdGltZVxuICAgICAgICB2YXIgb3JpZ2luYWxTdHlsZSA9IG5vZGUuc3R5bGUuY3NzVGV4dDtcbiAgICAgICAgYWZmZWN0ZWRFbGVtZW50ID0ge1xuICAgICAgICAgIG5vZGU6IG5vZGUsXG4gICAgICAgICAgLy8gYWZmZWN0ZWQgRE9NIG5vZGVcbiAgICAgICAgICBydWxlczogW3J1bGVdLFxuICAgICAgICAgIC8vIHJ1bGVzIHRvIGJlIGFwcGxpZWRcbiAgICAgICAgICBvcmlnaW5hbFN0eWxlOiBvcmlnaW5hbFN0eWxlLFxuICAgICAgICAgIC8vIG9yaWdpbmFsIG5vZGUgc3R5bGVcbiAgICAgICAgICBwcm90ZWN0aW9uT2JzZXJ2ZXI6IG51bGwgLy8gc3R5bGUgYXR0cmlidXRlIG9ic2VydmVyXG5cbiAgICAgICAgfTtcbiAgICAgICAgYXBwbHlTdHlsZShhZmZlY3RlZEVsZW1lbnQpO1xuICAgICAgICBhZmZlY3RlZEVsZW1lbnRzLnB1c2goYWZmZWN0ZWRFbGVtZW50KTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGlmIChkZWJ1Zykge1xuICAgICAgdmFyIGVsYXBzZWQgPSB1dGlscy5Bc3luY1dyYXBwZXIubm93KCkgLSBzdGFydDtcblxuICAgICAgaWYgKCEoJ3RpbWluZ1N0YXRzJyBpbiBydWxlKSkge1xuICAgICAgICBydWxlLnRpbWluZ1N0YXRzID0gbmV3IHV0aWxzLlN0YXRzKCk7XG4gICAgICB9XG5cbiAgICAgIHJ1bGUudGltaW5nU3RhdHMucHVzaChlbGFwc2VkKTtcbiAgICB9XG5cbiAgICByZXR1cm4gbm9kZXM7XG4gIH1cbiAgLyoqXG4gICAqIEFwcGxpZXMgZmlsdGVyaW5nIHJ1bGVzXG4gICAqL1xuXG5cbiAgZnVuY3Rpb24gYXBwbHlSdWxlcygpIHtcbiAgICB2YXIgZWxlbWVudHNJbmRleCA9IFtdOyAvLyBzb21lIHJ1bGVzIGNvdWxkIG1ha2UgY2FsbCAtIHNlbGVjdG9yLnF1ZXJ5U2VsZWN0b3JBbGwoKSB0ZW1wb3JhcmlseSB0byBjaGFuZ2Ugbm9kZSBpZCBhdHRyaWJ1dGVcbiAgICAvLyB0aGlzIGNhdXNlZCBNdXRhdGlvbk9ic2VydmVyIHRvIGNhbGwgcmVjdXJzaXZlbHlcbiAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vQWRndWFyZFRlYW0vRXh0ZW5kZWRDc3MvaXNzdWVzLzgxXG5cbiAgICBzdG9wT2JzZXJ2ZSgpO1xuICAgIHJ1bGVzLmZvckVhY2goZnVuY3Rpb24gKHJ1bGUpIHtcbiAgICAgIHZhciBub2RlcyA9IGFwcGx5UnVsZShydWxlKTtcbiAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KGVsZW1lbnRzSW5kZXgsIG5vZGVzKTtcbiAgICB9KTsgLy8gTm93IHJldmVydCBzdHlsZXMgZm9yIGVsZW1lbnRzIHdoaWNoIGFyZSBubyBtb3JlIGFmZmVjdGVkXG5cbiAgICB2YXIgbCA9IGFmZmVjdGVkRWxlbWVudHMubGVuZ3RoOyAvLyBkbyBub3RoaW5nIGlmIHRoZXJlIGlzIG5vIGVsZW1lbnRzIHRvIHByb2Nlc3NcblxuICAgIGlmIChlbGVtZW50c0luZGV4Lmxlbmd0aCA+IDApIHtcbiAgICAgIHdoaWxlIChsLS0pIHtcbiAgICAgICAgdmFyIG9iaiA9IGFmZmVjdGVkRWxlbWVudHNbbF07XG5cbiAgICAgICAgaWYgKGVsZW1lbnRzSW5kZXguaW5kZXhPZihvYmoubm9kZSkgPT09IC0xKSB7XG4gICAgICAgICAgLy8gVGltZSB0byByZXZlcnQgc3R5bGVcbiAgICAgICAgICByZXZlcnRTdHlsZShvYmopO1xuICAgICAgICAgIGFmZmVjdGVkRWxlbWVudHMuc3BsaWNlKGwsIDEpO1xuICAgICAgICB9IGVsc2UgaWYgKCFvYmoucmVtb3ZlZCkge1xuICAgICAgICAgIC8vIEFkZCBzdHlsZSBwcm90ZWN0aW9uIG9ic2VydmVyXG4gICAgICAgICAgLy8gUHJvdGVjdCBcInN0eWxlXCIgYXR0cmlidXRlIGZyb20gY2hhbmdlc1xuICAgICAgICAgIGlmICghb2JqLnByb3RlY3Rpb25PYnNlcnZlcikge1xuICAgICAgICAgICAgb2JqLnByb3RlY3Rpb25PYnNlcnZlciA9IHByb3RlY3RTdHlsZUF0dHJpYnV0ZShvYmoubm9kZSwgb2JqLnJ1bGVzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IC8vIEFmdGVyIHN0eWxlcyBhcmUgYXBwbGllZCB3ZSBjYW4gc3RhcnQgb2JzZXJ2ZSBhZ2FpblxuXG5cbiAgICBvYnNlcnZlKCk7XG4gICAgcHJpbnRUaW1pbmdJbmZvKCk7XG4gIH1cblxuICB2YXIgQVBQTFlfUlVMRVNfREVMQVkgPSAxNTA7XG4gIHZhciBhcHBseVJ1bGVzU2NoZWR1bGVyID0gbmV3IHV0aWxzLkFzeW5jV3JhcHBlcihhcHBseVJ1bGVzLCBBUFBMWV9SVUxFU19ERUxBWSk7XG4gIHZhciBtYWluQ2FsbGJhY2sgPSBhcHBseVJ1bGVzU2NoZWR1bGVyLnJ1bi5iaW5kKGFwcGx5UnVsZXNTY2hlZHVsZXIpO1xuXG4gIGZ1bmN0aW9uIG9ic2VydmUoKSB7XG4gICAgaWYgKGRvbU9ic2VydmVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfSAvLyBIYW5kbGUgZHluYW1pY2FsbHkgYWRkZWQgZWxlbWVudHNcblxuXG4gICAgZG9tT2JzZXJ2ZWQgPSB0cnVlO1xuICAgIG9ic2VydmVEb2N1bWVudChtYWluQ2FsbGJhY2spO1xuICB9XG5cbiAgZnVuY3Rpb24gc3RvcE9ic2VydmUoKSB7XG4gICAgaWYgKCFkb21PYnNlcnZlZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGRvbU9ic2VydmVkID0gZmFsc2U7XG4gICAgZGlzY29ubmVjdERvY3VtZW50KG1haW5DYWxsYmFjayk7XG4gIH1cblxuICBmdW5jdGlvbiBhcHBseSgpIHtcbiAgICBhcHBseVJ1bGVzKCk7XG5cbiAgICBpZiAoZG9jdW1lbnQucmVhZHlTdGF0ZSAhPT0gJ2NvbXBsZXRlJykge1xuICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGFwcGx5UnVsZXMpO1xuICAgIH1cbiAgfVxuICAvKipcbiAgICogRGlzcG9zZXMgRXh0ZW5kZWRDc3MgYW5kIHJlbW92ZXMgb3VyIHN0eWxlcyBmcm9tIG1hdGNoZWQgZWxlbWVudHNcbiAgICovXG5cblxuICBmdW5jdGlvbiBkaXNwb3NlKCkge1xuICAgIHN0b3BPYnNlcnZlKCk7XG4gICAgYWZmZWN0ZWRFbGVtZW50cy5mb3JFYWNoKGZ1bmN0aW9uIChvYmopIHtcbiAgICAgIHJldmVydFN0eWxlKG9iaik7XG4gICAgfSk7XG4gIH1cblxuICB2YXIgdGltaW5nc1ByaW50ZWQgPSBmYWxzZTtcbiAgLyoqXG4gICAqIFByaW50cyB0aW1pbmcgaW5mb3JtYXRpb24gZm9yIGFsbCBzZWxlY3RvcnMgbWFya2VkIGFzIFwiZGVidWdcIlxuICAgKi9cblxuICBmdW5jdGlvbiBwcmludFRpbWluZ0luZm8oKSB7XG4gICAgaWYgKHRpbWluZ3NQcmludGVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGltaW5nc1ByaW50ZWQgPSB0cnVlO1xuICAgIHZhciB0aW1pbmdzID0gcnVsZXMuZmlsdGVyKGZ1bmN0aW9uIChydWxlKSB7XG4gICAgICByZXR1cm4gcnVsZS5zZWxlY3Rvci5pc0RlYnVnZ2luZygpO1xuICAgIH0pLm1hcChmdW5jdGlvbiAocnVsZSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc2VsZWN0b3JUZXh0OiBydWxlLnNlbGVjdG9yLnNlbGVjdG9yVGV4dCxcbiAgICAgICAgdGltaW5nU3RhdHM6IHJ1bGUudGltaW5nU3RhdHNcbiAgICAgIH07XG4gICAgfSk7XG5cbiAgICBpZiAodGltaW5ncy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybjtcbiAgICB9IC8vIEFkZCBsb2NhdGlvbi5ocmVmIHRvIHRoZSBtZXNzYWdlIHRvIGRpc3Rpbmd1aXNoIGZyYW1lc1xuXG5cbiAgICB1dGlscy5sb2dJbmZvKCdbRXh0ZW5kZWRDc3NdIFRpbWluZ3MgZm9yICVvOlxcbiVvIChpbiBtaWxsaXNlY29uZHMpJywgd2luZG93LmxvY2F0aW9uLmhyZWYsIHRpbWluZ3MpO1xuICB9IC8vIEZpcnN0IG9mIGFsbCBwYXJzZSB0aGUgc3R5bGVzaGVldFxuXG5cbiAgcnVsZXMgPSBFeHRlbmRlZENzc1BhcnNlci5wYXJzZUNzcyhzdHlsZVNoZWV0KTsgLy8gRVhQT1NFXG5cbiAgdGhpcy5kaXNwb3NlID0gZGlzcG9zZTtcbiAgdGhpcy5hcHBseSA9IGFwcGx5O1xuICAvKiogRXhwb3NlZCBmb3IgdGVzdGluZyBwdXJwb3NlcyBvbmx5ICovXG5cbiAgdGhpcy5fZ2V0QWZmZWN0ZWRFbGVtZW50cyA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gYWZmZWN0ZWRFbGVtZW50cztcbiAgfTtcbn1cbi8qKlxuICogRXhwb3NlIHF1ZXJ5U2VsZWN0b3JBbGwgZm9yIGRlYnVnZ2luZyBhbmQgdmFsaWRhdGluZyBzZWxlY3RvcnNcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gc2VsZWN0b3JUZXh0IHNlbGVjdG9yIHRleHRcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gbm9UaW1pbmcgaWYgdHJ1ZSAtLSBkbyBub3QgcHJpbnQgdGhlIHRpbWluZyB0byB0aGUgY29uc29sZVxuICogQHJldHVybnMge0FycmF5PE5vZGU+fE5vZGVMaXN0fSBhIGxpc3Qgb2YgZWxlbWVudHMgZm91bmRcbiAqIEB0aHJvd3MgV2lsbCB0aHJvdyBhbiBlcnJvciBpZiB0aGUgYXJndW1lbnQgaXMgbm90IGEgdmFsaWQgc2VsZWN0b3JcbiAqL1xuXG5cbkV4dGVuZGVkQ3NzLnF1ZXJ5ID0gZnVuY3Rpb24gKHNlbGVjdG9yVGV4dCwgbm9UaW1pbmcpIHtcbiAgaWYgKHR5cGVvZiBzZWxlY3RvclRleHQgIT09ICdzdHJpbmcnKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdTZWxlY3RvciB0ZXh0IGlzIGVtcHR5Jyk7XG4gIH1cblxuICB2YXIgbm93ID0gdXRpbHMuQXN5bmNXcmFwcGVyLm5vdztcbiAgdmFyIHN0YXJ0ID0gbm93KCk7XG5cbiAgdHJ5IHtcbiAgICByZXR1cm4gRXh0ZW5kZWRTZWxlY3RvckZhY3RvcnkuY3JlYXRlU2VsZWN0b3Ioc2VsZWN0b3JUZXh0KS5xdWVyeVNlbGVjdG9yQWxsKCk7XG4gIH0gZmluYWxseSB7XG4gICAgdmFyIGVuZCA9IG5vdygpO1xuXG4gICAgaWYgKCFub1RpbWluZykge1xuICAgICAgdXRpbHMubG9nSW5mbyhcIltFeHRlbmRlZENzc10gRWxhcHNlZDogXCIuY29uY2F0KE1hdGgucm91bmQoKGVuZCAtIHN0YXJ0KSAqIDEwMDApLCBcIiBcXHUwM0JDcy5cIikpO1xuICAgIH1cbiAgfVxufTtcblxuZXhwb3J0IGRlZmF1bHQgRXh0ZW5kZWRDc3M7XG4iLCIvKipcbiAqIENvcHlyaWdodCAoYykgMjAxNC1wcmVzZW50LCBGYWNlYm9vaywgSW5jLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICovXG5cbnZhciBydW50aW1lID0gKGZ1bmN0aW9uIChleHBvcnRzKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBPcCA9IE9iamVjdC5wcm90b3R5cGU7XG4gIHZhciBoYXNPd24gPSBPcC5oYXNPd25Qcm9wZXJ0eTtcbiAgdmFyIHVuZGVmaW5lZDsgLy8gTW9yZSBjb21wcmVzc2libGUgdGhhbiB2b2lkIDAuXG4gIHZhciAkU3ltYm9sID0gdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiID8gU3ltYm9sIDoge307XG4gIHZhciBpdGVyYXRvclN5bWJvbCA9ICRTeW1ib2wuaXRlcmF0b3IgfHwgXCJAQGl0ZXJhdG9yXCI7XG4gIHZhciBhc3luY0l0ZXJhdG9yU3ltYm9sID0gJFN5bWJvbC5hc3luY0l0ZXJhdG9yIHx8IFwiQEBhc3luY0l0ZXJhdG9yXCI7XG4gIHZhciB0b1N0cmluZ1RhZ1N5bWJvbCA9ICRTeW1ib2wudG9TdHJpbmdUYWcgfHwgXCJAQHRvU3RyaW5nVGFnXCI7XG5cbiAgZnVuY3Rpb24gZGVmaW5lKG9iaiwga2V5LCB2YWx1ZSkge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwge1xuICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgIHdyaXRhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgcmV0dXJuIG9ialtrZXldO1xuICB9XG4gIHRyeSB7XG4gICAgLy8gSUUgOCBoYXMgYSBicm9rZW4gT2JqZWN0LmRlZmluZVByb3BlcnR5IHRoYXQgb25seSB3b3JrcyBvbiBET00gb2JqZWN0cy5cbiAgICBkZWZpbmUoe30sIFwiXCIpO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBkZWZpbmUgPSBmdW5jdGlvbihvYmosIGtleSwgdmFsdWUpIHtcbiAgICAgIHJldHVybiBvYmpba2V5XSA9IHZhbHVlO1xuICAgIH07XG4gIH1cblxuICBmdW5jdGlvbiB3cmFwKGlubmVyRm4sIG91dGVyRm4sIHNlbGYsIHRyeUxvY3NMaXN0KSB7XG4gICAgLy8gSWYgb3V0ZXJGbiBwcm92aWRlZCBhbmQgb3V0ZXJGbi5wcm90b3R5cGUgaXMgYSBHZW5lcmF0b3IsIHRoZW4gb3V0ZXJGbi5wcm90b3R5cGUgaW5zdGFuY2VvZiBHZW5lcmF0b3IuXG4gICAgdmFyIHByb3RvR2VuZXJhdG9yID0gb3V0ZXJGbiAmJiBvdXRlckZuLnByb3RvdHlwZSBpbnN0YW5jZW9mIEdlbmVyYXRvciA/IG91dGVyRm4gOiBHZW5lcmF0b3I7XG4gICAgdmFyIGdlbmVyYXRvciA9IE9iamVjdC5jcmVhdGUocHJvdG9HZW5lcmF0b3IucHJvdG90eXBlKTtcbiAgICB2YXIgY29udGV4dCA9IG5ldyBDb250ZXh0KHRyeUxvY3NMaXN0IHx8IFtdKTtcblxuICAgIC8vIFRoZSAuX2ludm9rZSBtZXRob2QgdW5pZmllcyB0aGUgaW1wbGVtZW50YXRpb25zIG9mIHRoZSAubmV4dCxcbiAgICAvLyAudGhyb3csIGFuZCAucmV0dXJuIG1ldGhvZHMuXG4gICAgZ2VuZXJhdG9yLl9pbnZva2UgPSBtYWtlSW52b2tlTWV0aG9kKGlubmVyRm4sIHNlbGYsIGNvbnRleHQpO1xuXG4gICAgcmV0dXJuIGdlbmVyYXRvcjtcbiAgfVxuICBleHBvcnRzLndyYXAgPSB3cmFwO1xuXG4gIC8vIFRyeS9jYXRjaCBoZWxwZXIgdG8gbWluaW1pemUgZGVvcHRpbWl6YXRpb25zLiBSZXR1cm5zIGEgY29tcGxldGlvblxuICAvLyByZWNvcmQgbGlrZSBjb250ZXh0LnRyeUVudHJpZXNbaV0uY29tcGxldGlvbi4gVGhpcyBpbnRlcmZhY2UgY291bGRcbiAgLy8gaGF2ZSBiZWVuIChhbmQgd2FzIHByZXZpb3VzbHkpIGRlc2lnbmVkIHRvIHRha2UgYSBjbG9zdXJlIHRvIGJlXG4gIC8vIGludm9rZWQgd2l0aG91dCBhcmd1bWVudHMsIGJ1dCBpbiBhbGwgdGhlIGNhc2VzIHdlIGNhcmUgYWJvdXQgd2VcbiAgLy8gYWxyZWFkeSBoYXZlIGFuIGV4aXN0aW5nIG1ldGhvZCB3ZSB3YW50IHRvIGNhbGwsIHNvIHRoZXJlJ3Mgbm8gbmVlZFxuICAvLyB0byBjcmVhdGUgYSBuZXcgZnVuY3Rpb24gb2JqZWN0LiBXZSBjYW4gZXZlbiBnZXQgYXdheSB3aXRoIGFzc3VtaW5nXG4gIC8vIHRoZSBtZXRob2QgdGFrZXMgZXhhY3RseSBvbmUgYXJndW1lbnQsIHNpbmNlIHRoYXQgaGFwcGVucyB0byBiZSB0cnVlXG4gIC8vIGluIGV2ZXJ5IGNhc2UsIHNvIHdlIGRvbid0IGhhdmUgdG8gdG91Y2ggdGhlIGFyZ3VtZW50cyBvYmplY3QuIFRoZVxuICAvLyBvbmx5IGFkZGl0aW9uYWwgYWxsb2NhdGlvbiByZXF1aXJlZCBpcyB0aGUgY29tcGxldGlvbiByZWNvcmQsIHdoaWNoXG4gIC8vIGhhcyBhIHN0YWJsZSBzaGFwZSBhbmQgc28gaG9wZWZ1bGx5IHNob3VsZCBiZSBjaGVhcCB0byBhbGxvY2F0ZS5cbiAgZnVuY3Rpb24gdHJ5Q2F0Y2goZm4sIG9iaiwgYXJnKSB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiB7IHR5cGU6IFwibm9ybWFsXCIsIGFyZzogZm4uY2FsbChvYmosIGFyZykgfTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIHJldHVybiB7IHR5cGU6IFwidGhyb3dcIiwgYXJnOiBlcnIgfTtcbiAgICB9XG4gIH1cblxuICB2YXIgR2VuU3RhdGVTdXNwZW5kZWRTdGFydCA9IFwic3VzcGVuZGVkU3RhcnRcIjtcbiAgdmFyIEdlblN0YXRlU3VzcGVuZGVkWWllbGQgPSBcInN1c3BlbmRlZFlpZWxkXCI7XG4gIHZhciBHZW5TdGF0ZUV4ZWN1dGluZyA9IFwiZXhlY3V0aW5nXCI7XG4gIHZhciBHZW5TdGF0ZUNvbXBsZXRlZCA9IFwiY29tcGxldGVkXCI7XG5cbiAgLy8gUmV0dXJuaW5nIHRoaXMgb2JqZWN0IGZyb20gdGhlIGlubmVyRm4gaGFzIHRoZSBzYW1lIGVmZmVjdCBhc1xuICAvLyBicmVha2luZyBvdXQgb2YgdGhlIGRpc3BhdGNoIHN3aXRjaCBzdGF0ZW1lbnQuXG4gIHZhciBDb250aW51ZVNlbnRpbmVsID0ge307XG5cbiAgLy8gRHVtbXkgY29uc3RydWN0b3IgZnVuY3Rpb25zIHRoYXQgd2UgdXNlIGFzIHRoZSAuY29uc3RydWN0b3IgYW5kXG4gIC8vIC5jb25zdHJ1Y3Rvci5wcm90b3R5cGUgcHJvcGVydGllcyBmb3IgZnVuY3Rpb25zIHRoYXQgcmV0dXJuIEdlbmVyYXRvclxuICAvLyBvYmplY3RzLiBGb3IgZnVsbCBzcGVjIGNvbXBsaWFuY2UsIHlvdSBtYXkgd2lzaCB0byBjb25maWd1cmUgeW91clxuICAvLyBtaW5pZmllciBub3QgdG8gbWFuZ2xlIHRoZSBuYW1lcyBvZiB0aGVzZSB0d28gZnVuY3Rpb25zLlxuICBmdW5jdGlvbiBHZW5lcmF0b3IoKSB7fVxuICBmdW5jdGlvbiBHZW5lcmF0b3JGdW5jdGlvbigpIHt9XG4gIGZ1bmN0aW9uIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlKCkge31cblxuICAvLyBUaGlzIGlzIGEgcG9seWZpbGwgZm9yICVJdGVyYXRvclByb3RvdHlwZSUgZm9yIGVudmlyb25tZW50cyB0aGF0XG4gIC8vIGRvbid0IG5hdGl2ZWx5IHN1cHBvcnQgaXQuXG4gIHZhciBJdGVyYXRvclByb3RvdHlwZSA9IHt9O1xuICBJdGVyYXRvclByb3RvdHlwZVtpdGVyYXRvclN5bWJvbF0gPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgdmFyIGdldFByb3RvID0gT2JqZWN0LmdldFByb3RvdHlwZU9mO1xuICB2YXIgTmF0aXZlSXRlcmF0b3JQcm90b3R5cGUgPSBnZXRQcm90byAmJiBnZXRQcm90byhnZXRQcm90byh2YWx1ZXMoW10pKSk7XG4gIGlmIChOYXRpdmVJdGVyYXRvclByb3RvdHlwZSAmJlxuICAgICAgTmF0aXZlSXRlcmF0b3JQcm90b3R5cGUgIT09IE9wICYmXG4gICAgICBoYXNPd24uY2FsbChOYXRpdmVJdGVyYXRvclByb3RvdHlwZSwgaXRlcmF0b3JTeW1ib2wpKSB7XG4gICAgLy8gVGhpcyBlbnZpcm9ubWVudCBoYXMgYSBuYXRpdmUgJUl0ZXJhdG9yUHJvdG90eXBlJTsgdXNlIGl0IGluc3RlYWRcbiAgICAvLyBvZiB0aGUgcG9seWZpbGwuXG4gICAgSXRlcmF0b3JQcm90b3R5cGUgPSBOYXRpdmVJdGVyYXRvclByb3RvdHlwZTtcbiAgfVxuXG4gIHZhciBHcCA9IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLnByb3RvdHlwZSA9XG4gICAgR2VuZXJhdG9yLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoSXRlcmF0b3JQcm90b3R5cGUpO1xuICBHZW5lcmF0b3JGdW5jdGlvbi5wcm90b3R5cGUgPSBHcC5jb25zdHJ1Y3RvciA9IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlO1xuICBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IEdlbmVyYXRvckZ1bmN0aW9uO1xuICBHZW5lcmF0b3JGdW5jdGlvbi5kaXNwbGF5TmFtZSA9IGRlZmluZShcbiAgICBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSxcbiAgICB0b1N0cmluZ1RhZ1N5bWJvbCxcbiAgICBcIkdlbmVyYXRvckZ1bmN0aW9uXCJcbiAgKTtcblxuICAvLyBIZWxwZXIgZm9yIGRlZmluaW5nIHRoZSAubmV4dCwgLnRocm93LCBhbmQgLnJldHVybiBtZXRob2RzIG9mIHRoZVxuICAvLyBJdGVyYXRvciBpbnRlcmZhY2UgaW4gdGVybXMgb2YgYSBzaW5nbGUgLl9pbnZva2UgbWV0aG9kLlxuICBmdW5jdGlvbiBkZWZpbmVJdGVyYXRvck1ldGhvZHMocHJvdG90eXBlKSB7XG4gICAgW1wibmV4dFwiLCBcInRocm93XCIsIFwicmV0dXJuXCJdLmZvckVhY2goZnVuY3Rpb24obWV0aG9kKSB7XG4gICAgICBkZWZpbmUocHJvdG90eXBlLCBtZXRob2QsIGZ1bmN0aW9uKGFyZykge1xuICAgICAgICByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgYXJnKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgZXhwb3J0cy5pc0dlbmVyYXRvckZ1bmN0aW9uID0gZnVuY3Rpb24oZ2VuRnVuKSB7XG4gICAgdmFyIGN0b3IgPSB0eXBlb2YgZ2VuRnVuID09PSBcImZ1bmN0aW9uXCIgJiYgZ2VuRnVuLmNvbnN0cnVjdG9yO1xuICAgIHJldHVybiBjdG9yXG4gICAgICA/IGN0b3IgPT09IEdlbmVyYXRvckZ1bmN0aW9uIHx8XG4gICAgICAgIC8vIEZvciB0aGUgbmF0aXZlIEdlbmVyYXRvckZ1bmN0aW9uIGNvbnN0cnVjdG9yLCB0aGUgYmVzdCB3ZSBjYW5cbiAgICAgICAgLy8gZG8gaXMgdG8gY2hlY2sgaXRzIC5uYW1lIHByb3BlcnR5LlxuICAgICAgICAoY3Rvci5kaXNwbGF5TmFtZSB8fCBjdG9yLm5hbWUpID09PSBcIkdlbmVyYXRvckZ1bmN0aW9uXCJcbiAgICAgIDogZmFsc2U7XG4gIH07XG5cbiAgZXhwb3J0cy5tYXJrID0gZnVuY3Rpb24oZ2VuRnVuKSB7XG4gICAgaWYgKE9iamVjdC5zZXRQcm90b3R5cGVPZikge1xuICAgICAgT2JqZWN0LnNldFByb3RvdHlwZU9mKGdlbkZ1biwgR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBnZW5GdW4uX19wcm90b19fID0gR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGU7XG4gICAgICBkZWZpbmUoZ2VuRnVuLCB0b1N0cmluZ1RhZ1N5bWJvbCwgXCJHZW5lcmF0b3JGdW5jdGlvblwiKTtcbiAgICB9XG4gICAgZ2VuRnVuLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoR3ApO1xuICAgIHJldHVybiBnZW5GdW47XG4gIH07XG5cbiAgLy8gV2l0aGluIHRoZSBib2R5IG9mIGFueSBhc3luYyBmdW5jdGlvbiwgYGF3YWl0IHhgIGlzIHRyYW5zZm9ybWVkIHRvXG4gIC8vIGB5aWVsZCByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoeClgLCBzbyB0aGF0IHRoZSBydW50aW1lIGNhbiB0ZXN0XG4gIC8vIGBoYXNPd24uY2FsbCh2YWx1ZSwgXCJfX2F3YWl0XCIpYCB0byBkZXRlcm1pbmUgaWYgdGhlIHlpZWxkZWQgdmFsdWUgaXNcbiAgLy8gbWVhbnQgdG8gYmUgYXdhaXRlZC5cbiAgZXhwb3J0cy5hd3JhcCA9IGZ1bmN0aW9uKGFyZykge1xuICAgIHJldHVybiB7IF9fYXdhaXQ6IGFyZyB9O1xuICB9O1xuXG4gIGZ1bmN0aW9uIEFzeW5jSXRlcmF0b3IoZ2VuZXJhdG9yLCBQcm9taXNlSW1wbCkge1xuICAgIGZ1bmN0aW9uIGludm9rZShtZXRob2QsIGFyZywgcmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICB2YXIgcmVjb3JkID0gdHJ5Q2F0Y2goZ2VuZXJhdG9yW21ldGhvZF0sIGdlbmVyYXRvciwgYXJnKTtcbiAgICAgIGlmIChyZWNvcmQudHlwZSA9PT0gXCJ0aHJvd1wiKSB7XG4gICAgICAgIHJlamVjdChyZWNvcmQuYXJnKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciByZXN1bHQgPSByZWNvcmQuYXJnO1xuICAgICAgICB2YXIgdmFsdWUgPSByZXN1bHQudmFsdWU7XG4gICAgICAgIGlmICh2YWx1ZSAmJlxuICAgICAgICAgICAgdHlwZW9mIHZhbHVlID09PSBcIm9iamVjdFwiICYmXG4gICAgICAgICAgICBoYXNPd24uY2FsbCh2YWx1ZSwgXCJfX2F3YWl0XCIpKSB7XG4gICAgICAgICAgcmV0dXJuIFByb21pc2VJbXBsLnJlc29sdmUodmFsdWUuX19hd2FpdCkudGhlbihmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgICAgaW52b2tlKFwibmV4dFwiLCB2YWx1ZSwgcmVzb2x2ZSwgcmVqZWN0KTtcbiAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgICAgIGludm9rZShcInRocm93XCIsIGVyciwgcmVzb2x2ZSwgcmVqZWN0KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBQcm9taXNlSW1wbC5yZXNvbHZlKHZhbHVlKS50aGVuKGZ1bmN0aW9uKHVud3JhcHBlZCkge1xuICAgICAgICAgIC8vIFdoZW4gYSB5aWVsZGVkIFByb21pc2UgaXMgcmVzb2x2ZWQsIGl0cyBmaW5hbCB2YWx1ZSBiZWNvbWVzXG4gICAgICAgICAgLy8gdGhlIC52YWx1ZSBvZiB0aGUgUHJvbWlzZTx7dmFsdWUsZG9uZX0+IHJlc3VsdCBmb3IgdGhlXG4gICAgICAgICAgLy8gY3VycmVudCBpdGVyYXRpb24uXG4gICAgICAgICAgcmVzdWx0LnZhbHVlID0gdW53cmFwcGVkO1xuICAgICAgICAgIHJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgfSwgZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAgICAgICAvLyBJZiBhIHJlamVjdGVkIFByb21pc2Ugd2FzIHlpZWxkZWQsIHRocm93IHRoZSByZWplY3Rpb24gYmFja1xuICAgICAgICAgIC8vIGludG8gdGhlIGFzeW5jIGdlbmVyYXRvciBmdW5jdGlvbiBzbyBpdCBjYW4gYmUgaGFuZGxlZCB0aGVyZS5cbiAgICAgICAgICByZXR1cm4gaW52b2tlKFwidGhyb3dcIiwgZXJyb3IsIHJlc29sdmUsIHJlamVjdCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIHZhciBwcmV2aW91c1Byb21pc2U7XG5cbiAgICBmdW5jdGlvbiBlbnF1ZXVlKG1ldGhvZCwgYXJnKSB7XG4gICAgICBmdW5jdGlvbiBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZygpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlSW1wbChmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICBpbnZva2UobWV0aG9kLCBhcmcsIHJlc29sdmUsIHJlamVjdCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcHJldmlvdXNQcm9taXNlID1cbiAgICAgICAgLy8gSWYgZW5xdWV1ZSBoYXMgYmVlbiBjYWxsZWQgYmVmb3JlLCB0aGVuIHdlIHdhbnQgdG8gd2FpdCB1bnRpbFxuICAgICAgICAvLyBhbGwgcHJldmlvdXMgUHJvbWlzZXMgaGF2ZSBiZWVuIHJlc29sdmVkIGJlZm9yZSBjYWxsaW5nIGludm9rZSxcbiAgICAgICAgLy8gc28gdGhhdCByZXN1bHRzIGFyZSBhbHdheXMgZGVsaXZlcmVkIGluIHRoZSBjb3JyZWN0IG9yZGVyLiBJZlxuICAgICAgICAvLyBlbnF1ZXVlIGhhcyBub3QgYmVlbiBjYWxsZWQgYmVmb3JlLCB0aGVuIGl0IGlzIGltcG9ydGFudCB0b1xuICAgICAgICAvLyBjYWxsIGludm9rZSBpbW1lZGlhdGVseSwgd2l0aG91dCB3YWl0aW5nIG9uIGEgY2FsbGJhY2sgdG8gZmlyZSxcbiAgICAgICAgLy8gc28gdGhhdCB0aGUgYXN5bmMgZ2VuZXJhdG9yIGZ1bmN0aW9uIGhhcyB0aGUgb3Bwb3J0dW5pdHkgdG8gZG9cbiAgICAgICAgLy8gYW55IG5lY2Vzc2FyeSBzZXR1cCBpbiBhIHByZWRpY3RhYmxlIHdheS4gVGhpcyBwcmVkaWN0YWJpbGl0eVxuICAgICAgICAvLyBpcyB3aHkgdGhlIFByb21pc2UgY29uc3RydWN0b3Igc3luY2hyb25vdXNseSBpbnZva2VzIGl0c1xuICAgICAgICAvLyBleGVjdXRvciBjYWxsYmFjaywgYW5kIHdoeSBhc3luYyBmdW5jdGlvbnMgc3luY2hyb25vdXNseVxuICAgICAgICAvLyBleGVjdXRlIGNvZGUgYmVmb3JlIHRoZSBmaXJzdCBhd2FpdC4gU2luY2Ugd2UgaW1wbGVtZW50IHNpbXBsZVxuICAgICAgICAvLyBhc3luYyBmdW5jdGlvbnMgaW4gdGVybXMgb2YgYXN5bmMgZ2VuZXJhdG9ycywgaXQgaXMgZXNwZWNpYWxseVxuICAgICAgICAvLyBpbXBvcnRhbnQgdG8gZ2V0IHRoaXMgcmlnaHQsIGV2ZW4gdGhvdWdoIGl0IHJlcXVpcmVzIGNhcmUuXG4gICAgICAgIHByZXZpb3VzUHJvbWlzZSA/IHByZXZpb3VzUHJvbWlzZS50aGVuKFxuICAgICAgICAgIGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnLFxuICAgICAgICAgIC8vIEF2b2lkIHByb3BhZ2F0aW5nIGZhaWx1cmVzIHRvIFByb21pc2VzIHJldHVybmVkIGJ5IGxhdGVyXG4gICAgICAgICAgLy8gaW52b2NhdGlvbnMgb2YgdGhlIGl0ZXJhdG9yLlxuICAgICAgICAgIGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnXG4gICAgICAgICkgOiBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZygpO1xuICAgIH1cblxuICAgIC8vIERlZmluZSB0aGUgdW5pZmllZCBoZWxwZXIgbWV0aG9kIHRoYXQgaXMgdXNlZCB0byBpbXBsZW1lbnQgLm5leHQsXG4gICAgLy8gLnRocm93LCBhbmQgLnJldHVybiAoc2VlIGRlZmluZUl0ZXJhdG9yTWV0aG9kcykuXG4gICAgdGhpcy5faW52b2tlID0gZW5xdWV1ZTtcbiAgfVxuXG4gIGRlZmluZUl0ZXJhdG9yTWV0aG9kcyhBc3luY0l0ZXJhdG9yLnByb3RvdHlwZSk7XG4gIEFzeW5jSXRlcmF0b3IucHJvdG90eXBlW2FzeW5jSXRlcmF0b3JTeW1ib2xdID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuICBleHBvcnRzLkFzeW5jSXRlcmF0b3IgPSBBc3luY0l0ZXJhdG9yO1xuXG4gIC8vIE5vdGUgdGhhdCBzaW1wbGUgYXN5bmMgZnVuY3Rpb25zIGFyZSBpbXBsZW1lbnRlZCBvbiB0b3Agb2ZcbiAgLy8gQXN5bmNJdGVyYXRvciBvYmplY3RzOyB0aGV5IGp1c3QgcmV0dXJuIGEgUHJvbWlzZSBmb3IgdGhlIHZhbHVlIG9mXG4gIC8vIHRoZSBmaW5hbCByZXN1bHQgcHJvZHVjZWQgYnkgdGhlIGl0ZXJhdG9yLlxuICBleHBvcnRzLmFzeW5jID0gZnVuY3Rpb24oaW5uZXJGbiwgb3V0ZXJGbiwgc2VsZiwgdHJ5TG9jc0xpc3QsIFByb21pc2VJbXBsKSB7XG4gICAgaWYgKFByb21pc2VJbXBsID09PSB2b2lkIDApIFByb21pc2VJbXBsID0gUHJvbWlzZTtcblxuICAgIHZhciBpdGVyID0gbmV3IEFzeW5jSXRlcmF0b3IoXG4gICAgICB3cmFwKGlubmVyRm4sIG91dGVyRm4sIHNlbGYsIHRyeUxvY3NMaXN0KSxcbiAgICAgIFByb21pc2VJbXBsXG4gICAgKTtcblxuICAgIHJldHVybiBleHBvcnRzLmlzR2VuZXJhdG9yRnVuY3Rpb24ob3V0ZXJGbilcbiAgICAgID8gaXRlciAvLyBJZiBvdXRlckZuIGlzIGEgZ2VuZXJhdG9yLCByZXR1cm4gdGhlIGZ1bGwgaXRlcmF0b3IuXG4gICAgICA6IGl0ZXIubmV4dCgpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XG4gICAgICAgICAgcmV0dXJuIHJlc3VsdC5kb25lID8gcmVzdWx0LnZhbHVlIDogaXRlci5uZXh0KCk7XG4gICAgICAgIH0pO1xuICB9O1xuXG4gIGZ1bmN0aW9uIG1ha2VJbnZva2VNZXRob2QoaW5uZXJGbiwgc2VsZiwgY29udGV4dCkge1xuICAgIHZhciBzdGF0ZSA9IEdlblN0YXRlU3VzcGVuZGVkU3RhcnQ7XG5cbiAgICByZXR1cm4gZnVuY3Rpb24gaW52b2tlKG1ldGhvZCwgYXJnKSB7XG4gICAgICBpZiAoc3RhdGUgPT09IEdlblN0YXRlRXhlY3V0aW5nKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkdlbmVyYXRvciBpcyBhbHJlYWR5IHJ1bm5pbmdcIik7XG4gICAgICB9XG5cbiAgICAgIGlmIChzdGF0ZSA9PT0gR2VuU3RhdGVDb21wbGV0ZWQpIHtcbiAgICAgICAgaWYgKG1ldGhvZCA9PT0gXCJ0aHJvd1wiKSB7XG4gICAgICAgICAgdGhyb3cgYXJnO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQmUgZm9yZ2l2aW5nLCBwZXIgMjUuMy4zLjMuMyBvZiB0aGUgc3BlYzpcbiAgICAgICAgLy8gaHR0cHM6Ly9wZW9wbGUubW96aWxsYS5vcmcvfmpvcmVuZG9yZmYvZXM2LWRyYWZ0Lmh0bWwjc2VjLWdlbmVyYXRvcnJlc3VtZVxuICAgICAgICByZXR1cm4gZG9uZVJlc3VsdCgpO1xuICAgICAgfVxuXG4gICAgICBjb250ZXh0Lm1ldGhvZCA9IG1ldGhvZDtcbiAgICAgIGNvbnRleHQuYXJnID0gYXJnO1xuXG4gICAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICB2YXIgZGVsZWdhdGUgPSBjb250ZXh0LmRlbGVnYXRlO1xuICAgICAgICBpZiAoZGVsZWdhdGUpIHtcbiAgICAgICAgICB2YXIgZGVsZWdhdGVSZXN1bHQgPSBtYXliZUludm9rZURlbGVnYXRlKGRlbGVnYXRlLCBjb250ZXh0KTtcbiAgICAgICAgICBpZiAoZGVsZWdhdGVSZXN1bHQpIHtcbiAgICAgICAgICAgIGlmIChkZWxlZ2F0ZVJlc3VsdCA9PT0gQ29udGludWVTZW50aW5lbCkgY29udGludWU7XG4gICAgICAgICAgICByZXR1cm4gZGVsZWdhdGVSZXN1bHQ7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNvbnRleHQubWV0aG9kID09PSBcIm5leHRcIikge1xuICAgICAgICAgIC8vIFNldHRpbmcgY29udGV4dC5fc2VudCBmb3IgbGVnYWN5IHN1cHBvcnQgb2YgQmFiZWwnc1xuICAgICAgICAgIC8vIGZ1bmN0aW9uLnNlbnQgaW1wbGVtZW50YXRpb24uXG4gICAgICAgICAgY29udGV4dC5zZW50ID0gY29udGV4dC5fc2VudCA9IGNvbnRleHQuYXJnO1xuXG4gICAgICAgIH0gZWxzZSBpZiAoY29udGV4dC5tZXRob2QgPT09IFwidGhyb3dcIikge1xuICAgICAgICAgIGlmIChzdGF0ZSA9PT0gR2VuU3RhdGVTdXNwZW5kZWRTdGFydCkge1xuICAgICAgICAgICAgc3RhdGUgPSBHZW5TdGF0ZUNvbXBsZXRlZDtcbiAgICAgICAgICAgIHRocm93IGNvbnRleHQuYXJnO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnRleHQuZGlzcGF0Y2hFeGNlcHRpb24oY29udGV4dC5hcmcpO1xuXG4gICAgICAgIH0gZWxzZSBpZiAoY29udGV4dC5tZXRob2QgPT09IFwicmV0dXJuXCIpIHtcbiAgICAgICAgICBjb250ZXh0LmFicnVwdChcInJldHVyblwiLCBjb250ZXh0LmFyZyk7XG4gICAgICAgIH1cblxuICAgICAgICBzdGF0ZSA9IEdlblN0YXRlRXhlY3V0aW5nO1xuXG4gICAgICAgIHZhciByZWNvcmQgPSB0cnlDYXRjaChpbm5lckZuLCBzZWxmLCBjb250ZXh0KTtcbiAgICAgICAgaWYgKHJlY29yZC50eXBlID09PSBcIm5vcm1hbFwiKSB7XG4gICAgICAgICAgLy8gSWYgYW4gZXhjZXB0aW9uIGlzIHRocm93biBmcm9tIGlubmVyRm4sIHdlIGxlYXZlIHN0YXRlID09PVxuICAgICAgICAgIC8vIEdlblN0YXRlRXhlY3V0aW5nIGFuZCBsb29wIGJhY2sgZm9yIGFub3RoZXIgaW52b2NhdGlvbi5cbiAgICAgICAgICBzdGF0ZSA9IGNvbnRleHQuZG9uZVxuICAgICAgICAgICAgPyBHZW5TdGF0ZUNvbXBsZXRlZFxuICAgICAgICAgICAgOiBHZW5TdGF0ZVN1c3BlbmRlZFlpZWxkO1xuXG4gICAgICAgICAgaWYgKHJlY29yZC5hcmcgPT09IENvbnRpbnVlU2VudGluZWwpIHtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB2YWx1ZTogcmVjb3JkLmFyZyxcbiAgICAgICAgICAgIGRvbmU6IGNvbnRleHQuZG9uZVxuICAgICAgICAgIH07XG5cbiAgICAgICAgfSBlbHNlIGlmIChyZWNvcmQudHlwZSA9PT0gXCJ0aHJvd1wiKSB7XG4gICAgICAgICAgc3RhdGUgPSBHZW5TdGF0ZUNvbXBsZXRlZDtcbiAgICAgICAgICAvLyBEaXNwYXRjaCB0aGUgZXhjZXB0aW9uIGJ5IGxvb3BpbmcgYmFjayBhcm91bmQgdG8gdGhlXG4gICAgICAgICAgLy8gY29udGV4dC5kaXNwYXRjaEV4Y2VwdGlvbihjb250ZXh0LmFyZykgY2FsbCBhYm92ZS5cbiAgICAgICAgICBjb250ZXh0Lm1ldGhvZCA9IFwidGhyb3dcIjtcbiAgICAgICAgICBjb250ZXh0LmFyZyA9IHJlY29yZC5hcmc7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgLy8gQ2FsbCBkZWxlZ2F0ZS5pdGVyYXRvcltjb250ZXh0Lm1ldGhvZF0oY29udGV4dC5hcmcpIGFuZCBoYW5kbGUgdGhlXG4gIC8vIHJlc3VsdCwgZWl0aGVyIGJ5IHJldHVybmluZyBhIHsgdmFsdWUsIGRvbmUgfSByZXN1bHQgZnJvbSB0aGVcbiAgLy8gZGVsZWdhdGUgaXRlcmF0b3IsIG9yIGJ5IG1vZGlmeWluZyBjb250ZXh0Lm1ldGhvZCBhbmQgY29udGV4dC5hcmcsXG4gIC8vIHNldHRpbmcgY29udGV4dC5kZWxlZ2F0ZSB0byBudWxsLCBhbmQgcmV0dXJuaW5nIHRoZSBDb250aW51ZVNlbnRpbmVsLlxuICBmdW5jdGlvbiBtYXliZUludm9rZURlbGVnYXRlKGRlbGVnYXRlLCBjb250ZXh0KSB7XG4gICAgdmFyIG1ldGhvZCA9IGRlbGVnYXRlLml0ZXJhdG9yW2NvbnRleHQubWV0aG9kXTtcbiAgICBpZiAobWV0aG9kID09PSB1bmRlZmluZWQpIHtcbiAgICAgIC8vIEEgLnRocm93IG9yIC5yZXR1cm4gd2hlbiB0aGUgZGVsZWdhdGUgaXRlcmF0b3IgaGFzIG5vIC50aHJvd1xuICAgICAgLy8gbWV0aG9kIGFsd2F5cyB0ZXJtaW5hdGVzIHRoZSB5aWVsZCogbG9vcC5cbiAgICAgIGNvbnRleHQuZGVsZWdhdGUgPSBudWxsO1xuXG4gICAgICBpZiAoY29udGV4dC5tZXRob2QgPT09IFwidGhyb3dcIikge1xuICAgICAgICAvLyBOb3RlOiBbXCJyZXR1cm5cIl0gbXVzdCBiZSB1c2VkIGZvciBFUzMgcGFyc2luZyBjb21wYXRpYmlsaXR5LlxuICAgICAgICBpZiAoZGVsZWdhdGUuaXRlcmF0b3JbXCJyZXR1cm5cIl0pIHtcbiAgICAgICAgICAvLyBJZiB0aGUgZGVsZWdhdGUgaXRlcmF0b3IgaGFzIGEgcmV0dXJuIG1ldGhvZCwgZ2l2ZSBpdCBhXG4gICAgICAgICAgLy8gY2hhbmNlIHRvIGNsZWFuIHVwLlxuICAgICAgICAgIGNvbnRleHQubWV0aG9kID0gXCJyZXR1cm5cIjtcbiAgICAgICAgICBjb250ZXh0LmFyZyA9IHVuZGVmaW5lZDtcbiAgICAgICAgICBtYXliZUludm9rZURlbGVnYXRlKGRlbGVnYXRlLCBjb250ZXh0KTtcblxuICAgICAgICAgIGlmIChjb250ZXh0Lm1ldGhvZCA9PT0gXCJ0aHJvd1wiKSB7XG4gICAgICAgICAgICAvLyBJZiBtYXliZUludm9rZURlbGVnYXRlKGNvbnRleHQpIGNoYW5nZWQgY29udGV4dC5tZXRob2QgZnJvbVxuICAgICAgICAgICAgLy8gXCJyZXR1cm5cIiB0byBcInRocm93XCIsIGxldCB0aGF0IG92ZXJyaWRlIHRoZSBUeXBlRXJyb3IgYmVsb3cuXG4gICAgICAgICAgICByZXR1cm4gQ29udGludWVTZW50aW5lbDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBjb250ZXh0Lm1ldGhvZCA9IFwidGhyb3dcIjtcbiAgICAgICAgY29udGV4dC5hcmcgPSBuZXcgVHlwZUVycm9yKFxuICAgICAgICAgIFwiVGhlIGl0ZXJhdG9yIGRvZXMgbm90IHByb3ZpZGUgYSAndGhyb3cnIG1ldGhvZFwiKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7XG4gICAgfVxuXG4gICAgdmFyIHJlY29yZCA9IHRyeUNhdGNoKG1ldGhvZCwgZGVsZWdhdGUuaXRlcmF0b3IsIGNvbnRleHQuYXJnKTtcblxuICAgIGlmIChyZWNvcmQudHlwZSA9PT0gXCJ0aHJvd1wiKSB7XG4gICAgICBjb250ZXh0Lm1ldGhvZCA9IFwidGhyb3dcIjtcbiAgICAgIGNvbnRleHQuYXJnID0gcmVjb3JkLmFyZztcbiAgICAgIGNvbnRleHQuZGVsZWdhdGUgPSBudWxsO1xuICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7XG4gICAgfVxuXG4gICAgdmFyIGluZm8gPSByZWNvcmQuYXJnO1xuXG4gICAgaWYgKCEgaW5mbykge1xuICAgICAgY29udGV4dC5tZXRob2QgPSBcInRocm93XCI7XG4gICAgICBjb250ZXh0LmFyZyA9IG5ldyBUeXBlRXJyb3IoXCJpdGVyYXRvciByZXN1bHQgaXMgbm90IGFuIG9iamVjdFwiKTtcbiAgICAgIGNvbnRleHQuZGVsZWdhdGUgPSBudWxsO1xuICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7XG4gICAgfVxuXG4gICAgaWYgKGluZm8uZG9uZSkge1xuICAgICAgLy8gQXNzaWduIHRoZSByZXN1bHQgb2YgdGhlIGZpbmlzaGVkIGRlbGVnYXRlIHRvIHRoZSB0ZW1wb3JhcnlcbiAgICAgIC8vIHZhcmlhYmxlIHNwZWNpZmllZCBieSBkZWxlZ2F0ZS5yZXN1bHROYW1lIChzZWUgZGVsZWdhdGVZaWVsZCkuXG4gICAgICBjb250ZXh0W2RlbGVnYXRlLnJlc3VsdE5hbWVdID0gaW5mby52YWx1ZTtcblxuICAgICAgLy8gUmVzdW1lIGV4ZWN1dGlvbiBhdCB0aGUgZGVzaXJlZCBsb2NhdGlvbiAoc2VlIGRlbGVnYXRlWWllbGQpLlxuICAgICAgY29udGV4dC5uZXh0ID0gZGVsZWdhdGUubmV4dExvYztcblxuICAgICAgLy8gSWYgY29udGV4dC5tZXRob2Qgd2FzIFwidGhyb3dcIiBidXQgdGhlIGRlbGVnYXRlIGhhbmRsZWQgdGhlXG4gICAgICAvLyBleGNlcHRpb24sIGxldCB0aGUgb3V0ZXIgZ2VuZXJhdG9yIHByb2NlZWQgbm9ybWFsbHkuIElmXG4gICAgICAvLyBjb250ZXh0Lm1ldGhvZCB3YXMgXCJuZXh0XCIsIGZvcmdldCBjb250ZXh0LmFyZyBzaW5jZSBpdCBoYXMgYmVlblxuICAgICAgLy8gXCJjb25zdW1lZFwiIGJ5IHRoZSBkZWxlZ2F0ZSBpdGVyYXRvci4gSWYgY29udGV4dC5tZXRob2Qgd2FzXG4gICAgICAvLyBcInJldHVyblwiLCBhbGxvdyB0aGUgb3JpZ2luYWwgLnJldHVybiBjYWxsIHRvIGNvbnRpbnVlIGluIHRoZVxuICAgICAgLy8gb3V0ZXIgZ2VuZXJhdG9yLlxuICAgICAgaWYgKGNvbnRleHQubWV0aG9kICE9PSBcInJldHVyblwiKSB7XG4gICAgICAgIGNvbnRleHQubWV0aG9kID0gXCJuZXh0XCI7XG4gICAgICAgIGNvbnRleHQuYXJnID0gdW5kZWZpbmVkO1xuICAgICAgfVxuXG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFJlLXlpZWxkIHRoZSByZXN1bHQgcmV0dXJuZWQgYnkgdGhlIGRlbGVnYXRlIG1ldGhvZC5cbiAgICAgIHJldHVybiBpbmZvO1xuICAgIH1cblxuICAgIC8vIFRoZSBkZWxlZ2F0ZSBpdGVyYXRvciBpcyBmaW5pc2hlZCwgc28gZm9yZ2V0IGl0IGFuZCBjb250aW51ZSB3aXRoXG4gICAgLy8gdGhlIG91dGVyIGdlbmVyYXRvci5cbiAgICBjb250ZXh0LmRlbGVnYXRlID0gbnVsbDtcbiAgICByZXR1cm4gQ29udGludWVTZW50aW5lbDtcbiAgfVxuXG4gIC8vIERlZmluZSBHZW5lcmF0b3IucHJvdG90eXBlLntuZXh0LHRocm93LHJldHVybn0gaW4gdGVybXMgb2YgdGhlXG4gIC8vIHVuaWZpZWQgLl9pbnZva2UgaGVscGVyIG1ldGhvZC5cbiAgZGVmaW5lSXRlcmF0b3JNZXRob2RzKEdwKTtcblxuICBkZWZpbmUoR3AsIHRvU3RyaW5nVGFnU3ltYm9sLCBcIkdlbmVyYXRvclwiKTtcblxuICAvLyBBIEdlbmVyYXRvciBzaG91bGQgYWx3YXlzIHJldHVybiBpdHNlbGYgYXMgdGhlIGl0ZXJhdG9yIG9iamVjdCB3aGVuIHRoZVxuICAvLyBAQGl0ZXJhdG9yIGZ1bmN0aW9uIGlzIGNhbGxlZCBvbiBpdC4gU29tZSBicm93c2VycycgaW1wbGVtZW50YXRpb25zIG9mIHRoZVxuICAvLyBpdGVyYXRvciBwcm90b3R5cGUgY2hhaW4gaW5jb3JyZWN0bHkgaW1wbGVtZW50IHRoaXMsIGNhdXNpbmcgdGhlIEdlbmVyYXRvclxuICAvLyBvYmplY3QgdG8gbm90IGJlIHJldHVybmVkIGZyb20gdGhpcyBjYWxsLiBUaGlzIGVuc3VyZXMgdGhhdCBkb2Vzbid0IGhhcHBlbi5cbiAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9mYWNlYm9vay9yZWdlbmVyYXRvci9pc3N1ZXMvMjc0IGZvciBtb3JlIGRldGFpbHMuXG4gIEdwW2l0ZXJhdG9yU3ltYm9sXSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIEdwLnRvU3RyaW5nID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIFwiW29iamVjdCBHZW5lcmF0b3JdXCI7XG4gIH07XG5cbiAgZnVuY3Rpb24gcHVzaFRyeUVudHJ5KGxvY3MpIHtcbiAgICB2YXIgZW50cnkgPSB7IHRyeUxvYzogbG9jc1swXSB9O1xuXG4gICAgaWYgKDEgaW4gbG9jcykge1xuICAgICAgZW50cnkuY2F0Y2hMb2MgPSBsb2NzWzFdO1xuICAgIH1cblxuICAgIGlmICgyIGluIGxvY3MpIHtcbiAgICAgIGVudHJ5LmZpbmFsbHlMb2MgPSBsb2NzWzJdO1xuICAgICAgZW50cnkuYWZ0ZXJMb2MgPSBsb2NzWzNdO1xuICAgIH1cblxuICAgIHRoaXMudHJ5RW50cmllcy5wdXNoKGVudHJ5KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlc2V0VHJ5RW50cnkoZW50cnkpIHtcbiAgICB2YXIgcmVjb3JkID0gZW50cnkuY29tcGxldGlvbiB8fCB7fTtcbiAgICByZWNvcmQudHlwZSA9IFwibm9ybWFsXCI7XG4gICAgZGVsZXRlIHJlY29yZC5hcmc7XG4gICAgZW50cnkuY29tcGxldGlvbiA9IHJlY29yZDtcbiAgfVxuXG4gIGZ1bmN0aW9uIENvbnRleHQodHJ5TG9jc0xpc3QpIHtcbiAgICAvLyBUaGUgcm9vdCBlbnRyeSBvYmplY3QgKGVmZmVjdGl2ZWx5IGEgdHJ5IHN0YXRlbWVudCB3aXRob3V0IGEgY2F0Y2hcbiAgICAvLyBvciBhIGZpbmFsbHkgYmxvY2spIGdpdmVzIHVzIGEgcGxhY2UgdG8gc3RvcmUgdmFsdWVzIHRocm93biBmcm9tXG4gICAgLy8gbG9jYXRpb25zIHdoZXJlIHRoZXJlIGlzIG5vIGVuY2xvc2luZyB0cnkgc3RhdGVtZW50LlxuICAgIHRoaXMudHJ5RW50cmllcyA9IFt7IHRyeUxvYzogXCJyb290XCIgfV07XG4gICAgdHJ5TG9jc0xpc3QuZm9yRWFjaChwdXNoVHJ5RW50cnksIHRoaXMpO1xuICAgIHRoaXMucmVzZXQodHJ1ZSk7XG4gIH1cblxuICBleHBvcnRzLmtleXMgPSBmdW5jdGlvbihvYmplY3QpIHtcbiAgICB2YXIga2V5cyA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvYmplY3QpIHtcbiAgICAgIGtleXMucHVzaChrZXkpO1xuICAgIH1cbiAgICBrZXlzLnJldmVyc2UoKTtcblxuICAgIC8vIFJhdGhlciB0aGFuIHJldHVybmluZyBhbiBvYmplY3Qgd2l0aCBhIG5leHQgbWV0aG9kLCB3ZSBrZWVwXG4gICAgLy8gdGhpbmdzIHNpbXBsZSBhbmQgcmV0dXJuIHRoZSBuZXh0IGZ1bmN0aW9uIGl0c2VsZi5cbiAgICByZXR1cm4gZnVuY3Rpb24gbmV4dCgpIHtcbiAgICAgIHdoaWxlIChrZXlzLmxlbmd0aCkge1xuICAgICAgICB2YXIga2V5ID0ga2V5cy5wb3AoKTtcbiAgICAgICAgaWYgKGtleSBpbiBvYmplY3QpIHtcbiAgICAgICAgICBuZXh0LnZhbHVlID0ga2V5O1xuICAgICAgICAgIG5leHQuZG9uZSA9IGZhbHNlO1xuICAgICAgICAgIHJldHVybiBuZXh0O1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFRvIGF2b2lkIGNyZWF0aW5nIGFuIGFkZGl0aW9uYWwgb2JqZWN0LCB3ZSBqdXN0IGhhbmcgdGhlIC52YWx1ZVxuICAgICAgLy8gYW5kIC5kb25lIHByb3BlcnRpZXMgb2ZmIHRoZSBuZXh0IGZ1bmN0aW9uIG9iamVjdCBpdHNlbGYuIFRoaXNcbiAgICAgIC8vIGFsc28gZW5zdXJlcyB0aGF0IHRoZSBtaW5pZmllciB3aWxsIG5vdCBhbm9ueW1pemUgdGhlIGZ1bmN0aW9uLlxuICAgICAgbmV4dC5kb25lID0gdHJ1ZTtcbiAgICAgIHJldHVybiBuZXh0O1xuICAgIH07XG4gIH07XG5cbiAgZnVuY3Rpb24gdmFsdWVzKGl0ZXJhYmxlKSB7XG4gICAgaWYgKGl0ZXJhYmxlKSB7XG4gICAgICB2YXIgaXRlcmF0b3JNZXRob2QgPSBpdGVyYWJsZVtpdGVyYXRvclN5bWJvbF07XG4gICAgICBpZiAoaXRlcmF0b3JNZXRob2QpIHtcbiAgICAgICAgcmV0dXJuIGl0ZXJhdG9yTWV0aG9kLmNhbGwoaXRlcmFibGUpO1xuICAgICAgfVxuXG4gICAgICBpZiAodHlwZW9mIGl0ZXJhYmxlLm5leHQgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICByZXR1cm4gaXRlcmFibGU7XG4gICAgICB9XG5cbiAgICAgIGlmICghaXNOYU4oaXRlcmFibGUubGVuZ3RoKSkge1xuICAgICAgICB2YXIgaSA9IC0xLCBuZXh0ID0gZnVuY3Rpb24gbmV4dCgpIHtcbiAgICAgICAgICB3aGlsZSAoKytpIDwgaXRlcmFibGUubGVuZ3RoKSB7XG4gICAgICAgICAgICBpZiAoaGFzT3duLmNhbGwoaXRlcmFibGUsIGkpKSB7XG4gICAgICAgICAgICAgIG5leHQudmFsdWUgPSBpdGVyYWJsZVtpXTtcbiAgICAgICAgICAgICAgbmV4dC5kb25lID0gZmFsc2U7XG4gICAgICAgICAgICAgIHJldHVybiBuZXh0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIG5leHQudmFsdWUgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgbmV4dC5kb25lID0gdHJ1ZTtcblxuICAgICAgICAgIHJldHVybiBuZXh0O1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBuZXh0Lm5leHQgPSBuZXh0O1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFJldHVybiBhbiBpdGVyYXRvciB3aXRoIG5vIHZhbHVlcy5cbiAgICByZXR1cm4geyBuZXh0OiBkb25lUmVzdWx0IH07XG4gIH1cbiAgZXhwb3J0cy52YWx1ZXMgPSB2YWx1ZXM7XG5cbiAgZnVuY3Rpb24gZG9uZVJlc3VsdCgpIHtcbiAgICByZXR1cm4geyB2YWx1ZTogdW5kZWZpbmVkLCBkb25lOiB0cnVlIH07XG4gIH1cblxuICBDb250ZXh0LnByb3RvdHlwZSA9IHtcbiAgICBjb25zdHJ1Y3RvcjogQ29udGV4dCxcblxuICAgIHJlc2V0OiBmdW5jdGlvbihza2lwVGVtcFJlc2V0KSB7XG4gICAgICB0aGlzLnByZXYgPSAwO1xuICAgICAgdGhpcy5uZXh0ID0gMDtcbiAgICAgIC8vIFJlc2V0dGluZyBjb250ZXh0Ll9zZW50IGZvciBsZWdhY3kgc3VwcG9ydCBvZiBCYWJlbCdzXG4gICAgICAvLyBmdW5jdGlvbi5zZW50IGltcGxlbWVudGF0aW9uLlxuICAgICAgdGhpcy5zZW50ID0gdGhpcy5fc2VudCA9IHVuZGVmaW5lZDtcbiAgICAgIHRoaXMuZG9uZSA9IGZhbHNlO1xuICAgICAgdGhpcy5kZWxlZ2F0ZSA9IG51bGw7XG5cbiAgICAgIHRoaXMubWV0aG9kID0gXCJuZXh0XCI7XG4gICAgICB0aGlzLmFyZyA9IHVuZGVmaW5lZDtcblxuICAgICAgdGhpcy50cnlFbnRyaWVzLmZvckVhY2gocmVzZXRUcnlFbnRyeSk7XG5cbiAgICAgIGlmICghc2tpcFRlbXBSZXNldCkge1xuICAgICAgICBmb3IgKHZhciBuYW1lIGluIHRoaXMpIHtcbiAgICAgICAgICAvLyBOb3Qgc3VyZSBhYm91dCB0aGUgb3B0aW1hbCBvcmRlciBvZiB0aGVzZSBjb25kaXRpb25zOlxuICAgICAgICAgIGlmIChuYW1lLmNoYXJBdCgwKSA9PT0gXCJ0XCIgJiZcbiAgICAgICAgICAgICAgaGFzT3duLmNhbGwodGhpcywgbmFtZSkgJiZcbiAgICAgICAgICAgICAgIWlzTmFOKCtuYW1lLnNsaWNlKDEpKSkge1xuICAgICAgICAgICAgdGhpc1tuYW1lXSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuXG4gICAgc3RvcDogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLmRvbmUgPSB0cnVlO1xuXG4gICAgICB2YXIgcm9vdEVudHJ5ID0gdGhpcy50cnlFbnRyaWVzWzBdO1xuICAgICAgdmFyIHJvb3RSZWNvcmQgPSByb290RW50cnkuY29tcGxldGlvbjtcbiAgICAgIGlmIChyb290UmVjb3JkLnR5cGUgPT09IFwidGhyb3dcIikge1xuICAgICAgICB0aHJvdyByb290UmVjb3JkLmFyZztcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRoaXMucnZhbDtcbiAgICB9LFxuXG4gICAgZGlzcGF0Y2hFeGNlcHRpb246IGZ1bmN0aW9uKGV4Y2VwdGlvbikge1xuICAgICAgaWYgKHRoaXMuZG9uZSkge1xuICAgICAgICB0aHJvdyBleGNlcHRpb247XG4gICAgICB9XG5cbiAgICAgIHZhciBjb250ZXh0ID0gdGhpcztcbiAgICAgIGZ1bmN0aW9uIGhhbmRsZShsb2MsIGNhdWdodCkge1xuICAgICAgICByZWNvcmQudHlwZSA9IFwidGhyb3dcIjtcbiAgICAgICAgcmVjb3JkLmFyZyA9IGV4Y2VwdGlvbjtcbiAgICAgICAgY29udGV4dC5uZXh0ID0gbG9jO1xuXG4gICAgICAgIGlmIChjYXVnaHQpIHtcbiAgICAgICAgICAvLyBJZiB0aGUgZGlzcGF0Y2hlZCBleGNlcHRpb24gd2FzIGNhdWdodCBieSBhIGNhdGNoIGJsb2NrLFxuICAgICAgICAgIC8vIHRoZW4gbGV0IHRoYXQgY2F0Y2ggYmxvY2sgaGFuZGxlIHRoZSBleGNlcHRpb24gbm9ybWFsbHkuXG4gICAgICAgICAgY29udGV4dC5tZXRob2QgPSBcIm5leHRcIjtcbiAgICAgICAgICBjb250ZXh0LmFyZyA9IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAhISBjYXVnaHQ7XG4gICAgICB9XG5cbiAgICAgIGZvciAodmFyIGkgPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHtcbiAgICAgICAgdmFyIGVudHJ5ID0gdGhpcy50cnlFbnRyaWVzW2ldO1xuICAgICAgICB2YXIgcmVjb3JkID0gZW50cnkuY29tcGxldGlvbjtcblxuICAgICAgICBpZiAoZW50cnkudHJ5TG9jID09PSBcInJvb3RcIikge1xuICAgICAgICAgIC8vIEV4Y2VwdGlvbiB0aHJvd24gb3V0c2lkZSBvZiBhbnkgdHJ5IGJsb2NrIHRoYXQgY291bGQgaGFuZGxlXG4gICAgICAgICAgLy8gaXQsIHNvIHNldCB0aGUgY29tcGxldGlvbiB2YWx1ZSBvZiB0aGUgZW50aXJlIGZ1bmN0aW9uIHRvXG4gICAgICAgICAgLy8gdGhyb3cgdGhlIGV4Y2VwdGlvbi5cbiAgICAgICAgICByZXR1cm4gaGFuZGxlKFwiZW5kXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGVudHJ5LnRyeUxvYyA8PSB0aGlzLnByZXYpIHtcbiAgICAgICAgICB2YXIgaGFzQ2F0Y2ggPSBoYXNPd24uY2FsbChlbnRyeSwgXCJjYXRjaExvY1wiKTtcbiAgICAgICAgICB2YXIgaGFzRmluYWxseSA9IGhhc093bi5jYWxsKGVudHJ5LCBcImZpbmFsbHlMb2NcIik7XG5cbiAgICAgICAgICBpZiAoaGFzQ2F0Y2ggJiYgaGFzRmluYWxseSkge1xuICAgICAgICAgICAgaWYgKHRoaXMucHJldiA8IGVudHJ5LmNhdGNoTG9jKSB7XG4gICAgICAgICAgICAgIHJldHVybiBoYW5kbGUoZW50cnkuY2F0Y2hMb2MsIHRydWUpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnByZXYgPCBlbnRyeS5maW5hbGx5TG9jKSB7XG4gICAgICAgICAgICAgIHJldHVybiBoYW5kbGUoZW50cnkuZmluYWxseUxvYyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICB9IGVsc2UgaWYgKGhhc0NhdGNoKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5wcmV2IDwgZW50cnkuY2F0Y2hMb2MpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZShlbnRyeS5jYXRjaExvYywgdHJ1ZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICB9IGVsc2UgaWYgKGhhc0ZpbmFsbHkpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnByZXYgPCBlbnRyeS5maW5hbGx5TG9jKSB7XG4gICAgICAgICAgICAgIHJldHVybiBoYW5kbGUoZW50cnkuZmluYWxseUxvYyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwidHJ5IHN0YXRlbWVudCB3aXRob3V0IGNhdGNoIG9yIGZpbmFsbHlcIik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcblxuICAgIGFicnVwdDogZnVuY3Rpb24odHlwZSwgYXJnKSB7XG4gICAgICBmb3IgKHZhciBpID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7XG4gICAgICAgIHZhciBlbnRyeSA9IHRoaXMudHJ5RW50cmllc1tpXTtcbiAgICAgICAgaWYgKGVudHJ5LnRyeUxvYyA8PSB0aGlzLnByZXYgJiZcbiAgICAgICAgICAgIGhhc093bi5jYWxsKGVudHJ5LCBcImZpbmFsbHlMb2NcIikgJiZcbiAgICAgICAgICAgIHRoaXMucHJldiA8IGVudHJ5LmZpbmFsbHlMb2MpIHtcbiAgICAgICAgICB2YXIgZmluYWxseUVudHJ5ID0gZW50cnk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKGZpbmFsbHlFbnRyeSAmJlxuICAgICAgICAgICh0eXBlID09PSBcImJyZWFrXCIgfHxcbiAgICAgICAgICAgdHlwZSA9PT0gXCJjb250aW51ZVwiKSAmJlxuICAgICAgICAgIGZpbmFsbHlFbnRyeS50cnlMb2MgPD0gYXJnICYmXG4gICAgICAgICAgYXJnIDw9IGZpbmFsbHlFbnRyeS5maW5hbGx5TG9jKSB7XG4gICAgICAgIC8vIElnbm9yZSB0aGUgZmluYWxseSBlbnRyeSBpZiBjb250cm9sIGlzIG5vdCBqdW1waW5nIHRvIGFcbiAgICAgICAgLy8gbG9jYXRpb24gb3V0c2lkZSB0aGUgdHJ5L2NhdGNoIGJsb2NrLlxuICAgICAgICBmaW5hbGx5RW50cnkgPSBudWxsO1xuICAgICAgfVxuXG4gICAgICB2YXIgcmVjb3JkID0gZmluYWxseUVudHJ5ID8gZmluYWxseUVudHJ5LmNvbXBsZXRpb24gOiB7fTtcbiAgICAgIHJlY29yZC50eXBlID0gdHlwZTtcbiAgICAgIHJlY29yZC5hcmcgPSBhcmc7XG5cbiAgICAgIGlmIChmaW5hbGx5RW50cnkpIHtcbiAgICAgICAgdGhpcy5tZXRob2QgPSBcIm5leHRcIjtcbiAgICAgICAgdGhpcy5uZXh0ID0gZmluYWxseUVudHJ5LmZpbmFsbHlMb2M7XG4gICAgICAgIHJldHVybiBDb250aW51ZVNlbnRpbmVsO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcy5jb21wbGV0ZShyZWNvcmQpO1xuICAgIH0sXG5cbiAgICBjb21wbGV0ZTogZnVuY3Rpb24ocmVjb3JkLCBhZnRlckxvYykge1xuICAgICAgaWYgKHJlY29yZC50eXBlID09PSBcInRocm93XCIpIHtcbiAgICAgICAgdGhyb3cgcmVjb3JkLmFyZztcbiAgICAgIH1cblxuICAgICAgaWYgKHJlY29yZC50eXBlID09PSBcImJyZWFrXCIgfHxcbiAgICAgICAgICByZWNvcmQudHlwZSA9PT0gXCJjb250aW51ZVwiKSB7XG4gICAgICAgIHRoaXMubmV4dCA9IHJlY29yZC5hcmc7XG4gICAgICB9IGVsc2UgaWYgKHJlY29yZC50eXBlID09PSBcInJldHVyblwiKSB7XG4gICAgICAgIHRoaXMucnZhbCA9IHRoaXMuYXJnID0gcmVjb3JkLmFyZztcbiAgICAgICAgdGhpcy5tZXRob2QgPSBcInJldHVyblwiO1xuICAgICAgICB0aGlzLm5leHQgPSBcImVuZFwiO1xuICAgICAgfSBlbHNlIGlmIChyZWNvcmQudHlwZSA9PT0gXCJub3JtYWxcIiAmJiBhZnRlckxvYykge1xuICAgICAgICB0aGlzLm5leHQgPSBhZnRlckxvYztcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7XG4gICAgfSxcblxuICAgIGZpbmlzaDogZnVuY3Rpb24oZmluYWxseUxvYykge1xuICAgICAgZm9yICh2YXIgaSA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge1xuICAgICAgICB2YXIgZW50cnkgPSB0aGlzLnRyeUVudHJpZXNbaV07XG4gICAgICAgIGlmIChlbnRyeS5maW5hbGx5TG9jID09PSBmaW5hbGx5TG9jKSB7XG4gICAgICAgICAgdGhpcy5jb21wbGV0ZShlbnRyeS5jb21wbGV0aW9uLCBlbnRyeS5hZnRlckxvYyk7XG4gICAgICAgICAgcmVzZXRUcnlFbnRyeShlbnRyeSk7XG4gICAgICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuXG4gICAgXCJjYXRjaFwiOiBmdW5jdGlvbih0cnlMb2MpIHtcbiAgICAgIGZvciAodmFyIGkgPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHtcbiAgICAgICAgdmFyIGVudHJ5ID0gdGhpcy50cnlFbnRyaWVzW2ldO1xuICAgICAgICBpZiAoZW50cnkudHJ5TG9jID09PSB0cnlMb2MpIHtcbiAgICAgICAgICB2YXIgcmVjb3JkID0gZW50cnkuY29tcGxldGlvbjtcbiAgICAgICAgICBpZiAocmVjb3JkLnR5cGUgPT09IFwidGhyb3dcIikge1xuICAgICAgICAgICAgdmFyIHRocm93biA9IHJlY29yZC5hcmc7XG4gICAgICAgICAgICByZXNldFRyeUVudHJ5KGVudHJ5KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHRocm93bjtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBUaGUgY29udGV4dC5jYXRjaCBtZXRob2QgbXVzdCBvbmx5IGJlIGNhbGxlZCB3aXRoIGEgbG9jYXRpb25cbiAgICAgIC8vIGFyZ3VtZW50IHRoYXQgY29ycmVzcG9uZHMgdG8gYSBrbm93biBjYXRjaCBibG9jay5cbiAgICAgIHRocm93IG5ldyBFcnJvcihcImlsbGVnYWwgY2F0Y2ggYXR0ZW1wdFwiKTtcbiAgICB9LFxuXG4gICAgZGVsZWdhdGVZaWVsZDogZnVuY3Rpb24oaXRlcmFibGUsIHJlc3VsdE5hbWUsIG5leHRMb2MpIHtcbiAgICAgIHRoaXMuZGVsZWdhdGUgPSB7XG4gICAgICAgIGl0ZXJhdG9yOiB2YWx1ZXMoaXRlcmFibGUpLFxuICAgICAgICByZXN1bHROYW1lOiByZXN1bHROYW1lLFxuICAgICAgICBuZXh0TG9jOiBuZXh0TG9jXG4gICAgICB9O1xuXG4gICAgICBpZiAodGhpcy5tZXRob2QgPT09IFwibmV4dFwiKSB7XG4gICAgICAgIC8vIERlbGliZXJhdGVseSBmb3JnZXQgdGhlIGxhc3Qgc2VudCB2YWx1ZSBzbyB0aGF0IHdlIGRvbid0XG4gICAgICAgIC8vIGFjY2lkZW50YWxseSBwYXNzIGl0IG9uIHRvIHRoZSBkZWxlZ2F0ZS5cbiAgICAgICAgdGhpcy5hcmcgPSB1bmRlZmluZWQ7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBDb250aW51ZVNlbnRpbmVsO1xuICAgIH1cbiAgfTtcblxuICAvLyBSZWdhcmRsZXNzIG9mIHdoZXRoZXIgdGhpcyBzY3JpcHQgaXMgZXhlY3V0aW5nIGFzIGEgQ29tbW9uSlMgbW9kdWxlXG4gIC8vIG9yIG5vdCwgcmV0dXJuIHRoZSBydW50aW1lIG9iamVjdCBzbyB0aGF0IHdlIGNhbiBkZWNsYXJlIHRoZSB2YXJpYWJsZVxuICAvLyByZWdlbmVyYXRvclJ1bnRpbWUgaW4gdGhlIG91dGVyIHNjb3BlLCB3aGljaCBhbGxvd3MgdGhpcyBtb2R1bGUgdG8gYmVcbiAgLy8gaW5qZWN0ZWQgZWFzaWx5IGJ5IGBiaW4vcmVnZW5lcmF0b3IgLS1pbmNsdWRlLXJ1bnRpbWUgc2NyaXB0LmpzYC5cbiAgcmV0dXJuIGV4cG9ydHM7XG5cbn0oXG4gIC8vIElmIHRoaXMgc2NyaXB0IGlzIGV4ZWN1dGluZyBhcyBhIENvbW1vbkpTIG1vZHVsZSwgdXNlIG1vZHVsZS5leHBvcnRzXG4gIC8vIGFzIHRoZSByZWdlbmVyYXRvclJ1bnRpbWUgbmFtZXNwYWNlLiBPdGhlcndpc2UgY3JlYXRlIGEgbmV3IGVtcHR5XG4gIC8vIG9iamVjdC4gRWl0aGVyIHdheSwgdGhlIHJlc3VsdGluZyBvYmplY3Qgd2lsbCBiZSB1c2VkIHRvIGluaXRpYWxpemVcbiAgLy8gdGhlIHJlZ2VuZXJhdG9yUnVudGltZSB2YXJpYWJsZSBhdCB0aGUgdG9wIG9mIHRoaXMgZmlsZS5cbiAgdHlwZW9mIG1vZHVsZSA9PT0gXCJvYmplY3RcIiA/IG1vZHVsZS5leHBvcnRzIDoge31cbikpO1xuXG50cnkge1xuICByZWdlbmVyYXRvclJ1bnRpbWUgPSBydW50aW1lO1xufSBjYXRjaCAoYWNjaWRlbnRhbFN0cmljdE1vZGUpIHtcbiAgLy8gVGhpcyBtb2R1bGUgc2hvdWxkIG5vdCBiZSBydW5uaW5nIGluIHN0cmljdCBtb2RlLCBzbyB0aGUgYWJvdmVcbiAgLy8gYXNzaWdubWVudCBzaG91bGQgYWx3YXlzIHdvcmsgdW5sZXNzIHNvbWV0aGluZyBpcyBtaXNjb25maWd1cmVkLiBKdXN0XG4gIC8vIGluIGNhc2UgcnVudGltZS5qcyBhY2NpZGVudGFsbHkgcnVucyBpbiBzdHJpY3QgbW9kZSwgd2UgY2FuIGVzY2FwZVxuICAvLyBzdHJpY3QgbW9kZSB1c2luZyBhIGdsb2JhbCBGdW5jdGlvbiBjYWxsLiBUaGlzIGNvdWxkIGNvbmNlaXZhYmx5IGZhaWxcbiAgLy8gaWYgYSBDb250ZW50IFNlY3VyaXR5IFBvbGljeSBmb3JiaWRzIHVzaW5nIEZ1bmN0aW9uLCBidXQgaW4gdGhhdCBjYXNlXG4gIC8vIHRoZSBwcm9wZXIgc29sdXRpb24gaXMgdG8gZml4IHRoZSBhY2NpZGVudGFsIHN0cmljdCBtb2RlIHByb2JsZW0uIElmXG4gIC8vIHlvdSd2ZSBtaXNjb25maWd1cmVkIHlvdXIgYnVuZGxlciB0byBmb3JjZSBzdHJpY3QgbW9kZSBhbmQgYXBwbGllZCBhXG4gIC8vIENTUCB0byBmb3JiaWQgRnVuY3Rpb24sIGFuZCB5b3UncmUgbm90IHdpbGxpbmcgdG8gZml4IGVpdGhlciBvZiB0aG9zZVxuICAvLyBwcm9ibGVtcywgcGxlYXNlIGRldGFpbCB5b3VyIHVuaXF1ZSBwcmVkaWNhbWVudCBpbiBhIEdpdEh1YiBpc3N1ZS5cbiAgRnVuY3Rpb24oXCJyXCIsIFwicmVnZW5lcmF0b3JSdW50aW1lID0gclwiKShydW50aW1lKTtcbn1cbiIsIlxuLyoqXG4gKiBBZEd1YXJkIFNjcmlwdGxldHNcbiAqIFZlcnNpb24gMS4zLjIwXG4gKi9cblxuLyoqXG4gKiBSZXR1cm5zIHdpbGRjYXJkIHN5bWJvbFxuICogQHJldHVybnMge3N0cmluZ30gJyonXG4gKi9cbnZhciBnZXRXaWxkY2FyZFN5bWJvbCA9IGZ1bmN0aW9uIGdldFdpbGRjYXJkU3ltYm9sKCkge1xuICByZXR1cm4gJyonO1xufTtcblxuLyoqXG4gKiBHZW5lcmF0ZSByYW5kb20gc2l4IHN5bWJvbHMgaWRcbiAqL1xuZnVuY3Rpb24gcmFuZG9tSWQoKSB7XG4gIHJldHVybiBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSk7XG59XG5cbi8qKlxuICogU2V0IGdldHRlciBhbmQgc2V0dGVyIHRvIHByb3BlcnR5IGlmIGl0J3MgY29uZmlndXJhYmxlXG4gKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IHRhcmdldCBvYmplY3Qgd2l0aCBwcm9wZXJ0eVxuICogQHBhcmFtIHtzdHJpbmd9IHByb3BlcnR5IHByb3BlcnR5IG5hbWVcbiAqIEBwYXJhbSB7T2JqZWN0fSBkZXNjcmlwdG9yIGNvbnRhaW5zIGdldHRlciBhbmQgc2V0dGVyIGZ1bmN0aW9uc1xuICogQHJldHVybnMge2Jvb2xlYW59IGlzIG9wZXJhdGlvbiBzdWNjZXNzZnVsXG4gKi9cbmZ1bmN0aW9uIHNldFByb3BlcnR5QWNjZXNzKG9iamVjdCwgcHJvcGVydHksIGRlc2NyaXB0b3IpIHtcbiAgdmFyIGN1cnJlbnREZXNjcmlwdG9yID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHByb3BlcnR5KTtcblxuICBpZiAoY3VycmVudERlc2NyaXB0b3IgJiYgIWN1cnJlbnREZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmplY3QsIHByb3BlcnR5LCBkZXNjcmlwdG9yKTtcbiAgcmV0dXJuIHRydWU7XG59XG5cbi8qKlxuICogQHR5cGVkZWYgQ2hhaW5cbiAqIEBwcm9wZXJ0eSB7T2JqZWN0fSBiYXNlXG4gKiBAcHJvcGVydHkge3N0cmluZ30gcHJvcFxuICogQHByb3BlcnR5IHtzdHJpbmd9IFtjaGFpbl1cbiAqL1xuXG4vKipcbiAqIENoZWNrIGlmIHRoZSBwcm9wZXJ0eSBleGlzdHMgaW4gdGhlIGJhc2Ugb2JqZWN0IChyZWN1cnNpdmVseSlcbiAqXG4gKiBJZiBwcm9wZXJ0eSBkb2Vzbid0IGV4aXN0IGluIGJhc2Ugb2JqZWN0LFxuICogZGVmaW5lcyB0aGlzIHByb3BlcnR5IGFzICd1bmRlZmluZWQnXG4gKiBhbmQgcmV0dXJucyBiYXNlLCBwcm9wZXJ0eSBuYW1lIGFuZCByZW1haW5pbmcgcGFydCBvZiBwcm9wZXJ0eSBjaGFpblxuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSBiYXNlXG4gKiBAcGFyYW0ge3N0cmluZ30gY2hhaW5cbiAqIEByZXR1cm5zIHtDaGFpbn1cbiAqL1xuZnVuY3Rpb24gZ2V0UHJvcGVydHlJbkNoYWluKGJhc2UsIGNoYWluKSB7XG4gIHZhciBwb3MgPSBjaGFpbi5pbmRleE9mKCcuJyk7XG5cbiAgaWYgKHBvcyA9PT0gLTEpIHtcbiAgICByZXR1cm4ge1xuICAgICAgYmFzZTogYmFzZSxcbiAgICAgIHByb3A6IGNoYWluXG4gICAgfTtcbiAgfVxuXG4gIHZhciBwcm9wID0gY2hhaW4uc2xpY2UoMCwgcG9zKTsgLy8gaHR0cHM6Ly9naXRodWIuY29tL0FkZ3VhcmRUZWFtL1NjcmlwdGxldHMvaXNzdWVzLzEyOFxuXG4gIGlmIChiYXNlID09PSBudWxsKSB7XG4gICAgLy8gaWYgYmFzZSBpcyBudWxsLCByZXR1cm4gJ251bGwnIGFzIGJhc2UuXG4gICAgLy8gaXQncyBuZWVkZWQgZm9yIHRyaWdnZXJpbmcgdGhlIHJlYXNvbiBsb2dnaW5nIHdoaWxlIGRlYnVnZ2luZ1xuICAgIHJldHVybiB7XG4gICAgICBiYXNlOiBiYXNlLFxuICAgICAgcHJvcDogcHJvcCxcbiAgICAgIGNoYWluOiBjaGFpblxuICAgIH07XG4gIH1cblxuICB2YXIgbmV4dEJhc2UgPSBiYXNlW3Byb3BdO1xuICBjaGFpbiA9IGNoYWluLnNsaWNlKHBvcyArIDEpO1xuXG4gIGlmIChuZXh0QmFzZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgcmV0dXJuIGdldFByb3BlcnR5SW5DaGFpbihuZXh0QmFzZSwgY2hhaW4pO1xuICB9XG5cbiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGJhc2UsIHByb3AsIHtcbiAgICBjb25maWd1cmFibGU6IHRydWVcbiAgfSk7XG4gIHJldHVybiB7XG4gICAgYmFzZTogbmV4dEJhc2UsXG4gICAgcHJvcDogcHJvcCxcbiAgICBjaGFpbjogY2hhaW5cbiAgfTtcbn1cblxuLyoqXG4gKiBAdHlwZWRlZiBDaGFpblxuICogQHByb3BlcnR5IHtPYmplY3R9IGJhc2VcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBwcm9wXG4gKiBAcHJvcGVydHkge3N0cmluZ30gW2NoYWluXVxuICovXG5cbi8qKlxuICogQ2hlY2sgaWYgdGhlIHByb3BlcnR5IGV4aXN0cyBpbiB0aGUgYmFzZSBvYmplY3QgKHJlY3Vyc2l2ZWx5KS5cbiAqIFNpbWlsYXIgdG8gZ2V0UHJvcGVydHlJbkNoYWluIGJ1dCB1cGdyYWRlZCBmb3IganNvbi1wcnVuZTpcbiAqIGhhbmRsZSB3aWxkY2FyZCBwcm9wZXJ0aWVzIGFuZCBkb2VzIG5vdCBkZWZpbmUgbm9uZXhpc3RlbnQgYmFzZSBwcm9wZXJ0eSBhcyAndW5kZWZpbmVkJ1xuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSBiYXNlXG4gKiBAcGFyYW0ge3N0cmluZ30gY2hhaW5cbiAqIEBwYXJhbSB7Ym9vbGVhbn0gW2xvb2tUaHJvdWdoPWZhbHNlXVxuICogc2hvdWxkIHRoZSBtZXRob2QgbG9vayB0aHJvdWdoIGl0J3MgcHJvcHMgaW4gb3JkZXIgdG8gd2lsZGNhcmRcbiAqIEBwYXJhbSB7QXJyYXl9IFtvdXRwdXQ9W11dIHJlc3VsdCBhY2NcbiAqIEByZXR1cm5zIHtDaGFpbltdfSBhcnJheSBvZiBvYmplY3RzXG4gKi9cblxuZnVuY3Rpb24gZ2V0V2lsZGNhcmRQcm9wZXJ0eUluQ2hhaW4oYmFzZSwgY2hhaW4pIHtcbiAgdmFyIGxvb2tUaHJvdWdoID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiBmYWxzZTtcbiAgdmFyIG91dHB1dCA9IGFyZ3VtZW50cy5sZW5ndGggPiAzICYmIGFyZ3VtZW50c1szXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzNdIDogW107XG4gIHZhciBwb3MgPSBjaGFpbi5pbmRleE9mKCcuJyk7XG5cbiAgaWYgKHBvcyA9PT0gLTEpIHtcbiAgICAvLyBmb3IgcGF0aHMgbGlrZSAnYS5iLionIGV2ZXJ5IGZpbmFsIG5lc3RlZCBwcm9wIHNob3VsZCBiZSBwcm9jZXNzZWRcbiAgICBpZiAoY2hhaW4gPT09IGdldFdpbGRjYXJkU3ltYm9sKCkgfHwgY2hhaW4gPT09ICdbXScpIHtcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1yZXN0cmljdGVkLXN5bnRheFxuICAgICAgZm9yICh2YXIga2V5IGluIGJhc2UpIHtcbiAgICAgICAgLy8gdG8gcHJvY2VzcyBlYWNoIGtleSBpbiBiYXNlIGV4Y2VwdCBpbmhlcml0ZWQgb25lc1xuICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGJhc2UsIGtleSkpIHtcbiAgICAgICAgICBvdXRwdXQucHVzaCh7XG4gICAgICAgICAgICBiYXNlOiBiYXNlLFxuICAgICAgICAgICAgcHJvcDoga2V5XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgb3V0cHV0LnB1c2goe1xuICAgICAgICBiYXNlOiBiYXNlLFxuICAgICAgICBwcm9wOiBjaGFpblxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG91dHB1dDtcbiAgfVxuXG4gIHZhciBwcm9wID0gY2hhaW4uc2xpY2UoMCwgcG9zKTtcbiAgdmFyIHNob3VsZExvb2tUaHJvdWdoID0gcHJvcCA9PT0gJ1tdJyAmJiBBcnJheS5pc0FycmF5KGJhc2UpIHx8IHByb3AgPT09IGdldFdpbGRjYXJkU3ltYm9sKCkgJiYgYmFzZSBpbnN0YW5jZW9mIE9iamVjdDtcblxuICBpZiAoc2hvdWxkTG9va1Rocm91Z2gpIHtcbiAgICB2YXIgbmV4dFByb3AgPSBjaGFpbi5zbGljZShwb3MgKyAxKTtcbiAgICB2YXIgYmFzZUtleXMgPSBPYmplY3Qua2V5cyhiYXNlKTsgLy8gaWYgdGhlcmUgaXMgYSB3aWxkY2FyZCBwcm9wIGluIGlucHV0IGNoYWluIChlLmcuICdhZC4qLnNyYycgZm9yICdhZC4wLnNyYyBhZC4xLnNyYycpLFxuICAgIC8vIGVhY2ggb25lIG9mIGJhc2Uga2V5cyBzaG91bGQgYmUgY29uc2lkZXJlZCBhcyBhIHBvdGVudGlhbCBjaGFpbiBwcm9wIGluIGZpbmFsIHBhdGhcblxuICAgIGJhc2VLZXlzLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgdmFyIGl0ZW0gPSBiYXNlW2tleV07XG4gICAgICBnZXRXaWxkY2FyZFByb3BlcnR5SW5DaGFpbihpdGVtLCBuZXh0UHJvcCwgbG9va1Rocm91Z2gsIG91dHB1dCk7XG4gICAgfSk7XG4gIH1cblxuICB2YXIgbmV4dEJhc2UgPSBiYXNlW3Byb3BdO1xuICBjaGFpbiA9IGNoYWluLnNsaWNlKHBvcyArIDEpO1xuXG4gIGlmIChuZXh0QmFzZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgZ2V0V2lsZGNhcmRQcm9wZXJ0eUluQ2hhaW4obmV4dEJhc2UsIGNoYWluLCBsb29rVGhyb3VnaCwgb3V0cHV0KTtcbiAgfVxuXG4gIHJldHVybiBvdXRwdXQ7XG59XG5cbi8qKlxuICogRGV0ZXJtaW5lcyB3aGV0aGVyIHRoZSBwYXNzZWQgdmFsdWUgaXMgTmFOXG4gKiBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9KYXZhU2NyaXB0L1JlZmVyZW5jZS9HbG9iYWxfT2JqZWN0cy9OdW1iZXIvaXNOYU5cbiAqIEBwYXJhbSB7Kn0gbnVtXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAqL1xudmFyIG5hdGl2ZUlzTmFOID0gZnVuY3Rpb24gbmF0aXZlSXNOYU4obnVtKSB7XG4gIHZhciBuYXRpdmUgPSBOdW1iZXIuaXNOYU4gfHwgd2luZG93LmlzTmFOOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGNvbXBhdC9jb21wYXRcblxuICByZXR1cm4gbmF0aXZlKG51bSk7XG59O1xuLyoqXG4gKiBEZXRlcm1pbmVzIHdoZXRoZXIgdGhlIHBhc3NlZCB2YWx1ZSBpcyBhIGZpbml0ZSBudW1iZXJcbiAqIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL051bWJlci9pc0Zpbml0ZVxuICogQHBhcmFtIHsqfSBudW1cbiAqIEByZXR1cm5zIHtib29sZWFufVxuICovXG5cbnZhciBuYXRpdmVJc0Zpbml0ZSA9IGZ1bmN0aW9uIG5hdGl2ZUlzRmluaXRlKG51bSkge1xuICB2YXIgbmF0aXZlID0gTnVtYmVyLmlzRmluaXRlIHx8IHdpbmRvdy5pc0Zpbml0ZTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBjb21wYXQvY29tcGF0XG5cbiAgcmV0dXJuIG5hdGl2ZShudW0pO1xufTtcblxuLyoqXG4gKiBDb252ZXJ0cyBvYmplY3QgdG8gYXJyYXkgb2YgcGFpcnMuXG4gKiBPYmplY3QuZW50cmllcygpIHBvbHlmaWxsIGJlY2F1c2UgaXQgaXMgbm90IHN1cHBvcnRlZCBieSBJRVxuICogaHR0cHM6Ly9jYW5pdXNlLmNvbS8/c2VhcmNoPU9iamVjdC5lbnRyaWVzXG4gKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0XG4gKiBAcmV0dXJucyB7QXJyYXl9IGFycmF5IG9mIHBhaXJzXG4gKi9cbnZhciBnZXRPYmplY3RFbnRyaWVzID0gZnVuY3Rpb24gZ2V0T2JqZWN0RW50cmllcyhvYmplY3QpIHtcbiAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvYmplY3QpO1xuICB2YXIgZW50cmllcyA9IFtdO1xuICBrZXlzLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgIHJldHVybiBlbnRyaWVzLnB1c2goW2tleSwgb2JqZWN0W2tleV1dKTtcbiAgfSk7XG4gIHJldHVybiBlbnRyaWVzO1xufTtcbi8qKlxuICogQ29udmVydHMgYXJyYXkgb2YgcGFpcnMgdG8gb2JqZWN0LlxuICogT2JqZWN0LmZyb21FbnRyaWVzKCkgcG9seWZpbGwgYmVjYXVzZSBpdCBpcyBub3Qgc3VwcG9ydGVkIGJ5IElFXG4gKiBodHRwczovL2Nhbml1c2UuY29tLz9zZWFyY2g9T2JqZWN0LmZyb21FbnRyaWVzXG4gKiBAcGFyYW0ge0FycmF5fSBlbnRyaWVzIC0gYXJyYXkgb2YgcGFpcnNcbiAqIEByZXR1cm5zIHtPYmplY3R9XG4gKi9cblxudmFyIGdldE9iamVjdEZyb21FbnRyaWVzID0gZnVuY3Rpb24gZ2V0T2JqZWN0RnJvbUVudHJpZXMoZW50cmllcykge1xuICB2YXIgb3V0cHV0ID0gZW50cmllcy5yZWR1Y2UoZnVuY3Rpb24gKGFjYywgZWwpIHtcbiAgICB2YXIga2V5ID0gZWxbMF07XG4gICAgdmFyIHZhbHVlID0gZWxbMV07XG4gICAgYWNjW2tleV0gPSB2YWx1ZTtcbiAgICByZXR1cm4gYWNjO1xuICB9LCB7fSk7XG4gIHJldHVybiBvdXRwdXQ7XG59O1xuLyoqXG4gKiBDaGVja3Mgd2hldGhlciB0aGUgb2JqIGlzIGFuIGVtcHR5IG9iamVjdFxuICogQHBhcmFtIHtPYmplY3R9IG9ialxuICogQHJldHVybnMge2Jvb2xlYW59XG4gKi9cblxudmFyIGlzRW1wdHlPYmplY3QgPSBmdW5jdGlvbiBpc0VtcHR5T2JqZWN0KG9iaikge1xuICByZXR1cm4gT2JqZWN0LmtleXMob2JqKS5sZW5ndGggPT09IDA7XG59O1xuXG4vKipcbiAqIFN0cmluZy5wcm90b3R5cGUucmVwbGFjZUFsbCBwb2xpZmlsbFxuICogQHBhcmFtIHtzdHJpbmd9IGlucHV0IGlucHV0IHN0cmluZ1xuICogQHBhcmFtIHtzdHJpbmd9IHN1YnN0ciB0byBsb29rIGZvclxuICogQHBhcmFtIHtzdHJpbmd9IG5ld1N1YnN0ciByZXBsYWNlbWVudFxuICogQHJldHVybnMge3N0cmluZ31cbiAqL1xuXG52YXIgcmVwbGFjZUFsbCA9IGZ1bmN0aW9uIHJlcGxhY2VBbGwoaW5wdXQsIHN1YnN0ciwgbmV3U3Vic3RyKSB7XG4gIHJldHVybiBpbnB1dC5zcGxpdChzdWJzdHIpLmpvaW4obmV3U3Vic3RyKTtcbn07XG4vKipcbiAqIEVzY2FwZXMgc3BlY2lhbCBjaGFycyBpbiBzdHJpbmdcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHJcbiAqIEByZXR1cm5zIHtzdHJpbmd9XG4gKi9cblxudmFyIGVzY2FwZVJlZ0V4cCA9IGZ1bmN0aW9uIGVzY2FwZVJlZ0V4cChzdHIpIHtcbiAgcmV0dXJuIHN0ci5yZXBsYWNlKC9bLiorP14ke30oKXxbXFxdXFxcXF0vZywgJ1xcXFwkJicpO1xufTtcbi8qKlxuICogQ29udmVydHMgc2VhcmNoIHN0cmluZyB0byB0aGUgcmVnZXhwXG4gKiBUT0RPIHRoaW5rIGFib3V0IG5lc3RlZCBkZXBlbmRlbmNpZXMsIGJ1dCBiZSBjYXJlZnVsIHdpdGggZGVwZW5kZW5jeSBsb29wc1xuICogQHBhcmFtIHtzdHJpbmd9IHN0ciBzZWFyY2ggc3RyaW5nXG4gKiBAcmV0dXJucyB7UmVnRXhwfVxuICovXG5cbnZhciB0b1JlZ0V4cCA9IGZ1bmN0aW9uIHRvUmVnRXhwKHN0cikge1xuICBpZiAoIXN0ciB8fCBzdHIgPT09ICcnKSB7XG4gICAgdmFyIERFRkFVTFRfVkFMVUUgPSAnLj8nO1xuICAgIHJldHVybiBuZXcgUmVnRXhwKERFRkFVTFRfVkFMVUUpO1xuICB9XG5cbiAgaWYgKHN0clswXSA9PT0gJy8nICYmIHN0cltzdHIubGVuZ3RoIC0gMV0gPT09ICcvJykge1xuICAgIHJldHVybiBuZXcgUmVnRXhwKHN0ci5zbGljZSgxLCAtMSkpO1xuICB9XG5cbiAgdmFyIGVzY2FwZWQgPSBzdHIucmVwbGFjZSgvWy4qKz9eJHt9KCl8W1xcXVxcXFxdL2csICdcXFxcJCYnKTtcbiAgcmV0dXJuIG5ldyBSZWdFeHAoZXNjYXBlZCk7XG59O1xuLyoqXG4gKiBHZXQgc3RyaW5nIGJlZm9yZSByZWdleHAgZmlyc3QgbWF0Y2hcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHJcbiAqIEBwYXJhbSB7UmVnRXhwfSByeFxuICovXG5cbnZhciBnZXRCZWZvcmVSZWdFeHAgPSBmdW5jdGlvbiBnZXRCZWZvcmVSZWdFeHAoc3RyLCByeCkge1xuICB2YXIgaW5kZXggPSBzdHIuc2VhcmNoKHJ4KTtcbiAgcmV0dXJuIHN0ci5zdWJzdHJpbmcoMCwgaW5kZXgpO1xufTtcbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgdGhlIHN0cmluZyBzdGFydHMgd2l0aCB0aGUgc3Vic3RyaW5nXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RyIGZ1bGwgc3RyaW5nXG4gKiBAcGFyYW0ge3N0cmluZ30gcHJlZml4IHN1YnN0cmluZ1xuICogQHJldHVybnMge2Jvb2xlYW59XG4gKi9cblxudmFyIHN0YXJ0c1dpdGggPSBmdW5jdGlvbiBzdGFydHNXaXRoKHN0ciwgcHJlZml4KSB7XG4gIC8vIGlmIHN0ciA9PT0gJycsIChzdHIgJiYgZmFsc2UpIHdpbGwgcmV0dXJuICcnXG4gIC8vIHRoYXQncyB3aHkgaXQgaGFzIHRvIGJlICEhc3RyXG4gIHJldHVybiAhIXN0ciAmJiBzdHIuaW5kZXhPZihwcmVmaXgpID09PSAwO1xufTtcbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgdGhlIHN0cmluZyBlbmRzIHdpdGggdGhlIHN1YnN0cmluZ1xuICogQHBhcmFtIHtzdHJpbmd9IHN0ciBmdWxsIHN0cmluZ1xuICogQHBhcmFtIHtzdHJpbmd9IGVuZGluZyBzdWJzdHJpbmdcbiAqIEByZXR1cm5zIHtib29sZWFufVxuICovXG5cbnZhciBlbmRzV2l0aCA9IGZ1bmN0aW9uIGVuZHNXaXRoKHN0ciwgZW5kaW5nKSB7XG4gIC8vIGlmIHN0ciA9PT0gJycsIChzdHIgJiYgZmFsc2UpIHdpbGwgcmV0dXJuICcnXG4gIC8vIHRoYXQncyB3aHkgaXQgaGFzIHRvIGJlICEhc3RyXG4gIHJldHVybiAhIXN0ciAmJiBzdHIuaW5kZXhPZihlbmRpbmcpID09PSBzdHIubGVuZ3RoIC0gZW5kaW5nLmxlbmd0aDtcbn07XG52YXIgc3Vic3RyaW5nQWZ0ZXIgPSBmdW5jdGlvbiBzdWJzdHJpbmdBZnRlcihzdHIsIHNlcGFyYXRvcikge1xuICBpZiAoIXN0cikge1xuICAgIHJldHVybiBzdHI7XG4gIH1cblxuICB2YXIgaW5kZXggPSBzdHIuaW5kZXhPZihzZXBhcmF0b3IpO1xuICByZXR1cm4gaW5kZXggPCAwID8gJycgOiBzdHIuc3Vic3RyaW5nKGluZGV4ICsgc2VwYXJhdG9yLmxlbmd0aCk7XG59O1xudmFyIHN1YnN0cmluZ0JlZm9yZSA9IGZ1bmN0aW9uIHN1YnN0cmluZ0JlZm9yZShzdHIsIHNlcGFyYXRvcikge1xuICBpZiAoIXN0ciB8fCAhc2VwYXJhdG9yKSB7XG4gICAgcmV0dXJuIHN0cjtcbiAgfVxuXG4gIHZhciBpbmRleCA9IHN0ci5pbmRleE9mKHNlcGFyYXRvcik7XG4gIHJldHVybiBpbmRleCA8IDAgPyBzdHIgOiBzdHIuc3Vic3RyaW5nKDAsIGluZGV4KTtcbn07XG4vKipcbiAqIFdyYXAgc3RyIGluIHNpbmdsZSBxb3V0ZXMgYW5kIHJlcGxhY2VzIHNpbmdsZSBxdW90ZXMgdG8gZG91ZGxlIG9uZVxuICogQHBhcmFtIHtzdHJpbmd9IHN0clxuICovXG5cbnZhciB3cmFwSW5TaW5nbGVRdW90ZXMgPSBmdW5jdGlvbiB3cmFwSW5TaW5nbGVRdW90ZXMoc3RyKSB7XG4gIGlmIChzdHJbMF0gPT09ICdcXCcnICYmIHN0cltzdHIubGVuZ3RoIC0gMV0gPT09ICdcXCcnIHx8IHN0clswXSA9PT0gJ1wiJyAmJiBzdHJbc3RyLmxlbmd0aCAtIDFdID09PSAnXCInKSB7XG4gICAgc3RyID0gc3RyLnN1YnN0cmluZygxLCBzdHIubGVuZ3RoIC0gMSk7XG4gIH0gLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVzZWxlc3MtZXNjYXBlXG5cblxuICBzdHIgPSBzdHIucmVwbGFjZSgvXFwnL2csICdcIicpO1xuICByZXR1cm4gXCInXCIuY29uY2F0KHN0ciwgXCInXCIpO1xufTtcbi8qKlxuICogUmV0dXJucyBzdWJzdHJpbmcgZW5jbG9zZWQgaW4gdGhlIHdpZGVzdCBicmFjZXNcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHJcbiAqL1xuXG52YXIgZ2V0U3RyaW5nSW5CcmFjZXMgPSBmdW5jdGlvbiBnZXRTdHJpbmdJbkJyYWNlcyhzdHIpIHtcbiAgdmFyIGZpcnN0SW5kZXggPSBzdHIuaW5kZXhPZignKCcpO1xuICB2YXIgbGFzdEluZGV4ID0gc3RyLmxhc3RJbmRleE9mKCcpJyk7XG4gIHJldHVybiBzdHIuc3Vic3RyaW5nKGZpcnN0SW5kZXggKyAxLCBsYXN0SW5kZXgpO1xufTtcbi8qKlxuICogUHJlcGFyZXMgUlRDUGVlckNvbm5lY3Rpb24gY29uZmlnIGFzIHN0cmluZyBmb3IgcHJvcGVyIGxvZ2dpbmdcbiAqIEBwYXJhbSB7Kn0gY29uZmlnXG4gKiBAcmV0dXJucyB7c3RyaW5nfSBzdHJpbmdpZmllZCBjb25maWdcbiovXG5cbnZhciBjb252ZXJ0UnRjQ29uZmlnVG9TdHJpbmcgPSBmdW5jdGlvbiBjb252ZXJ0UnRjQ29uZmlnVG9TdHJpbmcoY29uZmlnKSB7XG4gIHZhciBVTkRFRl9TVFIgPSAndW5kZWZpbmVkJztcbiAgdmFyIHN0ciA9IFVOREVGX1NUUjtcblxuICBpZiAoY29uZmlnID09PSBudWxsKSB7XG4gICAgc3RyID0gJ251bGwnO1xuICB9IGVsc2UgaWYgKGNvbmZpZyBpbnN0YW5jZW9mIE9iamVjdCkge1xuICAgIHZhciBTRVJWRVJTX1BST1BfTkFNRSA9ICdpY2VTZXJ2ZXJzJztcbiAgICB2YXIgVVJMU19QUk9QX05BTUUgPSAndXJscyc7XG4gICAgLypcbiAgICAgICAgY29uc3QgZXhhbXBsZUNvbmZpZyA9IHtcbiAgICAgICAgICAgICdpY2VTZXJ2ZXJzJzogW1xuICAgICAgICAgICAgICAgICd1cmxzJzogWydzdHVuOjM1LjY2LjIwNi4xODg6NDQzJ10sXG4gICAgICAgICAgICBdLFxuICAgICAgICB9O1xuICAgICovXG5cbiAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGNvbmZpZywgU0VSVkVSU19QUk9QX05BTUUpICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChjb25maWdbU0VSVkVSU19QUk9QX05BTUVdWzBdLCBVUkxTX1BST1BfTkFNRSkgJiYgISFjb25maWdbU0VSVkVSU19QUk9QX05BTUVdWzBdW1VSTFNfUFJPUF9OQU1FXSkge1xuICAgICAgc3RyID0gY29uZmlnW1NFUlZFUlNfUFJPUF9OQU1FXVswXVtVUkxTX1BST1BfTkFNRV0udG9TdHJpbmcoKTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gc3RyO1xufTtcbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gTWF0Y2hEYXRhXG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IGlzSW52ZXJ0ZWRNYXRjaFxuICogQHByb3BlcnR5IHtSZWdFeHB9IG1hdGNoUmVnZXhwXG4gKi9cblxuLyoqXG4gKiBQYXJzZXMgbWF0Y2ggYXJnIHdpdGggcG9zc2libGUgbmVnYXRpb24gZm9yIG5vIG1hdGNoaW5nLlxuICogTmVlZGVkIGZvciBwcmV2ZW50LXNldFRpbWVvdXQsIHByZXZlbnQtc2V0SW50ZXJ2YWwsXG4gKiBwcmV2ZW50LXJlcXVlc3RBbmltYXRpb25GcmFtZSBhbmQgcHJldmVudC13aW5kb3ctb3BlblxuICogQHBhcmFtIHtzdHJpbmd9IG1hdGNoXG4gKiBAcmV0dXJucyB7TWF0Y2hEYXRhfVxuICovXG5cbnZhciBwYXJzZU1hdGNoQXJnID0gZnVuY3Rpb24gcGFyc2VNYXRjaEFyZyhtYXRjaCkge1xuICB2YXIgSU5WRVJUX01BUktFUiA9ICchJztcbiAgdmFyIGlzSW52ZXJ0ZWRNYXRjaCA9IHN0YXJ0c1dpdGgobWF0Y2gsIElOVkVSVF9NQVJLRVIpO1xuICB2YXIgbWF0Y2hWYWx1ZSA9IGlzSW52ZXJ0ZWRNYXRjaCA/IG1hdGNoLnNsaWNlKDEpIDogbWF0Y2g7XG4gIHZhciBtYXRjaFJlZ2V4cCA9IHRvUmVnRXhwKG1hdGNoVmFsdWUpO1xuICByZXR1cm4ge1xuICAgIGlzSW52ZXJ0ZWRNYXRjaDogaXNJbnZlcnRlZE1hdGNoLFxuICAgIG1hdGNoUmVnZXhwOiBtYXRjaFJlZ2V4cFxuICB9O1xufTtcbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gRGVsYXlEYXRhXG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IGlzSW52ZXJ0ZWREZWxheU1hdGNoXG4gKiBAcHJvcGVydHkge251bWJlcnxudWxsfSBkZWxheU1hdGNoXG4gKi9cblxuLyoqXG4gKiBQYXJzZXMgZGVsYXkgYXJnIHdpdGggcG9zc2libGUgbmVnYXRpb24gZm9yIG5vIG1hdGNoaW5nLlxuICogTmVlZGVkIGZvciBwcmV2ZW50LXNldFRpbWVvdXQgYW5kIHByZXZlbnQtc2V0SW50ZXJ2YWxcbiAqIEBwYXJhbSB7c3RyaW5nfSBkZWxheVxuICogQHJldHVybnMge0RlbGF5RGF0YX1cbiAqL1xuXG52YXIgcGFyc2VEZWxheUFyZyA9IGZ1bmN0aW9uIHBhcnNlRGVsYXlBcmcoZGVsYXkpIHtcbiAgdmFyIElOVkVSVF9NQVJLRVIgPSAnISc7XG4gIHZhciBpc0ludmVydGVkRGVsYXlNYXRjaCA9IHN0YXJ0c1dpdGgoZGVsYXksIElOVkVSVF9NQVJLRVIpO1xuICB2YXIgZGVsYXlWYWx1ZSA9IGlzSW52ZXJ0ZWREZWxheU1hdGNoID8gZGVsYXkuc2xpY2UoMSkgOiBkZWxheTtcbiAgZGVsYXlWYWx1ZSA9IHBhcnNlSW50KGRlbGF5VmFsdWUsIDEwKTtcbiAgdmFyIGRlbGF5TWF0Y2ggPSBuYXRpdmVJc05hTihkZWxheVZhbHVlKSA/IG51bGwgOiBkZWxheVZhbHVlO1xuICByZXR1cm4ge1xuICAgIGlzSW52ZXJ0ZWREZWxheU1hdGNoOiBpc0ludmVydGVkRGVsYXlNYXRjaCxcbiAgICBkZWxheU1hdGNoOiBkZWxheU1hdGNoXG4gIH07XG59O1xuLyoqXG4gKiBDb252ZXJ0cyBvYmplY3QgdG8gc3RyaW5nIGZvciBsb2dnaW5nXG4gKiBAcGFyYW0ge09iamVjdH0gb2JqIGRhdGEgb2JqZWN0XG4gKiBAcmV0dXJucyB7c3RyaW5nfVxuICovXG5cbnZhciBvYmplY3RUb1N0cmluZyA9IGZ1bmN0aW9uIG9iamVjdFRvU3RyaW5nKG9iaikge1xuICByZXR1cm4gaXNFbXB0eU9iamVjdChvYmopID8gJ3t9JyA6IGdldE9iamVjdEVudHJpZXMob2JqKS5tYXAoZnVuY3Rpb24gKHBhaXIpIHtcbiAgICB2YXIga2V5ID0gcGFpclswXTtcbiAgICB2YXIgdmFsdWUgPSBwYWlyWzFdO1xuICAgIHZhciByZWNvcmRWYWx1ZVN0ciA9IHZhbHVlO1xuXG4gICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgT2JqZWN0KSB7XG4gICAgICByZWNvcmRWYWx1ZVN0ciA9IFwieyBcIi5jb25jYXQob2JqZWN0VG9TdHJpbmcodmFsdWUpLCBcIiB9XCIpO1xuICAgIH1cblxuICAgIHJldHVybiBcIlwiLmNvbmNhdChrZXksIFwiOlxcXCJcIikuY29uY2F0KHJlY29yZFZhbHVlU3RyLCBcIlxcXCJcIik7XG4gIH0pLmpvaW4oJyAnKTtcbn07XG4vKipcbiAqIENvbnZlcnRzIHR5cGVzIGludG8gYSBzdHJpbmdcbiAqIEBwYXJhbSB7Kn0gdmFsdWVcbiAqIEByZXR1cm5zIHtzdHJpbmd9XG4gKi9cblxudmFyIGNvbnZlcnRUeXBlVG9TdHJpbmcgPSBmdW5jdGlvbiBjb252ZXJ0VHlwZVRvU3RyaW5nKHZhbHVlKSB7XG4gIHZhciBvdXRwdXQ7XG5cbiAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICBvdXRwdXQgPSAndW5kZWZpbmVkJztcbiAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnKSB7XG4gICAgaWYgKHZhbHVlID09PSBudWxsKSB7XG4gICAgICBvdXRwdXQgPSAnbnVsbCc7XG4gICAgfSBlbHNlIHtcbiAgICAgIG91dHB1dCA9IG9iamVjdFRvU3RyaW5nKHZhbHVlKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgb3V0cHV0ID0gdmFsdWUudG9TdHJpbmcoKTtcbiAgfVxuXG4gIHJldHVybiBvdXRwdXQ7XG59O1xuXG4vKipcbiAqIEdlbmVyYXRlcyBmdW5jdGlvbiB3aGljaCBzaWxlbnRzIGdsb2JhbCBlcnJvcnMgb24gcGFnZSBnZW5lcmF0ZWQgYnkgc2NyaXB0bGV0XG4gKiBJZiBlcnJvciBkb2Vzbid0IGJlbG9uZyB0byBvdXIgZXJyb3Igd2UgdHJhbnNmZXIgaXQgdG8gdGhlIG5hdGl2ZSBvbkVycm9yIGhhbmRsZXJcbiAqIEBwYXJhbSB7c3RyaW5nfSByaWQgLSB1bmlxdWUgaWRlbnRpZmllciBvZiBzY3JpcHRsZXRcbiAqIEByZXR1cm4ge29uRXJyb3J9XG4gKi9cbmZ1bmN0aW9uIGNyZWF0ZU9uRXJyb3JIYW5kbGVyKHJpZCkge1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgY29uc2lzdGVudC1yZXR1cm5cbiAgdmFyIG5hdGl2ZU9uRXJyb3IgPSB3aW5kb3cub25lcnJvcjtcbiAgcmV0dXJuIGZ1bmN0aW9uIG9uRXJyb3IoZXJyb3IpIHtcbiAgICBpZiAodHlwZW9mIGVycm9yID09PSAnc3RyaW5nJyAmJiBlcnJvci5pbmRleE9mKHJpZCkgIT09IC0xKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBpZiAobmF0aXZlT25FcnJvciBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7XG4gICAgICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShfbGVuID4gMSA/IF9sZW4gLSAxIDogMCksIF9rZXkgPSAxOyBfa2V5IDwgX2xlbjsgX2tleSsrKSB7XG4gICAgICAgIGFyZ3NbX2tleSAtIDFdID0gYXJndW1lbnRzW19rZXldO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gbmF0aXZlT25FcnJvci5hcHBseSh0aGlzLCBbZXJyb3JdLmNvbmNhdChhcmdzKSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xufVxuXG4vKipcbiAqIE5vb3AgZnVuY3Rpb25cbiAqIEByZXR1cm4ge3VuZGVmaW5lZH0gdW5kZWZpbmVkXG4gKi9cbnZhciBub29wRnVuYyA9IGZ1bmN0aW9uIG5vb3BGdW5jKCkge307XG4vKipcbiAqIEZ1bmN0aW9uIHJldHVybnMgbnVsbFxuICogQHJldHVybiB7bnVsbH0gbnVsbFxuICovXG5cbnZhciBub29wTnVsbCA9IGZ1bmN0aW9uIG5vb3BOdWxsKCkge1xuICByZXR1cm4gbnVsbDtcbn07XG4vKipcbiAqIEZ1bmN0aW9uIHJldHVybnMgdHJ1ZVxuICogQHJldHVybiB7Ym9vbGVhbn0gdHJ1ZVxuICovXG5cbnZhciB0cnVlRnVuYyA9IGZ1bmN0aW9uIHRydWVGdW5jKCkge1xuICByZXR1cm4gdHJ1ZTtcbn07XG4vKipcbiAqIEZ1bmN0aW9uIHJldHVybnMgZmFsc2VcbiAqIEByZXR1cm4ge2Jvb2xlYW59IGZhbHNlXG4gKi9cblxudmFyIGZhbHNlRnVuYyA9IGZ1bmN0aW9uIGZhbHNlRnVuYygpIHtcbiAgcmV0dXJuIGZhbHNlO1xufTtcbi8qKlxuICogRnVuY3Rpb24gcmV0dXJucyB0aGlzXG4gKi9cblxuZnVuY3Rpb24gbm9vcFRoaXMoKSB7XG4gIHJldHVybiB0aGlzO1xufVxuLyoqXG4gKiBGdW5jdGlvbiByZXR1cm5zIGVtcHR5IHN0cmluZ1xuICogQHJldHVybiB7c3RyaW5nfSBlbXB0eSBzdHJpbmdcbiAqL1xuXG52YXIgbm9vcFN0ciA9IGZ1bmN0aW9uIG5vb3BTdHIoKSB7XG4gIHJldHVybiAnJztcbn07XG4vKipcbiAqIEZ1bmN0aW9uIHJldHVybnMgZW1wdHkgYXJyYXlcbiAqIEByZXR1cm4ge0FycmF5fSBlbXB0eSBhcnJheVxuICovXG5cbnZhciBub29wQXJyYXkgPSBmdW5jdGlvbiBub29wQXJyYXkoKSB7XG4gIHJldHVybiBbXTtcbn07XG4vKipcbiAqIEZ1bmN0aW9uIHJldHVybnMgZW1wdHkgb2JqZWN0XG4gKiBAcmV0dXJuIHtPYmplY3R9IGVtcHR5IG9iamVjdFxuICovXG5cbnZhciBub29wT2JqZWN0ID0gZnVuY3Rpb24gbm9vcE9iamVjdCgpIHtcbiAgcmV0dXJuIHt9O1xufTtcbi8qKlxuICogRnVuY3Rpb24gcmV0dXJucyBQcm9taXNlLnJlamVjdCgpXG4gKi9cblxudmFyIG5vb3BQcm9taXNlUmVqZWN0ID0gZnVuY3Rpb24gbm9vcFByb21pc2VSZWplY3QoKSB7XG4gIHJldHVybiBQcm9taXNlLnJlamVjdCgpO1xufTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBjb21wYXQvY29tcGF0XG5cbi8qKlxuICogUmV0dXJucyBQcm9taXNlIG9iamVjdCB0aGF0IGlzIHJlc29sdmVkIHdpdGggYW4gZW1wdHkgcmVzcG9uc2VcbiAqL1xuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNvbXBhdC9jb21wYXRcblxudmFyIG5vb3BQcm9taXNlUmVzb2x2ZSA9IGZ1bmN0aW9uIG5vb3BQcm9taXNlUmVzb2x2ZSgpIHtcbiAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShuZXcgUmVzcG9uc2UoKSk7XG59O1xuXG4vKiBlc2xpbnQtZGlzYWJsZSBuby1jb25zb2xlLCBuby11bmRlcnNjb3JlLWRhbmdsZSAqL1xuXG4vKipcbiAqIEhpdCB1c2VkIG9ubHkgZm9yIGRlYnVnIHB1cnBvc2VzIG5vd1xuICogQHBhcmFtIHtTb3VyY2V9IHNvdXJjZVxuICogQHBhcmFtIHtzdHJpbmd9IFttZXNzYWdlXSAtIG9wdGlvbmFsIG1lc3NhZ2U7XG4gKiB1c2UgTE9HX01BUktFUiA9ICdsb2c6ICcgYXQgdGhlIHN0YXJ0IG9mIGEgbWVzc2FnZVxuICogZm9yIGxvZ2dpbmcgc2NyaXB0bGV0c1xuICovXG52YXIgaGl0ID0gZnVuY3Rpb24gaGl0KHNvdXJjZSwgbWVzc2FnZSkge1xuICBpZiAoc291cmNlLnZlcmJvc2UgIT09IHRydWUpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB0cnkge1xuICAgIHZhciBsb2cgPSBjb25zb2xlLmxvZy5iaW5kKGNvbnNvbGUpO1xuICAgIHZhciB0cmFjZSA9IGNvbnNvbGUudHJhY2UuYmluZChjb25zb2xlKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBjb21wYXQvY29tcGF0XG5cbiAgICB2YXIgcHJlZml4ID0gc291cmNlLnJ1bGVUZXh0IHx8ICcnO1xuXG4gICAgaWYgKHNvdXJjZS5kb21haW5OYW1lKSB7XG4gICAgICB2YXIgQUdfU0NSSVBUTEVUX01BUktFUiA9ICcjJSMvLyc7XG4gICAgICB2YXIgVUJPX1NDUklQVExFVF9NQVJLRVIgPSAnIyMranMnO1xuICAgICAgdmFyIHJ1bGVTdGFydEluZGV4O1xuXG4gICAgICBpZiAoc291cmNlLnJ1bGVUZXh0LmluZGV4T2YoQUdfU0NSSVBUTEVUX01BUktFUikgPiAtMSkge1xuICAgICAgICBydWxlU3RhcnRJbmRleCA9IHNvdXJjZS5ydWxlVGV4dC5pbmRleE9mKEFHX1NDUklQVExFVF9NQVJLRVIpO1xuICAgICAgfSBlbHNlIGlmIChzb3VyY2UucnVsZVRleHQuaW5kZXhPZihVQk9fU0NSSVBUTEVUX01BUktFUikgPiAtMSkge1xuICAgICAgICBydWxlU3RhcnRJbmRleCA9IHNvdXJjZS5ydWxlVGV4dC5pbmRleE9mKFVCT19TQ1JJUFRMRVRfTUFSS0VSKTtcbiAgICAgIH0gLy8gZGVsZXRlIGFsbCBkb21haW5zIGZyb20gcnVsZVRleHQgYW5kIGxlYXZlIGp1c3QgcnVsZSBwYXJ0XG5cblxuICAgICAgdmFyIHJ1bGVQYXJ0ID0gc291cmNlLnJ1bGVUZXh0LnNsaWNlKHJ1bGVTdGFydEluZGV4KTsgLy8gcHJlcGFyZSBhcHBsaWVkIHNjcmlwdGxldCBydWxlIGZvciBzcGVjaWZpYyBkb21haW5cblxuICAgICAgcHJlZml4ID0gXCJcIi5jb25jYXQoc291cmNlLmRvbWFpbk5hbWUpLmNvbmNhdChydWxlUGFydCk7XG4gICAgfSAvLyBVc2VkIHRvIGNoZWNrIGlmIHNjcmlwdGxldCB1c2VzICdoaXQnIGZ1bmN0aW9uIGZvciBsb2dnaW5nXG5cblxuICAgIHZhciBMT0dfTUFSS0VSID0gJ2xvZzogJztcblxuICAgIGlmIChtZXNzYWdlKSB7XG4gICAgICBpZiAobWVzc2FnZS5pbmRleE9mKExPR19NQVJLRVIpID09PSAtMSkge1xuICAgICAgICBsb2coXCJcIi5jb25jYXQocHJlZml4LCBcIiBtZXNzYWdlOlxcblwiKS5jb25jYXQobWVzc2FnZSkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbG9nKG1lc3NhZ2Uuc2xpY2UoTE9HX01BUktFUi5sZW5ndGgpKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBsb2coXCJcIi5jb25jYXQocHJlZml4LCBcIiB0cmFjZSBzdGFydFwiKSk7XG5cbiAgICBpZiAodHJhY2UpIHtcbiAgICAgIHRyYWNlKCk7XG4gICAgfVxuXG4gICAgbG9nKFwiXCIuY29uY2F0KHByZWZpeCwgXCIgdHJhY2UgZW5kXCIpKTtcbiAgfSBjYXRjaCAoZSkgey8vIHRyeSBjYXRjaCBmb3IgRWRnZSAxNVxuICAgIC8vIEluIGFjY29yZGluZyB0byB0aGlzIGlzc3VlIGh0dHBzOi8vZGV2ZWxvcGVyLm1pY3Jvc29mdC5jb20vZW4tdXMvbWljcm9zb2Z0LWVkZ2UvcGxhdGZvcm0vaXNzdWVzLzE0NDk1MjIwL1xuICAgIC8vIGNvbnNvbGUubG9nIHRocm93cyBhbiBlcnJvclxuICB9IC8vIFRoaXMgaXMgbmVjZXNzYXJ5IGZvciB1bml0LXRlc3RzIG9ubHkhXG5cblxuICBpZiAodHlwZW9mIHdpbmRvdy5fX2RlYnVnID09PSAnZnVuY3Rpb24nKSB7XG4gICAgd2luZG93Ll9fZGVidWcoc291cmNlKTtcbiAgfVxufTtcblxuLyoqXG4gKiBET00gdHJlZSBjaGFuZ2VzIG9ic2VydmVyLiBVc2VkIGZvciAncmVtb3ZlLWF0dHInIGFuZCAncmVtb3ZlLWNsYXNzJyBzY3JpcHRsZXRzXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFja1xuICogQHBhcmFtIHtCb29sZWFufSBvYnNlcnZlQXR0cnMgLSBvcHRpb25hbCBwYXJhbWV0ZXIgLSBzaG91bGQgb2JzZXJ2ZXIgY2hlY2sgYXR0aWJ1dGVzIGNoYW5nZXNcbiAqL1xudmFyIG9ic2VydmVET01DaGFuZ2VzID0gZnVuY3Rpb24gb2JzZXJ2ZURPTUNoYW5nZXMoY2FsbGJhY2spIHtcbiAgdmFyIG9ic2VydmVBdHRycyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZmFsc2U7XG4gIHZhciBhdHRyc1RvT2JzZXJ2ID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiBbXTtcblxuICAvKipcbiAgICogUmV0dXJucyBhIHdyYXBwZXIsIHBhc3NpbmcgdGhlIGNhbGwgdG8gJ21ldGhvZCcgYXQgbWF4aW11bSBvbmNlIHBlciAnZGVsYXknIG1pbGxpc2Vjb25kcy5cbiAgICogVGhvc2UgY2FsbHMgdGhhdCBmYWxsIGludG8gdGhlIFwiY29vbGRvd25cIiBwZXJpb2QsIGFyZSBpZ25vcmVkXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IG1ldGhvZFxuICAgKiBAcGFyYW0ge051bWJlcn0gZGVsYXkgLSBtaWxsaXNlY29uZHNcbiAgICovXG4gIHZhciB0aHJvdHRsZSA9IGZ1bmN0aW9uIHRocm90dGxlKG1ldGhvZCwgZGVsYXkpIHtcbiAgICB2YXIgd2FpdCA9IGZhbHNlO1xuICAgIHZhciBzYXZlZEFyZ3M7XG5cbiAgICB2YXIgd3JhcHBlciA9IGZ1bmN0aW9uIHdyYXBwZXIoKSB7XG4gICAgICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShfbGVuKSwgX2tleSA9IDA7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHtcbiAgICAgICAgYXJnc1tfa2V5XSA9IGFyZ3VtZW50c1tfa2V5XTtcbiAgICAgIH1cblxuICAgICAgaWYgKHdhaXQpIHtcbiAgICAgICAgc2F2ZWRBcmdzID0gYXJncztcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBtZXRob2QuYXBwbHkodm9pZCAwLCBhcmdzKTtcbiAgICAgIHdhaXQgPSB0cnVlO1xuICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHdhaXQgPSBmYWxzZTtcblxuICAgICAgICBpZiAoc2F2ZWRBcmdzKSB7XG4gICAgICAgICAgd3JhcHBlcihzYXZlZEFyZ3MpO1xuICAgICAgICAgIHNhdmVkQXJncyA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgIH0sIGRlbGF5KTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIHdyYXBwZXI7XG4gIH07XG4gIC8qKlxuICAgKiAnZGVsYXknIGluIG1pbGxpc2Vjb25kcyBmb3IgJ3Rocm90dGxlJyBtZXRob2RcbiAgICovXG5cblxuICB2YXIgVEhST1RUTEVfREVMQVlfTVMgPSAyMDtcbiAgLyoqXG4gICAqIFVzZWQgZm9yIHJlbW92ZS1jbGFzc1xuICAgKi9cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVzZS1iZWZvcmUtZGVmaW5lLCBjb21wYXQvY29tcGF0XG5cbiAgdmFyIG9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIodGhyb3R0bGUoY2FsbGJhY2tXcmFwcGVyLCBUSFJPVFRMRV9ERUxBWV9NUykpO1xuXG4gIHZhciBjb25uZWN0ID0gZnVuY3Rpb24gY29ubmVjdCgpIHtcbiAgICBpZiAoYXR0cnNUb09ic2Vydi5sZW5ndGggPiAwKSB7XG4gICAgICBvYnNlcnZlci5vYnNlcnZlKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCwge1xuICAgICAgICBjaGlsZExpc3Q6IHRydWUsXG4gICAgICAgIHN1YnRyZWU6IHRydWUsXG4gICAgICAgIGF0dHJpYnV0ZXM6IG9ic2VydmVBdHRycyxcbiAgICAgICAgYXR0cmlidXRlRmlsdGVyOiBhdHRyc1RvT2JzZXJ2XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgb2JzZXJ2ZXIub2JzZXJ2ZShkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsIHtcbiAgICAgICAgY2hpbGRMaXN0OiB0cnVlLFxuICAgICAgICBzdWJ0cmVlOiB0cnVlLFxuICAgICAgICBhdHRyaWJ1dGVzOiBvYnNlcnZlQXR0cnNcbiAgICAgIH0pO1xuICAgIH1cbiAgfTtcblxuICB2YXIgZGlzY29ubmVjdCA9IGZ1bmN0aW9uIGRpc2Nvbm5lY3QoKSB7XG4gICAgb2JzZXJ2ZXIuZGlzY29ubmVjdCgpO1xuICB9O1xuXG4gIGZ1bmN0aW9uIGNhbGxiYWNrV3JhcHBlcigpIHtcbiAgICBkaXNjb25uZWN0KCk7XG4gICAgY2FsbGJhY2soKTtcbiAgICBjb25uZWN0KCk7XG4gIH1cblxuICBjb25uZWN0KCk7XG59O1xuXG4vKipcbiAqIENoZWNrcyBpZiB0aGUgc3RhY2tUcmFjZSBjb250YWlucyBzdGFja1JlZ2V4cFxuICogLy8gaHR0cHM6Ly9naXRodWIuY29tL0FkZ3VhcmRUZWFtL1NjcmlwdGxldHMvaXNzdWVzLzgyXG4gKiBAcGFyYW0ge3N0cmluZ3x1bmRlZmluZWR9IHN0YWNrTWF0Y2ggLSBpbnB1dCBzdGFjayB2YWx1ZSB0byBtYXRjaFxuICogQHBhcmFtIHtzdHJpbmd9IHN0YWNrVHJhY2UgLSBzY3JpcHQgZXJyb3Igc3RhY2sgdHJhY2VcbiAqIEByZXR1cm5zIHtib29sZWFufVxuICovXG5cbnZhciBtYXRjaFN0YWNrVHJhY2UgPSBmdW5jdGlvbiBtYXRjaFN0YWNrVHJhY2Uoc3RhY2tNYXRjaCwgc3RhY2tUcmFjZSkge1xuICBpZiAoIXN0YWNrTWF0Y2ggfHwgc3RhY2tNYXRjaCA9PT0gJycpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIHZhciBzdGFja1JlZ2V4cCA9IHRvUmVnRXhwKHN0YWNrTWF0Y2gpO1xuICB2YXIgcmVmaW5lZFN0YWNrVHJhY2UgPSBzdGFja1RyYWNlLnNwbGl0KCdcXG4nKS5zbGljZSgyKSAvLyBnZXQgcmlkIG9mIG91ciBvd24gZnVuY3Rpb25zIGluIHRoZSBzdGFjayB0cmFjZVxuICAubWFwKGZ1bmN0aW9uIChsaW5lKSB7XG4gICAgcmV0dXJuIGxpbmUudHJpbSgpO1xuICB9KSAvLyB0cmltIHRoZSBsaW5lc1xuICAuam9pbignXFxuJyk7XG4gIHJldHVybiBzdGFja1JlZ2V4cC50ZXN0KHJlZmluZWRTdGFja1RyYWNlKTtcbn07XG5cbi8qKlxuICogU29tZSBicm93c2VycyBkbyBub3Qgc3VwcG9ydCBBcnJheS5wcm90b3R5cGUuZmxhdCgpXG4gKiBmb3IgZXhhbXBsZSwgT3BlcmEgNDIgd2hpY2ggaXMgdXNlZCBmb3IgYnJvd3NlcnN0YWNrIHRlc3RzXG4gKiBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9KYXZhU2NyaXB0L1JlZmVyZW5jZS9HbG9iYWxfT2JqZWN0cy9BcnJheS9mbGF0XG4gKiBAcGFyYW0ge0FycmF5fSBpbnB1dFxuICovXG52YXIgZmxhdHRlbiA9IGZ1bmN0aW9uIGZsYXR0ZW4oaW5wdXQpIHtcbiAgdmFyIHN0YWNrID0gW107XG4gIGlucHV0LmZvckVhY2goZnVuY3Rpb24gKGVsKSB7XG4gICAgcmV0dXJuIHN0YWNrLnB1c2goZWwpO1xuICB9KTtcbiAgdmFyIHJlcyA9IFtdO1xuXG4gIHdoaWxlIChzdGFjay5sZW5ndGgpIHtcbiAgICAvLyBwb3AgdmFsdWUgZnJvbSBzdGFja1xuICAgIHZhciBuZXh0ID0gc3RhY2sucG9wKCk7XG5cbiAgICBpZiAoQXJyYXkuaXNBcnJheShuZXh0KSkge1xuICAgICAgLy8gcHVzaCBiYWNrIGFycmF5IGl0ZW1zLCB3b24ndCBtb2RpZnkgdGhlIG9yaWdpbmFsIGlucHV0XG4gICAgICBuZXh0LmZvckVhY2goZnVuY3Rpb24gKGVsKSB7XG4gICAgICAgIHJldHVybiBzdGFjay5wdXNoKGVsKTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXMucHVzaChuZXh0KTtcbiAgICB9XG4gIH0gLy8gcmV2ZXJzZSB0byByZXN0b3JlIGlucHV0IG9yZGVyXG5cblxuICByZXR1cm4gcmVzLnJldmVyc2UoKTtcbn07XG5cbi8qKlxuICogRmluZHMgc2hhZG93LWRvbSBob3N0IChlbGVtZW50cyB3aXRoIHNoYWRvd1Jvb3QgcHJvcGVydHkpIGluIERPTSBvZiByb290RWxlbWVudC5cbiAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IHJvb3RFbGVtZW50XG4gKiBAcmV0dXJucyB7SFRNTEVsZW1lbnRbXX0gc2hhZG93LWRvbSBob3N0c1xuICovXG5cbnZhciBmaW5kSG9zdEVsZW1lbnRzID0gZnVuY3Rpb24gZmluZEhvc3RFbGVtZW50cyhyb290RWxlbWVudCkge1xuICB2YXIgaG9zdHMgPSBbXTsgLy8gRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCkgcmV0dXJucyBsaXN0IG9mIGVsZW1lbnRzXG4gIC8vIHdoaWNoIGFyZSBkZWZpbmVkIGluIERPTSBvZiBFbGVtZW50LlxuICAvLyBNZWFud2hpbGUsIGlubmVyIERPTSBvZiB0aGUgZWxlbWVudCB3aXRoIHNoYWRvd1Jvb3QgcHJvcGVydHlcbiAgLy8gaXMgYWJzb2x1dGVseSBhbm90aGVyIERPTSBhbmQgd2hpY2ggY2FuIG5vdCBiZSByZWFjaGVkIGJ5IHF1ZXJ5U2VsZWN0b3JBbGwoJyonKVxuXG4gIHZhciBkb21FbGVtcyA9IHJvb3RFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJyonKTtcbiAgZG9tRWxlbXMuZm9yRWFjaChmdW5jdGlvbiAoZWwpIHtcbiAgICBpZiAoZWwuc2hhZG93Um9vdCkge1xuICAgICAgaG9zdHMucHVzaChlbCk7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIGhvc3RzO1xufTtcbi8qKlxuICogQSBjb2xsZWN0aW9uIG9mIG5vZGVzLlxuICpcbiAqIEBleHRlcm5hbCBOb2RlTGlzdFxuICogQHNlZSB7QGxpbmsgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL05vZGVMaXN0IE5vZGVMaXN0fVxuICovXG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gUGllcmNlRGF0YVxuICogQHByb3BlcnR5IHtIVE1MRWxlbWVudFtdfSB0YXJnZXRzIGZvdW5kIGVsZW1lbnRzIHRoYXQgbWF0Y2ggdGhlIHNwZWNpZmllZCBzZWxlY3RvclxuICogQHByb3BlcnR5IHtIVE1MRWxlbWVudFtdfSBpbm5lckhvc3RzIGlubmVyIHNoYWRvdy1kb20gaG9zdHNcbiAqL1xuXG4vKipcbiAqIFBpZXJjZXMgb3BlbiBzaGFkb3ctZG9tIGluIG9yZGVyIHRvIGZpbmQ6XG4gKiAtIGVsZW1lbnRzIGJ5ICdzZWxlY3RvcicgbWF0Y2hpbmdcbiAqIC0gaW5uZXIgc2hhZG93LWRvbSBob3N0c1xuICogQHBhcmFtIHtzdHJpbmd9IHNlbGVjdG9yXG4gKiBAcGFyYW0ge0hUTUxFbGVtZW50W118ZXh0ZXJuYWw6Tm9kZUxpc3R9IGhvc3RFbGVtZW50c1xuICogQHJldHVybnMge1BpZXJjZURhdGF9XG4gKi9cblxudmFyIHBpZXJjZVNoYWRvd0RvbSA9IGZ1bmN0aW9uIHBpZXJjZVNoYWRvd0RvbShzZWxlY3RvciwgaG9zdEVsZW1lbnRzKSB7XG4gIHZhciB0YXJnZXRzID0gW107XG4gIHZhciBpbm5lckhvc3RzQWNjID0gW107IC8vIGl0J3MgcG9zc2libGUgdG8gZ2V0IGEgZmV3IGhvc3RFbGVtZW50cyBmb3VuZCBieSBiYXNlU2VsZWN0b3Igb24gdGhlIHBhZ2VcblxuICBob3N0RWxlbWVudHMuZm9yRWFjaChmdW5jdGlvbiAoaG9zdCkge1xuICAgIC8vIGNoZWNrIHByZXNlbmNlIG9mIHNlbGVjdG9yIGVsZW1lbnQgaW5zaWRlIGJhc2UgZWxlbWVudCBpZiBpdCdzIG5vdCBpbiBzaGFkb3ctZG9tXG4gICAgdmFyIHNpbXBsZUVsZW1zID0gaG9zdC5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9yKTtcbiAgICB0YXJnZXRzID0gdGFyZ2V0cy5jb25jYXQoW10uc2xpY2UuY2FsbChzaW1wbGVFbGVtcykpO1xuICAgIHZhciBzaGFkb3dSb290RWxlbSA9IGhvc3Quc2hhZG93Um9vdDtcbiAgICB2YXIgc2hhZG93Q2hpbGRyZW4gPSBzaGFkb3dSb290RWxlbS5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9yKTtcbiAgICB0YXJnZXRzID0gdGFyZ2V0cy5jb25jYXQoW10uc2xpY2UuY2FsbChzaGFkb3dDaGlsZHJlbikpOyAvLyBmaW5kIGlubmVyIHNoYWRvdy1kb20gaG9zdHMgaW5zaWRlIHByb2Nlc3Npbmcgc2hhZG93LWRvbVxuXG4gICAgaW5uZXJIb3N0c0FjYy5wdXNoKGZpbmRIb3N0RWxlbWVudHMoc2hhZG93Um9vdEVsZW0pKTtcbiAgfSk7IC8vIGlmIHRoZXJlIHdlcmUgbW9yZSB0aGFuIG9uZSBob3N0IGVsZW1lbnQsXG4gIC8vIGlubmVySG9zdHNBY2MgaXMgYW4gYXJyYXkgb2YgYXJyYXlzIGFuZCBzaG91bGQgYmUgZmxhdHRlblxuXG4gIHZhciBpbm5lckhvc3RzID0gZmxhdHRlbihpbm5lckhvc3RzQWNjKTtcbiAgcmV0dXJuIHtcbiAgICB0YXJnZXRzOiB0YXJnZXRzLFxuICAgIGlubmVySG9zdHM6IGlubmVySG9zdHNcbiAgfTtcbn07XG5cbi8qKlxuICogUHJlcGFyZXMgY29va2llIHN0cmluZyBpZiBnaXZlbiBwYXJhbWV0ZXJzIGFyZSBva1xuICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgY29va2llIG5hbWUgdG8gc2V0XG4gKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUgY29va2llIHZhbHVlIHRvIHNldFxuICogQHJldHVybnMge3N0cmluZ3xudWxsfSBjb29raWUgc3RyaW5nIGlmIG9rIE9SIG51bGwgaWYgbm90XG4gKi9cblxudmFyIHByZXBhcmVDb29raWUgPSBmdW5jdGlvbiBwcmVwYXJlQ29va2llKG5hbWUsIHZhbHVlKSB7XG4gIGlmICghbmFtZSB8fCAhdmFsdWUpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIHZhciB2YWx1ZVRvU2V0O1xuXG4gIGlmICh2YWx1ZSA9PT0gJ3RydWUnKSB7XG4gICAgdmFsdWVUb1NldCA9ICd0cnVlJztcbiAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gJ1RydWUnKSB7XG4gICAgdmFsdWVUb1NldCA9ICdUcnVlJztcbiAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gJ2ZhbHNlJykge1xuICAgIHZhbHVlVG9TZXQgPSAnZmFsc2UnO1xuICB9IGVsc2UgaWYgKHZhbHVlID09PSAnRmFsc2UnKSB7XG4gICAgdmFsdWVUb1NldCA9ICdGYWxzZSc7XG4gIH0gZWxzZSBpZiAodmFsdWUgPT09ICd5ZXMnKSB7XG4gICAgdmFsdWVUb1NldCA9ICd5ZXMnO1xuICB9IGVsc2UgaWYgKHZhbHVlID09PSAnWWVzJykge1xuICAgIHZhbHVlVG9TZXQgPSAnWWVzJztcbiAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gJ1knKSB7XG4gICAgdmFsdWVUb1NldCA9ICdZJztcbiAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gJ25vJykge1xuICAgIHZhbHVlVG9TZXQgPSAnbm8nO1xuICB9IGVsc2UgaWYgKHZhbHVlID09PSAnb2snKSB7XG4gICAgdmFsdWVUb1NldCA9ICdvayc7XG4gIH0gZWxzZSBpZiAodmFsdWUgPT09ICdPSycpIHtcbiAgICB2YWx1ZVRvU2V0ID0gJ09LJztcbiAgfSBlbHNlIGlmICgvXlxcZCskLy50ZXN0KHZhbHVlKSkge1xuICAgIHZhbHVlVG9TZXQgPSBwYXJzZUZsb2F0KHZhbHVlKTtcblxuICAgIGlmIChuYXRpdmVJc05hTih2YWx1ZVRvU2V0KSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgaWYgKE1hdGguYWJzKHZhbHVlVG9TZXQpIDwgMCB8fCBNYXRoLmFicyh2YWx1ZVRvU2V0KSA+IDE1KSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICB2YXIgcGF0aFRvU2V0ID0gJ3BhdGg9LzsnO1xuICB2YXIgY29va2llRGF0YSA9IFwiXCIuY29uY2F0KGVuY29kZVVSSUNvbXBvbmVudChuYW1lKSwgXCI9XCIpLmNvbmNhdChlbmNvZGVVUklDb21wb25lbnQodmFsdWVUb1NldCksIFwiOyBcIikuY29uY2F0KHBhdGhUb1NldCk7XG4gIHJldHVybiBjb29raWVEYXRhO1xufTtcblxudmFyIHNob3VsZE1hdGNoQW55RGVsYXkgPSBmdW5jdGlvbiBzaG91bGRNYXRjaEFueURlbGF5KGRlbGF5KSB7XG4gIHJldHVybiBkZWxheSA9PT0gZ2V0V2lsZGNhcmRTeW1ib2woKTtcbn07XG4vKipcbiAqIEhhbmRsZXMgaW5wdXQgZGVsYXkgdmFsdWVcbiAqIEBwYXJhbSB7Kn0gZGVsYXlcbiAqIEByZXR1cm5zIHtudW1iZXJ9IHByb3BlciBudW1iZXIgZGVsYXkgdmFsdWVcbiAqL1xuXG52YXIgZ2V0TWF0Y2hEZWxheSA9IGZ1bmN0aW9uIGdldE1hdGNoRGVsYXkoZGVsYXkpIHtcbiAgdmFyIERFRkFVTFRfREVMQVkgPSAxMDAwO1xuICB2YXIgcGFyc2VkRGVsYXkgPSBwYXJzZUludChkZWxheSwgMTApO1xuICB2YXIgZGVsYXlNYXRjaCA9IG5hdGl2ZUlzTmFOKHBhcnNlZERlbGF5KSA/IERFRkFVTFRfREVMQVkgLy8gZGVmYXVsdCBzY3JpcHRsZXQgdmFsdWVcbiAgOiBwYXJzZWREZWxheTtcbiAgcmV0dXJuIGRlbGF5TWF0Y2g7XG59O1xuLyoqXG4gKiBDaGVja3MgZGVsYXkgbWF0Y2ggY29uZGl0aW9uXG4gKiBAcGFyYW0geyp9IGlucHV0RGVsYXlcbiAqIEBwYXJhbSB7bnVtYmVyfSByZWFsRGVsYXlcbiAqIEByZXR1cm5zIHtib29sZWFufVxuICovXG5cbnZhciBpc0RlbGF5TWF0Y2hlZCA9IGZ1bmN0aW9uIGlzRGVsYXlNYXRjaGVkKGlucHV0RGVsYXksIHJlYWxEZWxheSkge1xuICByZXR1cm4gc2hvdWxkTWF0Y2hBbnlEZWxheShpbnB1dERlbGF5KSB8fCByZWFsRGVsYXkgPT09IGdldE1hdGNoRGVsYXkoaW5wdXREZWxheSk7XG59O1xuLyoqXG4gKiBIYW5kbGVzIGlucHV0IGJvb3N0IHZhbHVlXG4gKiBAcGFyYW0geyp9IGJvb3N0XG4gKiBAcmV0dXJucyB7bnVtYmVyfSBwcm9wZXIgbnVtYmVyIGJvb3N0IG11bHRpcGxpZXIgdmFsdWVcbiAqL1xuXG52YXIgZ2V0Qm9vc3RNdWx0aXBsaWVyID0gZnVuY3Rpb24gZ2V0Qm9vc3RNdWx0aXBsaWVyKGJvb3N0KSB7XG4gIHZhciBERUZBVUxUX01VTFRJUExJRVIgPSAwLjA1O1xuICB2YXIgTUlOX01VTFRJUExJRVIgPSAwLjAyO1xuICB2YXIgTUFYX01VTFRJUExJRVIgPSA1MDtcbiAgdmFyIHBhcnNlZEJvb3N0ID0gcGFyc2VGbG9hdChib29zdCk7XG4gIHZhciBib29zdE11bHRpcGxpZXIgPSBuYXRpdmVJc05hTihwYXJzZWRCb29zdCkgfHwgIW5hdGl2ZUlzRmluaXRlKHBhcnNlZEJvb3N0KSA/IERFRkFVTFRfTVVMVElQTElFUiAvLyBkZWZhdWx0IHNjcmlwdGxldCB2YWx1ZVxuICA6IHBhcnNlZEJvb3N0O1xuXG4gIGlmIChib29zdE11bHRpcGxpZXIgPCBNSU5fTVVMVElQTElFUikge1xuICAgIGJvb3N0TXVsdGlwbGllciA9IE1JTl9NVUxUSVBMSUVSO1xuICB9XG5cbiAgaWYgKGJvb3N0TXVsdGlwbGllciA+IE1BWF9NVUxUSVBMSUVSKSB7XG4gICAgYm9vc3RNdWx0aXBsaWVyID0gTUFYX01VTFRJUExJRVI7XG4gIH1cblxuICByZXR1cm4gYm9vc3RNdWx0aXBsaWVyO1xufTtcblxuLyoqXG4gKiBDb2xsZWN0cyBSZXF1ZXN0IG9wdGlvbnMgdG8gb2JqZWN0XG4gKiBAcGFyYW0ge1JlcXVlc3R9IHJlcXVlc3RcbiAqIEByZXR1cm5zIHtPYmplY3R9IGRhdGEgb2JqZWN0XG4gKi9cblxudmFyIGdldFJlcXVlc3REYXRhID0gZnVuY3Rpb24gZ2V0UmVxdWVzdERhdGEocmVxdWVzdCkge1xuICB2YXIgUkVRVUVTVF9JTklUX09QVElPTlMgPSBbJ3VybCcsICdtZXRob2QnLCAnaGVhZGVycycsICdib2R5JywgJ21vZGUnLCAnY3JlZGVudGlhbHMnLCAnY2FjaGUnLCAncmVkaXJlY3QnLCAncmVmZXJyZXInLCAnaW50ZWdyaXR5J107XG4gIHZhciBlbnRyaWVzID0gUkVRVUVTVF9JTklUX09QVElPTlMubWFwKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAvLyBpZiByZXF1ZXN0IGhhcyBubyBzdWNoIG9wdGlvbiwgdmFsdWUgd2lsbCBiZSB1bmRlZmluZWRcbiAgICB2YXIgdmFsdWUgPSByZXF1ZXN0W2tleV07XG4gICAgcmV0dXJuIFtrZXksIHZhbHVlXTtcbiAgfSk7XG4gIHJldHVybiBnZXRPYmplY3RGcm9tRW50cmllcyhlbnRyaWVzKTtcbn07XG4vKipcbiAqIENvbGxlY3RzIGZldGNoIGFyZ3MgdG8gb2JqZWN0XG4gKiBAcGFyYW0geyp9IGFyZ3MgZmV0Y2ggYXJnc1xuICogQHJldHVybnMge09iamVjdH0gZGF0YSBvYmplY3RcbiAqL1xuXG52YXIgZ2V0RmV0Y2hEYXRhID0gZnVuY3Rpb24gZ2V0RmV0Y2hEYXRhKGFyZ3MpIHtcbiAgdmFyIGZldGNoUHJvcHNPYmogPSB7fTtcbiAgdmFyIGZldGNoVXJsO1xuICB2YXIgZmV0Y2hJbml0O1xuXG4gIGlmIChhcmdzWzBdIGluc3RhbmNlb2YgUmVxdWVzdCkge1xuICAgIC8vIGlmIFJlcXVlc3QgcGFzc2VkIHRvIGZldGNoLCBpdCB3aWxsIGJlIGluIGFycmF5XG4gICAgdmFyIHJlcXVlc3REYXRhID0gZ2V0UmVxdWVzdERhdGEoYXJnc1swXSk7XG4gICAgZmV0Y2hVcmwgPSByZXF1ZXN0RGF0YS51cmw7XG4gICAgZmV0Y2hJbml0ID0gcmVxdWVzdERhdGE7XG4gIH0gZWxzZSB7XG4gICAgZmV0Y2hVcmwgPSBhcmdzWzBdOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHByZWZlci1kZXN0cnVjdHVyaW5nXG5cbiAgICBmZXRjaEluaXQgPSBhcmdzWzFdOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHByZWZlci1kZXN0cnVjdHVyaW5nXG4gIH1cblxuICBmZXRjaFByb3BzT2JqLnVybCA9IGZldGNoVXJsO1xuXG4gIGlmIChmZXRjaEluaXQgaW5zdGFuY2VvZiBPYmplY3QpIHtcbiAgICBPYmplY3Qua2V5cyhmZXRjaEluaXQpLmZvckVhY2goZnVuY3Rpb24gKHByb3ApIHtcbiAgICAgIGZldGNoUHJvcHNPYmpbcHJvcF0gPSBmZXRjaEluaXRbcHJvcF07XG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4gZmV0Y2hQcm9wc09iajtcbn07XG4vKipcbiAqIENvbnZlcnRzIHByZXZlbnQtZmV0Y2ggcHJvcHNUb01hdGNoIGlucHV0IHN0cmluZyB0byBvYmplY3RcbiAqIEBwYXJhbSB7c3RyaW5nfSBwcm9wc1RvTWF0Y2hTdHJcbiAqIEByZXR1cm5zIHtPYmplY3R9IG9iamVjdCB3aGVyZSAna2V5JyBpcyBwcm9wIG5hbWUgYW5kICd2YWx1ZScgaXMgcHJvcCB2YWx1ZVxuICovXG5cbnZhciBjb252ZXJ0TWF0Y2hQcm9wc1RvT2JqID0gZnVuY3Rpb24gY29udmVydE1hdGNoUHJvcHNUb09iaihwcm9wc1RvTWF0Y2hTdHIpIHtcbiAgdmFyIFBST1BTX0RJVklERVIgPSAnICc7XG4gIHZhciBQQUlSU19NQVJLRVIgPSAnOic7XG4gIHZhciBwcm9wc09iaiA9IHt9O1xuICB2YXIgcHJvcHMgPSBwcm9wc1RvTWF0Y2hTdHIuc3BsaXQoUFJPUFNfRElWSURFUik7XG4gIHByb3BzLmZvckVhY2goZnVuY3Rpb24gKHByb3ApIHtcbiAgICB2YXIgZGl2aWRlckluZCA9IHByb3AuaW5kZXhPZihQQUlSU19NQVJLRVIpO1xuXG4gICAgaWYgKGRpdmlkZXJJbmQgPT09IC0xKSB7XG4gICAgICBwcm9wc09iai51cmwgPSB0b1JlZ0V4cChwcm9wKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdmFyIGtleSA9IHByb3Auc2xpY2UoMCwgZGl2aWRlckluZCk7XG4gICAgICB2YXIgdmFsdWUgPSBwcm9wLnNsaWNlKGRpdmlkZXJJbmQgKyAxKTtcbiAgICAgIHByb3BzT2JqW2tleV0gPSB0b1JlZ0V4cCh2YWx1ZSk7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIHByb3BzT2JqO1xufTtcblxudmFyIGhhbmRsZU9sZFJlcGxhY2VtZW50ID0gZnVuY3Rpb24gaGFuZGxlT2xkUmVwbGFjZW1lbnQocmVwbGFjZW1lbnQpIHtcbiAgdmFyIHJlc3VsdDsgLy8gZGVmYXVsdHMgdG8gcmV0dXJuIG5vb3BGdW5jIGluc3RlYWQgb2Ygd2luZG93Lm9wZW5cblxuICBpZiAoIXJlcGxhY2VtZW50KSB7XG4gICAgcmVzdWx0ID0gbm9vcEZ1bmM7XG4gIH0gZWxzZSBpZiAocmVwbGFjZW1lbnQgPT09ICd0cnVlRnVuYycpIHtcbiAgICByZXN1bHQgPSB0cnVlRnVuYztcbiAgfSBlbHNlIGlmIChyZXBsYWNlbWVudC5pbmRleE9mKCc9JykgPiAtMSkge1xuICAgIC8vIFdlIHNob3VsZCByZXR1cm4gbm9vcEZ1bmMgaW5zdGVhZCBvZiB3aW5kb3cub3BlblxuICAgIC8vIGJ1dCB3aXRoIHNvbWUgcHJvcGVydHkgaWYgd2Vic2l0ZSBjaGVja3MgaXQgKGV4YW1wbGVzIDUsIDYpXG4gICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL0FkZ3VhcmRUZWFtL1NjcmlwdGxldHMvaXNzdWVzLzcxXG4gICAgdmFyIGlzUHJvcCA9IHN0YXJ0c1dpdGgocmVwbGFjZW1lbnQsICd7JykgJiYgZW5kc1dpdGgocmVwbGFjZW1lbnQsICd9Jyk7XG5cbiAgICBpZiAoaXNQcm9wKSB7XG4gICAgICB2YXIgcHJvcGVydHlQYXJ0ID0gcmVwbGFjZW1lbnQuc2xpY2UoMSwgLTEpO1xuICAgICAgdmFyIHByb3BlcnR5TmFtZSA9IHN1YnN0cmluZ0JlZm9yZShwcm9wZXJ0eVBhcnQsICc9Jyk7XG4gICAgICB2YXIgcHJvcGVydHlWYWx1ZSA9IHN1YnN0cmluZ0FmdGVyKHByb3BlcnR5UGFydCwgJz0nKTtcblxuICAgICAgaWYgKHByb3BlcnR5VmFsdWUgPT09ICdub29wRnVuYycpIHtcbiAgICAgICAgcmVzdWx0ID0ge307XG4gICAgICAgIHJlc3VsdFtwcm9wZXJ0eU5hbWVdID0gbm9vcEZ1bmM7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgY3JlYXRlRGVjb3kgPSBmdW5jdGlvbiBjcmVhdGVEZWNveShhcmdzKSB7XG4gIHZhciBPQkpFQ1RfVEFHX05BTUUgPSAnb2JqZWN0JztcbiAgdmFyIE9CSkVDVF9VUkxfUFJPUF9OQU1FID0gJ2RhdGEnO1xuICB2YXIgSUZSQU1FX1RBR19OQU1FID0gJ2lmcmFtZSc7XG4gIHZhciBJRlJBTUVfVVJMX1BST1BfTkFNRSA9ICdzcmMnO1xuICB2YXIgcmVwbGFjZW1lbnQgPSBhcmdzLnJlcGxhY2VtZW50LFxuICAgICAgdXJsID0gYXJncy51cmwsXG4gICAgICBkZWxheSA9IGFyZ3MuZGVsYXk7XG4gIHZhciB0YWc7XG4gIHZhciB1cmxQcm9wO1xuXG4gIGlmIChyZXBsYWNlbWVudCA9PT0gJ29iaicpIHtcbiAgICB0YWcgPSBPQkpFQ1RfVEFHX05BTUU7XG4gICAgdXJsUHJvcCA9IE9CSkVDVF9VUkxfUFJPUF9OQU1FO1xuICB9IGVsc2Uge1xuICAgIHRhZyA9IElGUkFNRV9UQUdfTkFNRTtcbiAgICB1cmxQcm9wID0gSUZSQU1FX1VSTF9QUk9QX05BTUU7XG4gIH1cblxuICB2YXIgZGVjb3kgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gIGRlY295W3VybFByb3BdID0gdXJsO1xuICBkZWNveS5zdHlsZS5zZXRQcm9wZXJ0eSgnaGVpZ2h0JywgJzFweCcsICdpbXBvcnRhbnQnKTtcbiAgZGVjb3kuc3R5bGUuc2V0UHJvcGVydHkoJ3Bvc2l0aW9uJywgJ2ZpeGVkJywgJ2ltcG9ydGFudCcpO1xuICBkZWNveS5zdHlsZS5zZXRQcm9wZXJ0eSgndG9wJywgJy0xcHgnLCAnaW1wb3J0YW50Jyk7XG4gIGRlY295LnN0eWxlLnNldFByb3BlcnR5KCd3aWR0aCcsICcxcHgnLCAnaW1wb3J0YW50Jyk7XG4gIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZGVjb3kpO1xuICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gZGVjb3kucmVtb3ZlKCk7XG4gIH0sIGRlbGF5ICogMTAwMCk7XG4gIHJldHVybiBkZWNveTtcbn07XG52YXIgZ2V0UHJldmVudEdldHRlciA9IGZ1bmN0aW9uIGdldFByZXZlbnRHZXR0ZXIobmF0aXZlR2V0dGVyKSB7XG4gIHZhciBwcmV2ZW50R2V0dGVyID0gZnVuY3Rpb24gcHJldmVudEdldHRlcih0YXJnZXQsIHByb3ApIHtcbiAgICBpZiAocHJvcCAmJiBwcm9wID09PSAnY2xvc2VkJykge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2YgbmF0aXZlR2V0dGVyID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICByZXR1cm4gbm9vcEZ1bmM7XG4gICAgfVxuXG4gICAgcmV0dXJuIHByb3AgJiYgdGFyZ2V0W3Byb3BdO1xuICB9O1xuXG4gIHJldHVybiBwcmV2ZW50R2V0dGVyO1xufTtcblxuLyoqXG4gKiBWYWxpZGF0ZXMgZXZlbnQgdHlwZVxuICogQHBhcmFtIHsqfSB0eXBlXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAqL1xudmFyIHZhbGlkYXRlVHlwZSA9IGZ1bmN0aW9uIHZhbGlkYXRlVHlwZSh0eXBlKSB7XG4gIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9BZGd1YXJkVGVhbS9TY3JpcHRsZXRzL2lzc3Vlcy8xMjVcbiAgcmV0dXJuIHR5cGVvZiB0eXBlICE9PSAndW5kZWZpbmVkJztcbn07XG4vKipcbiAqIFZhbGlkYXRlcyBldmVudCBsaXN0ZW5lclxuICogQHBhcmFtIHsqfSBsaXN0ZW5lclxuICogQHJldHVybnMge2Jvb2xlYW59XG4gKi9cblxudmFyIHZhbGlkYXRlTGlzdGVuZXIgPSBmdW5jdGlvbiB2YWxpZGF0ZUxpc3RlbmVyKGxpc3RlbmVyKSB7XG4gIC8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9FdmVudFRhcmdldC9hZGRFdmVudExpc3RlbmVyI3BhcmFtZXRlcnNcbiAgcmV0dXJuIHR5cGVvZiBsaXN0ZW5lciAhPT0gJ3VuZGVmaW5lZCcgJiYgKHR5cGVvZiBsaXN0ZW5lciA9PT0gJ2Z1bmN0aW9uJyB8fCB0eXBlb2YgbGlzdGVuZXIgPT09ICdvYmplY3QnIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9BZGd1YXJkVGVhbS9TY3JpcHRsZXRzL2lzc3Vlcy83NlxuICAmJiBsaXN0ZW5lciAhPT0gbnVsbCAmJiB0eXBlb2YgbGlzdGVuZXIuaGFuZGxlRXZlbnQgPT09ICdmdW5jdGlvbicpO1xufTtcbi8qKlxuICogU2VyaWFsaXplIHZhbGlkIGV2ZW50IGxpc3RlbmVyXG4gKiBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvRXZlbnRMaXN0ZW5lclxuICogQHBhcmFtIHtFdmVudExpc3RlbmVyfSBsaXN0ZW5lciB2YWxpZCBsaXN0ZW5lclxuICogQHJldHVybnMge3N0cmluZ31cbiAqL1xuXG52YXIgbGlzdGVuZXJUb1N0cmluZyA9IGZ1bmN0aW9uIGxpc3RlbmVyVG9TdHJpbmcobGlzdGVuZXIpIHtcbiAgcmV0dXJuIHR5cGVvZiBsaXN0ZW5lciA9PT0gJ2Z1bmN0aW9uJyA/IGxpc3RlbmVyLnRvU3RyaW5nKCkgOiBsaXN0ZW5lci5oYW5kbGVFdmVudC50b1N0cmluZygpO1xufTtcblxuLyoqXG4gKiBUaGlzIGZpbGUgbXVzdCBleHBvcnQgYWxsIHVzZWQgZGVwZW5kZW5jaWVzXG4gKi9cblxudmFyIGRlcGVuZGVuY2llcyA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHtcbiAgICBfX3Byb3RvX186IG51bGwsXG4gICAgZ2V0V2lsZGNhcmRTeW1ib2w6IGdldFdpbGRjYXJkU3ltYm9sLFxuICAgIHJhbmRvbUlkOiByYW5kb21JZCxcbiAgICBzZXRQcm9wZXJ0eUFjY2Vzczogc2V0UHJvcGVydHlBY2Nlc3MsXG4gICAgZ2V0UHJvcGVydHlJbkNoYWluOiBnZXRQcm9wZXJ0eUluQ2hhaW4sXG4gICAgZ2V0V2lsZGNhcmRQcm9wZXJ0eUluQ2hhaW46IGdldFdpbGRjYXJkUHJvcGVydHlJbkNoYWluLFxuICAgIHJlcGxhY2VBbGw6IHJlcGxhY2VBbGwsXG4gICAgZXNjYXBlUmVnRXhwOiBlc2NhcGVSZWdFeHAsXG4gICAgdG9SZWdFeHA6IHRvUmVnRXhwLFxuICAgIGdldEJlZm9yZVJlZ0V4cDogZ2V0QmVmb3JlUmVnRXhwLFxuICAgIHN0YXJ0c1dpdGg6IHN0YXJ0c1dpdGgsXG4gICAgZW5kc1dpdGg6IGVuZHNXaXRoLFxuICAgIHN1YnN0cmluZ0FmdGVyOiBzdWJzdHJpbmdBZnRlcixcbiAgICBzdWJzdHJpbmdCZWZvcmU6IHN1YnN0cmluZ0JlZm9yZSxcbiAgICB3cmFwSW5TaW5nbGVRdW90ZXM6IHdyYXBJblNpbmdsZVF1b3RlcyxcbiAgICBnZXRTdHJpbmdJbkJyYWNlczogZ2V0U3RyaW5nSW5CcmFjZXMsXG4gICAgY29udmVydFJ0Y0NvbmZpZ1RvU3RyaW5nOiBjb252ZXJ0UnRjQ29uZmlnVG9TdHJpbmcsXG4gICAgcGFyc2VNYXRjaEFyZzogcGFyc2VNYXRjaEFyZyxcbiAgICBwYXJzZURlbGF5QXJnOiBwYXJzZURlbGF5QXJnLFxuICAgIG9iamVjdFRvU3RyaW5nOiBvYmplY3RUb1N0cmluZyxcbiAgICBjb252ZXJ0VHlwZVRvU3RyaW5nOiBjb252ZXJ0VHlwZVRvU3RyaW5nLFxuICAgIGNyZWF0ZU9uRXJyb3JIYW5kbGVyOiBjcmVhdGVPbkVycm9ySGFuZGxlcixcbiAgICBub29wRnVuYzogbm9vcEZ1bmMsXG4gICAgbm9vcE51bGw6IG5vb3BOdWxsLFxuICAgIHRydWVGdW5jOiB0cnVlRnVuYyxcbiAgICBmYWxzZUZ1bmM6IGZhbHNlRnVuYyxcbiAgICBub29wVGhpczogbm9vcFRoaXMsXG4gICAgbm9vcFN0cjogbm9vcFN0cixcbiAgICBub29wQXJyYXk6IG5vb3BBcnJheSxcbiAgICBub29wT2JqZWN0OiBub29wT2JqZWN0LFxuICAgIG5vb3BQcm9taXNlUmVqZWN0OiBub29wUHJvbWlzZVJlamVjdCxcbiAgICBub29wUHJvbWlzZVJlc29sdmU6IG5vb3BQcm9taXNlUmVzb2x2ZSxcbiAgICBoaXQ6IGhpdCxcbiAgICBvYnNlcnZlRE9NQ2hhbmdlczogb2JzZXJ2ZURPTUNoYW5nZXMsXG4gICAgbWF0Y2hTdGFja1RyYWNlOiBtYXRjaFN0YWNrVHJhY2UsXG4gICAgZmluZEhvc3RFbGVtZW50czogZmluZEhvc3RFbGVtZW50cyxcbiAgICBwaWVyY2VTaGFkb3dEb206IHBpZXJjZVNoYWRvd0RvbSxcbiAgICBmbGF0dGVuOiBmbGF0dGVuLFxuICAgIHByZXBhcmVDb29raWU6IHByZXBhcmVDb29raWUsXG4gICAgbmF0aXZlSXNOYU46IG5hdGl2ZUlzTmFOLFxuICAgIG5hdGl2ZUlzRmluaXRlOiBuYXRpdmVJc0Zpbml0ZSxcbiAgICBzaG91bGRNYXRjaEFueURlbGF5OiBzaG91bGRNYXRjaEFueURlbGF5LFxuICAgIGdldE1hdGNoRGVsYXk6IGdldE1hdGNoRGVsYXksXG4gICAgaXNEZWxheU1hdGNoZWQ6IGlzRGVsYXlNYXRjaGVkLFxuICAgIGdldEJvb3N0TXVsdGlwbGllcjogZ2V0Qm9vc3RNdWx0aXBsaWVyLFxuICAgIGdldFJlcXVlc3REYXRhOiBnZXRSZXF1ZXN0RGF0YSxcbiAgICBnZXRGZXRjaERhdGE6IGdldEZldGNoRGF0YSxcbiAgICBjb252ZXJ0TWF0Y2hQcm9wc1RvT2JqOiBjb252ZXJ0TWF0Y2hQcm9wc1RvT2JqLFxuICAgIGdldE9iamVjdEVudHJpZXM6IGdldE9iamVjdEVudHJpZXMsXG4gICAgZ2V0T2JqZWN0RnJvbUVudHJpZXM6IGdldE9iamVjdEZyb21FbnRyaWVzLFxuICAgIGlzRW1wdHlPYmplY3Q6IGlzRW1wdHlPYmplY3QsXG4gICAgaGFuZGxlT2xkUmVwbGFjZW1lbnQ6IGhhbmRsZU9sZFJlcGxhY2VtZW50LFxuICAgIGNyZWF0ZURlY295OiBjcmVhdGVEZWNveSxcbiAgICBnZXRQcmV2ZW50R2V0dGVyOiBnZXRQcmV2ZW50R2V0dGVyLFxuICAgIHZhbGlkYXRlVHlwZTogdmFsaWRhdGVUeXBlLFxuICAgIHZhbGlkYXRlTGlzdGVuZXI6IHZhbGlkYXRlTGlzdGVuZXIsXG4gICAgbGlzdGVuZXJUb1N0cmluZzogbGlzdGVuZXJUb1N0cmluZ1xufSk7XG5cbi8qKlxuICogQ29uY2F0IGRlcGVuZGVuY2llcyB0byBzY3JpcHRsZXQgY29kZVxuICogQHBhcmFtIHtzdHJpbmd9IHNjcmlwdGxldCBzdHJpbmcgdmlldyBvZiBzY3JpcHRsZXRcbiAqL1xuXG5mdW5jdGlvbiBhdHRhY2hEZXBlbmRlbmNpZXMoc2NyaXB0bGV0KSB7XG4gIHZhciBfc2NyaXB0bGV0JGluamVjdGlvbnMgPSBzY3JpcHRsZXQuaW5qZWN0aW9ucyxcbiAgICAgIGluamVjdGlvbnMgPSBfc2NyaXB0bGV0JGluamVjdGlvbnMgPT09IHZvaWQgMCA/IFtdIDogX3NjcmlwdGxldCRpbmplY3Rpb25zO1xuICByZXR1cm4gaW5qZWN0aW9ucy5yZWR1Y2UoZnVuY3Rpb24gKGFjY3VtLCBkZXApIHtcbiAgICByZXR1cm4gXCJcIi5jb25jYXQoYWNjdW0sIFwiXFxuXCIpLmNvbmNhdChkZXBlbmRlbmNpZXNbZGVwLm5hbWVdKTtcbiAgfSwgc2NyaXB0bGV0LnRvU3RyaW5nKCkpO1xufVxuLyoqXG4gKiBBZGQgc2NyaXB0bGV0IGNhbGwgdG8gZXhpc3RpbmcgY29kZVxuICogQHBhcmFtIHtGdW5jdGlvbn0gc2NyaXB0bGV0XG4gKiBAcGFyYW0ge3N0cmluZ30gY29kZVxuICovXG5cbmZ1bmN0aW9uIGFkZENhbGwoc2NyaXB0bGV0LCBjb2RlKSB7XG4gIHJldHVybiBcIlwiLmNvbmNhdChjb2RlLCBcIjtcXG4gICAgICAgIGNvbnN0IHVwZGF0ZWRBcmdzID0gYXJncyA/IFtdLmNvbmNhdChzb3VyY2UpLmNvbmNhdChhcmdzKSA6IFtzb3VyY2VdO1xcbiAgICAgICAgXCIpLmNvbmNhdChzY3JpcHRsZXQubmFtZSwgXCIuYXBwbHkodGhpcywgdXBkYXRlZEFyZ3MpO1xcbiAgICBcIik7XG59XG4vKipcbiAqIFdyYXAgZnVuY3Rpb24gaW50byBJSUZFIChJbW1lZGlhdGVseSBpbnZva2VkIGZ1bmN0aW9uIGV4cHJlc3Npb24pXG4gKlxuICogQHBhcmFtIHtTb3VyY2V9IHNvdXJjZSAtIG9iamVjdCB3aXRoIHNjcmlwdGxldCBwcm9wZXJ0aWVzXG4gKiBAcGFyYW0ge3N0cmluZ30gY29kZSAtIHNjcmlwdGxldCBzb3VyY2UgY29kZSB3aXRoIGRlcGVuZGVuY2llc1xuICpcbiAqIEByZXR1cm5zIHtzdHJpbmd9IGZ1bGwgc2NyaXB0bGV0IGNvZGVcbiAqXG4gKiBAZXhhbXBsZVxuICogY29uc3Qgc291cmNlID0ge1xuICogICAgICBhcmdzOiBbXCJhYWFcIiwgXCJiYmJcIl0sXG4gKiAgICAgIG5hbWU6ICdub2V2YWwnLFxuICogfTtcbiAqIGNvbnN0IGNvZGUgPSBcImZ1bmN0aW9uIG5vZXZhbChzb3VyY2UsIGFyZ3MpIHsgYWxlcnQoc291cmNlKTsgfSBub2V2YWwuYXBwbHkodGhpcywgYXJncyk7XCJcbiAqIGNvbnN0IHJlc3VsdCA9IHdyYXBJbklJRkUoc291cmNlLCBjb2RlKTtcbiAqXG4gKiAvLyByZXN1bHRcbiAqIGAoZnVuY3Rpb24oc291cmNlLCBhcmdzKSB7XG4gKiAgICAgIGZ1bmN0aW9uIG5vZXZhbChzb3VyY2UpIHsgYWxlcnQoc291cmNlKTsgfVxuICogICAgICBub2V2YWwuYXBwbHkodGhpcywgYXJncyk7XG4gKiApKHtcImFyZ3NcIjogW1wiYWFhXCIsIFwiYmJiXCJdLCBcIm5hbWVcIjpcIm5vZXZhbFwifSwgW1wiYWFhXCIsIFwiYmJiXCJdKWBcbiAqL1xuXG5mdW5jdGlvbiBwYXNzU291cmNlQW5kUHJvcHMoc291cmNlLCBjb2RlKSB7XG4gIGlmIChzb3VyY2UuaGl0KSB7XG4gICAgc291cmNlLmhpdCA9IHNvdXJjZS5oaXQudG9TdHJpbmcoKTtcbiAgfVxuXG4gIHZhciBzb3VyY2VTdHJpbmcgPSBKU09OLnN0cmluZ2lmeShzb3VyY2UpO1xuICB2YXIgYXJnc1N0cmluZyA9IHNvdXJjZS5hcmdzID8gXCJbXCIuY29uY2F0KHNvdXJjZS5hcmdzLm1hcChKU09OLnN0cmluZ2lmeSksIFwiXVwiKSA6IHVuZGVmaW5lZDtcbiAgdmFyIHBhcmFtcyA9IGFyZ3NTdHJpbmcgPyBcIlwiLmNvbmNhdChzb3VyY2VTdHJpbmcsIFwiLCBcIikuY29uY2F0KGFyZ3NTdHJpbmcpIDogc291cmNlU3RyaW5nO1xuICByZXR1cm4gXCIoZnVuY3Rpb24oc291cmNlLCBhcmdzKXtcXG5cIi5jb25jYXQoY29kZSwgXCJcXG59KShcIikuY29uY2F0KHBhcmFtcywgXCIpO1wiKTtcbn1cbi8qKlxuICogV3JhcCBjb2RlIGluIG5vIG5hbWUgZnVuY3Rpb25cbiAqIEBwYXJhbSB7c3RyaW5nfSBjb2RlIHdoaWNoIG11c3QgYmUgd3JhcHBlZFxuICovXG5cbmZ1bmN0aW9uIHdyYXBJbk5vbmFtZUZ1bmMoY29kZSkge1xuICByZXR1cm4gXCJmdW5jdGlvbihzb3VyY2UsIGFyZ3Mpe1xcblwiLmNvbmNhdChjb2RlLCBcIlxcbn1cIik7XG59XG5cbmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHtcbiAgaWYgKGtleSBpbiBvYmopIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHtcbiAgICAgIHZhbHVlOiB2YWx1ZSxcbiAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICB3cml0YWJsZTogdHJ1ZVxuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIG9ialtrZXldID0gdmFsdWU7XG4gIH1cblxuICByZXR1cm4gb2JqO1xufVxuXG52YXIgZGVmaW5lUHJvcGVydHkgPSBfZGVmaW5lUHJvcGVydHk7XG5cbi8qKlxuICogSXRlcmF0ZSBvdmVyIGl0ZXJhYmxlIGFyZ3VtZW50IGFuZCBldmFsdWF0ZSBjdXJyZW50IHN0YXRlIHdpdGggdHJhbnNpdGlvbnNcbiAqIEBwYXJhbSB7c3RyaW5nfSBpbml0IGZpcnN0IHRyYW5zaXRpb24gbmFtZVxuICogQHBhcmFtIHtBcnJheXxDb2xsZWN0aW9ufHN0cmluZ30gaXRlcmFibGVcbiAqIEBwYXJhbSB7T2JqZWN0fSB0cmFuc2l0aW9ucyB0cmFuc3Rpb24gZnVuY3Rpb25zXG4gKiBAcGFyYW0ge2FueX0gYXJncyBhcmd1bWVudHMgd2hpY2ggc2hvdWxkIGJlIHBhc3NlZCB0byB0cmFuc2l0aW9uIGZ1bmN0aW9uc1xuICovXG5mdW5jdGlvbiBpdGVyYXRlV2l0aFRyYW5zaXRpb25zKGl0ZXJhYmxlLCB0cmFuc2l0aW9ucywgaW5pdCwgYXJncykge1xuICB2YXIgc3RhdGUgPSBpbml0IHx8IE9iamVjdC5rZXlzKHRyYW5zaXRpb25zKVswXTtcblxuICBmb3IgKHZhciBpID0gMDsgaSA8IGl0ZXJhYmxlLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgc3RhdGUgPSB0cmFuc2l0aW9uc1tzdGF0ZV0oaXRlcmFibGUsIGksIGFyZ3MpO1xuICB9XG5cbiAgcmV0dXJuIHN0YXRlO1xufVxuLyoqXG4gKiBBZEd1YXJkIHNjcmlwdGxldCBydWxlIG1hc2tcbiAqL1xuXG5cbnZhciBBREdfU0NSSVBUTEVUX01BU0sgPSAnIy8vc2NyaXB0bGV0Jztcbi8qKlxuICogSGVscGVyIHRvIGFjY3VtdWxhdGUgYW4gYXJyYXkgb2Ygc3RyaW5ncyBjaGFyIGJ5IGNoYXJcbiAqL1xuXG52YXIgd29yZFNhdmVyID0gZnVuY3Rpb24gd29yZFNhdmVyKCkge1xuICB2YXIgc3RyID0gJyc7XG4gIHZhciBzdHJzID0gW107XG5cbiAgdmFyIHNhdmVTeW1iID0gZnVuY3Rpb24gc2F2ZVN5bWIocykge1xuICAgIHN0ciArPSBzO1xuICAgIHJldHVybiBzdHI7XG4gIH07XG5cbiAgdmFyIHNhdmVTdHIgPSBmdW5jdGlvbiBzYXZlU3RyKCkge1xuICAgIHN0cnMucHVzaChzdHIpO1xuICAgIHN0ciA9ICcnO1xuICB9O1xuXG4gIHZhciBnZXRBbGwgPSBmdW5jdGlvbiBnZXRBbGwoKSB7XG4gICAgcmV0dXJuIFtdLmNvbmNhdChzdHJzKTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIHNhdmVTeW1iOiBzYXZlU3ltYixcbiAgICBzYXZlU3RyOiBzYXZlU3RyLFxuICAgIGdldEFsbDogZ2V0QWxsXG4gIH07XG59O1xuXG52YXIgc3Vic3RyaW5nQWZ0ZXIkMSA9IGZ1bmN0aW9uIHN1YnN0cmluZ0FmdGVyKHN0ciwgc2VwYXJhdG9yKSB7XG4gIGlmICghc3RyKSB7XG4gICAgcmV0dXJuIHN0cjtcbiAgfVxuXG4gIHZhciBpbmRleCA9IHN0ci5pbmRleE9mKHNlcGFyYXRvcik7XG4gIHJldHVybiBpbmRleCA8IDAgPyAnJyA6IHN0ci5zdWJzdHJpbmcoaW5kZXggKyBzZXBhcmF0b3IubGVuZ3RoKTtcbn07XG4vKipcbiAqIFBhcnNlIGFuZCB2YWxpZGF0ZSBzY3JpcHRsZXQgcnVsZVxuICogQHBhcmFtIHsqfSBydWxlVGV4dFxuICogQHJldHVybnMge3tuYW1lOiBzdHJpbmcsIGFyZ3M6IEFycmF5PHN0cmluZz59fVxuICovXG5cblxudmFyIHBhcnNlUnVsZSA9IGZ1bmN0aW9uIHBhcnNlUnVsZShydWxlVGV4dCkge1xuICB2YXIgX3RyYW5zaXRpb25zO1xuXG4gIHJ1bGVUZXh0ID0gc3Vic3RyaW5nQWZ0ZXIkMShydWxlVGV4dCwgQURHX1NDUklQVExFVF9NQVNLKTtcbiAgLyoqXG4gICAqIFRyYW5zaXRpb24gbmFtZXNcbiAgICovXG5cbiAgdmFyIFRSQU5TSVRJT04gPSB7XG4gICAgT1BFTkVEOiAnb3BlbmVkJyxcbiAgICBQQVJBTTogJ3BhcmFtJyxcbiAgICBDTE9TRUQ6ICdjbG9zZWQnXG4gIH07XG4gIC8qKlxuICAgKiBUcmFuc2l0aW9uIGZ1bmN0aW9uOiB0aGUgY3VycmVudCBpbmRleCBwb3NpdGlvbiBpbiBzdGFydCwgZW5kIG9yIGJldHdlZW4gcGFyYW1zXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBydWxlXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleFxuICAgKiBAcGFyYW0ge09iamVjdH0gT2JqZWN0XG4gICAqIEBwcm9wZXJ0eSB7T2JqZWN0fSBPYmplY3Quc2VwIGNvbnRhaW5zIHByb3Agc3ltYiB3aXRoIGN1cnJlbnQgc2VwYXJhdG9yIGNoYXJcbiAgICovXG5cbiAgdmFyIG9wZW5lZCA9IGZ1bmN0aW9uIG9wZW5lZChydWxlLCBpbmRleCwgX3JlZikge1xuICAgIHZhciBzZXAgPSBfcmVmLnNlcDtcbiAgICB2YXIgY2hhciA9IHJ1bGVbaW5kZXhdO1xuICAgIHZhciB0cmFuc2l0aW9uO1xuXG4gICAgc3dpdGNoIChjaGFyKSB7XG4gICAgICBjYXNlICcgJzpcbiAgICAgIGNhc2UgJygnOlxuICAgICAgY2FzZSAnLCc6XG4gICAgICAgIHtcbiAgICAgICAgICB0cmFuc2l0aW9uID0gVFJBTlNJVElPTi5PUEVORUQ7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgY2FzZSAnXFwnJzpcbiAgICAgIGNhc2UgJ1wiJzpcbiAgICAgICAge1xuICAgICAgICAgIHNlcC5zeW1iID0gY2hhcjtcbiAgICAgICAgICB0cmFuc2l0aW9uID0gVFJBTlNJVElPTi5QQVJBTTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICBjYXNlICcpJzpcbiAgICAgICAge1xuICAgICAgICAgIHRyYW5zaXRpb24gPSBpbmRleCA9PT0gcnVsZS5sZW5ndGggLSAxID8gVFJBTlNJVElPTi5DTE9TRUQgOiBUUkFOU0lUSU9OLk9QRU5FRDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICBkZWZhdWx0OlxuICAgICAgICB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgcnVsZSBpcyBub3QgYSBzY3JpcHRsZXQnKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0cmFuc2l0aW9uO1xuICB9O1xuICAvKipcbiAgICogVHJhbnNpdGlvbiBmdW5jdGlvbjogdGhlIGN1cnJlbnQgaW5kZXggcG9zaXRpb24gaW5zaWRlIHBhcmFtXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBydWxlXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleFxuICAgKiBAcGFyYW0ge09iamVjdH0gT2JqZWN0XG4gICAqIEBwcm9wZXJ0eSB7T2JqZWN0fSBPYmplY3Quc2VwIGNvbnRhaW5zIHByb3AgYHN5bWJgIHdpdGggY3VycmVudCBzZXBhcmF0b3IgY2hhclxuICAgKiBAcHJvcGVydHkge09iamVjdH0gT2JqZWN0LnNhdmVyIGhlbHBlciB3aGljaCBhbGxvdyB0byBzYXZlIHN0cmluZ3MgYnkgY2FyIGJ5IGNoYXJcbiAgICovXG5cblxuICB2YXIgcGFyYW0gPSBmdW5jdGlvbiBwYXJhbShydWxlLCBpbmRleCwgX3JlZjIpIHtcbiAgICB2YXIgc2F2ZXIgPSBfcmVmMi5zYXZlcixcbiAgICAgICAgc2VwID0gX3JlZjIuc2VwO1xuICAgIHZhciBjaGFyID0gcnVsZVtpbmRleF07XG5cbiAgICBzd2l0Y2ggKGNoYXIpIHtcbiAgICAgIGNhc2UgJ1xcJyc6XG4gICAgICBjYXNlICdcIic6XG4gICAgICAgIHtcbiAgICAgICAgICB2YXIgcHJlSW5kZXggPSBpbmRleCAtIDE7XG4gICAgICAgICAgdmFyIGJlZm9yZSA9IHJ1bGVbcHJlSW5kZXhdO1xuXG4gICAgICAgICAgaWYgKGNoYXIgPT09IHNlcC5zeW1iICYmIGJlZm9yZSAhPT0gJ1xcXFwnKSB7XG4gICAgICAgICAgICBzZXAuc3ltYiA9IG51bGw7XG4gICAgICAgICAgICBzYXZlci5zYXZlU3RyKCk7XG4gICAgICAgICAgICByZXR1cm4gVFJBTlNJVElPTi5PUEVORUQ7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tZmFsbHRocm91Z2hcblxuICAgICAgZGVmYXVsdDpcbiAgICAgICAge1xuICAgICAgICAgIHNhdmVyLnNhdmVTeW1iKGNoYXIpO1xuICAgICAgICAgIHJldHVybiBUUkFOU0lUSU9OLlBBUkFNO1xuICAgICAgICB9XG4gICAgfVxuICB9O1xuXG4gIHZhciB0cmFuc2l0aW9ucyA9IChfdHJhbnNpdGlvbnMgPSB7fSwgZGVmaW5lUHJvcGVydHkoX3RyYW5zaXRpb25zLCBUUkFOU0lUSU9OLk9QRU5FRCwgb3BlbmVkKSwgZGVmaW5lUHJvcGVydHkoX3RyYW5zaXRpb25zLCBUUkFOU0lUSU9OLlBBUkFNLCBwYXJhbSksIGRlZmluZVByb3BlcnR5KF90cmFuc2l0aW9ucywgVFJBTlNJVElPTi5DTE9TRUQsIGZ1bmN0aW9uICgpIHt9KSwgX3RyYW5zaXRpb25zKTtcbiAgdmFyIHNlcCA9IHtcbiAgICBzeW1iOiBudWxsXG4gIH07XG4gIHZhciBzYXZlciA9IHdvcmRTYXZlcigpO1xuICB2YXIgc3RhdGUgPSBpdGVyYXRlV2l0aFRyYW5zaXRpb25zKHJ1bGVUZXh0LCB0cmFuc2l0aW9ucywgVFJBTlNJVElPTi5PUEVORUQsIHtcbiAgICBzZXA6IHNlcCxcbiAgICBzYXZlcjogc2F2ZXJcbiAgfSk7XG5cbiAgaWYgKHN0YXRlICE9PSAnY2xvc2VkJykge1xuICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgc2NyaXB0bGV0IHJ1bGUgXCIuY29uY2F0KHJ1bGVUZXh0KSk7XG4gIH1cblxuICB2YXIgYXJncyA9IHNhdmVyLmdldEFsbCgpO1xuICByZXR1cm4ge1xuICAgIG5hbWU6IGFyZ3NbMF0sXG4gICAgYXJnczogYXJncy5zbGljZSgxKVxuICB9O1xufTtcblxuLyogZXNsaW50LWRpc2FibGUgbWF4LWxlbiAqL1xuXG4vKipcbiAqIEBzY3JpcHRsZXQgYWJvcnQtb24tcHJvcGVydHktcmVhZFxuICpcbiAqIEBkZXNjcmlwdGlvblxuICogQWJvcnRzIGEgc2NyaXB0IHdoZW4gaXQgYXR0ZW1wdHMgdG8gKipyZWFkKiogdGhlIHNwZWNpZmllZCBwcm9wZXJ0eS5cbiAqXG4gKiBSZWxhdGVkIFVCTyBzY3JpcHRsZXQ6XG4gKiBodHRwczovL2dpdGh1Yi5jb20vZ29yaGlsbC91QmxvY2svd2lraS9SZXNvdXJjZXMtTGlicmFyeSNhYm9ydC1vbi1wcm9wZXJ0eS1yZWFkanMtXG4gKlxuICogUmVsYXRlZCBBQlAgc291cmNlOlxuICogaHR0cHM6Ly9naXRodWIuY29tL2FkYmxvY2twbHVzL2FkYmxvY2twbHVzY29yZS9ibG9iLzZiMmEzMDkwNTRjYzIzNDMyMTAyYjg1ZDEzZjEyNTU5NjM5ZWY0OTUvbGliL2NvbnRlbnQvc25pcHBldHMuanMjTDg2NFxuICpcbiAqICoqU3ludGF4KipcbiAqIGBgYFxuICogZXhhbXBsZS5vcmcjJSMvL3NjcmlwdGxldCgnYWJvcnQtb24tcHJvcGVydHktcmVhZCcsIHByb3BlcnR5Wywgc3RhY2tdKVxuICogYGBgXG4gKlxuICogLSBgcHJvcGVydHlgIC0gcmVxdWlyZWQsIHBhdGggdG8gYSBwcm9wZXJ0eSAoam9pbmVkIHdpdGggYC5gIGlmIG5lZWRlZCkuIFRoZSBwcm9wZXJ0eSBtdXN0IGJlIGF0dGFjaGVkIHRvIGB3aW5kb3dgXG4gKiAtIGBzdGFja2AgLSBvcHRpb25hbCwgc3RyaW5nIG9yIHJlZ3VsYXIgZXhwcmVzc2lvbiB0aGF0IG11c3QgbWF0Y2ggdGhlIGN1cnJlbnQgZnVuY3Rpb24gY2FsbCBzdGFjayB0cmFjZVxuICpcbiAqICoqRXhhbXBsZXMqKlxuICogYGBgXG4gKiAhIEFib3J0cyBzY3JpcHQgd2hlbiBpdCB0cmllcyB0byBhY2Nlc3MgYHdpbmRvdy5hbGVydGBcbiAqIGV4YW1wbGUub3JnIyUjLy9zY3JpcHRsZXQoJ2Fib3J0LW9uLXByb3BlcnR5LXJlYWQnLCAnYWxlcnQnKVxuICpcbiAqICEgQWJvcnRzIHNjcmlwdCB3aGVuIGl0IHRyaWVzIHRvIGFjY2VzcyBgbmF2aWdhdG9yLmxhbmd1YWdlYFxuICogZXhhbXBsZS5vcmcjJSMvL3NjcmlwdGxldCgnYWJvcnQtb24tcHJvcGVydHktcmVhZCcsICduYXZpZ2F0b3IubGFuZ3VhZ2UnKVxuICpcbiAqICEgQWJvcnRzIHNjcmlwdCB3aGVuIGl0IHRyaWVzIHRvIGFjY2VzcyBgd2luZG93LmFkYmxvY2tgIGFuZCBpdCdzIGVycm9yIHN0YWNrIHRyYWNlIGNvbnRhaW5zIGB0ZXN0LmpzYFxuICogZXhhbXBsZS5vcmcjJSMvL3NjcmlwdGxldCgnYWJvcnQtb24tcHJvcGVydHktcmVhZCcsICdhZGJsb2NrJywgJ3Rlc3QuanMnKVxuICogYGBgXG4gKi9cblxuLyogZXNsaW50LWVuYWJsZSBtYXgtbGVuICovXG5cbmZ1bmN0aW9uIGFib3J0T25Qcm9wZXJ0eVJlYWQoc291cmNlLCBwcm9wZXJ0eSwgc3RhY2spIHtcbiAgaWYgKCFwcm9wZXJ0eSB8fCAhbWF0Y2hTdGFja1RyYWNlKHN0YWNrLCBuZXcgRXJyb3IoKS5zdGFjaykpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgcmlkID0gcmFuZG9tSWQoKTtcblxuICB2YXIgYWJvcnQgPSBmdW5jdGlvbiBhYm9ydCgpIHtcbiAgICBoaXQoc291cmNlKTtcbiAgICB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IocmlkKTtcbiAgfTtcblxuICB2YXIgc2V0Q2hhaW5Qcm9wQWNjZXNzID0gZnVuY3Rpb24gc2V0Q2hhaW5Qcm9wQWNjZXNzKG93bmVyLCBwcm9wZXJ0eSkge1xuICAgIHZhciBjaGFpbkluZm8gPSBnZXRQcm9wZXJ0eUluQ2hhaW4ob3duZXIsIHByb3BlcnR5KTtcbiAgICB2YXIgYmFzZSA9IGNoYWluSW5mby5iYXNlO1xuICAgIHZhciBwcm9wID0gY2hhaW5JbmZvLnByb3AsXG4gICAgICAgIGNoYWluID0gY2hhaW5JbmZvLmNoYWluO1xuXG4gICAgaWYgKGNoYWluKSB7XG4gICAgICB2YXIgc2V0dGVyID0gZnVuY3Rpb24gc2V0dGVyKGEpIHtcbiAgICAgICAgYmFzZSA9IGE7XG5cbiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBPYmplY3QpIHtcbiAgICAgICAgICBzZXRDaGFpblByb3BBY2Nlc3MoYSwgY2hhaW4pO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob3duZXIsIHByb3AsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgICAgcmV0dXJuIGJhc2U7XG4gICAgICAgIH0sXG4gICAgICAgIHNldDogc2V0dGVyXG4gICAgICB9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBzZXRQcm9wZXJ0eUFjY2VzcyhiYXNlLCBwcm9wLCB7XG4gICAgICBnZXQ6IGFib3J0LFxuICAgICAgc2V0OiBmdW5jdGlvbiBzZXQoKSB7fVxuICAgIH0pO1xuICB9O1xuXG4gIHNldENoYWluUHJvcEFjY2Vzcyh3aW5kb3csIHByb3BlcnR5KTtcbiAgd2luZG93Lm9uZXJyb3IgPSBjcmVhdGVPbkVycm9ySGFuZGxlcihyaWQpLmJpbmQoKTtcbn1cbmFib3J0T25Qcm9wZXJ0eVJlYWQubmFtZXMgPSBbJ2Fib3J0LW9uLXByb3BlcnR5LXJlYWQnLCAvLyBhbGlhc2VzIGFyZSBuZWVkZWQgZm9yIG1hdGNoaW5nIHRoZSByZWxhdGVkIHNjcmlwdGxldCBjb252ZXJ0ZWQgaW50byBvdXIgc3ludGF4XG4nYWJvcnQtb24tcHJvcGVydHktcmVhZC5qcycsICd1Ym8tYWJvcnQtb24tcHJvcGVydHktcmVhZC5qcycsICdhb3ByLmpzJywgJ3Viby1hb3ByLmpzJywgJ3Viby1hYm9ydC1vbi1wcm9wZXJ0eS1yZWFkJywgJ3Viby1hb3ByJywgJ2FicC1hYm9ydC1vbi1wcm9wZXJ0eS1yZWFkJ107XG5hYm9ydE9uUHJvcGVydHlSZWFkLmluamVjdGlvbnMgPSBbcmFuZG9tSWQsIHRvUmVnRXhwLCBzZXRQcm9wZXJ0eUFjY2VzcywgZ2V0UHJvcGVydHlJbkNoYWluLCBjcmVhdGVPbkVycm9ySGFuZGxlciwgaGl0LCBtYXRjaFN0YWNrVHJhY2VdO1xuXG4vKiBlc2xpbnQtZGlzYWJsZSBtYXgtbGVuICovXG5cbi8qKlxuICogQHNjcmlwdGxldCBhYm9ydC1vbi1wcm9wZXJ0eS13cml0ZVxuICpcbiAqIEBkZXNjcmlwdGlvblxuICogQWJvcnRzIGEgc2NyaXB0IHdoZW4gaXQgYXR0ZW1wdHMgdG8gKip3cml0ZSoqIHRoZSBzcGVjaWZpZWQgcHJvcGVydHkuXG4gKlxuICogUmVsYXRlZCBVQk8gc2NyaXB0bGV0OlxuICogaHR0cHM6Ly9naXRodWIuY29tL2dvcmhpbGwvdUJsb2NrL3dpa2kvUmVzb3VyY2VzLUxpYnJhcnkjYWJvcnQtb24tcHJvcGVydHktd3JpdGVqcy1cbiAqXG4gKiBSZWxhdGVkIEFCUCBzb3VyY2U6XG4gKiBodHRwczovL2dpdGh1Yi5jb20vYWRibG9ja3BsdXMvYWRibG9ja3BsdXNjb3JlL2Jsb2IvNmIyYTMwOTA1NGNjMjM0MzIxMDJiODVkMTNmMTI1NTk2MzllZjQ5NS9saWIvY29udGVudC9zbmlwcGV0cy5qcyNMODk2XG4gKlxuICogKipTeW50YXgqKlxuICogYGBgXG4gKiBleGFtcGxlLm9yZyMlIy8vc2NyaXB0bGV0KCdhYm9ydC1vbi1wcm9wZXJ0eS13cml0ZScsIHByb3BlcnR5Wywgc3RhY2tdKVxuICogYGBgXG4gKlxuICogLSBgcHJvcGVydHlgIC0gcmVxdWlyZWQsIHBhdGggdG8gYSBwcm9wZXJ0eSAoam9pbmVkIHdpdGggYC5gIGlmIG5lZWRlZCkuIFRoZSBwcm9wZXJ0eSBtdXN0IGJlIGF0dGFjaGVkIHRvIGB3aW5kb3dgXG4gKiAtIGBzdGFja2AgLSBvcHRpb25hbCwgc3RyaW5nIG9yIHJlZ3VsYXIgZXhwcmVzc2lvbiB0aGF0IG11c3QgbWF0Y2ggdGhlIGN1cnJlbnQgZnVuY3Rpb24gY2FsbCBzdGFjayB0cmFjZVxuICpcbiAqICoqRXhhbXBsZXMqKlxuICogYGBgXG4gKiAhIEFib3J0cyBzY3JpcHQgd2hlbiBpdCB0cmllcyB0byBzZXQgYHdpbmRvdy5hZGJsb2NrYCB2YWx1ZVxuICogZXhhbXBsZS5vcmcjJSMvL3NjcmlwdGxldCgnYWJvcnQtb24tcHJvcGVydHktd3JpdGUnLCAnYWRibG9jaycpXG4gKlxuICogISBBYm9ydHMgc2NyaXB0IHdoZW4gaXQgdHJpZXMgdG8gc2V0IGB3aW5kb3cuYWRibG9ja2AgdmFsdWUgYW5kIGl0J3MgZXJyb3Igc3RhY2sgdHJhY2UgY29udGFpbnMgYGNoZWNraW5nLmpzYFxuICogZXhhbXBsZS5vcmcjJSMvL3NjcmlwdGxldCgnYWJvcnQtb24tcHJvcGVydHktd3JpdGUnLCAnYWRibG9jaycsICdjaGVja2luZy5qcycpXG4gKiBgYGBcbiAqL1xuXG4vKiBlc2xpbnQtZW5hYmxlIG1heC1sZW4gKi9cblxuZnVuY3Rpb24gYWJvcnRPblByb3BlcnR5V3JpdGUoc291cmNlLCBwcm9wZXJ0eSwgc3RhY2spIHtcbiAgaWYgKCFwcm9wZXJ0eSB8fCAhbWF0Y2hTdGFja1RyYWNlKHN0YWNrLCBuZXcgRXJyb3IoKS5zdGFjaykpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgcmlkID0gcmFuZG9tSWQoKTtcblxuICB2YXIgYWJvcnQgPSBmdW5jdGlvbiBhYm9ydCgpIHtcbiAgICBoaXQoc291cmNlKTtcbiAgICB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IocmlkKTtcbiAgfTtcblxuICB2YXIgc2V0Q2hhaW5Qcm9wQWNjZXNzID0gZnVuY3Rpb24gc2V0Q2hhaW5Qcm9wQWNjZXNzKG93bmVyLCBwcm9wZXJ0eSkge1xuICAgIHZhciBjaGFpbkluZm8gPSBnZXRQcm9wZXJ0eUluQ2hhaW4ob3duZXIsIHByb3BlcnR5KTtcbiAgICB2YXIgYmFzZSA9IGNoYWluSW5mby5iYXNlO1xuICAgIHZhciBwcm9wID0gY2hhaW5JbmZvLnByb3AsXG4gICAgICAgIGNoYWluID0gY2hhaW5JbmZvLmNoYWluO1xuXG4gICAgaWYgKGNoYWluKSB7XG4gICAgICB2YXIgc2V0dGVyID0gZnVuY3Rpb24gc2V0dGVyKGEpIHtcbiAgICAgICAgYmFzZSA9IGE7XG5cbiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBPYmplY3QpIHtcbiAgICAgICAgICBzZXRDaGFpblByb3BBY2Nlc3MoYSwgY2hhaW4pO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob3duZXIsIHByb3AsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgICAgcmV0dXJuIGJhc2U7XG4gICAgICAgIH0sXG4gICAgICAgIHNldDogc2V0dGVyXG4gICAgICB9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBzZXRQcm9wZXJ0eUFjY2VzcyhiYXNlLCBwcm9wLCB7XG4gICAgICBzZXQ6IGFib3J0XG4gICAgfSk7XG4gIH07XG5cbiAgc2V0Q2hhaW5Qcm9wQWNjZXNzKHdpbmRvdywgcHJvcGVydHkpO1xuICB3aW5kb3cub25lcnJvciA9IGNyZWF0ZU9uRXJyb3JIYW5kbGVyKHJpZCkuYmluZCgpO1xufVxuYWJvcnRPblByb3BlcnR5V3JpdGUubmFtZXMgPSBbJ2Fib3J0LW9uLXByb3BlcnR5LXdyaXRlJywgLy8gYWxpYXNlcyBhcmUgbmVlZGVkIGZvciBtYXRjaGluZyB0aGUgcmVsYXRlZCBzY3JpcHRsZXQgY29udmVydGVkIGludG8gb3VyIHN5bnRheFxuJ2Fib3J0LW9uLXByb3BlcnR5LXdyaXRlLmpzJywgJ3Viby1hYm9ydC1vbi1wcm9wZXJ0eS13cml0ZS5qcycsICdhb3B3LmpzJywgJ3Viby1hb3B3LmpzJywgJ3Viby1hYm9ydC1vbi1wcm9wZXJ0eS13cml0ZScsICd1Ym8tYW9wdycsICdhYnAtYWJvcnQtb24tcHJvcGVydHktd3JpdGUnXTtcbmFib3J0T25Qcm9wZXJ0eVdyaXRlLmluamVjdGlvbnMgPSBbcmFuZG9tSWQsIHNldFByb3BlcnR5QWNjZXNzLCBnZXRQcm9wZXJ0eUluQ2hhaW4sIGNyZWF0ZU9uRXJyb3JIYW5kbGVyLCBoaXQsIHRvUmVnRXhwLCBtYXRjaFN0YWNrVHJhY2VdO1xuXG4vKiBlc2xpbnQtZGlzYWJsZSBtYXgtbGVuICovXG5cbi8qKlxuICogQHNjcmlwdGxldCBwcmV2ZW50LXNldFRpbWVvdXRcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIFByZXZlbnRzIGEgYHNldFRpbWVvdXRgIGNhbGwgaWY6XG4gKiAxKSB0aGUgdGV4dCBvZiB0aGUgY2FsbGJhY2sgaXMgbWF0Y2hpbmcgdGhlIHNwZWNpZmllZCBzZWFyY2ggc3RyaW5nL3JlZ2V4cCB3aGljaCBkb2VzIG5vdCBzdGFydCB3aXRoIGAhYDtcbiAqIG90aGVyd2lzZSBtaXNtYXRjaGVkIGNhbGxzIHNob3VsZCBiZSBkZWZ1c2VkO1xuICogMikgdGhlIHRpbWVvdXQgaXMgbWF0Y2hpbmcgdGhlIHNwZWNpZmllZCBkZWxheTsgb3RoZXJ3aXNlIG1pc21hdGNoZWQgY2FsbHMgc2hvdWxkIGJlIGRlZnVzZWQuXG4gKlxuICogUmVsYXRlZCBVQk8gc2NyaXB0bGV0OlxuICogaHR0cHM6Ly9naXRodWIuY29tL2dvcmhpbGwvdUJsb2NrL3dpa2kvUmVzb3VyY2VzLUxpYnJhcnkjbm8tc2V0dGltZW91dC1pZmpzLVxuICpcbiAqICoqU3ludGF4KipcbiAqIGBgYFxuICogZXhhbXBsZS5vcmcjJSMvL3NjcmlwdGxldCgncHJldmVudC1zZXRUaW1lb3V0J1ssIHNlYXJjaFssIGRlbGF5XV0pXG4gKiBgYGBcbiAqXG4gKiBDYWxsIHdpdGggbm8gYXJndW1lbnRzIHdpbGwgbG9nIGNhbGxzIHRvIHNldFRpbWVvdXQgd2hpbGUgZGVidWdnaW5nIChgbG9nLXNldFRpbWVvdXRgIHN1cGVyc2VkaW5nKSxcbiAqIHNvIHByb2R1Y3Rpb24gZmlsdGVyIGxpc3RzJyBydWxlcyBkZWZpbml0ZWx5IHJlcXVpcmUgYXQgbGVhc3Qgb25lIG9mIHRoZSBwYXJhbWV0ZXJzOlxuICogLSBgc2VhcmNoYCAtIG9wdGlvbmFsLCBzdHJpbmcgb3IgcmVndWxhciBleHByZXNzaW9uLlxuICogSWYgc3RhcnRzIHdpdGggYCFgLCBzY3JpcHRsZXQgd2lsbCBub3QgbWF0Y2ggdGhlIHN0cmluZ2lmaWVkIGNhbGxiYWNrIGJ1dCBhbGwgb3RoZXIgd2lsbCBiZSBkZWZ1c2VkLlxuICogSWYgZG8gbm90IHN0YXJ0IHdpdGggYCFgLCB0aGUgc3RyaW5naWZpZWQgY2FsbGJhY2sgd2lsbCBiZSBtYXRjaGVkLlxuICogSWYgbm90IHNldCwgcHJldmVudHMgYWxsIGBzZXRUaW1lb3V0YCBjYWxscyBkdWUgdG8gc3BlY2lmaWVkIGBkZWxheWAuXG4gKiAtIGBkZWxheWAgLSBvcHRpb25hbCwgbXVzdCBiZSBhbiBpbnRlZ2VyLlxuICogSWYgc3RhcnRzIHdpdGggYCFgLCBzY3JpcHRsZXQgd2lsbCBub3QgbWF0Y2ggdGhlIGRlbGF5IGJ1dCBhbGwgb3RoZXIgd2lsbCBiZSBkZWZ1c2VkLlxuICogSWYgZG8gbm90IHN0YXJ0IHdpdGggYCFgLCB0aGUgZGVsYXkgcGFzc2VkIHRvIHRoZSBgc2V0VGltZW91dGAgY2FsbCB3aWxsIGJlIG1hdGNoZWQuXG4gKlxuICogPiBJZiBgcHJldmVudC1zZXRUaW1lb3V0YCB3aXRob3V0IHBhcmFtZXRlcnMgbG9ncyBzbXRoIGxpa2UgYHNldFRpbWVvdXQodW5kZWZpbmVkLCAxMDAwKWAsXG4gKiBpdCBtZWFucyB0aGF0IG5vIGNhbGxiYWNrIHdhcyBwYXNzZWQgdG8gc2V0VGltZW91dCgpIGFuZCB0aGF0J3Mgbm90IHNjcmlwdGxldCBpc3N1ZVxuICpcbiAqICoqRXhhbXBsZXMqKlxuICogMS4gUHJldmVudHMgYHNldFRpbWVvdXRgIGNhbGxzIGlmIHRoZSBjYWxsYmFjayBtYXRjaGVzIGAvXFwudGVzdC9gIHJlZ2FyZGxlc3Mgb2YgdGhlIGRlbGF5LlxuICogICAgIGBgYGJhc2hcbiAqICAgICBleGFtcGxlLm9yZyMlIy8vc2NyaXB0bGV0KCdwcmV2ZW50LXNldFRpbWVvdXQnLCAnL1xcLnRlc3QvJylcbiAqICAgICBgYGBcbiAqXG4gKiAgICAgRm9yIGluc3RhbmNlLCB0aGUgZm9sbG93aW5nIGNhbGwgd2lsbCBiZSBwcmV2ZW50ZWQ6XG4gKiAgICAgYGBgamF2YXNjcmlwdFxuICogICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICogICAgICAgICB3aW5kb3cudGVzdCA9IFwidmFsdWVcIjtcbiAqICAgICB9LCAxMDApO1xuICogICAgIGBgYFxuICpcbiAqIDIuIFByZXZlbnRzIGBzZXRUaW1lb3V0YCBjYWxscyBpZiB0aGUgY2FsbGJhY2sgZG9lcyBub3QgY29udGFpbiBgdmFsdWVgLlxuICogICAgIGBgYFxuICogICAgIGV4YW1wbGUub3JnIyUjLy9zY3JpcHRsZXQoJ3ByZXZlbnQtc2V0VGltZW91dCcsICchdmFsdWUnKVxuICogICAgIGBgYFxuICpcbiAqICAgICBGb3IgaW5zdGFuY2UsIG9ubHkgdGhlIGZpcnN0IG9mIHRoZSBmb2xsb3dpbmcgY2FsbHMgd2lsbCBiZSBwcmV2ZW50ZWQ6XG4gKiAgICAgYGBgamF2YXNjcmlwdFxuICogICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICogICAgICAgICB3aW5kb3cudGVzdCA9IFwidGVzdCAtLSBwcmV2ZW50ZWRcIjtcbiAqICAgICB9LCAzMDApO1xuICogICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICogICAgICAgICB3aW5kb3cudGVzdCA9IFwidmFsdWUgLS0gZXhlY3V0ZWRcIjtcbiAqICAgICB9LCA0MDApO1xuICogICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICogICAgICAgICB3aW5kb3cudmFsdWUgPSBcInRlc3QgLS0gZXhlY3V0ZWRcIjtcbiAqICAgICB9LCA1MDApO1xuICogICAgIGBgYFxuICpcbiAqIDMuIFByZXZlbnRzIGBzZXRUaW1lb3V0YCBjYWxscyBpZiB0aGUgY2FsbGJhY2sgY29udGFpbnMgYHZhbHVlYCBhbmQgdGhlIGRlbGF5IGlzIG5vdCBzZXQgdG8gYDMwMGAuXG4gKiAgICAgYGBgXG4gKiAgICAgZXhhbXBsZS5vcmcjJSMvL3NjcmlwdGxldCgncHJldmVudC1zZXRUaW1lb3V0JywgJ3ZhbHVlJywgJyEzMDAnKVxuICogICAgIGBgYFxuICpcbiAqICAgICBGb3IgaW5zdGFuY2UsIG9ubHkgdGhlIGZpcnN0IG9mIHRoZSBmb2xsb3dpbmcgY2FsbHMgd2lsbCBub3QgYmUgcHJldmVudGVkOlxuICogICAgIGBgYGphdmFzY3JpcHRcbiAqICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAqICAgICAgICAgd2luZG93LnRlc3QgPSBcInZhbHVlIDEgLS0gZXhlY3V0ZWRcIjtcbiAqICAgICB9LCAzMDApO1xuICogICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICogICAgICAgICB3aW5kb3cudGVzdCA9IFwidmFsdWUgMiAtLSBwcmV2ZW50ZWRcIjtcbiAqICAgICB9LCA0MDApO1xuICogICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICogICAgICAgICB3aW5kb3cudGVzdCA9IFwidmFsdWUgMyAtLSBwcmV2ZW50ZWRcIjtcbiAqICAgICB9LCA1MDApO1xuICogICAgIGBgYFxuICpcbiAqIDQuIFByZXZlbnRzIGBzZXRUaW1lb3V0YCBjYWxscyBpZiB0aGUgY2FsbGJhY2sgZG9lcyBub3QgY29udGFpbiBgdmFsdWVgIGFuZCB0aGUgZGVsYXkgaXMgbm90IHNldCB0byBgMzAwYC5cbiAqICAgICBgYGBcbiAqICAgICBleGFtcGxlLm9yZyMlIy8vc2NyaXB0bGV0KCdwcmV2ZW50LXNldFRpbWVvdXQnLCAnIXZhbHVlJywgJyEzMDAnKVxuICogICAgIGBgYFxuICpcbiAqICAgICBGb3IgaW5zdGFuY2UsIG9ubHkgdGhlIHNlY29uZCBvZiB0aGUgZm9sbG93aW5nIGNhbGxzIHdpbGwgYmUgcHJldmVudGVkOlxuICogICAgIGBgYGphdmFzY3JpcHRcbiAqICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAqICAgICAgICAgd2luZG93LnRlc3QgPSBcInRlc3QgLS0gZXhlY3V0ZWRcIjtcbiAqICAgICB9LCAzMDApO1xuICogICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICogICAgICAgICB3aW5kb3cudGVzdCA9IFwidGVzdCAtLSBwcmV2ZW50ZWRcIjtcbiAqICAgICB9LCA0MDApO1xuICogICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICogICAgICAgICB3aW5kb3cudGVzdCA9IFwidmFsdWUgLS0gZXhlY3V0ZWRcIjtcbiAqICAgICB9LCA0MDApO1xuICogICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICogICAgICAgICB3aW5kb3cudmFsdWUgPSBcInRlc3QgLS0gZXhlY3V0ZWRcIjtcbiAqICAgICB9LCA1MDApO1xuICogICAgIGBgYFxuICovXG5cbi8qIGVzbGludC1lbmFibGUgbWF4LWxlbiAqL1xuXG5mdW5jdGlvbiBwcmV2ZW50U2V0VGltZW91dChzb3VyY2UsIG1hdGNoLCBkZWxheSkge1xuICB2YXIgbmF0aXZlVGltZW91dCA9IHdpbmRvdy5zZXRUaW1lb3V0O1xuICB2YXIgbG9nID0gY29uc29sZS5sb2cuYmluZChjb25zb2xlKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1jb25zb2xlXG4gIC8vIGxvZ3Mgc2V0VGltZW91dHMgdG8gY29uc29sZSBpZiBubyBhcmd1bWVudHMgaGF2ZSBiZWVuIHNwZWNpZmllZFxuXG4gIHZhciBzaG91bGRMb2cgPSB0eXBlb2YgbWF0Y2ggPT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiBkZWxheSA9PT0gJ3VuZGVmaW5lZCc7XG5cbiAgdmFyIF9wYXJzZU1hdGNoQXJnID0gcGFyc2VNYXRjaEFyZyhtYXRjaCksXG4gICAgICBpc0ludmVydGVkTWF0Y2ggPSBfcGFyc2VNYXRjaEFyZy5pc0ludmVydGVkTWF0Y2gsXG4gICAgICBtYXRjaFJlZ2V4cCA9IF9wYXJzZU1hdGNoQXJnLm1hdGNoUmVnZXhwO1xuXG4gIHZhciBfcGFyc2VEZWxheUFyZyA9IHBhcnNlRGVsYXlBcmcoZGVsYXkpLFxuICAgICAgaXNJbnZlcnRlZERlbGF5TWF0Y2ggPSBfcGFyc2VEZWxheUFyZy5pc0ludmVydGVkRGVsYXlNYXRjaCxcbiAgICAgIGRlbGF5TWF0Y2ggPSBfcGFyc2VEZWxheUFyZy5kZWxheU1hdGNoO1xuXG4gIHZhciB0aW1lb3V0V3JhcHBlciA9IGZ1bmN0aW9uIHRpbWVvdXRXcmFwcGVyKGNhbGxiYWNrLCB0aW1lb3V0KSB7XG4gICAgdmFyIHNob3VsZFByZXZlbnQgPSBmYWxzZTsgLy8gaHR0cHM6Ly9naXRodWIuY29tL0FkZ3VhcmRUZWFtL1NjcmlwdGxldHMvaXNzdWVzLzEwNVxuXG4gICAgdmFyIGNiU3RyaW5nID0gU3RyaW5nKGNhbGxiYWNrKTtcblxuICAgIGlmIChzaG91bGRMb2cpIHtcbiAgICAgIGhpdChzb3VyY2UpO1xuICAgICAgbG9nKFwic2V0VGltZW91dChcIi5jb25jYXQoY2JTdHJpbmcsIFwiLCBcIikuY29uY2F0KHRpbWVvdXQsIFwiKVwiKSk7XG4gICAgfSBlbHNlIGlmICghZGVsYXlNYXRjaCkge1xuICAgICAgc2hvdWxkUHJldmVudCA9IG1hdGNoUmVnZXhwLnRlc3QoY2JTdHJpbmcpICE9PSBpc0ludmVydGVkTWF0Y2g7XG4gICAgfSBlbHNlIGlmICghbWF0Y2gpIHtcbiAgICAgIHNob3VsZFByZXZlbnQgPSB0aW1lb3V0ID09PSBkZWxheU1hdGNoICE9PSBpc0ludmVydGVkRGVsYXlNYXRjaDtcbiAgICB9IGVsc2Uge1xuICAgICAgc2hvdWxkUHJldmVudCA9IG1hdGNoUmVnZXhwLnRlc3QoY2JTdHJpbmcpICE9PSBpc0ludmVydGVkTWF0Y2ggJiYgdGltZW91dCA9PT0gZGVsYXlNYXRjaCAhPT0gaXNJbnZlcnRlZERlbGF5TWF0Y2g7XG4gICAgfVxuXG4gICAgaWYgKHNob3VsZFByZXZlbnQpIHtcbiAgICAgIGhpdChzb3VyY2UpO1xuICAgICAgcmV0dXJuIG5hdGl2ZVRpbWVvdXQobm9vcEZ1bmMsIHRpbWVvdXQpO1xuICAgIH1cblxuICAgIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KF9sZW4gPiAyID8gX2xlbiAtIDIgOiAwKSwgX2tleSA9IDI7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHtcbiAgICAgIGFyZ3NbX2tleSAtIDJdID0gYXJndW1lbnRzW19rZXldO1xuICAgIH1cblxuICAgIHJldHVybiBuYXRpdmVUaW1lb3V0LmFwcGx5KHdpbmRvdywgW2NhbGxiYWNrLCB0aW1lb3V0XS5jb25jYXQoYXJncykpO1xuICB9O1xuXG4gIHdpbmRvdy5zZXRUaW1lb3V0ID0gdGltZW91dFdyYXBwZXI7XG59XG5wcmV2ZW50U2V0VGltZW91dC5uYW1lcyA9IFsncHJldmVudC1zZXRUaW1lb3V0JywgLy8gYWxpYXNlcyBhcmUgbmVlZGVkIGZvciBtYXRjaGluZyB0aGUgcmVsYXRlZCBzY3JpcHRsZXQgY29udmVydGVkIGludG8gb3VyIHN5bnRheFxuJ25vLXNldFRpbWVvdXQtaWYuanMnLCAvLyBuZXcgaW1wbGVtZW50YXRpb24gb2Ygc2V0VGltZW91dC1kZWZ1c2VyLmpzXG4ndWJvLW5vLXNldFRpbWVvdXQtaWYuanMnLCAnbm9zdGlmLmpzJywgLy8gbmV3IHNob3J0IG5hbWUgb2Ygbm8tc2V0VGltZW91dC1pZlxuJ3Viby1ub3N0aWYuanMnLCAndWJvLW5vLXNldFRpbWVvdXQtaWYnLCAndWJvLW5vc3RpZicsIC8vIG9sZCBzY3JpcHRsZXQgbmFtZXMgd2hpY2ggc2hvdWxkIGJlIHN1cHBvcnRlZCBhcyB3ZWxsLlxuLy8gc2hvdWxkIGJlIHJlbW92ZWQgZXZlbnR1YWxseS5cbi8vIGRvIG5vdCByZW1vdmUgdW50aWwgb3RoZXIgZmlsdGVyIGxpc3RzIG1haW50YWluZXJzIHVzZSB0aGVtXG4nc2V0VGltZW91dC1kZWZ1c2VyLmpzJywgJ3Viby1zZXRUaW1lb3V0LWRlZnVzZXIuanMnLCAndWJvLXNldFRpbWVvdXQtZGVmdXNlcicsICdzdGQuanMnLCAndWJvLXN0ZC5qcycsICd1Ym8tc3RkJ107XG5wcmV2ZW50U2V0VGltZW91dC5pbmplY3Rpb25zID0gW2hpdCwgbm9vcEZ1bmMsIHBhcnNlTWF0Y2hBcmcsIHBhcnNlRGVsYXlBcmcsIHRvUmVnRXhwLCBzdGFydHNXaXRoLCBuYXRpdmVJc05hTl07XG5cbi8qIGVzbGludC1kaXNhYmxlIG1heC1sZW4gKi9cblxuLyoqXG4gKiBAc2NyaXB0bGV0IHByZXZlbnQtc2V0SW50ZXJ2YWxcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIFByZXZlbnRzIGEgYHNldEludGVydmFsYCBjYWxsIGlmOlxuICogMSkgdGhlIHRleHQgb2YgdGhlIGNhbGxiYWNrIGlzIG1hdGNoaW5nIHRoZSBzcGVjaWZpZWQgYHNlYXJjaGAgc3RyaW5nL3JlZ2V4cCB3aGljaCBkb2VzIG5vdCBzdGFydCB3aXRoIGAhYDtcbiAqIG90aGVyd2lzZSBtaXNtYXRjaGVkIGNhbGxzIHNob3VsZCBiZSBkZWZ1c2VkO1xuICogMikgdGhlIGludGVydmFsIGlzIG1hdGNoaW5nIHRoZSBzcGVjaWZpZWQgYGRlbGF5YDsgb3RoZXJ3aXNlIG1pc21hdGNoZWQgY2FsbHMgc2hvdWxkIGJlIGRlZnVzZWQuXG4gKlxuICogUmVsYXRlZCBVQk8gc2NyaXB0bGV0OlxuICogaHR0cHM6Ly9naXRodWIuY29tL2dvcmhpbGwvdUJsb2NrL3dpa2kvUmVzb3VyY2VzLUxpYnJhcnkjbm8tc2V0aW50ZXJ2YWwtaWZqcy1cbiAqXG4gKiAqKlN5bnRheCoqXG4gKiBgYGBcbiAqIGV4YW1wbGUub3JnIyUjLy9zY3JpcHRsZXQoJ3ByZXZlbnQtc2V0SW50ZXJ2YWwnWywgc2VhcmNoWywgZGVsYXldXSlcbiAqIGBgYFxuICpcbiAqIENhbGwgd2l0aCBubyBhcmd1bWVudHMgd2lsbCBsb2cgY2FsbHMgdG8gc2V0SW50ZXJ2YWwgd2hpbGUgZGVidWdnaW5nIChgbG9nLXNldEludGVydmFsYCBzdXBlcnNlZGluZyksXG4gKiBzbyBwcm9kdWN0aW9uIGZpbHRlciBsaXN0cycgcnVsZXMgZGVmaW5pdGVseSByZXF1aXJlIGF0IGxlYXN0IG9uZSBvZiB0aGUgcGFyYW1ldGVyczpcbiAqIC0gYHNlYXJjaGAgLSBvcHRpb25hbCwgc3RyaW5nIG9yIHJlZ3VsYXIgZXhwcmVzc2lvbi5cbiAqIElmIHN0YXJ0cyB3aXRoIGAhYCwgc2NyaXB0bGV0IHdpbGwgbm90IG1hdGNoIHRoZSBzdHJpbmdpZmllZCBjYWxsYmFjayBidXQgYWxsIG90aGVyIHdpbGwgYmUgZGVmdXNlZC5cbiAqIElmIGRvIG5vdCBzdGFydCB3aXRoIGAhYCwgdGhlIHN0cmluZ2lmaWVkIGNhbGxiYWNrIHdpbGwgYmUgbWF0Y2hlZC5cbiAqIElmIG5vdCBzZXQsIHByZXZlbnRzIGFsbCBgc2V0SW50ZXJ2YWxgIGNhbGxzIGR1ZSB0byBzcGVjaWZpZWQgYGRlbGF5YC5cbiAqIC0gYGRlbGF5YCAtIG9wdGlvbmFsLCBtdXN0IGJlIGFuIGludGVnZXIuXG4gKiBJZiBzdGFydHMgd2l0aCBgIWAsIHNjcmlwdGxldCB3aWxsIG5vdCBtYXRjaCB0aGUgZGVsYXkgYnV0IGFsbCBvdGhlciB3aWxsIGJlIGRlZnVzZWQuXG4gKiBJZiBkbyBub3Qgc3RhcnQgd2l0aCBgIWAsIHRoZSBkZWxheSBwYXNzZWQgdG8gdGhlIGBzZXRJbnRlcnZhbGAgY2FsbCB3aWxsIGJlIG1hdGNoZWQuXG4gKlxuICogPiBJZiBgcHJldmVudC1zZXRJbnRlcnZhbGAgd2l0aG91dCBwYXJhbWV0ZXJzIGxvZ3Mgc210aCBsaWtlIGBzZXRJbnRlcnZhbCh1bmRlZmluZWQsIDEwMDApYCxcbiAqIGl0IG1lYW5zIHRoYXQgbm8gY2FsbGJhY2sgd2FzIHBhc3NlZCB0byBzZXRJbnRlcnZhbCgpIGFuZCB0aGF0J3Mgbm90IHNjcmlwdGxldCBpc3N1ZVxuXG4gKiAgKipFeGFtcGxlcyoqXG4gKiAxLiBQcmV2ZW50cyBgc2V0SW50ZXJ2YWxgIGNhbGxzIGlmIHRoZSBjYWxsYmFjayBtYXRjaGVzIGAvXFwudGVzdC9gIHJlZ2FyZGxlc3Mgb2YgdGhlIGRlbGF5LlxuICogICAgIGBgYGJhc2hcbiAqICAgICBleGFtcGxlLm9yZyMlIy8vc2NyaXB0bGV0KCdwcmV2ZW50LXNldEludGVydmFsJywgJy9cXC50ZXN0LycpXG4gKiAgICAgYGBgXG4gKlxuICogICAgIEZvciBpbnN0YW5jZSwgdGhlIGZvbGxvd2luZyBjYWxsIHdpbGwgYmUgcHJldmVudGVkOlxuICogICAgIGBgYGphdmFzY3JpcHRcbiAqICAgICBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7XG4gKiAgICAgICAgIHdpbmRvdy50ZXN0ID0gXCJ2YWx1ZVwiO1xuICogICAgIH0sIDEwMCk7XG4gKiAgICAgYGBgXG4gKlxuICogMi4gUHJldmVudHMgYHNldEludGVydmFsYCBjYWxscyBpZiB0aGUgY2FsbGJhY2sgZG9lcyBub3QgY29udGFpbiBgdmFsdWVgLlxuICogICAgIGBgYFxuICogICAgIGV4YW1wbGUub3JnIyUjLy9zY3JpcHRsZXQoJ3ByZXZlbnQtc2V0SW50ZXJ2YWwnLCAnIXZhbHVlJylcbiAqICAgICBgYGBcbiAqXG4gKiAgICAgRm9yIGluc3RhbmNlLCBvbmx5IHRoZSBmaXJzdCBvZiB0aGUgZm9sbG93aW5nIGNhbGxzIHdpbGwgYmUgcHJldmVudGVkOlxuICogICAgIGBgYGphdmFzY3JpcHRcbiAqICAgICBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7XG4gKiAgICAgICAgIHdpbmRvdy50ZXN0ID0gXCJ0ZXN0IC0tIHByZXZlbnRlZFwiO1xuICogICAgIH0sIDMwMCk7XG4gKiAgICAgc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xuICogICAgICAgICB3aW5kb3cudGVzdCA9IFwidmFsdWUgLS0gZXhlY3V0ZWRcIjtcbiAqICAgICB9LCA0MDApO1xuICogICAgIHNldEludGVydmFsKGZ1bmN0aW9uICgpIHtcbiAqICAgICAgICAgd2luZG93LnZhbHVlID0gXCJ0ZXN0IC0tIGV4ZWN1dGVkXCI7XG4gKiAgICAgfSwgNTAwKTtcbiAqICAgICBgYGBcbiAqXG4gKiAzLiBQcmV2ZW50cyBgc2V0SW50ZXJ2YWxgIGNhbGxzIGlmIHRoZSBjYWxsYmFjayBjb250YWlucyBgdmFsdWVgIGFuZCB0aGUgZGVsYXkgaXMgbm90IHNldCB0byBgMzAwYC5cbiAqICAgICBgYGBcbiAqICAgICBleGFtcGxlLm9yZyMlIy8vc2NyaXB0bGV0KCdwcmV2ZW50LXNldEludGVydmFsJywgJ3ZhbHVlJywgJyEzMDAnKVxuICogICAgIGBgYFxuICpcbiAqICAgICBGb3IgaW5zdGFuY2UsIG9ubHkgdGhlIGZpcnN0IG9mIHRoZSBmb2xsb3dpbmcgY2FsbHMgd2lsbCBub3QgYmUgcHJldmVudGVkOlxuICogICAgIGBgYGphdmFzY3JpcHRcbiAqICAgICBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7XG4gKiAgICAgICAgIHdpbmRvdy50ZXN0ID0gXCJ2YWx1ZSAxIC0tIGV4ZWN1dGVkXCI7XG4gKiAgICAgfSwgMzAwKTtcbiAqICAgICBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7XG4gKiAgICAgICAgIHdpbmRvdy50ZXN0ID0gXCJ2YWx1ZSAyIC0tIHByZXZlbnRlZFwiO1xuICogICAgIH0sIDQwMCk7XG4gKiAgICAgc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xuICogICAgICAgICB3aW5kb3cudGVzdCA9IFwidmFsdWUgMyAtLSBwcmV2ZW50ZWRcIjtcbiAqICAgICB9LCA1MDApO1xuICogICAgIGBgYFxuICpcbiAqIDQuIFByZXZlbnRzIGBzZXRJbnRlcnZhbGAgY2FsbHMgaWYgdGhlIGNhbGxiYWNrIGRvZXMgbm90IGNvbnRhaW4gYHZhbHVlYCBhbmQgdGhlIGRlbGF5IGlzIG5vdCBzZXQgdG8gYDMwMGAuXG4gKiAgICAgYGBgXG4gKiAgICAgZXhhbXBsZS5vcmcjJSMvL3NjcmlwdGxldCgncHJldmVudC1zZXRJbnRlcnZhbCcsICchdmFsdWUnLCAnITMwMCcpXG4gKiAgICAgYGBgXG4gKlxuICogICAgIEZvciBpbnN0YW5jZSwgb25seSB0aGUgc2Vjb25kIG9mIHRoZSBmb2xsb3dpbmcgY2FsbHMgd2lsbCBiZSBwcmV2ZW50ZWQ6XG4gKiAgICAgYGBgamF2YXNjcmlwdFxuICogICAgIHNldEludGVydmFsKGZ1bmN0aW9uICgpIHtcbiAqICAgICAgICAgd2luZG93LnRlc3QgPSBcInRlc3QgLS0gZXhlY3V0ZWRcIjtcbiAqICAgICB9LCAzMDApO1xuICogICAgIHNldEludGVydmFsKGZ1bmN0aW9uICgpIHtcbiAqICAgICAgICAgd2luZG93LnRlc3QgPSBcInRlc3QgLS0gcHJldmVudGVkXCI7XG4gKiAgICAgfSwgNDAwKTtcbiAqICAgICBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7XG4gKiAgICAgICAgIHdpbmRvdy50ZXN0ID0gXCJ2YWx1ZSAtLSBleGVjdXRlZFwiO1xuICogICAgIH0sIDQwMCk7XG4gKiAgICAgc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xuICogICAgICAgICB3aW5kb3cudmFsdWUgPSBcInRlc3QgLS0gZXhlY3V0ZWRcIjtcbiAqICAgICB9LCA1MDApO1xuICogICAgIGBgYFxuICovXG5cbi8qIGVzbGludC1lbmFibGUgbWF4LWxlbiAqL1xuXG5mdW5jdGlvbiBwcmV2ZW50U2V0SW50ZXJ2YWwoc291cmNlLCBtYXRjaCwgZGVsYXkpIHtcbiAgdmFyIG5hdGl2ZUludGVydmFsID0gd2luZG93LnNldEludGVydmFsO1xuICB2YXIgbG9nID0gY29uc29sZS5sb2cuYmluZChjb25zb2xlKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1jb25zb2xlXG4gIC8vIGxvZ3Mgc2V0SW50ZXJ2YWxzIHRvIGNvbnNvbGUgaWYgbm8gYXJndW1lbnRzIGhhdmUgYmVlbiBzcGVjaWZpZWRcblxuICB2YXIgc2hvdWxkTG9nID0gdHlwZW9mIG1hdGNoID09PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgZGVsYXkgPT09ICd1bmRlZmluZWQnO1xuXG4gIHZhciBfcGFyc2VNYXRjaEFyZyA9IHBhcnNlTWF0Y2hBcmcobWF0Y2gpLFxuICAgICAgaXNJbnZlcnRlZE1hdGNoID0gX3BhcnNlTWF0Y2hBcmcuaXNJbnZlcnRlZE1hdGNoLFxuICAgICAgbWF0Y2hSZWdleHAgPSBfcGFyc2VNYXRjaEFyZy5tYXRjaFJlZ2V4cDtcblxuICB2YXIgX3BhcnNlRGVsYXlBcmcgPSBwYXJzZURlbGF5QXJnKGRlbGF5KSxcbiAgICAgIGlzSW52ZXJ0ZWREZWxheU1hdGNoID0gX3BhcnNlRGVsYXlBcmcuaXNJbnZlcnRlZERlbGF5TWF0Y2gsXG4gICAgICBkZWxheU1hdGNoID0gX3BhcnNlRGVsYXlBcmcuZGVsYXlNYXRjaDtcblxuICB2YXIgaW50ZXJ2YWxXcmFwcGVyID0gZnVuY3Rpb24gaW50ZXJ2YWxXcmFwcGVyKGNhbGxiYWNrLCBpbnRlcnZhbCkge1xuICAgIHZhciBzaG91bGRQcmV2ZW50ID0gZmFsc2U7IC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9BZGd1YXJkVGVhbS9TY3JpcHRsZXRzL2lzc3Vlcy8xMDVcblxuICAgIHZhciBjYlN0cmluZyA9IFN0cmluZyhjYWxsYmFjayk7XG5cbiAgICBpZiAoc2hvdWxkTG9nKSB7XG4gICAgICBoaXQoc291cmNlKTtcbiAgICAgIGxvZyhcInNldEludGVydmFsKFwiLmNvbmNhdChjYlN0cmluZywgXCIsIFwiKS5jb25jYXQoaW50ZXJ2YWwsIFwiKVwiKSk7XG4gICAgfSBlbHNlIGlmICghZGVsYXlNYXRjaCkge1xuICAgICAgc2hvdWxkUHJldmVudCA9IG1hdGNoUmVnZXhwLnRlc3QoY2JTdHJpbmcpICE9PSBpc0ludmVydGVkTWF0Y2g7XG4gICAgfSBlbHNlIGlmICghbWF0Y2gpIHtcbiAgICAgIHNob3VsZFByZXZlbnQgPSBpbnRlcnZhbCA9PT0gZGVsYXlNYXRjaCAhPT0gaXNJbnZlcnRlZERlbGF5TWF0Y2g7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNob3VsZFByZXZlbnQgPSBtYXRjaFJlZ2V4cC50ZXN0KGNiU3RyaW5nKSAhPT0gaXNJbnZlcnRlZE1hdGNoICYmIGludGVydmFsID09PSBkZWxheU1hdGNoICE9PSBpc0ludmVydGVkRGVsYXlNYXRjaDtcbiAgICB9XG5cbiAgICBpZiAoc2hvdWxkUHJldmVudCkge1xuICAgICAgaGl0KHNvdXJjZSk7XG4gICAgICByZXR1cm4gbmF0aXZlSW50ZXJ2YWwobm9vcEZ1bmMsIGludGVydmFsKTtcbiAgICB9XG5cbiAgICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShfbGVuID4gMiA/IF9sZW4gLSAyIDogMCksIF9rZXkgPSAyOyBfa2V5IDwgX2xlbjsgX2tleSsrKSB7XG4gICAgICBhcmdzW19rZXkgLSAyXSA9IGFyZ3VtZW50c1tfa2V5XTtcbiAgICB9XG5cbiAgICByZXR1cm4gbmF0aXZlSW50ZXJ2YWwuYXBwbHkod2luZG93LCBbY2FsbGJhY2ssIGludGVydmFsXS5jb25jYXQoYXJncykpO1xuICB9O1xuXG4gIHdpbmRvdy5zZXRJbnRlcnZhbCA9IGludGVydmFsV3JhcHBlcjtcbn1cbnByZXZlbnRTZXRJbnRlcnZhbC5uYW1lcyA9IFsncHJldmVudC1zZXRJbnRlcnZhbCcsIC8vIGFsaWFzZXMgYXJlIG5lZWRlZCBmb3IgbWF0Y2hpbmcgdGhlIHJlbGF0ZWQgc2NyaXB0bGV0IGNvbnZlcnRlZCBpbnRvIG91ciBzeW50YXhcbiduby1zZXRJbnRlcnZhbC1pZi5qcycsIC8vIG5ldyBpbXBsZW1lbnRhdGlvbiBvZiBzZXRJbnRlcnZhbC1kZWZ1c2VyLmpzXG4ndWJvLW5vLXNldEludGVydmFsLWlmLmpzJywgJ3NldEludGVydmFsLWRlZnVzZXIuanMnLCAvLyBvbGQgbmFtZSBzaG91bGQgYmUgc3VwcG9ydGVkIGFzIHdlbGxcbid1Ym8tc2V0SW50ZXJ2YWwtZGVmdXNlci5qcycsICdub3NpaWYuanMnLCAvLyBuZXcgc2hvcnQgbmFtZSBvZiBuby1zZXRJbnRlcnZhbC1pZlxuJ3Viby1ub3NpaWYuanMnLCAnc2lkLmpzJywgLy8gb2xkIHNob3J0IHNjcmlwdGxldCBuYW1lXG4ndWJvLXNpZC5qcycsICd1Ym8tbm8tc2V0SW50ZXJ2YWwtaWYnLCAndWJvLXNldEludGVydmFsLWRlZnVzZXInLCAndWJvLW5vc2lpZicsICd1Ym8tc2lkJ107XG5wcmV2ZW50U2V0SW50ZXJ2YWwuaW5qZWN0aW9ucyA9IFtoaXQsIG5vb3BGdW5jLCBwYXJzZU1hdGNoQXJnLCBwYXJzZURlbGF5QXJnLCB0b1JlZ0V4cCwgc3RhcnRzV2l0aCwgbmF0aXZlSXNOYU5dO1xuXG4vKiBlc2xpbnQtZGlzYWJsZSBtYXgtbGVuICovXG5cbi8qKlxuICogQHNjcmlwdGxldCBwcmV2ZW50LXdpbmRvdy1vcGVuXG4gKlxuICogQGRlc2NyaXB0aW9uXG4gKiBQcmV2ZW50cyBgd2luZG93Lm9wZW5gIGNhbGxzIHdoZW4gVVJMIGVpdGhlciBtYXRjaGVzIG9yIG5vdCBtYXRjaGVzIHRoZSBzcGVjaWZpZWQgc3RyaW5nL3JlZ2V4cC4gVXNpbmcgaXQgd2l0aG91dCBwYXJhbWV0ZXJzIHByZXZlbnRzIGFsbCBgd2luZG93Lm9wZW5gIGNhbGxzLlxuICpcbiAqIFJlbGF0ZWQgVUJPIHNjcmlwdGxldDpcbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9nb3JoaWxsL3VCbG9jay93aWtpL1Jlc291cmNlcy1MaWJyYXJ5I3dpbmRvd29wZW4tZGVmdXNlcmpzLVxuICpcbiAqICoqU3ludGF4KipcbiAqIGBgYFxuICogZXhhbXBsZS5vcmcjJSMvL3NjcmlwdGxldCgncHJldmVudC13aW5kb3ctb3BlbidbLCBtYXRjaFssIGRlbGF5WywgcmVwbGFjZW1lbnRdXV0pXG4gKiBgYGBcbiAqXG4gKiAtIGBtYXRjaGAgLSBvcHRpb25hbCwgc3RyaW5nIG9yIHJlZ3VsYXIgZXhwcmVzc2lvbi4gSWYgbm90IHNldCwgYWxsIHdpbmRvdy5vcGVuIGNhbGxzIHdpbGwgYmUgbWF0Y2hlZC5cbiAqIElmIHN0YXJ0cyB3aXRoIGAhYCwgc2NyaXB0bGV0IHdpbGwgbm90IG1hdGNoIHRoZSBzdHJpbmdpZmllZCBjYWxsYmFjayBidXQgYWxsIG90aGVyIHdpbGwgYmUgZGVmdXNlZC5cbiAqIElmIGRvIG5vdCBzdGFydCB3aXRoIGAhYCwgdGhlIHN0cmluZ2lmaWVkIGNhbGxiYWNrIHdpbGwgYmUgbWF0Y2hlZC5cbiAqIC0gYGRlbGF5YCAtIG9wdGlvbmFsLCBudW1iZXIgb2Ygc2Vjb25kcy4gSWYgbm90IHNldCwgc2NyaXB0bGV0IHdpbGwgcmV0dXJuIGBudWxsYCxcbiAqIG90aGVyd2lzZSB2YWxpZCBzaGFtIHdpbmRvdyBvYmplY3QgYXMgaW5qZWN0ZWQgYGlmcmFtZWAgd2lsbCBiZSByZXR1cm5lZFxuICogZm9yIGFjY2Vzc2luZyBpdCdzIG1ldGhvZHMgKGJsdXIoKSwgZm9jdXMoKSBldGMuKSBhbmQgd2lsbCBiZSByZW1vdmVkIGFmdGVyIHRoZSBkZWxheS5cbiAqIC0gYHJlcGxhY2VtZW50YCAtIG9wdGlvbmFsLCBzdHJpbmc7IG9uZSBvZiB0aGUgcHJlZGVmaW5lZCBjb25zdGFudHM6XG4gKiAgICAgLSBgb2JqYCAtIGZvciByZXR1cm5pbmcgYW4gb2JqZWN0IGluc3RlYWQgb2YgZGVmYXVsdCBpZnJhbWU7XG4gKiAgICAgICAgZm9yIGNhc2VzIHdoZW4gdGhlIHBhZ2UgcmVxdWlyZXMgYSB2YWxpZCBgd2luZG93YCBpbnN0YW5jZSB0byBiZSByZXR1cm5lZFxuICogICAgIC0gYGxvZ2AgLSBmb3IgbG9nZ2luZyB3aW5kb3cub3BlbiBjYWxsczsgcGVybWl0dGVkIGZvciBwcm9kdWN0aW9uIGZpbHRlciBsaXN0cy5cbiAqXG4gKiAqKkV4YW1wbGVzKipcbiAqIDEuIFByZXZlbnQgYWxsIGB3aW5kb3cub3BlbmAgY2FsbHM6XG4gKiBgYGBcbiAqICAgICBleGFtcGxlLm9yZyMlIy8vc2NyaXB0bGV0KCdwcmV2ZW50LXdpbmRvdy1vcGVuJylcbiAqIGBgYFxuICpcbiAqIDIuIFByZXZlbnQgYHdpbmRvdy5vcGVuYCBmb3IgYWxsIFVSTHMgY29udGFpbmluZyBgZXhhbXBsZWA6XG4gKiBgYGBcbiAqICAgICBleGFtcGxlLm9yZyMlIy8vc2NyaXB0bGV0KCdwcmV2ZW50LXdpbmRvdy1vcGVuJywgJ2V4YW1wbGUnKVxuICogYGBgXG4gKlxuICogMy4gUHJldmVudCBgd2luZG93Lm9wZW5gIGZvciBhbGwgVVJMcyBtYXRjaGluZyBSZWdFeHAgYC9leGFtcGxlXFwuL2A6XG4gKiBgYGBcbiAqICAgICBleGFtcGxlLm9yZyMlIy8vc2NyaXB0bGV0KCdwcmV2ZW50LXdpbmRvdy1vcGVuJywgJy9leGFtcGxlXFwuLycpXG4gKiBgYGBcbiAqXG4gKiA0LiBQcmV2ZW50IGB3aW5kb3cub3BlbmAgZm9yIGFsbCBVUkxzICoqTk9UKiogY29udGFpbmluZyBgZXhhbXBsZWA6XG4gKiBgYGBcbiAqICAgICBleGFtcGxlLm9yZyMlIy8vc2NyaXB0bGV0KCdwcmV2ZW50LXdpbmRvdy1vcGVuJywgJyFleGFtcGxlJylcbiAqIGBgYFxuICpcbiAqIE9sZCBzeW50YXggb2YgcHJldmVudC13aW5kb3ctb3BlbiBwYXJhbWV0ZXJzOlxuICogLSBgbWF0Y2hgIC0gb3B0aW9uYWwsIGRlZmF1bHRzIHRvIFwibWF0Y2hpbmdcIiwgYW55IHBvc2l0aXZlIG51bWJlciBvciBub3RoaW5nIGZvciBcIm1hdGNoaW5nXCIsIDAgb3IgZW1wdHkgc3RyaW5nIGZvciBcIm5vdCBtYXRjaGluZ1wiXG4gKiAtIGBzZWFyY2hgIC0gb3B0aW9uYWwsIHN0cmluZyBvciByZWdleHAgZm9yIG1hdGNoaW5nIHRoZSBVUkwgcGFzc2VkIHRvIGB3aW5kb3cub3BlbmAgY2FsbDsgZGVmYXVsdHMgdG8gc2VhcmNoIGFsbCBgd2luZG93Lm9wZW5gIGNhbGxcbiAqIC0gYHJlcGxhY2VtZW50YCAtIG9wdGlvbmFsLCBzdHJpbmcgdG8gcmV0dXJuIHByb3AgdmFsdWUgb3IgcHJvcGVydHkgaW5zdGVhZCBvZiB3aW5kb3cub3BlbjsgZGVmYXVsdHMgdG8gcmV0dXJuIG5vb3BGdW5jLlxuICogKipFeGFtcGxlcyoqXG4gKiBgYGBcbiAqICAgICBleGFtcGxlLm9yZyMlIy8vc2NyaXB0bGV0KCdwcmV2ZW50LXdpbmRvdy1vcGVuJywgJzEnLCAnL2V4YW1wbGVcXC4vJ1xuICogICAgIGV4YW1wbGUub3JnIyUjLy9zY3JpcHRsZXQoJ3ByZXZlbnQtd2luZG93LW9wZW4nLCAnMCcsICdleGFtcGxlJylcbiAqICAgICBleGFtcGxlLm9yZyMlIy8vc2NyaXB0bGV0KCdwcmV2ZW50LXdpbmRvdy1vcGVuJywgJycsICcnLCAndHJ1ZUZ1bmMnKVxuICogICAgIGV4YW1wbGUub3JnIyUjLy9zY3JpcHRsZXQoJ3ByZXZlbnQtd2luZG93LW9wZW4nLCAnMScsICcnLCAne3Byb3BOYW1lPW5vb3BGdW5jfScpXG4gKiBgYGBcbiAqXG4gKiA+IEZvciBiZXR0ZXIgY29tcGF0aWJpbGl0eSB3aXRoIHVCTywgb2xkIHN5bnRheCBpcyBub3QgcmVjb21tZW5kZWQgdG8gdXNlLlxuICovXG5cbi8qIGVzbGludC1lbmFibGUgbWF4LWxlbiAqL1xuXG5mdW5jdGlvbiBwcmV2ZW50V2luZG93T3Blbihzb3VyY2UpIHtcbiAgdmFyIG1hdGNoID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBnZXRXaWxkY2FyZFN5bWJvbCgpO1xuICB2YXIgZGVsYXkgPSBhcmd1bWVudHMubGVuZ3RoID4gMiA/IGFyZ3VtZW50c1syXSA6IHVuZGVmaW5lZDtcbiAgdmFyIHJlcGxhY2VtZW50ID0gYXJndW1lbnRzLmxlbmd0aCA+IDMgPyBhcmd1bWVudHNbM10gOiB1bmRlZmluZWQ7XG4gIC8vIGRlZmF1bHQgbWF0Y2ggdmFsdWUgaXMgbmVlZGVkIGZvciBwcmV2ZW50aW5nIGFsbCB3aW5kb3cub3BlbiBjYWxsc1xuICAvLyBpZiBzY3JpcHRsZXQgcnVucyB3aXRob3V0IGFyZ3NcbiAgdmFyIG5hdGl2ZU9wZW4gPSB3aW5kb3cub3BlbjtcbiAgdmFyIGlzTmV3U3ludGF4ID0gbWF0Y2ggIT09ICcwJyAmJiBtYXRjaCAhPT0gJzEnO1xuXG4gIHZhciBvbGRPcGVuV3JhcHBlciA9IGZ1bmN0aW9uIG9sZE9wZW5XcmFwcGVyKHN0cikge1xuICAgIG1hdGNoID0gTnVtYmVyKG1hdGNoKSA+IDA7IC8vICdkZWxheScgd2FzICdzZWFyY2gnIHByb3AgZm9yIG1hdGNoaW5nIGluIG9sZCBzeW50YXhcblxuICAgIHZhciBzZWFyY2hSZWdleHAgPSB0b1JlZ0V4cChkZWxheSk7XG5cbiAgICBpZiAobWF0Y2ggIT09IHNlYXJjaFJlZ2V4cC50ZXN0KHN0cikpIHtcbiAgICAgIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KF9sZW4gPiAxID8gX2xlbiAtIDEgOiAwKSwgX2tleSA9IDE7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHtcbiAgICAgICAgYXJnc1tfa2V5IC0gMV0gPSBhcmd1bWVudHNbX2tleV07XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBuYXRpdmVPcGVuLmFwcGx5KHdpbmRvdywgW3N0cl0uY29uY2F0KGFyZ3MpKTtcbiAgICB9XG5cbiAgICBoaXQoc291cmNlKTtcbiAgICByZXR1cm4gaGFuZGxlT2xkUmVwbGFjZW1lbnQocmVwbGFjZW1lbnQpO1xuICB9O1xuXG4gIHZhciBuZXdPcGVuV3JhcHBlciA9IGZ1bmN0aW9uIG5ld09wZW5XcmFwcGVyKHVybCkge1xuICAgIHZhciBzaG91bGRMb2cgPSByZXBsYWNlbWVudCAmJiByZXBsYWNlbWVudC5pbmRleE9mKCdsb2cnKSA+IC0xO1xuXG4gICAgZm9yICh2YXIgX2xlbjIgPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KF9sZW4yID4gMSA/IF9sZW4yIC0gMSA6IDApLCBfa2V5MiA9IDE7IF9rZXkyIDwgX2xlbjI7IF9rZXkyKyspIHtcbiAgICAgIGFyZ3NbX2tleTIgLSAxXSA9IGFyZ3VtZW50c1tfa2V5Ml07XG4gICAgfVxuXG4gICAgaWYgKHNob3VsZExvZykge1xuICAgICAgdmFyIGFyZ3NTdHIgPSBhcmdzICYmIGFyZ3MubGVuZ3RoID4gMCA/IFwiLCBcIi5jb25jYXQoYXJncy5qb2luKCcsICcpKSA6ICcnO1xuICAgICAgdmFyIGxvZ01lc3NhZ2UgPSBcImxvZzogd2luZG93LW9wZW46IFwiLmNvbmNhdCh1cmwpLmNvbmNhdChhcmdzU3RyKTtcbiAgICAgIGhpdChzb3VyY2UsIGxvZ01lc3NhZ2UpO1xuICAgIH1cblxuICAgIHZhciBzaG91bGRQcmV2ZW50ID0gZmFsc2U7XG5cbiAgICBpZiAobWF0Y2ggPT09IGdldFdpbGRjYXJkU3ltYm9sKCkpIHtcbiAgICAgIHNob3VsZFByZXZlbnQgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgX3BhcnNlTWF0Y2hBcmcgPSBwYXJzZU1hdGNoQXJnKG1hdGNoKSxcbiAgICAgICAgICBpc0ludmVydGVkTWF0Y2ggPSBfcGFyc2VNYXRjaEFyZy5pc0ludmVydGVkTWF0Y2gsXG4gICAgICAgICAgbWF0Y2hSZWdleHAgPSBfcGFyc2VNYXRjaEFyZy5tYXRjaFJlZ2V4cDtcblxuICAgICAgc2hvdWxkUHJldmVudCA9IG1hdGNoUmVnZXhwLnRlc3QodXJsKSAhPT0gaXNJbnZlcnRlZE1hdGNoO1xuICAgIH1cblxuICAgIGlmIChzaG91bGRQcmV2ZW50KSB7XG4gICAgICB2YXIgcGFyc2VkRGVsYXkgPSBwYXJzZUludChkZWxheSwgMTApO1xuICAgICAgdmFyIHJlc3VsdDtcblxuICAgICAgaWYgKG5hdGl2ZUlzTmFOKHBhcnNlZERlbGF5KSkge1xuICAgICAgICByZXN1bHQgPSBub29wTnVsbCgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIGRlY295QXJncyA9IHtcbiAgICAgICAgICByZXBsYWNlbWVudDogcmVwbGFjZW1lbnQsXG4gICAgICAgICAgdXJsOiB1cmwsXG4gICAgICAgICAgZGVsYXk6IHBhcnNlZERlbGF5XG4gICAgICAgIH07XG4gICAgICAgIHZhciBkZWNveSA9IGNyZWF0ZURlY295KGRlY295QXJncyk7XG4gICAgICAgIHZhciBwb3B1cCA9IGRlY295LmNvbnRlbnRXaW5kb3c7XG5cbiAgICAgICAgaWYgKHR5cGVvZiBwb3B1cCA9PT0gJ29iamVjdCcgJiYgcG9wdXAgIT09IG51bGwpIHtcbiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocG9wdXAsICdjbG9zZWQnLCB7XG4gICAgICAgICAgICB2YWx1ZTogZmFsc2VcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB2YXIgbmF0aXZlR2V0dGVyID0gZGVjb3kuY29udGVudFdpbmRvdyAmJiBkZWNveS5jb250ZW50V2luZG93LmdldDtcbiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZGVjb3ksICdjb250ZW50V2luZG93Jywge1xuICAgICAgICAgICAgZ2V0OiBnZXRQcmV2ZW50R2V0dGVyKG5hdGl2ZUdldHRlcilcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBwb3B1cCA9IGRlY295LmNvbnRlbnRXaW5kb3c7XG4gICAgICAgIH1cblxuICAgICAgICByZXN1bHQgPSBwb3B1cDtcbiAgICAgIH1cblxuICAgICAgaGl0KHNvdXJjZSk7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIHJldHVybiBuYXRpdmVPcGVuLmFwcGx5KHdpbmRvdywgW3VybF0uY29uY2F0KGFyZ3MpKTtcbiAgfTtcblxuICB3aW5kb3cub3BlbiA9IGlzTmV3U3ludGF4ID8gbmV3T3BlbldyYXBwZXIgOiBvbGRPcGVuV3JhcHBlcjtcbn1cbnByZXZlbnRXaW5kb3dPcGVuLm5hbWVzID0gWydwcmV2ZW50LXdpbmRvdy1vcGVuJywgLy8gYWxpYXNlcyBhcmUgbmVlZGVkIGZvciBtYXRjaGluZyB0aGUgcmVsYXRlZCBzY3JpcHRsZXQgY29udmVydGVkIGludG8gb3VyIHN5bnRheFxuJ3dpbmRvdy5vcGVuLWRlZnVzZXIuanMnLCAndWJvLXdpbmRvdy5vcGVuLWRlZnVzZXIuanMnLCAndWJvLXdpbmRvdy5vcGVuLWRlZnVzZXInLCAnbm93b2lmLmpzJywgJ3Viby1ub3dvaWYuanMnLCAndWJvLW5vd29pZiddO1xucHJldmVudFdpbmRvd09wZW4uaW5qZWN0aW9ucyA9IFtoaXQsIHRvUmVnRXhwLCBuYXRpdmVJc05hTiwgcGFyc2VNYXRjaEFyZywgaGFuZGxlT2xkUmVwbGFjZW1lbnQsIGNyZWF0ZURlY295LCBnZXRQcmV2ZW50R2V0dGVyLCBub29wTnVsbCwgZ2V0V2lsZGNhcmRTeW1ib2wsIG5vb3BGdW5jLCB0cnVlRnVuYywgc3RhcnRzV2l0aCwgZW5kc1dpdGgsIHN1YnN0cmluZ0JlZm9yZSwgc3Vic3RyaW5nQWZ0ZXJdO1xuXG4vKiBlc2xpbnQtZGlzYWJsZSBtYXgtbGVuICovXG5cbi8qKlxuICogQHNjcmlwdGxldCBhYm9ydC1jdXJyZW50LWlubGluZS1zY3JpcHRcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIEFib3J0cyBhbiBpbmxpbmUgc2NyaXB0IHdoZW4gaXQgYXR0ZW1wdHMgdG8gKipyZWFkKiogdGhlIHNwZWNpZmllZCBwcm9wZXJ0eVxuICogQU5EIHdoZW4gdGhlIGNvbnRlbnRzIG9mIHRoZSBgPHNjcmlwdD5gIGVsZW1lbnQgY29udGFpbnMgdGhlIHNwZWNpZmllZFxuICogdGV4dCBvciBtYXRjaGVzIHRoZSByZWd1bGFyIGV4cHJlc3Npb24uXG4gKlxuICogUmVsYXRlZCBVQk8gc2NyaXB0bGV0OlxuICogaHR0cHM6Ly9naXRodWIuY29tL2dvcmhpbGwvdUJsb2NrL3dpa2kvUmVzb3VyY2VzLUxpYnJhcnkjYWJvcnQtY3VycmVudC1pbmxpbmUtc2NyaXB0anMtXG4gKlxuICogUmVsYXRlZCBBQlAgc291cmNlOlxuICogaHR0cHM6Ly9naXRodWIuY29tL2FkYmxvY2twbHVzL2FkYmxvY2twbHVzY29yZS9ibG9iLzZiMmEzMDkwNTRjYzIzNDMyMTAyYjg1ZDEzZjEyNTU5NjM5ZWY0OTUvbGliL2NvbnRlbnQvc25pcHBldHMuanMjTDkyOFxuICpcbiAqICoqU3ludGF4KipcbiAqIGBgYFxuICogZXhhbXBsZS5vcmcjJSMvL3NjcmlwdGxldCgnYWJvcnQtY3VycmVudC1pbmxpbmUtc2NyaXB0JywgcHJvcGVydHlbLCBzZWFyY2hdKVxuICogYGBgXG4gKlxuICogLSBgcHJvcGVydHlgIC0gcmVxdWlyZWQsIHBhdGggdG8gYSBwcm9wZXJ0eSAoam9pbmVkIHdpdGggYC5gIGlmIG5lZWRlZCkuIFRoZSBwcm9wZXJ0eSBtdXN0IGJlIGF0dGFjaGVkIHRvIGB3aW5kb3dgXG4gKiAtIGBzZWFyY2hgIC0gb3B0aW9uYWwsIHN0cmluZyBvciByZWd1bGFyIGV4cHJlc3Npb24gdGhhdCBtdXN0IG1hdGNoIHRoZSBpbmxpbmUgc2NyaXB0IGNvbnRlbnRzLiBJZiBub3Qgc2V0LCBhYm9ydCBhbGwgaW5saW5lIHNjcmlwdHMgd2hpY2ggYXJlIHRyeWluZyB0byBhY2Nlc3MgdGhlIHNwZWNpZmllZCBwcm9wZXJ0eVxuICpcbiAqID4gTm90ZSBwbGVhc2UgdGhhdCBmb3IgaW5saW5lIHNjcmlwdCB3aXRoIGFkZEV2ZW50TGlzdGVuZXIgaW4gaXRcbiAqIGBwcm9wZXJ0eWAgc2hvdWxkIGJlIHNldCBhcyBgRXZlbnRUYXJnZXQucHJvdG90eXBlLmFkZEV2ZW50TGlzdGVuZXJgLFxuICogbm90IGp1c3QgYGFkZEV2ZW50TGlzdGVuZXJgLlxuICpcbiAqICoqRXhhbXBsZXMqKlxuICogMS4gQWJvcnRzIGFsbCBpbmxpbmUgc2NyaXB0cyB0cnlpbmcgdG8gYWNjZXNzIGB3aW5kb3cuYWxlcnRgXG4gKiAgICAgYGBgXG4gKiAgICAgZXhhbXBsZS5vcmcjJSMvL3NjcmlwdGxldCgnYWJvcnQtY3VycmVudC1pbmxpbmUtc2NyaXB0JywgJ2FsZXJ0JylcbiAqICAgICBgYGBcbiAqXG4gKiAyLiBBYm9ydHMgaW5saW5lIHNjcmlwdHMgd2hpY2ggYXJlIHRyeWluZyB0byBhY2Nlc3MgYHdpbmRvdy5hbGVydGAgYW5kIGNvbnRhaW4gYEhlbGxvLCB3b3JsZGAuXG4gKiAgICAgYGBgXG4gKiAgICAgZXhhbXBsZS5vcmcjJSMvL3NjcmlwdGxldCgnYWJvcnQtY3VycmVudC1pbmxpbmUtc2NyaXB0JywgJ2FsZXJ0JywgJ0hlbGxvLCB3b3JsZCcpXG4gKiAgICAgYGBgXG4gKlxuICogICAgIEZvciBpbnN0YW5jZSwgdGhlIGZvbGxvd2luZyBzY3JpcHQgd2lsbCBiZSBhYm9ydGVkXG4gKiAgICAgYGBgaHRtbFxuICogICAgIDxzY3JpcHQ+YWxlcnQoXCJIZWxsbywgd29ybGRcIik7PC9zY3JpcHQ+XG4gKiAgICAgYGBgXG4gKlxuICogMy4gQWJvcnRzIGlubGluZSBzY3JpcHRzIHdoaWNoIGFyZSB0cnlpbmcgdG8gYWNjZXNzIGB3aW5kb3cuYWxlcnRgIGFuZCBtYXRjaCB0aGlzIHJlZ2V4cDogYC9IZWxsby4rd29ybGQvYC5cbiAqICAgICBgYGBcbiAqICAgICBleGFtcGxlLm9yZyMlIy8vc2NyaXB0bGV0KCdhYm9ydC1jdXJyZW50LWlubGluZS1zY3JpcHQnLCAnYWxlcnQnLCAnL0hlbGxvLit3b3JsZC8nKVxuICogICAgIGBgYFxuICpcbiAqICAgICBGb3IgaW5zdGFuY2UsIHRoZSBmb2xsb3dpbmcgc2NyaXB0cyB3aWxsIGJlIGFib3J0ZWQ6XG4gKiAgICAgYGBgaHRtbFxuICogICAgIDxzY3JpcHQ+YWxlcnQoXCJIZWxsbywgYmlnIHdvcmxkXCIpOzwvc2NyaXB0PlxuICogICAgIGBgYFxuICogICAgIGBgYGh0bWxcbiAqICAgICA8c2NyaXB0PmFsZXJ0KFwiSGVsbG8sIGxpdHRsZSB3b3JsZFwiKTs8L3NjcmlwdD5cbiAqICAgICBgYGBcbiAqXG4gKiAgICAgVGhpcyBzY3JpcHQgd2lsbCBub3QgYmUgYWJvcnRlZDpcbiAqICAgICBgYGBodG1sXG4gKiAgICAgPHNjcmlwdD5hbGVydChcIkhpLCBsaXR0bGUgd29ybGRcIik7PC9zY3JpcHQ+XG4gKiAgICAgYGBgXG4gKi9cblxuLyogZXNsaW50LWVuYWJsZSBtYXgtbGVuICovXG5cbmZ1bmN0aW9uIGFib3J0Q3VycmVudElubGluZVNjcmlwdChzb3VyY2UsIHByb3BlcnR5LCBzZWFyY2gpIHtcbiAgdmFyIHNlYXJjaFJlZ2V4cCA9IHRvUmVnRXhwKHNlYXJjaCk7XG4gIHZhciByaWQgPSByYW5kb21JZCgpO1xuXG4gIHZhciBnZXRDdXJyZW50U2NyaXB0ID0gZnVuY3Rpb24gZ2V0Q3VycmVudFNjcmlwdCgpIHtcbiAgICBpZiAoJ2N1cnJlbnRTY3JpcHQnIGluIGRvY3VtZW50KSB7XG4gICAgICByZXR1cm4gZG9jdW1lbnQuY3VycmVudFNjcmlwdDsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBjb21wYXQvY29tcGF0XG4gICAgfVxuXG4gICAgdmFyIHNjcmlwdHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc2NyaXB0Jyk7XG4gICAgcmV0dXJuIHNjcmlwdHNbc2NyaXB0cy5sZW5ndGggLSAxXTtcbiAgfTtcblxuICB2YXIgb3VyU2NyaXB0ID0gZ2V0Q3VycmVudFNjcmlwdCgpO1xuXG4gIHZhciBhYm9ydCA9IGZ1bmN0aW9uIGFib3J0KCkge1xuICAgIHZhciBzY3JpcHRFbCA9IGdldEN1cnJlbnRTY3JpcHQoKTtcblxuICAgIGlmICghc2NyaXB0RWwpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2YXIgY29udGVudCA9IHNjcmlwdEVsLnRleHRDb250ZW50OyAvLyBXZSBhcmUgdXNpbmcgTm9kZS5wcm90b3R5cGUudGV4dENvbnRlbnQgcHJvcGVydHkgZGVzY3JpcHRvclxuICAgIC8vIHRvIGdldCB0aGUgcmVhbCBzY3JpcHQgY29udGVudFxuICAgIC8vIGV2ZW4gd2hlbiBkb2N1bWVudC5jdXJyZW50U2NyaXB0LnRleHRDb250ZW50IGlzIHJlcGxhY2VkLlxuICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9BZGd1YXJkVGVhbS9TY3JpcHRsZXRzL2lzc3Vlcy81NyNpc3N1ZWNvbW1lbnQtNTkzNjM4OTkxXG5cbiAgICB0cnkge1xuICAgICAgdmFyIHRleHRDb250ZW50R2V0dGVyID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihOb2RlLnByb3RvdHlwZSwgJ3RleHRDb250ZW50JykuZ2V0O1xuICAgICAgY29udGVudCA9IHRleHRDb250ZW50R2V0dGVyLmNhbGwoc2NyaXB0RWwpO1xuICAgIH0gY2F0Y2ggKGUpIHt9IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tZW1wdHlcblxuXG4gICAgaWYgKHNjcmlwdEVsIGluc3RhbmNlb2YgSFRNTFNjcmlwdEVsZW1lbnQgJiYgY29udGVudC5sZW5ndGggPiAwICYmIHNjcmlwdEVsICE9PSBvdXJTY3JpcHQgJiYgc2VhcmNoUmVnZXhwLnRlc3QoY29udGVudCkpIHtcbiAgICAgIGhpdChzb3VyY2UpO1xuICAgICAgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKHJpZCk7XG4gICAgfVxuICB9O1xuXG4gIHZhciBzZXRDaGFpblByb3BBY2Nlc3MgPSBmdW5jdGlvbiBzZXRDaGFpblByb3BBY2Nlc3Mob3duZXIsIHByb3BlcnR5KSB7XG4gICAgdmFyIGNoYWluSW5mbyA9IGdldFByb3BlcnR5SW5DaGFpbihvd25lciwgcHJvcGVydHkpO1xuICAgIHZhciBiYXNlID0gY2hhaW5JbmZvLmJhc2U7XG4gICAgdmFyIHByb3AgPSBjaGFpbkluZm8ucHJvcCxcbiAgICAgICAgY2hhaW4gPSBjaGFpbkluZm8uY2hhaW47IC8vIFRoZSBzY3JpcHRsZXQgbWlnaHQgYmUgZXhlY3V0ZWQgYmVmb3JlIHRoZSBjaGFpbiBwcm9wZXJ0eSBoYXMgYmVlbiBjcmVhdGVkXG4gICAgLy8gKGZvciBpbnN0YW5jZSwgZG9jdW1lbnQuYm9keSBiZWZvcmUgdGhlIEhUTUwgYm9keSB3YXMgbG9hZGVkKS5cbiAgICAvLyBJbiB0aGlzIGNhc2Ugd2UncmUgY2hlY2tpbmcgd2hldGhlciB0aGUgYmFzZSBlbGVtZW50IGV4aXN0cyBvciBub3RcbiAgICAvLyBhbmQgaWYgbm90LCB3ZSBzaW1wbHkgZXhpdCB3aXRob3V0IG92ZXJyaWRpbmcgYW55dGhpbmcuXG4gICAgLy8gZS5nLiBodHRwczovL2dpdGh1Yi5jb20vQWRndWFyZFRlYW0vU2NyaXB0bGV0cy9pc3N1ZXMvNTcjaXNzdWVjb21tZW50LTU3NTg0MTA5MlxuXG4gICAgaWYgKGJhc2UgaW5zdGFuY2VvZiBPYmplY3QgPT09IGZhbHNlICYmIGJhc2UgPT09IG51bGwpIHtcbiAgICAgIHZhciBwcm9wcyA9IHByb3BlcnR5LnNwbGl0KCcuJyk7XG4gICAgICB2YXIgcHJvcEluZGV4ID0gcHJvcHMuaW5kZXhPZihwcm9wKTtcbiAgICAgIHZhciBiYXNlTmFtZSA9IHByb3BzW3Byb3BJbmRleCAtIDFdO1xuICAgICAgY29uc29sZS5sb2coXCJUaGUgc2NyaXB0bGV0IGhhZCBiZWVuIGV4ZWN1dGVkIGJlZm9yZSB0aGUgXCIuY29uY2F0KGJhc2VOYW1lLCBcIiB3YXMgbG9hZGVkLlwiKSk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tY29uc29sZVxuXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKGNoYWluKSB7XG4gICAgICB2YXIgc2V0dGVyID0gZnVuY3Rpb24gc2V0dGVyKGEpIHtcbiAgICAgICAgYmFzZSA9IGE7XG5cbiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBPYmplY3QpIHtcbiAgICAgICAgICBzZXRDaGFpblByb3BBY2Nlc3MoYSwgY2hhaW4pO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob3duZXIsIHByb3AsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgICAgcmV0dXJuIGJhc2U7XG4gICAgICAgIH0sXG4gICAgICAgIHNldDogc2V0dGVyXG4gICAgICB9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2YXIgY3VycmVudFZhbHVlID0gYmFzZVtwcm9wXTtcbiAgICBzZXRQcm9wZXJ0eUFjY2VzcyhiYXNlLCBwcm9wLCB7XG4gICAgICBzZXQ6IGZ1bmN0aW9uIHNldCh2YWx1ZSkge1xuICAgICAgICBhYm9ydCgpO1xuICAgICAgICBjdXJyZW50VmFsdWUgPSB2YWx1ZTtcbiAgICAgIH0sXG4gICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgICAgYWJvcnQoKTtcbiAgICAgICAgcmV0dXJuIGN1cnJlbnRWYWx1ZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcblxuICBzZXRDaGFpblByb3BBY2Nlc3Mod2luZG93LCBwcm9wZXJ0eSk7XG4gIHdpbmRvdy5vbmVycm9yID0gY3JlYXRlT25FcnJvckhhbmRsZXIocmlkKS5iaW5kKCk7XG59XG5hYm9ydEN1cnJlbnRJbmxpbmVTY3JpcHQubmFtZXMgPSBbJ2Fib3J0LWN1cnJlbnQtaW5saW5lLXNjcmlwdCcsIC8vIGFsaWFzZXMgYXJlIG5lZWRlZCBmb3IgbWF0Y2hpbmcgdGhlIHJlbGF0ZWQgc2NyaXB0bGV0IGNvbnZlcnRlZCBpbnRvIG91ciBzeW50YXhcbidhYm9ydC1jdXJyZW50LWlubGluZS1zY3JpcHQuanMnLCAndWJvLWFib3J0LWN1cnJlbnQtaW5saW5lLXNjcmlwdC5qcycsICdhY2lzLmpzJywgJ3Viby1hY2lzLmpzJywgJ3Viby1hYm9ydC1jdXJyZW50LWlubGluZS1zY3JpcHQnLCAndWJvLWFjaXMnLCAnYWJwLWFib3J0LWN1cnJlbnQtaW5saW5lLXNjcmlwdCddO1xuYWJvcnRDdXJyZW50SW5saW5lU2NyaXB0LmluamVjdGlvbnMgPSBbcmFuZG9tSWQsIHNldFByb3BlcnR5QWNjZXNzLCBnZXRQcm9wZXJ0eUluQ2hhaW4sIHRvUmVnRXhwLCBjcmVhdGVPbkVycm9ySGFuZGxlciwgaGl0XTtcblxuLyogZXNsaW50LWRpc2FibGUgbWF4LWxlbiAqL1xuXG4vKipcbiAqIEBzY3JpcHRsZXQgc2V0LWNvbnN0YW50XG4gKlxuICogQGRlc2NyaXB0aW9uXG4gKiBDcmVhdGVzIGEgY29uc3RhbnQgcHJvcGVydHkgYW5kIGFzc2lnbnMgaXQgb25lIG9mIHRoZSB2YWx1ZXMgZnJvbSB0aGUgcHJlZGVmaW5lZCBsaXN0LlxuICpcbiAqID4gQWN0dWFsbHksIGl0J3Mgbm90IGEgY29uc3RhbnQuIFBsZWFzZSBub3RlLCB0aGF0IGl0IGNhbiBiZSByZXdyaXR0ZW4gd2l0aCBhIHZhbHVlIG9mIGEgZGlmZmVyZW50IHR5cGUuXG4gKlxuICogUmVsYXRlZCBVQk8gc2NyaXB0bGV0OlxuICogaHR0cHM6Ly9naXRodWIuY29tL2dvcmhpbGwvdUJsb2NrL3dpa2kvUmVzb3VyY2VzLUxpYnJhcnkjc2V0LWNvbnN0YW50anMtXG4gKlxuICogUmVsYXRlZCBBQlAgc25pcHBldDpcbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9hZGJsb2NrcGx1cy9hZGJsb2NrcGx1c2NvcmUvYmxvYi9hZGJsb2NrcGx1c2Nocm9tZS0zLjkuNC9saWIvY29udGVudC9zbmlwcGV0cy5qcyNMMTM2MVxuICpcbiAqICoqU3ludGF4KipcbiAqIGBgYFxuICogZXhhbXBsZS5vcmcjJSMvL3NjcmlwdGxldCgnc2V0LWNvbnN0YW50JywgcHJvcGVydHksIHZhbHVlWywgc3RhY2tdKVxuICogYGBgXG4gKlxuICogLSBgcHJvcGVydHlgIC0gcmVxdWlyZWQsIHBhdGggdG8gYSBwcm9wZXJ0eSAoam9pbmVkIHdpdGggYC5gIGlmIG5lZWRlZCkuIFRoZSBwcm9wZXJ0eSBtdXN0IGJlIGF0dGFjaGVkIHRvIGB3aW5kb3dgLlxuICogLSBgdmFsdWVgIC0gcmVxdWlyZWQuIFBvc3NpYmxlIHZhbHVlczpcbiAqICAgICAtIHBvc2l0aXZlIGRlY2ltYWwgaW50ZWdlciBgPD0gMzI3NjdgXG4gKiAgICAgLSBvbmUgb2YgdGhlIHByZWRlZmluZWQgY29uc3RhbnRzOlxuICogICAgICAgICAtIGB1bmRlZmluZWRgXG4gKiAgICAgICAgIC0gYGZhbHNlYFxuICogICAgICAgICAtIGB0cnVlYFxuICogICAgICAgICAtIGBudWxsYFxuICogICAgICAgICAtIGBlbXB0eU9iamAgLSBlbXB0eSBvYmplY3RcbiAqICAgICAgICAgLSBgZW1wdHlBcnJgIC0gZW1wdHkgYXJyYXlcbiAqICAgICAgICAgLSBgbm9vcEZ1bmNgIC0gZnVuY3Rpb24gd2l0aCBlbXB0eSBib2R5XG4gKiAgICAgICAgIC0gYHRydWVGdW5jYCAtIGZ1bmN0aW9uIHJldHVybmluZyB0cnVlXG4gKiAgICAgICAgIC0gYGZhbHNlRnVuY2AgLSBmdW5jdGlvbiByZXR1cm5pbmcgZmFsc2VcbiAqICAgICAgICAgLSBgJydgIC0gZW1wdHkgc3RyaW5nXG4gKiAgICAgICAgIC0gYC0xYCAtIG51bWJlciB2YWx1ZSBgLTFgXG4gKiAtIGBzdGFja2AgLSBvcHRpb25hbCwgc3RyaW5nIG9yIHJlZ3VsYXIgZXhwcmVzc2lvbiB0aGF0IG11c3QgbWF0Y2ggdGhlIGN1cnJlbnQgZnVuY3Rpb24gY2FsbCBzdGFjayB0cmFjZVxuICpcbiAqICoqRXhhbXBsZXMqKlxuICogYGBgXG4gKiAhIHdpbmRvdy5maXJzdENvbnN0ID09PSBmYWxzZSAvLyB0aGlzIGNvbXBhcmlzaW9uIHdpbGwgcmV0dXJuIGZhbHNlXG4gKiBleGFtcGxlLm9yZyMlIy8vc2NyaXB0bGV0KCdzZXQtY29uc3RhbnQnLCAnZmlyc3RDb25zdCcsICdmYWxzZScpXG4gKlxuICogISB3aW5kb3cuc2Vjb25kKCkgPT09IHRydWVGdW5jIC8vICdzZWNvbmQnIGNhbGwgd2lsbCByZXR1cm4gdHJ1ZVxuICogZXhhbXBsZS5vcmcjJSMvL3NjcmlwdGxldCgnc2V0LWNvbnN0YW50JywgJ3NlY29uZENvbnN0JywgJ3RydWVGdW5jJylcbiAqXG4gKiAhIGRvY3VtZW50LnRoaXJkKCkgPT09IGZhbHNlRnVuYyAgLy8gJ3RoaXJkJyBjYWxsIHdpbGwgcmV0dXJuIGZhbHNlIGlmIHRoZSBtZXRob2QgaXMgcmVsYXRlZCB0byBjaGVja2luZy5qc1xuICogZXhhbXBsZS5vcmcjJSMvL3NjcmlwdGxldCgnc2V0LWNvbnN0YW50JywgJ3NlY29uZENvbnN0JywgJ3RydWVGdW5jJywgJ2NoZWNraW5nLmpzJylcbiAqIGBgYFxuICovXG5cbi8qIGVzbGludC1lbmFibGUgbWF4LWxlbiAqL1xuXG5mdW5jdGlvbiBzZXRDb25zdGFudChzb3VyY2UsIHByb3BlcnR5LCB2YWx1ZSwgc3RhY2spIHtcbiAgaWYgKCFwcm9wZXJ0eSB8fCAhbWF0Y2hTdGFja1RyYWNlKHN0YWNrLCBuZXcgRXJyb3IoKS5zdGFjaykpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgZW1wdHlBcnIgPSBub29wQXJyYXkoKTtcbiAgdmFyIGVtcHR5T2JqID0gbm9vcE9iamVjdCgpO1xuICB2YXIgY29uc3RhbnRWYWx1ZTtcblxuICBpZiAodmFsdWUgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgY29uc3RhbnRWYWx1ZSA9IHVuZGVmaW5lZDtcbiAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gJ2ZhbHNlJykge1xuICAgIGNvbnN0YW50VmFsdWUgPSBmYWxzZTtcbiAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gJ3RydWUnKSB7XG4gICAgY29uc3RhbnRWYWx1ZSA9IHRydWU7XG4gIH0gZWxzZSBpZiAodmFsdWUgPT09ICdudWxsJykge1xuICAgIGNvbnN0YW50VmFsdWUgPSBudWxsO1xuICB9IGVsc2UgaWYgKHZhbHVlID09PSAnZW1wdHlBcnInKSB7XG4gICAgY29uc3RhbnRWYWx1ZSA9IGVtcHR5QXJyO1xuICB9IGVsc2UgaWYgKHZhbHVlID09PSAnZW1wdHlPYmonKSB7XG4gICAgY29uc3RhbnRWYWx1ZSA9IGVtcHR5T2JqO1xuICB9IGVsc2UgaWYgKHZhbHVlID09PSAnbm9vcEZ1bmMnKSB7XG4gICAgY29uc3RhbnRWYWx1ZSA9IG5vb3BGdW5jO1xuICB9IGVsc2UgaWYgKHZhbHVlID09PSAndHJ1ZUZ1bmMnKSB7XG4gICAgY29uc3RhbnRWYWx1ZSA9IHRydWVGdW5jO1xuICB9IGVsc2UgaWYgKHZhbHVlID09PSAnZmFsc2VGdW5jJykge1xuICAgIGNvbnN0YW50VmFsdWUgPSBmYWxzZUZ1bmM7XG4gIH0gZWxzZSBpZiAoL15cXGQrJC8udGVzdCh2YWx1ZSkpIHtcbiAgICBjb25zdGFudFZhbHVlID0gcGFyc2VGbG9hdCh2YWx1ZSk7XG5cbiAgICBpZiAobmF0aXZlSXNOYU4oY29uc3RhbnRWYWx1ZSkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoTWF0aC5hYnMoY29uc3RhbnRWYWx1ZSkgPiAweDdGRkYpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gIH0gZWxzZSBpZiAodmFsdWUgPT09ICctMScpIHtcbiAgICBjb25zdGFudFZhbHVlID0gLTE7XG4gIH0gZWxzZSBpZiAodmFsdWUgPT09ICcnKSB7XG4gICAgY29uc3RhbnRWYWx1ZSA9ICcnO1xuICB9IGVsc2Uge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBjYW5jZWxlZCA9IGZhbHNlO1xuXG4gIHZhciBtdXN0Q2FuY2VsID0gZnVuY3Rpb24gbXVzdENhbmNlbCh2YWx1ZSkge1xuICAgIGlmIChjYW5jZWxlZCkge1xuICAgICAgcmV0dXJuIGNhbmNlbGVkO1xuICAgIH1cblxuICAgIGNhbmNlbGVkID0gdmFsdWUgIT09IHVuZGVmaW5lZCAmJiBjb25zdGFudFZhbHVlICE9PSB1bmRlZmluZWQgJiYgdHlwZW9mIHZhbHVlICE9PSB0eXBlb2YgY29uc3RhbnRWYWx1ZTtcbiAgICByZXR1cm4gY2FuY2VsZWQ7XG4gIH07XG5cbiAgdmFyIHNldENoYWluUHJvcEFjY2VzcyA9IGZ1bmN0aW9uIHNldENoYWluUHJvcEFjY2Vzcyhvd25lciwgcHJvcGVydHkpIHtcbiAgICB2YXIgY2hhaW5JbmZvID0gZ2V0UHJvcGVydHlJbkNoYWluKG93bmVyLCBwcm9wZXJ0eSk7XG4gICAgdmFyIGJhc2UgPSBjaGFpbkluZm8uYmFzZTtcbiAgICB2YXIgcHJvcCA9IGNoYWluSW5mby5wcm9wLFxuICAgICAgICBjaGFpbiA9IGNoYWluSW5mby5jaGFpbjsgLy8gVGhlIHNjcmlwdGxldCBtaWdodCBiZSBleGVjdXRlZCBiZWZvcmUgdGhlIGNoYWluIHByb3BlcnR5IGhhcyBiZWVuIGNyZWF0ZWQuXG4gICAgLy8gSW4gdGhpcyBjYXNlIHdlJ3JlIGNoZWNraW5nIHdoZXRoZXIgdGhlIGJhc2UgZWxlbWVudCBleGlzdHMgb3Igbm90XG4gICAgLy8gYW5kIGlmIG5vdCwgd2Ugc2ltcGx5IGV4aXQgd2l0aG91dCBvdmVycmlkaW5nIGFueXRoaW5nXG5cbiAgICBpZiAoYmFzZSBpbnN0YW5jZW9mIE9iamVjdCA9PT0gZmFsc2UgJiYgYmFzZSA9PT0gbnVsbCkge1xuICAgICAgLy8gbG9nIHRoZSByZWFzb24gb25seSB3aGlsZSBkZWJ1Z2dpbmdcbiAgICAgIGlmIChzb3VyY2UudmVyYm9zZSkge1xuICAgICAgICB2YXIgcHJvcHMgPSBwcm9wZXJ0eS5zcGxpdCgnLicpO1xuICAgICAgICB2YXIgcHJvcEluZGV4ID0gcHJvcHMuaW5kZXhPZihwcm9wKTtcbiAgICAgICAgdmFyIGJhc2VOYW1lID0gcHJvcHNbcHJvcEluZGV4IC0gMV07XG4gICAgICAgIGNvbnNvbGUubG9nKFwic2V0LWNvbnN0YW50IGZhaWxlZCBiZWNhdXNlIHRoZSBwcm9wZXJ0eSAnXCIuY29uY2F0KGJhc2VOYW1lLCBcIicgZG9lcyBub3QgZXhpc3RcIikpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnNvbGVcbiAgICAgIH1cblxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChjaGFpbikge1xuICAgICAgdmFyIHNldHRlciA9IGZ1bmN0aW9uIHNldHRlcihhKSB7XG4gICAgICAgIGJhc2UgPSBhO1xuXG4gICAgICAgIGlmIChhIGluc3RhbmNlb2YgT2JqZWN0KSB7XG4gICAgICAgICAgc2V0Q2hhaW5Qcm9wQWNjZXNzKGEsIGNoYWluKTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG93bmVyLCBwcm9wLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgICAgIHJldHVybiBiYXNlO1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6IHNldHRlclxuICAgICAgfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKG11c3RDYW5jZWwoYmFzZVtwcm9wXSkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBoaXQoc291cmNlKTtcbiAgICBzZXRQcm9wZXJ0eUFjY2VzcyhiYXNlLCBwcm9wLCB7XG4gICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgICAgcmV0dXJuIGNvbnN0YW50VmFsdWU7XG4gICAgICB9LFxuICAgICAgc2V0OiBmdW5jdGlvbiBzZXQoYSkge1xuICAgICAgICBpZiAobXVzdENhbmNlbChhKSkge1xuICAgICAgICAgIGNvbnN0YW50VmFsdWUgPSBhO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH07XG5cbiAgc2V0Q2hhaW5Qcm9wQWNjZXNzKHdpbmRvdywgcHJvcGVydHkpO1xufVxuc2V0Q29uc3RhbnQubmFtZXMgPSBbJ3NldC1jb25zdGFudCcsIC8vIGFsaWFzZXMgYXJlIG5lZWRlZCBmb3IgbWF0Y2hpbmcgdGhlIHJlbGF0ZWQgc2NyaXB0bGV0IGNvbnZlcnRlZCBpbnRvIG91ciBzeW50YXhcbidzZXQtY29uc3RhbnQuanMnLCAndWJvLXNldC1jb25zdGFudC5qcycsICdzZXQuanMnLCAndWJvLXNldC5qcycsICd1Ym8tc2V0LWNvbnN0YW50JywgJ3Viby1zZXQnLCAnYWJwLW92ZXJyaWRlLXByb3BlcnR5LXJlYWQnXTtcbnNldENvbnN0YW50LmluamVjdGlvbnMgPSBbaGl0LCBub29wQXJyYXksIG5vb3BPYmplY3QsIG5vb3BGdW5jLCB0cnVlRnVuYywgZmFsc2VGdW5jLCBnZXRQcm9wZXJ0eUluQ2hhaW4sIHNldFByb3BlcnR5QWNjZXNzLCB0b1JlZ0V4cCwgbWF0Y2hTdGFja1RyYWNlLCBuYXRpdmVJc05hTl07XG5cbi8qIGVzbGludC1kaXNhYmxlIG1heC1sZW4gKi9cblxuLyoqXG4gKiBAc2NyaXB0bGV0IHJlbW92ZS1jb29raWVcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIFJlbW92ZXMgY3VycmVudCBwYWdlIGNvb2tpZXMgYnkgcGFzc2VkIHN0cmluZyBtYXRjaGluZyB3aXRoIG5hbWUuIEZvciBjdXJyZW50IGRvbWFpbiBhbmQgc3ViZG9tYWlucy4gUnVucyBvbiBsb2FkIGFuZCBiZWZvcmUgdW5sb2FkLlxuICpcbiAqIFJlbGF0ZWQgVUJPIHNjcmlwdGxldDpcbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9nb3JoaWxsL3VCbG9jay93aWtpL1Jlc291cmNlcy1MaWJyYXJ5I2Nvb2tpZS1yZW1vdmVyanMtXG4gKlxuICogKipTeW50YXgqKlxuICogYGBgXG4gKiBleGFtcGxlLm9yZyMlIy8vc2NyaXB0bGV0KCdyZW1vdmUtY29va2llJ1ssIG1hdGNoXSlcbiAqIGBgYFxuICpcbiAqIC0gYG1hdGNoYCAtIG9wdGlvbmFsLCBzdHJpbmcgb3IgcmVnZXggbWF0Y2hpbmcgdGhlIGNvb2tpZSBuYW1lLiBJZiBub3Qgc3BlY2lmaWVkIGFsbCBhY2Nlc3NpYmxlIGNvb2tpZXMgd2lsbCBiZSByZW1vdmVkLlxuICpcbiAqICoqRXhhbXBsZXMqKlxuICogMS4gUmVtb3ZlcyBhbGwgY29va2llczpcbiAqIGBgYFxuICogICAgIGV4YW1wbGUub3JnIyUjLy9zY3JpcHRsZXQoJ3JlbW92ZS1jb29raWUnKVxuICogYGBgXG4gKlxuICogMi4gUmVtb3ZlcyBjb29raWVzIHdoaWNoIG5hbWUgY29udGFpbnMgYGV4YW1wbGVgIHN0cmluZy5cbiAqIGBgYFxuICogICAgIGV4YW1wbGUub3JnIyUjLy9zY3JpcHRsZXQoJ3JlbW92ZS1jb29raWUnLCAnZXhhbXBsZScpXG4gKiBgYGBcbiAqXG4gKiAgICAgRm9yIGluc3RhbmNlIHRoaXMgY29va2llIHdpbGwgYmUgcmVtb3ZlZFxuICogICAgIGBgYGphdmFzY3JpcHRcbiAqICAgICBkb2N1bWVudC5jb29raWUgPSAnX19leGFtcGxlPXJhbmRvbVZhbHVlJztcbiAqICAgICBgYGBcbiAqL1xuXG4vKiBlc2xpbnQtZW5hYmxlIG1heC1sZW4gKi9cblxuZnVuY3Rpb24gcmVtb3ZlQ29va2llKHNvdXJjZSwgbWF0Y2gpIHtcbiAgdmFyIG1hdGNoUmVnZXhwID0gdG9SZWdFeHAobWF0Y2gpO1xuXG4gIHZhciByZW1vdmVDb29raWVGcm9tSG9zdCA9IGZ1bmN0aW9uIHJlbW92ZUNvb2tpZUZyb21Ib3N0KGNvb2tpZU5hbWUsIGhvc3ROYW1lKSB7XG4gICAgdmFyIGNvb2tpZVNwZWMgPSBcIlwiLmNvbmNhdChjb29raWVOYW1lLCBcIj1cIik7XG4gICAgdmFyIGRvbWFpbjEgPSBcIjsgZG9tYWluPVwiLmNvbmNhdChob3N0TmFtZSk7XG4gICAgdmFyIGRvbWFpbjIgPSBcIjsgZG9tYWluPS5cIi5jb25jYXQoaG9zdE5hbWUpO1xuICAgIHZhciBwYXRoID0gJzsgcGF0aD0vJztcbiAgICB2YXIgZXhwaXJhdGlvbiA9ICc7IGV4cGlyZXM9VGh1LCAwMSBKYW4gMTk3MCAwMDowMDowMCBHTVQnO1xuICAgIGRvY3VtZW50LmNvb2tpZSA9IGNvb2tpZVNwZWMgKyBleHBpcmF0aW9uO1xuICAgIGRvY3VtZW50LmNvb2tpZSA9IGNvb2tpZVNwZWMgKyBkb21haW4xICsgZXhwaXJhdGlvbjtcbiAgICBkb2N1bWVudC5jb29raWUgPSBjb29raWVTcGVjICsgZG9tYWluMiArIGV4cGlyYXRpb247XG4gICAgZG9jdW1lbnQuY29va2llID0gY29va2llU3BlYyArIHBhdGggKyBleHBpcmF0aW9uO1xuICAgIGRvY3VtZW50LmNvb2tpZSA9IGNvb2tpZVNwZWMgKyBkb21haW4xICsgcGF0aCArIGV4cGlyYXRpb247XG4gICAgZG9jdW1lbnQuY29va2llID0gY29va2llU3BlYyArIGRvbWFpbjIgKyBwYXRoICsgZXhwaXJhdGlvbjtcbiAgICBoaXQoc291cmNlKTtcbiAgfTtcblxuICB2YXIgcm1Db29raWUgPSBmdW5jdGlvbiBybUNvb2tpZSgpIHtcbiAgICBkb2N1bWVudC5jb29raWUuc3BsaXQoJzsnKS5mb3JFYWNoKGZ1bmN0aW9uIChjb29raWVTdHIpIHtcbiAgICAgIHZhciBwb3MgPSBjb29raWVTdHIuaW5kZXhPZignPScpO1xuXG4gICAgICBpZiAocG9zID09PSAtMSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHZhciBjb29raWVOYW1lID0gY29va2llU3RyLnNsaWNlKDAsIHBvcykudHJpbSgpO1xuXG4gICAgICBpZiAoIW1hdGNoUmVnZXhwLnRlc3QoY29va2llTmFtZSkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB2YXIgaG9zdFBhcnRzID0gZG9jdW1lbnQubG9jYXRpb24uaG9zdG5hbWUuc3BsaXQoJy4nKTtcblxuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPD0gaG9zdFBhcnRzLmxlbmd0aCAtIDE7IGkgKz0gMSkge1xuICAgICAgICB2YXIgaG9zdE5hbWUgPSBob3N0UGFydHMuc2xpY2UoaSkuam9pbignLicpO1xuXG4gICAgICAgIGlmIChob3N0TmFtZSkge1xuICAgICAgICAgIHJlbW92ZUNvb2tpZUZyb21Ib3N0KGNvb2tpZU5hbWUsIGhvc3ROYW1lKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9O1xuXG4gIHJtQ29va2llKCk7XG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdiZWZvcmV1bmxvYWQnLCBybUNvb2tpZSk7XG59XG5yZW1vdmVDb29raWUubmFtZXMgPSBbJ3JlbW92ZS1jb29raWUnLCAvLyBhbGlhc2VzIGFyZSBuZWVkZWQgZm9yIG1hdGNoaW5nIHRoZSByZWxhdGVkIHNjcmlwdGxldCBjb252ZXJ0ZWQgaW50byBvdXIgc3ludGF4XG4nY29va2llLXJlbW92ZXIuanMnLCAndWJvLWNvb2tpZS1yZW1vdmVyLmpzJywgJ3Viby1jb29raWUtcmVtb3ZlciddO1xucmVtb3ZlQ29va2llLmluamVjdGlvbnMgPSBbdG9SZWdFeHAsIGhpdF07XG5cbi8qIGVzbGludC1kaXNhYmxlIG1heC1sZW4gKi9cblxuLyoqXG4gKiBAc2NyaXB0bGV0IHByZXZlbnQtYWRkRXZlbnRMaXN0ZW5lclxuICpcbiAqIEBkZXNjcmlwdGlvblxuICogUHJldmVudHMgYWRkaW5nIGV2ZW50IGxpc3RlbmVycyBmb3IgdGhlIHNwZWNpZmllZCBldmVudHMgYW5kIGNhbGxiYWNrcy5cbiAqXG4gKiBSZWxhdGVkIFVCTyBzY3JpcHRsZXQ6XG4gKiBodHRwczovL2dpdGh1Yi5jb20vZ29yaGlsbC91QmxvY2svd2lraS9SZXNvdXJjZXMtTGlicmFyeSNhZGRldmVudGxpc3RlbmVyLWRlZnVzZXJqcy1cbiAqXG4gKiAqKlN5bnRheCoqXG4gKiBgYGBcbiAqIGV4YW1wbGUub3JnIyUjLy9zY3JpcHRsZXQoJ3ByZXZlbnQtYWRkRXZlbnRMaXN0ZW5lcidbLCBldmVudFNlYXJjaFssIGZ1bmN0aW9uU2VhcmNoXV0pXG4gKiBgYGBcbiAqXG4gKiAtIGBldmVudFNlYXJjaGAgLSBvcHRpb25hbCwgc3RyaW5nIG9yIHJlZ2V4IG1hdGNoaW5nIHRoZSBldmVudCBuYW1lLiBJZiBub3Qgc3BlY2lmaWVkLCB0aGUgc2NyaXB0bGV0cyBwcmV2ZW50cyBhbGwgZXZlbnQgbGlzdGVuZXJzXG4gKiAtIGBmdW5jdGlvblNlYXJjaGAgLSBvcHRpb25hbCwgc3RyaW5nIG9yIHJlZ2V4IG1hdGNoaW5nIHRoZSBldmVudCBsaXN0ZW5lciBmdW5jdGlvbiBib2R5LiBJZiBub3Qgc2V0LCB0aGUgc2NyaXB0bGV0IHByZXZlbnRzIGFsbCBldmVudCBsaXN0ZW5lcnMgd2l0aCBldmVudCBuYW1lIG1hdGNoaW5nIGBldmVudFNlYXJjaGBcbiAqXG4gKiAqKkV4YW1wbGVzKipcbiAqIDEuIFByZXZlbnQgYWxsIGBjbGlja2AgbGlzdGVuZXJzOlxuICogYGBgXG4gKiAgICAgZXhhbXBsZS5vcmcjJSMvL3NjcmlwdGxldCgncHJldmVudC1hZGRFdmVudExpc3RlbmVyJywgJ2NsaWNrJylcbiAqIGBgYFxuXG4yLiBQcmV2ZW50ICdjbGljaycgbGlzdGVuZXJzIHdpdGggdGhlIGNhbGxiYWNrIGJvZHkgY29udGFpbmluZyBgc2VhcmNoU3RyaW5nYC5cbiAqIGBgYFxuICogICAgIGV4YW1wbGUub3JnIyUjLy9zY3JpcHRsZXQoJ3ByZXZlbnQtYWRkRXZlbnRMaXN0ZW5lcicsICdjbGljaycsICdzZWFyY2hTdHJpbmcnKVxuICogYGBgXG4gKlxuICogICAgIEZvciBpbnN0YW5jZSwgdGhpcyBsaXN0ZW5lciB3aWxsIG5vdCBiZSBjYWxsZWQ6XG4gKiBgYGBqYXZhc2NyaXB0XG4gKiAgICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gKiAgICAgICAgIHdpbmRvdy50ZXN0ID0gJ3NlYXJjaFN0cmluZyc7XG4gKiAgICAgfSk7XG4gKiBgYGBcbiAqL1xuXG4vKiBlc2xpbnQtZW5hYmxlIG1heC1sZW4gKi9cblxuZnVuY3Rpb24gcHJldmVudEFkZEV2ZW50TGlzdGVuZXIoc291cmNlLCBldmVudFNlYXJjaCwgZnVuY1NlYXJjaCkge1xuICB2YXIgZXZlbnRTZWFyY2hSZWdleHAgPSB0b1JlZ0V4cChldmVudFNlYXJjaCk7XG4gIHZhciBmdW5jU2VhcmNoUmVnZXhwID0gdG9SZWdFeHAoZnVuY1NlYXJjaCk7XG4gIHZhciBuYXRpdmVBZGRFdmVudExpc3RlbmVyID0gd2luZG93LkV2ZW50VGFyZ2V0LnByb3RvdHlwZS5hZGRFdmVudExpc3RlbmVyO1xuXG4gIGZ1bmN0aW9uIGFkZEV2ZW50TGlzdGVuZXJXcmFwcGVyKHR5cGUsIGxpc3RlbmVyKSB7XG4gICAgdmFyIHNob3VsZFByZXZlbnQgPSBmYWxzZTtcblxuICAgIGlmICh2YWxpZGF0ZVR5cGUodHlwZSkgJiYgdmFsaWRhdGVMaXN0ZW5lcihsaXN0ZW5lcikpIHtcbiAgICAgIHNob3VsZFByZXZlbnQgPSBldmVudFNlYXJjaFJlZ2V4cC50ZXN0KHR5cGUudG9TdHJpbmcoKSkgJiYgZnVuY1NlYXJjaFJlZ2V4cC50ZXN0KGxpc3RlbmVyVG9TdHJpbmcobGlzdGVuZXIpKTtcbiAgICB9XG5cbiAgICBpZiAoc2hvdWxkUHJldmVudCkge1xuICAgICAgaGl0KHNvdXJjZSk7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KF9sZW4gPiAyID8gX2xlbiAtIDIgOiAwKSwgX2tleSA9IDI7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHtcbiAgICAgIGFyZ3NbX2tleSAtIDJdID0gYXJndW1lbnRzW19rZXldO1xuICAgIH1cblxuICAgIHJldHVybiBuYXRpdmVBZGRFdmVudExpc3RlbmVyLmFwcGx5KHRoaXMsIFt0eXBlLCBsaXN0ZW5lcl0uY29uY2F0KGFyZ3MpKTtcbiAgfVxuXG4gIHdpbmRvdy5FdmVudFRhcmdldC5wcm90b3R5cGUuYWRkRXZlbnRMaXN0ZW5lciA9IGFkZEV2ZW50TGlzdGVuZXJXcmFwcGVyO1xufVxucHJldmVudEFkZEV2ZW50TGlzdGVuZXIubmFtZXMgPSBbJ3ByZXZlbnQtYWRkRXZlbnRMaXN0ZW5lcicsIC8vIGFsaWFzZXMgYXJlIG5lZWRlZCBmb3IgbWF0Y2hpbmcgdGhlIHJlbGF0ZWQgc2NyaXB0bGV0IGNvbnZlcnRlZCBpbnRvIG91ciBzeW50YXhcbidhZGRFdmVudExpc3RlbmVyLWRlZnVzZXIuanMnLCAndWJvLWFkZEV2ZW50TGlzdGVuZXItZGVmdXNlci5qcycsICdhZWxkLmpzJywgJ3Viby1hZWxkLmpzJywgJ3Viby1hZGRFdmVudExpc3RlbmVyLWRlZnVzZXInLCAndWJvLWFlbGQnXTtcbnByZXZlbnRBZGRFdmVudExpc3RlbmVyLmluamVjdGlvbnMgPSBbaGl0LCB0b1JlZ0V4cCwgdmFsaWRhdGVUeXBlLCB2YWxpZGF0ZUxpc3RlbmVyLCBsaXN0ZW5lclRvU3RyaW5nXTtcblxuLyogZXNsaW50LWRpc2FibGUgY29uc2lzdGVudC1yZXR1cm4sIG5vLWV2YWwgKi9cbi8qKlxuICogQHNjcmlwdGxldCBwcmV2ZW50LWJhYlxuICpcbiAqIEBkZXNjcmlwdGlvblxuICogUHJldmVudHMgQmxvY2tBZGJsb2NrIHNjcmlwdCBmcm9tIGRldGVjdGluZyBhbiBhZCBibG9ja2VyLlxuICpcbiAqIFJlbGF0ZWQgVUJPIHNjcmlwdGxldDpcbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9nb3JoaWxsL3VCbG9jay93aWtpL1Jlc291cmNlcy1MaWJyYXJ5I2JhYi1kZWZ1c2VyanMtXG4gKlxuICogSXQgYWxzbyBjYW4gYmUgdXNlZCBhcyBgJHJlZGlyZWN0YCBzb21ldGltZXMuXG4gKiBTZWUgW3JlZGlyZWN0IGRlc2NyaXB0aW9uXSguLi93aWtpL2Fib3V0LXJlZGlyZWN0cy5tZCNwcmV2ZW50LWJhYikuXG4gKlxuICogKipTeW50YXgqKlxuICogYGBgXG4gKiBleGFtcGxlLm9yZyMlIy8vc2NyaXB0bGV0KCdwcmV2ZW50LWJhYicpXG4gKiBgYGBcbiAqL1xuXG5mdW5jdGlvbiBwcmV2ZW50QmFiKHNvdXJjZSkge1xuICB2YXIgbmF0aXZlU2V0VGltZW91dCA9IHdpbmRvdy5zZXRUaW1lb3V0O1xuICB2YXIgYmFiUmVnZXggPSAvXFwuYmFiX2VsZW1lbnRpZC4kLztcblxuICB2YXIgdGltZW91dFdyYXBwZXIgPSBmdW5jdGlvbiB0aW1lb3V0V3JhcHBlcihjYWxsYmFjaykge1xuICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgIT09ICdzdHJpbmcnIHx8ICFiYWJSZWdleC50ZXN0KGNhbGxiYWNrKSkge1xuICAgICAgZm9yICh2YXIgX2xlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3MgPSBuZXcgQXJyYXkoX2xlbiA+IDEgPyBfbGVuIC0gMSA6IDApLCBfa2V5ID0gMTsgX2tleSA8IF9sZW47IF9rZXkrKykge1xuICAgICAgICBhcmdzW19rZXkgLSAxXSA9IGFyZ3VtZW50c1tfa2V5XTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG5hdGl2ZVNldFRpbWVvdXQuYXBwbHkod2luZG93LCBbY2FsbGJhY2tdLmNvbmNhdChhcmdzKSk7XG4gICAgfVxuXG4gICAgaGl0KHNvdXJjZSk7XG4gIH07XG5cbiAgd2luZG93LnNldFRpbWVvdXQgPSB0aW1lb3V0V3JhcHBlcjtcbiAgdmFyIHNpZ25hdHVyZXMgPSBbWydibG9ja2FkYmxvY2snXSwgWydiYWJhc2JtJ10sIFsvZ2V0SXRlbVxcKCdiYWJuJ1xcKS9dLCBbJ2dldEVsZW1lbnRCeUlkJywgJ1N0cmluZy5mcm9tQ2hhckNvZGUnLCAnQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODknLCAnY2hhckF0JywgJ0RPTUNvbnRlbnRMb2FkZWQnLCAnQWRCbG9jaycsICdhZGRFdmVudExpc3RlbmVyJywgJ2RvU2Nyb2xsJywgJ2Zyb21DaGFyQ29kZScsICc8PDJ8cj4+NCcsICdzZXNzaW9uU3RvcmFnZScsICdjbGllbnRXaWR0aCcsICdsb2NhbFN0b3JhZ2UnLCAnTWF0aCcsICdyYW5kb20nXV07XG5cbiAgdmFyIGNoZWNrID0gZnVuY3Rpb24gY2hlY2soc3RyKSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaWduYXR1cmVzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICB2YXIgdG9rZW5zID0gc2lnbmF0dXJlc1tpXTtcbiAgICAgIHZhciBtYXRjaCA9IDA7XG5cbiAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgdG9rZW5zLmxlbmd0aDsgaiArPSAxKSB7XG4gICAgICAgIHZhciB0b2tlbiA9IHRva2Vuc1tqXTtcbiAgICAgICAgdmFyIGZvdW5kID0gdG9rZW4gaW5zdGFuY2VvZiBSZWdFeHAgPyB0b2tlbi50ZXN0KHN0cikgOiBzdHIuaW5kZXhPZih0b2tlbikgPiAtMTtcblxuICAgICAgICBpZiAoZm91bmQpIHtcbiAgICAgICAgICBtYXRjaCArPSAxO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChtYXRjaCAvIHRva2Vucy5sZW5ndGggPj0gMC44KSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcblxuICB2YXIgbmF0aXZlRXZhbCA9IHdpbmRvdy5ldmFsO1xuXG4gIHZhciBldmFsV3JhcHBlciA9IGZ1bmN0aW9uIGV2YWxXcmFwcGVyKHN0cikge1xuICAgIGlmICghY2hlY2soc3RyKSkge1xuICAgICAgcmV0dXJuIG5hdGl2ZUV2YWwoc3RyKTtcbiAgICB9XG5cbiAgICBoaXQoc291cmNlKTtcbiAgICB2YXIgYm9keUVsID0gZG9jdW1lbnQuYm9keTtcblxuICAgIGlmIChib2R5RWwpIHtcbiAgICAgIGJvZHlFbC5zdHlsZS5yZW1vdmVQcm9wZXJ0eSgndmlzaWJpbGl0eScpO1xuICAgIH1cblxuICAgIHZhciBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiYWJhc2Jtc2d4Jyk7XG5cbiAgICBpZiAoZWwpIHtcbiAgICAgIGVsLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZWwpO1xuICAgIH1cbiAgfTtcblxuICB3aW5kb3cuZXZhbCA9IGV2YWxXcmFwcGVyLmJpbmQod2luZG93KTtcbn1cbnByZXZlbnRCYWIubmFtZXMgPSBbJ3ByZXZlbnQtYmFiJywgLy8gYWxpYXNlcyBhcmUgbmVlZGVkIGZvciBtYXRjaGluZyB0aGUgcmVsYXRlZCBzY3JpcHRsZXQgY29udmVydGVkIGludG8gb3VyIHN5bnRheFxuJ25vYmFiLmpzJywgJ3Viby1ub2JhYi5qcycsICdiYWItZGVmdXNlci5qcycsICd1Ym8tYmFiLWRlZnVzZXIuanMnLCAndWJvLW5vYmFiJywgJ3Viby1iYWItZGVmdXNlciddO1xucHJldmVudEJhYi5pbmplY3Rpb25zID0gW2hpdF07XG5cbi8qIGVzbGludC1kaXNhYmxlIG5vLXVudXNlZC12YXJzLCBuby1leHRyYS1iaW5kLCBmdW5jLW5hbWVzICovXG4vKiBlc2xpbnQtZGlzYWJsZSBtYXgtbGVuICovXG5cbi8qKlxuICogQHNjcmlwdGxldCBub3dlYnJ0Y1xuICpcbiAqIEBkZXNjcmlwdGlvblxuICogRGlzYWJsZXMgV2ViUlRDIGJ5IG92ZXJyaWRpbmcgYFJUQ1BlZXJDb25uZWN0aW9uYC4gVGhlIG92ZXJyaWRlbiBmdW5jdGlvbiB3aWxsIGxvZyBldmVyeSBhdHRlbXB0IHRvIGNyZWF0ZSBhIG5ldyBjb25uZWN0aW9uLlxuICpcbiAqIFJlbGF0ZWQgVUJPIHNjcmlwdGxldDpcbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9nb3JoaWxsL3VCbG9jay93aWtpL1Jlc291cmNlcy1MaWJyYXJ5I25vd2VicnRjanMtXG4gKlxuICogKipTeW50YXgqKlxuICogYGBgXG4gKiBleGFtcGxlLm9yZyMlIy8vc2NyaXB0bGV0KCdub3dlYnJ0YycpXG4gKiBgYGBcbiAqL1xuXG4vKiBlc2xpbnQtZW5hYmxlIG1heC1sZW4gKi9cblxuZnVuY3Rpb24gbm93ZWJydGMoc291cmNlKSB7XG4gIHZhciBwcm9wZXJ0eU5hbWUgPSAnJztcblxuICBpZiAod2luZG93LlJUQ1BlZXJDb25uZWN0aW9uKSB7XG4gICAgcHJvcGVydHlOYW1lID0gJ1JUQ1BlZXJDb25uZWN0aW9uJztcbiAgfSBlbHNlIGlmICh3aW5kb3cud2Via2l0UlRDUGVlckNvbm5lY3Rpb24pIHtcbiAgICBwcm9wZXJ0eU5hbWUgPSAnd2Via2l0UlRDUGVlckNvbm5lY3Rpb24nO1xuICB9XG5cbiAgaWYgKHByb3BlcnR5TmFtZSA9PT0gJycpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgcnRjUmVwbGFjZW1lbnQgPSBmdW5jdGlvbiBydGNSZXBsYWNlbWVudChjb25maWcpIHtcbiAgICBoaXQoc291cmNlLCBcIkRvY3VtZW50IHRyaWVkIHRvIGNyZWF0ZSBhbiBSVENQZWVyQ29ubmVjdGlvbjogXCIuY29uY2F0KGNvbnZlcnRSdGNDb25maWdUb1N0cmluZyhjb25maWcpKSk7XG4gIH07XG5cbiAgcnRjUmVwbGFjZW1lbnQucHJvdG90eXBlID0ge1xuICAgIGNsb3NlOiBub29wRnVuYyxcbiAgICBjcmVhdGVEYXRhQ2hhbm5lbDogbm9vcEZ1bmMsXG4gICAgY3JlYXRlT2ZmZXI6IG5vb3BGdW5jLFxuICAgIHNldFJlbW90ZURlc2NyaXB0aW9uOiBub29wRnVuY1xuICB9O1xuICB2YXIgcnRjID0gd2luZG93W3Byb3BlcnR5TmFtZV07XG4gIHdpbmRvd1twcm9wZXJ0eU5hbWVdID0gcnRjUmVwbGFjZW1lbnQ7XG5cbiAgaWYgKHJ0Yy5wcm90b3R5cGUpIHtcbiAgICBydGMucHJvdG90eXBlLmNyZWF0ZURhdGFDaGFubmVsID0gZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNsb3NlOiBub29wRnVuYyxcbiAgICAgICAgc2VuZDogbm9vcEZ1bmNcbiAgICAgIH07XG4gICAgfS5iaW5kKG51bGwpO1xuICB9XG59XG5ub3dlYnJ0Yy5uYW1lcyA9IFsnbm93ZWJydGMnLCAvLyBhbGlhc2VzIGFyZSBuZWVkZWQgZm9yIG1hdGNoaW5nIHRoZSByZWxhdGVkIHNjcmlwdGxldCBjb252ZXJ0ZWQgaW50byBvdXIgc3ludGF4XG4nbm93ZWJydGMuanMnLCAndWJvLW5vd2VicnRjLmpzJywgJ3Viby1ub3dlYnJ0YyddO1xubm93ZWJydGMuaW5qZWN0aW9ucyA9IFtoaXQsIG5vb3BGdW5jLCBjb252ZXJ0UnRjQ29uZmlnVG9TdHJpbmddO1xuXG4vKipcbiAqIEBzY3JpcHRsZXQgbG9nLWFkZEV2ZW50TGlzdGVuZXJcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIExvZ3MgYWxsIGFkZEV2ZW50TGlzdGVuZXIgY2FsbHMgdG8gdGhlIGNvbnNvbGUuXG4gKlxuICogUmVsYXRlZCBVQk8gc2NyaXB0bGV0OlxuICogaHR0cHM6Ly9naXRodWIuY29tL2dvcmhpbGwvdUJsb2NrL3dpa2kvUmVzb3VyY2VzLUxpYnJhcnkjYWRkZXZlbnRsaXN0ZW5lci1sb2dnZXJqcy1cbiAqXG4gKiAqKlN5bnRheCoqXG4gKiBgYGBcbiAqIGV4YW1wbGUub3JnIyUjLy9zY3JpcHRsZXQoJ2xvZy1hZGRFdmVudExpc3RlbmVyJylcbiAqIGBgYFxuICovXG5cbmZ1bmN0aW9uIGxvZ0FkZEV2ZW50TGlzdGVuZXIoc291cmNlKSB7XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlXG4gIHZhciBsb2cgPSBjb25zb2xlLmxvZy5iaW5kKGNvbnNvbGUpO1xuICB2YXIgbmF0aXZlQWRkRXZlbnRMaXN0ZW5lciA9IHdpbmRvdy5FdmVudFRhcmdldC5wcm90b3R5cGUuYWRkRXZlbnRMaXN0ZW5lcjtcblxuICBmdW5jdGlvbiBhZGRFdmVudExpc3RlbmVyV3JhcHBlcih0eXBlLCBsaXN0ZW5lcikge1xuICAgIGlmICh2YWxpZGF0ZVR5cGUodHlwZSkgJiYgdmFsaWRhdGVMaXN0ZW5lcihsaXN0ZW5lcikpIHtcbiAgICAgIHZhciBsb2dNZXNzYWdlID0gXCJsb2c6IGFkZEV2ZW50TGlzdGVuZXIoXFxcIlwiLmNvbmNhdCh0eXBlLCBcIlxcXCIsIFwiKS5jb25jYXQobGlzdGVuZXJUb1N0cmluZyhsaXN0ZW5lciksIFwiKVwiKTtcbiAgICAgIGhpdChzb3VyY2UsIGxvZ01lc3NhZ2UpO1xuICAgIH0gZWxzZSBpZiAoc291cmNlLnZlcmJvc2UpIHtcbiAgICAgIC8vIGxvZ2dpbmcgd2hpbGUgZGVidWdnaW5nXG4gICAgICB2YXIgX2xvZ01lc3NhZ2UgPSBcIkludmFsaWQgZXZlbnQgdHlwZSBvciBsaXN0ZW5lciBwYXNzZWQgdG8gYWRkRXZlbnRMaXN0ZW5lcjpcXG50eXBlOiBcIi5jb25jYXQoY29udmVydFR5cGVUb1N0cmluZyh0eXBlKSwgXCJcXG5saXN0ZW5lcjogXCIpLmNvbmNhdChjb252ZXJ0VHlwZVRvU3RyaW5nKGxpc3RlbmVyKSk7XG5cbiAgICAgIGxvZyhfbG9nTWVzc2FnZSk7XG4gICAgfVxuXG4gICAgZm9yICh2YXIgX2xlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3MgPSBuZXcgQXJyYXkoX2xlbiA+IDIgPyBfbGVuIC0gMiA6IDApLCBfa2V5ID0gMjsgX2tleSA8IF9sZW47IF9rZXkrKykge1xuICAgICAgYXJnc1tfa2V5IC0gMl0gPSBhcmd1bWVudHNbX2tleV07XG4gICAgfVxuXG4gICAgcmV0dXJuIG5hdGl2ZUFkZEV2ZW50TGlzdGVuZXIuYXBwbHkodGhpcywgW3R5cGUsIGxpc3RlbmVyXS5jb25jYXQoYXJncykpO1xuICB9XG5cbiAgd2luZG93LkV2ZW50VGFyZ2V0LnByb3RvdHlwZS5hZGRFdmVudExpc3RlbmVyID0gYWRkRXZlbnRMaXN0ZW5lcldyYXBwZXI7XG59XG5sb2dBZGRFdmVudExpc3RlbmVyLm5hbWVzID0gWydsb2ctYWRkRXZlbnRMaXN0ZW5lcicsIC8vIGFsaWFzZXMgYXJlIG5lZWRlZCBmb3IgbWF0Y2hpbmcgdGhlIHJlbGF0ZWQgc2NyaXB0bGV0IGNvbnZlcnRlZCBpbnRvIG91ciBzeW50YXhcbidhZGRFdmVudExpc3RlbmVyLWxvZ2dlci5qcycsICd1Ym8tYWRkRXZlbnRMaXN0ZW5lci1sb2dnZXIuanMnLCAnYWVsbC5qcycsICd1Ym8tYWVsbC5qcycsICd1Ym8tYWRkRXZlbnRMaXN0ZW5lci1sb2dnZXInLCAndWJvLWFlbGwnXTtcbmxvZ0FkZEV2ZW50TGlzdGVuZXIuaW5qZWN0aW9ucyA9IFtoaXQsIHZhbGlkYXRlVHlwZSwgdmFsaWRhdGVMaXN0ZW5lciwgbGlzdGVuZXJUb1N0cmluZywgY29udmVydFR5cGVUb1N0cmluZywgb2JqZWN0VG9TdHJpbmcsIGlzRW1wdHlPYmplY3QsIGdldE9iamVjdEVudHJpZXNdO1xuXG4vKiBlc2xpbnQtZGlzYWJsZSBuby1jb25zb2xlLCBuby1ldmFsICovXG4vKipcbiAqIEBzY3JpcHRsZXQgbG9nLWV2YWxcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIExvZ3MgYWxsIGBldmFsKClgIG9yIGBuZXcgRnVuY3Rpb24oKWAgY2FsbHMgdG8gdGhlIGNvbnNvbGUuXG4gKlxuICogKipTeW50YXgqKlxuICogYGBgXG4gKiBleGFtcGxlLm9yZyMlIy8vc2NyaXB0bGV0KCdsb2ctZXZhbCcpXG4gKiBgYGBcbiAqL1xuXG5mdW5jdGlvbiBsb2dFdmFsKHNvdXJjZSkge1xuICB2YXIgbG9nID0gY29uc29sZS5sb2cuYmluZChjb25zb2xlKTsgLy8gd3JhcCBldmFsIGZ1bmN0aW9uXG5cbiAgdmFyIG5hdGl2ZUV2YWwgPSB3aW5kb3cuZXZhbDtcblxuICBmdW5jdGlvbiBldmFsV3JhcHBlcihzdHIpIHtcbiAgICBoaXQoc291cmNlKTtcbiAgICBsb2coXCJldmFsKFxcXCJcIi5jb25jYXQoc3RyLCBcIlxcXCIpXCIpKTtcbiAgICByZXR1cm4gbmF0aXZlRXZhbChzdHIpO1xuICB9XG5cbiAgd2luZG93LmV2YWwgPSBldmFsV3JhcHBlcjsgLy8gd3JhcCBuZXcgRnVuY3Rpb25cblxuICB2YXIgbmF0aXZlRnVuY3Rpb24gPSB3aW5kb3cuRnVuY3Rpb247XG5cbiAgZnVuY3Rpb24gRnVuY3Rpb25XcmFwcGVyKCkge1xuICAgIGhpdChzb3VyY2UpO1xuXG4gICAgZm9yICh2YXIgX2xlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3MgPSBuZXcgQXJyYXkoX2xlbiksIF9rZXkgPSAwOyBfa2V5IDwgX2xlbjsgX2tleSsrKSB7XG4gICAgICBhcmdzW19rZXldID0gYXJndW1lbnRzW19rZXldO1xuICAgIH1cblxuICAgIGxvZyhcIm5ldyBGdW5jdGlvbihcIi5jb25jYXQoYXJncy5qb2luKCcsICcpLCBcIilcIikpO1xuICAgIHJldHVybiBuYXRpdmVGdW5jdGlvbi5hcHBseSh0aGlzLCBbXS5jb25jYXQoYXJncykpO1xuICB9XG5cbiAgRnVuY3Rpb25XcmFwcGVyLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUobmF0aXZlRnVuY3Rpb24ucHJvdG90eXBlKTtcbiAgRnVuY3Rpb25XcmFwcGVyLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IEZ1bmN0aW9uV3JhcHBlcjtcbiAgd2luZG93LkZ1bmN0aW9uID0gRnVuY3Rpb25XcmFwcGVyO1xufVxubG9nRXZhbC5uYW1lcyA9IFsnbG9nLWV2YWwnXTtcbmxvZ0V2YWwuaW5qZWN0aW9ucyA9IFtoaXRdO1xuXG4vKipcbiAqIEBzY3JpcHRsZXQgbG9nXG4gKlxuICogQGRlc2NyaXB0aW9uXG4gKiBBIHNpbXBsZSBzY3JpcHRsZXQgd2hpY2ggb25seSBwdXJwb3NlIGlzIHRvIHByaW50IGFyZ3VtZW50cyB0byBjb25zb2xlLlxuICogVGhpcyBzY3JpcHRsZXQgY2FuIGJlIGhlbHBmdWwgZm9yIGRlYnVnZ2luZyBhbmQgdHJvdWJsZXNob290aW5nIG90aGVyIHNjcmlwdGxldHMuXG4gKlxuICogKipFeGFtcGxlKipcbiAqIGBgYFxuICogZXhhbXBsZS5vcmcjJSMvL3NjcmlwdGxldCgnbG9nJywgJ2FyZzEnLCAnYXJnMicpXG4gKiBgYGBcbiAqL1xuZnVuY3Rpb24gbG9nKCkge1xuICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShfbGVuKSwgX2tleSA9IDA7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHtcbiAgICBhcmdzW19rZXldID0gYXJndW1lbnRzW19rZXldO1xuICB9XG5cbiAgY29uc29sZS5sb2coYXJncyk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tY29uc29sZVxufVxubG9nLm5hbWVzID0gWydsb2cnXTtcblxuLyogZXNsaW50LWRpc2FibGUgbm8tZXZhbCwgbm8tZXh0cmEtYmluZCAqL1xuLyoqXG4gKiBAc2NyaXB0bGV0IG5vZXZhbFxuICpcbiAqIEBkZXNjcmlwdGlvblxuICogUHJldmVudHMgcGFnZSB0byB1c2UgZXZhbC5cbiAqIE5vdGlmaWVzIGFib3V0IGF0dGVtcHRzIGluIHRoZSBjb25zb2xlXG4gKlxuICogUmVsYXRlZCBVQk8gc2NyaXB0bGV0OlxuICogaHR0cHM6Ly9naXRodWIuY29tL2dvcmhpbGwvdUJsb2NrL3dpa2kvUmVzb3VyY2VzLUxpYnJhcnkjbm9ldmFsanMtXG4gKlxuICogSXQgYWxzbyBjYW4gYmUgdXNlZCBhcyBgJHJlZGlyZWN0YCBydWxlcyBzb21ldGltZXMuXG4gKiBTZWUgW3JlZGlyZWN0IGRlc2NyaXB0aW9uXSguLi93aWtpL2Fib3V0LXJlZGlyZWN0cy5tZCNub2V2YWwpLlxuICpcbiAqICoqU3ludGF4KipcbiAqIGBgYFxuICogZXhhbXBsZS5vcmcjJSMvL3NjcmlwdGxldCgnbm9ldmFsJylcbiAqIGBgYFxuICovXG5cbmZ1bmN0aW9uIG5vZXZhbChzb3VyY2UpIHtcbiAgd2luZG93LmV2YWwgPSBmdW5jdGlvbiBldmFsV3JhcHBlcihzKSB7XG4gICAgaGl0KHNvdXJjZSwgXCJBZEd1YXJkIGhhcyBwcmV2ZW50ZWQgZXZhbDpcXG5cIi5jb25jYXQocykpO1xuICB9LmJpbmQoKTtcbn1cbm5vZXZhbC5uYW1lcyA9IFsnbm9ldmFsJywgLy8gYWxpYXNlcyBhcmUgbmVlZGVkIGZvciBtYXRjaGluZyB0aGUgcmVsYXRlZCBzY3JpcHRsZXQgY29udmVydGVkIGludG8gb3VyIHN5bnRheFxuJ25vZXZhbC5qcycsICdzaWxlbnQtbm9ldmFsLmpzJywgJ3Viby1ub2V2YWwuanMnLCAndWJvLXNpbGVudC1ub2V2YWwuanMnLCAndWJvLW5vZXZhbCcsICd1Ym8tc2lsZW50LW5vZXZhbCddO1xubm9ldmFsLmluamVjdGlvbnMgPSBbaGl0XTtcblxuLyogZXNsaW50LWRpc2FibGUgbm8tZXZhbCwgbm8tZXh0cmEtYmluZCwgZnVuYy1uYW1lcyAqL1xuLyoqXG4gKiBAc2NyaXB0bGV0IHByZXZlbnQtZXZhbC1pZlxuICpcbiAqIEBkZXNjcmlwdGlvblxuICogUHJldmVudHMgcGFnZSB0byB1c2UgZXZhbCBtYXRjaGluZyBwYXlsb2FkLlxuICpcbiAqIFJlbGF0ZWQgVUJPIHNjcmlwdGxldDpcbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9nb3JoaWxsL3VCbG9jay93aWtpL1Jlc291cmNlcy1MaWJyYXJ5I25vZXZhbC1pZmpzLVxuICpcbiAqICoqU3ludGF4KipcbiAqIGBgYFxuICogZXhhbXBsZS5vcmcjJSMvL3NjcmlwdGxldCgncHJldmVudC1ldmFsLWlmJ1ssIHNlYXJjaF0pXG4gKiBgYGBcbiAqXG4gKiAtIGBzZWFyY2hgIC0gb3B0aW9uYWwsIHN0cmluZyBvciByZWdleHAgZm9yIG1hdGNoaW5nIHN0cmluZ2lmaWVkIGV2YWwgcGF5bG9hZC5cbiAqIElmICdzZWFyY2ggaXMgbm90IHNwZWNpZmllZCDigJQgYWxsIHN0cmluZ2lmaWVkIGV2YWwgcGF5bG9hZCB3aWxsIGJlIG1hdGNoZWRcbiAqXG4gKiAqKkV4YW1wbGVzKipcbiAqIGBgYFxuICogISBQcmV2ZW50cyBldmFsIGlmIGl0IG1hdGNoZXMgJ3Rlc3QnXG4gKiBleGFtcGxlLm9yZyMlIy8vc2NyaXB0bGV0KCdwcmV2ZW50LWV2YWwtaWYnLCAndGVzdCcpXG4gKiBgYGBcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ3xSZWdFeHB9IFtzZWFyY2hdIHN0cmluZyBvciByZWdleHAgbWF0Y2hpbmcgc3RyaW5naWZpZWQgZXZhbCBwYXlsb2FkXG4gKi9cblxuZnVuY3Rpb24gcHJldmVudEV2YWxJZihzb3VyY2UsIHNlYXJjaCkge1xuICB2YXIgc2VhcmNoUmVnZXhwID0gdG9SZWdFeHAoc2VhcmNoKTtcbiAgdmFyIG5hdGl2ZUV2YWwgPSB3aW5kb3cuZXZhbDtcblxuICB3aW5kb3cuZXZhbCA9IGZ1bmN0aW9uIChwYXlsb2FkKSB7XG4gICAgaWYgKCFzZWFyY2hSZWdleHAudGVzdChwYXlsb2FkLnRvU3RyaW5nKCkpKSB7XG4gICAgICByZXR1cm4gbmF0aXZlRXZhbC5jYWxsKHdpbmRvdywgcGF5bG9hZCk7XG4gICAgfVxuXG4gICAgaGl0KHNvdXJjZSwgcGF5bG9hZCk7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfS5iaW5kKHdpbmRvdyk7XG59XG5wcmV2ZW50RXZhbElmLm5hbWVzID0gWydwcmV2ZW50LWV2YWwtaWYnLCAvLyBhbGlhc2VzIGFyZSBuZWVkZWQgZm9yIG1hdGNoaW5nIHRoZSByZWxhdGVkIHNjcmlwdGxldCBjb252ZXJ0ZWQgaW50byBvdXIgc3ludGF4XG4nbm9ldmFsLWlmLmpzJywgJ3Viby1ub2V2YWwtaWYuanMnLCAndWJvLW5vZXZhbC1pZiddO1xucHJldmVudEV2YWxJZi5pbmplY3Rpb25zID0gW3RvUmVnRXhwLCBoaXRdO1xuXG4vKiBlc2xpbnQtZGlzYWJsZSBuby1jb25zb2xlLCBmdW5jLW5hbWVzLCBuby1tdWx0aS1hc3NpZ24gKi9cbi8qKlxuICogQHNjcmlwdGxldCBwcmV2ZW50LWZhYi0zLjIuMFxuICpcbiAqIEBkZXNjcmlwdGlvblxuICogUHJldmVudHMgZXhlY3V0aW9uIG9mIHRoZSBGQUIgc2NyaXB0IHYzLjIuMC5cbiAqXG4gKiBSZWxhdGVkIFVCTyBzY3JpcHRsZXQ6XG4gKiBodHRwczovL2dpdGh1Yi5jb20vZ29yaGlsbC91QmxvY2svd2lraS9SZXNvdXJjZXMtTGlicmFyeSNmdWNrYWRibG9ja2pzLTMyMC1cbiAqXG4gKiAqKlN5bnRheCoqXG4gKiBgYGBcbiAqIGV4YW1wbGUub3JnIyUjLy9zY3JpcHRsZXQoJ3ByZXZlbnQtZmFiLTMuMi4wJylcbiAqIGBgYFxuICovXG5cbmZ1bmN0aW9uIHByZXZlbnRGYWIoc291cmNlKSB7XG4gIGhpdChzb3VyY2UpOyAvLyByZWRlZmluZXMgRmFiIGZ1bmN0aW9uIGZvciBhZGJsb2NrIGRldGVjdGlvblxuXG4gIHZhciBGYWIgPSBmdW5jdGlvbiBGYWIoKSB7fTtcblxuICBGYWIucHJvdG90eXBlLmNoZWNrID0gbm9vcEZ1bmM7XG4gIEZhYi5wcm90b3R5cGUuY2xlYXJFdmVudCA9IG5vb3BGdW5jO1xuICBGYWIucHJvdG90eXBlLmVtaXRFdmVudCA9IG5vb3BGdW5jO1xuXG4gIEZhYi5wcm90b3R5cGUub24gPSBmdW5jdGlvbiAoYSwgYikge1xuICAgIGlmICghYSkge1xuICAgICAgYigpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIEZhYi5wcm90b3R5cGUub25EZXRlY3RlZCA9IG5vb3BUaGlzO1xuXG4gIEZhYi5wcm90b3R5cGUub25Ob3REZXRlY3RlZCA9IGZ1bmN0aW9uIChhKSB7XG4gICAgYSgpO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIEZhYi5wcm90b3R5cGUuc2V0T3B0aW9uID0gbm9vcEZ1bmM7XG4gIEZhYi5wcm90b3R5cGUub3B0aW9ucyA9IHtcbiAgICBzZXQ6IG5vb3BGdW5jLFxuICAgIGdldDogbm9vcEZ1bmNcbiAgfTtcbiAgdmFyIGZhYiA9IG5ldyBGYWIoKTtcbiAgdmFyIGdldFNldEZhYiA9IHtcbiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgIHJldHVybiBGYWI7XG4gICAgfSxcbiAgICBzZXQ6IGZ1bmN0aW9uIHNldCgpIHt9XG4gIH07XG4gIHZhciBnZXRzZXRmYWIgPSB7XG4gICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICByZXR1cm4gZmFiO1xuICAgIH0sXG4gICAgc2V0OiBmdW5jdGlvbiBzZXQoKSB7fVxuICB9OyAvLyByZWRlZmluZWQgRmFiIGRhdGEgcHJvcGVydGllcyB3aGljaCBpZiAnRnVja0FkQmxvY2snIHZhcmlhYmxlIGV4aXN0c1xuXG4gIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwod2luZG93LCAnRnVja0FkQmxvY2snKSkge1xuICAgIHdpbmRvdy5GdWNrQWRCbG9jayA9IEZhYjtcbiAgfSBlbHNlIHtcbiAgICAvLyBvciByZWRlZmluZWQgRmFiIGFjY2Vzc29yIHByb3BlcnRpZXNcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkod2luZG93LCAnRnVja0FkQmxvY2snLCBnZXRTZXRGYWIpO1xuICB9XG5cbiAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh3aW5kb3csICdCbG9ja0FkQmxvY2snKSkge1xuICAgIHdpbmRvdy5CbG9ja0FkQmxvY2sgPSBGYWI7XG4gIH0gZWxzZSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHdpbmRvdywgJ0Jsb2NrQWRCbG9jaycsIGdldFNldEZhYik7XG4gIH1cblxuICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHdpbmRvdywgJ1NuaWZmQWRCbG9jaycpKSB7XG4gICAgd2luZG93LlNuaWZmQWRCbG9jayA9IEZhYjtcbiAgfSBlbHNlIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkod2luZG93LCAnU25pZmZBZEJsb2NrJywgZ2V0U2V0RmFiKTtcbiAgfVxuXG4gIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwod2luZG93LCAnZnVja0FkQmxvY2snKSkge1xuICAgIHdpbmRvdy5mdWNrQWRCbG9jayA9IGZhYjtcbiAgfSBlbHNlIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkod2luZG93LCAnZnVja0FkQmxvY2snLCBnZXRzZXRmYWIpO1xuICB9XG5cbiAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh3aW5kb3csICdibG9ja0FkQmxvY2snKSkge1xuICAgIHdpbmRvdy5ibG9ja0FkQmxvY2sgPSBmYWI7XG4gIH0gZWxzZSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHdpbmRvdywgJ2Jsb2NrQWRCbG9jaycsIGdldHNldGZhYik7XG4gIH1cblxuICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHdpbmRvdywgJ3NuaWZmQWRCbG9jaycpKSB7XG4gICAgd2luZG93LnNuaWZmQWRCbG9jayA9IGZhYjtcbiAgfSBlbHNlIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkod2luZG93LCAnc25pZmZBZEJsb2NrJywgZ2V0c2V0ZmFiKTtcbiAgfVxufVxucHJldmVudEZhYi5uYW1lcyA9IFsncHJldmVudC1mYWItMy4yLjAnLCAvLyBhbGlhc2VzIGFyZSBuZWVkZWQgZm9yIG1hdGNoaW5nIHRoZSByZWxhdGVkIHNjcmlwdGxldCBjb252ZXJ0ZWQgaW50byBvdXIgc3ludGF4XG4nbm9mYWIuanMnLCAndWJvLW5vZmFiLmpzJywgJ2Z1Y2thZGJsb2NrLmpzLTMuMi4wJywgJ3Viby1mdWNrYWRibG9jay5qcy0zLjIuMCcsICd1Ym8tbm9mYWInXTtcbnByZXZlbnRGYWIuaW5qZWN0aW9ucyA9IFtoaXQsIG5vb3BGdW5jLCBub29wVGhpc107XG5cbi8qIGVzbGludC1kaXNhYmxlIG5vLWNvbnNvbGUsIGZ1bmMtbmFtZXMsIG5vLW11bHRpLWFzc2lnbiAqL1xuLyoqXG4gKiBAc2NyaXB0bGV0IHNldC1wb3BhZHMtZHVtbXlcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIFNldHMgc3RhdGljIHByb3BlcnRpZXMgUG9wQWRzIGFuZCBwb3Bucy5cbiAqXG4gKiBSZWxhdGVkIFVCTyBzY3JpcHRsZXQ6XG4gKiBodHRwczovL2dpdGh1Yi5jb20vZ29yaGlsbC91QmxvY2svd2lraS9SZXNvdXJjZXMtTGlicmFyeSNwb3BhZHMtZHVtbXlqcy1cbiAqXG4gKiAqKlN5bnRheCoqXG4gKiBgYGBcbiAqIGV4YW1wbGUub3JnIyUjLy9zY3JpcHRsZXQoJ3NldC1wb3BhZHMtZHVtbXknKVxuICogYGBgXG4gKi9cblxuZnVuY3Rpb24gc2V0UG9wYWRzRHVtbXkoc291cmNlKSB7XG4gIGRlbGV0ZSB3aW5kb3cuUG9wQWRzO1xuICBkZWxldGUgd2luZG93LnBvcG5zO1xuICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh3aW5kb3csIHtcbiAgICBQb3BBZHM6IHtcbiAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgICBoaXQoc291cmNlKTtcbiAgICAgICAgcmV0dXJuIHt9O1xuICAgICAgfVxuICAgIH0sXG4gICAgcG9wbnM6IHtcbiAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgICBoaXQoc291cmNlKTtcbiAgICAgICAgcmV0dXJuIHt9O1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG59XG5zZXRQb3BhZHNEdW1teS5uYW1lcyA9IFsnc2V0LXBvcGFkcy1kdW1teScsIC8vIGFsaWFzZXMgYXJlIG5lZWRlZCBmb3IgbWF0Y2hpbmcgdGhlIHJlbGF0ZWQgc2NyaXB0bGV0IGNvbnZlcnRlZCBpbnRvIG91ciBzeW50YXhcbidwb3BhZHMtZHVtbXkuanMnLCAndWJvLXBvcGFkcy1kdW1teS5qcycsICd1Ym8tcG9wYWRzLWR1bW15J107XG5zZXRQb3BhZHNEdW1teS5pbmplY3Rpb25zID0gW2hpdF07XG5cbi8qKlxuICogQHNjcmlwdGxldCBwcmV2ZW50LXBvcGFkcy1uZXRcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIEFib3J0cyBvbiBwcm9wZXJ0eSB3cml0ZSAoUG9wQWRzLCBwb3BucyksIHRocm93cyByZWZlcmVuY2UgZXJyb3Igd2l0aCByYW5kb20gaWQuXG4gKlxuICogUmVsYXRlZCBVQk8gc2NyaXB0bGV0OlxuICogaHR0cHM6Ly9naXRodWIuY29tL2dvcmhpbGwvdUJsb2NrL3dpa2kvUmVzb3VyY2VzLUxpYnJhcnkjcG9wYWRzbmV0anMtXG4gKlxuICogKipTeW50YXgqKlxuICogYGBgXG4gKiBleGFtcGxlLm9yZyMlIy8vc2NyaXB0bGV0KCdwcmV2ZW50LXBvcGFkcy1uZXQnKVxuICogYGBgXG4gKi9cblxuZnVuY3Rpb24gcHJldmVudFBvcGFkc05ldChzb3VyY2UpIHtcbiAgdmFyIHJpZCA9IHJhbmRvbUlkKCk7XG5cbiAgdmFyIHRocm93RXJyb3IgPSBmdW5jdGlvbiB0aHJvd0Vycm9yKCkge1xuICAgIHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcihyaWQpO1xuICB9O1xuXG4gIGRlbGV0ZSB3aW5kb3cuUG9wQWRzO1xuICBkZWxldGUgd2luZG93LnBvcG5zO1xuICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh3aW5kb3csIHtcbiAgICBQb3BBZHM6IHtcbiAgICAgIHNldDogdGhyb3dFcnJvclxuICAgIH0sXG4gICAgcG9wbnM6IHtcbiAgICAgIHNldDogdGhyb3dFcnJvclxuICAgIH1cbiAgfSk7XG4gIHdpbmRvdy5vbmVycm9yID0gY3JlYXRlT25FcnJvckhhbmRsZXIocmlkKS5iaW5kKCk7XG4gIGhpdChzb3VyY2UpO1xufVxucHJldmVudFBvcGFkc05ldC5uYW1lcyA9IFsncHJldmVudC1wb3BhZHMtbmV0JywgLy8gYWxpYXNlcyBhcmUgbmVlZGVkIGZvciBtYXRjaGluZyB0aGUgcmVsYXRlZCBzY3JpcHRsZXQgY29udmVydGVkIGludG8gb3VyIHN5bnRheFxuJ3BvcGFkcy5uZXQuanMnLCAndWJvLXBvcGFkcy5uZXQuanMnLCAndWJvLXBvcGFkcy5uZXQnXTtcbnByZXZlbnRQb3BhZHNOZXQuaW5qZWN0aW9ucyA9IFtjcmVhdGVPbkVycm9ySGFuZGxlciwgcmFuZG9tSWQsIGhpdF07XG5cbi8qIGVzbGludC1kaXNhYmxlIGZ1bmMtbmFtZXMgKi9cbi8qKlxuICogQHNjcmlwdGxldCBwcmV2ZW50LWFkZmx5XG4gKlxuICogQGRlc2NyaXB0aW9uXG4gKiBQcmV2ZW50cyBhbnRpLWFkYmxvY2sgc2NyaXB0cyBvbiBhZGZseSBzaG9ydCBsaW5rcy5cbiAqXG4gKiBSZWxhdGVkIFVCTyBzY3JpcHRsZXQ6XG4gKiBodHRwczovL2dpdGh1Yi5jb20vZ29yaGlsbC91QmxvY2svd2lraS9SZXNvdXJjZXMtTGlicmFyeSNhZGZseS1kZWZ1c2VyanMtXG4gKlxuICogKipTeW50YXgqKlxuICogYGBgXG4gKiBleGFtcGxlLm9yZyMlIy8vc2NyaXB0bGV0KCdwcmV2ZW50LWFkZmx5JylcbiAqIGBgYFxuICovXG5cbmZ1bmN0aW9uIHByZXZlbnRBZGZseShzb3VyY2UpIHtcbiAgdmFyIGlzRGlnaXQgPSBmdW5jdGlvbiBpc0RpZ2l0KGRhdGEpIHtcbiAgICByZXR1cm4gL15cXGQkLy50ZXN0KGRhdGEpO1xuICB9O1xuXG4gIHZhciBoYW5kbGVyID0gZnVuY3Rpb24gaGFuZGxlcihlbmNvZGVkVVJMKSB7XG4gICAgdmFyIGV2ZW5DaGFycyA9ICcnO1xuICAgIHZhciBvZGRDaGFycyA9ICcnO1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbmNvZGVkVVJMLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICBpZiAoaSAlIDIgPT09IDApIHtcbiAgICAgICAgZXZlbkNoYXJzICs9IGVuY29kZWRVUkwuY2hhckF0KGkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgb2RkQ2hhcnMgPSBlbmNvZGVkVVJMLmNoYXJBdChpKSArIG9kZENoYXJzO1xuICAgICAgfVxuICAgIH1cblxuICAgIHZhciBkYXRhID0gKGV2ZW5DaGFycyArIG9kZENoYXJzKS5zcGxpdCgnJyk7XG5cbiAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgZGF0YS5sZW5ndGg7IF9pICs9IDEpIHtcbiAgICAgIGlmIChpc0RpZ2l0KGRhdGFbX2ldKSkge1xuICAgICAgICBmb3IgKHZhciBpaSA9IF9pICsgMTsgaWkgPCBkYXRhLmxlbmd0aDsgaWkgKz0gMSkge1xuICAgICAgICAgIGlmIChpc0RpZ2l0KGRhdGFbaWldKSkge1xuICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWJpdHdpc2VcbiAgICAgICAgICAgIHZhciB0ZW1wID0gcGFyc2VJbnQoZGF0YVtfaV0sIDEwKSBeIHBhcnNlSW50KGRhdGFbaWldLCAxMCk7XG5cbiAgICAgICAgICAgIGlmICh0ZW1wIDwgMTApIHtcbiAgICAgICAgICAgICAgZGF0YVtfaV0gPSB0ZW1wLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIF9pID0gaWk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBkYXRhID0gZGF0YS5qb2luKCcnKTtcbiAgICB2YXIgZGVjb2RlZFVSTCA9IHdpbmRvdy5hdG9iKGRhdGEpLnNsaWNlKDE2LCAtMTYpO1xuICAgIC8qIGVzbGludC1kaXNhYmxlIGNvbXBhdC9jb21wYXQgKi9cblxuICAgIGlmICh3aW5kb3cuc3RvcCkge1xuICAgICAgd2luZG93LnN0b3AoKTtcbiAgICB9XG4gICAgLyogZXNsaW50LWVuYWJsZSBjb21wYXQvY29tcGF0ICovXG5cblxuICAgIHdpbmRvdy5vbmJlZm9yZXVubG9hZCA9IG51bGw7XG4gICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBkZWNvZGVkVVJMO1xuICB9O1xuXG4gIHZhciB2YWw7IC8vIERvIG5vdCBhcHBseSBoYW5kbGVyIG1vcmUgdGhhbiBvbmUgdGltZVxuXG4gIHZhciBhcHBseUhhbmRsZXIgPSB0cnVlO1xuICB2YXIgcmVzdWx0ID0gc2V0UHJvcGVydHlBY2Nlc3Mod2luZG93LCAneXNtbScsIHtcbiAgICBjb25maWd1cmFibGU6IGZhbHNlLFxuICAgIHNldDogZnVuY3Rpb24gc2V0KHZhbHVlKSB7XG4gICAgICBpZiAoYXBwbHlIYW5kbGVyKSB7XG4gICAgICAgIGFwcGx5SGFuZGxlciA9IGZhbHNlO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIGhhbmRsZXIodmFsdWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7fSAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWVtcHR5XG5cbiAgICAgIH1cblxuICAgICAgdmFsID0gdmFsdWU7XG4gICAgfSxcbiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgIHJldHVybiB2YWw7XG4gICAgfVxuICB9KTtcblxuICBpZiAocmVzdWx0KSB7XG4gICAgaGl0KHNvdXJjZSk7XG4gIH0gZWxzZSB7XG4gICAgd2luZG93LmNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBzZXQgdXAgcHJldmVudC1hZGZseSBzY3JpcHRsZXQnKTtcbiAgfVxufVxucHJldmVudEFkZmx5Lm5hbWVzID0gWydwcmV2ZW50LWFkZmx5JywgLy8gYWxpYXNlcyBhcmUgbmVlZGVkIGZvciBtYXRjaGluZyB0aGUgcmVsYXRlZCBzY3JpcHRsZXQgY29udmVydGVkIGludG8gb3VyIHN5bnRheFxuJ2FkZmx5LWRlZnVzZXIuanMnLCAndWJvLWFkZmx5LWRlZnVzZXIuanMnLCAndWJvLWFkZmx5LWRlZnVzZXInXTtcbnByZXZlbnRBZGZseS5pbmplY3Rpb25zID0gW3NldFByb3BlcnR5QWNjZXNzLCBoaXRdO1xuXG4vKiBlc2xpbnQtZGlzYWJsZSBtYXgtbGVuICovXG5cbi8qKlxuICogQHNjcmlwdGxldCBkZWJ1Zy1vbi1wcm9wZXJ0eS1yZWFkXG4gKlxuICogQGRlc2NyaXB0aW9uXG4gKiBUaGlzIHNjcmlwdGxldCBpcyBiYXNpY2FsbHkgdGhlIHNhbWUgYXMgW2Fib3J0LW9uLXByb3BlcnR5LXJlYWRdKCNhYm9ydC1vbi1wcm9wZXJ0eS1yZWFkKSwgYnV0IGluc3RlYWQgb2YgYWJvcnRpbmcgaXQgc3RhcnRzIHRoZSBkZWJ1Z2dlci5cbiAqXG4gKiAqKkl0IGlzIG5vdCBzdXBwb3NlZCB0byBiZSB1c2VkIGluIHByb2R1Y3Rpb24gZmlsdGVyIGxpc3RzISoqXG4gKlxuICogKipTeW50YXgqKlxuICogYGBgXG4gKiAhIERlYnVnIHNjcmlwdCBpZiBpdCB0cmllcyB0byBhY2Nlc3MgYHdpbmRvdy5hbGVydGBcbiAqIGV4YW1wbGUub3JnIyUjLy9zY3JpcHRsZXQoJ2RlYnVnLW9uLXByb3BlcnR5LXJlYWQnLCAnYWxlcnQnKVxuICogISBvZiBgd2luZG93Lm9wZW5gXG4gKiBleGFtcGxlLm9yZyMlIy8vc2NyaXB0bGV0KCdkZWJ1Zy1vbi1wcm9wZXJ0eS1yZWFkJywgJ29wZW4nKVxuICogYGBgXG4gKi9cblxuLyogZXNsaW50LWVuYWJsZSBtYXgtbGVuICovXG5cbmZ1bmN0aW9uIGRlYnVnT25Qcm9wZXJ0eVJlYWQoc291cmNlLCBwcm9wZXJ0eSwgc3RhY2spIHtcbiAgaWYgKCFwcm9wZXJ0eSB8fCAhbWF0Y2hTdGFja1RyYWNlKHN0YWNrLCBuZXcgRXJyb3IoKS5zdGFjaykpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgcmlkID0gcmFuZG9tSWQoKTtcblxuICB2YXIgYWJvcnQgPSBmdW5jdGlvbiBhYm9ydCgpIHtcbiAgICBoaXQoc291cmNlKTtcbiAgICBkZWJ1Z2dlcjsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1kZWJ1Z2dlclxuICB9O1xuXG4gIHZhciBzZXRDaGFpblByb3BBY2Nlc3MgPSBmdW5jdGlvbiBzZXRDaGFpblByb3BBY2Nlc3Mob3duZXIsIHByb3BlcnR5KSB7XG4gICAgdmFyIGNoYWluSW5mbyA9IGdldFByb3BlcnR5SW5DaGFpbihvd25lciwgcHJvcGVydHkpO1xuICAgIHZhciBiYXNlID0gY2hhaW5JbmZvLmJhc2U7XG4gICAgdmFyIHByb3AgPSBjaGFpbkluZm8ucHJvcCxcbiAgICAgICAgY2hhaW4gPSBjaGFpbkluZm8uY2hhaW47XG5cbiAgICBpZiAoY2hhaW4pIHtcbiAgICAgIHZhciBzZXR0ZXIgPSBmdW5jdGlvbiBzZXR0ZXIoYSkge1xuICAgICAgICBiYXNlID0gYTtcblxuICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIE9iamVjdCkge1xuICAgICAgICAgIHNldENoYWluUHJvcEFjY2VzcyhhLCBjaGFpbik7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvd25lciwgcHJvcCwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgICAgICByZXR1cm4gYmFzZTtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0OiBzZXR0ZXJcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHNldFByb3BlcnR5QWNjZXNzKGJhc2UsIHByb3AsIHtcbiAgICAgIGdldDogYWJvcnQsXG4gICAgICBzZXQ6IG5vb3BGdW5jXG4gICAgfSk7XG4gIH07XG5cbiAgc2V0Q2hhaW5Qcm9wQWNjZXNzKHdpbmRvdywgcHJvcGVydHkpO1xuICB3aW5kb3cub25lcnJvciA9IGNyZWF0ZU9uRXJyb3JIYW5kbGVyKHJpZCkuYmluZCgpO1xufVxuZGVidWdPblByb3BlcnR5UmVhZC5uYW1lcyA9IFsnZGVidWctb24tcHJvcGVydHktcmVhZCddO1xuZGVidWdPblByb3BlcnR5UmVhZC5pbmplY3Rpb25zID0gW3JhbmRvbUlkLCBzZXRQcm9wZXJ0eUFjY2VzcywgZ2V0UHJvcGVydHlJbkNoYWluLCBjcmVhdGVPbkVycm9ySGFuZGxlciwgaGl0LCB0b1JlZ0V4cCwgbWF0Y2hTdGFja1RyYWNlLCBub29wRnVuY107XG5cbi8qIGVzbGludC1kaXNhYmxlIG1heC1sZW4gKi9cblxuLyoqXG4gKiBAc2NyaXB0bGV0IGRlYnVnLW9uLXByb3BlcnR5LXdyaXRlXG4gKlxuICogQGRlc2NyaXB0aW9uXG4gKiBUaGlzIHNjcmlwdGxldCBpcyBiYXNpY2FsbHkgdGhlIHNhbWUgYXMgW2Fib3J0LW9uLXByb3BlcnR5LXdyaXRlXSgjYWJvcnQtb24tcHJvcGVydHktd3JpdGUpLCBidXQgaW5zdGVhZCBvZiBhYm9ydGluZyBpdCBzdGFydHMgdGhlIGRlYnVnZ2VyLlxuICpcbiAqICoqSXQgaXMgbm90IHN1cHBvc2VkIHRvIGJlIHVzZWQgaW4gcHJvZHVjdGlvbiBmaWx0ZXIgbGlzdHMhKipcbiAqXG4gKiAqKlN5bnRheCoqXG4gKiBgYGBcbiAqICEgQWJvcnRzIHNjcmlwdCB3aGVuIGl0IHRyaWVzIHRvIHdyaXRlIGluIHByb3BlcnR5IGB3aW5kb3cudGVzdGBcbiAqIGV4YW1wbGUub3JnIyUjLy9zY3JpcHRsZXQoJ2RlYnVnLW9uLXByb3BlcnR5LXdyaXRlJywgJ3Rlc3QnKVxuICogYGBgXG4gKi9cblxuLyogZXNsaW50LWVuYWJsZSBtYXgtbGVuICovXG5cbmZ1bmN0aW9uIGRlYnVnT25Qcm9wZXJ0eVdyaXRlKHNvdXJjZSwgcHJvcGVydHksIHN0YWNrKSB7XG4gIGlmICghcHJvcGVydHkgfHwgIW1hdGNoU3RhY2tUcmFjZShzdGFjaywgbmV3IEVycm9yKCkuc3RhY2spKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIHJpZCA9IHJhbmRvbUlkKCk7XG5cbiAgdmFyIGFib3J0ID0gZnVuY3Rpb24gYWJvcnQoKSB7XG4gICAgaGl0KHNvdXJjZSk7XG4gICAgZGVidWdnZXI7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tZGVidWdnZXJcbiAgfTtcblxuICB2YXIgc2V0Q2hhaW5Qcm9wQWNjZXNzID0gZnVuY3Rpb24gc2V0Q2hhaW5Qcm9wQWNjZXNzKG93bmVyLCBwcm9wZXJ0eSkge1xuICAgIHZhciBjaGFpbkluZm8gPSBnZXRQcm9wZXJ0eUluQ2hhaW4ob3duZXIsIHByb3BlcnR5KTtcbiAgICB2YXIgYmFzZSA9IGNoYWluSW5mby5iYXNlO1xuICAgIHZhciBwcm9wID0gY2hhaW5JbmZvLnByb3AsXG4gICAgICAgIGNoYWluID0gY2hhaW5JbmZvLmNoYWluO1xuXG4gICAgaWYgKGNoYWluKSB7XG4gICAgICB2YXIgc2V0dGVyID0gZnVuY3Rpb24gc2V0dGVyKGEpIHtcbiAgICAgICAgYmFzZSA9IGE7XG5cbiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBPYmplY3QpIHtcbiAgICAgICAgICBzZXRDaGFpblByb3BBY2Nlc3MoYSwgY2hhaW4pO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob3duZXIsIHByb3AsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgICAgcmV0dXJuIGJhc2U7XG4gICAgICAgIH0sXG4gICAgICAgIHNldDogc2V0dGVyXG4gICAgICB9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBzZXRQcm9wZXJ0eUFjY2VzcyhiYXNlLCBwcm9wLCB7XG4gICAgICBzZXQ6IGFib3J0XG4gICAgfSk7XG4gIH07XG5cbiAgc2V0Q2hhaW5Qcm9wQWNjZXNzKHdpbmRvdywgcHJvcGVydHkpO1xuICB3aW5kb3cub25lcnJvciA9IGNyZWF0ZU9uRXJyb3JIYW5kbGVyKHJpZCkuYmluZCgpO1xufVxuZGVidWdPblByb3BlcnR5V3JpdGUubmFtZXMgPSBbJ2RlYnVnLW9uLXByb3BlcnR5LXdyaXRlJ107XG5kZWJ1Z09uUHJvcGVydHlXcml0ZS5pbmplY3Rpb25zID0gW3JhbmRvbUlkLCBzZXRQcm9wZXJ0eUFjY2VzcywgZ2V0UHJvcGVydHlJbkNoYWluLCBjcmVhdGVPbkVycm9ySGFuZGxlciwgaGl0LCB0b1JlZ0V4cCwgbWF0Y2hTdGFja1RyYWNlXTtcblxuLyogZXNsaW50LWRpc2FibGUgbWF4LWxlbiAqL1xuXG4vKipcbiAqIEBzY3JpcHRsZXQgZGVidWctY3VycmVudC1pbmxpbmUtc2NyaXB0XG4gKlxuICogQGRlc2NyaXB0aW9uXG4gKiBUaGlzIHNjcmlwdGxldCBpcyBiYXNpY2FsbHkgdGhlIHNhbWUgYXMgW2Fib3J0LWN1cnJlbnQtaW5saW5lLXNjcmlwdF0oI2Fib3J0LWN1cnJlbnQtaW5saW5lLXNjcmlwdCksIGJ1dCBpbnN0ZWFkIG9mIGFib3J0aW5nIGl0IHN0YXJ0cyB0aGUgZGVidWdnZXIuXG4gKlxuICogKipJdCBpcyBub3Qgc3VwcG9zZWQgdG8gYmUgdXNlZCBpbiBwcm9kdWN0aW9uIGZpbHRlciBsaXN0cyEqKlxuICpcbiAqICoqU3ludGF4KipcbiAqYGBgXG4gKiAhIEFib3J0cyBzY3JpcHQgd2hlbiBpdCB0cmllcyB0byBhY2Nlc3MgYHdpbmRvdy5hbGVydGBcbiAqIGV4YW1wbGUub3JnIyUjLy9zY3JpcHRsZXQoJ2RlYnVnLWN1cnJlbnQtaW5saW5lLXNjcmlwdCcsICdhbGVydCcpXG4gKiBgYGBcbiAqL1xuXG4vKiBlc2xpbnQtZW5hYmxlIG1heC1sZW4gKi9cblxuZnVuY3Rpb24gZGVidWdDdXJyZW50SW5saW5lU2NyaXB0KHNvdXJjZSwgcHJvcGVydHkpIHtcbiAgdmFyIHNlYXJjaCA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogbnVsbDtcbiAgdmFyIHNlYXJjaFJlZ2V4cCA9IHRvUmVnRXhwKHNlYXJjaCk7XG4gIHZhciByaWQgPSByYW5kb21JZCgpO1xuXG4gIHZhciBnZXRDdXJyZW50U2NyaXB0ID0gZnVuY3Rpb24gZ2V0Q3VycmVudFNjcmlwdCgpIHtcbiAgICBpZiAoJ2N1cnJlbnRTY3JpcHQnIGluIGRvY3VtZW50KSB7XG4gICAgICByZXR1cm4gZG9jdW1lbnQuY3VycmVudFNjcmlwdDsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBjb21wYXQvY29tcGF0XG4gICAgfVxuXG4gICAgdmFyIHNjcmlwdHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc2NyaXB0Jyk7XG4gICAgcmV0dXJuIHNjcmlwdHNbc2NyaXB0cy5sZW5ndGggLSAxXTtcbiAgfTtcblxuICB2YXIgb3VyU2NyaXB0ID0gZ2V0Q3VycmVudFNjcmlwdCgpO1xuXG4gIHZhciBhYm9ydCA9IGZ1bmN0aW9uIGFib3J0KCkge1xuICAgIHZhciBzY3JpcHRFbCA9IGdldEN1cnJlbnRTY3JpcHQoKTtcblxuICAgIGlmIChzY3JpcHRFbCBpbnN0YW5jZW9mIEhUTUxTY3JpcHRFbGVtZW50ICYmIHNjcmlwdEVsLnRleHRDb250ZW50Lmxlbmd0aCA+IDAgJiYgc2NyaXB0RWwgIT09IG91clNjcmlwdCAmJiAoIXNlYXJjaCB8fCBzZWFyY2hSZWdleHAudGVzdChzY3JpcHRFbC50ZXh0Q29udGVudCkpKSB7XG4gICAgICBoaXQoc291cmNlKTtcbiAgICAgIGRlYnVnZ2VyOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWRlYnVnZ2VyXG4gICAgfVxuICB9O1xuXG4gIHZhciBzZXRDaGFpblByb3BBY2Nlc3MgPSBmdW5jdGlvbiBzZXRDaGFpblByb3BBY2Nlc3Mob3duZXIsIHByb3BlcnR5KSB7XG4gICAgdmFyIGNoYWluSW5mbyA9IGdldFByb3BlcnR5SW5DaGFpbihvd25lciwgcHJvcGVydHkpO1xuICAgIHZhciBiYXNlID0gY2hhaW5JbmZvLmJhc2U7XG4gICAgdmFyIHByb3AgPSBjaGFpbkluZm8ucHJvcCxcbiAgICAgICAgY2hhaW4gPSBjaGFpbkluZm8uY2hhaW47XG5cbiAgICBpZiAoY2hhaW4pIHtcbiAgICAgIHZhciBzZXR0ZXIgPSBmdW5jdGlvbiBzZXR0ZXIoYSkge1xuICAgICAgICBiYXNlID0gYTtcblxuICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIE9iamVjdCkge1xuICAgICAgICAgIHNldENoYWluUHJvcEFjY2VzcyhhLCBjaGFpbik7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvd25lciwgcHJvcCwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgICAgICByZXR1cm4gYmFzZTtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0OiBzZXR0ZXJcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciBjdXJyZW50VmFsdWUgPSBiYXNlW3Byb3BdO1xuICAgIHNldFByb3BlcnR5QWNjZXNzKGJhc2UsIHByb3AsIHtcbiAgICAgIHNldDogZnVuY3Rpb24gc2V0KHZhbHVlKSB7XG4gICAgICAgIGFib3J0KCk7XG4gICAgICAgIGN1cnJlbnRWYWx1ZSA9IHZhbHVlO1xuICAgICAgfSxcbiAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgICBhYm9ydCgpO1xuICAgICAgICByZXR1cm4gY3VycmVudFZhbHVlO1xuICAgICAgfVxuICAgIH0pO1xuICB9O1xuXG4gIHNldENoYWluUHJvcEFjY2Vzcyh3aW5kb3csIHByb3BlcnR5KTtcbiAgd2luZG93Lm9uZXJyb3IgPSBjcmVhdGVPbkVycm9ySGFuZGxlcihyaWQpLmJpbmQoKTtcbn1cbmRlYnVnQ3VycmVudElubGluZVNjcmlwdC5uYW1lcyA9IFsnZGVidWctY3VycmVudC1pbmxpbmUtc2NyaXB0J107XG5kZWJ1Z0N1cnJlbnRJbmxpbmVTY3JpcHQuaW5qZWN0aW9ucyA9IFtyYW5kb21JZCwgc2V0UHJvcGVydHlBY2Nlc3MsIGdldFByb3BlcnR5SW5DaGFpbiwgdG9SZWdFeHAsIGNyZWF0ZU9uRXJyb3JIYW5kbGVyLCBoaXRdO1xuXG4vKiBlc2xpbnQtZGlzYWJsZSBtYXgtbGVuICovXG5cbi8qKlxuICogQHNjcmlwdGxldCByZW1vdmUtYXR0clxuICpcbiAqIEBkZXNjcmlwdGlvblxuICogUmVtb3ZlcyB0aGUgc3BlY2lmaWVkIGF0dHJpYnV0ZXMgZnJvbSBET00gbm9kZXMuIFRoaXMgc2NyaXB0bGV0IHJ1bnMgb25jZSB3aGVuIHRoZSBwYWdlIGxvYWRzXG4gKiBhbmQgYWZ0ZXIgdGhhdCBwZXJpb2RpY2FsbHkgaW4gb3JkZXIgdG8gRE9NIHRyZWUgY2hhbmdlcy5cbiAqXG4gKiBSZWxhdGVkIFVCTyBzY3JpcHRsZXQ6XG4gKiBodHRwczovL2dpdGh1Yi5jb20vZ29yaGlsbC91QmxvY2svd2lraS9SZXNvdXJjZXMtTGlicmFyeSNyZW1vdmUtYXR0cmpzLVxuICpcbiAqICoqU3ludGF4KipcbiAqIGBgYFxuICogZXhhbXBsZS5vcmcjJSMvL3NjcmlwdGxldCgncmVtb3ZlLWF0dHInLCBhdHRyc1ssIHNlbGVjdG9yXSlcbiAqIGBgYFxuICpcbiAqIC0gYGF0dHJzYCDigJQgcmVxdWlyZWQsIGF0dHJpYnV0ZSBvciBsaXN0IG9mIGF0dHJpYnV0ZXMgam9pbmVkIGJ5ICd8J1xuICogLSBgc2VsZWN0b3JgIOKAlCBvcHRpb25hbCwgQ1NTIHNlbGVjdG9yLCBzcGVjaWZpZXMgRE9NIG5vZGVzIGZyb20gd2hpY2ggdGhlIGF0dHJpYnV0ZXMgd2lsbCBiZSByZW1vdmVkXG4gKlxuICogKipFeGFtcGxlcyoqXG4gKiAxLiAgUmVtb3ZlcyBieSBhdHRyaWJ1dGVcbiAqICAgICBgYGBcbiAqICAgICBleGFtcGxlLm9yZyMlIy8vc2NyaXB0bGV0KCdyZW1vdmUtYXR0cicsICdleGFtcGxlfHRlc3QnKVxuICogICAgIGBgYFxuICpcbiAqICAgICBgYGBodG1sXG4gKiAgICAgPCEtLSBiZWZvcmUgIC0tPlxuICogICAgIDxkaXYgZXhhbXBsZT1cInRydWVcIiB0ZXN0PVwidHJ1ZVwiPlNvbWUgdGV4dDwvZGl2PlxuICpcbiAqICAgICA8IS0tIGFmdGVyIC0tPlxuICogICAgIDxkaXY+U29tZSB0ZXh0PC9kaXY+XG4gKiAgICAgYGBgXG4gKlxuICogMi4gUmVtb3ZlcyB3aXRoIHNwZWNpZmllZCBzZWxlY3RvclxuICogICAgIGBgYFxuICogICAgIGV4YW1wbGUub3JnIyUjLy9zY3JpcHRsZXQoJ3JlbW92ZS1hdHRyJywgJ2V4YW1wbGUnLCAnZGl2W2NsYXNzPVwiaW5uZXJcIl0nKVxuICogICAgIGBgYFxuICpcbiAqICAgICBgYGBodG1sXG4gKiAgICAgPCEtLSBiZWZvcmUgLS0+XG4gKiAgICAgPGRpdiBjbGFzcz1cIndyYXBwZXJcIiBleGFtcGxlPVwidHJ1ZVwiPlxuICogICAgICAgICA8ZGl2IGNsYXNzPVwiaW5uZXJcIiBleGFtcGxlPVwidHJ1ZVwiPlNvbWUgdGV4dDwvZGl2PlxuICogICAgIDwvZGl2PlxuICpcbiAqICAgICA8IS0tIGFmdGVyIC0tPlxuICogICAgIDxkaXYgY2xhc3M9XCJ3cmFwcGVyXCIgZXhhbXBsZT1cInRydWVcIj5cbiAqICAgICAgICAgPGRpdiBjbGFzcz1cImlubmVyXCI+U29tZSB0ZXh0PC9kaXY+XG4gKiAgICAgPC9kaXY+XG4gKiAgICAgYGBgXG4gKi9cblxuLyogZXNsaW50LWVuYWJsZSBtYXgtbGVuICovXG5cbmZ1bmN0aW9uIHJlbW92ZUF0dHIoc291cmNlLCBhdHRycywgc2VsZWN0b3IpIHtcbiAgaWYgKCFhdHRycykge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGF0dHJzID0gYXR0cnMuc3BsaXQoL1xccypcXHxcXHMqLyk7XG5cbiAgaWYgKCFzZWxlY3Rvcikge1xuICAgIHNlbGVjdG9yID0gXCJbXCIuY29uY2F0KGF0dHJzLmpvaW4oJ10sWycpLCBcIl1cIik7XG4gIH1cblxuICB2YXIgcm1hdHRyID0gZnVuY3Rpb24gcm1hdHRyKCkge1xuICAgIHZhciBub2RlcyA9IFtdLnNsaWNlLmNhbGwoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzZWxlY3RvcikpO1xuICAgIHZhciByZW1vdmVkID0gZmFsc2U7XG4gICAgbm9kZXMuZm9yRWFjaChmdW5jdGlvbiAobm9kZSkge1xuICAgICAgYXR0cnMuZm9yRWFjaChmdW5jdGlvbiAoYXR0cikge1xuICAgICAgICBub2RlLnJlbW92ZUF0dHJpYnV0ZShhdHRyKTtcbiAgICAgICAgcmVtb3ZlZCA9IHRydWU7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGlmIChyZW1vdmVkKSB7XG4gICAgICBoaXQoc291cmNlKTtcbiAgICB9XG4gIH07XG5cbiAgcm1hdHRyKCk7IC8vICd0cnVlJyBmb3Igb2JzZXJ2aW5nIGF0dHJpYnV0ZXNcblxuICBvYnNlcnZlRE9NQ2hhbmdlcyhybWF0dHIsIHRydWUpO1xufVxucmVtb3ZlQXR0ci5uYW1lcyA9IFsncmVtb3ZlLWF0dHInLCAvLyBhbGlhc2VzIGFyZSBuZWVkZWQgZm9yIG1hdGNoaW5nIHRoZSByZWxhdGVkIHNjcmlwdGxldCBjb252ZXJ0ZWQgaW50byBvdXIgc3ludGF4XG4ncmVtb3ZlLWF0dHIuanMnLCAndWJvLXJlbW92ZS1hdHRyLmpzJywgJ3JhLmpzJywgJ3Viby1yYS5qcycsICd1Ym8tcmVtb3ZlLWF0dHInLCAndWJvLXJhJ107XG5yZW1vdmVBdHRyLmluamVjdGlvbnMgPSBbaGl0LCBvYnNlcnZlRE9NQ2hhbmdlc107XG5cbi8qIGVzbGludC1kaXNhYmxlIG1heC1sZW4gKi9cblxuLyoqXG4gKiBAc2NyaXB0bGV0IHJlbW92ZS1jbGFzc1xuICpcbiAqIEBkZXNjcmlwdGlvblxuICogUmVtb3ZlcyB0aGUgc3BlY2lmaWVkIGNsYXNzZXMgZnJvbSBET00gbm9kZXMuIFRoaXMgc2NyaXB0bGV0IHJ1bnMgb25jZSBhZnRlciB0aGUgcGFnZSBsb2Fkc1xuICogYW5kIGFmdGVyIHRoYXQgcGVyaW9kaWNhbGx5IGluIG9yZGVyIHRvIERPTSB0cmVlIGNoYW5nZXMuXG4gKlxuICogUmVsYXRlZCBVQk8gc2NyaXB0bGV0OlxuICogaHR0cHM6Ly9naXRodWIuY29tL2dvcmhpbGwvdUJsb2NrL3dpa2kvUmVzb3VyY2VzLUxpYnJhcnkjcmVtb3ZlLWNsYXNzanMtXG4gKlxuICogKipTeW50YXgqKlxuICogYGBgXG4gKiBleGFtcGxlLm9yZyMlIy8vc2NyaXB0bGV0KCdyZW1vdmUtY2xhc3MnLCBjbGFzc2VzWywgc2VsZWN0b3JdKVxuICogYGBgXG4gKlxuICogLSBgY2xhc3Nlc2Ag4oCUIHJlcXVpcmVkLCBjbGFzcyBvciBsaXN0IG9mIGNsYXNzZXMgc2VwYXJhdGVkIGJ5ICd8J1xuICogLSBgc2VsZWN0b3JgIOKAlCBvcHRpb25hbCwgQ1NTIHNlbGVjdG9yLCBzcGVjaWZpZXMgRE9NIG5vZGVzIGZyb20gd2hpY2ggdGhlIGNsYXNzZXMgd2lsbCBiZSByZW1vdmVkLlxuICogSWYgdGhlcmUgaXMgbm8gYHNlbGVjdG9yYCwgZWFjaCBjbGFzcyBvZiBgY2xhc3Nlc2AgaW5kZXBlbmRlbnRseSB3aWxsIGJlIHJlbW92ZWQgZnJvbSBhbGwgbm9kZXMgd2hpY2ggaGFzIG9uZVxuICpcbiAqICoqRXhhbXBsZXMqKlxuICogMS4gIFJlbW92ZXMgYnkgY2xhc3Nlc1xuICogICAgIGBgYFxuICogICAgIGV4YW1wbGUub3JnIyUjLy9zY3JpcHRsZXQoJ3JlbW92ZS1jbGFzcycsICdleGFtcGxlfHRlc3QnKVxuICogICAgIGBgYFxuICpcbiAqICAgICBgYGBodG1sXG4gKiAgICAgPCEtLSBiZWZvcmUgIC0tPlxuICogICAgIDxkaXYgaWQ9XCJmaXJzdFwiIGNsYXNzPVwibmljZSB0ZXN0XCI+U29tZSB0ZXh0PC9kaXY+XG4gKiAgICAgPGRpdiBpZD1cInNlY29uZFwiIGNsYXNzPVwicmFyZSBleGFtcGxlIGZvciB0ZXN0XCI+U29tZSB0ZXh0PC9kaXY+XG4gKiAgICAgPGRpdiBpZD1cInRoaXJkXCIgY2xhc3M9XCJ0ZXN0aW5nIGJldHRlciBleGFtcGxlXCI+U29tZSB0ZXh0PC9kaXY+XG4gKlxuICogICAgIDwhLS0gYWZ0ZXIgLS0+XG4gKiAgICAgPGRpdiBpZD1cImZpcnN0XCIgY2xhc3M9XCJuaWNlXCI+U29tZSB0ZXh0PC9kaXY+XG4gKiAgICAgPGRpdiBpZD1cInNlY29uZFwiIGNsYXNzPVwicmFyZSBmb3JcIj5Tb21lIHRleHQ8L2Rpdj5cbiAqICAgICA8ZGl2IGlkPVwidGhpcmRcIiBjbGFzcz1cInRlc3RpbmcgYmV0dGVyXCI+U29tZSB0ZXh0PC9kaXY+XG4gKiAgICAgYGBgXG4gKlxuICogMi4gUmVtb3ZlcyB3aXRoIHNwZWNpZmllZCBzZWxlY3RvclxuICogICAgIGBgYFxuICogICAgIGV4YW1wbGUub3JnIyUjLy9zY3JpcHRsZXQoJ3JlbW92ZS1jbGFzcycsICdicmFuZGluZycsICdkaXZbY2xhc3NePVwiaW5uZXJcIl0nKVxuICogICAgIGBgYFxuICpcbiAqICAgICBgYGBodG1sXG4gKiAgICAgPCEtLSBiZWZvcmUgLS0+XG4gKiAgICAgPGRpdiBjbGFzcz1cIndyYXBwZXIgdHJ1ZSBicmFuZGluZ1wiPlxuICogICAgICAgICA8ZGl2IGNsYXNzPVwiaW5uZXIgYmFkIGJyYW5kaW5nXCI+U29tZSB0ZXh0PC9kaXY+XG4gKiAgICAgPC9kaXY+XG4gKlxuICogICAgIDwhLS0gYWZ0ZXIgLS0+XG4gKiAgICAgPGRpdiBjbGFzcz1cIndyYXBwZXIgdHJ1ZSBicmFuZGluZ1wiPlxuICogICAgICAgICA8ZGl2IGNsYXNzPVwiaW5uZXIgYmFkXCI+U29tZSB0ZXh0PC9kaXY+XG4gKiAgICAgPC9kaXY+XG4gKiAgICAgYGBgXG4gKi9cblxuLyogZXNsaW50LWVuYWJsZSBtYXgtbGVuICovXG5cbmZ1bmN0aW9uIHJlbW92ZUNsYXNzKHNvdXJjZSwgY2xhc3NOYW1lcywgc2VsZWN0b3IpIHtcbiAgaWYgKCFjbGFzc05hbWVzKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY2xhc3NOYW1lcyA9IGNsYXNzTmFtZXMuc3BsaXQoL1xccypcXHxcXHMqLyk7XG4gIHZhciBzZWxlY3RvcnMgPSBbXTtcblxuICBpZiAoIXNlbGVjdG9yKSB7XG4gICAgc2VsZWN0b3JzID0gY2xhc3NOYW1lcy5tYXAoZnVuY3Rpb24gKGNsYXNzTmFtZSkge1xuICAgICAgcmV0dXJuIFwiLlwiLmNvbmNhdChjbGFzc05hbWUpO1xuICAgIH0pO1xuICB9XG5cbiAgdmFyIHJlbW92ZUNsYXNzSGFuZGxlciA9IGZ1bmN0aW9uIHJlbW92ZUNsYXNzSGFuZGxlcigpIHtcbiAgICB2YXIgbm9kZXMgPSBuZXcgU2V0KCk7XG5cbiAgICBpZiAoc2VsZWN0b3IpIHtcbiAgICAgIHZhciBmb3VuZGVkTm9kZXMgPSBbXS5zbGljZS5jYWxsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpKTtcbiAgICAgIGZvdW5kZWROb2Rlcy5mb3JFYWNoKGZ1bmN0aW9uIChuKSB7XG4gICAgICAgIHJldHVybiBub2Rlcy5hZGQobik7XG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKHNlbGVjdG9ycy5sZW5ndGggPiAwKSB7XG4gICAgICBzZWxlY3RvcnMuZm9yRWFjaChmdW5jdGlvbiAocykge1xuICAgICAgICB2YXIgZWxlbWVudHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHMpO1xuXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZWxlbWVudHMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgICB2YXIgZWxlbWVudCA9IGVsZW1lbnRzW2ldO1xuICAgICAgICAgIG5vZGVzLmFkZChlbGVtZW50KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgdmFyIHJlbW92ZWQgPSBmYWxzZTtcbiAgICBub2Rlcy5mb3JFYWNoKGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICBjbGFzc05hbWVzLmZvckVhY2goZnVuY3Rpb24gKGNsYXNzTmFtZSkge1xuICAgICAgICBpZiAobm9kZS5jbGFzc0xpc3QuY29udGFpbnMoY2xhc3NOYW1lKSkge1xuICAgICAgICAgIG5vZGUuY2xhc3NMaXN0LnJlbW92ZShjbGFzc05hbWUpO1xuICAgICAgICAgIHJlbW92ZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGlmIChyZW1vdmVkKSB7XG4gICAgICBoaXQoc291cmNlKTtcbiAgICB9XG4gIH07XG5cbiAgcmVtb3ZlQ2xhc3NIYW5kbGVyKCk7XG4gIHZhciBDTEFTU19BVFRSX05BTUUgPSBbJ2NsYXNzJ107IC8vICd0cnVlJyBmb3Igb2JzZXJ2aW5nIGF0dHJpYnV0ZXNcbiAgLy8gJ2NsYXNzJyBmb3Igb2JzZXJ2aW5nIG9ubHkgY2xhc3Nlc1xuXG4gIG9ic2VydmVET01DaGFuZ2VzKHJlbW92ZUNsYXNzSGFuZGxlciwgdHJ1ZSwgQ0xBU1NfQVRUUl9OQU1FKTtcbn1cbnJlbW92ZUNsYXNzLm5hbWVzID0gWydyZW1vdmUtY2xhc3MnLCAvLyBhbGlhc2VzIGFyZSBuZWVkZWQgZm9yIG1hdGNoaW5nIHRoZSByZWxhdGVkIHNjcmlwdGxldCBjb252ZXJ0ZWQgaW50byBvdXIgc3ludGF4XG4ncmVtb3ZlLWNsYXNzLmpzJywgJ3Viby1yZW1vdmUtY2xhc3MuanMnLCAncmMuanMnLCAndWJvLXJjLmpzJywgJ3Viby1yZW1vdmUtY2xhc3MnLCAndWJvLXJjJ107XG5yZW1vdmVDbGFzcy5pbmplY3Rpb25zID0gW2hpdCwgb2JzZXJ2ZURPTUNoYW5nZXNdO1xuXG4vKipcbiAqIEBzY3JpcHRsZXQgZGlzYWJsZS1uZXd0YWItbGlua3NcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIFByZXZlbnRzIG9wZW5pbmcgbmV3IHRhYnMgYW5kIHdpbmRvd3MgaWYgdGhlcmUgaXMgYHRhcmdldGAgYXR0cmlidXRlIGluIGVsZW1lbnQuXG4gKlxuICogUmVsYXRlZCBVQk8gc2NyaXB0bGV0OlxuICogaHR0cHM6Ly9naXRodWIuY29tL2dvcmhpbGwvdUJsb2NrL3dpa2kvUmVzb3VyY2VzLUxpYnJhcnkjZGlzYWJsZS1uZXd0YWItbGlua3Nqcy1cbiAqXG4gKiAqKlN5bnRheCoqXG4gKiBgYGBcbiAqIGV4YW1wbGUub3JnIyUjLy9zY3JpcHRsZXQoJ2Rpc2FibGUtbmV3dGFiLWxpbmtzJylcbiAqIGBgYFxuICovXG5cbmZ1bmN0aW9uIGRpc2FibGVOZXd0YWJMaW5rcyhzb3VyY2UpIHtcbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZXYpIHtcbiAgICB2YXIgdGFyZ2V0ID0gZXYudGFyZ2V0O1xuXG4gICAgd2hpbGUgKHRhcmdldCAhPT0gbnVsbCkge1xuICAgICAgaWYgKHRhcmdldC5sb2NhbE5hbWUgPT09ICdhJyAmJiB0YXJnZXQuaGFzQXR0cmlidXRlKCd0YXJnZXQnKSkge1xuICAgICAgICBldi5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgaGl0KHNvdXJjZSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuXG4gICAgICB0YXJnZXQgPSB0YXJnZXQucGFyZW50Tm9kZTtcbiAgICB9XG4gIH0pO1xufVxuZGlzYWJsZU5ld3RhYkxpbmtzLm5hbWVzID0gWydkaXNhYmxlLW5ld3RhYi1saW5rcycsIC8vIGFsaWFzZXMgYXJlIG5lZWRlZCBmb3IgbWF0Y2hpbmcgdGhlIHJlbGF0ZWQgc2NyaXB0bGV0IGNvbnZlcnRlZCBpbnRvIG91ciBzeW50YXhcbidkaXNhYmxlLW5ld3RhYi1saW5rcy5qcycsICd1Ym8tZGlzYWJsZS1uZXd0YWItbGlua3MuanMnLCAndWJvLWRpc2FibGUtbmV3dGFiLWxpbmtzJ107XG5kaXNhYmxlTmV3dGFiTGlua3MuaW5qZWN0aW9ucyA9IFtoaXRdO1xuXG4vKiBlc2xpbnQtZGlzYWJsZSBtYXgtbGVuICovXG5cbi8qKlxuICogQHNjcmlwdGxldCBhZGp1c3Qtc2V0SW50ZXJ2YWxcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIEFkanVzdHMgaW50ZXJ2YWwgZm9yIHNwZWNpZmllZCBzZXRJbnRlcnZhbCgpIGNhbGxiYWNrcy5cbiAqXG4gKiBSZWxhdGVkIFVCTyBzY3JpcHRsZXQ6XG4gKiBodHRwczovL2dpdGh1Yi5jb20vZ29yaGlsbC91QmxvY2svd2lraS9SZXNvdXJjZXMtTGlicmFyeSNuYW5vLXNldGludGVydmFsLWJvb3N0ZXJqcy1cbiAqXG4gKiAqKlN5bnRheCoqXG4gKiBgYGBcbiAqIGV4YW1wbGUub3JnIyUjLy9zY3JpcHRsZXQoJ2FkanVzdC1zZXRJbnRlcnZhbCdbLCBtYXRjaCBbLCBpbnRlcnZhbFssIGJvb3N0XV1dKVxuICogYGBgXG4gKlxuICogLSBgbWF0Y2hgIC0gb3B0aW9uYWwsIHN0cmluZy9yZWd1bGFyIGV4cHJlc3Npb24sIG1hdGNoaW5nIGluIHN0cmluZ2lmaWVkIGNhbGxiYWNrIGZ1bmN0aW9uXG4gKiAtIGBpbnRlcnZhbGAgLSBvcHRpb25hbCwgZGVmYXVsdHMgdG8gMTAwMCwgbWF0Y2hpbmcgc2V0SW50ZXJ2YWwgZGVsYXk7IGRlY2ltYWwgaW50ZWdlciBPUiAnKicgZm9yIGFueSBkZWxheVxuICogLSBgYm9vc3RgIC0gb3B0aW9uYWwsIGRlZmF1bHQgdG8gMC4wNSwgZmxvYXQsIGNhcHBlZCBhdCA1MCB0aW1lcyBmb3IgdXAgYW5kIGRvd24gKDAuMDIuLi41MCksIGludGVydmFsIG11bHRpcGxpZXJcbiAqXG4gKiAqKkV4YW1wbGVzKipcbiAqIDEuIEFkanVzdCBhbGwgc2V0SW50ZXJ2YWwoKSB4MjAgdGltZXMgd2hlcmUgaW50ZXJ2YWwgZXF1YWwgMTAwMG1zOlxuICogICAgIGBgYFxuICogICAgIGV4YW1wbGUub3JnIyUjLy9zY3JpcHRsZXQoJ2FkanVzdC1zZXRJbnRlcnZhbCcpXG4gKiAgICAgYGBgXG4gKlxuICogMi4gQWRqdXN0IGFsbCBzZXRJbnRlcnZhbCgpIHgyMCB0aW1lcyB3aGVyZSBjYWxsYmFjayBtYXRoZWQgd2l0aCBgZXhhbXBsZWAgYW5kIGludGVydmFsIGVxdWFsIDEwMDBtc1xuICogICAgIGBgYFxuICogICAgIGV4YW1wbGUub3JnIyUjLy9zY3JpcHRsZXQoJ2FkanVzdC1zZXRJbnRlcnZhbCcsICdleGFtcGxlJylcbiAqICAgICBgYGBcbiAqXG4gKiAzLiBBZGp1c3QgYWxsIHNldEludGVydmFsKCkgeDIwIHRpbWVzIHdoZXJlIGNhbGxiYWNrIG1hdGhlZCB3aXRoIGBleGFtcGxlYCBhbmQgaW50ZXJ2YWwgZXF1YWwgNDAwbXNcbiAqICAgICBgYGBcbiAqICAgICBleGFtcGxlLm9yZyMlIy8vc2NyaXB0bGV0KCdhZGp1c3Qtc2V0SW50ZXJ2YWwnLCAnZXhhbXBsZScsICc0MDAnKVxuICogICAgIGBgYFxuICpcbiAqIDQuIFNsb3cgZG93biBzZXRJbnRlcnZhbCgpIHgyIHRpbWVzIHdoZXJlIGNhbGxiYWNrIG1hdGNoZWQgd2l0aCBgZXhhbXBsZWAgYW5kIGludGVydmFsIGVxdWFsIDEwMDBtc1xuICogICAgIGBgYFxuICogICAgIGV4YW1wbGUub3JnIyUjLy9zY3JpcHRsZXQoJ2FkanVzdC1zZXRJbnRlcnZhbCcsICdleGFtcGxlJywgJycsICcyJylcbiAqICAgICBgYGBcbiAqIDUuIEFkanVzdCBhbGwgc2V0SW50ZXJ2YWwoKSB4NTAgdGltZXMgd2hlcmUgaW50ZXJ2YWwgZXF1YWwgMjAwMG1zXG4gKiAgICAgYGBgXG4gKiAgICAgZXhhbXBsZS5vcmcjJSMvL3NjcmlwdGxldCgnYWRqdXN0LXNldEludGVydmFsJywgJycsICcyMDAwJywgJzAuMDInKVxuICogICAgIGBgYFxuICogNi4gQWRqdXN0IGFsbCBzZXRJbnRlcnZhbCgpIHg1MCB0aW1lcyB3aGVyZSBpbnRlcnZhbCBpcyByYW5kb21pemVkXG4gKiAgICAgYGBgXG4gKiAgICAgZXhhbXBsZS5vcmcjJSMvL3NjcmlwdGxldCgnYWRqdXN0LXNldEludGVydmFsJywgJycsICcqJywgJzAuMDInKVxuICogICAgIGBgYFxuICovXG5cbi8qIGVzbGludC1lbmFibGUgbWF4LWxlbiAqL1xuXG5mdW5jdGlvbiBhZGp1c3RTZXRJbnRlcnZhbChzb3VyY2UsIG1hdGNoLCBpbnRlcnZhbCwgYm9vc3QpIHtcbiAgdmFyIG5hdGl2ZVNldEludGVydmFsID0gd2luZG93LnNldEludGVydmFsO1xuICB2YXIgbWF0Y2hSZWdleHAgPSB0b1JlZ0V4cChtYXRjaCk7XG5cbiAgdmFyIGludGVydmFsV3JhcHBlciA9IGZ1bmN0aW9uIGludGVydmFsV3JhcHBlcihjYiwgZCkge1xuICAgIGlmIChtYXRjaFJlZ2V4cC50ZXN0KGNiLnRvU3RyaW5nKCkpICYmIGlzRGVsYXlNYXRjaGVkKGludGVydmFsLCBkKSkge1xuICAgICAgZCAqPSBnZXRCb29zdE11bHRpcGxpZXIoYm9vc3QpO1xuICAgICAgaGl0KHNvdXJjZSk7XG4gICAgfVxuXG4gICAgZm9yICh2YXIgX2xlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3MgPSBuZXcgQXJyYXkoX2xlbiA+IDIgPyBfbGVuIC0gMiA6IDApLCBfa2V5ID0gMjsgX2tleSA8IF9sZW47IF9rZXkrKykge1xuICAgICAgYXJnc1tfa2V5IC0gMl0gPSBhcmd1bWVudHNbX2tleV07XG4gICAgfVxuXG4gICAgcmV0dXJuIG5hdGl2ZVNldEludGVydmFsLmFwcGx5KHdpbmRvdywgW2NiLCBkXS5jb25jYXQoYXJncykpO1xuICB9O1xuXG4gIHdpbmRvdy5zZXRJbnRlcnZhbCA9IGludGVydmFsV3JhcHBlcjtcbn1cbmFkanVzdFNldEludGVydmFsLm5hbWVzID0gWydhZGp1c3Qtc2V0SW50ZXJ2YWwnLCAvLyBhbGlhc2VzIGFyZSBuZWVkZWQgZm9yIG1hdGNoaW5nIHRoZSByZWxhdGVkIHNjcmlwdGxldCBjb252ZXJ0ZWQgaW50byBvdXIgc3ludGF4XG4nbmFuby1zZXRJbnRlcnZhbC1ib29zdGVyLmpzJywgJ3Viby1uYW5vLXNldEludGVydmFsLWJvb3N0ZXIuanMnLCAnbmFuby1zaWIuanMnLCAndWJvLW5hbm8tc2liLmpzJywgJ3Viby1uYW5vLXNldEludGVydmFsLWJvb3N0ZXInLCAndWJvLW5hbm8tc2liJ107XG5hZGp1c3RTZXRJbnRlcnZhbC5pbmplY3Rpb25zID0gW2hpdCwgdG9SZWdFeHAsIGdldEJvb3N0TXVsdGlwbGllciwgaXNEZWxheU1hdGNoZWQsIG5hdGl2ZUlzTmFOLCBuYXRpdmVJc0Zpbml0ZSwgZ2V0TWF0Y2hEZWxheSwgZ2V0V2lsZGNhcmRTeW1ib2wsIHNob3VsZE1hdGNoQW55RGVsYXldO1xuXG4vKiBlc2xpbnQtZGlzYWJsZSBtYXgtbGVuICovXG5cbi8qKlxuICogQHNjcmlwdGxldCBhZGp1c3Qtc2V0VGltZW91dFxuICpcbiAqIEBkZXNjcmlwdGlvblxuICogQWRqdXN0cyB0aW1lb3V0IGZvciBzcGVjaWZpZWQgc2V0VGltb3V0KCkgY2FsbGJhY2tzLlxuICpcbiAqIFJlbGF0ZWQgVUJPIHNjcmlwdGxldDpcbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9nb3JoaWxsL3VCbG9jay93aWtpL1Jlc291cmNlcy1MaWJyYXJ5I25hbm8tc2V0dGltZW91dC1ib29zdGVyanMtXG4gKlxuICogKipTeW50YXgqKlxuICogYGBgXG4gKiBleGFtcGxlLm9yZyMlIy8vc2NyaXB0bGV0KCdhZGp1c3Qtc2V0VGltZW91dCdbLCBtYXRjaCBbLCB0aW1lb3V0WywgYm9vc3RdXV0pXG4gKiBgYGBcbiAqXG4gKiAtIGBtYXRjaGAgLSBvcHRpb25hbCwgc3RyaW5nL3JlZ3VsYXIgZXhwcmVzc2lvbiwgbWF0Y2hpbmcgaW4gc3RyaW5naWZpZWQgY2FsbGJhY2sgZnVuY3Rpb25cbiAqIC0gYHRpbWVvdXRgIC0gb3B0aW9uYWwsIGRlZmF1bHRzIHRvIDEwMDAsIG1hdGNoaW5nIHNldFRpbW91dCBkZWxheTsgZGVjaW1hbCBpbnRlZ2VyIE9SICcqJyBmb3IgYW55IGRlbGF5XG4gKiAtIGBib29zdGAgLSBvcHRpb25hbCwgZGVmYXVsdCB0byAwLjA1LCBmbG9hdCwgY2FwcGVkIGF0IDUwIHRpbWVzIGZvciB1cCBhbmQgZG93biAoMC4wMi4uLjUwKSwgdGltZW91dCBtdWx0aXBsaWVyXG4gKlxuICogKipFeGFtcGxlcyoqXG4gKiAxLiBBZGp1c3QgYWxsIHNldFRpbWVvdXQoKSB4MjAgdGltZXMgd2hlcmUgdGltZW91dCBlcXVhbCAxMDAwbXM6XG4gKiAgICAgYGBgXG4gKiAgICAgZXhhbXBsZS5vcmcjJSMvL3NjcmlwdGxldCgnYWRqdXN0LXNldFRpbWVvdXQnKVxuICogICAgIGBgYFxuICpcbiAqIDIuIEFkanVzdCBhbGwgc2V0VGltZW91dCgpIHgyMCB0aW1lcyB3aGVyZSBjYWxsYmFjayBtYXRoZWQgd2l0aCBgZXhhbXBsZWAgYW5kIHRpbWVvdXQgZXF1YWwgMTAwMG1zXG4gKiAgICAgYGBgXG4gKiAgICAgZXhhbXBsZS5vcmcjJSMvL3NjcmlwdGxldCgnYWRqdXN0LXNldFRpbWVvdXQnLCAnZXhhbXBsZScpXG4gKiAgICAgYGBgXG4gKlxuICogMy4gQWRqdXN0IGFsbCBzZXRUaW1lb3V0KCkgeDIwIHRpbWVzIHdoZXJlIGNhbGxiYWNrIG1hdGhlZCB3aXRoIGBleGFtcGxlYCBhbmQgdGltZW91dCBlcXVhbCA0MDBtc1xuICogICAgIGBgYFxuICogICAgIGV4YW1wbGUub3JnIyUjLy9zY3JpcHRsZXQoJ2FkanVzdC1zZXRUaW1lb3V0JywgJ2V4YW1wbGUnLCAnNDAwJylcbiAqICAgICBgYGBcbiAqXG4gKiA0LiBTbG93IGRvd24gc2V0VGltZW91dCgpIHgyIHRpbWVzIHdoZXJlIGNhbGxiYWNrIG1hdGNoZWQgd2l0aCBgZXhhbXBsZWAgYW5kIHRpbWVvdXQgZXF1YWwgMTAwMG1zXG4gKiAgICAgYGBgXG4gKiAgICAgZXhhbXBsZS5vcmcjJSMvL3NjcmlwdGxldCgnYWRqdXN0LXNldFRpbWVvdXQnLCAnZXhhbXBsZScsICcnLCAnMicpXG4gKiAgICAgYGBgXG4gKiA1LiBBZGp1c3QgYWxsIHNldFRpbWVvdXQoKSB4NTAgdGltZXMgd2hlcmUgdGltZW91dCBlcXVhbCAyMDAwbXNcbiAqICAgICBgYGBcbiAqICAgICBleGFtcGxlLm9yZyMlIy8vc2NyaXB0bGV0KCdhZGp1c3Qtc2V0VGltZW91dCcsICcnLCAnMjAwMCcsICcwLjAyJylcbiAqICAgICBgYGBcbiAqIDYuIEFkanVzdCBhbGwgc2V0VGltZW91dCgpIHgyMCB0aW1lcyB3aGVyZSBjYWxsYmFjayBtYXRoZWQgd2l0aCBgdGVzdGAgYW5kIHRpbWVvdXQgaXMgcmFuZG9taXplZFxuICogICAgIGBgYFxuICogICAgIGV4YW1wbGUub3JnIyUjLy9zY3JpcHRsZXQoJ2FkanVzdC1zZXRUaW1lb3V0JywgJ3Rlc3QnLCAnKicpXG4gKiAgICAgYGBgXG4gKi9cblxuLyogZXNsaW50LWVuYWJsZSBtYXgtbGVuICovXG5cbmZ1bmN0aW9uIGFkanVzdFNldFRpbWVvdXQoc291cmNlLCBtYXRjaCwgdGltZW91dCwgYm9vc3QpIHtcbiAgdmFyIG5hdGl2ZVNldFRpbWVvdXQgPSB3aW5kb3cuc2V0VGltZW91dDtcbiAgdmFyIG1hdGNoUmVnZXhwID0gdG9SZWdFeHAobWF0Y2gpO1xuXG4gIHZhciB0aW1lb3V0V3JhcHBlciA9IGZ1bmN0aW9uIHRpbWVvdXRXcmFwcGVyKGNiLCBkKSB7XG4gICAgaWYgKG1hdGNoUmVnZXhwLnRlc3QoY2IudG9TdHJpbmcoKSkgJiYgaXNEZWxheU1hdGNoZWQodGltZW91dCwgZCkpIHtcbiAgICAgIGQgKj0gZ2V0Qm9vc3RNdWx0aXBsaWVyKGJvb3N0KTtcbiAgICAgIGhpdChzb3VyY2UpO1xuICAgIH1cblxuICAgIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KF9sZW4gPiAyID8gX2xlbiAtIDIgOiAwKSwgX2tleSA9IDI7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHtcbiAgICAgIGFyZ3NbX2tleSAtIDJdID0gYXJndW1lbnRzW19rZXldO1xuICAgIH1cblxuICAgIHJldHVybiBuYXRpdmVTZXRUaW1lb3V0LmFwcGx5KHdpbmRvdywgW2NiLCBkXS5jb25jYXQoYXJncykpO1xuICB9O1xuXG4gIHdpbmRvdy5zZXRUaW1lb3V0ID0gdGltZW91dFdyYXBwZXI7XG59XG5hZGp1c3RTZXRUaW1lb3V0Lm5hbWVzID0gWydhZGp1c3Qtc2V0VGltZW91dCcsIC8vIGFsaWFzZXMgYXJlIG5lZWRlZCBmb3IgbWF0Y2hpbmcgdGhlIHJlbGF0ZWQgc2NyaXB0bGV0IGNvbnZlcnRlZCBpbnRvIG91ciBzeW50YXhcbiduYW5vLXNldFRpbWVvdXQtYm9vc3Rlci5qcycsICd1Ym8tbmFuby1zZXRUaW1lb3V0LWJvb3N0ZXIuanMnLCAnbmFuby1zdGIuanMnLCAndWJvLW5hbm8tc3RiLmpzJywgJ3Viby1uYW5vLXNldFRpbWVvdXQtYm9vc3RlcicsICd1Ym8tbmFuby1zdGInXTtcbmFkanVzdFNldFRpbWVvdXQuaW5qZWN0aW9ucyA9IFtoaXQsIHRvUmVnRXhwLCBnZXRCb29zdE11bHRpcGxpZXIsIGlzRGVsYXlNYXRjaGVkLCBuYXRpdmVJc05hTiwgbmF0aXZlSXNGaW5pdGUsIGdldE1hdGNoRGVsYXksIGdldFdpbGRjYXJkU3ltYm9sLCBzaG91bGRNYXRjaEFueURlbGF5XTtcblxuLyogZXNsaW50LWRpc2FibGUgbWF4LWxlbiAqL1xuXG4vKipcbiAqIEBzY3JpcHRsZXQgZGlyLXN0cmluZ1xuICpcbiAqIEBkZXNjcmlwdGlvblxuICogV3JhcHMgdGhlIGBjb25zb2xlLmRpcmAgQVBJIHRvIGNhbGwgdGhlIGB0b1N0cmluZ2AgbWV0aG9kIG9mIHRoZSBhcmd1bWVudC5cbiAqIFRoZXJlIGFyZSBzZXZlcmFsIGFkYmxvY2sgY2lyY3VtdmVudGlvbiBzeXN0ZW1zIHRoYXQgZGV0ZWN0IGJyb3dzZXIgZGV2dG9vbHNcbiAqIGFuZCBoaWRlIHRoZW1zZWx2ZXMuIFRoZXJlZm9yZSwgaWYgd2UgZm9yY2UgdGhlbSB0byB0aGlua1xuICogdGhhdCBkZXZ0b29scyBhcmUgb3BlbiAodXNpbmcgdGhpcyBzY3JjaXB0bGV0KSxcbiAqIGl0IHdpbGwgYXV0b21hdGljYWxseSBkaXNhYmxlIHRoZSBhZGJsb2NrIGNpcmN1bXZlbnRpb24gc2NyaXB0LlxuICpcbiAqIFJlbGF0ZWQgQUJQIHNvdXJjZTpcbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9hZGJsb2NrcGx1cy9hZGJsb2NrcGx1c2NvcmUvYmxvYi82YjJhMzA5MDU0Y2MyMzQzMjEwMmI4NWQxM2YxMjU1OTYzOWVmNDk1L2xpYi9jb250ZW50L3NuaXBwZXRzLmpzI0w3NjZcbiAqXG4gKiAqKlN5bnRheCoqXG4gKiBgYGBcbiAqIGV4YW1wbGUub3JnIyUjLy9zY3JpcHRsZXQoJ2Rpci1zdHJpbmcnWywgdGltZXNdKVxuICogYGBgXG4gKiAtIGB0aW1lc2AgLSBvcHRpb25hbCwgdGhlIG51bWJlciBvZiB0aW1lcyB0byBjYWxsIHRoZSBgdG9TdHJpbmdgIG1ldGhvZCBvZiB0aGUgYXJndW1lbnQgdG8gYGNvbnNvbGUuZGlyYFxuICpcbiAqICoqRXhhbXBsZSoqXG4gKiBgYGBcbiAqICEgUnVuIDIgdGltZXNcbiAqIGV4YW1wbGUub3JnIyUjLy9zY3JpcHRsZXQoJ2Rpci1zdHJpbmcnLCAnMicpXG4gKiBgYGBcbiAqL1xuXG4vKiBlc2xpbnQtZW5hYmxlIG1heC1sZW4gKi9cblxuZnVuY3Rpb24gZGlyU3RyaW5nKHNvdXJjZSwgdGltZXMpIHtcbiAgdmFyIF9jb25zb2xlID0gY29uc29sZSxcbiAgICAgIGRpciA9IF9jb25zb2xlLmRpcjtcbiAgdGltZXMgPSBwYXJzZUludCh0aW1lcywgMTApO1xuXG4gIGZ1bmN0aW9uIGRpcldyYXBwZXIob2JqZWN0KSB7XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVudXNlZC12YXJzXG4gICAgdmFyIHRlbXA7XG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRpbWVzOyBpICs9IDEpIHtcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bnVzZWQtZXhwcmVzc2lvbnNcbiAgICAgIHRlbXAgPSBcIlwiLmNvbmNhdChvYmplY3QpO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2YgZGlyID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICBkaXIuY2FsbCh0aGlzLCBvYmplY3QpO1xuICAgIH1cblxuICAgIGhpdChzb3VyY2UsIHRlbXApO1xuICB9IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlXG5cblxuICBjb25zb2xlLmRpciA9IGRpcldyYXBwZXI7XG59XG5kaXJTdHJpbmcubmFtZXMgPSBbJ2Rpci1zdHJpbmcnLCAnYWJwLWRpci1zdHJpbmcnXTtcbmRpclN0cmluZy5pbmplY3Rpb25zID0gW2hpdF07XG5cbi8qIGVzbGludC1kaXNhYmxlIG1heC1sZW4gKi9cblxuLyoqXG4gKiBAc2NyaXB0bGV0IGpzb24tcHJ1bmVcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIFJlbW92ZXMgc3BlY2lmaWVkIHByb3BlcnRpZXMgZnJvbSB0aGUgcmVzdWx0IG9mIGNhbGxpbmcgSlNPTi5wYXJzZSBhbmQgcmV0dXJucyB0aGUgY2FsbGVyXG4gKlxuICogUmVsYXRlZCBVQk8gc2NyaXB0bGV0OlxuICogaHR0cHM6Ly9naXRodWIuY29tL2dvcmhpbGwvdUJsb2NrL3dpa2kvUmVzb3VyY2VzLUxpYnJhcnkjanNvbi1wcnVuZWpzLVxuICpcbiAqIFJlbGF0ZWQgQUJQIHNvdXJjZTpcbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9hZGJsb2NrcGx1cy9hZGJsb2NrcGx1c2NvcmUvYmxvYi9tYXN0ZXIvbGliL2NvbnRlbnQvc25pcHBldHMuanMjTDEyODVcbiAqXG4gKiAqKlN5bnRheCoqXG4gKiBgYGBcbiAqIGV4YW1wbGUub3JnIyUjLy9zY3JpcHRsZXQoJ2pzb24tcHJ1bmUnWywgcHJvcHNUb1JlbW92ZSBbLCBvYmxpZ2F0b3J5UHJvcHMgWywgc3RhY2tdXV0pXG4gKiBgYGBcbiAqXG4gKiAtIGBwcm9wc1RvUmVtb3ZlYCAtIG9wdGlvbmFsLCBzdHJpbmcgb2Ygc3BhY2Utc2VwYXJhdGVkIHByb3BlcnRpZXMgdG8gcmVtb3ZlXG4gKiAtIGBvYmxpZ2F0b3J5UHJvcHNgIC0gb3B0aW9uYWwsIHN0cmluZyBvZiBzcGFjZS1zZXBhcmF0ZWQgcHJvcGVydGllcyB3aGljaCBtdXN0IGJlIGFsbCBwcmVzZW50IGZvciB0aGUgcHJ1bmluZyB0byBvY2N1clxuICogLSBgc3RhY2tgIC0gb3B0aW9uYWwsIHN0cmluZyBvciByZWd1bGFyIGV4cHJlc3Npb24gdGhhdCBtdXN0IG1hdGNoIHRoZSBjdXJyZW50IGZ1bmN0aW9uIGNhbGwgc3RhY2sgdHJhY2VcbiAqXG4gKiA+IE5vdGUgcGxlYXNlIHRoYXQgeW91IGNhbiB1c2Ugd2lsZGNhcmQgYCpgIGZvciBjaGFpbiBwcm9wZXJ0eSBuYW1lLlxuICogZS5nLiAnYWQuKi5zcmMnIGluc3RlYWQgb2YgJ2FkLjAuc3JjIGFkLjEuc3JjIGFkLjIuc3JjIC4uLidcbiAqXG4gKiAqKkV4YW1wbGVzKipcbiAqIDEuIFJlbW92ZXMgcHJvcGVydHkgYGV4YW1wbGVgIGZyb20gdGhlIHJlc3VsdHMgb2YgSlNPTi5wYXJzZSBjYWxsXG4gKiAgICAgYGBgXG4gKiAgICAgZXhhbXBsZS5vcmcjJSMvL3NjcmlwdGxldCgnanNvbi1wcnVuZScsICdleGFtcGxlJylcbiAqICAgICBgYGBcbiAqXG4gKiAgICAgRm9yIGluc3RhbmNlLCB0aGUgZm9sbG93aW5nIGNhbGwgd2lsbCByZXR1cm4gYHsgb25lOiAxfWBcbiAqXG4gKiAgICAgYGBgaHRtbFxuICogICAgIEpTT04ucGFyc2UoJ3tcIm9uZVwiOjEsXCJleGFtcGxlXCI6dHJ1ZX0nKVxuICogICAgIGBgYFxuICpcbiAqIDIuIElmIHRoZXJlIGFyZSBubyBzcGVjaWZpZWQgcHJvcGVydGllcyBpbiB0aGUgcmVzdWx0IG9mIEpTT04ucGFyc2UgY2FsbCwgcHJ1bmluZyB3aWxsIE5PVCBvY2N1clxuICogICAgIGBgYFxuICogICAgIGV4YW1wbGUub3JnIyUjLy9zY3JpcHRsZXQoJ2pzb24tcHJ1bmUnLCAnb25lJywgJ29ibGlnYXRvcnlQcm9wJylcbiAqICAgICBgYGBcbiAqXG4gKiAgICAgRm9yIGluc3RhbmNlLCB0aGUgZm9sbG93aW5nIGNhbGwgd2lsbCByZXR1cm4gYHsgb25lOiAxLCB0d286IDJ9YFxuICpcbiAqICAgICBgYGBodG1sXG4gKiAgICAgSlNPTi5wYXJzZSgne1wib25lXCI6MSxcInR3b1wiOjJ9JylcbiAqICAgICBgYGBcbiAqXG4gKiAzLiBBIHByb3BlcnR5IGluIGEgbGlzdCBvZiBwcm9wZXJ0aWVzIGNhbiBiZSBhIGNoYWluIG9mIHByb3BlcnRpZXNcbiAqXG4gKiAgICAgYGBgXG4gKiAgICAgZXhhbXBsZS5vcmcjJSMvL3NjcmlwdGxldCgnanNvbi1wcnVuZScsICdhLmInLCAnYWRwYXRoLnVybC5maXJzdCcpXG4gKiAgICAgYGBgXG4gKlxuICogNC4gUmVtb3ZlcyBwcm9wZXJ0eSBgY29udGVudC5hZGAgZnJvbSB0aGUgcmVzdWx0cyBvZiBKU09OLnBhcnNlIGNhbGwgaXQncyBlcnJvciBzdGFjayB0cmFjZSBjb250YWlucyBgdGVzdC5qc2BcbiAqICAgICBgYGBcbiAqICAgICBleGFtcGxlLm9yZyMlIy8vc2NyaXB0bGV0KCdqc29uLXBydW5lJywgJ2NvbnRlbnQuYWQnLCAnJywgJ3Rlc3QuanMnKVxuICogICAgIGBgYFxuICpcbiAqIDUuIEEgcHJvcGVydHkgaW4gYSBsaXN0IG9mIHByb3BlcnRpZXMgY2FuIGJlIGEgY2hhaW4gb2YgcHJvcGVydGllcyB3aXRoIHdpbGRjYXJkIGluIGl0XG4gKlxuICogICAgIGBgYFxuICogICAgIGV4YW1wbGUub3JnIyUjLy9zY3JpcHRsZXQoJ2pzb24tcHJ1bmUnLCAnY29udGVudC4qLm1lZGlhLnNyYycsICdjb250ZW50LioubWVkaWEucHJlcm9sbCcpXG4gKiAgICAgYGBgXG4gKlxuICogNi4gQ2FsbCB3aXRoIG5vIGFyZ3VtZW50cyB3aWxsIGxvZyB0aGUgY3VycmVudCBob3N0bmFtZSBhbmQganNvbiBwYXlsb2FkIGF0IHRoZSBjb25zb2xlXG4gKiAgICAgYGBgXG4gKiAgICAgZXhhbXBsZS5vcmcjJSMvL3NjcmlwdGxldCgnanNvbi1wcnVuZScpXG4gKiAgICAgYGBgXG4gKi9cblxuLyogZXNsaW50LWVuYWJsZSBtYXgtbGVuICovXG5cbmZ1bmN0aW9uIGpzb25QcnVuZShzb3VyY2UsIHByb3BzVG9SZW1vdmUsIHJlcXVpcmVkSW5pdGlhbFByb3BzLCBzdGFjaykge1xuICBpZiAoISFzdGFjayAmJiAhbWF0Y2hTdGFja1RyYWNlKHN0YWNrLCBuZXcgRXJyb3IoKS5zdGFjaykpIHtcbiAgICByZXR1cm47XG4gIH0gLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGVcblxuXG4gIHZhciBsb2cgPSBjb25zb2xlLmxvZy5iaW5kKGNvbnNvbGUpO1xuICB2YXIgcHJ1bmVQYXRocyA9IHByb3BzVG9SZW1vdmUgIT09IHVuZGVmaW5lZCAmJiBwcm9wc1RvUmVtb3ZlICE9PSAnJyA/IHByb3BzVG9SZW1vdmUuc3BsaXQoLyArLykgOiBbXTtcbiAgdmFyIHJlcXVpcmVkUGF0aHMgPSByZXF1aXJlZEluaXRpYWxQcm9wcyAhPT0gdW5kZWZpbmVkICYmIHJlcXVpcmVkSW5pdGlhbFByb3BzICE9PSAnJyA/IHJlcXVpcmVkSW5pdGlhbFByb3BzLnNwbGl0KC8gKy8pIDogW107XG5cbiAgZnVuY3Rpb24gaXNQcnVuaW5nTmVlZGVkKHJvb3QpIHtcbiAgICBpZiAoIXJvb3QpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICB2YXIgc2hvdWxkUHJvY2VzcztcblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVxdWlyZWRQYXRocy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgdmFyIHJlcXVpcmVkUGF0aCA9IHJlcXVpcmVkUGF0aHNbaV07XG4gICAgICB2YXIgbGFzdE5lc3RlZFByb3BOYW1lID0gcmVxdWlyZWRQYXRoLnNwbGl0KCcuJykucG9wKCk7XG4gICAgICB2YXIgaGFzV2lsZGNhcmQgPSByZXF1aXJlZFBhdGguaW5kZXhPZignLiouJykgPiAtMSB8fCByZXF1aXJlZFBhdGguaW5kZXhPZignKi4nKSA+IC0xIHx8IHJlcXVpcmVkUGF0aC5pbmRleE9mKCcuKicpID4gLTEgfHwgcmVxdWlyZWRQYXRoLmluZGV4T2YoJy5bXS4nKSA+IC0xIHx8IHJlcXVpcmVkUGF0aC5pbmRleE9mKCdbXS4nKSA+IC0xIHx8IHJlcXVpcmVkUGF0aC5pbmRleE9mKCcuW10nKSA+IC0xOyAvLyBpZiB0aGUgcGF0aCBoYXMgd2lsZGNhcmQsIGdldFByb3BlcnR5SW5DaGFpbiBzaG91bGQgJ2xvb2sgdGhyb3VnaCcgY2hhaW4gcHJvcHNcblxuICAgICAgdmFyIGRldGFpbHMgPSBnZXRXaWxkY2FyZFByb3BlcnR5SW5DaGFpbihyb290LCByZXF1aXJlZFBhdGgsIGhhc1dpbGRjYXJkKTsgLy8gc3RhcnQgdmFsdWUgb2YgJ3Nob3VsZFByb2Nlc3MnIGR1ZSB0byBjaGVja2luZyBiZWxvd1xuXG4gICAgICBzaG91bGRQcm9jZXNzID0gIWhhc1dpbGRjYXJkO1xuXG4gICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgZGV0YWlscy5sZW5ndGg7IF9pICs9IDEpIHtcbiAgICAgICAgaWYgKGhhc1dpbGRjYXJkKSB7XG4gICAgICAgICAgLy8gaWYgdGhlcmUgaXMgYSB3aWxkY2FyZCxcbiAgICAgICAgICAvLyBhdCBsZWFzdCBvbmUgKHx8KSBvZiBwcm9wcyBjaGFpbiBzaG91bGQgYmUgcHJlc2VudCBpbiBvYmplY3RcbiAgICAgICAgICBzaG91bGRQcm9jZXNzID0gIShkZXRhaWxzW19pXS5iYXNlW2xhc3ROZXN0ZWRQcm9wTmFtZV0gPT09IHVuZGVmaW5lZCkgfHwgc2hvdWxkUHJvY2VzcztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBvdGhlcndpc2UgZWFjaCBvbmUgKCYmKSBvZiB0aGVtIHNob3VsZCBiZSB0aGVyZVxuICAgICAgICAgIHNob3VsZFByb2Nlc3MgPSAhKGRldGFpbHNbX2ldLmJhc2VbbGFzdE5lc3RlZFByb3BOYW1lXSA9PT0gdW5kZWZpbmVkKSAmJiBzaG91bGRQcm9jZXNzO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHNob3VsZFByb2Nlc3M7XG4gIH1cbiAgLyoqXG4gICAqIFBydW5lcyBwcm9wZXJ0aWVzIG9mICdyb290JyBvYmplY3RcbiAgICogQHBhcmFtIHtPYmplY3R9IHJvb3RcbiAgICovXG5cblxuICB2YXIganNvblBydW5lciA9IGZ1bmN0aW9uIGpzb25QcnVuZXIocm9vdCkge1xuICAgIGlmIChwcnVuZVBhdGhzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgbG9nKHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZSwgcm9vdCk7XG4gICAgICByZXR1cm4gcm9vdDtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgaWYgKGlzUHJ1bmluZ05lZWRlZChyb290KSA9PT0gZmFsc2UpIHtcbiAgICAgICAgcmV0dXJuIHJvb3Q7XG4gICAgICB9IC8vIGlmIHBydW5pbmcgaXMgbmVlZGVkLCB3ZSBjaGVjayBldmVyeSBpbnB1dCBwYXRoVG9SZW1vdmVcbiAgICAgIC8vIGFuZCBkZWxldGUgaXQgaWYgcm9vdCBoYXMgaXRcblxuXG4gICAgICBwcnVuZVBhdGhzLmZvckVhY2goZnVuY3Rpb24gKHBhdGgpIHtcbiAgICAgICAgdmFyIG93bmVyT2JqQXJyID0gZ2V0V2lsZGNhcmRQcm9wZXJ0eUluQ2hhaW4ocm9vdCwgcGF0aCwgdHJ1ZSk7XG4gICAgICAgIG93bmVyT2JqQXJyLmZvckVhY2goZnVuY3Rpb24gKG93bmVyT2JqKSB7XG4gICAgICAgICAgaWYgKG93bmVyT2JqICE9PSB1bmRlZmluZWQgJiYgb3duZXJPYmouYmFzZSkge1xuICAgICAgICAgICAgZGVsZXRlIG93bmVyT2JqLmJhc2Vbb3duZXJPYmoucHJvcF07XG4gICAgICAgICAgICBoaXQoc291cmNlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgbG9nKGUudG9TdHJpbmcoKSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJvb3Q7XG4gIH07XG5cbiAgdmFyIG5hdGl2ZUpTT05QYXJzZSA9IEpTT04ucGFyc2U7XG5cbiAgdmFyIGpzb25QYXJzZVdyYXBwZXIgPSBmdW5jdGlvbiBqc29uUGFyc2VXcmFwcGVyKCkge1xuICAgIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KF9sZW4pLCBfa2V5ID0gMDsgX2tleSA8IF9sZW47IF9rZXkrKykge1xuICAgICAgYXJnc1tfa2V5XSA9IGFyZ3VtZW50c1tfa2V5XTtcbiAgICB9XG5cbiAgICAvLyBkZWFsaW5nIHdpdGggc3RyaW5naWZpZWQganNvbiBpbiBhcmdzLCB3aGljaCBzaG91bGQgYmUgcGFyc2VkLlxuICAgIC8vIHNvIHdlIGNhbGwgbmF0aXZlSlNPTlBhcnNlIGFzIEpTT04ucGFyc2Ugd2hpY2ggaXMgYm91bmQgdG8gSlNPTiBvYmplY3RcbiAgICB2YXIgcm9vdCA9IG5hdGl2ZUpTT05QYXJzZS5hcHBseShKU09OLCBhcmdzKTtcbiAgICByZXR1cm4ganNvblBydW5lcihyb290KTtcbiAgfTsgLy8gSlNPTi5wYXJzZSBtb2NraW5nXG5cblxuICBqc29uUGFyc2VXcmFwcGVyLnRvU3RyaW5nID0gbmF0aXZlSlNPTlBhcnNlLnRvU3RyaW5nLmJpbmQobmF0aXZlSlNPTlBhcnNlKTtcbiAgSlNPTi5wYXJzZSA9IGpzb25QYXJzZVdyYXBwZXI7IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjb21wYXQvY29tcGF0XG5cbiAgdmFyIG5hdGl2ZVJlc3BvbnNlSnNvbiA9IFJlc3BvbnNlLnByb3RvdHlwZS5qc29uOyAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZnVuYy1uYW1lc1xuXG4gIHZhciByZXNwb25zZUpzb25XcmFwcGVyID0gZnVuY3Rpb24gcmVzcG9uc2VKc29uV3JhcHBlcigpIHtcbiAgICB2YXIgcHJvbWlzZSA9IG5hdGl2ZVJlc3BvbnNlSnNvbi5hcHBseSh0aGlzKTtcbiAgICByZXR1cm4gcHJvbWlzZS50aGVuKGZ1bmN0aW9uIChvYmopIHtcbiAgICAgIHJldHVybiBqc29uUHJ1bmVyKG9iaik7XG4gICAgfSk7XG4gIH07IC8vIGRvIG5vdGhpbmcgaWYgYnJvd3NlciBkb2VzIG5vdCBzdXBwb3J0IFJlc3BvbnNlIChlLmcuIEludGVybmV0IEV4cGxvcmVyKVxuICAvLyBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvUmVzcG9uc2VcblxuXG4gIGlmICh0eXBlb2YgUmVzcG9uc2UgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgcmV0dXJuO1xuICB9IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjb21wYXQvY29tcGF0XG5cblxuICBSZXNwb25zZS5wcm90b3R5cGUuanNvbiA9IHJlc3BvbnNlSnNvbldyYXBwZXI7XG59XG5qc29uUHJ1bmUubmFtZXMgPSBbJ2pzb24tcHJ1bmUnLCAvLyBhbGlhc2VzIGFyZSBuZWVkZWQgZm9yIG1hdGNoaW5nIHRoZSByZWxhdGVkIHNjcmlwdGxldCBjb252ZXJ0ZWQgaW50byBvdXIgc3ludGF4XG4nanNvbi1wcnVuZS5qcycsICd1Ym8tanNvbi1wcnVuZS5qcycsICd1Ym8tanNvbi1wcnVuZScsICdhYnAtanNvbi1wcnVuZSddO1xuanNvblBydW5lLmluamVjdGlvbnMgPSBbaGl0LCBtYXRjaFN0YWNrVHJhY2UsIGdldFdpbGRjYXJkUHJvcGVydHlJbkNoYWluLCB0b1JlZ0V4cCwgZ2V0V2lsZGNhcmRTeW1ib2xdO1xuXG4vKiBlc2xpbnQtZGlzYWJsZSBtYXgtbGVuICovXG5cbi8qKlxuICogQHNjcmlwdGxldCBwcmV2ZW50LXJlcXVlc3RBbmltYXRpb25GcmFtZVxuICpcbiAqIEBkZXNjcmlwdGlvblxuICogUHJldmVudHMgYSBgcmVxdWVzdEFuaW1hdGlvbkZyYW1lYCBjYWxsXG4gKiBpZiB0aGUgdGV4dCBvZiB0aGUgY2FsbGJhY2sgaXMgbWF0Y2hpbmcgdGhlIHNwZWNpZmllZCBzZWFyY2ggc3RyaW5nIHdoaWNoIGRvZXMgbm90IHN0YXJ0IHdpdGggYCFgO1xuICogb3RoZXJ3aXNlIG1pc21hdGNoZWQgY2FsbHMgc2hvdWxkIGJlIGRlZnVzZWQuXG4gKlxuICogUmVsYXRlZCBVQk8gc2NyaXB0bGV0OlxuICogaHR0cHM6Ly9naXRodWIuY29tL2dvcmhpbGwvdUJsb2NrL3dpa2kvUmVzb3VyY2VzLUxpYnJhcnkjbm8tcmVxdWVzdGFuaW1hdGlvbmZyYW1lLWlmanMtXG4gKlxuICogKipTeW50YXgqKlxuICogYGBgXG4gKiBleGFtcGxlLm9yZyMlIy8vc2NyaXB0bGV0KCdwcmV2ZW50LXJlcXVlc3RBbmltYXRpb25GcmFtZSdbLCBzZWFyY2hdKVxuICogYGBgXG4gKlxuICogLSBgc2VhcmNoYCAtIG9wdGlvbmFsLCBzdHJpbmcgb3IgcmVndWxhciBleHByZXNzaW9uLlxuICogSWYgc3RhcnRzIHdpdGggYCFgLCBzY3JpcHRsZXQgd2lsbCBub3QgbWF0Y2ggdGhlIHN0cmluZ2lmaWVkIGNhbGxiYWNrIGJ1dCBhbGwgb3RoZXIgd2lsbCBiZSBkZWZ1c2VkLlxuICogSWYgZG8gbm90IHN0YXJ0IHdpdGggYCFgLCB0aGUgc3RyaW5naWZpZWQgY2FsbGJhY2sgd2lsbCBiZSBtYXRjaGVkLlxuICpcbiAqIENhbGwgd2l0aCBubyBhcmd1bWVudCB3aWxsIGxvZyBhbGwgcmVxdWVzdEFuaW1hdGlvbkZyYW1lIGNhbGxzIHdoaWxlIGRlYnVnZ2luZy5cbiAqIFNvIGRvIG5vdCB1c2UgdGhlIHNjcmlwdGxldCB3aXRob3V0IGFueSBwYXJhbWV0ZXIgaW4gcHJvZHVjdGlvbiBmaWx0ZXIgbGlzdHMuXG4gKlxuICogKipFeGFtcGxlcyoqXG4gKiAxLiBQcmV2ZW50cyBgcmVxdWVzdEFuaW1hdGlvbkZyYW1lYCBjYWxscyBpZiB0aGUgY2FsbGJhY2sgbWF0Y2hlcyBgL1xcLnRlc3QvYC5cbiAqICAgICBgYGBiYXNoXG4gKiAgICAgZXhhbXBsZS5vcmcjJSMvL3NjcmlwdGxldCgncHJldmVudC1yZXF1ZXN0QW5pbWF0aW9uRnJhbWUnLCAnL1xcLnRlc3QvJylcbiAqICAgICBgYGBcbiAqXG4gKiAgICAgRm9yIGluc3RhbmNlLCB0aGUgZm9sbG93aW5nIGNhbGwgd2lsbCBiZSBwcmV2ZW50ZWQ6XG4gKiAgICAgYGBgamF2YXNjcmlwdFxuICogICAgIHZhciB0aW1lcyA9IDA7XG4gKiAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZ1bmN0aW9uIGNoYW5nZSgpIHtcbiAqICAgICAgICAgd2luZG93LnRlc3QgPSAnbmV3IHZhbHVlJztcbiAqICAgICAgICAgaWYgKHRpbWVzIDwgMikge1xuICogICAgICAgICAgICAgdGltZXMgKz0gMTtcbiAqICAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShjaGFuZ2UpO1xuICogICAgICAgICB9XG4gKiAgICAgfSk7XG4gKiAgICAgYGBgXG4gKiAyLiBQcmV2ZW50cyBgcmVxdWVzdEFuaW1hdGlvbkZyYW1lYCBjYWxscyBpZiAqKmRvZXMgbm90IG1hdGNoKiogJ2NoZWNrJy5cbiAqICAgICBgYGBiYXNoXG4gKiAgICAgZXhhbXBsZS5vcmcjJSMvL3NjcmlwdGxldCgncHJldmVudC1yZXF1ZXN0QW5pbWF0aW9uRnJhbWUnLCAnIWNoZWNrJylcbiAqICAgICBgYGBcbiAqXG4gKiAgICAgRm9yIGluc3RhbmNlLCBvbmx5IHRoZSBmaXJzdCBjYWxsIHdpbGwgYmUgcHJldmVudGVkOlxuICpcbiAqICAgICBgYGBqYXZhc2NyaXB0XG4gKiAgICAgdmFyIHRpbWVzRmlyc3QgPSAwO1xuICogICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbiBjaGFuZ2VGaXJzdCgpIHtcbiAqICAgICAgICAgd2luZG93LmNoZWNrID0gJ3Nob3VsZCBub3QgYmUgcHJldmVudGVkJztcbiAqICAgICAgICAgaWYgKHRpbWVzRmlyc3QgPCAyKSB7XG4gKiAgICAgICAgICAgICB0aW1lc0ZpcnN0ICs9IDE7XG4gKiAgICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoY2hhbmdlRmlyc3QpO1xuICogICAgICAgICB9XG4gKiAgICAgfSk7XG4gKlxuICogICAgIHZhciB0aW1lc1NlY29uZCA9IDA7XG4gKiAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZ1bmN0aW9uIGNoYW5nZVNlY29uZCgpIHtcbiAqICAgICAgICAgd2luZG93LnNlY29uZCA9ICdzaG91bGQgYmUgcHJldmVudGVkJztcbiAqICAgICAgICAgaWYgKHRpbWVzU2Vjb25kIDwgMikge1xuICogICAgICAgICAgICAgdGltZXNTZWNvbmQgKz0gMTtcbiAqICAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShjaGFuZ2VTZWNvbmQpO1xuICogICAgICAgICB9XG4gKiAgICAgfSk7XG4gKiAgICAgYGBgXG4gKi9cblxuLyogZXNsaW50LWVuYWJsZSBtYXgtbGVuICovXG5cbmZ1bmN0aW9uIHByZXZlbnRSZXF1ZXN0QW5pbWF0aW9uRnJhbWUoc291cmNlLCBtYXRjaCkge1xuICB2YXIgbmF0aXZlUmVxdWVzdEFuaW1hdGlvbkZyYW1lID0gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZTsgLy8gbG9ncyByZXF1ZXN0QW5pbWF0aW9uRnJhbWUgdG8gY29uc29sZSBpZiBubyBhcmd1bWVudHMgaGF2ZSBiZWVuIHNwZWNpZmllZFxuXG4gIHZhciBzaG91bGRMb2cgPSB0eXBlb2YgbWF0Y2ggPT09ICd1bmRlZmluZWQnO1xuXG4gIHZhciBfcGFyc2VNYXRjaEFyZyA9IHBhcnNlTWF0Y2hBcmcobWF0Y2gpLFxuICAgICAgaXNJbnZlcnRlZE1hdGNoID0gX3BhcnNlTWF0Y2hBcmcuaXNJbnZlcnRlZE1hdGNoLFxuICAgICAgbWF0Y2hSZWdleHAgPSBfcGFyc2VNYXRjaEFyZy5tYXRjaFJlZ2V4cDtcblxuICB2YXIgcmFmV3JhcHBlciA9IGZ1bmN0aW9uIHJhZldyYXBwZXIoY2FsbGJhY2spIHtcbiAgICB2YXIgc2hvdWxkUHJldmVudCA9IGZhbHNlO1xuXG4gICAgaWYgKHNob3VsZExvZykge1xuICAgICAgdmFyIGxvZ01lc3NhZ2UgPSBcImxvZzogcmVxdWVzdEFuaW1hdGlvbkZyYW1lKFxcXCJcIi5jb25jYXQoY2FsbGJhY2sudG9TdHJpbmcoKSwgXCJcXFwiKVwiKTtcbiAgICAgIGhpdChzb3VyY2UsIGxvZ01lc3NhZ2UpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzaG91bGRQcmV2ZW50ID0gbWF0Y2hSZWdleHAudGVzdChjYWxsYmFjay50b1N0cmluZygpKSAhPT0gaXNJbnZlcnRlZE1hdGNoO1xuICAgIH1cblxuICAgIGlmIChzaG91bGRQcmV2ZW50KSB7XG4gICAgICBoaXQoc291cmNlKTtcbiAgICAgIHJldHVybiBuYXRpdmVSZXF1ZXN0QW5pbWF0aW9uRnJhbWUobm9vcEZ1bmMpO1xuICAgIH1cblxuICAgIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KF9sZW4gPiAxID8gX2xlbiAtIDEgOiAwKSwgX2tleSA9IDE7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHtcbiAgICAgIGFyZ3NbX2tleSAtIDFdID0gYXJndW1lbnRzW19rZXldO1xuICAgIH1cblxuICAgIHJldHVybiBuYXRpdmVSZXF1ZXN0QW5pbWF0aW9uRnJhbWUuYXBwbHkod2luZG93LCBbY2FsbGJhY2tdLmNvbmNhdChhcmdzKSk7XG4gIH07XG5cbiAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSA9IHJhZldyYXBwZXI7XG59XG5wcmV2ZW50UmVxdWVzdEFuaW1hdGlvbkZyYW1lLm5hbWVzID0gWydwcmV2ZW50LXJlcXVlc3RBbmltYXRpb25GcmFtZScsIC8vIGFsaWFzZXMgYXJlIG5lZWRlZCBmb3IgbWF0Y2hpbmcgdGhlIHJlbGF0ZWQgc2NyaXB0bGV0IGNvbnZlcnRlZCBpbnRvIG91ciBzeW50YXhcbiduby1yZXF1ZXN0QW5pbWF0aW9uRnJhbWUtaWYuanMnLCAndWJvLW5vLXJlcXVlc3RBbmltYXRpb25GcmFtZS1pZi5qcycsICdub3JhZmlmLmpzJywgJ3Viby1ub3JhZmlmLmpzJywgJ3Viby1uby1yZXF1ZXN0QW5pbWF0aW9uRnJhbWUtaWYnLCAndWJvLW5vcmFmaWYnXTtcbnByZXZlbnRSZXF1ZXN0QW5pbWF0aW9uRnJhbWUuaW5qZWN0aW9ucyA9IFtoaXQsIG5vb3BGdW5jLCBwYXJzZU1hdGNoQXJnLCB0b1JlZ0V4cCwgc3RhcnRzV2l0aF07XG5cbi8qIGVzbGludC1kaXNhYmxlIG1heC1sZW4gKi9cblxuLyoqXG4gKiBAc2NyaXB0bGV0IHNldC1jb29raWVcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIFNldHMgYSBjb29raWUgd2l0aCB0aGUgc3BlY2lmaWVkIG5hbWUgYW5kIHZhbHVlLiBDb29raWUgcGF0aCBkZWZhdWx0cyB0byByb290LlxuICpcbiAqICoqU3ludGF4KipcbiAqIGBgYFxuICogZXhhbXBsZS5vcmcjJSMvL3NjcmlwdGxldCgnc2V0LWNvb2tpZScsIG5hbWUsIHZhbHVlKVxuICogYGBgXG4gKlxuICogLSBgbmFtZWAgLSByZXF1aXJlZCwgY29va2llIG5hbWUgdG8gYmUgc2V0XG4gKiAtIGB2YWx1ZWAgLSByZXF1aXJlZCwgY29va2llIHZhbHVlOyBwb3NzaWJsZSB2YWx1ZXM6XG4gKiAgICAgLSBudW1iZXIgYD49IDAgJiYgPD0gMTVgXG4gKiAgICAgLSBvbmUgb2YgdGhlIHByZWRlZmluZWQgY29uc3RhbnRzOlxuICogICAgICAgICAtIGB0cnVlYCAvIGBUcnVlYFxuICogICAgICAgICAtIGBmYWxzZWAgLyBgRmFsc2VgXG4gKiAgICAgICAgIC0gYHllc2AgLyBgWWVzYCAvIGBZYFxuICogICAgICAgICAtIGBub2BcbiAqICAgICAgICAgLSBgb2tgIC8gYE9LYFxuICpcbiAqICoqRXhhbXBsZXMqKlxuICogYGBgXG4gKiBleGFtcGxlLm9yZyMlIy8vc2NyaXB0bGV0KCdzZXQtY29va2llJywgJ1JlYWRseUNvb2tpZUNvbnNlbnQnLCAnMSdcbiAqXG4gKiBleGFtcGxlLm9yZyMlIy8vc2NyaXB0bGV0KCdzZXQtY29va2llJywgJ2dkcHItc2V0dGluZ3MtY29va2llJywgJ3RydWUnKVxuICogYGBgXG4gKi9cblxuLyogZXNsaW50LWVuYWJsZSBtYXgtbGVuICovXG5cbmZ1bmN0aW9uIHNldENvb2tpZShzb3VyY2UsIG5hbWUsIHZhbHVlKSB7XG4gIHZhciBjb29raWVEYXRhID0gcHJlcGFyZUNvb2tpZShuYW1lLCB2YWx1ZSk7XG5cbiAgaWYgKGNvb2tpZURhdGEpIHtcbiAgICBoaXQoc291cmNlKTtcbiAgICBkb2N1bWVudC5jb29raWUgPSBjb29raWVEYXRhO1xuICB9XG59XG5zZXRDb29raWUubmFtZXMgPSBbJ3NldC1jb29raWUnXTtcbnNldENvb2tpZS5pbmplY3Rpb25zID0gW2hpdCwgbmF0aXZlSXNOYU4sIHByZXBhcmVDb29raWVdO1xuXG4vKipcbiAqIEBzY3JpcHRsZXQgc2V0LWNvb2tpZS1yZWxvYWRcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIFNldHMgYSBjb29raWUgd2l0aCB0aGUgc3BlY2lmaWVkIG5hbWUgYW5kIHZhbHVlLCBhbmQgdGhlbiByZWxvYWRzIHRoZSBjdXJyZW50IHBhZ2UuXG4gKiBJZiByZWxvYWRpbmcgb3B0aW9uIGlzIG5vdCBuZWVkZWQsIHVzZSBbc2V0LWNvb2tpZV0oI3NldC1jb29raWUpIHNjcmlwdGxldC5cbiAqXG4gKiAqKlN5bnRheCoqXG4gKiBgYGBcbiAqIGV4YW1wbGUub3JnIyUjLy9zY3JpcHRsZXQoJ3NldC1jb29raWUtcmVsb2FkJywgbmFtZSwgdmFsdWUpXG4gKiBgYGBcbiAqXG4gKiAtIGBuYW1lYCAtIHJlcXVpcmVkLCBjb29raWUgbmFtZSB0byBiZSBzZXRcbiAqIC0gYHZhbHVlYCAtIHJlcXVpcmVkLCBjb29raWUgdmFsdWU7IHBvc3NpYmxlIHZhbHVlczpcbiAqICAgICAtIG51bWJlciBgPj0gMCAmJiA8PSAxNWBcbiAqICAgICAtIG9uZSBvZiB0aGUgcHJlZGVmaW5lZCBjb25zdGFudHM6XG4gKiAgICAgICAgIC0gYHRydWVgIC8gYFRydWVgXG4gKiAgICAgICAgIC0gYGZhbHNlYCAvIGBGYWxzZWBcbiAqICAgICAgICAgLSBgeWVzYCAvIGBZZXNgIC8gYFlgXG4gKiAgICAgICAgIC0gYG5vYFxuICogICAgICAgICAtIGBva2AgLyBgT0tgXG4gKlxuICogKipFeGFtcGxlcyoqXG4gKiBgYGBcbiAqIGV4YW1wbGUub3JnIyUjLy9zY3JpcHRsZXQoJ3NldC1jb29raWUtcmVsb2FkJywgJ2NoZWNraW5nJywgJ29rJylcbiAqXG4gKiBleGFtcGxlLm9yZyMlIy8vc2NyaXB0bGV0KCdzZXQtY29va2llLXJlbG9hZCcsICdnZHByLXNldHRpbmdzLWNvb2tpZScsICcxJylcbiAqIGBgYFxuICovXG5cbmZ1bmN0aW9uIHNldENvb2tpZVJlbG9hZChzb3VyY2UsIG5hbWUsIHZhbHVlKSB7XG4gIHZhciBpc0Nvb2tpZUFscmVhZHlTZXQgPSBkb2N1bWVudC5jb29raWUuc3BsaXQoJzsnKS5zb21lKGZ1bmN0aW9uIChjb29raWVTdHIpIHtcbiAgICB2YXIgcG9zID0gY29va2llU3RyLmluZGV4T2YoJz0nKTtcblxuICAgIGlmIChwb3MgPT09IC0xKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgdmFyIGNvb2tpZU5hbWUgPSBjb29raWVTdHIuc2xpY2UoMCwgcG9zKS50cmltKCk7XG4gICAgdmFyIGNvb2tpZVZhbHVlID0gY29va2llU3RyLnNsaWNlKHBvcyArIDEpLnRyaW0oKTtcbiAgICByZXR1cm4gbmFtZSA9PT0gY29va2llTmFtZSAmJiB2YWx1ZSA9PT0gY29va2llVmFsdWU7XG4gIH0pO1xuICB2YXIgc2hvdWxkUmVsb2FkID0gIWlzQ29va2llQWxyZWFkeVNldDtcbiAgdmFyIGNvb2tpZURhdGEgPSBwcmVwYXJlQ29va2llKG5hbWUsIHZhbHVlKTtcblxuICBpZiAoY29va2llRGF0YSkge1xuICAgIGhpdChzb3VyY2UpO1xuICAgIGRvY3VtZW50LmNvb2tpZSA9IGNvb2tpZURhdGE7XG5cbiAgICBpZiAoc2hvdWxkUmVsb2FkKSB7XG4gICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG4gICAgfVxuICB9XG59XG5zZXRDb29raWVSZWxvYWQubmFtZXMgPSBbJ3NldC1jb29raWUtcmVsb2FkJ107XG5zZXRDb29raWVSZWxvYWQuaW5qZWN0aW9ucyA9IFtoaXQsIG5hdGl2ZUlzTmFOLCBwcmVwYXJlQ29va2llXTtcblxuLyoqXG4gKiBAc2NyaXB0bGV0IGhpZGUtaW4tc2hhZG93LWRvbVxuICpcbiAqIEBkZXNjcmlwdGlvblxuICogSGlkZXMgZWxlbWVudHMgaW5zaWRlIG9wZW4gc2hhZG93IERPTSBlbGVtZW50cy5cbiAqXG4gKiAqKlN5bnRheCoqXG4gKiBgYGBcbiAqIGV4YW1wbGUub3JnIyUjLy9zY3JpcHRsZXQoJ2hpZGUtaW4tc2hhZG93LWRvbScsIHNlbGVjdG9yWywgYmFzZVNlbGVjdG9yXSlcbiAqIGBgYFxuICpcbiAqIC0gYHNlbGVjdG9yYCDigJQgcmVxdWlyZWQsIENTUyBzZWxlY3RvciBvZiBlbGVtZW50IGluIHNoYWRvdy1kb20gdG8gaGlkZVxuICogLSBgYmFzZVNlbGVjdG9yYCDigJQgb3B0aW9uYWwsIHNlbGVjdG9yIG9mIHNwZWNpZmljIHBhZ2UgRE9NIGVsZW1lbnQsXG4gKiBuYXJyb3dzIGRvd24gdGhlIHBhcnQgb2YgdGhlIHBhZ2UgRE9NIHdoZXJlIHNoYWRvdy1kb20gaG9zdCBzdXBwb3NlZCB0byBiZSxcbiAqIGRlZmF1bHRzIHRvIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudFxuICpcbiAqID4gYGJhc2VTZWxlY3RvcmAgc2hvdWxkIG1hdGNoIGVsZW1lbnQgb2YgdGhlIHBhZ2UgRE9NLCBidXQgbm90IG9mIHNoYWRvdyBET01cbiAqXG4gKiAqKkV4YW1wbGVzKipcbiAqIGBgYFxuICogISBoaWRlcyBtZW51IGJhclxuICogdmlydXN0b3RhbC5jb20jJSMvL3NjcmlwdGxldCgnaGlkZS1pbi1zaGFkb3ctZG9tJywgJ2lyb24tcGFnZXMnLCAndnQtdmlydXN0b3RhbC1hcHAnKVxuICpcbiAqICEgaGlkZXMgZmxvYXRpbmcgZWxlbWVudFxuICogdmlydXN0b3RhbC5jb20jJSMvL3NjcmlwdGxldCgnaGlkZS1pbi1zaGFkb3ctZG9tJywgJ3Z0LXVpLWNvbnRhY3QtZmFiJylcbiAqIGBgYFxuICovXG5cbmZ1bmN0aW9uIGhpZGVJblNoYWRvd0RvbShzb3VyY2UsIHNlbGVjdG9yLCBiYXNlU2VsZWN0b3IpIHtcbiAgLy8gZG8gbm90aGluZyBpZiBicm93c2VyIGRvZXMgbm90IHN1cHBvcnQgU2hhZG93Um9vdFxuICAvLyBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvU2hhZG93Um9vdFxuICBpZiAoIUVsZW1lbnQucHJvdG90eXBlLmF0dGFjaFNoYWRvdykge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBoaWRlRWxlbWVudCA9IGZ1bmN0aW9uIGhpZGVFbGVtZW50KHRhcmdldEVsZW1lbnQpIHtcbiAgICB2YXIgRElTUExBWV9OT05FX0NTUyA9ICdkaXNwbGF5Om5vbmUhaW1wb3J0YW50Oyc7XG4gICAgdGFyZ2V0RWxlbWVudC5zdHlsZS5jc3NUZXh0ID0gRElTUExBWV9OT05FX0NTUztcbiAgfTtcbiAgLyoqXG4gICAqIEhhbmRsZXMgc2hhZG93LWRvbSBwaWVyY2luZyBhbmQgaGlkaW5nIG9mIGZvdW5kIGVsZW1lbnRzXG4gICAqL1xuXG5cbiAgdmFyIGhpZGVIYW5kbGVyID0gZnVuY3Rpb24gaGlkZUhhbmRsZXIoKSB7XG4gICAgLy8gc3RhcnQgdmFsdWUgb2Ygc2hhZG93LWRvbSBob3N0cyBmb3IgdGhlIHBhZ2UgZG9tXG4gICAgdmFyIGhvc3RFbGVtZW50cyA9ICFiYXNlU2VsZWN0b3IgPyBmaW5kSG9zdEVsZW1lbnRzKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCkgOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGJhc2VTZWxlY3Rvcik7IC8vIGlmIHRoZXJlIGlzIHNoYWRvdy1kb20gaG9zdCwgdGhleSBzaG91bGQgYmUgZXhwbG9yZWRcblxuICAgIHdoaWxlIChob3N0RWxlbWVudHMubGVuZ3RoICE9PSAwKSB7XG4gICAgICB2YXIgaXNIaWRkZW4gPSBmYWxzZTtcblxuICAgICAgdmFyIF9waWVyY2VTaGFkb3dEb20gPSBwaWVyY2VTaGFkb3dEb20oc2VsZWN0b3IsIGhvc3RFbGVtZW50cyksXG4gICAgICAgICAgdGFyZ2V0cyA9IF9waWVyY2VTaGFkb3dEb20udGFyZ2V0cyxcbiAgICAgICAgICBpbm5lckhvc3RzID0gX3BpZXJjZVNoYWRvd0RvbS5pbm5lckhvc3RzO1xuXG4gICAgICB0YXJnZXRzLmZvckVhY2goZnVuY3Rpb24gKHRhcmdldEVsKSB7XG4gICAgICAgIGhpZGVFbGVtZW50KHRhcmdldEVsKTtcbiAgICAgICAgaXNIaWRkZW4gPSB0cnVlO1xuICAgICAgfSk7XG5cbiAgICAgIGlmIChpc0hpZGRlbikge1xuICAgICAgICBoaXQoc291cmNlKTtcbiAgICAgIH0gLy8gY29udGludWUgdG8gcGllcmNlIGZvciBpbm5lciBzaGFkb3ctZG9tIGhvc3RzXG4gICAgICAvLyBhbmQgc2VhcmNoIGluc2lkZSB0aGVtIHdoaWxlIHRoZSBuZXh0IGl0ZXJhdGlvblxuXG5cbiAgICAgIGhvc3RFbGVtZW50cyA9IGlubmVySG9zdHM7XG4gICAgfVxuICB9O1xuXG4gIGhpZGVIYW5kbGVyKCk7XG4gIG9ic2VydmVET01DaGFuZ2VzKGhpZGVIYW5kbGVyLCB0cnVlKTtcbn1cbmhpZGVJblNoYWRvd0RvbS5uYW1lcyA9IFsnaGlkZS1pbi1zaGFkb3ctZG9tJ107XG5oaWRlSW5TaGFkb3dEb20uaW5qZWN0aW9ucyA9IFtoaXQsIG9ic2VydmVET01DaGFuZ2VzLCBmbGF0dGVuLCBmaW5kSG9zdEVsZW1lbnRzLCBwaWVyY2VTaGFkb3dEb21dO1xuXG4vKipcbiAqIEBzY3JpcHRsZXQgcmVtb3ZlLWluLXNoYWRvdy1kb21cbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIFJlbW92ZXMgZWxlbWVudHMgaW5zaWRlIG9wZW4gc2hhZG93IERPTSBlbGVtZW50cy5cbiAqXG4gKiAqKlN5bnRheCoqXG4gKiBgYGBcbiAqIGV4YW1wbGUub3JnIyUjLy9zY3JpcHRsZXQoJ3JlbW92ZS1pbi1zaGFkb3ctZG9tJywgc2VsZWN0b3JbLCBiYXNlU2VsZWN0b3JdKVxuICogYGBgXG4gKlxuICogLSBgc2VsZWN0b3JgIOKAlCByZXF1aXJlZCwgQ1NTIHNlbGVjdG9yIG9mIGVsZW1lbnQgaW4gc2hhZG93LWRvbSB0byByZW1vdmVcbiAqIC0gYGJhc2VTZWxlY3RvcmAg4oCUIG9wdGlvbmFsLCBzZWxlY3RvciBvZiBzcGVjaWZpYyBwYWdlIERPTSBlbGVtZW50LFxuICogbmFycm93cyBkb3duIHRoZSBwYXJ0IG9mIHRoZSBwYWdlIERPTSB3aGVyZSBzaGFkb3ctZG9tIGhvc3Qgc3VwcG9zZWQgdG8gYmUsXG4gKiBkZWZhdWx0cyB0byBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnRcbiAqXG4gKiA+IGBiYXNlU2VsZWN0b3JgIHNob3VsZCBtYXRjaCBlbGVtZW50IG9mIHRoZSBwYWdlIERPTSwgYnV0IG5vdCBvZiBzaGFkb3cgRE9NXG4gKlxuICogKipFeGFtcGxlcyoqXG4gKiBgYGBcbiAqICEgcmVtb3ZlcyBtZW51IGJhclxuICogdmlydXN0b3RhbC5jb20jJSMvL3NjcmlwdGxldCgncmVtb3ZlLWluLXNoYWRvdy1kb20nLCAnaXJvbi1wYWdlcycsICd2dC12aXJ1c3RvdGFsLWFwcCcpXG4gKlxuICogISByZW1vdmVzIGZsb2F0aW5nIGVsZW1lbnRcbiAqIHZpcnVzdG90YWwuY29tIyUjLy9zY3JpcHRsZXQoJ3JlbW92ZS1pbi1zaGFkb3ctZG9tJywgJ3Z0LXVpLWNvbnRhY3QtZmFiJylcbiAqIGBgYFxuICovXG5cbmZ1bmN0aW9uIHJlbW92ZUluU2hhZG93RG9tKHNvdXJjZSwgc2VsZWN0b3IsIGJhc2VTZWxlY3Rvcikge1xuICAvLyBkbyBub3RoaW5nIGlmIGJyb3dzZXIgZG9lcyBub3Qgc3VwcG9ydCBTaGFkb3dSb290XG4gIC8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9TaGFkb3dSb290XG4gIGlmICghRWxlbWVudC5wcm90b3R5cGUuYXR0YWNoU2hhZG93KSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIHJlbW92ZUVsZW1lbnQgPSBmdW5jdGlvbiByZW1vdmVFbGVtZW50KHRhcmdldEVsZW1lbnQpIHtcbiAgICB0YXJnZXRFbGVtZW50LnJlbW92ZSgpO1xuICB9O1xuICAvKipcbiAgICogSGFuZGxlcyBzaGFkb3ctZG9tIHBpZXJjaW5nIGFuZCByZW1vdmluZyBvZiBmb3VuZCBlbGVtZW50c1xuICAgKi9cblxuXG4gIHZhciByZW1vdmVIYW5kbGVyID0gZnVuY3Rpb24gcmVtb3ZlSGFuZGxlcigpIHtcbiAgICAvLyBzdGFydCB2YWx1ZSBvZiBzaGFkb3ctZG9tIGhvc3RzIGZvciB0aGUgcGFnZSBkb21cbiAgICB2YXIgaG9zdEVsZW1lbnRzID0gIWJhc2VTZWxlY3RvciA/IGZpbmRIb3N0RWxlbWVudHMoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KSA6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoYmFzZVNlbGVjdG9yKTsgLy8gaWYgdGhlcmUgaXMgc2hhZG93LWRvbSBob3N0LCB0aGV5IHNob3VsZCBiZSBleHBsb3JlZFxuXG4gICAgd2hpbGUgKGhvc3RFbGVtZW50cy5sZW5ndGggIT09IDApIHtcbiAgICAgIHZhciBpc1JlbW92ZWQgPSBmYWxzZTtcblxuICAgICAgdmFyIF9waWVyY2VTaGFkb3dEb20gPSBwaWVyY2VTaGFkb3dEb20oc2VsZWN0b3IsIGhvc3RFbGVtZW50cyksXG4gICAgICAgICAgdGFyZ2V0cyA9IF9waWVyY2VTaGFkb3dEb20udGFyZ2V0cyxcbiAgICAgICAgICBpbm5lckhvc3RzID0gX3BpZXJjZVNoYWRvd0RvbS5pbm5lckhvc3RzO1xuXG4gICAgICB0YXJnZXRzLmZvckVhY2goZnVuY3Rpb24gKHRhcmdldEVsKSB7XG4gICAgICAgIHJlbW92ZUVsZW1lbnQodGFyZ2V0RWwpO1xuICAgICAgICBpc1JlbW92ZWQgPSB0cnVlO1xuICAgICAgfSk7XG5cbiAgICAgIGlmIChpc1JlbW92ZWQpIHtcbiAgICAgICAgaGl0KHNvdXJjZSk7XG4gICAgICB9IC8vIGNvbnRpbnVlIHRvIHBpZXJjZSBmb3IgaW5uZXIgc2hhZG93LWRvbSBob3N0c1xuICAgICAgLy8gYW5kIHNlYXJjaCBpbnNpZGUgdGhlbSB3aGlsZSB0aGUgbmV4dCBpdGVyYXRpb25cblxuXG4gICAgICBob3N0RWxlbWVudHMgPSBpbm5lckhvc3RzO1xuICAgIH1cbiAgfTtcblxuICByZW1vdmVIYW5kbGVyKCk7XG4gIG9ic2VydmVET01DaGFuZ2VzKHJlbW92ZUhhbmRsZXIsIHRydWUpO1xufVxucmVtb3ZlSW5TaGFkb3dEb20ubmFtZXMgPSBbJ3JlbW92ZS1pbi1zaGFkb3ctZG9tJ107XG5yZW1vdmVJblNoYWRvd0RvbS5pbmplY3Rpb25zID0gW2hpdCwgb2JzZXJ2ZURPTUNoYW5nZXMsIGZsYXR0ZW4sIGZpbmRIb3N0RWxlbWVudHMsIHBpZXJjZVNoYWRvd0RvbV07XG5cbi8qKlxuICogQHNjcmlwdGxldCBuby1mbG9jXG4gKlxuICogQGRlc2NyaXB0aW9uXG4gKiBQcmV2ZW50cyB1c2luZyBHb29nbGUgQ2hyb21lIHRyYWNraW5nIGZlYXR1cmUgY2FsbGVkIEZlZGVyYXRlZCBMZWFybmluZyBvZiBDb2hvcnRzIChha2EgXCJGTG9DXCIpXG4gKlxuICogUmVsYXRlZCBVQk8gc2NyaXB0bGV0OlxuICogaHR0cHM6Ly9naXRodWIuY29tL2dvcmhpbGwvdUJsb2NrL3dpa2kvUmVzb3VyY2VzLUxpYnJhcnkjbm8tZmxvY2pzLVxuICpcbiAqICoqU3ludGF4KipcbiAqIGBgYFxuICogZXhhbXBsZS5vcmcjJSMvL3NjcmlwdGxldCgnbm8tZmxvYycpXG4gKiBgYGBcbiAqL1xuXG5mdW5jdGlvbiBub0Zsb2Moc291cmNlKSB7XG4gIHZhciBGTE9DX1BST1BFUlRZX05BTUUgPSAnaW50ZXJlc3RDb2hvcnQnO1xuXG4gIGlmIChEb2N1bWVudCBpbnN0YW5jZW9mIE9iamVjdCA9PT0gZmFsc2UpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBpZiAoIU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChEb2N1bWVudC5wcm90b3R5cGUsIEZMT0NfUFJPUEVSVFlfTkFNRSkgfHwgRG9jdW1lbnQucHJvdG90eXBlW0ZMT0NfUFJPUEVSVFlfTkFNRV0gaW5zdGFuY2VvZiBGdW5jdGlvbiA9PT0gZmFsc2UpIHtcbiAgICByZXR1cm47XG4gIH0gLy8gZG9jdW1lbnQuaW50ZXJlc3RDb2hvcnQoKSBpcyBhc3luYyBmdW5jdGlvbiBzbyBpdCdzIGJldHRlciB0byByZXR1cm4gUHJvbWlzZS5yZWplY3QoKVxuICAvLyBodHRwczovL2dpdGh1Yi5jb20vV0lDRy9mbG9jL2Jsb2IvZGNkNGMwNDJmYTZhODFiMDQ4ZTA0YTc4YjE4NGVhNDIwM2E3NTIxOS9SRUFETUUubWRcblxuXG4gIERvY3VtZW50LnByb3RvdHlwZVtGTE9DX1BST1BFUlRZX05BTUVdID0gbm9vcFByb21pc2VSZWplY3Q7XG4gIGhpdChzb3VyY2UpO1xufVxubm9GbG9jLm5hbWVzID0gWyduby1mbG9jJywgLy8gYWxpYXNlcyBhcmUgbmVlZGVkIGZvciBtYXRjaGluZyB0aGUgcmVsYXRlZCBzY3JpcHRsZXQgY29udmVydGVkIGludG8gb3VyIHN5bnRheFxuJ25vLWZsb2MuanMnLCAndWJvLW5vLWZsb2MuanMnLCAndWJvLW5vLWZsb2MnXTtcbm5vRmxvYy5pbmplY3Rpb25zID0gW2hpdCwgbm9vcFByb21pc2VSZWplY3RdO1xuXG4vKiBlc2xpbnQtZGlzYWJsZSBtYXgtbGVuICovXG5cbi8qKlxuICogQHNjcmlwdGxldCBwcmV2ZW50LWZldGNoXG4gKlxuICogQGRlc2NyaXB0aW9uXG4gKiBQcmV2ZW50cyBgZmV0Y2hgIGNhbGxzIGlmICoqYWxsKiogZ2l2ZW4gcGFyYW1ldGVycyBtYXRjaFxuICpcbiAqIFJlbGF0ZWQgVUJPIHNjcmlwdGxldDpcbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9nb3JoaWxsL3VCbG9jay93aWtpL1Jlc291cmNlcy1MaWJyYXJ5I25vLWZldGNoLWlmanMtXG4gKlxuICogKipTeW50YXgqKlxuICogYGBgXG4gKiBleGFtcGxlLm9yZyMlIy8vc2NyaXB0bGV0KCdwcmV2ZW50LWZldGNoJ1ssIHByb3BzVG9NYXRjaF0pXG4gKiBgYGBcbiAqXG4gKiAtIGBwcm9wc1RvTWF0Y2hgIC0gb3B0aW9uYWwsIHN0cmluZyBvZiBzcGFjZS1zZXBhcmF0ZWQgcHJvcGVydGllcyB0byBtYXRjaDsgcG9zc2libGUgcHJvcHM6XG4gKiAgIC0gc3RyaW5nIG9yIHJlZ3VsYXIgZXhwcmVzc2lvbiBmb3IgbWF0Y2hpbmcgdGhlIFVSTCBwYXNzZWQgdG8gZmV0Y2ggY2FsbDsgZW1wdHkgc3RyaW5nIG9yIHdpbGRjYXJkIGAqYCBmb3IgYWxsIGZldGNoIGNhbGxzIG1hdGNoXG4gKiAgIC0gY29sb24tc2VwYXJhdGVkIHBhaXJzIGBuYW1lOnZhbHVlYCB3aGVyZVxuICogICAgIC0gYG5hbWVgIGlzIFtgaW5pdGAgb3B0aW9uIG5hbWVdKGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9XaW5kb3dPcldvcmtlckdsb2JhbFNjb3BlL2ZldGNoI3BhcmFtZXRlcnMpXG4gKiAgICAgLSBgdmFsdWVgIGlzIHN0cmluZyBvciByZWd1bGFyIGV4cHJlc3Npb24gZm9yIG1hdGNoaW5nIHRoZSB2YWx1ZSBvZiB0aGUgb3B0aW9uIHBhc3NlZCB0byBmZXRjaCBjYWxsXG4gKlxuICogPiBVc2FnZSB3aXRoIG5vIGFyZ3VtZW50cyB3aWxsIGxvZyBmZXRjaCBjYWxscyB0byBicm93c2VyIGNvbnNvbGU7XG4gKiB3aGljaCBpcyB1c2VmdWxsIGZvciBkZWJ1Z2dpbmcgYnV0IHBlcm1pdHRlZCBmb3IgcHJvZHVjdGlvbiBmaWx0ZXIgbGlzdHMuXG4gKlxuICogKipFeGFtcGxlcyoqXG4gKiAxLiBQcmV2ZW50IGFsbCBmZXRjaCBjYWxsc1xuICogICAgIGBgYFxuICogICAgIGV4YW1wbGUub3JnIyUjLy9zY3JpcHRsZXQoJ3ByZXZlbnQtZmV0Y2gnLCAnKicpXG4gKiAgICAgYGBgXG4gKlxuICogMi4gUHJldmVudCBmZXRjaCBjYWxsIGZvciBzcGVjaWZpYyB1cmxcbiAqICAgICBgYGBcbiAqICAgICBleGFtcGxlLm9yZyMlIy8vc2NyaXB0bGV0KCdwcmV2ZW50LWZldGNoJywgJy91cmxcXFxcLnBhcnQvJylcbiAqICAgICBgYGBcbiAqXG4gKiAzLiBQcmV2ZW50IGZldGNoIGNhbGwgZm9yIHNwZWNpZmljIHJlcXVlc3QgbWV0aG9kXG4gKiAgICAgYGBgXG4gKiAgICAgZXhhbXBsZS5vcmcjJSMvL3NjcmlwdGxldCgncHJldmVudC1mZXRjaCcsICdtZXRob2Q6SEVBRCcpXG4gKiAgICAgYGBgXG4gKlxuICogNC4gUHJldmVudCBmZXRjaCBjYWxsIGZvciBzcGVjaWZpYyB1cmwgYW5kIHJlcXVlc3QgbWV0aG9kXG4gKiAgICAgYGBgXG4gKiAgICAgZXhhbXBsZS5vcmcjJSMvL3NjcmlwdGxldCgncHJldmVudC1mZXRjaCcsICcvc3BlY2lmaWVkX3VybF9wYXJ0LyBtZXRob2Q6L0hFQUR8R0VULycpXG4gKiAgICAgYGBgXG4gKi9cblxuLyogZXNsaW50LWVuYWJsZSBtYXgtbGVuICovXG5cbmZ1bmN0aW9uIHByZXZlbnRGZXRjaChzb3VyY2UsIHByb3BzVG9NYXRjaCkge1xuICAvLyBkbyBub3RoaW5nIGlmIGJyb3dzZXIgZG9lcyBub3Qgc3VwcG9ydCBmZXRjaCBvciBQcm94eSAoZS5nLiBJbnRlcm5ldCBFeHBsb3JlcilcbiAgLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL1dpbmRvd09yV29ya2VyR2xvYmFsU2NvcGUvZmV0Y2hcbiAgLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvUHJveHlcbiAgaWYgKHR5cGVvZiBmZXRjaCA9PT0gJ3VuZGVmaW5lZCcgfHwgdHlwZW9mIFByb3h5ID09PSAndW5kZWZpbmVkJykge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBoYW5kbGVyV3JhcHBlciA9IGZ1bmN0aW9uIGhhbmRsZXJXcmFwcGVyKHRhcmdldCwgdGhpc0FyZywgYXJncykge1xuICAgIHZhciBzaG91bGRQcmV2ZW50ID0gZmFsc2U7XG4gICAgdmFyIGZldGNoRGF0YSA9IGdldEZldGNoRGF0YShhcmdzKTtcblxuICAgIGlmICh0eXBlb2YgcHJvcHNUb01hdGNoID09PSAndW5kZWZpbmVkJykge1xuICAgICAgLy8gbG9nIGlmIG5vIHByb3BzVG9NYXRjaCBnaXZlblxuICAgICAgdmFyIGxvZ01lc3NhZ2UgPSBcImxvZzogZmV0Y2goIFwiLmNvbmNhdChvYmplY3RUb1N0cmluZyhmZXRjaERhdGEpLCBcIiApXCIpO1xuICAgICAgaGl0KHNvdXJjZSwgbG9nTWVzc2FnZSk7XG4gICAgfSBlbHNlIGlmIChwcm9wc1RvTWF0Y2ggPT09ICcnIHx8IHByb3BzVG9NYXRjaCA9PT0gZ2V0V2lsZGNhcmRTeW1ib2woKSkge1xuICAgICAgLy8gcHJldmVudCBhbGwgZmV0Y2ggY2FsbHNcbiAgICAgIHNob3VsZFByZXZlbnQgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgbWF0Y2hEYXRhID0gY29udmVydE1hdGNoUHJvcHNUb09iaihwcm9wc1RvTWF0Y2gpOyAvLyBwcmV2ZW50IG9ubHkgaWYgYWxsIHByb3BzIG1hdGNoXG5cbiAgICAgIHNob3VsZFByZXZlbnQgPSBPYmplY3Qua2V5cyhtYXRjaERhdGEpLmV2ZXJ5KGZ1bmN0aW9uIChtYXRjaEtleSkge1xuICAgICAgICB2YXIgbWF0Y2hWYWx1ZSA9IG1hdGNoRGF0YVttYXRjaEtleV07XG4gICAgICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZmV0Y2hEYXRhLCBtYXRjaEtleSkgJiYgbWF0Y2hWYWx1ZS50ZXN0KGZldGNoRGF0YVttYXRjaEtleV0pO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKHNob3VsZFByZXZlbnQpIHtcbiAgICAgIGhpdChzb3VyY2UpO1xuICAgICAgcmV0dXJuIG5vb3BQcm9taXNlUmVzb2x2ZSgpO1xuICAgIH1cblxuICAgIHJldHVybiBSZWZsZWN0LmFwcGx5KHRhcmdldCwgdGhpc0FyZywgYXJncyk7XG4gIH07XG5cbiAgdmFyIGZldGNoSGFuZGxlciA9IHtcbiAgICBhcHBseTogaGFuZGxlcldyYXBwZXJcbiAgfTtcbiAgZmV0Y2ggPSBuZXcgUHJveHkoZmV0Y2gsIGZldGNoSGFuZGxlcik7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tZ2xvYmFsLWFzc2lnblxufVxucHJldmVudEZldGNoLm5hbWVzID0gWydwcmV2ZW50LWZldGNoJywgLy8gYWxpYXNlcyBhcmUgbmVlZGVkIGZvciBtYXRjaGluZyB0aGUgcmVsYXRlZCBzY3JpcHRsZXQgY29udmVydGVkIGludG8gb3VyIHN5bnRheFxuJ25vLWZldGNoLWlmLmpzJywgJ3Viby1uby1mZXRjaC1pZi5qcycsICd1Ym8tbm8tZmV0Y2gtaWYnXTtcbnByZXZlbnRGZXRjaC5pbmplY3Rpb25zID0gW2hpdCwgZ2V0RmV0Y2hEYXRhLCBvYmplY3RUb1N0cmluZywgY29udmVydE1hdGNoUHJvcHNUb09iaiwgbm9vcFByb21pc2VSZXNvbHZlLCBnZXRXaWxkY2FyZFN5bWJvbCwgdG9SZWdFeHAsIGlzRW1wdHlPYmplY3QsIGdldFJlcXVlc3REYXRhLCBnZXRPYmplY3RFbnRyaWVzLCBnZXRPYmplY3RGcm9tRW50cmllc107XG5cbi8qKlxuICogVGhpcyBmaWxlIG11c3QgZXhwb3J0IGFsbCBzY3JpcHRsZXRzIHdoaWNoIHNob3VsZCBiZSBhY2Nlc3NpYmxlXG4gKi9cblxudmFyIHNjcmlwdGxldExpc3QgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7XG4gICAgX19wcm90b19fOiBudWxsLFxuICAgIGFib3J0T25Qcm9wZXJ0eVJlYWQ6IGFib3J0T25Qcm9wZXJ0eVJlYWQsXG4gICAgYWJvcnRPblByb3BlcnR5V3JpdGU6IGFib3J0T25Qcm9wZXJ0eVdyaXRlLFxuICAgIHByZXZlbnRTZXRUaW1lb3V0OiBwcmV2ZW50U2V0VGltZW91dCxcbiAgICBwcmV2ZW50U2V0SW50ZXJ2YWw6IHByZXZlbnRTZXRJbnRlcnZhbCxcbiAgICBwcmV2ZW50V2luZG93T3BlbjogcHJldmVudFdpbmRvd09wZW4sXG4gICAgYWJvcnRDdXJyZW50SW5saW5lU2NyaXB0OiBhYm9ydEN1cnJlbnRJbmxpbmVTY3JpcHQsXG4gICAgc2V0Q29uc3RhbnQ6IHNldENvbnN0YW50LFxuICAgIHJlbW92ZUNvb2tpZTogcmVtb3ZlQ29va2llLFxuICAgIHByZXZlbnRBZGRFdmVudExpc3RlbmVyOiBwcmV2ZW50QWRkRXZlbnRMaXN0ZW5lcixcbiAgICBwcmV2ZW50QmFiOiBwcmV2ZW50QmFiLFxuICAgIG5vd2VicnRjOiBub3dlYnJ0YyxcbiAgICBsb2dBZGRFdmVudExpc3RlbmVyOiBsb2dBZGRFdmVudExpc3RlbmVyLFxuICAgIGxvZ0V2YWw6IGxvZ0V2YWwsXG4gICAgbG9nOiBsb2csXG4gICAgbm9ldmFsOiBub2V2YWwsXG4gICAgcHJldmVudEV2YWxJZjogcHJldmVudEV2YWxJZixcbiAgICBwcmV2ZW50RmFiOiBwcmV2ZW50RmFiLFxuICAgIHNldFBvcGFkc0R1bW15OiBzZXRQb3BhZHNEdW1teSxcbiAgICBwcmV2ZW50UG9wYWRzTmV0OiBwcmV2ZW50UG9wYWRzTmV0LFxuICAgIHByZXZlbnRBZGZseTogcHJldmVudEFkZmx5LFxuICAgIGRlYnVnT25Qcm9wZXJ0eVJlYWQ6IGRlYnVnT25Qcm9wZXJ0eVJlYWQsXG4gICAgZGVidWdPblByb3BlcnR5V3JpdGU6IGRlYnVnT25Qcm9wZXJ0eVdyaXRlLFxuICAgIGRlYnVnQ3VycmVudElubGluZVNjcmlwdDogZGVidWdDdXJyZW50SW5saW5lU2NyaXB0LFxuICAgIHJlbW92ZUF0dHI6IHJlbW92ZUF0dHIsXG4gICAgcmVtb3ZlQ2xhc3M6IHJlbW92ZUNsYXNzLFxuICAgIGRpc2FibGVOZXd0YWJMaW5rczogZGlzYWJsZU5ld3RhYkxpbmtzLFxuICAgIGFkanVzdFNldEludGVydmFsOiBhZGp1c3RTZXRJbnRlcnZhbCxcbiAgICBhZGp1c3RTZXRUaW1lb3V0OiBhZGp1c3RTZXRUaW1lb3V0LFxuICAgIGRpclN0cmluZzogZGlyU3RyaW5nLFxuICAgIGpzb25QcnVuZToganNvblBydW5lLFxuICAgIHByZXZlbnRSZXF1ZXN0QW5pbWF0aW9uRnJhbWU6IHByZXZlbnRSZXF1ZXN0QW5pbWF0aW9uRnJhbWUsXG4gICAgc2V0Q29va2llOiBzZXRDb29raWUsXG4gICAgc2V0Q29va2llUmVsb2FkOiBzZXRDb29raWVSZWxvYWQsXG4gICAgaGlkZUluU2hhZG93RG9tOiBoaWRlSW5TaGFkb3dEb20sXG4gICAgcmVtb3ZlSW5TaGFkb3dEb206IHJlbW92ZUluU2hhZG93RG9tLFxuICAgIG5vRmxvYzogbm9GbG9jLFxuICAgIHByZXZlbnRGZXRjaDogcHJldmVudEZldGNoXG59KTtcblxuLyoqXG4gKiBTdG9yZSBvZiBBREcgcmVkaXJlY3RzIG5hbWVzIGFuZCB0aGllciBhbmFsb2dzLlxuICogQXMgaXQgaXMgbm90IGEgY29tcGF0aWJpbGl0eSB0YWJsZSwgbm8gbmVlZCB0byBrZWVwIGluIHJlZGlyZWN0cyBhcnJheSB0aGlyZC1wYXJ0eSByZWRpcmVjdHMuXG4gKlxuICogTmVlZGVkIG9ubHkgZm9yIGNvbnZlcmlvbiBwdXJwb3Nlcy5cbiAqIGUuZy4gZ29vZ2xldGFnbWFuYWdlci1ndG0gaXMgcmVtb3ZlZCBhbmQgc2hvdWxkIGJlIHJlbW92ZWQgZnJvbSBjb21wYXRpYmlsaXR5IHRhYmxlIGFzIHdlbGxcbiAqIGJ1dCBub3cgaXQgd29ya3MgYXMgYWxpYXMgZm9yIGdvb2dsZS1hbmFseXRpY3Mgc28gaXQgc2hvdWxkIHN0YXkgdmFsaWQgZm9yIGNvbXBpbGVyXG4gKi9cbnZhciByZWRpcmVjdHMgPSBbe1xuICBhZGc6ICcxeDEtdHJhbnNwYXJlbnQuZ2lmJyxcbiAgdWJvOiAnMXgxLmdpZicsXG4gIGFicDogJzF4MS10cmFuc3BhcmVudC1naWYnXG59LCB7XG4gIGFkZzogJzJ4Mi10cmFuc3BhcmVudC5wbmcnLFxuICB1Ym86ICcyeDIucG5nJyxcbiAgYWJwOiAnMngyLXRyYW5zcGFyZW50LXBuZydcbn0sIHtcbiAgYWRnOiAnM3gyLXRyYW5zcGFyZW50LnBuZycsXG4gIHVibzogJzN4Mi5wbmcnLFxuICBhYnA6ICczeDItdHJhbnNwYXJlbnQtcG5nJ1xufSwge1xuICBhZGc6ICczMngzMi10cmFuc3BhcmVudC5wbmcnLFxuICB1Ym86ICczMngzMi5wbmcnLFxuICBhYnA6ICczMngzMi10cmFuc3BhcmVudC1wbmcnXG59LCB7XG4gIGFkZzogJ2FtYXpvbi1hcHN0YWcnLFxuICB1Ym86ICdhbWF6b25fYXBzdGFnLmpzJ1xufSwge1xuICBhZGc6ICdnb29nbGUtYW5hbHl0aWNzJyxcbiAgdWJvOiAnZ29vZ2xlLWFuYWx5dGljc19hbmFseXRpY3MuanMnXG59LCB7XG4gIGFkZzogJ2dvb2dsZS1hbmFseXRpY3MtZ2EnLFxuICB1Ym86ICdnb29nbGUtYW5hbHl0aWNzX2dhLmpzJ1xufSwge1xuICBhZGc6ICdnb29nbGVzeW5kaWNhdGlvbi1hZHNieWdvb2dsZScsXG4gIHVibzogJ2dvb2dsZXN5bmRpY2F0aW9uX2Fkc2J5Z29vZ2xlLmpzJ1xufSwge1xuICAvLyBodHRwczovL2dpdGh1Yi5jb20vQWRndWFyZFRlYW0vU2NyaXB0bGV0cy9pc3N1ZXMvMTI3XG4gIGFkZzogJ2dvb2dsZXRhZ21hbmFnZXItZ3RtJyxcbiAgdWJvOiAnZ29vZ2xlLWFuYWx5dGljc19nYS5qcydcbn0sIHtcbiAgYWRnOiAnZ29vZ2xldGFnc2VydmljZXMtZ3B0JyxcbiAgdWJvOiAnZ29vZ2xldGFnc2VydmljZXNfZ3B0LmpzJ1xufSwge1xuICBhZGc6ICdtZXRyaWthLXlhbmRleC13YXRjaCdcbn0sIHtcbiAgYWRnOiAnbWV0cmlrYS15YW5kZXgtdGFnJ1xufSwge1xuICBhZGc6ICdub2V2YWwnLFxuICB1Ym86ICdub2V2YWwtc2lsZW50LmpzJ1xufSwge1xuICBhZGc6ICdub29wY3NzJyxcbiAgYWJwOiAnYmxhbmstY3NzJ1xufSwge1xuICBhZGc6ICdub29wZnJhbWUnLFxuICB1Ym86ICdub29wLmh0bWwnLFxuICBhYnA6ICdibGFuay1odG1sJ1xufSwge1xuICBhZGc6ICdub29wanMnLFxuICB1Ym86ICdub29wLmpzJyxcbiAgYWJwOiAnYmxhbmstanMnXG59LCB7XG4gIGFkZzogJ25vb3B0ZXh0JyxcbiAgdWJvOiAnbm9vcC50eHQnLFxuICBhYnA6ICdibGFuay10ZXh0J1xufSwge1xuICBhZGc6ICdub29wbXAzLTAuMXMnLFxuICB1Ym86ICdub29wLTAuMXMubXAzJyxcbiAgYWJwOiAnYmxhbmstbXAzJ1xufSwge1xuICBhZGc6ICdub29wbXA0LTFzJyxcbiAgdWJvOiAnbm9vcC0xcy5tcDQnLFxuICBhYnA6ICdibGFuay1tcDQnXG59LCB7XG4gIGFkZzogJ25vb3B2bWFwLTEuMCcsXG4gIHVibzogJ25vb3Atdm1hcDEuMC54bWwnXG59LCB7XG4gIGFkZzogJ25vb3B2YXN0LTIuMCdcbn0sIHtcbiAgYWRnOiAnbm9vcHZhc3QtMy4wJ1xufSwge1xuICBhZGc6ICdwcmV2ZW50LWJhYicsXG4gIHVibzogJ25vYmFiLmpzJ1xufSwge1xuICBhZGc6ICdwcmV2ZW50LWZhYi0zLjIuMCcsXG4gIHVibzogJ25vZmFiLmpzJ1xufSwge1xuICBhZGc6ICdwcmV2ZW50LXBvcGFkcy1uZXQnLFxuICB1Ym86ICdwb3BhZHMuanMnXG59LCB7XG4gIGFkZzogJ3Njb3JlY2FyZHJlc2VhcmNoLWJlYWNvbicsXG4gIHVibzogJ3Njb3JlY2FyZHJlc2VhcmNoX2JlYWNvbi5qcydcbn0sIHtcbiAgYWRnOiAnc2V0LXBvcGFkcy1kdW1teScsXG4gIHVibzogJ3BvcGFkcy1kdW1teS5qcydcbn0sIHtcbiAgYWRnOiAnZW1wdHknLFxuICB1Ym86ICdlbXB0eSdcbn1dO1xuXG52YXIgSlNfUlVMRV9NQVJLRVIgPSAnIyUjJztcbnZhciBDT01NRU5UX01BUktFUiA9ICchJztcbi8qKlxuICogQ2hlY2tzIGlmIHJ1bGUgdGV4dCBpcyBjb21tZW50IGUuZy4gISFleGFtcGxlLm9yZyMjK2pzKHNldC1jb25zdGFudC5qcywgdGVzdCwgZmFsc2UpXG4gKiBAcGFyYW0ge3N0cmluZ30gcnVsZVxuICogQHJldHVybiB7Ym9vbGVhbn1cbiAqL1xuXG52YXIgaXNDb21tZW50ID0gZnVuY3Rpb24gaXNDb21tZW50KHJ1bGUpIHtcbiAgcmV0dXJuIHN0YXJ0c1dpdGgocnVsZSwgQ09NTUVOVF9NQVJLRVIpO1xufTtcbi8qICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICpcbiAqIFNjcmlwdGxldHNcbiAqXG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKi9cblxuLyoqXG4gKiB1QmxvY2sgc2NyaXB0bGV0IHJ1bGUgbWFza1xuICovXG5cblxudmFyIFVCT19TQ1JJUFRMRVRfTUFTS19SRUcgPSAvI0A/I3NjcmlwdDppbmplY3R8I0A/I1xccypcXCtqcy87XG52YXIgVUJPX1NDUklQVExFVF9NQVNLXzEgPSAnIyMranMnO1xudmFyIFVCT19TQ1JJUFRMRVRfTUFTS18yID0gJyMjc2NyaXB0OmluamVjdCc7XG52YXIgVUJPX1NDUklQVExFVF9FWENFUFRJT05fTUFTS18xID0gJyNAIytqcyc7XG52YXIgVUJPX1NDUklQVExFVF9FWENFUFRJT05fTUFTS18yID0gJyNAI3NjcmlwdDppbmplY3QnO1xuLyoqXG4gKiBBZEJsb2NrIFBsdXMgc25pcHBldCBydWxlIG1hc2tcbiAqL1xuXG52YXIgQUJQX1NDUklQVExFVF9NQVNLID0gJyMkIyc7XG52YXIgQUJQX1NDUklQVExFVF9FWENFUFRJT05fTUFTSyA9ICcjQCQjJztcbi8qKlxuICogQWRHdWFyZCBDU1MgcnVsZSBtYXNrXG4gKi9cblxudmFyIEFER19DU1NfTUFTS19SRUcgPSAvI0A/XFwkIy4rP1xccypcXHsuKlxcfVxccyokL2c7XG4vKipcbiAqIENoZWNrcyBpZiB0aGUgYHJ1bGVgIGlzIEFkR3VhcmQgc2NyaXB0bGV0IHJ1bGVcbiAqIEBwYXJhbSB7c3RyaW5nfSBydWxlIC0gcnVsZSB0ZXh0XG4gKi9cblxudmFyIGlzQWRnU2NyaXB0bGV0UnVsZSA9IGZ1bmN0aW9uIGlzQWRnU2NyaXB0bGV0UnVsZShydWxlKSB7XG4gIHJldHVybiAhaXNDb21tZW50KHJ1bGUpICYmIHJ1bGUuaW5kZXhPZihBREdfU0NSSVBUTEVUX01BU0spID4gLTE7XG59O1xuLyoqXG4gKiBDaGVja3MgaWYgdGhlIGBydWxlYCBpcyB1Qk8gc2NyaXB0bGV0IHJ1bGVcbiAqIEBwYXJhbSB7c3RyaW5nfSBydWxlIHJ1bGUgdGV4dFxuICovXG5cblxudmFyIGlzVWJvU2NyaXB0bGV0UnVsZSA9IGZ1bmN0aW9uIGlzVWJvU2NyaXB0bGV0UnVsZShydWxlKSB7XG4gIHJldHVybiAocnVsZS5pbmRleE9mKFVCT19TQ1JJUFRMRVRfTUFTS18xKSA+IC0xIHx8IHJ1bGUuaW5kZXhPZihVQk9fU0NSSVBUTEVUX01BU0tfMikgPiAtMSB8fCBydWxlLmluZGV4T2YoVUJPX1NDUklQVExFVF9FWENFUFRJT05fTUFTS18xKSA+IC0xIHx8IHJ1bGUuaW5kZXhPZihVQk9fU0NSSVBUTEVUX0VYQ0VQVElPTl9NQVNLXzIpID4gLTEpICYmIFVCT19TQ1JJUFRMRVRfTUFTS19SRUcudGVzdChydWxlKSAmJiAhaXNDb21tZW50KHJ1bGUpO1xufTtcbi8qKlxuICogQ2hlY2tzIGlmIHRoZSBgcnVsZWAgaXMgQWRCbG9jayBQbHVzIHNuaXBwZXRcbiAqIEBwYXJhbSB7c3RyaW5nfSBydWxlIHJ1bGUgdGV4dFxuICovXG5cblxudmFyIGlzQWJwU25pcHBldFJ1bGUgPSBmdW5jdGlvbiBpc0FicFNuaXBwZXRSdWxlKHJ1bGUpIHtcbiAgcmV0dXJuIChydWxlLmluZGV4T2YoQUJQX1NDUklQVExFVF9NQVNLKSA+IC0xIHx8IHJ1bGUuaW5kZXhPZihBQlBfU0NSSVBUTEVUX0VYQ0VQVElPTl9NQVNLKSA+IC0xKSAmJiBydWxlLnNlYXJjaChBREdfQ1NTX01BU0tfUkVHKSA9PT0gLTEgJiYgIWlzQ29tbWVudChydWxlKTtcbn07XG4vKipcbiAqIEZpbmRzIHNjcmlwdGxldCBieSBpdCdzIG5hbWVcbiAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gc2NyaXB0bGV0IG5hbWVcbiAqL1xuXG5cbnZhciBnZXRTY3JpcHRsZXRCeU5hbWUgPSBmdW5jdGlvbiBnZXRTY3JpcHRsZXRCeU5hbWUobmFtZSkge1xuICB2YXIgc2NyaXB0bGV0cyA9IE9iamVjdC5rZXlzKHNjcmlwdGxldExpc3QpLm1hcChmdW5jdGlvbiAoa2V5KSB7XG4gICAgcmV0dXJuIHNjcmlwdGxldExpc3Rba2V5XTtcbiAgfSk7XG4gIHJldHVybiBzY3JpcHRsZXRzLmZpbmQoZnVuY3Rpb24gKHMpIHtcbiAgICByZXR1cm4gcy5uYW1lcyAvLyBmdWxsIG1hdGNoIG5hbWUgY2hlY2tpbmdcbiAgICAmJiAocy5uYW1lcy5pbmRleE9mKG5hbWUpID4gLTEgLy8gb3IgY2hlY2sgdWJvIGFsaWFzIG5hbWUgd2l0aG91dCAnLmpzJyBhdCB0aGUgZW5kXG4gICAgfHwgIWVuZHNXaXRoKG5hbWUsICcuanMnKSAmJiBzLm5hbWVzLmluZGV4T2YoXCJcIi5jb25jYXQobmFtZSwgXCIuanNcIikpID4gLTEpO1xuICB9KTtcbn07XG4vKipcbiAqIENoZWNrcyBpZiB0aGUgc2NyaXB0bGV0IG5hbWUgaXMgdmFsaWRcbiAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gU2NyaXB0bGV0IG5hbWVcbiAqL1xuXG5cbnZhciBpc1ZhbGlkU2NyaXB0bGV0TmFtZSA9IGZ1bmN0aW9uIGlzVmFsaWRTY3JpcHRsZXROYW1lKG5hbWUpIHtcbiAgaWYgKCFuYW1lKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgdmFyIHNjcmlwdGxldCA9IGdldFNjcmlwdGxldEJ5TmFtZShuYW1lKTtcblxuICBpZiAoIXNjcmlwdGxldCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHJldHVybiB0cnVlO1xufTtcbi8qICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICpcbiAqIFJlZGlyZWN0c1xuICpcbiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqL1xuXG4vKipcbiAqIFJlZGlyZWN0IHJlc291cmNlcyBtYXJrZXJzXG4gKi9cblxuXG52YXIgQURHX1VCT19SRURJUkVDVF9NQVJLRVIgPSAncmVkaXJlY3Q9JztcbnZhciBBQlBfUkVESVJFQ1RfTUFSS0VSID0gJ3Jld3JpdGU9YWJwLXJlc291cmNlOic7XG52YXIgRU1QVFlfUkVESVJFQ1RfTUFSS0VSID0gJ2VtcHR5JztcbnZhciBWQUxJRF9TT1VSQ0VfVFlQRVMgPSBbJ2ltYWdlJywgJ21lZGlhJywgJ3N1YmRvY3VtZW50JywgJ3N0eWxlc2hlZXQnLCAnc2NyaXB0JywgJ3htbGh0dHByZXF1ZXN0JywgJ290aGVyJ107XG4vKipcbiAqIFNvdXJjZSB0eXBlcyBmb3IgcmVkaXJlY3QgcnVsZXMgaWYgdGhlcmUgaXMgbm8gb25lIG9mIHRoZW0uXG4gKiBVc2VkIGZvciBBREcgLT4gVUJPIGNvbnZlcnNpb24uXG4gKi9cblxudmFyIEFCU0VOVF9TT1VSQ0VfVFlQRV9SRVBMQUNFTUVOVCA9IFt7XG4gIE5BTUU6ICdub29wdGV4dCcsXG4gIFRZUEVTOiBWQUxJRF9TT1VSQ0VfVFlQRVNcbn0sIHtcbiAgTkFNRTogJ25vb3BqcycsXG4gIFRZUEVTOiBbJ3NjcmlwdCddXG59LCB7XG4gIE5BTUU6ICdub29wZnJhbWUnLFxuICBUWVBFUzogWydzdWJkb2N1bWVudCddXG59LCB7XG4gIE5BTUU6ICcxeDEtdHJhbnNwYXJlbnQuZ2lmJyxcbiAgVFlQRVM6IFsnaW1hZ2UnXVxufSwge1xuICBOQU1FOiAnbm9vcG1wMy0wLjFzJyxcbiAgVFlQRVM6IFsnbWVkaWEnXVxufSwge1xuICBOQU1FOiAnbm9vcG1wNC0xcycsXG4gIFRZUEVTOiBbJ21lZGlhJ11cbn0sIHtcbiAgTkFNRTogJ2dvb2dsZXN5bmRpY2F0aW9uLWFkc2J5Z29vZ2xlJyxcbiAgVFlQRVM6IFsneG1saHR0cHJlcXVlc3QnLCAnc2NyaXB0J11cbn0sIHtcbiAgTkFNRTogJ2dvb2dsZS1hbmFseXRpY3MnLFxuICBUWVBFUzogWydzY3JpcHQnXVxufSwge1xuICBOQU1FOiAnZ29vZ2xldGFnc2VydmljZXMtZ3B0JyxcbiAgVFlQRVM6IFsnc2NyaXB0J11cbn1dO1xudmFyIHZhbGlkQWRnUmVkaXJlY3RzID0gcmVkaXJlY3RzLmZpbHRlcihmdW5jdGlvbiAoZWwpIHtcbiAgcmV0dXJuIGVsLmFkZztcbn0pO1xuLyoqXG4gKiBDb21wYXRpYmlsaXR5IG9iamVjdCB3aGVyZSBLRVlTID0gVUJPIHJlZGlyZWN0IG5hbWVzIGFuZCBWQUxVRVMgPSBBREcgcmVkaXJlY3QgbmFtZXNcbiAqIEl0J3MgdXNlZCBmb3IgVUJPIC0+IEFERyBjb252ZXJ0aW5nXG4gKi9cblxudmFyIHVib1RvQWRnQ29tcGF0aWJpbGl0eSA9IGdldE9iamVjdEZyb21FbnRyaWVzKHZhbGlkQWRnUmVkaXJlY3RzLmZpbHRlcihmdW5jdGlvbiAoZWwpIHtcbiAgcmV0dXJuIGVsLnVibztcbn0pLm1hcChmdW5jdGlvbiAoZWwpIHtcbiAgcmV0dXJuIFtlbC51Ym8sIGVsLmFkZ107XG59KSk7XG4vKipcbiAqIENvbXBhdGliaWxpdHkgb2JqZWN0IHdoZXJlIEtFWVMgPSBBQlAgcmVkaXJlY3QgbmFtZXMgYW5kIFZBTFVFUyA9IEFERyByZWRpcmVjdCBuYW1lc1xuICogSXQncyB1c2VkIGZvciBBQlAgLT4gQURHIGNvbnZlcnRpbmdcbiAqL1xuXG52YXIgYWJwVG9BZGdDb21wYXRpYmlsaXR5ID0gZ2V0T2JqZWN0RnJvbUVudHJpZXModmFsaWRBZGdSZWRpcmVjdHMuZmlsdGVyKGZ1bmN0aW9uIChlbCkge1xuICByZXR1cm4gZWwuYWJwO1xufSkubWFwKGZ1bmN0aW9uIChlbCkge1xuICByZXR1cm4gW2VsLmFicCwgZWwuYWRnXTtcbn0pKTtcbi8qKlxuICogQ29tcGF0aWJpbGl0eSBvYmplY3Qgd2hlcmUgS0VZUyA9IFVCTyByZWRpcmVjdCBuYW1lcyBhbmQgVkFMVUVTID0gQURHIHJlZGlyZWN0IG5hbWVzXG4gKiBJdCdzIHVzZWQgZm9yIEFERyAtPiBVQk8gY29udmVydGluZ1xuICovXG5cbnZhciBhZGdUb1Vib0NvbXBhdGliaWxpdHkgPSBnZXRPYmplY3RGcm9tRW50cmllcyh2YWxpZEFkZ1JlZGlyZWN0cy5maWx0ZXIoZnVuY3Rpb24gKGVsKSB7XG4gIHJldHVybiBlbC51Ym87XG59KS5tYXAoZnVuY3Rpb24gKGVsKSB7XG4gIHJldHVybiBbZWwuYWRnLCBlbC51Ym9dO1xufSkpO1xuLyoqXG4gKiBOZWVkZWQgZm9yIEFkR3VhcmQgcmVkaXJlY3QgbmFtZXMgdmFsaWRhdGlvbiB3aGVyZSBLRVlTID0gKip2YWxpZCoqIEFkR3VhcmQgcmVkaXJlY3QgbmFtZXNcbiAqICdhZGdUb1Vib0NvbXBhdGliaWxpdHknIGlzIHN0aWxsIG5lZWRlZCBmb3IgQURHIC0+IFVCTyBjb252ZXJ0aW5nXG4gKi9cblxudmFyIHZhbGlkQWRnQ29tcGF0aWJpbGl0eSA9IGdldE9iamVjdEZyb21FbnRyaWVzKHZhbGlkQWRnUmVkaXJlY3RzLm1hcChmdW5jdGlvbiAoZWwpIHtcbiAgcmV0dXJuIFtlbC5hZGcsICd2YWxpZCBhZGcgcmVkaXJlY3QnXTtcbn0pKTtcbnZhciBSRURJUkVDVF9SVUxFX1RZUEVTID0ge1xuICBWQUxJRF9BREc6IHtcbiAgICBtYXJrZXI6IEFER19VQk9fUkVESVJFQ1RfTUFSS0VSLFxuICAgIGNvbXBhdGliaWxpdHk6IHZhbGlkQWRnQ29tcGF0aWJpbGl0eVxuICB9LFxuICBBREc6IHtcbiAgICBtYXJrZXI6IEFER19VQk9fUkVESVJFQ1RfTUFSS0VSLFxuICAgIGNvbXBhdGliaWxpdHk6IGFkZ1RvVWJvQ29tcGF0aWJpbGl0eVxuICB9LFxuICBVQk86IHtcbiAgICBtYXJrZXI6IEFER19VQk9fUkVESVJFQ1RfTUFSS0VSLFxuICAgIGNvbXBhdGliaWxpdHk6IHVib1RvQWRnQ29tcGF0aWJpbGl0eVxuICB9LFxuICBBQlA6IHtcbiAgICBtYXJrZXI6IEFCUF9SRURJUkVDVF9NQVJLRVIsXG4gICAgY29tcGF0aWJpbGl0eTogYWJwVG9BZGdDb21wYXRpYmlsaXR5XG4gIH1cbn07XG4vKipcbiAqIFBhcnNlcyByZWRpcmVjdCBydWxlIG1vZGlmaWVyc1xuICogQHBhcmFtIHtzdHJpbmd9IHJ1bGVcbiAqIEByZXR1cm5zIHtBcnJheX1cbiAqL1xuXG52YXIgcGFyc2VNb2RpZmllcnMgPSBmdW5jdGlvbiBwYXJzZU1vZGlmaWVycyhydWxlKSB7XG4gIHJldHVybiBzdWJzdHJpbmdBZnRlcihydWxlLCAnJCcpLnNwbGl0KCcsJyk7XG59O1xuLyoqXG4gKiBHZXRzIHJlZGlyZWN0IHJlc291cmNlIG5hbWVcbiAqIEBwYXJhbSB7c3RyaW5nfSBydWxlXG4gKiBAcGFyYW0ge3N0cmluZ30gbWFya2VyIC0gc3BlY2lmaWMgQWRnL1VibyBvciBBYnAgcmVkaXJlY3QgcmVzb3VyY2VzIG1hcmtlclxuICogQHJldHVybnMge3N0cmluZ30gLSByZWRpcmVjdCByZXNvdXJjZSBuYW1lXG4gKi9cblxuXG52YXIgZ2V0UmVkaXJlY3ROYW1lID0gZnVuY3Rpb24gZ2V0UmVkaXJlY3ROYW1lKHJ1bGUsIG1hcmtlcikge1xuICB2YXIgcnVsZU1vZGlmaWVycyA9IHBhcnNlTW9kaWZpZXJzKHJ1bGUpO1xuICB2YXIgcmVkaXJlY3ROYW1lUGFydCA9IHJ1bGVNb2RpZmllcnMuZmluZChmdW5jdGlvbiAoZWwpIHtcbiAgICByZXR1cm4gZWwuaW5kZXhPZihtYXJrZXIpID4gLTE7XG4gIH0pO1xuICByZXR1cm4gc3Vic3RyaW5nQWZ0ZXIocmVkaXJlY3ROYW1lUGFydCwgbWFya2VyKTtcbn07XG4vKipcbiAqIENoZWNrcyBpZiB0aGUgYHJ1bGVgIGlzIEFkR3VhcmQgcmVkaXJlY3QgcnVsZS5cbiAqIERpc2NhcmRzIGNvbW1lbnRzIGFuZCBKUyBydWxlcyBhbmQgY2hlY2tzIGlmIHRoZSBgcnVsZWAgaGFzICdyZWRpcmVjdCcgbW9kaWZpZXIuXG4gKiBAcGFyYW0ge3N0cmluZ30gcnVsZSAtIHJ1bGUgdGV4dFxuICovXG5cblxudmFyIGlzQWRnUmVkaXJlY3RSdWxlID0gZnVuY3Rpb24gaXNBZGdSZWRpcmVjdFJ1bGUocnVsZSkge1xuICB2YXIgTUFSS0VSX0lOX0JBU0VfUEFSVF9NQVNLID0gJy8oKD8hXFxcXCR8XFxcXCwpLnsxfSlyZWRpcmVjdD0oLnswLH0/KVxcXFwkKHBvcHVwKT8vJztcbiAgcmV0dXJuICFpc0NvbW1lbnQocnVsZSkgJiYgcnVsZS5pbmRleE9mKFJFRElSRUNUX1JVTEVfVFlQRVMuQURHLm1hcmtlcikgPiAtMSAvLyBzb21lIGpzIHJ1bGVzIG1heSBoYXZlICdyZWRpcmVjdD0nIGluIGl0LCBzbyB3ZSBzaG91bGQgZ2V0IHJpZCBvZiB0aGVtXG4gICYmIHJ1bGUuaW5kZXhPZihKU19SVUxFX01BUktFUikgPT09IC0xIC8vIGdldCByaWQgb2YgcnVsZXMgbGlrZSAnX3JlZGlyZWN0PSo6Ly9sb29rLiRwb3B1cCdcbiAgJiYgIXRvUmVnRXhwKE1BUktFUl9JTl9CQVNFX1BBUlRfTUFTSykudGVzdChydWxlKTtcbn07XG4vKipcbiAqIENoZWNrcyBpZiB0aGUgYHJ1bGVgIHNhdGlzZmllcyB0aGUgYHR5cGVgXG4gKiBAcGFyYW0ge3N0cmluZ30gcnVsZSAtIHJ1bGUgdGV4dFxuICogQHBhcmFtIHsnVkFMSURfQURHJ3wnQURHJ3wnVUJPJ3wnQUJQJ30gdHlwZSAtIHR5cGUgb2YgYSByZWRpcmVjdCBydWxlXG4gKi9cblxuXG52YXIgaXNSZWRpcmVjdFJ1bGVCeVR5cGUgPSBmdW5jdGlvbiBpc1JlZGlyZWN0UnVsZUJ5VHlwZShydWxlLCB0eXBlKSB7XG4gIHZhciBfUkVESVJFQ1RfUlVMRV9UWVBFUyQgPSBSRURJUkVDVF9SVUxFX1RZUEVTW3R5cGVdLFxuICAgICAgbWFya2VyID0gX1JFRElSRUNUX1JVTEVfVFlQRVMkLm1hcmtlcixcbiAgICAgIGNvbXBhdGliaWxpdHkgPSBfUkVESVJFQ1RfUlVMRV9UWVBFUyQuY29tcGF0aWJpbGl0eTtcblxuICBpZiAocnVsZSAmJiAhaXNDb21tZW50KHJ1bGUpICYmIHJ1bGUuaW5kZXhPZihtYXJrZXIpID4gLTEpIHtcbiAgICB2YXIgcmVkaXJlY3ROYW1lID0gZ2V0UmVkaXJlY3ROYW1lKHJ1bGUsIG1hcmtlcik7XG5cbiAgICBpZiAoIXJlZGlyZWN0TmFtZSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHJldHVybiByZWRpcmVjdE5hbWUgPT09IE9iamVjdC5rZXlzKGNvbXBhdGliaWxpdHkpLmZpbmQoZnVuY3Rpb24gKGVsKSB7XG4gICAgICByZXR1cm4gZWwgPT09IHJlZGlyZWN0TmFtZTtcbiAgICB9KTtcbiAgfVxuXG4gIHJldHVybiBmYWxzZTtcbn07XG4vKipcbiogQ2hlY2tzIGlmIHRoZSBgcnVsZWAgaXMgKip2YWxpZCoqIEFkR3VhcmQgcmVkaXJlY3QgcmVzb3VyY2UgcnVsZVxuKiBAcGFyYW0ge3N0cmluZ30gcnVsZSAtIHJ1bGUgdGV4dFxuKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiovXG5cblxudmFyIGlzVmFsaWRBZGdSZWRpcmVjdFJ1bGUgPSBmdW5jdGlvbiBpc1ZhbGlkQWRnUmVkaXJlY3RSdWxlKHJ1bGUpIHtcbiAgcmV0dXJuIGlzUmVkaXJlY3RSdWxlQnlUeXBlKHJ1bGUsICdWQUxJRF9BREcnKTtcbn07XG4vKipcbiogQ2hlY2tzIGlmIHRoZSBBZEd1YXJkIHJlZGlyZWN0IGBydWxlYCBoYXMgVWJvIGFuYWxvZy4gTmVlZGVkIGZvciBBZGctPlVibyBjb252ZXJzaW9uXG4qIEBwYXJhbSB7c3RyaW5nfSBydWxlIC0gQWRHdWFyZCBydWxlIHRleHRcbiogQHJldHVybnMge2Jvb2xlYW59IC0gdHJ1ZSBpZiB0aGUgcnVsZSBjYW4gYmUgY29udmVydGVkIHRvIFVib1xuKi9cblxuXG52YXIgaXNBZGdSZWRpcmVjdENvbXBhdGlibGVXaXRoVWJvID0gZnVuY3Rpb24gaXNBZGdSZWRpcmVjdENvbXBhdGlibGVXaXRoVWJvKHJ1bGUpIHtcbiAgcmV0dXJuIGlzQWRnUmVkaXJlY3RSdWxlKHJ1bGUpICYmIGlzUmVkaXJlY3RSdWxlQnlUeXBlKHJ1bGUsICdBREcnKTtcbn07XG4vKipcbiogQ2hlY2tzIGlmIHRoZSBVYm8gcmVkaXJlY3QgYHJ1bGVgIGhhcyBBZEd1YXJkIGFuYWxvZy4gTmVlZGVkIGZvciBVYm8tPkFkZyBjb252ZXJzaW9uXG4qIEBwYXJhbSB7c3RyaW5nfSBydWxlIC0gVWJvIHJ1bGUgdGV4dFxuKiBAcmV0dXJucyB7Ym9vbGVhbn0gLSB0cnVlIGlmIHRoZSBydWxlIGNhbiBiZSBjb252ZXJ0ZWQgdG8gQWRHdWFyZFxuKi9cblxuXG52YXIgaXNVYm9SZWRpcmVjdENvbXBhdGlibGVXaXRoQWRnID0gZnVuY3Rpb24gaXNVYm9SZWRpcmVjdENvbXBhdGlibGVXaXRoQWRnKHJ1bGUpIHtcbiAgcmV0dXJuIGlzUmVkaXJlY3RSdWxlQnlUeXBlKHJ1bGUsICdVQk8nKTtcbn07XG4vKipcbiogQ2hlY2tzIGlmIHRoZSBBYnAgcmVkaXJlY3QgYHJ1bGVgIGhhcyBBZEd1YXJkIGFuYWxvZy4gTmVlZGVkIGZvciBBYnAtPkFkZyBjb252ZXJzaW9uXG4qIEBwYXJhbSB7c3RyaW5nfSBydWxlIC0gQWJwIHJ1bGUgdGV4dFxuKiBAcmV0dXJucyB7Ym9vbGVhbn0gLSB0cnVlIGlmIHRoZSBydWxlIGNhbiBiZSBjb252ZXJ0ZWQgdG8gQWRHdWFyZFxuKi9cblxuXG52YXIgaXNBYnBSZWRpcmVjdENvbXBhdGlibGVXaXRoQWRnID0gZnVuY3Rpb24gaXNBYnBSZWRpcmVjdENvbXBhdGlibGVXaXRoQWRnKHJ1bGUpIHtcbiAgcmV0dXJuIGlzUmVkaXJlY3RSdWxlQnlUeXBlKHJ1bGUsICdBQlAnKTtcbn07XG4vKipcbiAqIENoZWNrcyBpZiB0aGUgcnVsZSBoYXMgc3BlY2lmaWVkIGNvbnRlbnQgdHlwZSBiZWZvcmUgQWRnIC0+IFVibyBjb252ZXJzaW9uLlxuICpcbiAqIFVzZWQgT05MWSBmb3IgQWRnIC0+IFVibyBjb252ZXJzaW9uXG4gKiBiZWNhdXNlIFVibyByZWRpcmVjdCBydWxlcyBtdXN0IGNvbnRhaW4gY29udGVudCB0eXBlLCBidXQgQWRnIGFuZCBBYnAgbXVzdCBub3QuXG4gKlxuICogQWxzbyBzb3VyY2UgdHlwZSBjYW4gbm90IGJlIGFkZGVkIGF1dG9tYXRpY2FsbHkgYmVjYXVzZSBvZiBzdWNoIHZhbGlkIHJ1bGVzOlxuICogISBBYnA6XG4gKiAkcmV3cml0ZT1hYnAtcmVzb3VyY2U6YmxhbmstanMseG1saHR0cHJlcXVlc3RcbiAqICEgQWRnOlxuICogJHNjcmlwdCxyZWRpcmVjdD1ub29wdmFzdC0yLjBcbiAqICR4bWxodHRwcmVxdWVzdCxyZWRpcmVjdD1ub29wdmFzdC0yLjBcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcnVsZVxuICogQHJldHVybnMge2Jvb2xlYW59XG4gKi9cblxuXG52YXIgaGFzVmFsaWRDb250ZW50VHlwZSA9IGZ1bmN0aW9uIGhhc1ZhbGlkQ29udGVudFR5cGUocnVsZSkge1xuICB2YXIgcnVsZU1vZGlmaWVycyA9IHBhcnNlTW9kaWZpZXJzKHJ1bGUpOyAvLyBydWxlIGNhbiBoYXZlIG1vcmUgdGhhbiBvbmUgc291cmNlIHR5cGUgbW9kaWZpZXJcblxuICB2YXIgc291cmNlVHlwZXMgPSBydWxlTW9kaWZpZXJzLmZpbHRlcihmdW5jdGlvbiAoZWwpIHtcbiAgICByZXR1cm4gVkFMSURfU09VUkNFX1RZUEVTLmluZGV4T2YoZWwpID4gLTE7XG4gIH0pO1xuICB2YXIgaXNTb3VyY2VUeXBlU3BlY2lmaWVkID0gc291cmNlVHlwZXMubGVuZ3RoID4gMDtcbiAgdmFyIGlzRW1wdHlSZWRpcmVjdCA9IHJ1bGVNb2RpZmllcnMuaW5kZXhPZihcIlwiLmNvbmNhdChBREdfVUJPX1JFRElSRUNUX01BUktFUikuY29uY2F0KEVNUFRZX1JFRElSRUNUX01BUktFUikpID4gLTE7XG5cbiAgaWYgKGlzRW1wdHlSZWRpcmVjdCkge1xuICAgIC8vIG5vIHNvdXJjZSB0eXBlIGZvciAnZW1wdHknIGlzIGFsbG93ZWRcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIHJldHVybiBpc1NvdXJjZVR5cGVTcGVjaWZpZWQ7XG59O1xuXG52YXIgdmFsaWRhdG9yID0ge1xuICBVQk9fU0NSSVBUTEVUX01BU0tfUkVHOiBVQk9fU0NSSVBUTEVUX01BU0tfUkVHLFxuICBBQlBfU0NSSVBUTEVUX01BU0s6IEFCUF9TQ1JJUFRMRVRfTUFTSyxcbiAgQUJQX1NDUklQVExFVF9FWENFUFRJT05fTUFTSzogQUJQX1NDUklQVExFVF9FWENFUFRJT05fTUFTSyxcbiAgaXNDb21tZW50OiBpc0NvbW1lbnQsXG4gIGlzQWRnU2NyaXB0bGV0UnVsZTogaXNBZGdTY3JpcHRsZXRSdWxlLFxuICBpc1Vib1NjcmlwdGxldFJ1bGU6IGlzVWJvU2NyaXB0bGV0UnVsZSxcbiAgaXNBYnBTbmlwcGV0UnVsZTogaXNBYnBTbmlwcGV0UnVsZSxcbiAgZ2V0U2NyaXB0bGV0QnlOYW1lOiBnZXRTY3JpcHRsZXRCeU5hbWUsXG4gIGlzVmFsaWRTY3JpcHRsZXROYW1lOiBpc1ZhbGlkU2NyaXB0bGV0TmFtZSxcbiAgUkVESVJFQ1RfUlVMRV9UWVBFUzogUkVESVJFQ1RfUlVMRV9UWVBFUyxcbiAgQUJTRU5UX1NPVVJDRV9UWVBFX1JFUExBQ0VNRU5UOiBBQlNFTlRfU09VUkNFX1RZUEVfUkVQTEFDRU1FTlQsXG4gIGlzQWRnUmVkaXJlY3RSdWxlOiBpc0FkZ1JlZGlyZWN0UnVsZSxcbiAgaXNWYWxpZEFkZ1JlZGlyZWN0UnVsZTogaXNWYWxpZEFkZ1JlZGlyZWN0UnVsZSxcbiAgaXNBZGdSZWRpcmVjdENvbXBhdGlibGVXaXRoVWJvOiBpc0FkZ1JlZGlyZWN0Q29tcGF0aWJsZVdpdGhVYm8sXG4gIGlzVWJvUmVkaXJlY3RDb21wYXRpYmxlV2l0aEFkZzogaXNVYm9SZWRpcmVjdENvbXBhdGlibGVXaXRoQWRnLFxuICBpc0FicFJlZGlyZWN0Q29tcGF0aWJsZVdpdGhBZGc6IGlzQWJwUmVkaXJlY3RDb21wYXRpYmxlV2l0aEFkZyxcbiAgcGFyc2VNb2RpZmllcnM6IHBhcnNlTW9kaWZpZXJzLFxuICBnZXRSZWRpcmVjdE5hbWU6IGdldFJlZGlyZWN0TmFtZSxcbiAgaGFzVmFsaWRDb250ZW50VHlwZTogaGFzVmFsaWRDb250ZW50VHlwZVxufTtcblxuZnVuY3Rpb24gX2FycmF5TGlrZVRvQXJyYXkoYXJyLCBsZW4pIHtcbiAgaWYgKGxlbiA9PSBudWxsIHx8IGxlbiA+IGFyci5sZW5ndGgpIGxlbiA9IGFyci5sZW5ndGg7XG5cbiAgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkobGVuKTsgaSA8IGxlbjsgaSsrKSB7XG4gICAgYXJyMltpXSA9IGFycltpXTtcbiAgfVxuXG4gIHJldHVybiBhcnIyO1xufVxuXG52YXIgYXJyYXlMaWtlVG9BcnJheSA9IF9hcnJheUxpa2VUb0FycmF5O1xuXG5mdW5jdGlvbiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB7XG4gIGlmIChBcnJheS5pc0FycmF5KGFycikpIHJldHVybiBhcnJheUxpa2VUb0FycmF5KGFycik7XG59XG5cbnZhciBhcnJheVdpdGhvdXRIb2xlcyA9IF9hcnJheVdpdGhvdXRIb2xlcztcblxuZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheShpdGVyKSB7XG4gIGlmICh0eXBlb2YgU3ltYm9sICE9PSBcInVuZGVmaW5lZFwiICYmIFN5bWJvbC5pdGVyYXRvciBpbiBPYmplY3QoaXRlcikpIHJldHVybiBBcnJheS5mcm9tKGl0ZXIpO1xufVxuXG52YXIgaXRlcmFibGVUb0FycmF5ID0gX2l0ZXJhYmxlVG9BcnJheTtcblxuZnVuY3Rpb24gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8sIG1pbkxlbikge1xuICBpZiAoIW8pIHJldHVybjtcbiAgaWYgKHR5cGVvZiBvID09PSBcInN0cmluZ1wiKSByZXR1cm4gYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pO1xuICB2YXIgbiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvKS5zbGljZSg4LCAtMSk7XG4gIGlmIChuID09PSBcIk9iamVjdFwiICYmIG8uY29uc3RydWN0b3IpIG4gPSBvLmNvbnN0cnVjdG9yLm5hbWU7XG4gIGlmIChuID09PSBcIk1hcFwiIHx8IG4gPT09IFwiU2V0XCIpIHJldHVybiBBcnJheS5mcm9tKG8pO1xuICBpZiAobiA9PT0gXCJBcmd1bWVudHNcIiB8fCAvXig/OlVpfEkpbnQoPzo4fDE2fDMyKSg/OkNsYW1wZWQpP0FycmF5JC8udGVzdChuKSkgcmV0dXJuIGFycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTtcbn1cblxudmFyIHVuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5ID0gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5O1xuXG5mdW5jdGlvbiBfbm9uSXRlcmFibGVTcHJlYWQoKSB7XG4gIHRocm93IG5ldyBUeXBlRXJyb3IoXCJJbnZhbGlkIGF0dGVtcHQgdG8gc3ByZWFkIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cXG5JbiBvcmRlciB0byBiZSBpdGVyYWJsZSwgbm9uLWFycmF5IG9iamVjdHMgbXVzdCBoYXZlIGEgW1N5bWJvbC5pdGVyYXRvcl0oKSBtZXRob2QuXCIpO1xufVxuXG52YXIgbm9uSXRlcmFibGVTcHJlYWQgPSBfbm9uSXRlcmFibGVTcHJlYWQ7XG5cbmZ1bmN0aW9uIF90b0NvbnN1bWFibGVBcnJheShhcnIpIHtcbiAgcmV0dXJuIGFycmF5V2l0aG91dEhvbGVzKGFycikgfHwgaXRlcmFibGVUb0FycmF5KGFycikgfHwgdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkoYXJyKSB8fCBub25JdGVyYWJsZVNwcmVhZCgpO1xufVxuXG52YXIgdG9Db25zdW1hYmxlQXJyYXkgPSBfdG9Db25zdW1hYmxlQXJyYXk7XG5cbmZ1bmN0aW9uIF9hcnJheVdpdGhIb2xlcyhhcnIpIHtcbiAgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIGFycjtcbn1cblxudmFyIGFycmF5V2l0aEhvbGVzID0gX2FycmF5V2l0aEhvbGVzO1xuXG5mdW5jdGlvbiBfbm9uSXRlcmFibGVSZXN0KCkge1xuICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiSW52YWxpZCBhdHRlbXB0IHRvIGRlc3RydWN0dXJlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cXG5JbiBvcmRlciB0byBiZSBpdGVyYWJsZSwgbm9uLWFycmF5IG9iamVjdHMgbXVzdCBoYXZlIGEgW1N5bWJvbC5pdGVyYXRvcl0oKSBtZXRob2QuXCIpO1xufVxuXG52YXIgbm9uSXRlcmFibGVSZXN0ID0gX25vbkl0ZXJhYmxlUmVzdDtcblxuZnVuY3Rpb24gX3RvQXJyYXkoYXJyKSB7XG4gIHJldHVybiBhcnJheVdpdGhIb2xlcyhhcnIpIHx8IGl0ZXJhYmxlVG9BcnJheShhcnIpIHx8IHVuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KGFycikgfHwgbm9uSXRlcmFibGVSZXN0KCk7XG59XG5cbnZhciB0b0FycmF5ID0gX3RvQXJyYXk7XG5cbi8qKlxuICogQWRHdWFyZCBzY3JpcHRsZXQgcnVsZVxuICovXG5cbnZhciBBREdVQVJEX1NDUklQVExFVF9NQVNLX1JFRyA9IC8jQD8lI1xcL1xcL3NjcmlwdGxldFxcKC4rXFwpLzsgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXRlbXBsYXRlLWN1cmx5LWluLXN0cmluZ1xuXG52YXIgQURHVUFSRF9TQ1JJUFRMRVRfVEVNUExBVEUgPSAnJHtkb21haW5zfSMlIy8vc2NyaXB0bGV0KCR7YXJnc30pJzsgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXRlbXBsYXRlLWN1cmx5LWluLXN0cmluZ1xuXG52YXIgQURHVUFSRF9TQ1JJUFRMRVRfRVhDRVBUSU9OX1RFTVBMQVRFID0gJyR7ZG9tYWluc30jQCUjLy9zY3JpcHRsZXQoJHthcmdzfSknO1xuLyoqXG4gKiB1QmxvY2sgc2NyaXB0bGV0IHJ1bGUgbWFza1xuICovXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdGVtcGxhdGUtY3VybHktaW4tc3RyaW5nXG5cbnZhciBVQk9fU0NSSVBUTEVUX1RFTVBMQVRFID0gJyR7ZG9tYWluc30jIytqcygke2FyZ3N9KSc7IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby10ZW1wbGF0ZS1jdXJseS1pbi1zdHJpbmdcblxudmFyIFVCT19TQ1JJUFRMRVRfRVhDRVBUSU9OX1RFTVBMQVRFID0gJyR7ZG9tYWluc30jQCMranMoJHthcmdzfSknO1xudmFyIFVCT19BTElBU19OQU1FX01BUktFUiA9ICd1Ym8tJztcbnZhciBVQk9fU0NSSVBUTEVUX0pTX0VORElORyA9ICcuanMnOyAvLyBodHRwczovL2dpdGh1Yi5jb20vZ29yaGlsbC91QmxvY2svd2lraS9TdGF0aWMtZmlsdGVyLXN5bnRheCN4aHJcblxudmFyIFVCT19YSFJfVFlQRSA9ICd4aHInO1xudmFyIEFER19YSFJfVFlQRSA9ICd4bWxodHRwcmVxdWVzdCc7XG52YXIgQURHX1NFVF9DT05TVEFOVF9OQU1FID0gJ3NldC1jb25zdGFudCc7XG52YXIgQURHX1NFVF9DT05TVEFOVF9FTVBUWV9TVFJJTkcgPSAnJztcbnZhciBVQk9fU0VUX0NPTlNUQU5UX0VNUFRZX1NUUklORyA9ICdcXCdcXCcnO1xudmFyIEFER19QUkVWRU5UX0ZFVENIX05BTUUgPSAncHJldmVudC1mZXRjaCc7XG52YXIgQURHX1BSRVZFTlRfRkVUQ0hfRU1QVFlfU1RSSU5HID0gJyc7XG52YXIgQURHX1BSRVZFTlRfRkVUQ0hfV0lMRENBUkQgPSBnZXRXaWxkY2FyZFN5bWJvbCgpO1xudmFyIFVCT19OT19GRVRDSF9JRl9XSUxEQ0FSRCA9ICcvXi8nO1xudmFyIEVTQ0FQRURfQ09NTUFfU0VQQVJBVE9SID0gJ1xcXFwsJztcbnZhciBDT01NQV9TRVBBUkFUT1IgPSAnLCc7XG52YXIgTUFYX1JFTU9WRV9BVFRSX0NMQVNTX0FSR1NfQ09VTlQgPSAzO1xudmFyIFJFTU9WRV9BVFRSX01FVEhPRCA9ICdyZW1vdmVBdHRyJztcbnZhciBSRU1PVkVfQ0xBU1NfTUVUSE9EID0gJ3JlbW92ZUNsYXNzJztcbnZhciBSRU1PVkVfQVRUUl9BTElBU0VTID0gc2NyaXB0bGV0TGlzdFtSRU1PVkVfQVRUUl9NRVRIT0RdLm5hbWVzO1xudmFyIFJFTU9WRV9DTEFTU19BTElBU0VTID0gc2NyaXB0bGV0TGlzdFtSRU1PVkVfQ0xBU1NfTUVUSE9EXS5uYW1lcztcbnZhciBBREdfUkVNT1ZFX0FUVFJfTkFNRSA9IFJFTU9WRV9BVFRSX0FMSUFTRVNbMF07XG52YXIgQURHX1JFTU9WRV9DTEFTU19OQU1FID0gUkVNT1ZFX0NMQVNTX0FMSUFTRVNbMF07XG4vKipcbiAqIFJldHVybnMgYXJyYXkgb2Ygc3RyaW5ncyBzZXBhcmF0ZWQgYnkgc3BhY2Ugd2hpY2ggbm90IGluIHF1b3Rlc1xuICogQHBhcmFtIHtzdHJpbmd9IHN0clxuICovXG5cbnZhciBnZXRTZW50ZW5jZXMgPSBmdW5jdGlvbiBnZXRTZW50ZW5jZXMoc3RyKSB7XG4gIHZhciByZWcgPSAvJy4qPyd8XCIuKj9cInxcXFMrL2c7XG4gIHJldHVybiBzdHIubWF0Y2gocmVnKTtcbn07XG4vKipcbiAqIFJlcGxhY2VzIHN0cmluZyB3aXRoIGRhdGEgYnkgcGxhY2Vob2xkZXJzXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RyXG4gKiBAcGFyYW0ge09iamVjdH0gZGF0YSAtIHdoZXJlIGtleXMgYXJlIHBsYWNlaG9sZGVycyBuYW1lc1xuICovXG5cblxudmFyIHJlcGxhY2VQbGFjZWhvbGRlcnMgPSBmdW5jdGlvbiByZXBsYWNlUGxhY2Vob2xkZXJzKHN0ciwgZGF0YSkge1xuICByZXR1cm4gT2JqZWN0LmtleXMoZGF0YSkucmVkdWNlKGZ1bmN0aW9uIChhY2MsIGtleSkge1xuICAgIHZhciByZWcgPSBuZXcgUmVnRXhwKFwiXFxcXCRcXFxce1wiLmNvbmNhdChrZXksIFwiXFxcXH1cIiksICdnJyk7XG4gICAgYWNjID0gYWNjLnJlcGxhY2UocmVnLCBkYXRhW2tleV0pO1xuICAgIHJldHVybiBhY2M7XG4gIH0sIHN0cik7XG59O1xuLyoqXG4gKiBDb252ZXJ0cyBzdHJpbmcgb2YgVUJPIHNjcmlwdGxldCBydWxlIHRvIEFkR3VhcmQgc2NyaXRsZXQgcnVsZVxuICogQHBhcmFtIHtzdHJpbmd9IHJ1bGUgLSBVQk8gc2NyaXB0bGV0IHJ1bGVcbiAqIEByZXR1cm5zIHtBcnJheX0gLSBhcnJheSB3aXRoIG9uZSBBZEd1YXJkIHNjcmlwdGxldCBydWxlXG4gKi9cblxuXG52YXIgY29udmVydFVib1NjcmlwdGxldFRvQWRnID0gZnVuY3Rpb24gY29udmVydFVib1NjcmlwdGxldFRvQWRnKHJ1bGUpIHtcbiAgdmFyIGRvbWFpbnMgPSBnZXRCZWZvcmVSZWdFeHAocnVsZSwgdmFsaWRhdG9yLlVCT19TQ1JJUFRMRVRfTUFTS19SRUcpO1xuICB2YXIgbWFzayA9IHJ1bGUubWF0Y2godmFsaWRhdG9yLlVCT19TQ1JJUFRMRVRfTUFTS19SRUcpWzBdO1xuICB2YXIgdGVtcGxhdGU7XG5cbiAgaWYgKG1hc2suaW5kZXhPZignQCcpID4gLTEpIHtcbiAgICB0ZW1wbGF0ZSA9IEFER1VBUkRfU0NSSVBUTEVUX0VYQ0VQVElPTl9URU1QTEFURTtcbiAgfSBlbHNlIHtcbiAgICB0ZW1wbGF0ZSA9IEFER1VBUkRfU0NSSVBUTEVUX1RFTVBMQVRFO1xuICB9XG5cbiAgdmFyIHBhcnNlZEFyZ3MgPSBnZXRTdHJpbmdJbkJyYWNlcyhydWxlKS5zcGxpdCgvLFxccy9nKTtcblxuICBpZiAocGFyc2VkQXJncy5sZW5ndGggPT09IDEpIHtcbiAgICAvLyBNb3N0IHByb2JhYmx5IHRoaXMgaXMgbm90IGNvcnJlY3Qgc2VwYXJhdG9yLCBpbiB0aGlzIGNhc2Ugd2UgdXNlICcsJ1xuICAgIHBhcnNlZEFyZ3MgPSBnZXRTdHJpbmdJbkJyYWNlcyhydWxlKS5zcGxpdCgvLC9nKTtcbiAgfVxuXG4gIHZhciBzY3JpcHRsZXROYW1lID0gcGFyc2VkQXJnc1swXS5pbmRleE9mKFVCT19TQ1JJUFRMRVRfSlNfRU5ESU5HKSA+IC0xID8gXCJ1Ym8tXCIuY29uY2F0KHBhcnNlZEFyZ3NbMF0pIDogXCJ1Ym8tXCIuY29uY2F0KHBhcnNlZEFyZ3NbMF0pLmNvbmNhdChVQk9fU0NSSVBUTEVUX0pTX0VORElORyk7XG5cbiAgaWYgKChSRU1PVkVfQVRUUl9BTElBU0VTLmluZGV4T2Yoc2NyaXB0bGV0TmFtZSkgPiAtMSB8fCBSRU1PVkVfQ0xBU1NfQUxJQVNFUy5pbmRleE9mKHNjcmlwdGxldE5hbWUpID4gLTEpICYmIHBhcnNlZEFyZ3MubGVuZ3RoID4gTUFYX1JFTU9WRV9BVFRSX0NMQVNTX0FSR1NfQ09VTlQpIHtcbiAgICBwYXJzZWRBcmdzID0gW3BhcnNlZEFyZ3NbMF0sIHBhcnNlZEFyZ3NbMV0sIC8vIGlmIHRoZXJlIGFyZSBtb3JlIHRoYW4gMyBhcmdzIGZvciByZW1vdmUtYXR0ci9jbGFzcyBzY3JpcHRsZXQsXG4gICAgLy8gdWJvIHJ1bGUgaGFzIG1hbHRpcGxlIHNlbGVjdG9yIHNlcGFyYXRlZCBieSBjb21tYS4gc28gd2Ugc2hvdWxkOlxuICAgIC8vIDEuIGpvaW4gdGhlbSBpbnRvIGEgc2luZ2xlIHN0cmluZ1xuICAgIC8vIDIuIHJlcGxhY2UgZXNjYXBlZCBjb21tYXMgYnkgcmVndWxhciBvbmVzXG4gICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL0FkZ3VhcmRUZWFtL1NjcmlwdGxldHMvaXNzdWVzLzEzM1xuICAgIHJlcGxhY2VBbGwocGFyc2VkQXJncy5zbGljZSgyKS5qb2luKFwiXCIuY29uY2F0KENPTU1BX1NFUEFSQVRPUiwgXCIgXCIpKSwgRVNDQVBFRF9DT01NQV9TRVBBUkFUT1IsIENPTU1BX1NFUEFSQVRPUildO1xuICB9XG5cbiAgdmFyIGFyZ3MgPSBwYXJzZWRBcmdzLm1hcChmdW5jdGlvbiAoYXJnLCBpbmRleCkge1xuICAgIHZhciBvdXRwdXRBcmcgPSBhcmc7XG5cbiAgICBpZiAoaW5kZXggPT09IDApIHtcbiAgICAgIG91dHB1dEFyZyA9IHNjcmlwdGxldE5hbWU7XG4gICAgfSAvLyBmb3IgZXhhbXBsZTogZHJhbWFzZXJpYWwueHl6IyMranMoYWJvcnQtY3VycmVudC1pbmxpbmUtc2NyaXB0LCAkLCBwb3B1cClcblxuXG4gICAgaWYgKGFyZyA9PT0gJyQnKSB7XG4gICAgICBvdXRwdXRBcmcgPSAnJCQnO1xuICAgIH1cblxuICAgIHJldHVybiBvdXRwdXRBcmc7XG4gIH0pLm1hcChmdW5jdGlvbiAoYXJnKSB7XG4gICAgcmV0dXJuIHdyYXBJblNpbmdsZVF1b3RlcyhhcmcpO1xuICB9KS5qb2luKFwiXCIuY29uY2F0KENPTU1BX1NFUEFSQVRPUiwgXCIgXCIpKTtcbiAgdmFyIGFkZ1J1bGUgPSByZXBsYWNlUGxhY2Vob2xkZXJzKHRlbXBsYXRlLCB7XG4gICAgZG9tYWluczogZG9tYWlucyxcbiAgICBhcmdzOiBhcmdzXG4gIH0pO1xuICByZXR1cm4gW2FkZ1J1bGVdO1xufTtcbi8qKlxuICogQ29udmVydCBzdHJpbmcgb2YgQUJQIHNuaXBwZXQgcnVsZSB0byBBZEd1YXJkIHNjcml0bGV0IHJ1bGVcbiAqIEBwYXJhbSB7c3RyaW5nfSBydWxlIC0gQUJQIHNuaXBwZXQgcnVsZVxuICogQHJldHVybnMge0FycmF5fSAtIGFycmF5IG9mIEFkR3VhcmQgc2NyaXB0bGV0IHJ1bGVzIC1cbiAqIG9uZSBvciBmZXcgaXRlbXMgZGVwZW5kcyBvbiBBYnAtcnVsZVxuICovXG5cbnZhciBjb252ZXJ0QWJwU25pcHBldFRvQWRnID0gZnVuY3Rpb24gY29udmVydEFicFNuaXBwZXRUb0FkZyhydWxlKSB7XG4gIHZhciBTRU1JQ09MT05fRElWSURFUiA9IC87KD89KD86KD86W15cIl0qXCIpezJ9KSpbXlwiXSokKS9nO1xuICB2YXIgbWFzayA9IHJ1bGUuaW5kZXhPZih2YWxpZGF0b3IuQUJQX1NDUklQVExFVF9NQVNLKSA+IC0xID8gdmFsaWRhdG9yLkFCUF9TQ1JJUFRMRVRfTUFTSyA6IHZhbGlkYXRvci5BQlBfU0NSSVBUTEVUX0VYQ0VQVElPTl9NQVNLO1xuICB2YXIgdGVtcGxhdGUgPSBtYXNrID09PSB2YWxpZGF0b3IuQUJQX1NDUklQVExFVF9NQVNLID8gQURHVUFSRF9TQ1JJUFRMRVRfVEVNUExBVEUgOiBBREdVQVJEX1NDUklQVExFVF9FWENFUFRJT05fVEVNUExBVEU7XG4gIHZhciBkb21haW5zID0gc3Vic3RyaW5nQmVmb3JlKHJ1bGUsIG1hc2spO1xuICB2YXIgYXJncyA9IHN1YnN0cmluZ0FmdGVyKHJ1bGUsIG1hc2spO1xuICByZXR1cm4gYXJncy5zcGxpdChTRU1JQ09MT05fRElWSURFUikubWFwKGZ1bmN0aW9uIChhcmdzKSB7XG4gICAgcmV0dXJuIGdldFNlbnRlbmNlcyhhcmdzKS5maWx0ZXIoZnVuY3Rpb24gKGFyZykge1xuICAgICAgcmV0dXJuIGFyZztcbiAgICB9KS5tYXAoZnVuY3Rpb24gKGFyZywgaW5kZXgpIHtcbiAgICAgIHJldHVybiBpbmRleCA9PT0gMCA/IFwiYWJwLVwiLmNvbmNhdChhcmcpIDogYXJnO1xuICAgIH0pLm1hcChmdW5jdGlvbiAoYXJnKSB7XG4gICAgICByZXR1cm4gd3JhcEluU2luZ2xlUXVvdGVzKGFyZyk7XG4gICAgfSkuam9pbihcIlwiLmNvbmNhdChDT01NQV9TRVBBUkFUT1IsIFwiIFwiKSk7XG4gIH0pLm1hcChmdW5jdGlvbiAoYXJncykge1xuICAgIHJldHVybiByZXBsYWNlUGxhY2Vob2xkZXJzKHRlbXBsYXRlLCB7XG4gICAgICBkb21haW5zOiBkb21haW5zLFxuICAgICAgYXJnczogYXJnc1xuICAgIH0pO1xuICB9KTtcbn07XG4vKipcbiAqIENvbnZlcnRzIHNjcmlwdGxldCBydWxlIHRvIEFkR3VhcmQgb25lXG4gKiBAcGFyYW0ge3N0cmluZ30gcnVsZVxuICogQHJldHVybnMge0FycmF5fSAtIGFycmF5IG9mIEFkR3VhcmQgc2NyaXB0bGV0IHJ1bGVzIC1cbiAqIG9uZSBpdGVtIGZvciBBZGcgYW5kIFVibyBvciBmZXcgaXRlbXMgZm9yIEFicFxuICovXG5cbnZhciBjb252ZXJ0U2NyaXB0bGV0VG9BZGcgPSBmdW5jdGlvbiBjb252ZXJ0U2NyaXB0bGV0VG9BZGcocnVsZSkge1xuICB2YXIgcmVzdWx0O1xuXG4gIGlmICh2YWxpZGF0b3IuaXNVYm9TY3JpcHRsZXRSdWxlKHJ1bGUpKSB7XG4gICAgcmVzdWx0ID0gY29udmVydFVib1NjcmlwdGxldFRvQWRnKHJ1bGUpO1xuICB9IGVsc2UgaWYgKHZhbGlkYXRvci5pc0FicFNuaXBwZXRSdWxlKHJ1bGUpKSB7XG4gICAgcmVzdWx0ID0gY29udmVydEFicFNuaXBwZXRUb0FkZyhydWxlKTtcbiAgfSBlbHNlIGlmICh2YWxpZGF0b3IuaXNBZGdTY3JpcHRsZXRSdWxlKHJ1bGUpIHx8IHZhbGlkYXRvci5pc0NvbW1lbnQocnVsZSkpIHtcbiAgICByZXN1bHQgPSBbcnVsZV07XG4gIH1cblxuICByZXR1cm4gcmVzdWx0O1xufTtcbi8qKlxuICogQ29udmVydHMgVUJPIHNjcmlwdGxldCBydWxlIHRvIEFkR3VhcmQgb25lXG4gKiBAcGFyYW0ge3N0cmluZ30gcnVsZSAtIEFkR3VhcmQgc2NyaXB0bGV0IHJ1bGVcbiAqIEByZXR1cm5zIHtzdHJpbmd9IC0gVUJPIHNjcmlwdGxldCBydWxlXG4gKi9cblxudmFyIGNvbnZlcnRBZGdTY3JpcHRsZXRUb1VibyA9IGZ1bmN0aW9uIGNvbnZlcnRBZGdTY3JpcHRsZXRUb1VibyhydWxlKSB7XG4gIHZhciByZXM7XG5cbiAgaWYgKHZhbGlkYXRvci5pc0FkZ1NjcmlwdGxldFJ1bGUocnVsZSkpIHtcbiAgICB2YXIgX3BhcnNlUnVsZSA9IHBhcnNlUnVsZShydWxlKSxcbiAgICAgICAgcGFyc2VkTmFtZSA9IF9wYXJzZVJ1bGUubmFtZSxcbiAgICAgICAgcGFyc2VkUGFyYW1zID0gX3BhcnNlUnVsZS5hcmdzO1xuXG4gICAgdmFyIHByZXBhcmVkUGFyYW1zOyAvLyBodHRwczovL2dpdGh1Yi5jb20vQWRndWFyZFRlYW0vRmlsdGVyc0NvbXBpbGVyL2lzc3Vlcy8xMDJcblxuICAgIGlmIChwYXJzZWROYW1lID09PSBBREdfU0VUX0NPTlNUQU5UX05BTUUgJiYgcGFyc2VkUGFyYW1zWzFdID09PSBBREdfU0VUX0NPTlNUQU5UX0VNUFRZX1NUUklORykge1xuICAgICAgcHJlcGFyZWRQYXJhbXMgPSBbcGFyc2VkUGFyYW1zWzBdLCBVQk9fU0VUX0NPTlNUQU5UX0VNUFRZX1NUUklOR107XG4gICAgfSBlbHNlIGlmIChwYXJzZWROYW1lID09PSBBREdfUFJFVkVOVF9GRVRDSF9OQU1FIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9BZGd1YXJkVGVhbS9TY3JpcHRsZXRzL2lzc3Vlcy8xMDlcbiAgICAmJiAocGFyc2VkUGFyYW1zWzBdID09PSBBREdfUFJFVkVOVF9GRVRDSF9XSUxEQ0FSRCB8fCBwYXJzZWRQYXJhbXNbMF0gPT09IEFER19QUkVWRU5UX0ZFVENIX0VNUFRZX1NUUklORykpIHtcbiAgICAgIHByZXBhcmVkUGFyYW1zID0gW1VCT19OT19GRVRDSF9JRl9XSUxEQ0FSRF07XG4gICAgfSBlbHNlIGlmICgocGFyc2VkTmFtZSA9PT0gQURHX1JFTU9WRV9BVFRSX05BTUUgfHwgcGFyc2VkTmFtZSA9PT0gQURHX1JFTU9WRV9DTEFTU19OQU1FKSAmJiBwYXJzZWRQYXJhbXNbMV0gJiYgcGFyc2VkUGFyYW1zWzFdLmluZGV4T2YoQ09NTUFfU0VQQVJBVE9SKSA+IC0xKSB7XG4gICAgICBwcmVwYXJlZFBhcmFtcyA9IFtwYXJzZWRQYXJhbXNbMF0sIHJlcGxhY2VBbGwocGFyc2VkUGFyYW1zWzFdLCBDT01NQV9TRVBBUkFUT1IsIEVTQ0FQRURfQ09NTUFfU0VQQVJBVE9SKV07XG4gICAgfSBlbHNlIHtcbiAgICAgIHByZXBhcmVkUGFyYW1zID0gcGFyc2VkUGFyYW1zO1xuICAgIH0gLy8gb2JqZWN0IG9mIG5hbWUgYW5kIGFsaWFzZXMgZm9yIHRoZSBBZGctc2NyaXB0bGV0XG5cblxuICAgIHZhciBhZGdTY3JpcHRsZXRPYmplY3QgPSBPYmplY3Qua2V5cyhzY3JpcHRsZXRMaXN0KS5tYXAoZnVuY3Rpb24gKGVsKSB7XG4gICAgICByZXR1cm4gc2NyaXB0bGV0TGlzdFtlbF07XG4gICAgfSkubWFwKGZ1bmN0aW9uIChzKSB7XG4gICAgICB2YXIgX3MkbmFtZXMgPSB0b0FycmF5KHMubmFtZXMpLFxuICAgICAgICAgIG5hbWUgPSBfcyRuYW1lc1swXSxcbiAgICAgICAgICBhbGlhc2VzID0gX3MkbmFtZXMuc2xpY2UoMSk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIG5hbWU6IG5hbWUsXG4gICAgICAgIGFsaWFzZXM6IGFsaWFzZXNcbiAgICAgIH07XG4gICAgfSkuZmluZChmdW5jdGlvbiAoZWwpIHtcbiAgICAgIHJldHVybiBlbC5uYW1lID09PSBwYXJzZWROYW1lIHx8IGVsLmFsaWFzZXMuaW5kZXhPZihwYXJzZWROYW1lKSA+PSAwO1xuICAgIH0pO1xuICAgIHZhciBhbGlhc2VzID0gYWRnU2NyaXB0bGV0T2JqZWN0LmFsaWFzZXM7XG5cbiAgICBpZiAoYWxpYXNlcy5sZW5ndGggPiAwKSB7XG4gICAgICB2YXIgdWJvQWxpYXMgPSBhZGdTY3JpcHRsZXRPYmplY3QuYWxpYXNlcyAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcmVzdHJpY3RlZC1wcm9wZXJ0aWVzXG4gICAgICAuZmluZChmdW5jdGlvbiAoYWxpYXMpIHtcbiAgICAgICAgcmV0dXJuIGFsaWFzLmluY2x1ZGVzKFVCT19BTElBU19OQU1FX01BUktFUik7XG4gICAgICB9KTtcblxuICAgICAgaWYgKHVib0FsaWFzKSB7XG4gICAgICAgIHZhciBtYXNrID0gcnVsZS5tYXRjaChBREdVQVJEX1NDUklQVExFVF9NQVNLX1JFRylbMF07XG4gICAgICAgIHZhciB0ZW1wbGF0ZTtcblxuICAgICAgICBpZiAobWFzay5pbmRleE9mKCdAJykgPiAtMSkge1xuICAgICAgICAgIHRlbXBsYXRlID0gVUJPX1NDUklQVExFVF9FWENFUFRJT05fVEVNUExBVEU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGVtcGxhdGUgPSBVQk9fU0NSSVBUTEVUX1RFTVBMQVRFO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGRvbWFpbnMgPSBnZXRCZWZvcmVSZWdFeHAocnVsZSwgQURHVUFSRF9TQ1JJUFRMRVRfTUFTS19SRUcpO1xuICAgICAgICB2YXIgdWJvTmFtZSA9IHVib0FsaWFzLnJlcGxhY2UoVUJPX0FMSUFTX05BTUVfTUFSS0VSLCAnJykgLy8gJy5qcycgaW4gdGhlIFVibyBzY3JpcHRsZXQgbmFtZSBjYW4gYmUgb21pdHRlZFxuICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vZ29yaGlsbC91QmxvY2svd2lraS9SZXNvdXJjZXMtTGlicmFyeSNnZW5lcmFsLXB1cnBvc2Utc2NyaXB0bGV0c1xuICAgICAgICAucmVwbGFjZShVQk9fU0NSSVBUTEVUX0pTX0VORElORywgJycpO1xuICAgICAgICB2YXIgYXJncyA9IHByZXBhcmVkUGFyYW1zLmxlbmd0aCA+IDAgPyBcIlwiLmNvbmNhdCh1Ym9OYW1lLCBcIiwgXCIpLmNvbmNhdChwcmVwYXJlZFBhcmFtcy5qb2luKFwiXCIuY29uY2F0KENPTU1BX1NFUEFSQVRPUiwgXCIgXCIpKSkgOiB1Ym9OYW1lO1xuICAgICAgICB2YXIgdWJvUnVsZSA9IHJlcGxhY2VQbGFjZWhvbGRlcnModGVtcGxhdGUsIHtcbiAgICAgICAgICBkb21haW5zOiBkb21haW5zLFxuICAgICAgICAgIGFyZ3M6IGFyZ3NcbiAgICAgICAgfSk7XG4gICAgICAgIHJlcyA9IHVib1J1bGU7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHJlcztcbn07XG4vKipcbiAqIENoZWNrcyB3aGV0aGVyIHRoZSBBREcgc2NyaXB0bGV0IGV4aXN0cyBvciBVQk8vQUJQIHNjcmlwdGxldCBpcyBjb21wYXRpYmxlIHRvIEFER1xuICogQHBhcmFtIHtzdHJpbmd9IGlucHV0IC0gY2FuIGJlIEFERyBvciBVQk8gb3IgQUJQIHNjcmlwdGxldCBydWxlXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAqL1xuXG52YXIgaXNWYWxpZFNjcmlwdGxldFJ1bGUgPSBmdW5jdGlvbiBpc1ZhbGlkU2NyaXB0bGV0UnVsZShpbnB1dCkge1xuICBpZiAoIWlucHV0KSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9IC8vIEFCUCAnaW5wdXQnIHJ1bGUgbWF5IGNvbnRhaW4gbW9yZSB0aGFuIG9uZSBzbmlwcGV0XG5cblxuICB2YXIgcnVsZXNBcnJheSA9IGNvbnZlcnRTY3JpcHRsZXRUb0FkZyhpbnB1dCk7IC8vIGNoZWNraW5nIGlmIGVhY2ggb2YgcGFyc2VkIHNjcmlwdGxldHMgaXMgdmFsaWRcbiAgLy8gaWYgYXQgbGVhc3Qgb25lIG9mIHRoZW0gaXMgbm90IHZhbGlkIC0gd2hvbGUgJ2lucHV0JyBydWxlIGlzIG5vdCB2YWxpZCB0b29cblxuICB2YXIgaXNWYWxpZCA9IHJ1bGVzQXJyYXkuZXZlcnkoZnVuY3Rpb24gKHJ1bGUpIHtcbiAgICB2YXIgcGFyc2VkUnVsZSA9IHBhcnNlUnVsZShydWxlKTtcbiAgICByZXR1cm4gdmFsaWRhdG9yLmlzVmFsaWRTY3JpcHRsZXROYW1lKHBhcnNlZFJ1bGUubmFtZSk7XG4gIH0pO1xuICByZXR1cm4gaXNWYWxpZDtcbn07XG4vKipcbiAqIENvbnZlcnRzIFVibyByZWRpcmVjdCBydWxlIHRvIEFkZyBvbmVcbiAqIEBwYXJhbSB7c3RyaW5nfSBydWxlXG4gKiBAcmV0dXJucyB7c3RyaW5nfVxuICovXG5cbnZhciBjb252ZXJ0VWJvUmVkaXJlY3RUb0FkZyA9IGZ1bmN0aW9uIGNvbnZlcnRVYm9SZWRpcmVjdFRvQWRnKHJ1bGUpIHtcbiAgdmFyIGZpcnN0UGFydE9mUnVsZSA9IHN1YnN0cmluZ0JlZm9yZShydWxlLCAnJCcpO1xuICB2YXIgdWJvTW9kaWZpZXJzID0gdmFsaWRhdG9yLnBhcnNlTW9kaWZpZXJzKHJ1bGUpO1xuICB2YXIgYWRnTW9kaWZpZXJzID0gdWJvTW9kaWZpZXJzLm1hcChmdW5jdGlvbiAoZWwpIHtcbiAgICBpZiAoZWwuaW5kZXhPZih2YWxpZGF0b3IuUkVESVJFQ1RfUlVMRV9UWVBFUy5VQk8ubWFya2VyKSA+IC0xKSB7XG4gICAgICB2YXIgdWJvTmFtZSA9IHN1YnN0cmluZ0FmdGVyKGVsLCB2YWxpZGF0b3IuUkVESVJFQ1RfUlVMRV9UWVBFUy5VQk8ubWFya2VyKTtcbiAgICAgIHZhciBhZGdOYW1lID0gdmFsaWRhdG9yLlJFRElSRUNUX1JVTEVfVFlQRVMuVUJPLmNvbXBhdGliaWxpdHlbdWJvTmFtZV07XG4gICAgICByZXR1cm4gXCJcIi5jb25jYXQodmFsaWRhdG9yLlJFRElSRUNUX1JVTEVfVFlQRVMuQURHLm1hcmtlcikuY29uY2F0KGFkZ05hbWUpO1xuICAgIH1cblxuICAgIGlmIChlbCA9PT0gVUJPX1hIUl9UWVBFKSB7XG4gICAgICByZXR1cm4gQURHX1hIUl9UWVBFO1xuICAgIH1cblxuICAgIHJldHVybiBlbDtcbiAgfSkuam9pbihDT01NQV9TRVBBUkFUT1IpO1xuICByZXR1cm4gXCJcIi5jb25jYXQoZmlyc3RQYXJ0T2ZSdWxlLCBcIiRcIikuY29uY2F0KGFkZ01vZGlmaWVycyk7XG59O1xuLyoqXG4gKiBDb252ZXJ0cyBBYnAgcmVkaXJlY3QgcnVsZSB0byBBZGcgb25lXG4gKiBAcGFyYW0ge3N0cmluZ30gcnVsZVxuICogQHJldHVybnMge3N0cmluZ31cbiAqL1xuXG52YXIgY29udmVydEFicFJlZGlyZWN0VG9BZGcgPSBmdW5jdGlvbiBjb252ZXJ0QWJwUmVkaXJlY3RUb0FkZyhydWxlKSB7XG4gIHZhciBmaXJzdFBhcnRPZlJ1bGUgPSBzdWJzdHJpbmdCZWZvcmUocnVsZSwgJyQnKTtcbiAgdmFyIGFicE1vZGlmaWVycyA9IHZhbGlkYXRvci5wYXJzZU1vZGlmaWVycyhydWxlKTtcbiAgdmFyIGFkZ01vZGlmaWVycyA9IGFicE1vZGlmaWVycy5tYXAoZnVuY3Rpb24gKGVsKSB7XG4gICAgaWYgKGVsLmluZGV4T2YodmFsaWRhdG9yLlJFRElSRUNUX1JVTEVfVFlQRVMuQUJQLm1hcmtlcikgPiAtMSkge1xuICAgICAgdmFyIGFicE5hbWUgPSBzdWJzdHJpbmdBZnRlcihlbCwgdmFsaWRhdG9yLlJFRElSRUNUX1JVTEVfVFlQRVMuQUJQLm1hcmtlcik7XG4gICAgICB2YXIgYWRnTmFtZSA9IHZhbGlkYXRvci5SRURJUkVDVF9SVUxFX1RZUEVTLkFCUC5jb21wYXRpYmlsaXR5W2FicE5hbWVdO1xuICAgICAgcmV0dXJuIFwiXCIuY29uY2F0KHZhbGlkYXRvci5SRURJUkVDVF9SVUxFX1RZUEVTLkFERy5tYXJrZXIpLmNvbmNhdChhZGdOYW1lKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZWw7XG4gIH0pLmpvaW4oQ09NTUFfU0VQQVJBVE9SKTtcbiAgcmV0dXJuIFwiXCIuY29uY2F0KGZpcnN0UGFydE9mUnVsZSwgXCIkXCIpLmNvbmNhdChhZGdNb2RpZmllcnMpO1xufTtcbi8qKlxuICogQ29udmVydHMgcmVkaXJlY3QgcnVsZSB0byBBZEd1YXJkIG9uZVxuICogQHBhcmFtIHtzdHJpbmd9IHJ1bGVcbiAqIEByZXR1cm5zIHtzdHJpbmd9XG4gKi9cblxudmFyIGNvbnZlcnRSZWRpcmVjdFRvQWRnID0gZnVuY3Rpb24gY29udmVydFJlZGlyZWN0VG9BZGcocnVsZSkge1xuICB2YXIgcmVzdWx0O1xuXG4gIGlmICh2YWxpZGF0b3IuaXNVYm9SZWRpcmVjdENvbXBhdGlibGVXaXRoQWRnKHJ1bGUpKSB7XG4gICAgcmVzdWx0ID0gY29udmVydFVib1JlZGlyZWN0VG9BZGcocnVsZSk7XG4gIH0gZWxzZSBpZiAodmFsaWRhdG9yLmlzQWJwUmVkaXJlY3RDb21wYXRpYmxlV2l0aEFkZyhydWxlKSkge1xuICAgIHJlc3VsdCA9IGNvbnZlcnRBYnBSZWRpcmVjdFRvQWRnKHJ1bGUpO1xuICB9IGVsc2UgaWYgKHZhbGlkYXRvci5pc1ZhbGlkQWRnUmVkaXJlY3RSdWxlKHJ1bGUpKSB7XG4gICAgcmVzdWx0ID0gcnVsZTtcbiAgfVxuXG4gIHJldHVybiByZXN1bHQ7XG59O1xuLyoqXG4gKiBDb252ZXJ0cyBBZGcgcmVkaXJlY3QgcnVsZSB0byBVYm8gb25lXG4gKiAxLiBDaGVja3MgaWYgdGhlcmUgaXMgVWJvIGFuYWxvZyBmb3IgQWRnIHJ1bGVcbiAqIDIuIFBhcnNlcyB0aGUgcnVsZSBhbmQgY2hlY2hzIGlmIHRoZXJlIGFyZSBhbnkgc291cmNlIHR5cGUgbW9kaWZpZXJzIHdoaWNoIGFyZSByZXF1aXJlZCBieSBVYm9cbiAqICAgIGFuZCBpZiB0aGVyZSBhcmUgbm8gb25lIHdlIGFkZCBpdCBtYW51YWxseSB0byB0aGUgZW5kLlxuICogICAgU291cmNlIHR5cGVzIGFyZSBjaG9zZW4gYWNjb3JkaW5nIHRvIHJlZGlyZWN0IG5hbWVcbiAqICAgIGUuZy4gfHxhZC5jb21eJHJlZGlyZWN0PTxuYW1lPixpbXBvcnRhbnQgIC0+PiAgfHxhZC5jb21eJHJlZGlyZWN0PTxuYW1lPixpbXBvcnRhbnQsc2NyaXB0XG4gKiAzLiBSZXBsYWNlcyBBZGcgcmVkaXJlY3QgbmFtZSBieSBVYm8gYW5hbG9nXG4gKiBAcGFyYW0ge3N0cmluZ30gcnVsZVxuICogQHJldHVybnMge3N0cmluZ31cbiAqL1xuXG52YXIgY29udmVydEFkZ1JlZGlyZWN0VG9VYm8gPSBmdW5jdGlvbiBjb252ZXJ0QWRnUmVkaXJlY3RUb1VibyhydWxlKSB7XG4gIGlmICghdmFsaWRhdG9yLmlzQWRnUmVkaXJlY3RDb21wYXRpYmxlV2l0aFVibyhydWxlKSkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIlVuYWJsZSB0byBjb252ZXJ0IGZvciB1Qk8gLSB1bnN1cHBvcnRlZCByZWRpcmVjdCBpbiBydWxlOiBcIi5jb25jYXQocnVsZSkpO1xuICB9XG5cbiAgdmFyIGJhc2VQYXJ0ID0gc3Vic3RyaW5nQmVmb3JlKHJ1bGUsICckJyk7XG4gIHZhciBhZGdNb2RpZmllcnMgPSB2YWxpZGF0b3IucGFyc2VNb2RpZmllcnMocnVsZSk7XG4gIHZhciBhZGdSZWRpcmVjdE1vZGlmaWVyID0gYWRnTW9kaWZpZXJzLmZpbmQoZnVuY3Rpb24gKGVsKSB7XG4gICAgcmV0dXJuIGVsLmluZGV4T2YodmFsaWRhdG9yLlJFRElSRUNUX1JVTEVfVFlQRVMuQURHLm1hcmtlcikgPiAtMTtcbiAgfSk7XG4gIHZhciBhZGdSZWRpcmVjdE5hbWUgPSBhZGdSZWRpcmVjdE1vZGlmaWVyLnNsaWNlKHZhbGlkYXRvci5SRURJUkVDVF9SVUxFX1RZUEVTLkFERy5tYXJrZXIubGVuZ3RoKTtcbiAgdmFyIHVib1JlZGlyZWN0TmFtZSA9IHZhbGlkYXRvci5SRURJUkVDVF9SVUxFX1RZUEVTLkFERy5jb21wYXRpYmlsaXR5W2FkZ1JlZGlyZWN0TmFtZV07XG4gIHZhciB1Ym9SZWRpcmVjdE1vZGlmaWVyID0gXCJcIi5jb25jYXQodmFsaWRhdG9yLlJFRElSRUNUX1JVTEVfVFlQRVMuVUJPLm1hcmtlcikuY29uY2F0KHVib1JlZGlyZWN0TmFtZSk7XG5cbiAgaWYgKCF2YWxpZGF0b3IuaGFzVmFsaWRDb250ZW50VHlwZShydWxlKSkge1xuICAgIC8vIGFkZCBtaXNzZWQgc291cmNlIHR5cGVzIGFzIGNvbnRlbnQgdHlwZSBtb2RpZmllcnNcbiAgICB2YXIgc291cmNlVHlwZXNEYXRhID0gdmFsaWRhdG9yLkFCU0VOVF9TT1VSQ0VfVFlQRV9SRVBMQUNFTUVOVC5maW5kKGZ1bmN0aW9uIChlbCkge1xuICAgICAgcmV0dXJuIGVsLk5BTUUgPT09IGFkZ1JlZGlyZWN0TmFtZTtcbiAgICB9KTtcblxuICAgIGlmICh0eXBlb2Ygc291cmNlVHlwZXNEYXRhID09PSAndW5kZWZpbmVkJykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVW5hYmxlIHRvIGNvbnZlcnQgZm9yIHVCTyAtIG5vIHR5cGVzIHRvIGFkZCBmb3Igc3BlY2lmaWMgcmVkaXJlY3QgaW4gcnVsZTogXCIuY29uY2F0KHJ1bGUpKTtcbiAgICB9XG5cbiAgICB2YXIgYWRkaXRpb25Nb2RpZmllcnMgPSBzb3VyY2VUeXBlc0RhdGEuVFlQRVM7XG4gICAgYWRnTW9kaWZpZXJzLnB1c2guYXBwbHkoYWRnTW9kaWZpZXJzLCB0b0NvbnN1bWFibGVBcnJheShhZGRpdGlvbk1vZGlmaWVycykpO1xuICB9XG5cbiAgdmFyIHVib01vZGlmaWVycyA9IGFkZ01vZGlmaWVycy5tYXAoZnVuY3Rpb24gKGVsKSB7XG4gICAgaWYgKGVsID09PSBhZGdSZWRpcmVjdE1vZGlmaWVyKSB7XG4gICAgICByZXR1cm4gdWJvUmVkaXJlY3RNb2RpZmllcjtcbiAgICB9XG5cbiAgICByZXR1cm4gZWw7XG4gIH0pLmpvaW4oQ09NTUFfU0VQQVJBVE9SKTtcbiAgcmV0dXJuIFwiXCIuY29uY2F0KGJhc2VQYXJ0LCBcIiRcIikuY29uY2F0KHVib01vZGlmaWVycyk7XG59O1xuXG4vKipcbiAqIEByZWRpcmVjdCBnb29nbGUtYW5hbHl0aWNzXG4gKlxuICogQGRlc2NyaXB0aW9uXG4gKiBNb2NrcyBHb29nbGUncyBBbmFseXRpY3MgYW5kIFRhZyBNYW5hZ2VyIEFQSXMuXG4gKiBbQ292ZXJzIG9ic29sZXRlIGdvb2dsZXRhZ21hbmFnZXItZ3RtIHJlZGlyZWN0IGZ1bmN0aW9uYWxpdHldKGh0dHBzOi8vZ2l0aHViLmNvbS9BZGd1YXJkVGVhbS9TY3JpcHRsZXRzL2lzc3Vlcy8xMjcpLlxuICpcbiAqIFJlbGF0ZWQgVUJPIHJlZGlyZWN0IHJlc291cmNlOlxuICogaHR0cHM6Ly9naXRodWIuY29tL2dvcmhpbGwvdUJsb2NrL2Jsb2IvOGNkMmExZDI2M2E5NjQyMTQ4N2IzOTA0MGMxZDIzZWIwMTE2OTQ4NC9zcmMvd2ViX2FjY2Vzc2libGVfcmVzb3VyY2VzL2dvb2dsZS1hbmFseXRpY3NfYW5hbHl0aWNzLmpzXG4gKlxuICogKipFeGFtcGxlKipcbiAqIGBgYFxuICogfHxnb29nbGUtYW5hbHl0aWNzLmNvbS9hbmFseXRpY3MuanMkc2NyaXB0LHJlZGlyZWN0PWdvb2dsZS1hbmFseXRpY3NcbiAqIHx8Z29vZ2xldGFnbWFuYWdlci5jb20vZ3RtLmpzJHNjcmlwdCxyZWRpcmVjdD1nb29nbGV0YWdtYW5hZ2VyLWd0bVxuICogYGBgXG4gKi9cblxuZnVuY3Rpb24gR29vZ2xlQW5hbHl0aWNzKHNvdXJjZSkge1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZnVuYy1uYW1lc1xuICB2YXIgVHJhY2tlciA9IGZ1bmN0aW9uIFRyYWNrZXIoKSB7fTsgLy8gY29uc3RydWN0b3JcblxuXG4gIHZhciBwcm90byA9IFRyYWNrZXIucHJvdG90eXBlO1xuICBwcm90by5nZXQgPSBub29wRnVuYztcbiAgcHJvdG8uc2V0ID0gbm9vcEZ1bmM7XG4gIHByb3RvLnNlbmQgPSBub29wRnVuYztcbiAgdmFyIGdvb2dsZUFuYWx5dGljc05hbWUgPSB3aW5kb3cuR29vZ2xlQW5hbHl0aWNzT2JqZWN0IHx8ICdnYSc7IC8vIGEgLS0gZmFrZSBhcmcgZm9yICdnYS5sZW5ndGggPCAxJyBhbnRpYWRibG9jayBjaGVja2luZ1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW51c2VkLXZhcnNcblxuICBmdW5jdGlvbiBnYShhKSB7XG4gICAgdmFyIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7XG5cbiAgICBpZiAobGVuID09PSAwKSB7XG4gICAgICByZXR1cm47XG4gICAgfSAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcHJlZmVyLXJlc3QtcGFyYW1zXG5cblxuICAgIHZhciBsYXN0QXJnID0gYXJndW1lbnRzW2xlbiAtIDFdO1xuICAgIHZhciByZXBsYWNlcjtcblxuICAgIGlmIChsYXN0QXJnIGluc3RhbmNlb2YgT2JqZWN0ICYmIGxhc3RBcmcgIT09IG51bGwgJiYgdHlwZW9mIGxhc3RBcmcuaGl0Q2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIHJlcGxhY2VyID0gbGFzdEFyZy5oaXRDYWxsYmFjaztcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBsYXN0QXJnID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vQWRndWFyZFRlYW0vU2NyaXB0bGV0cy9pc3N1ZXMvOThcbiAgICAgIHJlcGxhY2VyID0gZnVuY3Rpb24gcmVwbGFjZXIoKSB7XG4gICAgICAgIGxhc3RBcmcoZ2EuY3JlYXRlKCkpO1xuICAgICAgfTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgc2V0VGltZW91dChyZXBsYWNlciwgMSk7IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1lbXB0eVxuICAgIH0gY2F0Y2ggKGV4KSB7fVxuICB9XG5cbiAgZ2EuY3JlYXRlID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBuZXcgVHJhY2tlcigpO1xuICB9O1xuXG4gIGdhLmdldEJ5TmFtZSA9IG5vb3BOdWxsO1xuICBnYS5nZXRBbGwgPSBub29wQXJyYXk7XG4gIGdhLnJlbW92ZSA9IG5vb3BGdW5jO1xuICBnYS5sb2FkZWQgPSB0cnVlO1xuICB3aW5kb3dbZ29vZ2xlQW5hbHl0aWNzTmFtZV0gPSBnYTtcbiAgdmFyIF93aW5kb3cgPSB3aW5kb3csXG4gICAgICBkYXRhTGF5ZXIgPSBfd2luZG93LmRhdGFMYXllcixcbiAgICAgIGdvb2dsZV9vcHRpbWl6ZSA9IF93aW5kb3cuZ29vZ2xlX29wdGltaXplOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGNhbWVsY2FzZVxuXG4gIGlmIChkYXRhTGF5ZXIgaW5zdGFuY2VvZiBPYmplY3QgPT09IGZhbHNlKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKGRhdGFMYXllci5oaWRlIGluc3RhbmNlb2YgT2JqZWN0ICYmIHR5cGVvZiBkYXRhTGF5ZXIuaGlkZS5lbmQgPT09ICdmdW5jdGlvbicpIHtcbiAgICBkYXRhTGF5ZXIuaGlkZS5lbmQoKTtcbiAgfVxuXG4gIGlmICh0eXBlb2YgZGF0YUxheWVyLnB1c2ggPT09ICdmdW5jdGlvbicpIHtcbiAgICBkYXRhTGF5ZXIucHVzaCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICBpZiAoZGF0YSBpbnN0YW5jZW9mIE9iamVjdCAmJiB0eXBlb2YgZGF0YS5ldmVudENhbGxiYWNrID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIHNldFRpbWVvdXQoZGF0YS5ldmVudENhbGxiYWNrLCAxKTtcbiAgICAgIH1cbiAgICB9O1xuICB9IC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9BZGd1YXJkVGVhbS9TY3JpcHRsZXRzL2lzc3Vlcy84MVxuXG5cbiAgaWYgKGdvb2dsZV9vcHRpbWl6ZSBpbnN0YW5jZW9mIE9iamVjdCAmJiB0eXBlb2YgZ29vZ2xlX29wdGltaXplLmdldCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgY2FtZWxjYXNlXG4gICAgdmFyIGdvb2dsZU9wdGltaXplV3JhcHBlciA9IHt9O1xuICAgIGdvb2dsZU9wdGltaXplV3JhcHBlci5nZXQgPSBub29wRnVuYztcbiAgICB3aW5kb3cuZ29vZ2xlX29wdGltaXplID0gZ29vZ2xlT3B0aW1pemVXcmFwcGVyO1xuICB9XG5cbiAgaGl0KHNvdXJjZSk7XG59XG5Hb29nbGVBbmFseXRpY3MubmFtZXMgPSBbJ2dvb2dsZS1hbmFseXRpY3MnLCAndWJvLWdvb2dsZS1hbmFseXRpY3NfYW5hbHl0aWNzLmpzJywgJ2dvb2dsZS1hbmFseXRpY3NfYW5hbHl0aWNzLmpzJywgLy8gaHR0cHM6Ly9naXRodWIuY29tL0FkZ3VhcmRUZWFtL1NjcmlwdGxldHMvaXNzdWVzLzEyN1xuJ2dvb2dsZXRhZ21hbmFnZXItZ3RtJywgJ3Viby1nb29nbGV0YWdtYW5hZ2VyX2d0bS5qcycsICdnb29nbGV0YWdtYW5hZ2VyX2d0bS5qcyddO1xuR29vZ2xlQW5hbHl0aWNzLmluamVjdGlvbnMgPSBbaGl0LCBub29wRnVuYywgbm9vcE51bGwsIG5vb3BBcnJheV07XG5cbi8qIGVzbGludC1kaXNhYmxlIG5vLXVuZGVyc2NvcmUtZGFuZ2xlICovXG4vKipcbiAqIEByZWRpcmVjdCBnb29nbGUtYW5hbHl0aWNzLWdhXG4gKlxuICogQGRlc2NyaXB0aW9uXG4gKiBNb2NrcyBvbGQgR29vZ2xlIEFuYWx5dGljcyBBUEkuXG4gKlxuICogUmVsYXRlZCBVQk8gcmVkaXJlY3QgcmVzb3VyY2U6XG4gKiBodHRwczovL2dpdGh1Yi5jb20vZ29yaGlsbC91QmxvY2svYmxvYi9hOTRkZjdmM2IyNzA4MGFlMmRjYjNiOTE0YWNlMzljMGMyOTRkMmY2L3NyYy93ZWJfYWNjZXNzaWJsZV9yZXNvdXJjZXMvZ29vZ2xlLWFuYWx5dGljc19nYS5qc1xuICpcbiAqICoqRXhhbXBsZSoqXG4gKiBgYGBcbiAqIHx8Z29vZ2xlLWFuYWx5dGljcy5jb20vZ2EuanMkc2NyaXB0LHJlZGlyZWN0PWdvb2dsZS1hbmFseXRpY3MtZ2FcbiAqIGBgYFxuICovXG5cbmZ1bmN0aW9uIEdvb2dsZUFuYWx5dGljc0dhKHNvdXJjZSkge1xuICAvLyBHYXEgY29uc3RydWN0b3JcbiAgZnVuY3Rpb24gR2FxKCkge31cblxuICBHYXEucHJvdG90eXBlLk5hID0gbm9vcEZ1bmM7XG4gIEdhcS5wcm90b3R5cGUuTyA9IG5vb3BGdW5jO1xuICBHYXEucHJvdG90eXBlLlNhID0gbm9vcEZ1bmM7XG4gIEdhcS5wcm90b3R5cGUuVGEgPSBub29wRnVuYztcbiAgR2FxLnByb3RvdHlwZS5WYSA9IG5vb3BGdW5jO1xuICBHYXEucHJvdG90eXBlLl9jcmVhdGVBc3luY1RyYWNrZXIgPSBub29wRnVuYztcbiAgR2FxLnByb3RvdHlwZS5fZ2V0QXN5bmNUcmFja2VyID0gbm9vcEZ1bmM7XG4gIEdhcS5wcm90b3R5cGUuX2dldFBsdWdpbiA9IG5vb3BGdW5jO1xuXG4gIEdhcS5wcm90b3R5cGUucHVzaCA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgaWYgKHR5cGVvZiBkYXRhID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICBkYXRhKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKEFycmF5LmlzQXJyYXkoZGF0YSkgPT09IGZhbHNlKSB7XG4gICAgICByZXR1cm47XG4gICAgfSAvLyBodHRwczovL2RldmVsb3BlcnMuZ29vZ2xlLmNvbS9hbmFseXRpY3MvZGV2Z3VpZGVzL2NvbGxlY3Rpb24vZ2Fqcy9tZXRob2RzL2dhSlNBcGlEb21haW5EaXJlY3RvcnkjX2dhdC5HQV9UcmFja2VyXy5fbGlua1xuXG5cbiAgICBpZiAoZGF0YVswXSA9PT0gJ19saW5rJyAmJiB0eXBlb2YgZGF0YVsxXSA9PT0gJ3N0cmluZycpIHtcbiAgICAgIHdpbmRvdy5sb2NhdGlvbi5hc3NpZ24oZGF0YVsxXSk7XG4gICAgfSAvLyBodHRwczovL2dpdGh1Yi5jb20vZ29yaGlsbC91QmxvY2svaXNzdWVzLzIxNjJcblxuXG4gICAgaWYgKGRhdGFbMF0gPT09ICdfc2V0JyAmJiBkYXRhWzFdID09PSAnaGl0Q2FsbGJhY2snICYmIHR5cGVvZiBkYXRhWzJdID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICBkYXRhWzJdKCk7XG4gICAgfVxuICB9O1xuXG4gIHZhciBnYXEgPSBuZXcgR2FxKCk7XG4gIHZhciBhc3luY1RyYWNrZXJzID0gd2luZG93Ll9nYXEgfHwgW107XG5cbiAgaWYgKEFycmF5LmlzQXJyYXkoYXN5bmNUcmFja2VycykpIHtcbiAgICB3aGlsZSAoYXN5bmNUcmFja2Vyc1swXSkge1xuICAgICAgZ2FxLnB1c2goYXN5bmNUcmFja2Vycy5zaGlmdCgpKTtcbiAgICB9XG4gIH0gLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLW11bHRpLWFzc2lnblxuXG5cbiAgd2luZG93Ll9nYXEgPSBnYXEucWYgPSBnYXE7IC8vIEdhdCBjb25zdHJ1Y3RvclxuXG4gIGZ1bmN0aW9uIEdhdCgpIHt9IC8vIE1vY2sgdHJhY2tlciBhcGlcblxuXG4gIHZhciBhcGkgPSBbJ19hZGRJZ25vcmVkT3JnYW5pYycsICdfYWRkSWdub3JlZFJlZicsICdfYWRkSXRlbScsICdfYWRkT3JnYW5pYycsICdfYWRkVHJhbnMnLCAnX2NsZWFySWdub3JlZE9yZ2FuaWMnLCAnX2NsZWFySWdub3JlZFJlZicsICdfY2xlYXJPcmdhbmljJywgJ19jb29raWVQYXRoQ29weScsICdfZGVsZXRlQ3VzdG9tVmFyJywgJ19nZXROYW1lJywgJ19zZXRBY2NvdW50JywgJ19nZXRBY2NvdW50JywgJ19nZXRDbGllbnRJbmZvJywgJ19nZXREZXRlY3RGbGFzaCcsICdfZ2V0RGV0ZWN0VGl0bGUnLCAnX2dldExpbmtlclVybCcsICdfZ2V0TG9jYWxHaWZQYXRoJywgJ19nZXRTZXJ2aWNlTW9kZScsICdfZ2V0VmVyc2lvbicsICdfZ2V0VmlzaXRvckN1c3RvbVZhcicsICdfaW5pdERhdGEnLCAnX2xpbmsnLCAnX2xpbmtCeVBvc3QnLCAnX3NldEFsbG93QW5jaG9yJywgJ19zZXRBbGxvd0hhc2gnLCAnX3NldEFsbG93TGlua2VyJywgJ19zZXRDYW1wQ29udGVudEtleScsICdfc2V0Q2FtcE1lZGl1bUtleScsICdfc2V0Q2FtcE5hbWVLZXknLCAnX3NldENhbXBOT0tleScsICdfc2V0Q2FtcFNvdXJjZUtleScsICdfc2V0Q2FtcFRlcm1LZXknLCAnX3NldENhbXBhaWduQ29va2llVGltZW91dCcsICdfc2V0Q2FtcGFpZ25UcmFjaycsICdfc2V0Q2xpZW50SW5mbycsICdfc2V0Q29va2llUGF0aCcsICdfc2V0Q29va2llUGVyc2lzdGVuY2UnLCAnX3NldENvb2tpZVRpbWVvdXQnLCAnX3NldEN1c3RvbVZhcicsICdfc2V0RGV0ZWN0Rmxhc2gnLCAnX3NldERldGVjdFRpdGxlJywgJ19zZXREb21haW5OYW1lJywgJ19zZXRMb2NhbEdpZlBhdGgnLCAnX3NldExvY2FsUmVtb3RlU2VydmVyTW9kZScsICdfc2V0TG9jYWxTZXJ2ZXJNb2RlJywgJ19zZXRSZWZlcnJlck92ZXJyaWRlJywgJ19zZXRSZW1vdGVTZXJ2ZXJNb2RlJywgJ19zZXRTYW1wbGVSYXRlJywgJ19zZXRTZXNzaW9uVGltZW91dCcsICdfc2V0U2l0ZVNwZWVkU2FtcGxlUmF0ZScsICdfc2V0U2Vzc2lvbkNvb2tpZVRpbWVvdXQnLCAnX3NldFZhcicsICdfc2V0VmlzaXRvckNvb2tpZVRpbWVvdXQnLCAnX3RyYWNrRXZlbnQnLCAnX3RyYWNrUGFnZUxvYWRUaW1lJywgJ190cmFja1BhZ2V2aWV3JywgJ190cmFja1NvY2lhbCcsICdfdHJhY2tUaW1pbmcnLCAnX3RyYWNrVHJhbnMnLCAnX3Zpc2l0Q29kZSddO1xuICB2YXIgdHJhY2tlciA9IGFwaS5yZWR1Y2UoZnVuY3Rpb24gKHJlcywgZnVuY05hbWUpIHtcbiAgICByZXNbZnVuY05hbWVdID0gbm9vcEZ1bmM7XG4gICAgcmV0dXJuIHJlcztcbiAgfSwge30pO1xuXG4gIHRyYWNrZXIuX2dldExpbmtlclVybCA9IGZ1bmN0aW9uIChhKSB7XG4gICAgcmV0dXJuIGE7XG4gIH07XG5cbiAgR2F0LnByb3RvdHlwZS5fYW5vbnltaXplSVAgPSBub29wRnVuYztcbiAgR2F0LnByb3RvdHlwZS5fY3JlYXRlVHJhY2tlciA9IG5vb3BGdW5jO1xuICBHYXQucHJvdG90eXBlLl9mb3JjZVNTTCA9IG5vb3BGdW5jO1xuICBHYXQucHJvdG90eXBlLl9nZXRQbHVnaW4gPSBub29wRnVuYztcblxuICBHYXQucHJvdG90eXBlLl9nZXRUcmFja2VyID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0cmFja2VyO1xuICB9O1xuXG4gIEdhdC5wcm90b3R5cGUuX2dldFRyYWNrZXJCeU5hbWUgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRyYWNrZXI7XG4gIH07XG5cbiAgR2F0LnByb3RvdHlwZS5fZ2V0VHJhY2tlcnMgPSBub29wRnVuYztcbiAgR2F0LnByb3RvdHlwZS5hYSA9IG5vb3BGdW5jO1xuICBHYXQucHJvdG90eXBlLmFiID0gbm9vcEZ1bmM7XG4gIEdhdC5wcm90b3R5cGUuaGIgPSBub29wRnVuYztcbiAgR2F0LnByb3RvdHlwZS5sYSA9IG5vb3BGdW5jO1xuICBHYXQucHJvdG90eXBlLm9hID0gbm9vcEZ1bmM7XG4gIEdhdC5wcm90b3R5cGUucGEgPSBub29wRnVuYztcbiAgR2F0LnByb3RvdHlwZS51ID0gbm9vcEZ1bmM7XG4gIHZhciBnYXQgPSBuZXcgR2F0KCk7XG4gIHdpbmRvdy5fZ2F0ID0gZ2F0O1xuICBoaXQoc291cmNlKTtcbn1cbkdvb2dsZUFuYWx5dGljc0dhLm5hbWVzID0gWydnb29nbGUtYW5hbHl0aWNzLWdhJywgJ3Viby1nb29nbGUtYW5hbHl0aWNzX2dhLmpzJywgJ2dvb2dsZS1hbmFseXRpY3NfZ2EuanMnXTtcbkdvb2dsZUFuYWx5dGljc0dhLmluamVjdGlvbnMgPSBbaGl0LCBub29wRnVuY107XG5cbi8qIGVzbGludC1kaXNhYmxlIG1heC1sZW4gKi9cblxuLyoqXG4gKiBAcmVkaXJlY3QgZ29vZ2xlc3luZGljYXRpb24tYWRzYnlnb29nbGVcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIE1vY2tzIEdvb2dsZSBBZFNlbnNlIEFQSS5cbiAqXG4gKiBSZWxhdGVkIFVCTyByZWRpcmVjdCByZXNvdXJjZTpcbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9nb3JoaWxsL3VCbG9jay9ibG9iL2E5NGRmN2YzYjI3MDgwYWUyZGNiM2I5MTRhY2UzOWMwYzI5NGQyZjYvc3JjL3dlYl9hY2Nlc3NpYmxlX3Jlc291cmNlcy9nb29nbGVzeW5kaWNhdGlvbl9hZHNieWdvb2dsZS5qc1xuICpcbiAqICoqRXhhbXBsZSoqXG4gKiBgYGBcbiAqIHx8cGFnZWFkMi5nb29nbGVzeW5kaWNhdGlvbi5jb20vcGFnZWFkL2pzL2Fkc2J5Z29vZ2xlLmpzJHNjcmlwdCxyZWRpcmVjdD1nb29nbGVzeW5kaWNhdGlvbi1hZHNieWdvb2dsZVxuICogYGBgXG4gKi9cblxuLyogZXNsaW50LWVuYWJsZSBtYXgtbGVuICovXG5cbmZ1bmN0aW9uIEdvb2dsZVN5bmRpY2F0aW9uQWRzQnlHb29nbGUoc291cmNlKSB7XG4gIHdpbmRvdy5hZHNieWdvb2dsZSA9IHtcbiAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vQWRndWFyZFRlYW0vU2NyaXB0bGV0cy9pc3N1ZXMvMTEzXG4gICAgLy8gbGVuZ3RoOiAwLFxuICAgIGxvYWRlZDogdHJ1ZSxcbiAgICBwdXNoOiBmdW5jdGlvbiBwdXNoKCkge1xuICAgICAgaWYgKHR5cGVvZiB0aGlzLmxlbmd0aCA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgdGhpcy5sZW5ndGggPSAwO1xuICAgICAgICB0aGlzLmxlbmd0aCArPSAxO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgdmFyIGFkRWxlbXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuYWRzYnlnb29nbGUnKTtcbiAgdmFyIGNzcyA9ICdoZWlnaHQ6MXB4IWltcG9ydGFudDttYXgtaGVpZ2h0OjFweCFpbXBvcnRhbnQ7bWF4LXdpZHRoOjFweCFpbXBvcnRhbnQ7d2lkdGg6MXB4IWltcG9ydGFudDsnO1xuICB2YXIgc3RhdHVzQXR0ck5hbWUgPSAnZGF0YS1hZHNieWdvb2dsZS1zdGF0dXMnO1xuICB2YXIgQVNXSUZUX0lGUkFNRV9NQVJLRVIgPSAnYXN3aWZ0Xyc7XG4gIHZhciBHT09HTEVfQURTX0lGUkFNRV9NQVJLRVIgPSAnZ29vZ2xlX2Fkc19pZnJhbWVfJztcbiAgdmFyIGV4ZWN1dGVkID0gZmFsc2U7XG5cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBhZEVsZW1zLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgdmFyIGFkRWxlbUNoaWxkTm9kZXMgPSBhZEVsZW1zW2ldLmNoaWxkTm9kZXM7XG4gICAgdmFyIGNoaWxkTm9kZXNRdWFudGl0eSA9IGFkRWxlbUNoaWxkTm9kZXMubGVuZ3RoOyAvLyBjaGlsZE5vZGVzIG9mIC5hZHNieWdvb2dsZSBjYW4gYmUgZGVmaW5lZCBpZiBzY3JpcHRsZXQgd2FzIGV4ZWN1dGVkIGJlZm9yZVxuICAgIC8vIHNvIHdlIHNob3VsZCBjaGVjayBhcmUgdGhhdCBjaGlsZE5vZGVzIGV4YWN0bHkgZGVmaW5lZCBieSB1c1xuICAgIC8vIFRPRE86IHJlbWFrZSBhZnRlciBzY3JpcHRsZXRzIGNvbnRleHQgZGV2ZWxvcGluZyBpbiAxLjNcblxuICAgIHZhciBhcmVJZnJhbWVzRGVmaW5lZCA9IGZhbHNlO1xuXG4gICAgaWYgKGNoaWxkTm9kZXNRdWFudGl0eSA+IDApIHtcbiAgICAgIC8vIGl0IHNob3VsZCBiZSBvbmx5IDIgY2hpbGQgaWZyYW1lcyBpZiBzY3JpcHRsZXQgd2FzIGV4ZWN1dGVkXG4gICAgICBhcmVJZnJhbWVzRGVmaW5lZCA9IGNoaWxkTm9kZXNRdWFudGl0eSA9PT0gMiAvLyB0aGUgZmlyc3Qgb2YgY2hpbGQgbm9kZXMgc2hvdWxkIGJlIGFzd2lmdCBpZnJhbWVcbiAgICAgICYmIGFkRWxlbUNoaWxkTm9kZXNbMF0udGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSAnaWZyYW1lJyAmJiBhZEVsZW1DaGlsZE5vZGVzWzBdLmlkLmluZGV4T2YoQVNXSUZUX0lGUkFNRV9NQVJLRVIpID4gLTEgLy8gdGhlIHNlY29uZCBvZiBjaGlsZCBub2RlcyBzaG91bGQgYmUgZ29vZ2xlX2FkcyBpZnJhbWVcbiAgICAgICYmIGFkRWxlbUNoaWxkTm9kZXNbMV0udGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSAnaWZyYW1lJyAmJiBhZEVsZW1DaGlsZE5vZGVzWzFdLmlkLmluZGV4T2YoR09PR0xFX0FEU19JRlJBTUVfTUFSS0VSKSA+IC0xO1xuICAgIH1cblxuICAgIGlmICghYXJlSWZyYW1lc0RlZmluZWQpIHtcbiAgICAgIC8vIGhlcmUgd2UgZG8gdGhlIGpvYiBpZiBzY3JpcHRsZXQgaGFzIG5vdCBiZWVuIGV4ZWN1dGVkIGVhcmxpZXJcbiAgICAgIGFkRWxlbXNbaV0uc2V0QXR0cmlidXRlKHN0YXR1c0F0dHJOYW1lLCAnZG9uZScpO1xuICAgICAgdmFyIGFzd2lmdElmcmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lmcmFtZScpO1xuICAgICAgYXN3aWZ0SWZyYW1lLmlkID0gXCJcIi5jb25jYXQoQVNXSUZUX0lGUkFNRV9NQVJLRVIpLmNvbmNhdChpKTtcbiAgICAgIGFzd2lmdElmcmFtZS5zdHlsZSA9IGNzcztcbiAgICAgIGFkRWxlbXNbaV0uYXBwZW5kQ2hpbGQoYXN3aWZ0SWZyYW1lKTtcbiAgICAgIHZhciBpbm5lckFzd2lmdElmcmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lmcmFtZScpO1xuICAgICAgYXN3aWZ0SWZyYW1lLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChpbm5lckFzd2lmdElmcmFtZSk7XG4gICAgICB2YXIgZ29vZ2xlYWRzSWZyYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaWZyYW1lJyk7XG4gICAgICBnb29nbGVhZHNJZnJhbWUuaWQgPSBcIlwiLmNvbmNhdChHT09HTEVfQURTX0lGUkFNRV9NQVJLRVIpLmNvbmNhdChpKTtcbiAgICAgIGdvb2dsZWFkc0lmcmFtZS5zdHlsZSA9IGNzcztcbiAgICAgIGFkRWxlbXNbaV0uYXBwZW5kQ2hpbGQoZ29vZ2xlYWRzSWZyYW1lKTtcbiAgICAgIHZhciBpbm5lckdvb2dsZWFkc0lmcmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lmcmFtZScpO1xuICAgICAgZ29vZ2xlYWRzSWZyYW1lLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChpbm5lckdvb2dsZWFkc0lmcmFtZSk7XG4gICAgICBleGVjdXRlZCA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgaWYgKGV4ZWN1dGVkKSB7XG4gICAgaGl0KHNvdXJjZSk7XG4gIH1cbn1cbkdvb2dsZVN5bmRpY2F0aW9uQWRzQnlHb29nbGUubmFtZXMgPSBbJ2dvb2dsZXN5bmRpY2F0aW9uLWFkc2J5Z29vZ2xlJywgJ3Viby1nb29nbGVzeW5kaWNhdGlvbl9hZHNieWdvb2dsZS5qcycsICdnb29nbGVzeW5kaWNhdGlvbl9hZHNieWdvb2dsZS5qcyddO1xuR29vZ2xlU3luZGljYXRpb25BZHNCeUdvb2dsZS5pbmplY3Rpb25zID0gW2hpdF07XG5cbi8qKlxuICogQHJlZGlyZWN0IGdvb2dsZXRhZ3NlcnZpY2VzLWdwdFxuICpcbiAqIEBkZXNjcmlwdGlvblxuICogTW9ja3MgR29vZ2xlIFB1Ymxpc2hlciBUYWcgQVBJLlxuICpcbiAqIFJlbGF0ZWQgVUJPIHJlZGlyZWN0IHJlc291cmNlOlxuICogaHR0cHM6Ly9naXRodWIuY29tL2dvcmhpbGwvdUJsb2NrL2Jsb2IvYTk0ZGY3ZjNiMjcwODBhZTJkY2IzYjkxNGFjZTM5YzBjMjk0ZDJmNi9zcmMvd2ViX2FjY2Vzc2libGVfcmVzb3VyY2VzL2dvb2dsZXRhZ3NlcnZpY2VzX2dwdC5qc1xuICpcbiAqICoqRXhhbXBsZSoqXG4gKiBgYGBcbiAqIHx8Z29vZ2xldGFnc2VydmljZXMuY29tL3RhZy9qcy9ncHQuanMkc2NyaXB0LHJlZGlyZWN0PWdvb2dsZXRhZ3NlcnZpY2VzLWdwdFxuICogYGBgXG4gKi9cblxuZnVuY3Rpb24gR29vZ2xlVGFnU2VydmljZXNHcHQoc291cmNlKSB7XG4gIHZhciBjb21wYW5pb25BZHNTZXJ2aWNlID0ge1xuICAgIGFkZEV2ZW50TGlzdGVuZXI6IG5vb3BUaGlzLFxuICAgIGVuYWJsZVN5bmNMb2FkaW5nOiBub29wRnVuYyxcbiAgICBzZXRSZWZyZXNoVW5maWxsZWRTbG90czogbm9vcEZ1bmNcbiAgfTtcbiAgdmFyIGNvbnRlbnRTZXJ2aWNlID0ge1xuICAgIGFkZEV2ZW50TGlzdGVuZXI6IG5vb3BUaGlzLFxuICAgIHNldENvbnRlbnQ6IG5vb3BGdW5jXG4gIH07XG5cbiAgZnVuY3Rpb24gUGFzc2JhY2tTbG90KCkge30gLy8gY29uc3RydWN0b3JcblxuXG4gIFBhc3NiYWNrU2xvdC5wcm90b3R5cGUuZGlzcGxheSA9IG5vb3BGdW5jO1xuICBQYXNzYmFja1Nsb3QucHJvdG90eXBlLmdldCA9IG5vb3BOdWxsO1xuICBQYXNzYmFja1Nsb3QucHJvdG90eXBlLnNldCA9IG5vb3BUaGlzO1xuICBQYXNzYmFja1Nsb3QucHJvdG90eXBlLnNldENsaWNrVXJsID0gbm9vcFRoaXM7XG4gIFBhc3NiYWNrU2xvdC5wcm90b3R5cGUuc2V0VGFnRm9yQ2hpbGREaXJlY3RlZFRyZWF0bWVudCA9IG5vb3BUaGlzO1xuICBQYXNzYmFja1Nsb3QucHJvdG90eXBlLnNldFRhcmdldGluZyA9IG5vb3BUaGlzO1xuICBQYXNzYmFja1Nsb3QucHJvdG90eXBlLnVwZGF0ZVRhcmdldGluZ0Zyb21NYXAgPSBub29wVGhpcztcblxuICBmdW5jdGlvbiBTaXplTWFwcGluZ0J1aWxkZXIoKSB7fSAvLyBjb25zdHJ1Y3RvclxuXG5cbiAgU2l6ZU1hcHBpbmdCdWlsZGVyLnByb3RvdHlwZS5hZGRTaXplID0gbm9vcFRoaXM7XG4gIFNpemVNYXBwaW5nQnVpbGRlci5wcm90b3R5cGUuYnVpbGQgPSBub29wTnVsbDtcblxuICBmdW5jdGlvbiBTbG90KCkge30gLy8gY29uc3RydWN0b3JcblxuXG4gIFNsb3QucHJvdG90eXBlLmFkZFNlcnZpY2UgPSBub29wVGhpcztcbiAgU2xvdC5wcm90b3R5cGUuY2xlYXJDYXRlZ29yeUV4Y2x1c2lvbnMgPSBub29wVGhpcztcbiAgU2xvdC5wcm90b3R5cGUuY2xlYXJUYXJnZXRpbmcgPSBub29wVGhpcztcbiAgU2xvdC5wcm90b3R5cGUuZGVmaW5lU2l6ZU1hcHBpbmcgPSBub29wVGhpcztcbiAgU2xvdC5wcm90b3R5cGUuZ2V0ID0gbm9vcE51bGw7XG4gIFNsb3QucHJvdG90eXBlLmdldEFkVW5pdFBhdGggPSBub29wQXJyYXk7XG4gIFNsb3QucHJvdG90eXBlLmdldEF0dHJpYnV0ZUtleXMgPSBub29wQXJyYXk7XG4gIFNsb3QucHJvdG90eXBlLmdldENhdGVnb3J5RXhjbHVzaW9ucyA9IG5vb3BBcnJheTtcbiAgU2xvdC5wcm90b3R5cGUuZ2V0RG9tSWQgPSBub29wU3RyO1xuICBTbG90LnByb3RvdHlwZS5nZXRTbG90RWxlbWVudElkID0gbm9vcFN0cjtcbiAgU2xvdC5wcm90b3R5cGUuZ2V0U2xvdElkID0gbm9vcFRoaXM7XG4gIFNsb3QucHJvdG90eXBlLmdldFRhcmdldGluZyA9IG5vb3BBcnJheTtcbiAgU2xvdC5wcm90b3R5cGUuZ2V0VGFyZ2V0aW5nS2V5cyA9IG5vb3BBcnJheTtcbiAgU2xvdC5wcm90b3R5cGUuc2V0ID0gbm9vcFRoaXM7XG4gIFNsb3QucHJvdG90eXBlLnNldENhdGVnb3J5RXhjbHVzaW9uID0gbm9vcFRoaXM7XG4gIFNsb3QucHJvdG90eXBlLnNldENsaWNrVXJsID0gbm9vcFRoaXM7XG4gIFNsb3QucHJvdG90eXBlLnNldENvbGxhcHNlRW1wdHlEaXYgPSBub29wVGhpcztcbiAgU2xvdC5wcm90b3R5cGUuc2V0VGFyZ2V0aW5nID0gbm9vcFRoaXM7XG4gIHZhciBwdWJBZHNTZXJ2aWNlID0ge1xuICAgIGFkZEV2ZW50TGlzdGVuZXI6IG5vb3BUaGlzLFxuICAgIGNsZWFyOiBub29wRnVuYyxcbiAgICBjbGVhckNhdGVnb3J5RXhjbHVzaW9uczogbm9vcFRoaXMsXG4gICAgY2xlYXJUYWdGb3JDaGlsZERpcmVjdGVkVHJlYXRtZW50OiBub29wVGhpcyxcbiAgICBjbGVhclRhcmdldGluZzogbm9vcFRoaXMsXG4gICAgY29sbGFwc2VFbXB0eURpdnM6IG5vb3BGdW5jLFxuICAgIGRlZmluZU91dE9mUGFnZVBhc3NiYWNrOiBmdW5jdGlvbiBkZWZpbmVPdXRPZlBhZ2VQYXNzYmFjaygpIHtcbiAgICAgIHJldHVybiBuZXcgUGFzc2JhY2tTbG90KCk7XG4gICAgfSxcbiAgICBkZWZpbmVQYXNzYmFjazogZnVuY3Rpb24gZGVmaW5lUGFzc2JhY2soKSB7XG4gICAgICByZXR1cm4gbmV3IFBhc3NiYWNrU2xvdCgpO1xuICAgIH0sXG4gICAgZGlzYWJsZUluaXRpYWxMb2FkOiBub29wRnVuYyxcbiAgICBkaXNwbGF5OiBub29wRnVuYyxcbiAgICBlbmFibGVBc3luY1JlbmRlcmluZzogbm9vcEZ1bmMsXG4gICAgZW5hYmxlU2luZ2xlUmVxdWVzdDogbm9vcEZ1bmMsXG4gICAgZW5hYmxlU3luY1JlbmRlcmluZzogbm9vcEZ1bmMsXG4gICAgZW5hYmxlVmlkZW9BZHM6IG5vb3BGdW5jLFxuICAgIGdldDogbm9vcE51bGwsXG4gICAgZ2V0QXR0cmlidXRlS2V5czogbm9vcEFycmF5LFxuICAgIGdldFRhcmdldGluZzogbm9vcEZ1bmMsXG4gICAgZ2V0VGFyZ2V0aW5nS2V5czogbm9vcEFycmF5LFxuICAgIGdldFNsb3RzOiBub29wQXJyYXksXG4gICAgcmVmcmVzaDogbm9vcEZ1bmMsXG4gICAgc2V0OiBub29wVGhpcyxcbiAgICBzZXRDYXRlZ29yeUV4Y2x1c2lvbjogbm9vcFRoaXMsXG4gICAgc2V0Q2VudGVyaW5nOiBub29wRnVuYyxcbiAgICBzZXRDb29raWVPcHRpb25zOiBub29wVGhpcyxcbiAgICBzZXRGb3JjZVNhZmVGcmFtZTogbm9vcFRoaXMsXG4gICAgc2V0TG9jYXRpb246IG5vb3BUaGlzLFxuICAgIHNldFB1Ymxpc2hlclByb3ZpZGVkSWQ6IG5vb3BUaGlzLFxuICAgIHNldFJlcXVlc3ROb25QZXJzb25hbGl6ZWRBZHM6IG5vb3BUaGlzLFxuICAgIHNldFNhZmVGcmFtZUNvbmZpZzogbm9vcFRoaXMsXG4gICAgc2V0VGFnRm9yQ2hpbGREaXJlY3RlZFRyZWF0bWVudDogbm9vcFRoaXMsXG4gICAgc2V0VGFyZ2V0aW5nOiBub29wVGhpcyxcbiAgICBzZXRWaWRlb0NvbnRlbnQ6IG5vb3BUaGlzLFxuICAgIHVwZGF0ZUNvcnJlbGF0b3I6IG5vb3BGdW5jXG4gIH07XG4gIHZhciBfd2luZG93ID0gd2luZG93LFxuICAgICAgX3dpbmRvdyRnb29nbGV0YWcgPSBfd2luZG93Lmdvb2dsZXRhZyxcbiAgICAgIGdvb2dsZXRhZyA9IF93aW5kb3ckZ29vZ2xldGFnID09PSB2b2lkIDAgPyB7fSA6IF93aW5kb3ckZ29vZ2xldGFnO1xuICB2YXIgX2dvb2dsZXRhZyRjbWQgPSBnb29nbGV0YWcuY21kLFxuICAgICAgY21kID0gX2dvb2dsZXRhZyRjbWQgPT09IHZvaWQgMCA/IFtdIDogX2dvb2dsZXRhZyRjbWQ7XG4gIGdvb2dsZXRhZy5hcGlSZWFkeSA9IHRydWU7XG4gIGdvb2dsZXRhZy5jbWQgPSBbXTtcblxuICBnb29nbGV0YWcuY21kLnB1c2ggPSBmdW5jdGlvbiAoYSkge1xuICAgIHRyeSB7XG4gICAgICBhKCk7IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1lbXB0eVxuICAgIH0gY2F0Y2ggKGV4KSB7fVxuXG4gICAgcmV0dXJuIDE7XG4gIH07XG5cbiAgZ29vZ2xldGFnLmNvbXBhbmlvbkFkcyA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gY29tcGFuaW9uQWRzU2VydmljZTtcbiAgfTtcblxuICBnb29nbGV0YWcuY29udGVudCA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gY29udGVudFNlcnZpY2U7XG4gIH07XG5cbiAgZ29vZ2xldGFnLmRlZmluZU91dE9mUGFnZVNsb3QgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIG5ldyBTbG90KCk7XG4gIH07XG5cbiAgZ29vZ2xldGFnLmRlZmluZVNsb3QgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIG5ldyBTbG90KCk7XG4gIH07XG5cbiAgZ29vZ2xldGFnLmRlc3Ryb3lTbG90cyA9IG5vb3BGdW5jO1xuICBnb29nbGV0YWcuZGlzYWJsZVB1Ymxpc2hlckNvbnNvbGUgPSBub29wRnVuYztcbiAgZ29vZ2xldGFnLmRpc3BsYXkgPSBub29wRnVuYztcbiAgZ29vZ2xldGFnLmVuYWJsZVNlcnZpY2VzID0gbm9vcEZ1bmM7XG4gIGdvb2dsZXRhZy5nZXRWZXJzaW9uID0gbm9vcFN0cjtcblxuICBnb29nbGV0YWcucHViYWRzID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBwdWJBZHNTZXJ2aWNlO1xuICB9O1xuXG4gIGdvb2dsZXRhZy5wdWJhZHNSZWFkeSA9IHRydWU7XG4gIGdvb2dsZXRhZy5zZXRBZElmcmFtZVRpdGxlID0gbm9vcEZ1bmM7XG5cbiAgZ29vZ2xldGFnLnNpemVNYXBwaW5nID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBuZXcgU2l6ZU1hcHBpbmdCdWlsZGVyKCk7XG4gIH07XG5cbiAgd2luZG93Lmdvb2dsZXRhZyA9IGdvb2dsZXRhZztcblxuICB3aGlsZSAoY21kLmxlbmd0aCAhPT0gMCkge1xuICAgIGdvb2dsZXRhZy5jbWQucHVzaChjbWQuc2hpZnQoKSk7XG4gIH1cblxuICBoaXQoc291cmNlKTtcbn1cbkdvb2dsZVRhZ1NlcnZpY2VzR3B0Lm5hbWVzID0gWydnb29nbGV0YWdzZXJ2aWNlcy1ncHQnLCAndWJvLWdvb2dsZXRhZ3NlcnZpY2VzX2dwdC5qcycsICdnb29nbGV0YWdzZXJ2aWNlc19ncHQuanMnXTtcbkdvb2dsZVRhZ1NlcnZpY2VzR3B0LmluamVjdGlvbnMgPSBbaGl0LCBub29wRnVuYywgbm9vcFRoaXMsIG5vb3BOdWxsLCBub29wQXJyYXksIG5vb3BTdHJdO1xuXG4vKipcbiAqIEByZWRpcmVjdCBzY29yZWNhcmRyZXNlYXJjaC1iZWFjb25cbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIE1vY2tzIFNjb3JlY2FyZCBSZXNlYXJjaCBBUEkuXG4gKlxuICogUmVsYXRlZCBVQk8gcmVkaXJlY3QgcmVzb3VyY2U6XG4gKiBodHRwczovL2dpdGh1Yi5jb20vZ29yaGlsbC91QmxvY2svYmxvYi9hOTRkZjdmM2IyNzA4MGFlMmRjYjNiOTE0YWNlMzljMGMyOTRkMmY2L3NyYy93ZWJfYWNjZXNzaWJsZV9yZXNvdXJjZXMvc2NvcmVjYXJkcmVzZWFyY2hfYmVhY29uLmpzXG4gKlxuICogKipFeGFtcGxlKipcbiAqIGBgYFxuICogfHxzYi5zY29yZWNhcmRyZXNlYXJjaC5jb20vYmVhY29uLmpzJHNjcmlwdCxyZWRpcmVjdD1zY29yZWNhcmRyZXNlYXJjaC1iZWFjb25cbiAqIGBgYFxuICovXG5cbmZ1bmN0aW9uIFNjb3JlQ2FyZFJlc2VhcmNoQmVhY29uKHNvdXJjZSkge1xuICB3aW5kb3cuQ09NU0NPUkUgPSB7XG4gICAgcHVyZ2U6IGZ1bmN0aW9uIHB1cmdlKCkge1xuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVuZGVyc2NvcmUtZGFuZ2xlXG4gICAgICB3aW5kb3cuX2NvbXNjb3JlID0gW107XG4gICAgfSxcbiAgICBiZWFjb246IGZ1bmN0aW9uIGJlYWNvbigpIHt9XG4gIH07XG4gIGhpdChzb3VyY2UpO1xufVxuU2NvcmVDYXJkUmVzZWFyY2hCZWFjb24ubmFtZXMgPSBbJ3Njb3JlY2FyZHJlc2VhcmNoLWJlYWNvbicsICd1Ym8tc2NvcmVjYXJkcmVzZWFyY2hfYmVhY29uLmpzJywgJ3Njb3JlY2FyZHJlc2VhcmNoX2JlYWNvbi5qcyddO1xuU2NvcmVDYXJkUmVzZWFyY2hCZWFjb24uaW5qZWN0aW9ucyA9IFtoaXRdO1xuXG4vKipcbiAqIEByZWRpcmVjdCBtZXRyaWthLXlhbmRleC10YWdcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIE1vY2tzIFlhbmRleCBNZXRyaWthIEFQSS5cbiAqIGh0dHBzOi8veWFuZGV4LnJ1L3N1cHBvcnQvbWV0cmljYS9vYmplY3RzL21ldGhvZC1yZWZlcmVuY2UuaHRtbFxuICpcbiAqICoqRXhhbXBsZSoqXG4gKiBgYGBcbiAqIHx8bWMueWFuZGV4LnJ1L21ldHJpa2EvdGFnLmpzJHNjcmlwdCxyZWRpcmVjdD1tZXRyaWthLXlhbmRleC10YWdcbiAqIGBgYFxuICovXG5cbmZ1bmN0aW9uIG1ldHJpa2FZYW5kZXhUYWcoc291cmNlKSB7XG4gIHZhciBhc3luY0NhbGxiYWNrRnJvbU9wdGlvbnMgPSBmdW5jdGlvbiBhc3luY0NhbGxiYWNrRnJvbU9wdGlvbnMocGFyYW0pIHtcbiAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307XG4gICAgdmFyIGNhbGxiYWNrID0gb3B0aW9ucy5jYWxsYmFjaztcbiAgICB2YXIgY3R4ID0gb3B0aW9ucy5jdHg7XG5cbiAgICBpZiAodHlwZW9mIGNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICBjYWxsYmFjayA9IGN0eCAhPT0gdW5kZWZpbmVkID8gY2FsbGJhY2suYmluZChjdHgpIDogY2FsbGJhY2s7XG4gICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGNhbGxiYWNrKCk7XG4gICAgICB9KTtcbiAgICB9XG4gIH07XG5cbiAgdmFyIGluaXQgPSBub29wRnVuYztcbiAgLyoqXG4gICAqIGh0dHBzOi8veWFuZGV4LnJ1L3N1cHBvcnQvbWV0cmljYS9vYmplY3RzL2FkZGZpbGVleHRlbnNpb24uaHRtbFxuICAgKi9cblxuICB2YXIgYWRkRmlsZUV4dGVuc2lvbiA9IG5vb3BGdW5jO1xuICAvKipcbiAgICogaHR0cHM6Ly95YW5kZXgucnUvc3VwcG9ydC9tZXRyaWNhL29iamVjdHMvZXh0bGluay5odG1sXG4gICAqL1xuXG4gIHZhciBleHRMaW5rID0gYXN5bmNDYWxsYmFja0Zyb21PcHRpb25zO1xuICAvKipcbiAgICogaHR0cHM6Ly95YW5kZXgucnUvc3VwcG9ydC9tZXRyaWNhL29iamVjdHMvZmlsZS5odG1sXG4gICAqL1xuXG4gIHZhciBmaWxlID0gYXN5bmNDYWxsYmFja0Zyb21PcHRpb25zO1xuICAvKipcbiAgICogaHR0cHM6Ly95YW5kZXgucnUvc3VwcG9ydC9tZXRyaWNhL29iamVjdHMvZ2V0LWNsaWVudC1pZC5odG1sXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IGNiXG4gICAqL1xuXG4gIHZhciBnZXRDbGllbnRJRCA9IGZ1bmN0aW9uIGdldENsaWVudElEKGNiKSB7XG4gICAgc2V0VGltZW91dChjYihudWxsKSk7XG4gIH07XG4gIC8qKlxuICAgKiBodHRwczovL3lhbmRleC5ydS9zdXBwb3J0L21ldHJpY2Evb2JqZWN0cy9oaXQuaHRtbFxuICAgKi9cblxuXG4gIHZhciBoaXRGdW5jID0gYXN5bmNDYWxsYmFja0Zyb21PcHRpb25zO1xuICAvKipcbiAgICogaHR0cHM6Ly95YW5kZXgucnUvc3VwcG9ydC9tZXRyaWNhL29iamVjdHMvbm90Ym91bmNlLmh0bWxcbiAgICovXG5cbiAgdmFyIG5vdEJvdW5jZSA9IGFzeW5jQ2FsbGJhY2tGcm9tT3B0aW9ucztcbiAgLyoqXG4gICAqIGh0dHBzOi8veWFuZGV4LnJ1L3N1cHBvcnQvbWV0cmljYS9vYmplY3RzL3BhcmFtcy1tZXRob2QuaHRtbFxuICAgKi9cblxuICB2YXIgcGFyYW1zID0gbm9vcEZ1bmM7XG4gIC8qKlxuICAgKiBodHRwczovL3lhbmRleC5ydS9zdXBwb3J0L21ldHJpY2Evb2JqZWN0cy9yZWFjaGdvYWwuaHRtbFxuICAgKiBAcGFyYW0ge3N0cmluZ30gdGFyZ2V0XG4gICAqIEBwYXJhbSB7T2JqZWN0fSBwYXJhbXNcbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2tcbiAgICogQHBhcmFtIHthbnl9IGN0eFxuICAgKi9cblxuICB2YXIgcmVhY2hHb2FsID0gZnVuY3Rpb24gcmVhY2hHb2FsKHRhcmdldCwgcGFyYW1zLCBjYWxsYmFjaywgY3R4KSB7XG4gICAgYXN5bmNDYWxsYmFja0Zyb21PcHRpb25zKG51bGwsIHtcbiAgICAgIGNhbGxiYWNrOiBjYWxsYmFjayxcbiAgICAgIGN0eDogY3R4XG4gICAgfSk7XG4gIH07XG4gIC8qKlxuICAgKiBodHRwczovL3lhbmRleC5ydS9zdXBwb3J0L21ldHJpY2Evb2JqZWN0cy9zZXQtdXNlci1pZC5odG1sXG4gICAqL1xuXG5cbiAgdmFyIHNldFVzZXJJRCA9IG5vb3BGdW5jO1xuICAvKipcbiAgICogaHR0cHM6Ly95YW5kZXgucnUvc3VwcG9ydC9tZXRyaWNhL29iamVjdHMvdXNlci1wYXJhbXMuaHRtbFxuICAgKi9cblxuICB2YXIgdXNlclBhcmFtcyA9IG5vb3BGdW5jO1xuICB2YXIgYXBpID0ge1xuICAgIGluaXQ6IGluaXQsXG4gICAgYWRkRmlsZUV4dGVuc2lvbjogYWRkRmlsZUV4dGVuc2lvbixcbiAgICBleHRMaW5rOiBleHRMaW5rLFxuICAgIGZpbGU6IGZpbGUsXG4gICAgZ2V0Q2xpZW50SUQ6IGdldENsaWVudElELFxuICAgIGhpdDogaGl0RnVuYyxcbiAgICBub3RCb3VuY2U6IG5vdEJvdW5jZSxcbiAgICBwYXJhbXM6IHBhcmFtcyxcbiAgICByZWFjaEdvYWw6IHJlYWNoR29hbCxcbiAgICBzZXRVc2VySUQ6IHNldFVzZXJJRCxcbiAgICB1c2VyUGFyYW1zOiB1c2VyUGFyYW1zXG4gIH07XG5cbiAgZnVuY3Rpb24geW0oaWQsIGZ1bmNOYW1lKSB7XG4gICAgZm9yICh2YXIgX2xlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3MgPSBuZXcgQXJyYXkoX2xlbiA+IDIgPyBfbGVuIC0gMiA6IDApLCBfa2V5ID0gMjsgX2tleSA8IF9sZW47IF9rZXkrKykge1xuICAgICAgYXJnc1tfa2V5IC0gMl0gPSBhcmd1bWVudHNbX2tleV07XG4gICAgfVxuXG4gICAgcmV0dXJuIGFwaVtmdW5jTmFtZV0gJiYgYXBpW2Z1bmNOYW1lXS5hcHBseShhcGksIGFyZ3MpO1xuICB9XG5cbiAgd2luZG93LnltID0geW07XG4gIGhpdChzb3VyY2UpO1xufVxubWV0cmlrYVlhbmRleFRhZy5uYW1lcyA9IFsnbWV0cmlrYS15YW5kZXgtdGFnJ107XG5tZXRyaWthWWFuZGV4VGFnLmluamVjdGlvbnMgPSBbaGl0LCBub29wRnVuY107XG5cbi8qKlxuICogQHJlZGlyZWN0IG1ldHJpa2EteWFuZGV4LXdhdGNoXG4gKlxuICogQGRlc2NyaXB0aW9uXG4gKiBNb2NrcyB0aGUgb2xkIFlhbmRleCBNZXRyaWthIEFQSS5cbiAqIGh0dHBzOi8veWFuZGV4LnJ1L3N1cHBvcnQvbWV0cmljYS9vYmplY3RzL19tZXRob2QtcmVmZXJlbmNlLmh0bWxcbiAqXG4gKiAqKkV4YW1wbGUqKlxuICogYGBgXG4gKiB8fG1jLnlhbmRleC5ydS9tZXRyaWthL3dhdGNoLmpzJHNjcmlwdCxyZWRpcmVjdD1tZXRyaWthLXlhbmRleC13YXRjaFxuICogYGBgXG4gKi9cblxuZnVuY3Rpb24gbWV0cmlrYVlhbmRleFdhdGNoKHNvdXJjZSkge1xuICB2YXIgY2JOYW1lID0gJ3lhbmRleF9tZXRyaWthX2NhbGxiYWNrcyc7XG4gIC8qKlxuICAgKiBHZXRzIGNhbGxiYWNrIGFuZCBpdHMgY29udGV4dCBmcm9tIG9wdGlvbnMgYW5kIGNhbGwgaXQgaW4gYXN5bmMgd2F5XG4gICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIFlhbmRleCBNZXRyaWthIEFQSSBvcHRpb25zXG4gICAqL1xuXG4gIHZhciBhc3luY0NhbGxiYWNrRnJvbU9wdGlvbnMgPSBmdW5jdGlvbiBhc3luY0NhbGxiYWNrRnJvbU9wdGlvbnMoKSB7XG4gICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9O1xuICAgIHZhciBjYWxsYmFjayA9IG9wdGlvbnMuY2FsbGJhY2s7XG4gICAgdmFyIGN0eCA9IG9wdGlvbnMuY3R4O1xuXG4gICAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgY2FsbGJhY2sgPSBjdHggIT09IHVuZGVmaW5lZCA/IGNhbGxiYWNrLmJpbmQoY3R4KSA6IGNhbGxiYWNrO1xuICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBjYWxsYmFjaygpO1xuICAgICAgfSk7XG4gICAgfVxuICB9O1xuXG4gIGZ1bmN0aW9uIE1ldHJpa2EoKSB7fSAvLyBjb25zdHJ1Y3RvclxuICAvLyBNZXRob2RzIHdpdGhvdXQgb3B0aW9uc1xuXG5cbiAgTWV0cmlrYS5wcm90b3R5cGUuYWRkRmlsZUV4dGVuc2lvbiA9IG5vb3BGdW5jO1xuICBNZXRyaWthLnByb3RvdHlwZS5nZXRDbGllbnRJRCA9IG5vb3BGdW5jO1xuICBNZXRyaWthLnByb3RvdHlwZS5zZXRVc2VySUQgPSBub29wRnVuYztcbiAgTWV0cmlrYS5wcm90b3R5cGUudXNlclBhcmFtcyA9IG5vb3BGdW5jOyAvLyBNZXRob2RzIHdpdGggb3B0aW9uc1xuICAvLyBUaGUgb3JkZXIgb2YgYXJndW1lbnRzIHNob3VsZCBiZSBrZXB0IGluIGFjY29yZGluZyB0byBBUElcblxuICBNZXRyaWthLnByb3RvdHlwZS5leHRMaW5rID0gZnVuY3Rpb24gKHVybCwgb3B0aW9ucykge1xuICAgIGFzeW5jQ2FsbGJhY2tGcm9tT3B0aW9ucyhvcHRpb25zKTtcbiAgfTtcblxuICBNZXRyaWthLnByb3RvdHlwZS5maWxlID0gZnVuY3Rpb24gKHVybCwgb3B0aW9ucykge1xuICAgIGFzeW5jQ2FsbGJhY2tGcm9tT3B0aW9ucyhvcHRpb25zKTtcbiAgfTtcblxuICBNZXRyaWthLnByb3RvdHlwZS5oaXQgPSBmdW5jdGlvbiAodXJsLCBvcHRpb25zKSB7XG4gICAgYXN5bmNDYWxsYmFja0Zyb21PcHRpb25zKG9wdGlvbnMpO1xuICB9O1xuXG4gIE1ldHJpa2EucHJvdG90eXBlLnJlYWNoR29hbCA9IGZ1bmN0aW9uICh0YXJnZXQsIHBhcmFtcywgY2IsIGN0eCkge1xuICAgIGFzeW5jQ2FsbGJhY2tGcm9tT3B0aW9ucyh7XG4gICAgICBjYWxsYmFjazogY2IsXG4gICAgICBjdHg6IGN0eFxuICAgIH0pO1xuICB9O1xuXG4gIE1ldHJpa2EucHJvdG90eXBlLm5vdEJvdW5jZSA9IGFzeW5jQ2FsbGJhY2tGcm9tT3B0aW9ucztcblxuICBpZiAod2luZG93LllhKSB7XG4gICAgd2luZG93LllhLk1ldHJpa2EgPSBNZXRyaWthO1xuICB9IGVsc2Uge1xuICAgIHdpbmRvdy5ZYSA9IHtcbiAgICAgIE1ldHJpa2E6IE1ldHJpa2FcbiAgICB9O1xuICB9XG5cbiAgaWYgKHdpbmRvd1tjYk5hbWVdICYmIEFycmF5LmlzQXJyYXkod2luZG93W2NiTmFtZV0pKSB7XG4gICAgd2luZG93W2NiTmFtZV0uZm9yRWFjaChmdW5jdGlvbiAoZnVuYykge1xuICAgICAgaWYgKHR5cGVvZiBmdW5jID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIGZ1bmMoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGhpdChzb3VyY2UpO1xufVxubWV0cmlrYVlhbmRleFdhdGNoLm5hbWVzID0gWydtZXRyaWthLXlhbmRleC13YXRjaCddO1xubWV0cmlrYVlhbmRleFdhdGNoLmluamVjdGlvbnMgPSBbaGl0LCBub29wRnVuY107XG5cbi8qKlxuICogQHJlZGlyZWN0IGFtYXpvbi1hcHN0YWdcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIE1vY2tzIEFtYXpvbidzIGFwc3RhZy5qc1xuICpcbiAqIFJlbGF0ZWQgVUJPIHJlZGlyZWN0IHJlc291cmNlOlxuICogaHR0cHM6Ly9naXRodWIuY29tL2dvcmhpbGwvdUJsb2NrL2Jsb2IvZjg0MmFiNmQzYzFjZjAzOTRmOTVkMjcwOTJiZjU5NjI3MjYyZGE0MC9zcmMvd2ViX2FjY2Vzc2libGVfcmVzb3VyY2VzL2FtYXpvbl9hcHN0YWcuanNcbiAqXG4gKiAqKkV4YW1wbGUqKlxuICogYGBgXG4gKiB8fGFtYXpvbi1hZHN5c3RlbS5jb20vYWF4Mi9hcHN0YWcuanMkc2NyaXB0LHJlZGlyZWN0PWFtYXpvbi1hcHN0YWdcbiAqIGBgYFxuICovXG5cbmZ1bmN0aW9uIEFtYXpvbkFwc3RhZyhzb3VyY2UpIHtcbiAgdmFyIGFwc3RhZ1dyYXBwZXIgPSB7XG4gICAgZmV0Y2hCaWRzOiBmdW5jdGlvbiBmZXRjaEJpZHMoYSwgYikge1xuICAgICAgaWYgKHR5cGVvZiBiID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIGIoW10pO1xuICAgICAgfVxuICAgIH0sXG4gICAgaW5pdDogbm9vcEZ1bmMsXG4gICAgc2V0RGlzcGxheUJpZHM6IG5vb3BGdW5jLFxuICAgIHRhcmdldGluZ0tleXM6IG5vb3BGdW5jXG4gIH07XG4gIHdpbmRvdy5hcHN0YWcgPSBhcHN0YWdXcmFwcGVyO1xuICBoaXQoc291cmNlKTtcbn1cbkFtYXpvbkFwc3RhZy5uYW1lcyA9IFsnYW1hem9uLWFwc3RhZycsICd1Ym8tYW1hem9uX2Fwc3RhZy5qcycsICdhbWF6b25fYXBzdGFnLmpzJ107XG5BbWF6b25BcHN0YWcuaW5qZWN0aW9ucyA9IFtoaXQsIG5vb3BGdW5jXTtcblxudmFyIHJlZGlyZWN0c0xpc3QgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7XG4gICAgX19wcm90b19fOiBudWxsLFxuICAgIG5vZXZhbDogbm9ldmFsLFxuICAgIEdvb2dsZUFuYWx5dGljczogR29vZ2xlQW5hbHl0aWNzLFxuICAgIEdvb2dsZUFuYWx5dGljc0dhOiBHb29nbGVBbmFseXRpY3NHYSxcbiAgICBHb29nbGVTeW5kaWNhdGlvbkFkc0J5R29vZ2xlOiBHb29nbGVTeW5kaWNhdGlvbkFkc0J5R29vZ2xlLFxuICAgIEdvb2dsZVRhZ1NlcnZpY2VzR3B0OiBHb29nbGVUYWdTZXJ2aWNlc0dwdCxcbiAgICBTY29yZUNhcmRSZXNlYXJjaEJlYWNvbjogU2NvcmVDYXJkUmVzZWFyY2hCZWFjb24sXG4gICAgbWV0cmlrYVlhbmRleFRhZzogbWV0cmlrYVlhbmRleFRhZyxcbiAgICBtZXRyaWthWWFuZGV4V2F0Y2g6IG1ldHJpa2FZYW5kZXhXYXRjaCxcbiAgICBwcmV2ZW50RmFiOiBwcmV2ZW50RmFiLFxuICAgIHByZXZlbnRCYWI6IHByZXZlbnRCYWIsXG4gICAgc2V0UG9wYWRzRHVtbXk6IHNldFBvcGFkc0R1bW15LFxuICAgIHByZXZlbnRQb3BhZHNOZXQ6IHByZXZlbnRQb3BhZHNOZXQsXG4gICAgQW1hem9uQXBzdGFnOiBBbWF6b25BcHN0YWdcbn0pO1xuXG5mdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7XG4gIGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTtcbiAgfVxufVxuXG52YXIgY2xhc3NDYWxsQ2hlY2sgPSBfY2xhc3NDYWxsQ2hlY2s7XG5cbmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykge1xuICAgIHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07XG4gICAgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlO1xuICAgIGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTtcbiAgICBpZiAoXCJ2YWx1ZVwiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7XG4gIGlmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpO1xuICBpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7XG4gIHJldHVybiBDb25zdHJ1Y3Rvcjtcbn1cblxudmFyIGNyZWF0ZUNsYXNzID0gX2NyZWF0ZUNsYXNzO1xuXG5mdW5jdGlvbiBpc05vdGhpbmcoc3ViamVjdCkge1xuICByZXR1cm4gdHlwZW9mIHN1YmplY3QgPT09ICd1bmRlZmluZWQnIHx8IHN1YmplY3QgPT09IG51bGw7XG59XG5cbmZ1bmN0aW9uIGlzT2JqZWN0KHN1YmplY3QpIHtcbiAgcmV0dXJuIHR5cGVvZiBzdWJqZWN0ID09PSAnb2JqZWN0JyAmJiBzdWJqZWN0ICE9PSBudWxsO1xufVxuXG5mdW5jdGlvbiB0b0FycmF5JDEoc2VxdWVuY2UpIHtcbiAgaWYgKEFycmF5LmlzQXJyYXkoc2VxdWVuY2UpKSByZXR1cm4gc2VxdWVuY2U7ZWxzZSBpZiAoaXNOb3RoaW5nKHNlcXVlbmNlKSkgcmV0dXJuIFtdO1xuICByZXR1cm4gW3NlcXVlbmNlXTtcbn1cblxuZnVuY3Rpb24gZXh0ZW5kKHRhcmdldCwgc291cmNlKSB7XG4gIHZhciBpbmRleCwgbGVuZ3RoLCBrZXksIHNvdXJjZUtleXM7XG5cbiAgaWYgKHNvdXJjZSkge1xuICAgIHNvdXJjZUtleXMgPSBPYmplY3Qua2V5cyhzb3VyY2UpO1xuXG4gICAgZm9yIChpbmRleCA9IDAsIGxlbmd0aCA9IHNvdXJjZUtleXMubGVuZ3RoOyBpbmRleCA8IGxlbmd0aDsgaW5kZXggKz0gMSkge1xuICAgICAga2V5ID0gc291cmNlS2V5c1tpbmRleF07XG4gICAgICB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB0YXJnZXQ7XG59XG5cbmZ1bmN0aW9uIHJlcGVhdChzdHJpbmcsIGNvdW50KSB7XG4gIHZhciByZXN1bHQgPSAnJyxcbiAgICAgIGN5Y2xlO1xuXG4gIGZvciAoY3ljbGUgPSAwOyBjeWNsZSA8IGNvdW50OyBjeWNsZSArPSAxKSB7XG4gICAgcmVzdWx0ICs9IHN0cmluZztcbiAgfVxuXG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmZ1bmN0aW9uIGlzTmVnYXRpdmVaZXJvKG51bWJlcikge1xuICByZXR1cm4gbnVtYmVyID09PSAwICYmIE51bWJlci5ORUdBVElWRV9JTkZJTklUWSA9PT0gMSAvIG51bWJlcjtcbn1cblxudmFyIGlzTm90aGluZ18xID0gaXNOb3RoaW5nO1xudmFyIGlzT2JqZWN0XzEgPSBpc09iamVjdDtcbnZhciB0b0FycmF5XzEgPSB0b0FycmF5JDE7XG52YXIgcmVwZWF0XzEgPSByZXBlYXQ7XG52YXIgaXNOZWdhdGl2ZVplcm9fMSA9IGlzTmVnYXRpdmVaZXJvO1xudmFyIGV4dGVuZF8xID0gZXh0ZW5kO1xudmFyIGNvbW1vbiA9IHtcbiAgaXNOb3RoaW5nOiBpc05vdGhpbmdfMSxcbiAgaXNPYmplY3Q6IGlzT2JqZWN0XzEsXG4gIHRvQXJyYXk6IHRvQXJyYXlfMSxcbiAgcmVwZWF0OiByZXBlYXRfMSxcbiAgaXNOZWdhdGl2ZVplcm86IGlzTmVnYXRpdmVaZXJvXzEsXG4gIGV4dGVuZDogZXh0ZW5kXzFcbn07XG5cbi8vIFlBTUwgZXJyb3IgY2xhc3MuIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvODQ1ODk4NFxuXG5mdW5jdGlvbiBZQU1MRXhjZXB0aW9uKHJlYXNvbiwgbWFyaykge1xuICAvLyBTdXBlciBjb25zdHJ1Y3RvclxuICBFcnJvci5jYWxsKHRoaXMpO1xuICB0aGlzLm5hbWUgPSAnWUFNTEV4Y2VwdGlvbic7XG4gIHRoaXMucmVhc29uID0gcmVhc29uO1xuICB0aGlzLm1hcmsgPSBtYXJrO1xuICB0aGlzLm1lc3NhZ2UgPSAodGhpcy5yZWFzb24gfHwgJyh1bmtub3duIHJlYXNvbiknKSArICh0aGlzLm1hcmsgPyAnICcgKyB0aGlzLm1hcmsudG9TdHJpbmcoKSA6ICcnKTsgLy8gSW5jbHVkZSBzdGFjayB0cmFjZSBpbiBlcnJvciBvYmplY3RcblxuICBpZiAoRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UpIHtcbiAgICAvLyBDaHJvbWUgYW5kIE5vZGVKU1xuICAgIEVycm9yLmNhcHR1cmVTdGFja1RyYWNlKHRoaXMsIHRoaXMuY29uc3RydWN0b3IpO1xuICB9IGVsc2Uge1xuICAgIC8vIEZGLCBJRSAxMCsgYW5kIFNhZmFyaSA2Ky4gRmFsbGJhY2sgZm9yIG90aGVyc1xuICAgIHRoaXMuc3RhY2sgPSBuZXcgRXJyb3IoKS5zdGFjayB8fCAnJztcbiAgfVxufSAvLyBJbmhlcml0IGZyb20gRXJyb3JcblxuXG5ZQU1MRXhjZXB0aW9uLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoRXJyb3IucHJvdG90eXBlKTtcbllBTUxFeGNlcHRpb24ucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gWUFNTEV4Y2VwdGlvbjtcblxuWUFNTEV4Y2VwdGlvbi5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiB0b1N0cmluZyhjb21wYWN0KSB7XG4gIHZhciByZXN1bHQgPSB0aGlzLm5hbWUgKyAnOiAnO1xuICByZXN1bHQgKz0gdGhpcy5yZWFzb24gfHwgJyh1bmtub3duIHJlYXNvbiknO1xuXG4gIGlmICghY29tcGFjdCAmJiB0aGlzLm1hcmspIHtcbiAgICByZXN1bHQgKz0gJyAnICsgdGhpcy5tYXJrLnRvU3RyaW5nKCk7XG4gIH1cblxuICByZXR1cm4gcmVzdWx0O1xufTtcblxudmFyIGV4Y2VwdGlvbiA9IFlBTUxFeGNlcHRpb247XG5cbmZ1bmN0aW9uIE1hcmsobmFtZSwgYnVmZmVyLCBwb3NpdGlvbiwgbGluZSwgY29sdW1uKSB7XG4gIHRoaXMubmFtZSA9IG5hbWU7XG4gIHRoaXMuYnVmZmVyID0gYnVmZmVyO1xuICB0aGlzLnBvc2l0aW9uID0gcG9zaXRpb247XG4gIHRoaXMubGluZSA9IGxpbmU7XG4gIHRoaXMuY29sdW1uID0gY29sdW1uO1xufVxuXG5NYXJrLnByb3RvdHlwZS5nZXRTbmlwcGV0ID0gZnVuY3Rpb24gZ2V0U25pcHBldChpbmRlbnQsIG1heExlbmd0aCkge1xuICB2YXIgaGVhZCwgc3RhcnQsIHRhaWwsIGVuZCwgc25pcHBldDtcbiAgaWYgKCF0aGlzLmJ1ZmZlcikgcmV0dXJuIG51bGw7XG4gIGluZGVudCA9IGluZGVudCB8fCA0O1xuICBtYXhMZW5ndGggPSBtYXhMZW5ndGggfHwgNzU7XG4gIGhlYWQgPSAnJztcbiAgc3RhcnQgPSB0aGlzLnBvc2l0aW9uO1xuXG4gIHdoaWxlIChzdGFydCA+IDAgJiYgXCJcXDBcXHJcXG5cXHg4NVxcdTIwMjhcXHUyMDI5XCIuaW5kZXhPZih0aGlzLmJ1ZmZlci5jaGFyQXQoc3RhcnQgLSAxKSkgPT09IC0xKSB7XG4gICAgc3RhcnQgLT0gMTtcblxuICAgIGlmICh0aGlzLnBvc2l0aW9uIC0gc3RhcnQgPiBtYXhMZW5ndGggLyAyIC0gMSkge1xuICAgICAgaGVhZCA9ICcgLi4uICc7XG4gICAgICBzdGFydCArPSA1O1xuICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG5cbiAgdGFpbCA9ICcnO1xuICBlbmQgPSB0aGlzLnBvc2l0aW9uO1xuXG4gIHdoaWxlIChlbmQgPCB0aGlzLmJ1ZmZlci5sZW5ndGggJiYgXCJcXDBcXHJcXG5cXHg4NVxcdTIwMjhcXHUyMDI5XCIuaW5kZXhPZih0aGlzLmJ1ZmZlci5jaGFyQXQoZW5kKSkgPT09IC0xKSB7XG4gICAgZW5kICs9IDE7XG5cbiAgICBpZiAoZW5kIC0gdGhpcy5wb3NpdGlvbiA+IG1heExlbmd0aCAvIDIgLSAxKSB7XG4gICAgICB0YWlsID0gJyAuLi4gJztcbiAgICAgIGVuZCAtPSA1O1xuICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG5cbiAgc25pcHBldCA9IHRoaXMuYnVmZmVyLnNsaWNlKHN0YXJ0LCBlbmQpO1xuICByZXR1cm4gY29tbW9uLnJlcGVhdCgnICcsIGluZGVudCkgKyBoZWFkICsgc25pcHBldCArIHRhaWwgKyAnXFxuJyArIGNvbW1vbi5yZXBlYXQoJyAnLCBpbmRlbnQgKyB0aGlzLnBvc2l0aW9uIC0gc3RhcnQgKyBoZWFkLmxlbmd0aCkgKyAnXic7XG59O1xuXG5NYXJrLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uIHRvU3RyaW5nKGNvbXBhY3QpIHtcbiAgdmFyIHNuaXBwZXQsXG4gICAgICB3aGVyZSA9ICcnO1xuXG4gIGlmICh0aGlzLm5hbWUpIHtcbiAgICB3aGVyZSArPSAnaW4gXCInICsgdGhpcy5uYW1lICsgJ1wiICc7XG4gIH1cblxuICB3aGVyZSArPSAnYXQgbGluZSAnICsgKHRoaXMubGluZSArIDEpICsgJywgY29sdW1uICcgKyAodGhpcy5jb2x1bW4gKyAxKTtcblxuICBpZiAoIWNvbXBhY3QpIHtcbiAgICBzbmlwcGV0ID0gdGhpcy5nZXRTbmlwcGV0KCk7XG5cbiAgICBpZiAoc25pcHBldCkge1xuICAgICAgd2hlcmUgKz0gJzpcXG4nICsgc25pcHBldDtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gd2hlcmU7XG59O1xuXG52YXIgbWFyayA9IE1hcms7XG5cbnZhciBUWVBFX0NPTlNUUlVDVE9SX09QVElPTlMgPSBbJ2tpbmQnLCAncmVzb2x2ZScsICdjb25zdHJ1Y3QnLCAnaW5zdGFuY2VPZicsICdwcmVkaWNhdGUnLCAncmVwcmVzZW50JywgJ2RlZmF1bHRTdHlsZScsICdzdHlsZUFsaWFzZXMnXTtcbnZhciBZQU1MX05PREVfS0lORFMgPSBbJ3NjYWxhcicsICdzZXF1ZW5jZScsICdtYXBwaW5nJ107XG5cbmZ1bmN0aW9uIGNvbXBpbGVTdHlsZUFsaWFzZXMobWFwKSB7XG4gIHZhciByZXN1bHQgPSB7fTtcblxuICBpZiAobWFwICE9PSBudWxsKSB7XG4gICAgT2JqZWN0LmtleXMobWFwKS5mb3JFYWNoKGZ1bmN0aW9uIChzdHlsZSkge1xuICAgICAgbWFwW3N0eWxlXS5mb3JFYWNoKGZ1bmN0aW9uIChhbGlhcykge1xuICAgICAgICByZXN1bHRbU3RyaW5nKGFsaWFzKV0gPSBzdHlsZTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZnVuY3Rpb24gVHlwZSh0YWcsIG9wdGlvbnMpIHtcbiAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gIE9iamVjdC5rZXlzKG9wdGlvbnMpLmZvckVhY2goZnVuY3Rpb24gKG5hbWUpIHtcbiAgICBpZiAoVFlQRV9DT05TVFJVQ1RPUl9PUFRJT05TLmluZGV4T2YobmFtZSkgPT09IC0xKSB7XG4gICAgICB0aHJvdyBuZXcgZXhjZXB0aW9uKCdVbmtub3duIG9wdGlvbiBcIicgKyBuYW1lICsgJ1wiIGlzIG1ldCBpbiBkZWZpbml0aW9uIG9mIFwiJyArIHRhZyArICdcIiBZQU1MIHR5cGUuJyk7XG4gICAgfVxuICB9KTsgLy8gVE9ETzogQWRkIHRhZyBmb3JtYXQgY2hlY2suXG5cbiAgdGhpcy50YWcgPSB0YWc7XG4gIHRoaXMua2luZCA9IG9wdGlvbnNbJ2tpbmQnXSB8fCBudWxsO1xuXG4gIHRoaXMucmVzb2x2ZSA9IG9wdGlvbnNbJ3Jlc29sdmUnXSB8fCBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH07XG5cbiAgdGhpcy5jb25zdHJ1Y3QgPSBvcHRpb25zWydjb25zdHJ1Y3QnXSB8fCBmdW5jdGlvbiAoZGF0YSkge1xuICAgIHJldHVybiBkYXRhO1xuICB9O1xuXG4gIHRoaXMuaW5zdGFuY2VPZiA9IG9wdGlvbnNbJ2luc3RhbmNlT2YnXSB8fCBudWxsO1xuICB0aGlzLnByZWRpY2F0ZSA9IG9wdGlvbnNbJ3ByZWRpY2F0ZSddIHx8IG51bGw7XG4gIHRoaXMucmVwcmVzZW50ID0gb3B0aW9uc1sncmVwcmVzZW50J10gfHwgbnVsbDtcbiAgdGhpcy5kZWZhdWx0U3R5bGUgPSBvcHRpb25zWydkZWZhdWx0U3R5bGUnXSB8fCBudWxsO1xuICB0aGlzLnN0eWxlQWxpYXNlcyA9IGNvbXBpbGVTdHlsZUFsaWFzZXMob3B0aW9uc1snc3R5bGVBbGlhc2VzJ10gfHwgbnVsbCk7XG5cbiAgaWYgKFlBTUxfTk9ERV9LSU5EUy5pbmRleE9mKHRoaXMua2luZCkgPT09IC0xKSB7XG4gICAgdGhyb3cgbmV3IGV4Y2VwdGlvbignVW5rbm93biBraW5kIFwiJyArIHRoaXMua2luZCArICdcIiBpcyBzcGVjaWZpZWQgZm9yIFwiJyArIHRhZyArICdcIiBZQU1MIHR5cGUuJyk7XG4gIH1cbn1cblxudmFyIHR5cGUgPSBUeXBlO1xuXG4vKmVzbGludC1kaXNhYmxlIG1heC1sZW4qL1xuXG5cbmZ1bmN0aW9uIGNvbXBpbGVMaXN0KHNjaGVtYSwgbmFtZSwgcmVzdWx0KSB7XG4gIHZhciBleGNsdWRlID0gW107XG4gIHNjaGVtYS5pbmNsdWRlLmZvckVhY2goZnVuY3Rpb24gKGluY2x1ZGVkU2NoZW1hKSB7XG4gICAgcmVzdWx0ID0gY29tcGlsZUxpc3QoaW5jbHVkZWRTY2hlbWEsIG5hbWUsIHJlc3VsdCk7XG4gIH0pO1xuICBzY2hlbWFbbmFtZV0uZm9yRWFjaChmdW5jdGlvbiAoY3VycmVudFR5cGUpIHtcbiAgICByZXN1bHQuZm9yRWFjaChmdW5jdGlvbiAocHJldmlvdXNUeXBlLCBwcmV2aW91c0luZGV4KSB7XG4gICAgICBpZiAocHJldmlvdXNUeXBlLnRhZyA9PT0gY3VycmVudFR5cGUudGFnICYmIHByZXZpb3VzVHlwZS5raW5kID09PSBjdXJyZW50VHlwZS5raW5kKSB7XG4gICAgICAgIGV4Y2x1ZGUucHVzaChwcmV2aW91c0luZGV4KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXN1bHQucHVzaChjdXJyZW50VHlwZSk7XG4gIH0pO1xuICByZXR1cm4gcmVzdWx0LmZpbHRlcihmdW5jdGlvbiAodHlwZSwgaW5kZXgpIHtcbiAgICByZXR1cm4gZXhjbHVkZS5pbmRleE9mKGluZGV4KSA9PT0gLTE7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBjb21waWxlTWFwKClcbi8qIGxpc3RzLi4uICovXG57XG4gIHZhciByZXN1bHQgPSB7XG4gICAgc2NhbGFyOiB7fSxcbiAgICBzZXF1ZW5jZToge30sXG4gICAgbWFwcGluZzoge30sXG4gICAgZmFsbGJhY2s6IHt9XG4gIH0sXG4gICAgICBpbmRleCxcbiAgICAgIGxlbmd0aDtcblxuICBmdW5jdGlvbiBjb2xsZWN0VHlwZSh0eXBlKSB7XG4gICAgcmVzdWx0W3R5cGUua2luZF1bdHlwZS50YWddID0gcmVzdWx0WydmYWxsYmFjayddW3R5cGUudGFnXSA9IHR5cGU7XG4gIH1cblxuICBmb3IgKGluZGV4ID0gMCwgbGVuZ3RoID0gYXJndW1lbnRzLmxlbmd0aDsgaW5kZXggPCBsZW5ndGg7IGluZGV4ICs9IDEpIHtcbiAgICBhcmd1bWVudHNbaW5kZXhdLmZvckVhY2goY29sbGVjdFR5cGUpO1xuICB9XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZnVuY3Rpb24gU2NoZW1hKGRlZmluaXRpb24pIHtcbiAgdGhpcy5pbmNsdWRlID0gZGVmaW5pdGlvbi5pbmNsdWRlIHx8IFtdO1xuICB0aGlzLmltcGxpY2l0ID0gZGVmaW5pdGlvbi5pbXBsaWNpdCB8fCBbXTtcbiAgdGhpcy5leHBsaWNpdCA9IGRlZmluaXRpb24uZXhwbGljaXQgfHwgW107XG4gIHRoaXMuaW1wbGljaXQuZm9yRWFjaChmdW5jdGlvbiAodHlwZSkge1xuICAgIGlmICh0eXBlLmxvYWRLaW5kICYmIHR5cGUubG9hZEtpbmQgIT09ICdzY2FsYXInKSB7XG4gICAgICB0aHJvdyBuZXcgZXhjZXB0aW9uKCdUaGVyZSBpcyBhIG5vbi1zY2FsYXIgdHlwZSBpbiB0aGUgaW1wbGljaXQgbGlzdCBvZiBhIHNjaGVtYS4gSW1wbGljaXQgcmVzb2x2aW5nIG9mIHN1Y2ggdHlwZXMgaXMgbm90IHN1cHBvcnRlZC4nKTtcbiAgICB9XG4gIH0pO1xuICB0aGlzLmNvbXBpbGVkSW1wbGljaXQgPSBjb21waWxlTGlzdCh0aGlzLCAnaW1wbGljaXQnLCBbXSk7XG4gIHRoaXMuY29tcGlsZWRFeHBsaWNpdCA9IGNvbXBpbGVMaXN0KHRoaXMsICdleHBsaWNpdCcsIFtdKTtcbiAgdGhpcy5jb21waWxlZFR5cGVNYXAgPSBjb21waWxlTWFwKHRoaXMuY29tcGlsZWRJbXBsaWNpdCwgdGhpcy5jb21waWxlZEV4cGxpY2l0KTtcbn1cblxuU2NoZW1hLkRFRkFVTFQgPSBudWxsO1xuXG5TY2hlbWEuY3JlYXRlID0gZnVuY3Rpb24gY3JlYXRlU2NoZW1hKCkge1xuICB2YXIgc2NoZW1hcywgdHlwZXM7XG5cbiAgc3dpdGNoIChhcmd1bWVudHMubGVuZ3RoKSB7XG4gICAgY2FzZSAxOlxuICAgICAgc2NoZW1hcyA9IFNjaGVtYS5ERUZBVUxUO1xuICAgICAgdHlwZXMgPSBhcmd1bWVudHNbMF07XG4gICAgICBicmVhaztcblxuICAgIGNhc2UgMjpcbiAgICAgIHNjaGVtYXMgPSBhcmd1bWVudHNbMF07XG4gICAgICB0eXBlcyA9IGFyZ3VtZW50c1sxXTtcbiAgICAgIGJyZWFrO1xuXG4gICAgZGVmYXVsdDpcbiAgICAgIHRocm93IG5ldyBleGNlcHRpb24oJ1dyb25nIG51bWJlciBvZiBhcmd1bWVudHMgZm9yIFNjaGVtYS5jcmVhdGUgZnVuY3Rpb24nKTtcbiAgfVxuXG4gIHNjaGVtYXMgPSBjb21tb24udG9BcnJheShzY2hlbWFzKTtcbiAgdHlwZXMgPSBjb21tb24udG9BcnJheSh0eXBlcyk7XG5cbiAgaWYgKCFzY2hlbWFzLmV2ZXJ5KGZ1bmN0aW9uIChzY2hlbWEpIHtcbiAgICByZXR1cm4gc2NoZW1hIGluc3RhbmNlb2YgU2NoZW1hO1xuICB9KSkge1xuICAgIHRocm93IG5ldyBleGNlcHRpb24oJ1NwZWNpZmllZCBsaXN0IG9mIHN1cGVyIHNjaGVtYXMgKG9yIGEgc2luZ2xlIFNjaGVtYSBvYmplY3QpIGNvbnRhaW5zIGEgbm9uLVNjaGVtYSBvYmplY3QuJyk7XG4gIH1cblxuICBpZiAoIXR5cGVzLmV2ZXJ5KGZ1bmN0aW9uICh0eXBlJDEpIHtcbiAgICByZXR1cm4gdHlwZSQxIGluc3RhbmNlb2YgdHlwZTtcbiAgfSkpIHtcbiAgICB0aHJvdyBuZXcgZXhjZXB0aW9uKCdTcGVjaWZpZWQgbGlzdCBvZiBZQU1MIHR5cGVzIChvciBhIHNpbmdsZSBUeXBlIG9iamVjdCkgY29udGFpbnMgYSBub24tVHlwZSBvYmplY3QuJyk7XG4gIH1cblxuICByZXR1cm4gbmV3IFNjaGVtYSh7XG4gICAgaW5jbHVkZTogc2NoZW1hcyxcbiAgICBleHBsaWNpdDogdHlwZXNcbiAgfSk7XG59O1xuXG52YXIgc2NoZW1hID0gU2NoZW1hO1xuXG52YXIgc3RyID0gbmV3IHR5cGUoJ3RhZzp5YW1sLm9yZywyMDAyOnN0cicsIHtcbiAga2luZDogJ3NjYWxhcicsXG4gIGNvbnN0cnVjdDogZnVuY3Rpb24gY29uc3RydWN0KGRhdGEpIHtcbiAgICByZXR1cm4gZGF0YSAhPT0gbnVsbCA/IGRhdGEgOiAnJztcbiAgfVxufSk7XG5cbnZhciBzZXEgPSBuZXcgdHlwZSgndGFnOnlhbWwub3JnLDIwMDI6c2VxJywge1xuICBraW5kOiAnc2VxdWVuY2UnLFxuICBjb25zdHJ1Y3Q6IGZ1bmN0aW9uIGNvbnN0cnVjdChkYXRhKSB7XG4gICAgcmV0dXJuIGRhdGEgIT09IG51bGwgPyBkYXRhIDogW107XG4gIH1cbn0pO1xuXG52YXIgbWFwID0gbmV3IHR5cGUoJ3RhZzp5YW1sLm9yZywyMDAyOm1hcCcsIHtcbiAga2luZDogJ21hcHBpbmcnLFxuICBjb25zdHJ1Y3Q6IGZ1bmN0aW9uIGNvbnN0cnVjdChkYXRhKSB7XG4gICAgcmV0dXJuIGRhdGEgIT09IG51bGwgPyBkYXRhIDoge307XG4gIH1cbn0pO1xuXG52YXIgZmFpbHNhZmUgPSBuZXcgc2NoZW1hKHtcbiAgZXhwbGljaXQ6IFtzdHIsIHNlcSwgbWFwXVxufSk7XG5cbmZ1bmN0aW9uIHJlc29sdmVZYW1sTnVsbChkYXRhKSB7XG4gIGlmIChkYXRhID09PSBudWxsKSByZXR1cm4gdHJ1ZTtcbiAgdmFyIG1heCA9IGRhdGEubGVuZ3RoO1xuICByZXR1cm4gbWF4ID09PSAxICYmIGRhdGEgPT09ICd+JyB8fCBtYXggPT09IDQgJiYgKGRhdGEgPT09ICdudWxsJyB8fCBkYXRhID09PSAnTnVsbCcgfHwgZGF0YSA9PT0gJ05VTEwnKTtcbn1cblxuZnVuY3Rpb24gY29uc3RydWN0WWFtbE51bGwoKSB7XG4gIHJldHVybiBudWxsO1xufVxuXG5mdW5jdGlvbiBpc051bGwob2JqZWN0KSB7XG4gIHJldHVybiBvYmplY3QgPT09IG51bGw7XG59XG5cbnZhciBfbnVsbCA9IG5ldyB0eXBlKCd0YWc6eWFtbC5vcmcsMjAwMjpudWxsJywge1xuICBraW5kOiAnc2NhbGFyJyxcbiAgcmVzb2x2ZTogcmVzb2x2ZVlhbWxOdWxsLFxuICBjb25zdHJ1Y3Q6IGNvbnN0cnVjdFlhbWxOdWxsLFxuICBwcmVkaWNhdGU6IGlzTnVsbCxcbiAgcmVwcmVzZW50OiB7XG4gICAgY2Fub25pY2FsOiBmdW5jdGlvbiBjYW5vbmljYWwoKSB7XG4gICAgICByZXR1cm4gJ34nO1xuICAgIH0sXG4gICAgbG93ZXJjYXNlOiBmdW5jdGlvbiBsb3dlcmNhc2UoKSB7XG4gICAgICByZXR1cm4gJ251bGwnO1xuICAgIH0sXG4gICAgdXBwZXJjYXNlOiBmdW5jdGlvbiB1cHBlcmNhc2UoKSB7XG4gICAgICByZXR1cm4gJ05VTEwnO1xuICAgIH0sXG4gICAgY2FtZWxjYXNlOiBmdW5jdGlvbiBjYW1lbGNhc2UoKSB7XG4gICAgICByZXR1cm4gJ051bGwnO1xuICAgIH1cbiAgfSxcbiAgZGVmYXVsdFN0eWxlOiAnbG93ZXJjYXNlJ1xufSk7XG5cbmZ1bmN0aW9uIHJlc29sdmVZYW1sQm9vbGVhbihkYXRhKSB7XG4gIGlmIChkYXRhID09PSBudWxsKSByZXR1cm4gZmFsc2U7XG4gIHZhciBtYXggPSBkYXRhLmxlbmd0aDtcbiAgcmV0dXJuIG1heCA9PT0gNCAmJiAoZGF0YSA9PT0gJ3RydWUnIHx8IGRhdGEgPT09ICdUcnVlJyB8fCBkYXRhID09PSAnVFJVRScpIHx8IG1heCA9PT0gNSAmJiAoZGF0YSA9PT0gJ2ZhbHNlJyB8fCBkYXRhID09PSAnRmFsc2UnIHx8IGRhdGEgPT09ICdGQUxTRScpO1xufVxuXG5mdW5jdGlvbiBjb25zdHJ1Y3RZYW1sQm9vbGVhbihkYXRhKSB7XG4gIHJldHVybiBkYXRhID09PSAndHJ1ZScgfHwgZGF0YSA9PT0gJ1RydWUnIHx8IGRhdGEgPT09ICdUUlVFJztcbn1cblxuZnVuY3Rpb24gaXNCb29sZWFuKG9iamVjdCkge1xuICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG9iamVjdCkgPT09ICdbb2JqZWN0IEJvb2xlYW5dJztcbn1cblxudmFyIGJvb2wgPSBuZXcgdHlwZSgndGFnOnlhbWwub3JnLDIwMDI6Ym9vbCcsIHtcbiAga2luZDogJ3NjYWxhcicsXG4gIHJlc29sdmU6IHJlc29sdmVZYW1sQm9vbGVhbixcbiAgY29uc3RydWN0OiBjb25zdHJ1Y3RZYW1sQm9vbGVhbixcbiAgcHJlZGljYXRlOiBpc0Jvb2xlYW4sXG4gIHJlcHJlc2VudDoge1xuICAgIGxvd2VyY2FzZTogZnVuY3Rpb24gbG93ZXJjYXNlKG9iamVjdCkge1xuICAgICAgcmV0dXJuIG9iamVjdCA/ICd0cnVlJyA6ICdmYWxzZSc7XG4gICAgfSxcbiAgICB1cHBlcmNhc2U6IGZ1bmN0aW9uIHVwcGVyY2FzZShvYmplY3QpIHtcbiAgICAgIHJldHVybiBvYmplY3QgPyAnVFJVRScgOiAnRkFMU0UnO1xuICAgIH0sXG4gICAgY2FtZWxjYXNlOiBmdW5jdGlvbiBjYW1lbGNhc2Uob2JqZWN0KSB7XG4gICAgICByZXR1cm4gb2JqZWN0ID8gJ1RydWUnIDogJ0ZhbHNlJztcbiAgICB9XG4gIH0sXG4gIGRlZmF1bHRTdHlsZTogJ2xvd2VyY2FzZSdcbn0pO1xuXG5mdW5jdGlvbiBpc0hleENvZGUoYykge1xuICByZXR1cm4gMHgzMFxuICAvKiAwICovXG4gIDw9IGMgJiYgYyA8PSAweDM5XG4gIC8qIDkgKi9cbiAgfHwgMHg0MVxuICAvKiBBICovXG4gIDw9IGMgJiYgYyA8PSAweDQ2XG4gIC8qIEYgKi9cbiAgfHwgMHg2MVxuICAvKiBhICovXG4gIDw9IGMgJiYgYyA8PSAweDY2XG4gIC8qIGYgKi9cbiAgO1xufVxuXG5mdW5jdGlvbiBpc09jdENvZGUoYykge1xuICByZXR1cm4gMHgzMFxuICAvKiAwICovXG4gIDw9IGMgJiYgYyA8PSAweDM3XG4gIC8qIDcgKi9cbiAgO1xufVxuXG5mdW5jdGlvbiBpc0RlY0NvZGUoYykge1xuICByZXR1cm4gMHgzMFxuICAvKiAwICovXG4gIDw9IGMgJiYgYyA8PSAweDM5XG4gIC8qIDkgKi9cbiAgO1xufVxuXG5mdW5jdGlvbiByZXNvbHZlWWFtbEludGVnZXIoZGF0YSkge1xuICBpZiAoZGF0YSA9PT0gbnVsbCkgcmV0dXJuIGZhbHNlO1xuICB2YXIgbWF4ID0gZGF0YS5sZW5ndGgsXG4gICAgICBpbmRleCA9IDAsXG4gICAgICBoYXNEaWdpdHMgPSBmYWxzZSxcbiAgICAgIGNoO1xuICBpZiAoIW1heCkgcmV0dXJuIGZhbHNlO1xuICBjaCA9IGRhdGFbaW5kZXhdOyAvLyBzaWduXG5cbiAgaWYgKGNoID09PSAnLScgfHwgY2ggPT09ICcrJykge1xuICAgIGNoID0gZGF0YVsrK2luZGV4XTtcbiAgfVxuXG4gIGlmIChjaCA9PT0gJzAnKSB7XG4gICAgLy8gMFxuICAgIGlmIChpbmRleCArIDEgPT09IG1heCkgcmV0dXJuIHRydWU7XG4gICAgY2ggPSBkYXRhWysraW5kZXhdOyAvLyBiYXNlIDIsIGJhc2UgOCwgYmFzZSAxNlxuXG4gICAgaWYgKGNoID09PSAnYicpIHtcbiAgICAgIC8vIGJhc2UgMlxuICAgICAgaW5kZXgrKztcblxuICAgICAgZm9yICg7IGluZGV4IDwgbWF4OyBpbmRleCsrKSB7XG4gICAgICAgIGNoID0gZGF0YVtpbmRleF07XG4gICAgICAgIGlmIChjaCA9PT0gJ18nKSBjb250aW51ZTtcbiAgICAgICAgaWYgKGNoICE9PSAnMCcgJiYgY2ggIT09ICcxJykgcmV0dXJuIGZhbHNlO1xuICAgICAgICBoYXNEaWdpdHMgPSB0cnVlO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gaGFzRGlnaXRzICYmIGNoICE9PSAnXyc7XG4gICAgfVxuXG4gICAgaWYgKGNoID09PSAneCcpIHtcbiAgICAgIC8vIGJhc2UgMTZcbiAgICAgIGluZGV4Kys7XG5cbiAgICAgIGZvciAoOyBpbmRleCA8IG1heDsgaW5kZXgrKykge1xuICAgICAgICBjaCA9IGRhdGFbaW5kZXhdO1xuICAgICAgICBpZiAoY2ggPT09ICdfJykgY29udGludWU7XG4gICAgICAgIGlmICghaXNIZXhDb2RlKGRhdGEuY2hhckNvZGVBdChpbmRleCkpKSByZXR1cm4gZmFsc2U7XG4gICAgICAgIGhhc0RpZ2l0cyA9IHRydWU7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBoYXNEaWdpdHMgJiYgY2ggIT09ICdfJztcbiAgICB9IC8vIGJhc2UgOFxuXG5cbiAgICBmb3IgKDsgaW5kZXggPCBtYXg7IGluZGV4KyspIHtcbiAgICAgIGNoID0gZGF0YVtpbmRleF07XG4gICAgICBpZiAoY2ggPT09ICdfJykgY29udGludWU7XG4gICAgICBpZiAoIWlzT2N0Q29kZShkYXRhLmNoYXJDb2RlQXQoaW5kZXgpKSkgcmV0dXJuIGZhbHNlO1xuICAgICAgaGFzRGlnaXRzID0gdHJ1ZTtcbiAgICB9XG5cbiAgICByZXR1cm4gaGFzRGlnaXRzICYmIGNoICE9PSAnXyc7XG4gIH0gLy8gYmFzZSAxMCAoZXhjZXB0IDApIG9yIGJhc2UgNjBcbiAgLy8gdmFsdWUgc2hvdWxkIG5vdCBzdGFydCB3aXRoIGBfYDtcblxuXG4gIGlmIChjaCA9PT0gJ18nKSByZXR1cm4gZmFsc2U7XG5cbiAgZm9yICg7IGluZGV4IDwgbWF4OyBpbmRleCsrKSB7XG4gICAgY2ggPSBkYXRhW2luZGV4XTtcbiAgICBpZiAoY2ggPT09ICdfJykgY29udGludWU7XG4gICAgaWYgKGNoID09PSAnOicpIGJyZWFrO1xuXG4gICAgaWYgKCFpc0RlY0NvZGUoZGF0YS5jaGFyQ29kZUF0KGluZGV4KSkpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBoYXNEaWdpdHMgPSB0cnVlO1xuICB9IC8vIFNob3VsZCBoYXZlIGRpZ2l0cyBhbmQgc2hvdWxkIG5vdCBlbmQgd2l0aCBgX2BcblxuXG4gIGlmICghaGFzRGlnaXRzIHx8IGNoID09PSAnXycpIHJldHVybiBmYWxzZTsgLy8gaWYgIWJhc2U2MCAtIGRvbmU7XG5cbiAgaWYgKGNoICE9PSAnOicpIHJldHVybiB0cnVlOyAvLyBiYXNlNjAgYWxtb3N0IG5vdCB1c2VkLCBubyBuZWVkcyB0byBvcHRpbWl6ZVxuXG4gIHJldHVybiAvXig6WzAtNV0/WzAtOV0pKyQvLnRlc3QoZGF0YS5zbGljZShpbmRleCkpO1xufVxuXG5mdW5jdGlvbiBjb25zdHJ1Y3RZYW1sSW50ZWdlcihkYXRhKSB7XG4gIHZhciB2YWx1ZSA9IGRhdGEsXG4gICAgICBzaWduID0gMSxcbiAgICAgIGNoLFxuICAgICAgYmFzZSxcbiAgICAgIGRpZ2l0cyA9IFtdO1xuXG4gIGlmICh2YWx1ZS5pbmRleE9mKCdfJykgIT09IC0xKSB7XG4gICAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKC9fL2csICcnKTtcbiAgfVxuXG4gIGNoID0gdmFsdWVbMF07XG5cbiAgaWYgKGNoID09PSAnLScgfHwgY2ggPT09ICcrJykge1xuICAgIGlmIChjaCA9PT0gJy0nKSBzaWduID0gLTE7XG4gICAgdmFsdWUgPSB2YWx1ZS5zbGljZSgxKTtcbiAgICBjaCA9IHZhbHVlWzBdO1xuICB9XG5cbiAgaWYgKHZhbHVlID09PSAnMCcpIHJldHVybiAwO1xuXG4gIGlmIChjaCA9PT0gJzAnKSB7XG4gICAgaWYgKHZhbHVlWzFdID09PSAnYicpIHJldHVybiBzaWduICogcGFyc2VJbnQodmFsdWUuc2xpY2UoMiksIDIpO1xuICAgIGlmICh2YWx1ZVsxXSA9PT0gJ3gnKSByZXR1cm4gc2lnbiAqIHBhcnNlSW50KHZhbHVlLCAxNik7XG4gICAgcmV0dXJuIHNpZ24gKiBwYXJzZUludCh2YWx1ZSwgOCk7XG4gIH1cblxuICBpZiAodmFsdWUuaW5kZXhPZignOicpICE9PSAtMSkge1xuICAgIHZhbHVlLnNwbGl0KCc6JykuZm9yRWFjaChmdW5jdGlvbiAodikge1xuICAgICAgZGlnaXRzLnVuc2hpZnQocGFyc2VJbnQodiwgMTApKTtcbiAgICB9KTtcbiAgICB2YWx1ZSA9IDA7XG4gICAgYmFzZSA9IDE7XG4gICAgZGlnaXRzLmZvckVhY2goZnVuY3Rpb24gKGQpIHtcbiAgICAgIHZhbHVlICs9IGQgKiBiYXNlO1xuICAgICAgYmFzZSAqPSA2MDtcbiAgICB9KTtcbiAgICByZXR1cm4gc2lnbiAqIHZhbHVlO1xuICB9XG5cbiAgcmV0dXJuIHNpZ24gKiBwYXJzZUludCh2YWx1ZSwgMTApO1xufVxuXG5mdW5jdGlvbiBpc0ludGVnZXIob2JqZWN0KSB7XG4gIHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwob2JqZWN0KSA9PT0gJ1tvYmplY3QgTnVtYmVyXScgJiYgb2JqZWN0ICUgMSA9PT0gMCAmJiAhY29tbW9uLmlzTmVnYXRpdmVaZXJvKG9iamVjdCk7XG59XG5cbnZhciBpbnQgPSBuZXcgdHlwZSgndGFnOnlhbWwub3JnLDIwMDI6aW50Jywge1xuICBraW5kOiAnc2NhbGFyJyxcbiAgcmVzb2x2ZTogcmVzb2x2ZVlhbWxJbnRlZ2VyLFxuICBjb25zdHJ1Y3Q6IGNvbnN0cnVjdFlhbWxJbnRlZ2VyLFxuICBwcmVkaWNhdGU6IGlzSW50ZWdlcixcbiAgcmVwcmVzZW50OiB7XG4gICAgYmluYXJ5OiBmdW5jdGlvbiBiaW5hcnkob2JqKSB7XG4gICAgICByZXR1cm4gb2JqID49IDAgPyAnMGInICsgb2JqLnRvU3RyaW5nKDIpIDogJy0wYicgKyBvYmoudG9TdHJpbmcoMikuc2xpY2UoMSk7XG4gICAgfSxcbiAgICBvY3RhbDogZnVuY3Rpb24gb2N0YWwob2JqKSB7XG4gICAgICByZXR1cm4gb2JqID49IDAgPyAnMCcgKyBvYmoudG9TdHJpbmcoOCkgOiAnLTAnICsgb2JqLnRvU3RyaW5nKDgpLnNsaWNlKDEpO1xuICAgIH0sXG4gICAgZGVjaW1hbDogZnVuY3Rpb24gZGVjaW1hbChvYmopIHtcbiAgICAgIHJldHVybiBvYmoudG9TdHJpbmcoMTApO1xuICAgIH0sXG5cbiAgICAvKiBlc2xpbnQtZGlzYWJsZSBtYXgtbGVuICovXG4gICAgaGV4YWRlY2ltYWw6IGZ1bmN0aW9uIGhleGFkZWNpbWFsKG9iaikge1xuICAgICAgcmV0dXJuIG9iaiA+PSAwID8gJzB4JyArIG9iai50b1N0cmluZygxNikudG9VcHBlckNhc2UoKSA6ICctMHgnICsgb2JqLnRvU3RyaW5nKDE2KS50b1VwcGVyQ2FzZSgpLnNsaWNlKDEpO1xuICAgIH1cbiAgfSxcbiAgZGVmYXVsdFN0eWxlOiAnZGVjaW1hbCcsXG4gIHN0eWxlQWxpYXNlczoge1xuICAgIGJpbmFyeTogWzIsICdiaW4nXSxcbiAgICBvY3RhbDogWzgsICdvY3QnXSxcbiAgICBkZWNpbWFsOiBbMTAsICdkZWMnXSxcbiAgICBoZXhhZGVjaW1hbDogWzE2LCAnaGV4J11cbiAgfVxufSk7XG5cbnZhciBZQU1MX0ZMT0FUX1BBVFRFUk4gPSBuZXcgUmVnRXhwKCAvLyAyLjVlNCwgMi41IGFuZCBpbnRlZ2Vyc1xuJ14oPzpbLStdPyg/OjB8WzEtOV1bMC05X10qKSg/OlxcXFwuWzAtOV9dKik/KD86W2VFXVstK10/WzAtOV0rKT8nICsgLy8gLjJlNCwgLjJcbi8vIHNwZWNpYWwgY2FzZSwgc2VlbXMgbm90IGZyb20gc3BlY1xuJ3xcXFxcLlswLTlfXSsoPzpbZUVdWy0rXT9bMC05XSspPycgKyAvLyAyMDo1OVxuJ3xbLStdP1swLTldWzAtOV9dKig/OjpbMC01XT9bMC05XSkrXFxcXC5bMC05X10qJyArIC8vIC5pbmZcbid8Wy0rXT9cXFxcLig/OmluZnxJbmZ8SU5GKScgKyAvLyAubmFuXG4nfFxcXFwuKD86bmFufE5hTnxOQU4pKSQnKTtcblxuZnVuY3Rpb24gcmVzb2x2ZVlhbWxGbG9hdChkYXRhKSB7XG4gIGlmIChkYXRhID09PSBudWxsKSByZXR1cm4gZmFsc2U7XG5cbiAgaWYgKCFZQU1MX0ZMT0FUX1BBVFRFUk4udGVzdChkYXRhKSB8fCAvLyBRdWljayBoYWNrIHRvIG5vdCBhbGxvdyBpbnRlZ2VycyBlbmQgd2l0aCBgX2BcbiAgLy8gUHJvYmFibHkgc2hvdWxkIHVwZGF0ZSByZWdleHAgJiBjaGVjayBzcGVlZFxuICBkYXRhW2RhdGEubGVuZ3RoIC0gMV0gPT09ICdfJykge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHJldHVybiB0cnVlO1xufVxuXG5mdW5jdGlvbiBjb25zdHJ1Y3RZYW1sRmxvYXQoZGF0YSkge1xuICB2YXIgdmFsdWUsIHNpZ24sIGJhc2UsIGRpZ2l0cztcbiAgdmFsdWUgPSBkYXRhLnJlcGxhY2UoL18vZywgJycpLnRvTG93ZXJDYXNlKCk7XG4gIHNpZ24gPSB2YWx1ZVswXSA9PT0gJy0nID8gLTEgOiAxO1xuICBkaWdpdHMgPSBbXTtcblxuICBpZiAoJystJy5pbmRleE9mKHZhbHVlWzBdKSA+PSAwKSB7XG4gICAgdmFsdWUgPSB2YWx1ZS5zbGljZSgxKTtcbiAgfVxuXG4gIGlmICh2YWx1ZSA9PT0gJy5pbmYnKSB7XG4gICAgcmV0dXJuIHNpZ24gPT09IDEgPyBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkgOiBOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFk7XG4gIH0gZWxzZSBpZiAodmFsdWUgPT09ICcubmFuJykge1xuICAgIHJldHVybiBOYU47XG4gIH0gZWxzZSBpZiAodmFsdWUuaW5kZXhPZignOicpID49IDApIHtcbiAgICB2YWx1ZS5zcGxpdCgnOicpLmZvckVhY2goZnVuY3Rpb24gKHYpIHtcbiAgICAgIGRpZ2l0cy51bnNoaWZ0KHBhcnNlRmxvYXQodiwgMTApKTtcbiAgICB9KTtcbiAgICB2YWx1ZSA9IDAuMDtcbiAgICBiYXNlID0gMTtcbiAgICBkaWdpdHMuZm9yRWFjaChmdW5jdGlvbiAoZCkge1xuICAgICAgdmFsdWUgKz0gZCAqIGJhc2U7XG4gICAgICBiYXNlICo9IDYwO1xuICAgIH0pO1xuICAgIHJldHVybiBzaWduICogdmFsdWU7XG4gIH1cblxuICByZXR1cm4gc2lnbiAqIHBhcnNlRmxvYXQodmFsdWUsIDEwKTtcbn1cblxudmFyIFNDSUVOVElGSUNfV0lUSE9VVF9ET1QgPSAvXlstK10/WzAtOV0rZS87XG5cbmZ1bmN0aW9uIHJlcHJlc2VudFlhbWxGbG9hdChvYmplY3QsIHN0eWxlKSB7XG4gIHZhciByZXM7XG5cbiAgaWYgKGlzTmFOKG9iamVjdCkpIHtcbiAgICBzd2l0Y2ggKHN0eWxlKSB7XG4gICAgICBjYXNlICdsb3dlcmNhc2UnOlxuICAgICAgICByZXR1cm4gJy5uYW4nO1xuXG4gICAgICBjYXNlICd1cHBlcmNhc2UnOlxuICAgICAgICByZXR1cm4gJy5OQU4nO1xuXG4gICAgICBjYXNlICdjYW1lbGNhc2UnOlxuICAgICAgICByZXR1cm4gJy5OYU4nO1xuICAgIH1cbiAgfSBlbHNlIGlmIChOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkgPT09IG9iamVjdCkge1xuICAgIHN3aXRjaCAoc3R5bGUpIHtcbiAgICAgIGNhc2UgJ2xvd2VyY2FzZSc6XG4gICAgICAgIHJldHVybiAnLmluZic7XG5cbiAgICAgIGNhc2UgJ3VwcGVyY2FzZSc6XG4gICAgICAgIHJldHVybiAnLklORic7XG5cbiAgICAgIGNhc2UgJ2NhbWVsY2FzZSc6XG4gICAgICAgIHJldHVybiAnLkluZic7XG4gICAgfVxuICB9IGVsc2UgaWYgKE51bWJlci5ORUdBVElWRV9JTkZJTklUWSA9PT0gb2JqZWN0KSB7XG4gICAgc3dpdGNoIChzdHlsZSkge1xuICAgICAgY2FzZSAnbG93ZXJjYXNlJzpcbiAgICAgICAgcmV0dXJuICctLmluZic7XG5cbiAgICAgIGNhc2UgJ3VwcGVyY2FzZSc6XG4gICAgICAgIHJldHVybiAnLS5JTkYnO1xuXG4gICAgICBjYXNlICdjYW1lbGNhc2UnOlxuICAgICAgICByZXR1cm4gJy0uSW5mJztcbiAgICB9XG4gIH0gZWxzZSBpZiAoY29tbW9uLmlzTmVnYXRpdmVaZXJvKG9iamVjdCkpIHtcbiAgICByZXR1cm4gJy0wLjAnO1xuICB9XG5cbiAgcmVzID0gb2JqZWN0LnRvU3RyaW5nKDEwKTsgLy8gSlMgc3RyaW5naWZpZXIgY2FuIGJ1aWxkIHNjaWVudGlmaWMgZm9ybWF0IHdpdGhvdXQgZG90czogNWUtMTAwLFxuICAvLyB3aGlsZSBZQU1MIHJlcXVyZXMgZG90OiA1LmUtMTAwLiBGaXggaXQgd2l0aCBzaW1wbGUgaGFja1xuXG4gIHJldHVybiBTQ0lFTlRJRklDX1dJVEhPVVRfRE9ULnRlc3QocmVzKSA/IHJlcy5yZXBsYWNlKCdlJywgJy5lJykgOiByZXM7XG59XG5cbmZ1bmN0aW9uIGlzRmxvYXQob2JqZWN0KSB7XG4gIHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwob2JqZWN0KSA9PT0gJ1tvYmplY3QgTnVtYmVyXScgJiYgKG9iamVjdCAlIDEgIT09IDAgfHwgY29tbW9uLmlzTmVnYXRpdmVaZXJvKG9iamVjdCkpO1xufVxuXG52YXIgZmxvYXQgPSBuZXcgdHlwZSgndGFnOnlhbWwub3JnLDIwMDI6ZmxvYXQnLCB7XG4gIGtpbmQ6ICdzY2FsYXInLFxuICByZXNvbHZlOiByZXNvbHZlWWFtbEZsb2F0LFxuICBjb25zdHJ1Y3Q6IGNvbnN0cnVjdFlhbWxGbG9hdCxcbiAgcHJlZGljYXRlOiBpc0Zsb2F0LFxuICByZXByZXNlbnQ6IHJlcHJlc2VudFlhbWxGbG9hdCxcbiAgZGVmYXVsdFN0eWxlOiAnbG93ZXJjYXNlJ1xufSk7XG5cbnZhciBqc29uID0gbmV3IHNjaGVtYSh7XG4gIGluY2x1ZGU6IFtmYWlsc2FmZV0sXG4gIGltcGxpY2l0OiBbX251bGwsIGJvb2wsIGludCwgZmxvYXRdXG59KTtcblxudmFyIGNvcmUgPSBuZXcgc2NoZW1hKHtcbiAgaW5jbHVkZTogW2pzb25dXG59KTtcblxudmFyIFlBTUxfREFURV9SRUdFWFAgPSBuZXcgUmVnRXhwKCdeKFswLTldWzAtOV1bMC05XVswLTldKScgKyAvLyBbMV0geWVhclxuJy0oWzAtOV1bMC05XSknICsgLy8gWzJdIG1vbnRoXG4nLShbMC05XVswLTldKSQnKTsgLy8gWzNdIGRheVxuXG52YXIgWUFNTF9USU1FU1RBTVBfUkVHRVhQID0gbmV3IFJlZ0V4cCgnXihbMC05XVswLTldWzAtOV1bMC05XSknICsgLy8gWzFdIHllYXJcbictKFswLTldWzAtOV0/KScgKyAvLyBbMl0gbW9udGhcbictKFswLTldWzAtOV0/KScgKyAvLyBbM10gZGF5XG4nKD86W1R0XXxbIFxcXFx0XSspJyArIC8vIC4uLlxuJyhbMC05XVswLTldPyknICsgLy8gWzRdIGhvdXJcbic6KFswLTldWzAtOV0pJyArIC8vIFs1XSBtaW51dGVcbic6KFswLTldWzAtOV0pJyArIC8vIFs2XSBzZWNvbmRcbicoPzpcXFxcLihbMC05XSopKT8nICsgLy8gWzddIGZyYWN0aW9uXG4nKD86WyBcXFxcdF0qKFp8KFstK10pKFswLTldWzAtOV0/KScgKyAvLyBbOF0gdHogWzldIHR6X3NpZ24gWzEwXSB0el9ob3VyXG4nKD86OihbMC05XVswLTldKSk/KSk/JCcpOyAvLyBbMTFdIHR6X21pbnV0ZVxuXG5mdW5jdGlvbiByZXNvbHZlWWFtbFRpbWVzdGFtcChkYXRhKSB7XG4gIGlmIChkYXRhID09PSBudWxsKSByZXR1cm4gZmFsc2U7XG4gIGlmIChZQU1MX0RBVEVfUkVHRVhQLmV4ZWMoZGF0YSkgIT09IG51bGwpIHJldHVybiB0cnVlO1xuICBpZiAoWUFNTF9USU1FU1RBTVBfUkVHRVhQLmV4ZWMoZGF0YSkgIT09IG51bGwpIHJldHVybiB0cnVlO1xuICByZXR1cm4gZmFsc2U7XG59XG5cbmZ1bmN0aW9uIGNvbnN0cnVjdFlhbWxUaW1lc3RhbXAoZGF0YSkge1xuICB2YXIgbWF0Y2gsXG4gICAgICB5ZWFyLFxuICAgICAgbW9udGgsXG4gICAgICBkYXksXG4gICAgICBob3VyLFxuICAgICAgbWludXRlLFxuICAgICAgc2Vjb25kLFxuICAgICAgZnJhY3Rpb24gPSAwLFxuICAgICAgZGVsdGEgPSBudWxsLFxuICAgICAgdHpfaG91cixcbiAgICAgIHR6X21pbnV0ZSxcbiAgICAgIGRhdGU7XG4gIG1hdGNoID0gWUFNTF9EQVRFX1JFR0VYUC5leGVjKGRhdGEpO1xuICBpZiAobWF0Y2ggPT09IG51bGwpIG1hdGNoID0gWUFNTF9USU1FU1RBTVBfUkVHRVhQLmV4ZWMoZGF0YSk7XG4gIGlmIChtYXRjaCA9PT0gbnVsbCkgdGhyb3cgbmV3IEVycm9yKCdEYXRlIHJlc29sdmUgZXJyb3InKTsgLy8gbWF0Y2g6IFsxXSB5ZWFyIFsyXSBtb250aCBbM10gZGF5XG5cbiAgeWVhciA9ICttYXRjaFsxXTtcbiAgbW9udGggPSArbWF0Y2hbMl0gLSAxOyAvLyBKUyBtb250aCBzdGFydHMgd2l0aCAwXG5cbiAgZGF5ID0gK21hdGNoWzNdO1xuXG4gIGlmICghbWF0Y2hbNF0pIHtcbiAgICAvLyBubyBob3VyXG4gICAgcmV0dXJuIG5ldyBEYXRlKERhdGUuVVRDKHllYXIsIG1vbnRoLCBkYXkpKTtcbiAgfSAvLyBtYXRjaDogWzRdIGhvdXIgWzVdIG1pbnV0ZSBbNl0gc2Vjb25kIFs3XSBmcmFjdGlvblxuXG5cbiAgaG91ciA9ICttYXRjaFs0XTtcbiAgbWludXRlID0gK21hdGNoWzVdO1xuICBzZWNvbmQgPSArbWF0Y2hbNl07XG5cbiAgaWYgKG1hdGNoWzddKSB7XG4gICAgZnJhY3Rpb24gPSBtYXRjaFs3XS5zbGljZSgwLCAzKTtcblxuICAgIHdoaWxlIChmcmFjdGlvbi5sZW5ndGggPCAzKSB7XG4gICAgICAvLyBtaWxsaS1zZWNvbmRzXG4gICAgICBmcmFjdGlvbiArPSAnMCc7XG4gICAgfVxuXG4gICAgZnJhY3Rpb24gPSArZnJhY3Rpb247XG4gIH0gLy8gbWF0Y2g6IFs4XSB0eiBbOV0gdHpfc2lnbiBbMTBdIHR6X2hvdXIgWzExXSB0el9taW51dGVcblxuXG4gIGlmIChtYXRjaFs5XSkge1xuICAgIHR6X2hvdXIgPSArbWF0Y2hbMTBdO1xuICAgIHR6X21pbnV0ZSA9ICsobWF0Y2hbMTFdIHx8IDApO1xuICAgIGRlbHRhID0gKHR6X2hvdXIgKiA2MCArIHR6X21pbnV0ZSkgKiA2MDAwMDsgLy8gZGVsdGEgaW4gbWlsaS1zZWNvbmRzXG5cbiAgICBpZiAobWF0Y2hbOV0gPT09ICctJykgZGVsdGEgPSAtZGVsdGE7XG4gIH1cblxuICBkYXRlID0gbmV3IERhdGUoRGF0ZS5VVEMoeWVhciwgbW9udGgsIGRheSwgaG91ciwgbWludXRlLCBzZWNvbmQsIGZyYWN0aW9uKSk7XG4gIGlmIChkZWx0YSkgZGF0ZS5zZXRUaW1lKGRhdGUuZ2V0VGltZSgpIC0gZGVsdGEpO1xuICByZXR1cm4gZGF0ZTtcbn1cblxuZnVuY3Rpb24gcmVwcmVzZW50WWFtbFRpbWVzdGFtcChvYmplY3Rcbi8qLCBzdHlsZSovXG4pIHtcbiAgcmV0dXJuIG9iamVjdC50b0lTT1N0cmluZygpO1xufVxuXG52YXIgdGltZXN0YW1wID0gbmV3IHR5cGUoJ3RhZzp5YW1sLm9yZywyMDAyOnRpbWVzdGFtcCcsIHtcbiAga2luZDogJ3NjYWxhcicsXG4gIHJlc29sdmU6IHJlc29sdmVZYW1sVGltZXN0YW1wLFxuICBjb25zdHJ1Y3Q6IGNvbnN0cnVjdFlhbWxUaW1lc3RhbXAsXG4gIGluc3RhbmNlT2Y6IERhdGUsXG4gIHJlcHJlc2VudDogcmVwcmVzZW50WWFtbFRpbWVzdGFtcFxufSk7XG5cbmZ1bmN0aW9uIHJlc29sdmVZYW1sTWVyZ2UoZGF0YSkge1xuICByZXR1cm4gZGF0YSA9PT0gJzw8JyB8fCBkYXRhID09PSBudWxsO1xufVxuXG52YXIgbWVyZ2UgPSBuZXcgdHlwZSgndGFnOnlhbWwub3JnLDIwMDI6bWVyZ2UnLCB7XG4gIGtpbmQ6ICdzY2FsYXInLFxuICByZXNvbHZlOiByZXNvbHZlWWFtbE1lcmdlXG59KTtcblxuZnVuY3Rpb24gY29tbW9uanNSZXF1aXJlICh0YXJnZXQpIHtcblx0dGhyb3cgbmV3IEVycm9yKCdDb3VsZCBub3QgZHluYW1pY2FsbHkgcmVxdWlyZSBcIicgKyB0YXJnZXQgKyAnXCIuIFBsZWFzZSBjb25maWd1cmUgdGhlIGR5bmFtaWNSZXF1aXJlVGFyZ2V0cyBvcHRpb24gb2YgQHJvbGx1cC9wbHVnaW4tY29tbW9uanMgYXBwcm9wcmlhdGVseSBmb3IgdGhpcyByZXF1aXJlIGNhbGwgdG8gYmVoYXZlIHByb3Blcmx5LicpO1xufVxuXG4vKmVzbGludC1kaXNhYmxlIG5vLWJpdHdpc2UqL1xuXG5cbnZhciBOb2RlQnVmZmVyO1xuXG50cnkge1xuICAvLyBBIHRyaWNrIGZvciBicm93c2VyaWZpZWQgdmVyc2lvbiwgdG8gbm90IGluY2x1ZGUgYEJ1ZmZlcmAgc2hpbVxuICB2YXIgX3JlcXVpcmUgPSBjb21tb25qc1JlcXVpcmU7XG4gIE5vZGVCdWZmZXIgPSBfcmVxdWlyZSgnYnVmZmVyJykuQnVmZmVyO1xufSBjYXRjaCAoX18pIHt9IC8vIFsgNjQsIDY1LCA2NiBdIC0+IFsgcGFkZGluZywgQ1IsIExGIF1cblxuXG52YXIgQkFTRTY0X01BUCA9ICdBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSsvPVxcblxccic7XG5cbmZ1bmN0aW9uIHJlc29sdmVZYW1sQmluYXJ5KGRhdGEpIHtcbiAgaWYgKGRhdGEgPT09IG51bGwpIHJldHVybiBmYWxzZTtcbiAgdmFyIGNvZGUsXG4gICAgICBpZHgsXG4gICAgICBiaXRsZW4gPSAwLFxuICAgICAgbWF4ID0gZGF0YS5sZW5ndGgsXG4gICAgICBtYXAgPSBCQVNFNjRfTUFQOyAvLyBDb252ZXJ0IG9uZSBieSBvbmUuXG5cbiAgZm9yIChpZHggPSAwOyBpZHggPCBtYXg7IGlkeCsrKSB7XG4gICAgY29kZSA9IG1hcC5pbmRleE9mKGRhdGEuY2hhckF0KGlkeCkpOyAvLyBTa2lwIENSL0xGXG5cbiAgICBpZiAoY29kZSA+IDY0KSBjb250aW51ZTsgLy8gRmFpbCBvbiBpbGxlZ2FsIGNoYXJhY3RlcnNcblxuICAgIGlmIChjb2RlIDwgMCkgcmV0dXJuIGZhbHNlO1xuICAgIGJpdGxlbiArPSA2O1xuICB9IC8vIElmIHRoZXJlIGFyZSBhbnkgYml0cyBsZWZ0LCBzb3VyY2Ugd2FzIGNvcnJ1cHRlZFxuXG5cbiAgcmV0dXJuIGJpdGxlbiAlIDggPT09IDA7XG59XG5cbmZ1bmN0aW9uIGNvbnN0cnVjdFlhbWxCaW5hcnkoZGF0YSkge1xuICB2YXIgaWR4LFxuICAgICAgdGFpbGJpdHMsXG4gICAgICBpbnB1dCA9IGRhdGEucmVwbGFjZSgvW1xcclxcbj1dL2csICcnKSxcbiAgICAgIC8vIHJlbW92ZSBDUi9MRiAmIHBhZGRpbmcgdG8gc2ltcGxpZnkgc2NhblxuICBtYXggPSBpbnB1dC5sZW5ndGgsXG4gICAgICBtYXAgPSBCQVNFNjRfTUFQLFxuICAgICAgYml0cyA9IDAsXG4gICAgICByZXN1bHQgPSBbXTsgLy8gQ29sbGVjdCBieSA2KjQgYml0cyAoMyBieXRlcylcblxuICBmb3IgKGlkeCA9IDA7IGlkeCA8IG1heDsgaWR4KyspIHtcbiAgICBpZiAoaWR4ICUgNCA9PT0gMCAmJiBpZHgpIHtcbiAgICAgIHJlc3VsdC5wdXNoKGJpdHMgPj4gMTYgJiAweEZGKTtcbiAgICAgIHJlc3VsdC5wdXNoKGJpdHMgPj4gOCAmIDB4RkYpO1xuICAgICAgcmVzdWx0LnB1c2goYml0cyAmIDB4RkYpO1xuICAgIH1cblxuICAgIGJpdHMgPSBiaXRzIDw8IDYgfCBtYXAuaW5kZXhPZihpbnB1dC5jaGFyQXQoaWR4KSk7XG4gIH0gLy8gRHVtcCB0YWlsXG5cblxuICB0YWlsYml0cyA9IG1heCAlIDQgKiA2O1xuXG4gIGlmICh0YWlsYml0cyA9PT0gMCkge1xuICAgIHJlc3VsdC5wdXNoKGJpdHMgPj4gMTYgJiAweEZGKTtcbiAgICByZXN1bHQucHVzaChiaXRzID4+IDggJiAweEZGKTtcbiAgICByZXN1bHQucHVzaChiaXRzICYgMHhGRik7XG4gIH0gZWxzZSBpZiAodGFpbGJpdHMgPT09IDE4KSB7XG4gICAgcmVzdWx0LnB1c2goYml0cyA+PiAxMCAmIDB4RkYpO1xuICAgIHJlc3VsdC5wdXNoKGJpdHMgPj4gMiAmIDB4RkYpO1xuICB9IGVsc2UgaWYgKHRhaWxiaXRzID09PSAxMikge1xuICAgIHJlc3VsdC5wdXNoKGJpdHMgPj4gNCAmIDB4RkYpO1xuICB9IC8vIFdyYXAgaW50byBCdWZmZXIgZm9yIE5vZGVKUyBhbmQgbGVhdmUgQXJyYXkgZm9yIGJyb3dzZXJcblxuXG4gIGlmIChOb2RlQnVmZmVyKSB7XG4gICAgLy8gU3VwcG9ydCBub2RlIDYuKyBCdWZmZXIgQVBJIHdoZW4gYXZhaWxhYmxlXG4gICAgcmV0dXJuIE5vZGVCdWZmZXIuZnJvbSA/IE5vZGVCdWZmZXIuZnJvbShyZXN1bHQpIDogbmV3IE5vZGVCdWZmZXIocmVzdWx0KTtcbiAgfVxuXG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmZ1bmN0aW9uIHJlcHJlc2VudFlhbWxCaW5hcnkob2JqZWN0XG4vKiwgc3R5bGUqL1xuKSB7XG4gIHZhciByZXN1bHQgPSAnJyxcbiAgICAgIGJpdHMgPSAwLFxuICAgICAgaWR4LFxuICAgICAgdGFpbCxcbiAgICAgIG1heCA9IG9iamVjdC5sZW5ndGgsXG4gICAgICBtYXAgPSBCQVNFNjRfTUFQOyAvLyBDb252ZXJ0IGV2ZXJ5IHRocmVlIGJ5dGVzIHRvIDQgQVNDSUkgY2hhcmFjdGVycy5cblxuICBmb3IgKGlkeCA9IDA7IGlkeCA8IG1heDsgaWR4KyspIHtcbiAgICBpZiAoaWR4ICUgMyA9PT0gMCAmJiBpZHgpIHtcbiAgICAgIHJlc3VsdCArPSBtYXBbYml0cyA+PiAxOCAmIDB4M0ZdO1xuICAgICAgcmVzdWx0ICs9IG1hcFtiaXRzID4+IDEyICYgMHgzRl07XG4gICAgICByZXN1bHQgKz0gbWFwW2JpdHMgPj4gNiAmIDB4M0ZdO1xuICAgICAgcmVzdWx0ICs9IG1hcFtiaXRzICYgMHgzRl07XG4gICAgfVxuXG4gICAgYml0cyA9IChiaXRzIDw8IDgpICsgb2JqZWN0W2lkeF07XG4gIH0gLy8gRHVtcCB0YWlsXG5cblxuICB0YWlsID0gbWF4ICUgMztcblxuICBpZiAodGFpbCA9PT0gMCkge1xuICAgIHJlc3VsdCArPSBtYXBbYml0cyA+PiAxOCAmIDB4M0ZdO1xuICAgIHJlc3VsdCArPSBtYXBbYml0cyA+PiAxMiAmIDB4M0ZdO1xuICAgIHJlc3VsdCArPSBtYXBbYml0cyA+PiA2ICYgMHgzRl07XG4gICAgcmVzdWx0ICs9IG1hcFtiaXRzICYgMHgzRl07XG4gIH0gZWxzZSBpZiAodGFpbCA9PT0gMikge1xuICAgIHJlc3VsdCArPSBtYXBbYml0cyA+PiAxMCAmIDB4M0ZdO1xuICAgIHJlc3VsdCArPSBtYXBbYml0cyA+PiA0ICYgMHgzRl07XG4gICAgcmVzdWx0ICs9IG1hcFtiaXRzIDw8IDIgJiAweDNGXTtcbiAgICByZXN1bHQgKz0gbWFwWzY0XTtcbiAgfSBlbHNlIGlmICh0YWlsID09PSAxKSB7XG4gICAgcmVzdWx0ICs9IG1hcFtiaXRzID4+IDIgJiAweDNGXTtcbiAgICByZXN1bHQgKz0gbWFwW2JpdHMgPDwgNCAmIDB4M0ZdO1xuICAgIHJlc3VsdCArPSBtYXBbNjRdO1xuICAgIHJlc3VsdCArPSBtYXBbNjRdO1xuICB9XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZnVuY3Rpb24gaXNCaW5hcnkob2JqZWN0KSB7XG4gIHJldHVybiBOb2RlQnVmZmVyICYmIE5vZGVCdWZmZXIuaXNCdWZmZXIob2JqZWN0KTtcbn1cblxudmFyIGJpbmFyeSA9IG5ldyB0eXBlKCd0YWc6eWFtbC5vcmcsMjAwMjpiaW5hcnknLCB7XG4gIGtpbmQ6ICdzY2FsYXInLFxuICByZXNvbHZlOiByZXNvbHZlWWFtbEJpbmFyeSxcbiAgY29uc3RydWN0OiBjb25zdHJ1Y3RZYW1sQmluYXJ5LFxuICBwcmVkaWNhdGU6IGlzQmluYXJ5LFxuICByZXByZXNlbnQ6IHJlcHJlc2VudFlhbWxCaW5hcnlcbn0pO1xuXG52YXIgX2hhc093blByb3BlcnR5ID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eTtcbnZhciBfdG9TdHJpbmcgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nO1xuXG5mdW5jdGlvbiByZXNvbHZlWWFtbE9tYXAoZGF0YSkge1xuICBpZiAoZGF0YSA9PT0gbnVsbCkgcmV0dXJuIHRydWU7XG4gIHZhciBvYmplY3RLZXlzID0gW10sXG4gICAgICBpbmRleCxcbiAgICAgIGxlbmd0aCxcbiAgICAgIHBhaXIsXG4gICAgICBwYWlyS2V5LFxuICAgICAgcGFpckhhc0tleSxcbiAgICAgIG9iamVjdCA9IGRhdGE7XG5cbiAgZm9yIChpbmRleCA9IDAsIGxlbmd0aCA9IG9iamVjdC5sZW5ndGg7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCArPSAxKSB7XG4gICAgcGFpciA9IG9iamVjdFtpbmRleF07XG4gICAgcGFpckhhc0tleSA9IGZhbHNlO1xuICAgIGlmIChfdG9TdHJpbmcuY2FsbChwYWlyKSAhPT0gJ1tvYmplY3QgT2JqZWN0XScpIHJldHVybiBmYWxzZTtcblxuICAgIGZvciAocGFpcktleSBpbiBwYWlyKSB7XG4gICAgICBpZiAoX2hhc093blByb3BlcnR5LmNhbGwocGFpciwgcGFpcktleSkpIHtcbiAgICAgICAgaWYgKCFwYWlySGFzS2V5KSBwYWlySGFzS2V5ID0gdHJ1ZTtlbHNlIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoIXBhaXJIYXNLZXkpIHJldHVybiBmYWxzZTtcbiAgICBpZiAob2JqZWN0S2V5cy5pbmRleE9mKHBhaXJLZXkpID09PSAtMSkgb2JqZWN0S2V5cy5wdXNoKHBhaXJLZXkpO2Vsc2UgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgcmV0dXJuIHRydWU7XG59XG5cbmZ1bmN0aW9uIGNvbnN0cnVjdFlhbWxPbWFwKGRhdGEpIHtcbiAgcmV0dXJuIGRhdGEgIT09IG51bGwgPyBkYXRhIDogW107XG59XG5cbnZhciBvbWFwID0gbmV3IHR5cGUoJ3RhZzp5YW1sLm9yZywyMDAyOm9tYXAnLCB7XG4gIGtpbmQ6ICdzZXF1ZW5jZScsXG4gIHJlc29sdmU6IHJlc29sdmVZYW1sT21hcCxcbiAgY29uc3RydWN0OiBjb25zdHJ1Y3RZYW1sT21hcFxufSk7XG5cbnZhciBfdG9TdHJpbmckMSA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmc7XG5cbmZ1bmN0aW9uIHJlc29sdmVZYW1sUGFpcnMoZGF0YSkge1xuICBpZiAoZGF0YSA9PT0gbnVsbCkgcmV0dXJuIHRydWU7XG4gIHZhciBpbmRleCxcbiAgICAgIGxlbmd0aCxcbiAgICAgIHBhaXIsXG4gICAgICBrZXlzLFxuICAgICAgcmVzdWx0LFxuICAgICAgb2JqZWN0ID0gZGF0YTtcbiAgcmVzdWx0ID0gbmV3IEFycmF5KG9iamVjdC5sZW5ndGgpO1xuXG4gIGZvciAoaW5kZXggPSAwLCBsZW5ndGggPSBvYmplY3QubGVuZ3RoOyBpbmRleCA8IGxlbmd0aDsgaW5kZXggKz0gMSkge1xuICAgIHBhaXIgPSBvYmplY3RbaW5kZXhdO1xuICAgIGlmIChfdG9TdHJpbmckMS5jYWxsKHBhaXIpICE9PSAnW29iamVjdCBPYmplY3RdJykgcmV0dXJuIGZhbHNlO1xuICAgIGtleXMgPSBPYmplY3Qua2V5cyhwYWlyKTtcbiAgICBpZiAoa2V5cy5sZW5ndGggIT09IDEpIHJldHVybiBmYWxzZTtcbiAgICByZXN1bHRbaW5kZXhdID0gW2tleXNbMF0sIHBhaXJba2V5c1swXV1dO1xuICB9XG5cbiAgcmV0dXJuIHRydWU7XG59XG5cbmZ1bmN0aW9uIGNvbnN0cnVjdFlhbWxQYWlycyhkYXRhKSB7XG4gIGlmIChkYXRhID09PSBudWxsKSByZXR1cm4gW107XG4gIHZhciBpbmRleCxcbiAgICAgIGxlbmd0aCxcbiAgICAgIHBhaXIsXG4gICAgICBrZXlzLFxuICAgICAgcmVzdWx0LFxuICAgICAgb2JqZWN0ID0gZGF0YTtcbiAgcmVzdWx0ID0gbmV3IEFycmF5KG9iamVjdC5sZW5ndGgpO1xuXG4gIGZvciAoaW5kZXggPSAwLCBsZW5ndGggPSBvYmplY3QubGVuZ3RoOyBpbmRleCA8IGxlbmd0aDsgaW5kZXggKz0gMSkge1xuICAgIHBhaXIgPSBvYmplY3RbaW5kZXhdO1xuICAgIGtleXMgPSBPYmplY3Qua2V5cyhwYWlyKTtcbiAgICByZXN1bHRbaW5kZXhdID0gW2tleXNbMF0sIHBhaXJba2V5c1swXV1dO1xuICB9XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxudmFyIHBhaXJzID0gbmV3IHR5cGUoJ3RhZzp5YW1sLm9yZywyMDAyOnBhaXJzJywge1xuICBraW5kOiAnc2VxdWVuY2UnLFxuICByZXNvbHZlOiByZXNvbHZlWWFtbFBhaXJzLFxuICBjb25zdHJ1Y3Q6IGNvbnN0cnVjdFlhbWxQYWlyc1xufSk7XG5cbnZhciBfaGFzT3duUHJvcGVydHkkMSA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7XG5cbmZ1bmN0aW9uIHJlc29sdmVZYW1sU2V0KGRhdGEpIHtcbiAgaWYgKGRhdGEgPT09IG51bGwpIHJldHVybiB0cnVlO1xuICB2YXIga2V5LFxuICAgICAgb2JqZWN0ID0gZGF0YTtcblxuICBmb3IgKGtleSBpbiBvYmplY3QpIHtcbiAgICBpZiAoX2hhc093blByb3BlcnR5JDEuY2FsbChvYmplY3QsIGtleSkpIHtcbiAgICAgIGlmIChvYmplY3Rba2V5XSAhPT0gbnVsbCkgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB0cnVlO1xufVxuXG5mdW5jdGlvbiBjb25zdHJ1Y3RZYW1sU2V0KGRhdGEpIHtcbiAgcmV0dXJuIGRhdGEgIT09IG51bGwgPyBkYXRhIDoge307XG59XG5cbnZhciBzZXQgPSBuZXcgdHlwZSgndGFnOnlhbWwub3JnLDIwMDI6c2V0Jywge1xuICBraW5kOiAnbWFwcGluZycsXG4gIHJlc29sdmU6IHJlc29sdmVZYW1sU2V0LFxuICBjb25zdHJ1Y3Q6IGNvbnN0cnVjdFlhbWxTZXRcbn0pO1xuXG52YXIgZGVmYXVsdF9zYWZlID0gbmV3IHNjaGVtYSh7XG4gIGluY2x1ZGU6IFtjb3JlXSxcbiAgaW1wbGljaXQ6IFt0aW1lc3RhbXAsIG1lcmdlXSxcbiAgZXhwbGljaXQ6IFtiaW5hcnksIG9tYXAsIHBhaXJzLCBzZXRdXG59KTtcblxuZnVuY3Rpb24gcmVzb2x2ZUphdmFzY3JpcHRVbmRlZmluZWQoKSB7XG4gIHJldHVybiB0cnVlO1xufVxuXG5mdW5jdGlvbiBjb25zdHJ1Y3RKYXZhc2NyaXB0VW5kZWZpbmVkKCkge1xuICAvKmVzbGludC1kaXNhYmxlIG5vLXVuZGVmaW5lZCovXG4gIHJldHVybiB1bmRlZmluZWQ7XG59XG5cbmZ1bmN0aW9uIHJlcHJlc2VudEphdmFzY3JpcHRVbmRlZmluZWQoKSB7XG4gIHJldHVybiAnJztcbn1cblxuZnVuY3Rpb24gaXNVbmRlZmluZWQob2JqZWN0KSB7XG4gIHJldHVybiB0eXBlb2Ygb2JqZWN0ID09PSAndW5kZWZpbmVkJztcbn1cblxudmFyIF91bmRlZmluZWQgPSBuZXcgdHlwZSgndGFnOnlhbWwub3JnLDIwMDI6anMvdW5kZWZpbmVkJywge1xuICBraW5kOiAnc2NhbGFyJyxcbiAgcmVzb2x2ZTogcmVzb2x2ZUphdmFzY3JpcHRVbmRlZmluZWQsXG4gIGNvbnN0cnVjdDogY29uc3RydWN0SmF2YXNjcmlwdFVuZGVmaW5lZCxcbiAgcHJlZGljYXRlOiBpc1VuZGVmaW5lZCxcbiAgcmVwcmVzZW50OiByZXByZXNlbnRKYXZhc2NyaXB0VW5kZWZpbmVkXG59KTtcblxuZnVuY3Rpb24gcmVzb2x2ZUphdmFzY3JpcHRSZWdFeHAoZGF0YSkge1xuICBpZiAoZGF0YSA9PT0gbnVsbCkgcmV0dXJuIGZhbHNlO1xuICBpZiAoZGF0YS5sZW5ndGggPT09IDApIHJldHVybiBmYWxzZTtcbiAgdmFyIHJlZ2V4cCA9IGRhdGEsXG4gICAgICB0YWlsID0gL1xcLyhbZ2ltXSopJC8uZXhlYyhkYXRhKSxcbiAgICAgIG1vZGlmaWVycyA9ICcnOyAvLyBpZiByZWdleHAgc3RhcnRzIHdpdGggJy8nIGl0IGNhbiBoYXZlIG1vZGlmaWVycyBhbmQgbXVzdCBiZSBwcm9wZXJseSBjbG9zZWRcbiAgLy8gYC9mb28vZ2ltYCAtIG1vZGlmaWVycyB0YWlsIGNhbiBiZSBtYXhpbXVtIDMgY2hhcnNcblxuICBpZiAocmVnZXhwWzBdID09PSAnLycpIHtcbiAgICBpZiAodGFpbCkgbW9kaWZpZXJzID0gdGFpbFsxXTtcbiAgICBpZiAobW9kaWZpZXJzLmxlbmd0aCA+IDMpIHJldHVybiBmYWxzZTsgLy8gaWYgZXhwcmVzc2lvbiBzdGFydHMgd2l0aCAvLCBpcyBzaG91bGQgYmUgcHJvcGVybHkgdGVybWluYXRlZFxuXG4gICAgaWYgKHJlZ2V4cFtyZWdleHAubGVuZ3RoIC0gbW9kaWZpZXJzLmxlbmd0aCAtIDFdICE9PSAnLycpIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHJldHVybiB0cnVlO1xufVxuXG5mdW5jdGlvbiBjb25zdHJ1Y3RKYXZhc2NyaXB0UmVnRXhwKGRhdGEpIHtcbiAgdmFyIHJlZ2V4cCA9IGRhdGEsXG4gICAgICB0YWlsID0gL1xcLyhbZ2ltXSopJC8uZXhlYyhkYXRhKSxcbiAgICAgIG1vZGlmaWVycyA9ICcnOyAvLyBgL2Zvby9naW1gIC0gdGFpbCBjYW4gYmUgbWF4aW11bSA0IGNoYXJzXG5cbiAgaWYgKHJlZ2V4cFswXSA9PT0gJy8nKSB7XG4gICAgaWYgKHRhaWwpIG1vZGlmaWVycyA9IHRhaWxbMV07XG4gICAgcmVnZXhwID0gcmVnZXhwLnNsaWNlKDEsIHJlZ2V4cC5sZW5ndGggLSBtb2RpZmllcnMubGVuZ3RoIC0gMSk7XG4gIH1cblxuICByZXR1cm4gbmV3IFJlZ0V4cChyZWdleHAsIG1vZGlmaWVycyk7XG59XG5cbmZ1bmN0aW9uIHJlcHJlc2VudEphdmFzY3JpcHRSZWdFeHAob2JqZWN0XG4vKiwgc3R5bGUqL1xuKSB7XG4gIHZhciByZXN1bHQgPSAnLycgKyBvYmplY3Quc291cmNlICsgJy8nO1xuICBpZiAob2JqZWN0Lmdsb2JhbCkgcmVzdWx0ICs9ICdnJztcbiAgaWYgKG9iamVjdC5tdWx0aWxpbmUpIHJlc3VsdCArPSAnbSc7XG4gIGlmIChvYmplY3QuaWdub3JlQ2FzZSkgcmVzdWx0ICs9ICdpJztcbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZnVuY3Rpb24gaXNSZWdFeHAob2JqZWN0KSB7XG4gIHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwob2JqZWN0KSA9PT0gJ1tvYmplY3QgUmVnRXhwXSc7XG59XG5cbnZhciByZWdleHAgPSBuZXcgdHlwZSgndGFnOnlhbWwub3JnLDIwMDI6anMvcmVnZXhwJywge1xuICBraW5kOiAnc2NhbGFyJyxcbiAgcmVzb2x2ZTogcmVzb2x2ZUphdmFzY3JpcHRSZWdFeHAsXG4gIGNvbnN0cnVjdDogY29uc3RydWN0SmF2YXNjcmlwdFJlZ0V4cCxcbiAgcHJlZGljYXRlOiBpc1JlZ0V4cCxcbiAgcmVwcmVzZW50OiByZXByZXNlbnRKYXZhc2NyaXB0UmVnRXhwXG59KTtcblxudmFyIGVzcHJpbWE7IC8vIEJyb3dzZXJpZmllZCB2ZXJzaW9uIGRvZXMgbm90IGhhdmUgZXNwcmltYVxuLy9cbi8vIDEuIEZvciBub2RlLmpzIGp1c3QgcmVxdWlyZSBtb2R1bGUgYXMgZGVwc1xuLy8gMi4gRm9yIGJyb3dzZXIgdHJ5IHRvIHJlcXVpcmUgbXVkdWxlIHZpYSBleHRlcm5hbCBBTUQgc3lzdGVtLlxuLy8gICAgSWYgbm90IGZvdW5kIC0gdHJ5IHRvIGZhbGxiYWNrIHRvIHdpbmRvdy5lc3ByaW1hLiBJZiBub3Rcbi8vICAgIGZvdW5kIHRvbyAtIHRoZW4gZmFpbCB0byBwYXJzZS5cbi8vXG5cbnRyeSB7XG4gIC8vIHdvcmthcm91bmQgdG8gZXhjbHVkZSBwYWNrYWdlIGZyb20gYnJvd3NlcmlmeSBsaXN0LlxuICB2YXIgX3JlcXVpcmUkMSA9IGNvbW1vbmpzUmVxdWlyZTtcbiAgZXNwcmltYSA9IF9yZXF1aXJlJDEoJ2VzcHJpbWEnKTtcbn0gY2F0Y2ggKF8pIHtcbiAgLyogZXNsaW50LWRpc2FibGUgbm8tcmVkZWNsYXJlICovXG5cbiAgLyogZ2xvYmFsIHdpbmRvdyAqL1xuICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIGVzcHJpbWEgPSB3aW5kb3cuZXNwcmltYTtcbn1cblxuZnVuY3Rpb24gcmVzb2x2ZUphdmFzY3JpcHRGdW5jdGlvbihkYXRhKSB7XG4gIGlmIChkYXRhID09PSBudWxsKSByZXR1cm4gZmFsc2U7XG5cbiAgdHJ5IHtcbiAgICB2YXIgc291cmNlID0gJygnICsgZGF0YSArICcpJyxcbiAgICAgICAgYXN0ID0gZXNwcmltYS5wYXJzZShzb3VyY2UsIHtcbiAgICAgIHJhbmdlOiB0cnVlXG4gICAgfSk7XG5cbiAgICBpZiAoYXN0LnR5cGUgIT09ICdQcm9ncmFtJyB8fCBhc3QuYm9keS5sZW5ndGggIT09IDEgfHwgYXN0LmJvZHlbMF0udHlwZSAhPT0gJ0V4cHJlc3Npb25TdGF0ZW1lbnQnIHx8IGFzdC5ib2R5WzBdLmV4cHJlc3Npb24udHlwZSAhPT0gJ0Fycm93RnVuY3Rpb25FeHByZXNzaW9uJyAmJiBhc3QuYm9keVswXS5leHByZXNzaW9uLnR5cGUgIT09ICdGdW5jdGlvbkV4cHJlc3Npb24nKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufVxuXG5mdW5jdGlvbiBjb25zdHJ1Y3RKYXZhc2NyaXB0RnVuY3Rpb24oZGF0YSkge1xuICAvKmpzbGludCBldmlsOnRydWUqL1xuICB2YXIgc291cmNlID0gJygnICsgZGF0YSArICcpJyxcbiAgICAgIGFzdCA9IGVzcHJpbWEucGFyc2Uoc291cmNlLCB7XG4gICAgcmFuZ2U6IHRydWVcbiAgfSksXG4gICAgICBwYXJhbXMgPSBbXSxcbiAgICAgIGJvZHk7XG5cbiAgaWYgKGFzdC50eXBlICE9PSAnUHJvZ3JhbScgfHwgYXN0LmJvZHkubGVuZ3RoICE9PSAxIHx8IGFzdC5ib2R5WzBdLnR5cGUgIT09ICdFeHByZXNzaW9uU3RhdGVtZW50JyB8fCBhc3QuYm9keVswXS5leHByZXNzaW9uLnR5cGUgIT09ICdBcnJvd0Z1bmN0aW9uRXhwcmVzc2lvbicgJiYgYXN0LmJvZHlbMF0uZXhwcmVzc2lvbi50eXBlICE9PSAnRnVuY3Rpb25FeHByZXNzaW9uJykge1xuICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIHJlc29sdmUgZnVuY3Rpb24nKTtcbiAgfVxuXG4gIGFzdC5ib2R5WzBdLmV4cHJlc3Npb24ucGFyYW1zLmZvckVhY2goZnVuY3Rpb24gKHBhcmFtKSB7XG4gICAgcGFyYW1zLnB1c2gocGFyYW0ubmFtZSk7XG4gIH0pO1xuICBib2R5ID0gYXN0LmJvZHlbMF0uZXhwcmVzc2lvbi5ib2R5LnJhbmdlOyAvLyBFc3ByaW1hJ3MgcmFuZ2VzIGluY2x1ZGUgdGhlIGZpcnN0ICd7JyBhbmQgdGhlIGxhc3QgJ30nIGNoYXJhY3RlcnMgb25cbiAgLy8gZnVuY3Rpb24gZXhwcmVzc2lvbnMuIFNvIGN1dCB0aGVtIG91dC5cblxuICBpZiAoYXN0LmJvZHlbMF0uZXhwcmVzc2lvbi5ib2R5LnR5cGUgPT09ICdCbG9ja1N0YXRlbWVudCcpIHtcbiAgICAvKmVzbGludC1kaXNhYmxlIG5vLW5ldy1mdW5jKi9cbiAgICByZXR1cm4gbmV3IEZ1bmN0aW9uKHBhcmFtcywgc291cmNlLnNsaWNlKGJvZHlbMF0gKyAxLCBib2R5WzFdIC0gMSkpO1xuICB9IC8vIEVTNiBhcnJvdyBmdW5jdGlvbnMgY2FuIG9taXQgdGhlIEJsb2NrU3RhdGVtZW50LiBJbiB0aGF0IGNhc2UsIGp1c3QgcmV0dXJuXG4gIC8vIHRoZSBib2R5LlxuXG4gIC8qZXNsaW50LWRpc2FibGUgbm8tbmV3LWZ1bmMqL1xuXG5cbiAgcmV0dXJuIG5ldyBGdW5jdGlvbihwYXJhbXMsICdyZXR1cm4gJyArIHNvdXJjZS5zbGljZShib2R5WzBdLCBib2R5WzFdKSk7XG59XG5cbmZ1bmN0aW9uIHJlcHJlc2VudEphdmFzY3JpcHRGdW5jdGlvbihvYmplY3Rcbi8qLCBzdHlsZSovXG4pIHtcbiAgcmV0dXJuIG9iamVjdC50b1N0cmluZygpO1xufVxuXG5mdW5jdGlvbiBpc0Z1bmN0aW9uKG9iamVjdCkge1xuICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG9iamVjdCkgPT09ICdbb2JqZWN0IEZ1bmN0aW9uXSc7XG59XG5cbnZhciBfZnVuY3Rpb24gPSBuZXcgdHlwZSgndGFnOnlhbWwub3JnLDIwMDI6anMvZnVuY3Rpb24nLCB7XG4gIGtpbmQ6ICdzY2FsYXInLFxuICByZXNvbHZlOiByZXNvbHZlSmF2YXNjcmlwdEZ1bmN0aW9uLFxuICBjb25zdHJ1Y3Q6IGNvbnN0cnVjdEphdmFzY3JpcHRGdW5jdGlvbixcbiAgcHJlZGljYXRlOiBpc0Z1bmN0aW9uLFxuICByZXByZXNlbnQ6IHJlcHJlc2VudEphdmFzY3JpcHRGdW5jdGlvblxufSk7XG5cbnZhciBkZWZhdWx0X2Z1bGwgPSBzY2hlbWEuREVGQVVMVCA9IG5ldyBzY2hlbWEoe1xuICBpbmNsdWRlOiBbZGVmYXVsdF9zYWZlXSxcbiAgZXhwbGljaXQ6IFtfdW5kZWZpbmVkLCByZWdleHAsIF9mdW5jdGlvbl1cbn0pO1xuXG4vKmVzbGludC1kaXNhYmxlIG1heC1sZW4sbm8tdXNlLWJlZm9yZS1kZWZpbmUqL1xuXG5cbnZhciBfaGFzT3duUHJvcGVydHkkMiA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7XG52YXIgQ09OVEVYVF9GTE9XX0lOID0gMTtcbnZhciBDT05URVhUX0ZMT1dfT1VUID0gMjtcbnZhciBDT05URVhUX0JMT0NLX0lOID0gMztcbnZhciBDT05URVhUX0JMT0NLX09VVCA9IDQ7XG52YXIgQ0hPTVBJTkdfQ0xJUCA9IDE7XG52YXIgQ0hPTVBJTkdfU1RSSVAgPSAyO1xudmFyIENIT01QSU5HX0tFRVAgPSAzO1xudmFyIFBBVFRFUk5fTk9OX1BSSU5UQUJMRSA9IC9bXFx4MDAtXFx4MDhcXHgwQlxceDBDXFx4MEUtXFx4MUZcXHg3Ri1cXHg4NFxceDg2LVxceDlGXFx1RkZGRVxcdUZGRkZdfFtcXHVEODAwLVxcdURCRkZdKD8hW1xcdURDMDAtXFx1REZGRl0pfCg/OlteXFx1RDgwMC1cXHVEQkZGXXxeKVtcXHVEQzAwLVxcdURGRkZdLztcbnZhciBQQVRURVJOX05PTl9BU0NJSV9MSU5FX0JSRUFLUyA9IC9bXFx4ODVcXHUyMDI4XFx1MjAyOV0vO1xudmFyIFBBVFRFUk5fRkxPV19JTkRJQ0FUT1JTID0gL1ssXFxbXFxdXFx7XFx9XS87XG52YXIgUEFUVEVSTl9UQUdfSEFORExFID0gL14oPzohfCEhfCFbYS16XFwtXSshKSQvaTtcbnZhciBQQVRURVJOX1RBR19VUkkgPSAvXig/OiF8W14sXFxbXFxdXFx7XFx9XSkoPzolWzAtOWEtZl17Mn18WzAtOWEtelxcLSM7XFwvXFw/OkAmPVxcK1xcJCxfXFwuIX5cXConXFwoXFwpXFxbXFxdXSkqJC9pO1xuXG5mdW5jdGlvbiBfY2xhc3Mob2JqKSB7XG4gIHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwob2JqKTtcbn1cblxuZnVuY3Rpb24gaXNfRU9MKGMpIHtcbiAgcmV0dXJuIGMgPT09IDB4MEFcbiAgLyogTEYgKi9cbiAgfHwgYyA9PT0gMHgwRFxuICAvKiBDUiAqL1xuICA7XG59XG5cbmZ1bmN0aW9uIGlzX1dISVRFX1NQQUNFKGMpIHtcbiAgcmV0dXJuIGMgPT09IDB4MDlcbiAgLyogVGFiICovXG4gIHx8IGMgPT09IDB4MjBcbiAgLyogU3BhY2UgKi9cbiAgO1xufVxuXG5mdW5jdGlvbiBpc19XU19PUl9FT0woYykge1xuICByZXR1cm4gYyA9PT0gMHgwOVxuICAvKiBUYWIgKi9cbiAgfHwgYyA9PT0gMHgyMFxuICAvKiBTcGFjZSAqL1xuICB8fCBjID09PSAweDBBXG4gIC8qIExGICovXG4gIHx8IGMgPT09IDB4MERcbiAgLyogQ1IgKi9cbiAgO1xufVxuXG5mdW5jdGlvbiBpc19GTE9XX0lORElDQVRPUihjKSB7XG4gIHJldHVybiBjID09PSAweDJDXG4gIC8qICwgKi9cbiAgfHwgYyA9PT0gMHg1QlxuICAvKiBbICovXG4gIHx8IGMgPT09IDB4NURcbiAgLyogXSAqL1xuICB8fCBjID09PSAweDdCXG4gIC8qIHsgKi9cbiAgfHwgYyA9PT0gMHg3RFxuICAvKiB9ICovXG4gIDtcbn1cblxuZnVuY3Rpb24gZnJvbUhleENvZGUoYykge1xuICB2YXIgbGM7XG5cbiAgaWYgKDB4MzBcbiAgLyogMCAqL1xuICA8PSBjICYmIGMgPD0gMHgzOVxuICAvKiA5ICovXG4gICkge1xuICAgIHJldHVybiBjIC0gMHgzMDtcbiAgfVxuICAvKmVzbGludC1kaXNhYmxlIG5vLWJpdHdpc2UqL1xuXG5cbiAgbGMgPSBjIHwgMHgyMDtcblxuICBpZiAoMHg2MVxuICAvKiBhICovXG4gIDw9IGxjICYmIGxjIDw9IDB4NjZcbiAgLyogZiAqL1xuICApIHtcbiAgICByZXR1cm4gbGMgLSAweDYxICsgMTA7XG4gIH1cblxuICByZXR1cm4gLTE7XG59XG5cbmZ1bmN0aW9uIGVzY2FwZWRIZXhMZW4oYykge1xuICBpZiAoYyA9PT0gMHg3OFxuICAvKiB4ICovXG4gICkge1xuICAgICAgcmV0dXJuIDI7XG4gICAgfVxuXG4gIGlmIChjID09PSAweDc1XG4gIC8qIHUgKi9cbiAgKSB7XG4gICAgICByZXR1cm4gNDtcbiAgICB9XG5cbiAgaWYgKGMgPT09IDB4NTVcbiAgLyogVSAqL1xuICApIHtcbiAgICAgIHJldHVybiA4O1xuICAgIH1cblxuICByZXR1cm4gMDtcbn1cblxuZnVuY3Rpb24gZnJvbURlY2ltYWxDb2RlKGMpIHtcbiAgaWYgKDB4MzBcbiAgLyogMCAqL1xuICA8PSBjICYmIGMgPD0gMHgzOVxuICAvKiA5ICovXG4gICkge1xuICAgIHJldHVybiBjIC0gMHgzMDtcbiAgfVxuXG4gIHJldHVybiAtMTtcbn1cblxuZnVuY3Rpb24gc2ltcGxlRXNjYXBlU2VxdWVuY2UoYykge1xuICAvKiBlc2xpbnQtZGlzYWJsZSBpbmRlbnQgKi9cbiAgcmV0dXJuIGMgPT09IDB4MzBcbiAgLyogMCAqL1xuICA/ICdcXHgwMCcgOiBjID09PSAweDYxXG4gIC8qIGEgKi9cbiAgPyAnXFx4MDcnIDogYyA9PT0gMHg2MlxuICAvKiBiICovXG4gID8gJ1xceDA4JyA6IGMgPT09IDB4NzRcbiAgLyogdCAqL1xuICA/ICdcXHgwOScgOiBjID09PSAweDA5XG4gIC8qIFRhYiAqL1xuICA/ICdcXHgwOScgOiBjID09PSAweDZFXG4gIC8qIG4gKi9cbiAgPyAnXFx4MEEnIDogYyA9PT0gMHg3NlxuICAvKiB2ICovXG4gID8gJ1xceDBCJyA6IGMgPT09IDB4NjZcbiAgLyogZiAqL1xuICA/ICdcXHgwQycgOiBjID09PSAweDcyXG4gIC8qIHIgKi9cbiAgPyAnXFx4MEQnIDogYyA9PT0gMHg2NVxuICAvKiBlICovXG4gID8gJ1xceDFCJyA6IGMgPT09IDB4MjBcbiAgLyogU3BhY2UgKi9cbiAgPyAnICcgOiBjID09PSAweDIyXG4gIC8qIFwiICovXG4gID8gJ1xceDIyJyA6IGMgPT09IDB4MkZcbiAgLyogLyAqL1xuICA/ICcvJyA6IGMgPT09IDB4NUNcbiAgLyogXFwgKi9cbiAgPyAnXFx4NUMnIDogYyA9PT0gMHg0RVxuICAvKiBOICovXG4gID8gJ1xceDg1JyA6IGMgPT09IDB4NUZcbiAgLyogXyAqL1xuICA/ICdcXHhBMCcgOiBjID09PSAweDRDXG4gIC8qIEwgKi9cbiAgPyBcIlxcdTIwMjhcIiA6IGMgPT09IDB4NTBcbiAgLyogUCAqL1xuICA/IFwiXFx1MjAyOVwiIDogJyc7XG59XG5cbmZ1bmN0aW9uIGNoYXJGcm9tQ29kZXBvaW50KGMpIHtcbiAgaWYgKGMgPD0gMHhGRkZGKSB7XG4gICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoYyk7XG4gIH0gLy8gRW5jb2RlIFVURi0xNiBzdXJyb2dhdGUgcGFpclxuICAvLyBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9VVEYtMTYjQ29kZV9wb2ludHNfVS4yQjAxMDAwMF90b19VLjJCMTBGRkZGXG5cblxuICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZSgoYyAtIDB4MDEwMDAwID4+IDEwKSArIDB4RDgwMCwgKGMgLSAweDAxMDAwMCAmIDB4MDNGRikgKyAweERDMDApO1xufVxuXG52YXIgc2ltcGxlRXNjYXBlQ2hlY2sgPSBuZXcgQXJyYXkoMjU2KTsgLy8gaW50ZWdlciwgZm9yIGZhc3QgYWNjZXNzXG5cbnZhciBzaW1wbGVFc2NhcGVNYXAgPSBuZXcgQXJyYXkoMjU2KTtcblxuZm9yICh2YXIgaSA9IDA7IGkgPCAyNTY7IGkrKykge1xuICBzaW1wbGVFc2NhcGVDaGVja1tpXSA9IHNpbXBsZUVzY2FwZVNlcXVlbmNlKGkpID8gMSA6IDA7XG4gIHNpbXBsZUVzY2FwZU1hcFtpXSA9IHNpbXBsZUVzY2FwZVNlcXVlbmNlKGkpO1xufVxuXG5mdW5jdGlvbiBTdGF0ZShpbnB1dCwgb3B0aW9ucykge1xuICB0aGlzLmlucHV0ID0gaW5wdXQ7XG4gIHRoaXMuZmlsZW5hbWUgPSBvcHRpb25zWydmaWxlbmFtZSddIHx8IG51bGw7XG4gIHRoaXMuc2NoZW1hID0gb3B0aW9uc1snc2NoZW1hJ10gfHwgZGVmYXVsdF9mdWxsO1xuICB0aGlzLm9uV2FybmluZyA9IG9wdGlvbnNbJ29uV2FybmluZyddIHx8IG51bGw7XG4gIHRoaXMubGVnYWN5ID0gb3B0aW9uc1snbGVnYWN5J10gfHwgZmFsc2U7XG4gIHRoaXMuanNvbiA9IG9wdGlvbnNbJ2pzb24nXSB8fCBmYWxzZTtcbiAgdGhpcy5saXN0ZW5lciA9IG9wdGlvbnNbJ2xpc3RlbmVyJ10gfHwgbnVsbDtcbiAgdGhpcy5pbXBsaWNpdFR5cGVzID0gdGhpcy5zY2hlbWEuY29tcGlsZWRJbXBsaWNpdDtcbiAgdGhpcy50eXBlTWFwID0gdGhpcy5zY2hlbWEuY29tcGlsZWRUeXBlTWFwO1xuICB0aGlzLmxlbmd0aCA9IGlucHV0Lmxlbmd0aDtcbiAgdGhpcy5wb3NpdGlvbiA9IDA7XG4gIHRoaXMubGluZSA9IDA7XG4gIHRoaXMubGluZVN0YXJ0ID0gMDtcbiAgdGhpcy5saW5lSW5kZW50ID0gMDtcbiAgdGhpcy5kb2N1bWVudHMgPSBbXTtcbiAgLypcbiAgdGhpcy52ZXJzaW9uO1xuICB0aGlzLmNoZWNrTGluZUJyZWFrcztcbiAgdGhpcy50YWdNYXA7XG4gIHRoaXMuYW5jaG9yTWFwO1xuICB0aGlzLnRhZztcbiAgdGhpcy5hbmNob3I7XG4gIHRoaXMua2luZDtcbiAgdGhpcy5yZXN1bHQ7Ki9cbn1cblxuZnVuY3Rpb24gZ2VuZXJhdGVFcnJvcihzdGF0ZSwgbWVzc2FnZSkge1xuICByZXR1cm4gbmV3IGV4Y2VwdGlvbihtZXNzYWdlLCBuZXcgbWFyayhzdGF0ZS5maWxlbmFtZSwgc3RhdGUuaW5wdXQsIHN0YXRlLnBvc2l0aW9uLCBzdGF0ZS5saW5lLCBzdGF0ZS5wb3NpdGlvbiAtIHN0YXRlLmxpbmVTdGFydCkpO1xufVxuXG5mdW5jdGlvbiB0aHJvd0Vycm9yKHN0YXRlLCBtZXNzYWdlKSB7XG4gIHRocm93IGdlbmVyYXRlRXJyb3Ioc3RhdGUsIG1lc3NhZ2UpO1xufVxuXG5mdW5jdGlvbiB0aHJvd1dhcm5pbmcoc3RhdGUsIG1lc3NhZ2UpIHtcbiAgaWYgKHN0YXRlLm9uV2FybmluZykge1xuICAgIHN0YXRlLm9uV2FybmluZy5jYWxsKG51bGwsIGdlbmVyYXRlRXJyb3Ioc3RhdGUsIG1lc3NhZ2UpKTtcbiAgfVxufVxuXG52YXIgZGlyZWN0aXZlSGFuZGxlcnMgPSB7XG4gIFlBTUw6IGZ1bmN0aW9uIGhhbmRsZVlhbWxEaXJlY3RpdmUoc3RhdGUsIG5hbWUsIGFyZ3MpIHtcbiAgICB2YXIgbWF0Y2gsIG1ham9yLCBtaW5vcjtcblxuICAgIGlmIChzdGF0ZS52ZXJzaW9uICE9PSBudWxsKSB7XG4gICAgICB0aHJvd0Vycm9yKHN0YXRlLCAnZHVwbGljYXRpb24gb2YgJVlBTUwgZGlyZWN0aXZlJyk7XG4gICAgfVxuXG4gICAgaWYgKGFyZ3MubGVuZ3RoICE9PSAxKSB7XG4gICAgICB0aHJvd0Vycm9yKHN0YXRlLCAnWUFNTCBkaXJlY3RpdmUgYWNjZXB0cyBleGFjdGx5IG9uZSBhcmd1bWVudCcpO1xuICAgIH1cblxuICAgIG1hdGNoID0gL14oWzAtOV0rKVxcLihbMC05XSspJC8uZXhlYyhhcmdzWzBdKTtcblxuICAgIGlmIChtYXRjaCA9PT0gbnVsbCkge1xuICAgICAgdGhyb3dFcnJvcihzdGF0ZSwgJ2lsbC1mb3JtZWQgYXJndW1lbnQgb2YgdGhlIFlBTUwgZGlyZWN0aXZlJyk7XG4gICAgfVxuXG4gICAgbWFqb3IgPSBwYXJzZUludChtYXRjaFsxXSwgMTApO1xuICAgIG1pbm9yID0gcGFyc2VJbnQobWF0Y2hbMl0sIDEwKTtcblxuICAgIGlmIChtYWpvciAhPT0gMSkge1xuICAgICAgdGhyb3dFcnJvcihzdGF0ZSwgJ3VuYWNjZXB0YWJsZSBZQU1MIHZlcnNpb24gb2YgdGhlIGRvY3VtZW50Jyk7XG4gICAgfVxuXG4gICAgc3RhdGUudmVyc2lvbiA9IGFyZ3NbMF07XG4gICAgc3RhdGUuY2hlY2tMaW5lQnJlYWtzID0gbWlub3IgPCAyO1xuXG4gICAgaWYgKG1pbm9yICE9PSAxICYmIG1pbm9yICE9PSAyKSB7XG4gICAgICB0aHJvd1dhcm5pbmcoc3RhdGUsICd1bnN1cHBvcnRlZCBZQU1MIHZlcnNpb24gb2YgdGhlIGRvY3VtZW50Jyk7XG4gICAgfVxuICB9LFxuICBUQUc6IGZ1bmN0aW9uIGhhbmRsZVRhZ0RpcmVjdGl2ZShzdGF0ZSwgbmFtZSwgYXJncykge1xuICAgIHZhciBoYW5kbGUsIHByZWZpeDtcblxuICAgIGlmIChhcmdzLmxlbmd0aCAhPT0gMikge1xuICAgICAgdGhyb3dFcnJvcihzdGF0ZSwgJ1RBRyBkaXJlY3RpdmUgYWNjZXB0cyBleGFjdGx5IHR3byBhcmd1bWVudHMnKTtcbiAgICB9XG5cbiAgICBoYW5kbGUgPSBhcmdzWzBdO1xuICAgIHByZWZpeCA9IGFyZ3NbMV07XG5cbiAgICBpZiAoIVBBVFRFUk5fVEFHX0hBTkRMRS50ZXN0KGhhbmRsZSkpIHtcbiAgICAgIHRocm93RXJyb3Ioc3RhdGUsICdpbGwtZm9ybWVkIHRhZyBoYW5kbGUgKGZpcnN0IGFyZ3VtZW50KSBvZiB0aGUgVEFHIGRpcmVjdGl2ZScpO1xuICAgIH1cblxuICAgIGlmIChfaGFzT3duUHJvcGVydHkkMi5jYWxsKHN0YXRlLnRhZ01hcCwgaGFuZGxlKSkge1xuICAgICAgdGhyb3dFcnJvcihzdGF0ZSwgJ3RoZXJlIGlzIGEgcHJldmlvdXNseSBkZWNsYXJlZCBzdWZmaXggZm9yIFwiJyArIGhhbmRsZSArICdcIiB0YWcgaGFuZGxlJyk7XG4gICAgfVxuXG4gICAgaWYgKCFQQVRURVJOX1RBR19VUkkudGVzdChwcmVmaXgpKSB7XG4gICAgICB0aHJvd0Vycm9yKHN0YXRlLCAnaWxsLWZvcm1lZCB0YWcgcHJlZml4IChzZWNvbmQgYXJndW1lbnQpIG9mIHRoZSBUQUcgZGlyZWN0aXZlJyk7XG4gICAgfVxuXG4gICAgc3RhdGUudGFnTWFwW2hhbmRsZV0gPSBwcmVmaXg7XG4gIH1cbn07XG5cbmZ1bmN0aW9uIGNhcHR1cmVTZWdtZW50KHN0YXRlLCBzdGFydCwgZW5kLCBjaGVja0pzb24pIHtcbiAgdmFyIF9wb3NpdGlvbiwgX2xlbmd0aCwgX2NoYXJhY3RlciwgX3Jlc3VsdDtcblxuICBpZiAoc3RhcnQgPCBlbmQpIHtcbiAgICBfcmVzdWx0ID0gc3RhdGUuaW5wdXQuc2xpY2Uoc3RhcnQsIGVuZCk7XG5cbiAgICBpZiAoY2hlY2tKc29uKSB7XG4gICAgICBmb3IgKF9wb3NpdGlvbiA9IDAsIF9sZW5ndGggPSBfcmVzdWx0Lmxlbmd0aDsgX3Bvc2l0aW9uIDwgX2xlbmd0aDsgX3Bvc2l0aW9uICs9IDEpIHtcbiAgICAgICAgX2NoYXJhY3RlciA9IF9yZXN1bHQuY2hhckNvZGVBdChfcG9zaXRpb24pO1xuXG4gICAgICAgIGlmICghKF9jaGFyYWN0ZXIgPT09IDB4MDkgfHwgMHgyMCA8PSBfY2hhcmFjdGVyICYmIF9jaGFyYWN0ZXIgPD0gMHgxMEZGRkYpKSB7XG4gICAgICAgICAgdGhyb3dFcnJvcihzdGF0ZSwgJ2V4cGVjdGVkIHZhbGlkIEpTT04gY2hhcmFjdGVyJyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKFBBVFRFUk5fTk9OX1BSSU5UQUJMRS50ZXN0KF9yZXN1bHQpKSB7XG4gICAgICB0aHJvd0Vycm9yKHN0YXRlLCAndGhlIHN0cmVhbSBjb250YWlucyBub24tcHJpbnRhYmxlIGNoYXJhY3RlcnMnKTtcbiAgICB9XG5cbiAgICBzdGF0ZS5yZXN1bHQgKz0gX3Jlc3VsdDtcbiAgfVxufVxuXG5mdW5jdGlvbiBtZXJnZU1hcHBpbmdzKHN0YXRlLCBkZXN0aW5hdGlvbiwgc291cmNlLCBvdmVycmlkYWJsZUtleXMpIHtcbiAgdmFyIHNvdXJjZUtleXMsIGtleSwgaW5kZXgsIHF1YW50aXR5O1xuXG4gIGlmICghY29tbW9uLmlzT2JqZWN0KHNvdXJjZSkpIHtcbiAgICB0aHJvd0Vycm9yKHN0YXRlLCAnY2Fubm90IG1lcmdlIG1hcHBpbmdzOyB0aGUgcHJvdmlkZWQgc291cmNlIG9iamVjdCBpcyB1bmFjY2VwdGFibGUnKTtcbiAgfVxuXG4gIHNvdXJjZUtleXMgPSBPYmplY3Qua2V5cyhzb3VyY2UpO1xuXG4gIGZvciAoaW5kZXggPSAwLCBxdWFudGl0eSA9IHNvdXJjZUtleXMubGVuZ3RoOyBpbmRleCA8IHF1YW50aXR5OyBpbmRleCArPSAxKSB7XG4gICAga2V5ID0gc291cmNlS2V5c1tpbmRleF07XG5cbiAgICBpZiAoIV9oYXNPd25Qcm9wZXJ0eSQyLmNhbGwoZGVzdGluYXRpb24sIGtleSkpIHtcbiAgICAgIGRlc3RpbmF0aW9uW2tleV0gPSBzb3VyY2Vba2V5XTtcbiAgICAgIG92ZXJyaWRhYmxlS2V5c1trZXldID0gdHJ1ZTtcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gc3RvcmVNYXBwaW5nUGFpcihzdGF0ZSwgX3Jlc3VsdCwgb3ZlcnJpZGFibGVLZXlzLCBrZXlUYWcsIGtleU5vZGUsIHZhbHVlTm9kZSwgc3RhcnRMaW5lLCBzdGFydFBvcykge1xuICB2YXIgaW5kZXgsIHF1YW50aXR5OyAvLyBUaGUgb3V0cHV0IGlzIGEgcGxhaW4gb2JqZWN0IGhlcmUsIHNvIGtleXMgY2FuIG9ubHkgYmUgc3RyaW5ncy5cbiAgLy8gV2UgbmVlZCB0byBjb252ZXJ0IGtleU5vZGUgdG8gYSBzdHJpbmcsIGJ1dCBkb2luZyBzbyBjYW4gaGFuZyB0aGUgcHJvY2Vzc1xuICAvLyAoZGVlcGx5IG5lc3RlZCBhcnJheXMgdGhhdCBleHBsb2RlIGV4cG9uZW50aWFsbHkgdXNpbmcgYWxpYXNlcykuXG5cbiAgaWYgKEFycmF5LmlzQXJyYXkoa2V5Tm9kZSkpIHtcbiAgICBrZXlOb2RlID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoa2V5Tm9kZSk7XG5cbiAgICBmb3IgKGluZGV4ID0gMCwgcXVhbnRpdHkgPSBrZXlOb2RlLmxlbmd0aDsgaW5kZXggPCBxdWFudGl0eTsgaW5kZXggKz0gMSkge1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkoa2V5Tm9kZVtpbmRleF0pKSB7XG4gICAgICAgIHRocm93RXJyb3Ioc3RhdGUsICduZXN0ZWQgYXJyYXlzIGFyZSBub3Qgc3VwcG9ydGVkIGluc2lkZSBrZXlzJyk7XG4gICAgICB9XG5cbiAgICAgIGlmICh0eXBlb2Yga2V5Tm9kZSA9PT0gJ29iamVjdCcgJiYgX2NsYXNzKGtleU5vZGVbaW5kZXhdKSA9PT0gJ1tvYmplY3QgT2JqZWN0XScpIHtcbiAgICAgICAga2V5Tm9kZVtpbmRleF0gPSAnW29iamVjdCBPYmplY3RdJztcbiAgICAgIH1cbiAgICB9XG4gIH0gLy8gQXZvaWQgY29kZSBleGVjdXRpb24gaW4gbG9hZCgpIHZpYSB0b1N0cmluZyBwcm9wZXJ0eVxuICAvLyAoc3RpbGwgdXNlIGl0cyBvd24gdG9TdHJpbmcgZm9yIGFycmF5cywgdGltZXN0YW1wcyxcbiAgLy8gYW5kIHdoYXRldmVyIHVzZXIgc2NoZW1hIGV4dGVuc2lvbnMgaGFwcGVuIHRvIGhhdmUgQEB0b1N0cmluZ1RhZylcblxuXG4gIGlmICh0eXBlb2Yga2V5Tm9kZSA9PT0gJ29iamVjdCcgJiYgX2NsYXNzKGtleU5vZGUpID09PSAnW29iamVjdCBPYmplY3RdJykge1xuICAgIGtleU5vZGUgPSAnW29iamVjdCBPYmplY3RdJztcbiAgfVxuXG4gIGtleU5vZGUgPSBTdHJpbmcoa2V5Tm9kZSk7XG5cbiAgaWYgKF9yZXN1bHQgPT09IG51bGwpIHtcbiAgICBfcmVzdWx0ID0ge307XG4gIH1cblxuICBpZiAoa2V5VGFnID09PSAndGFnOnlhbWwub3JnLDIwMDI6bWVyZ2UnKSB7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWVOb2RlKSkge1xuICAgICAgZm9yIChpbmRleCA9IDAsIHF1YW50aXR5ID0gdmFsdWVOb2RlLmxlbmd0aDsgaW5kZXggPCBxdWFudGl0eTsgaW5kZXggKz0gMSkge1xuICAgICAgICBtZXJnZU1hcHBpbmdzKHN0YXRlLCBfcmVzdWx0LCB2YWx1ZU5vZGVbaW5kZXhdLCBvdmVycmlkYWJsZUtleXMpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBtZXJnZU1hcHBpbmdzKHN0YXRlLCBfcmVzdWx0LCB2YWx1ZU5vZGUsIG92ZXJyaWRhYmxlS2V5cyk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGlmICghc3RhdGUuanNvbiAmJiAhX2hhc093blByb3BlcnR5JDIuY2FsbChvdmVycmlkYWJsZUtleXMsIGtleU5vZGUpICYmIF9oYXNPd25Qcm9wZXJ0eSQyLmNhbGwoX3Jlc3VsdCwga2V5Tm9kZSkpIHtcbiAgICAgIHN0YXRlLmxpbmUgPSBzdGFydExpbmUgfHwgc3RhdGUubGluZTtcbiAgICAgIHN0YXRlLnBvc2l0aW9uID0gc3RhcnRQb3MgfHwgc3RhdGUucG9zaXRpb247XG4gICAgICB0aHJvd0Vycm9yKHN0YXRlLCAnZHVwbGljYXRlZCBtYXBwaW5nIGtleScpO1xuICAgIH1cblxuICAgIF9yZXN1bHRba2V5Tm9kZV0gPSB2YWx1ZU5vZGU7XG4gICAgZGVsZXRlIG92ZXJyaWRhYmxlS2V5c1trZXlOb2RlXTtcbiAgfVxuXG4gIHJldHVybiBfcmVzdWx0O1xufVxuXG5mdW5jdGlvbiByZWFkTGluZUJyZWFrKHN0YXRlKSB7XG4gIHZhciBjaDtcbiAgY2ggPSBzdGF0ZS5pbnB1dC5jaGFyQ29kZUF0KHN0YXRlLnBvc2l0aW9uKTtcblxuICBpZiAoY2ggPT09IDB4MEFcbiAgLyogTEYgKi9cbiAgKSB7XG4gICAgICBzdGF0ZS5wb3NpdGlvbisrO1xuICAgIH0gZWxzZSBpZiAoY2ggPT09IDB4MERcbiAgLyogQ1IgKi9cbiAgKSB7XG4gICAgICBzdGF0ZS5wb3NpdGlvbisrO1xuXG4gICAgICBpZiAoc3RhdGUuaW5wdXQuY2hhckNvZGVBdChzdGF0ZS5wb3NpdGlvbikgPT09IDB4MEFcbiAgICAgIC8qIExGICovXG4gICAgICApIHtcbiAgICAgICAgICBzdGF0ZS5wb3NpdGlvbisrO1xuICAgICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICB0aHJvd0Vycm9yKHN0YXRlLCAnYSBsaW5lIGJyZWFrIGlzIGV4cGVjdGVkJyk7XG4gIH1cblxuICBzdGF0ZS5saW5lICs9IDE7XG4gIHN0YXRlLmxpbmVTdGFydCA9IHN0YXRlLnBvc2l0aW9uO1xufVxuXG5mdW5jdGlvbiBza2lwU2VwYXJhdGlvblNwYWNlKHN0YXRlLCBhbGxvd0NvbW1lbnRzLCBjaGVja0luZGVudCkge1xuICB2YXIgbGluZUJyZWFrcyA9IDAsXG4gICAgICBjaCA9IHN0YXRlLmlucHV0LmNoYXJDb2RlQXQoc3RhdGUucG9zaXRpb24pO1xuXG4gIHdoaWxlIChjaCAhPT0gMCkge1xuICAgIHdoaWxlIChpc19XSElURV9TUEFDRShjaCkpIHtcbiAgICAgIGNoID0gc3RhdGUuaW5wdXQuY2hhckNvZGVBdCgrK3N0YXRlLnBvc2l0aW9uKTtcbiAgICB9XG5cbiAgICBpZiAoYWxsb3dDb21tZW50cyAmJiBjaCA9PT0gMHgyM1xuICAgIC8qICMgKi9cbiAgICApIHtcbiAgICAgICAgZG8ge1xuICAgICAgICAgIGNoID0gc3RhdGUuaW5wdXQuY2hhckNvZGVBdCgrK3N0YXRlLnBvc2l0aW9uKTtcbiAgICAgICAgfSB3aGlsZSAoY2ggIT09IDB4MEFcbiAgICAgICAgLyogTEYgKi9cbiAgICAgICAgJiYgY2ggIT09IDB4MERcbiAgICAgICAgLyogQ1IgKi9cbiAgICAgICAgJiYgY2ggIT09IDApO1xuICAgICAgfVxuXG4gICAgaWYgKGlzX0VPTChjaCkpIHtcbiAgICAgIHJlYWRMaW5lQnJlYWsoc3RhdGUpO1xuICAgICAgY2ggPSBzdGF0ZS5pbnB1dC5jaGFyQ29kZUF0KHN0YXRlLnBvc2l0aW9uKTtcbiAgICAgIGxpbmVCcmVha3MrKztcbiAgICAgIHN0YXRlLmxpbmVJbmRlbnQgPSAwO1xuXG4gICAgICB3aGlsZSAoY2ggPT09IDB4MjBcbiAgICAgIC8qIFNwYWNlICovXG4gICAgICApIHtcbiAgICAgICAgc3RhdGUubGluZUluZGVudCsrO1xuICAgICAgICBjaCA9IHN0YXRlLmlucHV0LmNoYXJDb2RlQXQoKytzdGF0ZS5wb3NpdGlvbik7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIGlmIChjaGVja0luZGVudCAhPT0gLTEgJiYgbGluZUJyZWFrcyAhPT0gMCAmJiBzdGF0ZS5saW5lSW5kZW50IDwgY2hlY2tJbmRlbnQpIHtcbiAgICB0aHJvd1dhcm5pbmcoc3RhdGUsICdkZWZpY2llbnQgaW5kZW50YXRpb24nKTtcbiAgfVxuXG4gIHJldHVybiBsaW5lQnJlYWtzO1xufVxuXG5mdW5jdGlvbiB0ZXN0RG9jdW1lbnRTZXBhcmF0b3Ioc3RhdGUpIHtcbiAgdmFyIF9wb3NpdGlvbiA9IHN0YXRlLnBvc2l0aW9uLFxuICAgICAgY2g7XG4gIGNoID0gc3RhdGUuaW5wdXQuY2hhckNvZGVBdChfcG9zaXRpb24pOyAvLyBDb25kaXRpb24gc3RhdGUucG9zaXRpb24gPT09IHN0YXRlLmxpbmVTdGFydCBpcyB0ZXN0ZWRcbiAgLy8gaW4gcGFyZW50IG9uIGVhY2ggY2FsbCwgZm9yIGVmZmljaWVuY3kuIE5vIG5lZWRzIHRvIHRlc3QgaGVyZSBhZ2Fpbi5cblxuICBpZiAoKGNoID09PSAweDJEXG4gIC8qIC0gKi9cbiAgfHwgY2ggPT09IDB4MkVcbiAgLyogLiAqL1xuICApICYmIGNoID09PSBzdGF0ZS5pbnB1dC5jaGFyQ29kZUF0KF9wb3NpdGlvbiArIDEpICYmIGNoID09PSBzdGF0ZS5pbnB1dC5jaGFyQ29kZUF0KF9wb3NpdGlvbiArIDIpKSB7XG4gICAgX3Bvc2l0aW9uICs9IDM7XG4gICAgY2ggPSBzdGF0ZS5pbnB1dC5jaGFyQ29kZUF0KF9wb3NpdGlvbik7XG5cbiAgICBpZiAoY2ggPT09IDAgfHwgaXNfV1NfT1JfRU9MKGNoKSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGZhbHNlO1xufVxuXG5mdW5jdGlvbiB3cml0ZUZvbGRlZExpbmVzKHN0YXRlLCBjb3VudCkge1xuICBpZiAoY291bnQgPT09IDEpIHtcbiAgICBzdGF0ZS5yZXN1bHQgKz0gJyAnO1xuICB9IGVsc2UgaWYgKGNvdW50ID4gMSkge1xuICAgIHN0YXRlLnJlc3VsdCArPSBjb21tb24ucmVwZWF0KCdcXG4nLCBjb3VudCAtIDEpO1xuICB9XG59XG5cbmZ1bmN0aW9uIHJlYWRQbGFpblNjYWxhcihzdGF0ZSwgbm9kZUluZGVudCwgd2l0aGluRmxvd0NvbGxlY3Rpb24pIHtcbiAgdmFyIHByZWNlZGluZyxcbiAgICAgIGZvbGxvd2luZyxcbiAgICAgIGNhcHR1cmVTdGFydCxcbiAgICAgIGNhcHR1cmVFbmQsXG4gICAgICBoYXNQZW5kaW5nQ29udGVudCxcbiAgICAgIF9saW5lLFxuICAgICAgX2xpbmVTdGFydCxcbiAgICAgIF9saW5lSW5kZW50LFxuICAgICAgX2tpbmQgPSBzdGF0ZS5raW5kLFxuICAgICAgX3Jlc3VsdCA9IHN0YXRlLnJlc3VsdCxcbiAgICAgIGNoO1xuXG4gIGNoID0gc3RhdGUuaW5wdXQuY2hhckNvZGVBdChzdGF0ZS5wb3NpdGlvbik7XG5cbiAgaWYgKGlzX1dTX09SX0VPTChjaCkgfHwgaXNfRkxPV19JTkRJQ0FUT1IoY2gpIHx8IGNoID09PSAweDIzXG4gIC8qICMgKi9cbiAgfHwgY2ggPT09IDB4MjZcbiAgLyogJiAqL1xuICB8fCBjaCA9PT0gMHgyQVxuICAvKiAqICovXG4gIHx8IGNoID09PSAweDIxXG4gIC8qICEgKi9cbiAgfHwgY2ggPT09IDB4N0NcbiAgLyogfCAqL1xuICB8fCBjaCA9PT0gMHgzRVxuICAvKiA+ICovXG4gIHx8IGNoID09PSAweDI3XG4gIC8qICcgKi9cbiAgfHwgY2ggPT09IDB4MjJcbiAgLyogXCIgKi9cbiAgfHwgY2ggPT09IDB4MjVcbiAgLyogJSAqL1xuICB8fCBjaCA9PT0gMHg0MFxuICAvKiBAICovXG4gIHx8IGNoID09PSAweDYwXG4gIC8qIGAgKi9cbiAgKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gIGlmIChjaCA9PT0gMHgzRlxuICAvKiA/ICovXG4gIHx8IGNoID09PSAweDJEXG4gIC8qIC0gKi9cbiAgKSB7XG4gICAgICBmb2xsb3dpbmcgPSBzdGF0ZS5pbnB1dC5jaGFyQ29kZUF0KHN0YXRlLnBvc2l0aW9uICsgMSk7XG5cbiAgICAgIGlmIChpc19XU19PUl9FT0woZm9sbG93aW5nKSB8fCB3aXRoaW5GbG93Q29sbGVjdGlvbiAmJiBpc19GTE9XX0lORElDQVRPUihmb2xsb3dpbmcpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgc3RhdGUua2luZCA9ICdzY2FsYXInO1xuICBzdGF0ZS5yZXN1bHQgPSAnJztcbiAgY2FwdHVyZVN0YXJ0ID0gY2FwdHVyZUVuZCA9IHN0YXRlLnBvc2l0aW9uO1xuICBoYXNQZW5kaW5nQ29udGVudCA9IGZhbHNlO1xuXG4gIHdoaWxlIChjaCAhPT0gMCkge1xuICAgIGlmIChjaCA9PT0gMHgzQVxuICAgIC8qIDogKi9cbiAgICApIHtcbiAgICAgICAgZm9sbG93aW5nID0gc3RhdGUuaW5wdXQuY2hhckNvZGVBdChzdGF0ZS5wb3NpdGlvbiArIDEpO1xuXG4gICAgICAgIGlmIChpc19XU19PUl9FT0woZm9sbG93aW5nKSB8fCB3aXRoaW5GbG93Q29sbGVjdGlvbiAmJiBpc19GTE9XX0lORElDQVRPUihmb2xsb3dpbmcpKSB7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoY2ggPT09IDB4MjNcbiAgICAvKiAjICovXG4gICAgKSB7XG4gICAgICAgIHByZWNlZGluZyA9IHN0YXRlLmlucHV0LmNoYXJDb2RlQXQoc3RhdGUucG9zaXRpb24gLSAxKTtcblxuICAgICAgICBpZiAoaXNfV1NfT1JfRU9MKHByZWNlZGluZykpIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChzdGF0ZS5wb3NpdGlvbiA9PT0gc3RhdGUubGluZVN0YXJ0ICYmIHRlc3REb2N1bWVudFNlcGFyYXRvcihzdGF0ZSkgfHwgd2l0aGluRmxvd0NvbGxlY3Rpb24gJiYgaXNfRkxPV19JTkRJQ0FUT1IoY2gpKSB7XG4gICAgICBicmVhaztcbiAgICB9IGVsc2UgaWYgKGlzX0VPTChjaCkpIHtcbiAgICAgIF9saW5lID0gc3RhdGUubGluZTtcbiAgICAgIF9saW5lU3RhcnQgPSBzdGF0ZS5saW5lU3RhcnQ7XG4gICAgICBfbGluZUluZGVudCA9IHN0YXRlLmxpbmVJbmRlbnQ7XG4gICAgICBza2lwU2VwYXJhdGlvblNwYWNlKHN0YXRlLCBmYWxzZSwgLTEpO1xuXG4gICAgICBpZiAoc3RhdGUubGluZUluZGVudCA+PSBub2RlSW5kZW50KSB7XG4gICAgICAgIGhhc1BlbmRpbmdDb250ZW50ID0gdHJ1ZTtcbiAgICAgICAgY2ggPSBzdGF0ZS5pbnB1dC5jaGFyQ29kZUF0KHN0YXRlLnBvc2l0aW9uKTtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzdGF0ZS5wb3NpdGlvbiA9IGNhcHR1cmVFbmQ7XG4gICAgICAgIHN0YXRlLmxpbmUgPSBfbGluZTtcbiAgICAgICAgc3RhdGUubGluZVN0YXJ0ID0gX2xpbmVTdGFydDtcbiAgICAgICAgc3RhdGUubGluZUluZGVudCA9IF9saW5lSW5kZW50O1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoaGFzUGVuZGluZ0NvbnRlbnQpIHtcbiAgICAgIGNhcHR1cmVTZWdtZW50KHN0YXRlLCBjYXB0dXJlU3RhcnQsIGNhcHR1cmVFbmQsIGZhbHNlKTtcbiAgICAgIHdyaXRlRm9sZGVkTGluZXMoc3RhdGUsIHN0YXRlLmxpbmUgLSBfbGluZSk7XG4gICAgICBjYXB0dXJlU3RhcnQgPSBjYXB0dXJlRW5kID0gc3RhdGUucG9zaXRpb247XG4gICAgICBoYXNQZW5kaW5nQ29udGVudCA9IGZhbHNlO1xuICAgIH1cblxuICAgIGlmICghaXNfV0hJVEVfU1BBQ0UoY2gpKSB7XG4gICAgICBjYXB0dXJlRW5kID0gc3RhdGUucG9zaXRpb24gKyAxO1xuICAgIH1cblxuICAgIGNoID0gc3RhdGUuaW5wdXQuY2hhckNvZGVBdCgrK3N0YXRlLnBvc2l0aW9uKTtcbiAgfVxuXG4gIGNhcHR1cmVTZWdtZW50KHN0YXRlLCBjYXB0dXJlU3RhcnQsIGNhcHR1cmVFbmQsIGZhbHNlKTtcblxuICBpZiAoc3RhdGUucmVzdWx0KSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBzdGF0ZS5raW5kID0gX2tpbmQ7XG4gIHN0YXRlLnJlc3VsdCA9IF9yZXN1bHQ7XG4gIHJldHVybiBmYWxzZTtcbn1cblxuZnVuY3Rpb24gcmVhZFNpbmdsZVF1b3RlZFNjYWxhcihzdGF0ZSwgbm9kZUluZGVudCkge1xuICB2YXIgY2gsIGNhcHR1cmVTdGFydCwgY2FwdHVyZUVuZDtcbiAgY2ggPSBzdGF0ZS5pbnB1dC5jaGFyQ29kZUF0KHN0YXRlLnBvc2l0aW9uKTtcblxuICBpZiAoY2ggIT09IDB4MjdcbiAgLyogJyAqL1xuICApIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgc3RhdGUua2luZCA9ICdzY2FsYXInO1xuICBzdGF0ZS5yZXN1bHQgPSAnJztcbiAgc3RhdGUucG9zaXRpb24rKztcbiAgY2FwdHVyZVN0YXJ0ID0gY2FwdHVyZUVuZCA9IHN0YXRlLnBvc2l0aW9uO1xuXG4gIHdoaWxlICgoY2ggPSBzdGF0ZS5pbnB1dC5jaGFyQ29kZUF0KHN0YXRlLnBvc2l0aW9uKSkgIT09IDApIHtcbiAgICBpZiAoY2ggPT09IDB4MjdcbiAgICAvKiAnICovXG4gICAgKSB7XG4gICAgICAgIGNhcHR1cmVTZWdtZW50KHN0YXRlLCBjYXB0dXJlU3RhcnQsIHN0YXRlLnBvc2l0aW9uLCB0cnVlKTtcbiAgICAgICAgY2ggPSBzdGF0ZS5pbnB1dC5jaGFyQ29kZUF0KCsrc3RhdGUucG9zaXRpb24pO1xuXG4gICAgICAgIGlmIChjaCA9PT0gMHgyN1xuICAgICAgICAvKiAnICovXG4gICAgICAgICkge1xuICAgICAgICAgICAgY2FwdHVyZVN0YXJ0ID0gc3RhdGUucG9zaXRpb247XG4gICAgICAgICAgICBzdGF0ZS5wb3NpdGlvbisrO1xuICAgICAgICAgICAgY2FwdHVyZUVuZCA9IHN0YXRlLnBvc2l0aW9uO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoaXNfRU9MKGNoKSkge1xuICAgICAgY2FwdHVyZVNlZ21lbnQoc3RhdGUsIGNhcHR1cmVTdGFydCwgY2FwdHVyZUVuZCwgdHJ1ZSk7XG4gICAgICB3cml0ZUZvbGRlZExpbmVzKHN0YXRlLCBza2lwU2VwYXJhdGlvblNwYWNlKHN0YXRlLCBmYWxzZSwgbm9kZUluZGVudCkpO1xuICAgICAgY2FwdHVyZVN0YXJ0ID0gY2FwdHVyZUVuZCA9IHN0YXRlLnBvc2l0aW9uO1xuICAgIH0gZWxzZSBpZiAoc3RhdGUucG9zaXRpb24gPT09IHN0YXRlLmxpbmVTdGFydCAmJiB0ZXN0RG9jdW1lbnRTZXBhcmF0b3Ioc3RhdGUpKSB7XG4gICAgICB0aHJvd0Vycm9yKHN0YXRlLCAndW5leHBlY3RlZCBlbmQgb2YgdGhlIGRvY3VtZW50IHdpdGhpbiBhIHNpbmdsZSBxdW90ZWQgc2NhbGFyJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHN0YXRlLnBvc2l0aW9uKys7XG4gICAgICBjYXB0dXJlRW5kID0gc3RhdGUucG9zaXRpb247XG4gICAgfVxuICB9XG5cbiAgdGhyb3dFcnJvcihzdGF0ZSwgJ3VuZXhwZWN0ZWQgZW5kIG9mIHRoZSBzdHJlYW0gd2l0aGluIGEgc2luZ2xlIHF1b3RlZCBzY2FsYXInKTtcbn1cblxuZnVuY3Rpb24gcmVhZERvdWJsZVF1b3RlZFNjYWxhcihzdGF0ZSwgbm9kZUluZGVudCkge1xuICB2YXIgY2FwdHVyZVN0YXJ0LCBjYXB0dXJlRW5kLCBoZXhMZW5ndGgsIGhleFJlc3VsdCwgdG1wLCBjaDtcbiAgY2ggPSBzdGF0ZS5pbnB1dC5jaGFyQ29kZUF0KHN0YXRlLnBvc2l0aW9uKTtcblxuICBpZiAoY2ggIT09IDB4MjJcbiAgLyogXCIgKi9cbiAgKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gIHN0YXRlLmtpbmQgPSAnc2NhbGFyJztcbiAgc3RhdGUucmVzdWx0ID0gJyc7XG4gIHN0YXRlLnBvc2l0aW9uKys7XG4gIGNhcHR1cmVTdGFydCA9IGNhcHR1cmVFbmQgPSBzdGF0ZS5wb3NpdGlvbjtcblxuICB3aGlsZSAoKGNoID0gc3RhdGUuaW5wdXQuY2hhckNvZGVBdChzdGF0ZS5wb3NpdGlvbikpICE9PSAwKSB7XG4gICAgaWYgKGNoID09PSAweDIyXG4gICAgLyogXCIgKi9cbiAgICApIHtcbiAgICAgICAgY2FwdHVyZVNlZ21lbnQoc3RhdGUsIGNhcHR1cmVTdGFydCwgc3RhdGUucG9zaXRpb24sIHRydWUpO1xuICAgICAgICBzdGF0ZS5wb3NpdGlvbisrO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0gZWxzZSBpZiAoY2ggPT09IDB4NUNcbiAgICAvKiBcXCAqL1xuICAgICkge1xuICAgICAgICBjYXB0dXJlU2VnbWVudChzdGF0ZSwgY2FwdHVyZVN0YXJ0LCBzdGF0ZS5wb3NpdGlvbiwgdHJ1ZSk7XG4gICAgICAgIGNoID0gc3RhdGUuaW5wdXQuY2hhckNvZGVBdCgrK3N0YXRlLnBvc2l0aW9uKTtcblxuICAgICAgICBpZiAoaXNfRU9MKGNoKSkge1xuICAgICAgICAgIHNraXBTZXBhcmF0aW9uU3BhY2Uoc3RhdGUsIGZhbHNlLCBub2RlSW5kZW50KTsgLy8gVE9ETzogcmV3b3JrIHRvIGlubGluZSBmbiB3aXRoIG5vIHR5cGUgY2FzdD9cbiAgICAgICAgfSBlbHNlIGlmIChjaCA8IDI1NiAmJiBzaW1wbGVFc2NhcGVDaGVja1tjaF0pIHtcbiAgICAgICAgICBzdGF0ZS5yZXN1bHQgKz0gc2ltcGxlRXNjYXBlTWFwW2NoXTtcbiAgICAgICAgICBzdGF0ZS5wb3NpdGlvbisrO1xuICAgICAgICB9IGVsc2UgaWYgKCh0bXAgPSBlc2NhcGVkSGV4TGVuKGNoKSkgPiAwKSB7XG4gICAgICAgICAgaGV4TGVuZ3RoID0gdG1wO1xuICAgICAgICAgIGhleFJlc3VsdCA9IDA7XG5cbiAgICAgICAgICBmb3IgKDsgaGV4TGVuZ3RoID4gMDsgaGV4TGVuZ3RoLS0pIHtcbiAgICAgICAgICAgIGNoID0gc3RhdGUuaW5wdXQuY2hhckNvZGVBdCgrK3N0YXRlLnBvc2l0aW9uKTtcblxuICAgICAgICAgICAgaWYgKCh0bXAgPSBmcm9tSGV4Q29kZShjaCkpID49IDApIHtcbiAgICAgICAgICAgICAgaGV4UmVzdWx0ID0gKGhleFJlc3VsdCA8PCA0KSArIHRtcDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRocm93RXJyb3Ioc3RhdGUsICdleHBlY3RlZCBoZXhhZGVjaW1hbCBjaGFyYWN0ZXInKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cbiAgICAgICAgICBzdGF0ZS5yZXN1bHQgKz0gY2hhckZyb21Db2RlcG9pbnQoaGV4UmVzdWx0KTtcbiAgICAgICAgICBzdGF0ZS5wb3NpdGlvbisrO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRocm93RXJyb3Ioc3RhdGUsICd1bmtub3duIGVzY2FwZSBzZXF1ZW5jZScpO1xuICAgICAgICB9XG5cbiAgICAgICAgY2FwdHVyZVN0YXJ0ID0gY2FwdHVyZUVuZCA9IHN0YXRlLnBvc2l0aW9uO1xuICAgICAgfSBlbHNlIGlmIChpc19FT0woY2gpKSB7XG4gICAgICBjYXB0dXJlU2VnbWVudChzdGF0ZSwgY2FwdHVyZVN0YXJ0LCBjYXB0dXJlRW5kLCB0cnVlKTtcbiAgICAgIHdyaXRlRm9sZGVkTGluZXMoc3RhdGUsIHNraXBTZXBhcmF0aW9uU3BhY2Uoc3RhdGUsIGZhbHNlLCBub2RlSW5kZW50KSk7XG4gICAgICBjYXB0dXJlU3RhcnQgPSBjYXB0dXJlRW5kID0gc3RhdGUucG9zaXRpb247XG4gICAgfSBlbHNlIGlmIChzdGF0ZS5wb3NpdGlvbiA9PT0gc3RhdGUubGluZVN0YXJ0ICYmIHRlc3REb2N1bWVudFNlcGFyYXRvcihzdGF0ZSkpIHtcbiAgICAgIHRocm93RXJyb3Ioc3RhdGUsICd1bmV4cGVjdGVkIGVuZCBvZiB0aGUgZG9jdW1lbnQgd2l0aGluIGEgZG91YmxlIHF1b3RlZCBzY2FsYXInKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3RhdGUucG9zaXRpb24rKztcbiAgICAgIGNhcHR1cmVFbmQgPSBzdGF0ZS5wb3NpdGlvbjtcbiAgICB9XG4gIH1cblxuICB0aHJvd0Vycm9yKHN0YXRlLCAndW5leHBlY3RlZCBlbmQgb2YgdGhlIHN0cmVhbSB3aXRoaW4gYSBkb3VibGUgcXVvdGVkIHNjYWxhcicpO1xufVxuXG5mdW5jdGlvbiByZWFkRmxvd0NvbGxlY3Rpb24oc3RhdGUsIG5vZGVJbmRlbnQpIHtcbiAgdmFyIHJlYWROZXh0ID0gdHJ1ZSxcbiAgICAgIF9saW5lLFxuICAgICAgX3RhZyA9IHN0YXRlLnRhZyxcbiAgICAgIF9yZXN1bHQsXG4gICAgICBfYW5jaG9yID0gc3RhdGUuYW5jaG9yLFxuICAgICAgZm9sbG93aW5nLFxuICAgICAgdGVybWluYXRvcixcbiAgICAgIGlzUGFpcixcbiAgICAgIGlzRXhwbGljaXRQYWlyLFxuICAgICAgaXNNYXBwaW5nLFxuICAgICAgb3ZlcnJpZGFibGVLZXlzID0ge30sXG4gICAgICBrZXlOb2RlLFxuICAgICAga2V5VGFnLFxuICAgICAgdmFsdWVOb2RlLFxuICAgICAgY2g7XG5cbiAgY2ggPSBzdGF0ZS5pbnB1dC5jaGFyQ29kZUF0KHN0YXRlLnBvc2l0aW9uKTtcblxuICBpZiAoY2ggPT09IDB4NUJcbiAgLyogWyAqL1xuICApIHtcbiAgICAgIHRlcm1pbmF0b3IgPSAweDVEO1xuICAgICAgLyogXSAqL1xuXG4gICAgICBpc01hcHBpbmcgPSBmYWxzZTtcbiAgICAgIF9yZXN1bHQgPSBbXTtcbiAgICB9IGVsc2UgaWYgKGNoID09PSAweDdCXG4gIC8qIHsgKi9cbiAgKSB7XG4gICAgICB0ZXJtaW5hdG9yID0gMHg3RDtcbiAgICAgIC8qIH0gKi9cblxuICAgICAgaXNNYXBwaW5nID0gdHJ1ZTtcbiAgICAgIF9yZXN1bHQgPSB7fTtcbiAgICB9IGVsc2Uge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGlmIChzdGF0ZS5hbmNob3IgIT09IG51bGwpIHtcbiAgICBzdGF0ZS5hbmNob3JNYXBbc3RhdGUuYW5jaG9yXSA9IF9yZXN1bHQ7XG4gIH1cblxuICBjaCA9IHN0YXRlLmlucHV0LmNoYXJDb2RlQXQoKytzdGF0ZS5wb3NpdGlvbik7XG5cbiAgd2hpbGUgKGNoICE9PSAwKSB7XG4gICAgc2tpcFNlcGFyYXRpb25TcGFjZShzdGF0ZSwgdHJ1ZSwgbm9kZUluZGVudCk7XG4gICAgY2ggPSBzdGF0ZS5pbnB1dC5jaGFyQ29kZUF0KHN0YXRlLnBvc2l0aW9uKTtcblxuICAgIGlmIChjaCA9PT0gdGVybWluYXRvcikge1xuICAgICAgc3RhdGUucG9zaXRpb24rKztcbiAgICAgIHN0YXRlLnRhZyA9IF90YWc7XG4gICAgICBzdGF0ZS5hbmNob3IgPSBfYW5jaG9yO1xuICAgICAgc3RhdGUua2luZCA9IGlzTWFwcGluZyA/ICdtYXBwaW5nJyA6ICdzZXF1ZW5jZSc7XG4gICAgICBzdGF0ZS5yZXN1bHQgPSBfcmVzdWx0O1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBlbHNlIGlmICghcmVhZE5leHQpIHtcbiAgICAgIHRocm93RXJyb3Ioc3RhdGUsICdtaXNzZWQgY29tbWEgYmV0d2VlbiBmbG93IGNvbGxlY3Rpb24gZW50cmllcycpO1xuICAgIH1cblxuICAgIGtleVRhZyA9IGtleU5vZGUgPSB2YWx1ZU5vZGUgPSBudWxsO1xuICAgIGlzUGFpciA9IGlzRXhwbGljaXRQYWlyID0gZmFsc2U7XG5cbiAgICBpZiAoY2ggPT09IDB4M0ZcbiAgICAvKiA/ICovXG4gICAgKSB7XG4gICAgICAgIGZvbGxvd2luZyA9IHN0YXRlLmlucHV0LmNoYXJDb2RlQXQoc3RhdGUucG9zaXRpb24gKyAxKTtcblxuICAgICAgICBpZiAoaXNfV1NfT1JfRU9MKGZvbGxvd2luZykpIHtcbiAgICAgICAgICBpc1BhaXIgPSBpc0V4cGxpY2l0UGFpciA9IHRydWU7XG4gICAgICAgICAgc3RhdGUucG9zaXRpb24rKztcbiAgICAgICAgICBza2lwU2VwYXJhdGlvblNwYWNlKHN0YXRlLCB0cnVlLCBub2RlSW5kZW50KTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgX2xpbmUgPSBzdGF0ZS5saW5lO1xuICAgIGNvbXBvc2VOb2RlKHN0YXRlLCBub2RlSW5kZW50LCBDT05URVhUX0ZMT1dfSU4sIGZhbHNlLCB0cnVlKTtcbiAgICBrZXlUYWcgPSBzdGF0ZS50YWc7XG4gICAga2V5Tm9kZSA9IHN0YXRlLnJlc3VsdDtcbiAgICBza2lwU2VwYXJhdGlvblNwYWNlKHN0YXRlLCB0cnVlLCBub2RlSW5kZW50KTtcbiAgICBjaCA9IHN0YXRlLmlucHV0LmNoYXJDb2RlQXQoc3RhdGUucG9zaXRpb24pO1xuXG4gICAgaWYgKChpc0V4cGxpY2l0UGFpciB8fCBzdGF0ZS5saW5lID09PSBfbGluZSkgJiYgY2ggPT09IDB4M0FcbiAgICAvKiA6ICovXG4gICAgKSB7XG4gICAgICAgIGlzUGFpciA9IHRydWU7XG4gICAgICAgIGNoID0gc3RhdGUuaW5wdXQuY2hhckNvZGVBdCgrK3N0YXRlLnBvc2l0aW9uKTtcbiAgICAgICAgc2tpcFNlcGFyYXRpb25TcGFjZShzdGF0ZSwgdHJ1ZSwgbm9kZUluZGVudCk7XG4gICAgICAgIGNvbXBvc2VOb2RlKHN0YXRlLCBub2RlSW5kZW50LCBDT05URVhUX0ZMT1dfSU4sIGZhbHNlLCB0cnVlKTtcbiAgICAgICAgdmFsdWVOb2RlID0gc3RhdGUucmVzdWx0O1xuICAgICAgfVxuXG4gICAgaWYgKGlzTWFwcGluZykge1xuICAgICAgc3RvcmVNYXBwaW5nUGFpcihzdGF0ZSwgX3Jlc3VsdCwgb3ZlcnJpZGFibGVLZXlzLCBrZXlUYWcsIGtleU5vZGUsIHZhbHVlTm9kZSk7XG4gICAgfSBlbHNlIGlmIChpc1BhaXIpIHtcbiAgICAgIF9yZXN1bHQucHVzaChzdG9yZU1hcHBpbmdQYWlyKHN0YXRlLCBudWxsLCBvdmVycmlkYWJsZUtleXMsIGtleVRhZywga2V5Tm9kZSwgdmFsdWVOb2RlKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIF9yZXN1bHQucHVzaChrZXlOb2RlKTtcbiAgICB9XG5cbiAgICBza2lwU2VwYXJhdGlvblNwYWNlKHN0YXRlLCB0cnVlLCBub2RlSW5kZW50KTtcbiAgICBjaCA9IHN0YXRlLmlucHV0LmNoYXJDb2RlQXQoc3RhdGUucG9zaXRpb24pO1xuXG4gICAgaWYgKGNoID09PSAweDJDXG4gICAgLyogLCAqL1xuICAgICkge1xuICAgICAgICByZWFkTmV4dCA9IHRydWU7XG4gICAgICAgIGNoID0gc3RhdGUuaW5wdXQuY2hhckNvZGVBdCgrK3N0YXRlLnBvc2l0aW9uKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICByZWFkTmV4dCA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIHRocm93RXJyb3Ioc3RhdGUsICd1bmV4cGVjdGVkIGVuZCBvZiB0aGUgc3RyZWFtIHdpdGhpbiBhIGZsb3cgY29sbGVjdGlvbicpO1xufVxuXG5mdW5jdGlvbiByZWFkQmxvY2tTY2FsYXIoc3RhdGUsIG5vZGVJbmRlbnQpIHtcbiAgdmFyIGNhcHR1cmVTdGFydCxcbiAgICAgIGZvbGRpbmcsXG4gICAgICBjaG9tcGluZyA9IENIT01QSU5HX0NMSVAsXG4gICAgICBkaWRSZWFkQ29udGVudCA9IGZhbHNlLFxuICAgICAgZGV0ZWN0ZWRJbmRlbnQgPSBmYWxzZSxcbiAgICAgIHRleHRJbmRlbnQgPSBub2RlSW5kZW50LFxuICAgICAgZW1wdHlMaW5lcyA9IDAsXG4gICAgICBhdE1vcmVJbmRlbnRlZCA9IGZhbHNlLFxuICAgICAgdG1wLFxuICAgICAgY2g7XG4gIGNoID0gc3RhdGUuaW5wdXQuY2hhckNvZGVBdChzdGF0ZS5wb3NpdGlvbik7XG5cbiAgaWYgKGNoID09PSAweDdDXG4gIC8qIHwgKi9cbiAgKSB7XG4gICAgICBmb2xkaW5nID0gZmFsc2U7XG4gICAgfSBlbHNlIGlmIChjaCA9PT0gMHgzRVxuICAvKiA+ICovXG4gICkge1xuICAgICAgZm9sZGluZyA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBzdGF0ZS5raW5kID0gJ3NjYWxhcic7XG4gIHN0YXRlLnJlc3VsdCA9ICcnO1xuXG4gIHdoaWxlIChjaCAhPT0gMCkge1xuICAgIGNoID0gc3RhdGUuaW5wdXQuY2hhckNvZGVBdCgrK3N0YXRlLnBvc2l0aW9uKTtcblxuICAgIGlmIChjaCA9PT0gMHgyQlxuICAgIC8qICsgKi9cbiAgICB8fCBjaCA9PT0gMHgyRFxuICAgIC8qIC0gKi9cbiAgICApIHtcbiAgICAgICAgaWYgKENIT01QSU5HX0NMSVAgPT09IGNob21waW5nKSB7XG4gICAgICAgICAgY2hvbXBpbmcgPSBjaCA9PT0gMHgyQlxuICAgICAgICAgIC8qICsgKi9cbiAgICAgICAgICA/IENIT01QSU5HX0tFRVAgOiBDSE9NUElOR19TVFJJUDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aHJvd0Vycm9yKHN0YXRlLCAncmVwZWF0IG9mIGEgY2hvbXBpbmcgbW9kZSBpZGVudGlmaWVyJyk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoKHRtcCA9IGZyb21EZWNpbWFsQ29kZShjaCkpID49IDApIHtcbiAgICAgIGlmICh0bXAgPT09IDApIHtcbiAgICAgICAgdGhyb3dFcnJvcihzdGF0ZSwgJ2JhZCBleHBsaWNpdCBpbmRlbnRhdGlvbiB3aWR0aCBvZiBhIGJsb2NrIHNjYWxhcjsgaXQgY2Fubm90IGJlIGxlc3MgdGhhbiBvbmUnKTtcbiAgICAgIH0gZWxzZSBpZiAoIWRldGVjdGVkSW5kZW50KSB7XG4gICAgICAgIHRleHRJbmRlbnQgPSBub2RlSW5kZW50ICsgdG1wIC0gMTtcbiAgICAgICAgZGV0ZWN0ZWRJbmRlbnQgPSB0cnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3dFcnJvcihzdGF0ZSwgJ3JlcGVhdCBvZiBhbiBpbmRlbnRhdGlvbiB3aWR0aCBpZGVudGlmaWVyJyk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIGlmIChpc19XSElURV9TUEFDRShjaCkpIHtcbiAgICBkbyB7XG4gICAgICBjaCA9IHN0YXRlLmlucHV0LmNoYXJDb2RlQXQoKytzdGF0ZS5wb3NpdGlvbik7XG4gICAgfSB3aGlsZSAoaXNfV0hJVEVfU1BBQ0UoY2gpKTtcblxuICAgIGlmIChjaCA9PT0gMHgyM1xuICAgIC8qICMgKi9cbiAgICApIHtcbiAgICAgICAgZG8ge1xuICAgICAgICAgIGNoID0gc3RhdGUuaW5wdXQuY2hhckNvZGVBdCgrK3N0YXRlLnBvc2l0aW9uKTtcbiAgICAgICAgfSB3aGlsZSAoIWlzX0VPTChjaCkgJiYgY2ggIT09IDApO1xuICAgICAgfVxuICB9XG5cbiAgd2hpbGUgKGNoICE9PSAwKSB7XG4gICAgcmVhZExpbmVCcmVhayhzdGF0ZSk7XG4gICAgc3RhdGUubGluZUluZGVudCA9IDA7XG4gICAgY2ggPSBzdGF0ZS5pbnB1dC5jaGFyQ29kZUF0KHN0YXRlLnBvc2l0aW9uKTtcblxuICAgIHdoaWxlICgoIWRldGVjdGVkSW5kZW50IHx8IHN0YXRlLmxpbmVJbmRlbnQgPCB0ZXh0SW5kZW50KSAmJiBjaCA9PT0gMHgyMFxuICAgIC8qIFNwYWNlICovXG4gICAgKSB7XG4gICAgICBzdGF0ZS5saW5lSW5kZW50Kys7XG4gICAgICBjaCA9IHN0YXRlLmlucHV0LmNoYXJDb2RlQXQoKytzdGF0ZS5wb3NpdGlvbik7XG4gICAgfVxuXG4gICAgaWYgKCFkZXRlY3RlZEluZGVudCAmJiBzdGF0ZS5saW5lSW5kZW50ID4gdGV4dEluZGVudCkge1xuICAgICAgdGV4dEluZGVudCA9IHN0YXRlLmxpbmVJbmRlbnQ7XG4gICAgfVxuXG4gICAgaWYgKGlzX0VPTChjaCkpIHtcbiAgICAgIGVtcHR5TGluZXMrKztcbiAgICAgIGNvbnRpbnVlO1xuICAgIH0gLy8gRW5kIG9mIHRoZSBzY2FsYXIuXG5cblxuICAgIGlmIChzdGF0ZS5saW5lSW5kZW50IDwgdGV4dEluZGVudCkge1xuICAgICAgLy8gUGVyZm9ybSB0aGUgY2hvbXBpbmcuXG4gICAgICBpZiAoY2hvbXBpbmcgPT09IENIT01QSU5HX0tFRVApIHtcbiAgICAgICAgc3RhdGUucmVzdWx0ICs9IGNvbW1vbi5yZXBlYXQoJ1xcbicsIGRpZFJlYWRDb250ZW50ID8gMSArIGVtcHR5TGluZXMgOiBlbXB0eUxpbmVzKTtcbiAgICAgIH0gZWxzZSBpZiAoY2hvbXBpbmcgPT09IENIT01QSU5HX0NMSVApIHtcbiAgICAgICAgaWYgKGRpZFJlYWRDb250ZW50KSB7XG4gICAgICAgICAgLy8gaS5lLiBvbmx5IGlmIHRoZSBzY2FsYXIgaXMgbm90IGVtcHR5LlxuICAgICAgICAgIHN0YXRlLnJlc3VsdCArPSAnXFxuJztcbiAgICAgICAgfVxuICAgICAgfSAvLyBCcmVhayB0aGlzIGB3aGlsZWAgY3ljbGUgYW5kIGdvIHRvIHRoZSBmdW5jaXRvbidzIGVwaWxvZ3VlLlxuXG5cbiAgICAgIGJyZWFrO1xuICAgIH0gLy8gRm9sZGVkIHN0eWxlOiB1c2UgZmFuY3kgcnVsZXMgdG8gaGFuZGxlIGxpbmUgYnJlYWtzLlxuXG5cbiAgICBpZiAoZm9sZGluZykge1xuICAgICAgLy8gTGluZXMgc3RhcnRpbmcgd2l0aCB3aGl0ZSBzcGFjZSBjaGFyYWN0ZXJzIChtb3JlLWluZGVudGVkIGxpbmVzKSBhcmUgbm90IGZvbGRlZC5cbiAgICAgIGlmIChpc19XSElURV9TUEFDRShjaCkpIHtcbiAgICAgICAgYXRNb3JlSW5kZW50ZWQgPSB0cnVlOyAvLyBleGNlcHQgZm9yIHRoZSBmaXJzdCBjb250ZW50IGxpbmUgKGNmLiBFeGFtcGxlIDguMSlcblxuICAgICAgICBzdGF0ZS5yZXN1bHQgKz0gY29tbW9uLnJlcGVhdCgnXFxuJywgZGlkUmVhZENvbnRlbnQgPyAxICsgZW1wdHlMaW5lcyA6IGVtcHR5TGluZXMpOyAvLyBFbmQgb2YgbW9yZS1pbmRlbnRlZCBibG9jay5cbiAgICAgIH0gZWxzZSBpZiAoYXRNb3JlSW5kZW50ZWQpIHtcbiAgICAgICAgYXRNb3JlSW5kZW50ZWQgPSBmYWxzZTtcbiAgICAgICAgc3RhdGUucmVzdWx0ICs9IGNvbW1vbi5yZXBlYXQoJ1xcbicsIGVtcHR5TGluZXMgKyAxKTsgLy8gSnVzdCBvbmUgbGluZSBicmVhayAtIHBlcmNlaXZlIGFzIHRoZSBzYW1lIGxpbmUuXG4gICAgICB9IGVsc2UgaWYgKGVtcHR5TGluZXMgPT09IDApIHtcbiAgICAgICAgaWYgKGRpZFJlYWRDb250ZW50KSB7XG4gICAgICAgICAgLy8gaS5lLiBvbmx5IGlmIHdlIGhhdmUgYWxyZWFkeSByZWFkIHNvbWUgc2NhbGFyIGNvbnRlbnQuXG4gICAgICAgICAgc3RhdGUucmVzdWx0ICs9ICcgJztcbiAgICAgICAgfSAvLyBTZXZlcmFsIGxpbmUgYnJlYWtzIC0gcGVyY2VpdmUgYXMgZGlmZmVyZW50IGxpbmVzLlxuXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzdGF0ZS5yZXN1bHQgKz0gY29tbW9uLnJlcGVhdCgnXFxuJywgZW1wdHlMaW5lcyk7XG4gICAgICB9IC8vIExpdGVyYWwgc3R5bGU6IGp1c3QgYWRkIGV4YWN0IG51bWJlciBvZiBsaW5lIGJyZWFrcyBiZXR3ZWVuIGNvbnRlbnQgbGluZXMuXG5cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gS2VlcCBhbGwgbGluZSBicmVha3MgZXhjZXB0IHRoZSBoZWFkZXIgbGluZSBicmVhay5cbiAgICAgIHN0YXRlLnJlc3VsdCArPSBjb21tb24ucmVwZWF0KCdcXG4nLCBkaWRSZWFkQ29udGVudCA/IDEgKyBlbXB0eUxpbmVzIDogZW1wdHlMaW5lcyk7XG4gICAgfVxuXG4gICAgZGlkUmVhZENvbnRlbnQgPSB0cnVlO1xuICAgIGRldGVjdGVkSW5kZW50ID0gdHJ1ZTtcbiAgICBlbXB0eUxpbmVzID0gMDtcbiAgICBjYXB0dXJlU3RhcnQgPSBzdGF0ZS5wb3NpdGlvbjtcblxuICAgIHdoaWxlICghaXNfRU9MKGNoKSAmJiBjaCAhPT0gMCkge1xuICAgICAgY2ggPSBzdGF0ZS5pbnB1dC5jaGFyQ29kZUF0KCsrc3RhdGUucG9zaXRpb24pO1xuICAgIH1cblxuICAgIGNhcHR1cmVTZWdtZW50KHN0YXRlLCBjYXB0dXJlU3RhcnQsIHN0YXRlLnBvc2l0aW9uLCBmYWxzZSk7XG4gIH1cblxuICByZXR1cm4gdHJ1ZTtcbn1cblxuZnVuY3Rpb24gcmVhZEJsb2NrU2VxdWVuY2Uoc3RhdGUsIG5vZGVJbmRlbnQpIHtcbiAgdmFyIF9saW5lLFxuICAgICAgX3RhZyA9IHN0YXRlLnRhZyxcbiAgICAgIF9hbmNob3IgPSBzdGF0ZS5hbmNob3IsXG4gICAgICBfcmVzdWx0ID0gW10sXG4gICAgICBmb2xsb3dpbmcsXG4gICAgICBkZXRlY3RlZCA9IGZhbHNlLFxuICAgICAgY2g7XG5cbiAgaWYgKHN0YXRlLmFuY2hvciAhPT0gbnVsbCkge1xuICAgIHN0YXRlLmFuY2hvck1hcFtzdGF0ZS5hbmNob3JdID0gX3Jlc3VsdDtcbiAgfVxuXG4gIGNoID0gc3RhdGUuaW5wdXQuY2hhckNvZGVBdChzdGF0ZS5wb3NpdGlvbik7XG5cbiAgd2hpbGUgKGNoICE9PSAwKSB7XG4gICAgaWYgKGNoICE9PSAweDJEXG4gICAgLyogLSAqL1xuICAgICkge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cblxuICAgIGZvbGxvd2luZyA9IHN0YXRlLmlucHV0LmNoYXJDb2RlQXQoc3RhdGUucG9zaXRpb24gKyAxKTtcblxuICAgIGlmICghaXNfV1NfT1JfRU9MKGZvbGxvd2luZykpIHtcbiAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIGRldGVjdGVkID0gdHJ1ZTtcbiAgICBzdGF0ZS5wb3NpdGlvbisrO1xuXG4gICAgaWYgKHNraXBTZXBhcmF0aW9uU3BhY2Uoc3RhdGUsIHRydWUsIC0xKSkge1xuICAgICAgaWYgKHN0YXRlLmxpbmVJbmRlbnQgPD0gbm9kZUluZGVudCkge1xuICAgICAgICBfcmVzdWx0LnB1c2gobnVsbCk7XG5cbiAgICAgICAgY2ggPSBzdGF0ZS5pbnB1dC5jaGFyQ29kZUF0KHN0YXRlLnBvc2l0aW9uKTtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgfVxuXG4gICAgX2xpbmUgPSBzdGF0ZS5saW5lO1xuICAgIGNvbXBvc2VOb2RlKHN0YXRlLCBub2RlSW5kZW50LCBDT05URVhUX0JMT0NLX0lOLCBmYWxzZSwgdHJ1ZSk7XG5cbiAgICBfcmVzdWx0LnB1c2goc3RhdGUucmVzdWx0KTtcblxuICAgIHNraXBTZXBhcmF0aW9uU3BhY2Uoc3RhdGUsIHRydWUsIC0xKTtcbiAgICBjaCA9IHN0YXRlLmlucHV0LmNoYXJDb2RlQXQoc3RhdGUucG9zaXRpb24pO1xuXG4gICAgaWYgKChzdGF0ZS5saW5lID09PSBfbGluZSB8fCBzdGF0ZS5saW5lSW5kZW50ID4gbm9kZUluZGVudCkgJiYgY2ggIT09IDApIHtcbiAgICAgIHRocm93RXJyb3Ioc3RhdGUsICdiYWQgaW5kZW50YXRpb24gb2YgYSBzZXF1ZW5jZSBlbnRyeScpO1xuICAgIH0gZWxzZSBpZiAoc3RhdGUubGluZUluZGVudCA8IG5vZGVJbmRlbnQpIHtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIGlmIChkZXRlY3RlZCkge1xuICAgIHN0YXRlLnRhZyA9IF90YWc7XG4gICAgc3RhdGUuYW5jaG9yID0gX2FuY2hvcjtcbiAgICBzdGF0ZS5raW5kID0gJ3NlcXVlbmNlJztcbiAgICBzdGF0ZS5yZXN1bHQgPSBfcmVzdWx0O1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgcmV0dXJuIGZhbHNlO1xufVxuXG5mdW5jdGlvbiByZWFkQmxvY2tNYXBwaW5nKHN0YXRlLCBub2RlSW5kZW50LCBmbG93SW5kZW50KSB7XG4gIHZhciBmb2xsb3dpbmcsXG4gICAgICBhbGxvd0NvbXBhY3QsXG4gICAgICBfbGluZSxcbiAgICAgIF9wb3MsXG4gICAgICBfdGFnID0gc3RhdGUudGFnLFxuICAgICAgX2FuY2hvciA9IHN0YXRlLmFuY2hvcixcbiAgICAgIF9yZXN1bHQgPSB7fSxcbiAgICAgIG92ZXJyaWRhYmxlS2V5cyA9IHt9LFxuICAgICAga2V5VGFnID0gbnVsbCxcbiAgICAgIGtleU5vZGUgPSBudWxsLFxuICAgICAgdmFsdWVOb2RlID0gbnVsbCxcbiAgICAgIGF0RXhwbGljaXRLZXkgPSBmYWxzZSxcbiAgICAgIGRldGVjdGVkID0gZmFsc2UsXG4gICAgICBjaDtcblxuICBpZiAoc3RhdGUuYW5jaG9yICE9PSBudWxsKSB7XG4gICAgc3RhdGUuYW5jaG9yTWFwW3N0YXRlLmFuY2hvcl0gPSBfcmVzdWx0O1xuICB9XG5cbiAgY2ggPSBzdGF0ZS5pbnB1dC5jaGFyQ29kZUF0KHN0YXRlLnBvc2l0aW9uKTtcblxuICB3aGlsZSAoY2ggIT09IDApIHtcbiAgICBmb2xsb3dpbmcgPSBzdGF0ZS5pbnB1dC5jaGFyQ29kZUF0KHN0YXRlLnBvc2l0aW9uICsgMSk7XG4gICAgX2xpbmUgPSBzdGF0ZS5saW5lOyAvLyBTYXZlIHRoZSBjdXJyZW50IGxpbmUuXG5cbiAgICBfcG9zID0gc3RhdGUucG9zaXRpb247IC8vXG4gICAgLy8gRXhwbGljaXQgbm90YXRpb24gY2FzZS4gVGhlcmUgYXJlIHR3byBzZXBhcmF0ZSBibG9ja3M6XG4gICAgLy8gZmlyc3QgZm9yIHRoZSBrZXkgKGRlbm90ZWQgYnkgXCI/XCIpIGFuZCBzZWNvbmQgZm9yIHRoZSB2YWx1ZSAoZGVub3RlZCBieSBcIjpcIilcbiAgICAvL1xuXG4gICAgaWYgKChjaCA9PT0gMHgzRlxuICAgIC8qID8gKi9cbiAgICB8fCBjaCA9PT0gMHgzQVxuICAgIC8qIDogKi9cbiAgICApICYmIGlzX1dTX09SX0VPTChmb2xsb3dpbmcpKSB7XG4gICAgICBpZiAoY2ggPT09IDB4M0ZcbiAgICAgIC8qID8gKi9cbiAgICAgICkge1xuICAgICAgICAgIGlmIChhdEV4cGxpY2l0S2V5KSB7XG4gICAgICAgICAgICBzdG9yZU1hcHBpbmdQYWlyKHN0YXRlLCBfcmVzdWx0LCBvdmVycmlkYWJsZUtleXMsIGtleVRhZywga2V5Tm9kZSwgbnVsbCk7XG4gICAgICAgICAgICBrZXlUYWcgPSBrZXlOb2RlID0gdmFsdWVOb2RlID0gbnVsbDtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBkZXRlY3RlZCA9IHRydWU7XG4gICAgICAgICAgYXRFeHBsaWNpdEtleSA9IHRydWU7XG4gICAgICAgICAgYWxsb3dDb21wYWN0ID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIGlmIChhdEV4cGxpY2l0S2V5KSB7XG4gICAgICAgIC8vIGkuZS4gMHgzQS8qIDogKi8gPT09IGNoYXJhY3RlciBhZnRlciB0aGUgZXhwbGljaXQga2V5LlxuICAgICAgICBhdEV4cGxpY2l0S2V5ID0gZmFsc2U7XG4gICAgICAgIGFsbG93Q29tcGFjdCA9IHRydWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvd0Vycm9yKHN0YXRlLCAnaW5jb21wbGV0ZSBleHBsaWNpdCBtYXBwaW5nIHBhaXI7IGEga2V5IG5vZGUgaXMgbWlzc2VkOyBvciBmb2xsb3dlZCBieSBhIG5vbi10YWJ1bGF0ZWQgZW1wdHkgbGluZScpO1xuICAgICAgfVxuXG4gICAgICBzdGF0ZS5wb3NpdGlvbiArPSAxO1xuICAgICAgY2ggPSBmb2xsb3dpbmc7IC8vXG4gICAgICAvLyBJbXBsaWNpdCBub3RhdGlvbiBjYXNlLiBGbG93LXN0eWxlIG5vZGUgYXMgdGhlIGtleSBmaXJzdCwgdGhlbiBcIjpcIiwgYW5kIHRoZSB2YWx1ZS5cbiAgICAgIC8vXG4gICAgfSBlbHNlIGlmIChjb21wb3NlTm9kZShzdGF0ZSwgZmxvd0luZGVudCwgQ09OVEVYVF9GTE9XX09VVCwgZmFsc2UsIHRydWUpKSB7XG4gICAgICBpZiAoc3RhdGUubGluZSA9PT0gX2xpbmUpIHtcbiAgICAgICAgY2ggPSBzdGF0ZS5pbnB1dC5jaGFyQ29kZUF0KHN0YXRlLnBvc2l0aW9uKTtcblxuICAgICAgICB3aGlsZSAoaXNfV0hJVEVfU1BBQ0UoY2gpKSB7XG4gICAgICAgICAgY2ggPSBzdGF0ZS5pbnB1dC5jaGFyQ29kZUF0KCsrc3RhdGUucG9zaXRpb24pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNoID09PSAweDNBXG4gICAgICAgIC8qIDogKi9cbiAgICAgICAgKSB7XG4gICAgICAgICAgICBjaCA9IHN0YXRlLmlucHV0LmNoYXJDb2RlQXQoKytzdGF0ZS5wb3NpdGlvbik7XG5cbiAgICAgICAgICAgIGlmICghaXNfV1NfT1JfRU9MKGNoKSkge1xuICAgICAgICAgICAgICB0aHJvd0Vycm9yKHN0YXRlLCAnYSB3aGl0ZXNwYWNlIGNoYXJhY3RlciBpcyBleHBlY3RlZCBhZnRlciB0aGUga2V5LXZhbHVlIHNlcGFyYXRvciB3aXRoaW4gYSBibG9jayBtYXBwaW5nJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChhdEV4cGxpY2l0S2V5KSB7XG4gICAgICAgICAgICAgIHN0b3JlTWFwcGluZ1BhaXIoc3RhdGUsIF9yZXN1bHQsIG92ZXJyaWRhYmxlS2V5cywga2V5VGFnLCBrZXlOb2RlLCBudWxsKTtcbiAgICAgICAgICAgICAga2V5VGFnID0ga2V5Tm9kZSA9IHZhbHVlTm9kZSA9IG51bGw7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGRldGVjdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIGF0RXhwbGljaXRLZXkgPSBmYWxzZTtcbiAgICAgICAgICAgIGFsbG93Q29tcGFjdCA9IGZhbHNlO1xuICAgICAgICAgICAga2V5VGFnID0gc3RhdGUudGFnO1xuICAgICAgICAgICAga2V5Tm9kZSA9IHN0YXRlLnJlc3VsdDtcbiAgICAgICAgICB9IGVsc2UgaWYgKGRldGVjdGVkKSB7XG4gICAgICAgICAgdGhyb3dFcnJvcihzdGF0ZSwgJ2NhbiBub3QgcmVhZCBhbiBpbXBsaWNpdCBtYXBwaW5nIHBhaXI7IGEgY29sb24gaXMgbWlzc2VkJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc3RhdGUudGFnID0gX3RhZztcbiAgICAgICAgICBzdGF0ZS5hbmNob3IgPSBfYW5jaG9yO1xuICAgICAgICAgIHJldHVybiB0cnVlOyAvLyBLZWVwIHRoZSByZXN1bHQgb2YgYGNvbXBvc2VOb2RlYC5cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChkZXRlY3RlZCkge1xuICAgICAgICB0aHJvd0Vycm9yKHN0YXRlLCAnY2FuIG5vdCByZWFkIGEgYmxvY2sgbWFwcGluZyBlbnRyeTsgYSBtdWx0aWxpbmUga2V5IG1heSBub3QgYmUgYW4gaW1wbGljaXQga2V5Jyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzdGF0ZS50YWcgPSBfdGFnO1xuICAgICAgICBzdGF0ZS5hbmNob3IgPSBfYW5jaG9yO1xuICAgICAgICByZXR1cm4gdHJ1ZTsgLy8gS2VlcCB0aGUgcmVzdWx0IG9mIGBjb21wb3NlTm9kZWAuXG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgICAgYnJlYWs7IC8vIFJlYWRpbmcgaXMgZG9uZS4gR28gdG8gdGhlIGVwaWxvZ3VlLlxuICAgICAgfSAvL1xuICAgIC8vIENvbW1vbiByZWFkaW5nIGNvZGUgZm9yIGJvdGggZXhwbGljaXQgYW5kIGltcGxpY2l0IG5vdGF0aW9ucy5cbiAgICAvL1xuXG5cbiAgICBpZiAoc3RhdGUubGluZSA9PT0gX2xpbmUgfHwgc3RhdGUubGluZUluZGVudCA+IG5vZGVJbmRlbnQpIHtcbiAgICAgIGlmIChjb21wb3NlTm9kZShzdGF0ZSwgbm9kZUluZGVudCwgQ09OVEVYVF9CTE9DS19PVVQsIHRydWUsIGFsbG93Q29tcGFjdCkpIHtcbiAgICAgICAgaWYgKGF0RXhwbGljaXRLZXkpIHtcbiAgICAgICAgICBrZXlOb2RlID0gc3RhdGUucmVzdWx0O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHZhbHVlTm9kZSA9IHN0YXRlLnJlc3VsdDtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoIWF0RXhwbGljaXRLZXkpIHtcbiAgICAgICAgc3RvcmVNYXBwaW5nUGFpcihzdGF0ZSwgX3Jlc3VsdCwgb3ZlcnJpZGFibGVLZXlzLCBrZXlUYWcsIGtleU5vZGUsIHZhbHVlTm9kZSwgX2xpbmUsIF9wb3MpO1xuICAgICAgICBrZXlUYWcgPSBrZXlOb2RlID0gdmFsdWVOb2RlID0gbnVsbDtcbiAgICAgIH1cblxuICAgICAgc2tpcFNlcGFyYXRpb25TcGFjZShzdGF0ZSwgdHJ1ZSwgLTEpO1xuICAgICAgY2ggPSBzdGF0ZS5pbnB1dC5jaGFyQ29kZUF0KHN0YXRlLnBvc2l0aW9uKTtcbiAgICB9XG5cbiAgICBpZiAoc3RhdGUubGluZUluZGVudCA+IG5vZGVJbmRlbnQgJiYgY2ggIT09IDApIHtcbiAgICAgIHRocm93RXJyb3Ioc3RhdGUsICdiYWQgaW5kZW50YXRpb24gb2YgYSBtYXBwaW5nIGVudHJ5Jyk7XG4gICAgfSBlbHNlIGlmIChzdGF0ZS5saW5lSW5kZW50IDwgbm9kZUluZGVudCkge1xuICAgICAgYnJlYWs7XG4gICAgfVxuICB9IC8vXG4gIC8vIEVwaWxvZ3VlLlxuICAvL1xuICAvLyBTcGVjaWFsIGNhc2U6IGxhc3QgbWFwcGluZydzIG5vZGUgY29udGFpbnMgb25seSB0aGUga2V5IGluIGV4cGxpY2l0IG5vdGF0aW9uLlxuXG5cbiAgaWYgKGF0RXhwbGljaXRLZXkpIHtcbiAgICBzdG9yZU1hcHBpbmdQYWlyKHN0YXRlLCBfcmVzdWx0LCBvdmVycmlkYWJsZUtleXMsIGtleVRhZywga2V5Tm9kZSwgbnVsbCk7XG4gIH0gLy8gRXhwb3NlIHRoZSByZXN1bHRpbmcgbWFwcGluZy5cblxuXG4gIGlmIChkZXRlY3RlZCkge1xuICAgIHN0YXRlLnRhZyA9IF90YWc7XG4gICAgc3RhdGUuYW5jaG9yID0gX2FuY2hvcjtcbiAgICBzdGF0ZS5raW5kID0gJ21hcHBpbmcnO1xuICAgIHN0YXRlLnJlc3VsdCA9IF9yZXN1bHQ7XG4gIH1cblxuICByZXR1cm4gZGV0ZWN0ZWQ7XG59XG5cbmZ1bmN0aW9uIHJlYWRUYWdQcm9wZXJ0eShzdGF0ZSkge1xuICB2YXIgX3Bvc2l0aW9uLFxuICAgICAgaXNWZXJiYXRpbSA9IGZhbHNlLFxuICAgICAgaXNOYW1lZCA9IGZhbHNlLFxuICAgICAgdGFnSGFuZGxlLFxuICAgICAgdGFnTmFtZSxcbiAgICAgIGNoO1xuXG4gIGNoID0gc3RhdGUuaW5wdXQuY2hhckNvZGVBdChzdGF0ZS5wb3NpdGlvbik7XG4gIGlmIChjaCAhPT0gMHgyMVxuICAvKiAhICovXG4gICkgcmV0dXJuIGZhbHNlO1xuXG4gIGlmIChzdGF0ZS50YWcgIT09IG51bGwpIHtcbiAgICB0aHJvd0Vycm9yKHN0YXRlLCAnZHVwbGljYXRpb24gb2YgYSB0YWcgcHJvcGVydHknKTtcbiAgfVxuXG4gIGNoID0gc3RhdGUuaW5wdXQuY2hhckNvZGVBdCgrK3N0YXRlLnBvc2l0aW9uKTtcblxuICBpZiAoY2ggPT09IDB4M0NcbiAgLyogPCAqL1xuICApIHtcbiAgICAgIGlzVmVyYmF0aW0gPSB0cnVlO1xuICAgICAgY2ggPSBzdGF0ZS5pbnB1dC5jaGFyQ29kZUF0KCsrc3RhdGUucG9zaXRpb24pO1xuICAgIH0gZWxzZSBpZiAoY2ggPT09IDB4MjFcbiAgLyogISAqL1xuICApIHtcbiAgICAgIGlzTmFtZWQgPSB0cnVlO1xuICAgICAgdGFnSGFuZGxlID0gJyEhJztcbiAgICAgIGNoID0gc3RhdGUuaW5wdXQuY2hhckNvZGVBdCgrK3N0YXRlLnBvc2l0aW9uKTtcbiAgICB9IGVsc2Uge1xuICAgIHRhZ0hhbmRsZSA9ICchJztcbiAgfVxuXG4gIF9wb3NpdGlvbiA9IHN0YXRlLnBvc2l0aW9uO1xuXG4gIGlmIChpc1ZlcmJhdGltKSB7XG4gICAgZG8ge1xuICAgICAgY2ggPSBzdGF0ZS5pbnB1dC5jaGFyQ29kZUF0KCsrc3RhdGUucG9zaXRpb24pO1xuICAgIH0gd2hpbGUgKGNoICE9PSAwICYmIGNoICE9PSAweDNFXG4gICAgLyogPiAqL1xuICAgICk7XG5cbiAgICBpZiAoc3RhdGUucG9zaXRpb24gPCBzdGF0ZS5sZW5ndGgpIHtcbiAgICAgIHRhZ05hbWUgPSBzdGF0ZS5pbnB1dC5zbGljZShfcG9zaXRpb24sIHN0YXRlLnBvc2l0aW9uKTtcbiAgICAgIGNoID0gc3RhdGUuaW5wdXQuY2hhckNvZGVBdCgrK3N0YXRlLnBvc2l0aW9uKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3dFcnJvcihzdGF0ZSwgJ3VuZXhwZWN0ZWQgZW5kIG9mIHRoZSBzdHJlYW0gd2l0aGluIGEgdmVyYmF0aW0gdGFnJyk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIHdoaWxlIChjaCAhPT0gMCAmJiAhaXNfV1NfT1JfRU9MKGNoKSkge1xuICAgICAgaWYgKGNoID09PSAweDIxXG4gICAgICAvKiAhICovXG4gICAgICApIHtcbiAgICAgICAgICBpZiAoIWlzTmFtZWQpIHtcbiAgICAgICAgICAgIHRhZ0hhbmRsZSA9IHN0YXRlLmlucHV0LnNsaWNlKF9wb3NpdGlvbiAtIDEsIHN0YXRlLnBvc2l0aW9uICsgMSk7XG5cbiAgICAgICAgICAgIGlmICghUEFUVEVSTl9UQUdfSEFORExFLnRlc3QodGFnSGFuZGxlKSkge1xuICAgICAgICAgICAgICB0aHJvd0Vycm9yKHN0YXRlLCAnbmFtZWQgdGFnIGhhbmRsZSBjYW5ub3QgY29udGFpbiBzdWNoIGNoYXJhY3RlcnMnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaXNOYW1lZCA9IHRydWU7XG4gICAgICAgICAgICBfcG9zaXRpb24gPSBzdGF0ZS5wb3NpdGlvbiArIDE7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRocm93RXJyb3Ioc3RhdGUsICd0YWcgc3VmZml4IGNhbm5vdCBjb250YWluIGV4Y2xhbWF0aW9uIG1hcmtzJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgIGNoID0gc3RhdGUuaW5wdXQuY2hhckNvZGVBdCgrK3N0YXRlLnBvc2l0aW9uKTtcbiAgICB9XG5cbiAgICB0YWdOYW1lID0gc3RhdGUuaW5wdXQuc2xpY2UoX3Bvc2l0aW9uLCBzdGF0ZS5wb3NpdGlvbik7XG5cbiAgICBpZiAoUEFUVEVSTl9GTE9XX0lORElDQVRPUlMudGVzdCh0YWdOYW1lKSkge1xuICAgICAgdGhyb3dFcnJvcihzdGF0ZSwgJ3RhZyBzdWZmaXggY2Fubm90IGNvbnRhaW4gZmxvdyBpbmRpY2F0b3IgY2hhcmFjdGVycycpO1xuICAgIH1cbiAgfVxuXG4gIGlmICh0YWdOYW1lICYmICFQQVRURVJOX1RBR19VUkkudGVzdCh0YWdOYW1lKSkge1xuICAgIHRocm93RXJyb3Ioc3RhdGUsICd0YWcgbmFtZSBjYW5ub3QgY29udGFpbiBzdWNoIGNoYXJhY3RlcnM6ICcgKyB0YWdOYW1lKTtcbiAgfVxuXG4gIGlmIChpc1ZlcmJhdGltKSB7XG4gICAgc3RhdGUudGFnID0gdGFnTmFtZTtcbiAgfSBlbHNlIGlmIChfaGFzT3duUHJvcGVydHkkMi5jYWxsKHN0YXRlLnRhZ01hcCwgdGFnSGFuZGxlKSkge1xuICAgIHN0YXRlLnRhZyA9IHN0YXRlLnRhZ01hcFt0YWdIYW5kbGVdICsgdGFnTmFtZTtcbiAgfSBlbHNlIGlmICh0YWdIYW5kbGUgPT09ICchJykge1xuICAgIHN0YXRlLnRhZyA9ICchJyArIHRhZ05hbWU7XG4gIH0gZWxzZSBpZiAodGFnSGFuZGxlID09PSAnISEnKSB7XG4gICAgc3RhdGUudGFnID0gJ3RhZzp5YW1sLm9yZywyMDAyOicgKyB0YWdOYW1lO1xuICB9IGVsc2Uge1xuICAgIHRocm93RXJyb3Ioc3RhdGUsICd1bmRlY2xhcmVkIHRhZyBoYW5kbGUgXCInICsgdGFnSGFuZGxlICsgJ1wiJyk7XG4gIH1cblxuICByZXR1cm4gdHJ1ZTtcbn1cblxuZnVuY3Rpb24gcmVhZEFuY2hvclByb3BlcnR5KHN0YXRlKSB7XG4gIHZhciBfcG9zaXRpb24sIGNoO1xuXG4gIGNoID0gc3RhdGUuaW5wdXQuY2hhckNvZGVBdChzdGF0ZS5wb3NpdGlvbik7XG4gIGlmIChjaCAhPT0gMHgyNlxuICAvKiAmICovXG4gICkgcmV0dXJuIGZhbHNlO1xuXG4gIGlmIChzdGF0ZS5hbmNob3IgIT09IG51bGwpIHtcbiAgICB0aHJvd0Vycm9yKHN0YXRlLCAnZHVwbGljYXRpb24gb2YgYW4gYW5jaG9yIHByb3BlcnR5Jyk7XG4gIH1cblxuICBjaCA9IHN0YXRlLmlucHV0LmNoYXJDb2RlQXQoKytzdGF0ZS5wb3NpdGlvbik7XG4gIF9wb3NpdGlvbiA9IHN0YXRlLnBvc2l0aW9uO1xuXG4gIHdoaWxlIChjaCAhPT0gMCAmJiAhaXNfV1NfT1JfRU9MKGNoKSAmJiAhaXNfRkxPV19JTkRJQ0FUT1IoY2gpKSB7XG4gICAgY2ggPSBzdGF0ZS5pbnB1dC5jaGFyQ29kZUF0KCsrc3RhdGUucG9zaXRpb24pO1xuICB9XG5cbiAgaWYgKHN0YXRlLnBvc2l0aW9uID09PSBfcG9zaXRpb24pIHtcbiAgICB0aHJvd0Vycm9yKHN0YXRlLCAnbmFtZSBvZiBhbiBhbmNob3Igbm9kZSBtdXN0IGNvbnRhaW4gYXQgbGVhc3Qgb25lIGNoYXJhY3RlcicpO1xuICB9XG5cbiAgc3RhdGUuYW5jaG9yID0gc3RhdGUuaW5wdXQuc2xpY2UoX3Bvc2l0aW9uLCBzdGF0ZS5wb3NpdGlvbik7XG4gIHJldHVybiB0cnVlO1xufVxuXG5mdW5jdGlvbiByZWFkQWxpYXMoc3RhdGUpIHtcbiAgdmFyIF9wb3NpdGlvbiwgYWxpYXMsIGNoO1xuXG4gIGNoID0gc3RhdGUuaW5wdXQuY2hhckNvZGVBdChzdGF0ZS5wb3NpdGlvbik7XG4gIGlmIChjaCAhPT0gMHgyQVxuICAvKiAqICovXG4gICkgcmV0dXJuIGZhbHNlO1xuICBjaCA9IHN0YXRlLmlucHV0LmNoYXJDb2RlQXQoKytzdGF0ZS5wb3NpdGlvbik7XG4gIF9wb3NpdGlvbiA9IHN0YXRlLnBvc2l0aW9uO1xuXG4gIHdoaWxlIChjaCAhPT0gMCAmJiAhaXNfV1NfT1JfRU9MKGNoKSAmJiAhaXNfRkxPV19JTkRJQ0FUT1IoY2gpKSB7XG4gICAgY2ggPSBzdGF0ZS5pbnB1dC5jaGFyQ29kZUF0KCsrc3RhdGUucG9zaXRpb24pO1xuICB9XG5cbiAgaWYgKHN0YXRlLnBvc2l0aW9uID09PSBfcG9zaXRpb24pIHtcbiAgICB0aHJvd0Vycm9yKHN0YXRlLCAnbmFtZSBvZiBhbiBhbGlhcyBub2RlIG11c3QgY29udGFpbiBhdCBsZWFzdCBvbmUgY2hhcmFjdGVyJyk7XG4gIH1cblxuICBhbGlhcyA9IHN0YXRlLmlucHV0LnNsaWNlKF9wb3NpdGlvbiwgc3RhdGUucG9zaXRpb24pO1xuXG4gIGlmICghX2hhc093blByb3BlcnR5JDIuY2FsbChzdGF0ZS5hbmNob3JNYXAsIGFsaWFzKSkge1xuICAgIHRocm93RXJyb3Ioc3RhdGUsICd1bmlkZW50aWZpZWQgYWxpYXMgXCInICsgYWxpYXMgKyAnXCInKTtcbiAgfVxuXG4gIHN0YXRlLnJlc3VsdCA9IHN0YXRlLmFuY2hvck1hcFthbGlhc107XG4gIHNraXBTZXBhcmF0aW9uU3BhY2Uoc3RhdGUsIHRydWUsIC0xKTtcbiAgcmV0dXJuIHRydWU7XG59XG5cbmZ1bmN0aW9uIGNvbXBvc2VOb2RlKHN0YXRlLCBwYXJlbnRJbmRlbnQsIG5vZGVDb250ZXh0LCBhbGxvd1RvU2VlaywgYWxsb3dDb21wYWN0KSB7XG4gIHZhciBhbGxvd0Jsb2NrU3R5bGVzLFxuICAgICAgYWxsb3dCbG9ja1NjYWxhcnMsXG4gICAgICBhbGxvd0Jsb2NrQ29sbGVjdGlvbnMsXG4gICAgICBpbmRlbnRTdGF0dXMgPSAxLFxuICAgICAgLy8gMTogdGhpcz5wYXJlbnQsIDA6IHRoaXM9cGFyZW50LCAtMTogdGhpczxwYXJlbnRcbiAgYXROZXdMaW5lID0gZmFsc2UsXG4gICAgICBoYXNDb250ZW50ID0gZmFsc2UsXG4gICAgICB0eXBlSW5kZXgsXG4gICAgICB0eXBlUXVhbnRpdHksXG4gICAgICB0eXBlLFxuICAgICAgZmxvd0luZGVudCxcbiAgICAgIGJsb2NrSW5kZW50O1xuXG4gIGlmIChzdGF0ZS5saXN0ZW5lciAhPT0gbnVsbCkge1xuICAgIHN0YXRlLmxpc3RlbmVyKCdvcGVuJywgc3RhdGUpO1xuICB9XG5cbiAgc3RhdGUudGFnID0gbnVsbDtcbiAgc3RhdGUuYW5jaG9yID0gbnVsbDtcbiAgc3RhdGUua2luZCA9IG51bGw7XG4gIHN0YXRlLnJlc3VsdCA9IG51bGw7XG4gIGFsbG93QmxvY2tTdHlsZXMgPSBhbGxvd0Jsb2NrU2NhbGFycyA9IGFsbG93QmxvY2tDb2xsZWN0aW9ucyA9IENPTlRFWFRfQkxPQ0tfT1VUID09PSBub2RlQ29udGV4dCB8fCBDT05URVhUX0JMT0NLX0lOID09PSBub2RlQ29udGV4dDtcblxuICBpZiAoYWxsb3dUb1NlZWspIHtcbiAgICBpZiAoc2tpcFNlcGFyYXRpb25TcGFjZShzdGF0ZSwgdHJ1ZSwgLTEpKSB7XG4gICAgICBhdE5ld0xpbmUgPSB0cnVlO1xuXG4gICAgICBpZiAoc3RhdGUubGluZUluZGVudCA+IHBhcmVudEluZGVudCkge1xuICAgICAgICBpbmRlbnRTdGF0dXMgPSAxO1xuICAgICAgfSBlbHNlIGlmIChzdGF0ZS5saW5lSW5kZW50ID09PSBwYXJlbnRJbmRlbnQpIHtcbiAgICAgICAgaW5kZW50U3RhdHVzID0gMDtcbiAgICAgIH0gZWxzZSBpZiAoc3RhdGUubGluZUluZGVudCA8IHBhcmVudEluZGVudCkge1xuICAgICAgICBpbmRlbnRTdGF0dXMgPSAtMTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBpZiAoaW5kZW50U3RhdHVzID09PSAxKSB7XG4gICAgd2hpbGUgKHJlYWRUYWdQcm9wZXJ0eShzdGF0ZSkgfHwgcmVhZEFuY2hvclByb3BlcnR5KHN0YXRlKSkge1xuICAgICAgaWYgKHNraXBTZXBhcmF0aW9uU3BhY2Uoc3RhdGUsIHRydWUsIC0xKSkge1xuICAgICAgICBhdE5ld0xpbmUgPSB0cnVlO1xuICAgICAgICBhbGxvd0Jsb2NrQ29sbGVjdGlvbnMgPSBhbGxvd0Jsb2NrU3R5bGVzO1xuXG4gICAgICAgIGlmIChzdGF0ZS5saW5lSW5kZW50ID4gcGFyZW50SW5kZW50KSB7XG4gICAgICAgICAgaW5kZW50U3RhdHVzID0gMTtcbiAgICAgICAgfSBlbHNlIGlmIChzdGF0ZS5saW5lSW5kZW50ID09PSBwYXJlbnRJbmRlbnQpIHtcbiAgICAgICAgICBpbmRlbnRTdGF0dXMgPSAwO1xuICAgICAgICB9IGVsc2UgaWYgKHN0YXRlLmxpbmVJbmRlbnQgPCBwYXJlbnRJbmRlbnQpIHtcbiAgICAgICAgICBpbmRlbnRTdGF0dXMgPSAtMTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYWxsb3dCbG9ja0NvbGxlY3Rpb25zID0gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgaWYgKGFsbG93QmxvY2tDb2xsZWN0aW9ucykge1xuICAgIGFsbG93QmxvY2tDb2xsZWN0aW9ucyA9IGF0TmV3TGluZSB8fCBhbGxvd0NvbXBhY3Q7XG4gIH1cblxuICBpZiAoaW5kZW50U3RhdHVzID09PSAxIHx8IENPTlRFWFRfQkxPQ0tfT1VUID09PSBub2RlQ29udGV4dCkge1xuICAgIGlmIChDT05URVhUX0ZMT1dfSU4gPT09IG5vZGVDb250ZXh0IHx8IENPTlRFWFRfRkxPV19PVVQgPT09IG5vZGVDb250ZXh0KSB7XG4gICAgICBmbG93SW5kZW50ID0gcGFyZW50SW5kZW50O1xuICAgIH0gZWxzZSB7XG4gICAgICBmbG93SW5kZW50ID0gcGFyZW50SW5kZW50ICsgMTtcbiAgICB9XG5cbiAgICBibG9ja0luZGVudCA9IHN0YXRlLnBvc2l0aW9uIC0gc3RhdGUubGluZVN0YXJ0O1xuXG4gICAgaWYgKGluZGVudFN0YXR1cyA9PT0gMSkge1xuICAgICAgaWYgKGFsbG93QmxvY2tDb2xsZWN0aW9ucyAmJiAocmVhZEJsb2NrU2VxdWVuY2Uoc3RhdGUsIGJsb2NrSW5kZW50KSB8fCByZWFkQmxvY2tNYXBwaW5nKHN0YXRlLCBibG9ja0luZGVudCwgZmxvd0luZGVudCkpIHx8IHJlYWRGbG93Q29sbGVjdGlvbihzdGF0ZSwgZmxvd0luZGVudCkpIHtcbiAgICAgICAgaGFzQ29udGVudCA9IHRydWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoYWxsb3dCbG9ja1NjYWxhcnMgJiYgcmVhZEJsb2NrU2NhbGFyKHN0YXRlLCBmbG93SW5kZW50KSB8fCByZWFkU2luZ2xlUXVvdGVkU2NhbGFyKHN0YXRlLCBmbG93SW5kZW50KSB8fCByZWFkRG91YmxlUXVvdGVkU2NhbGFyKHN0YXRlLCBmbG93SW5kZW50KSkge1xuICAgICAgICAgIGhhc0NvbnRlbnQgPSB0cnVlO1xuICAgICAgICB9IGVsc2UgaWYgKHJlYWRBbGlhcyhzdGF0ZSkpIHtcbiAgICAgICAgICBoYXNDb250ZW50ID0gdHJ1ZTtcblxuICAgICAgICAgIGlmIChzdGF0ZS50YWcgIT09IG51bGwgfHwgc3RhdGUuYW5jaG9yICE9PSBudWxsKSB7XG4gICAgICAgICAgICB0aHJvd0Vycm9yKHN0YXRlLCAnYWxpYXMgbm9kZSBzaG91bGQgbm90IGhhdmUgYW55IHByb3BlcnRpZXMnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAocmVhZFBsYWluU2NhbGFyKHN0YXRlLCBmbG93SW5kZW50LCBDT05URVhUX0ZMT1dfSU4gPT09IG5vZGVDb250ZXh0KSkge1xuICAgICAgICAgIGhhc0NvbnRlbnQgPSB0cnVlO1xuXG4gICAgICAgICAgaWYgKHN0YXRlLnRhZyA9PT0gbnVsbCkge1xuICAgICAgICAgICAgc3RhdGUudGFnID0gJz8nO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChzdGF0ZS5hbmNob3IgIT09IG51bGwpIHtcbiAgICAgICAgICBzdGF0ZS5hbmNob3JNYXBbc3RhdGUuYW5jaG9yXSA9IHN0YXRlLnJlc3VsdDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoaW5kZW50U3RhdHVzID09PSAwKSB7XG4gICAgICAvLyBTcGVjaWFsIGNhc2U6IGJsb2NrIHNlcXVlbmNlcyBhcmUgYWxsb3dlZCB0byBoYXZlIHNhbWUgaW5kZW50YXRpb24gbGV2ZWwgYXMgdGhlIHBhcmVudC5cbiAgICAgIC8vIGh0dHA6Ly93d3cueWFtbC5vcmcvc3BlYy8xLjIvc3BlYy5odG1sI2lkMjc5OTc4NFxuICAgICAgaGFzQ29udGVudCA9IGFsbG93QmxvY2tDb2xsZWN0aW9ucyAmJiByZWFkQmxvY2tTZXF1ZW5jZShzdGF0ZSwgYmxvY2tJbmRlbnQpO1xuICAgIH1cbiAgfVxuXG4gIGlmIChzdGF0ZS50YWcgIT09IG51bGwgJiYgc3RhdGUudGFnICE9PSAnIScpIHtcbiAgICBpZiAoc3RhdGUudGFnID09PSAnPycpIHtcbiAgICAgIC8vIEltcGxpY2l0IHJlc29sdmluZyBpcyBub3QgYWxsb3dlZCBmb3Igbm9uLXNjYWxhciB0eXBlcywgYW5kICc/J1xuICAgICAgLy8gbm9uLXNwZWNpZmljIHRhZyBpcyBvbmx5IGF1dG9tYXRpY2FsbHkgYXNzaWduZWQgdG8gcGxhaW4gc2NhbGFycy5cbiAgICAgIC8vXG4gICAgICAvLyBXZSBvbmx5IG5lZWQgdG8gY2hlY2sga2luZCBjb25mb3JtaXR5IGluIGNhc2UgdXNlciBleHBsaWNpdGx5IGFzc2lnbnMgJz8nXG4gICAgICAvLyB0YWcsIGZvciBleGFtcGxlIGxpa2UgdGhpczogXCIhPD8+IFswXVwiXG4gICAgICAvL1xuICAgICAgaWYgKHN0YXRlLnJlc3VsdCAhPT0gbnVsbCAmJiBzdGF0ZS5raW5kICE9PSAnc2NhbGFyJykge1xuICAgICAgICB0aHJvd0Vycm9yKHN0YXRlLCAndW5hY2NlcHRhYmxlIG5vZGUga2luZCBmb3IgITw/PiB0YWc7IGl0IHNob3VsZCBiZSBcInNjYWxhclwiLCBub3QgXCInICsgc3RhdGUua2luZCArICdcIicpO1xuICAgICAgfVxuXG4gICAgICBmb3IgKHR5cGVJbmRleCA9IDAsIHR5cGVRdWFudGl0eSA9IHN0YXRlLmltcGxpY2l0VHlwZXMubGVuZ3RoOyB0eXBlSW5kZXggPCB0eXBlUXVhbnRpdHk7IHR5cGVJbmRleCArPSAxKSB7XG4gICAgICAgIHR5cGUgPSBzdGF0ZS5pbXBsaWNpdFR5cGVzW3R5cGVJbmRleF07XG5cbiAgICAgICAgaWYgKHR5cGUucmVzb2x2ZShzdGF0ZS5yZXN1bHQpKSB7XG4gICAgICAgICAgLy8gYHN0YXRlLnJlc3VsdGAgdXBkYXRlZCBpbiByZXNvbHZlciBpZiBtYXRjaGVkXG4gICAgICAgICAgc3RhdGUucmVzdWx0ID0gdHlwZS5jb25zdHJ1Y3Qoc3RhdGUucmVzdWx0KTtcbiAgICAgICAgICBzdGF0ZS50YWcgPSB0eXBlLnRhZztcblxuICAgICAgICAgIGlmIChzdGF0ZS5hbmNob3IgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHN0YXRlLmFuY2hvck1hcFtzdGF0ZS5hbmNob3JdID0gc3RhdGUucmVzdWx0O1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChfaGFzT3duUHJvcGVydHkkMi5jYWxsKHN0YXRlLnR5cGVNYXBbc3RhdGUua2luZCB8fCAnZmFsbGJhY2snXSwgc3RhdGUudGFnKSkge1xuICAgICAgdHlwZSA9IHN0YXRlLnR5cGVNYXBbc3RhdGUua2luZCB8fCAnZmFsbGJhY2snXVtzdGF0ZS50YWddO1xuXG4gICAgICBpZiAoc3RhdGUucmVzdWx0ICE9PSBudWxsICYmIHR5cGUua2luZCAhPT0gc3RhdGUua2luZCkge1xuICAgICAgICB0aHJvd0Vycm9yKHN0YXRlLCAndW5hY2NlcHRhYmxlIG5vZGUga2luZCBmb3IgITwnICsgc3RhdGUudGFnICsgJz4gdGFnOyBpdCBzaG91bGQgYmUgXCInICsgdHlwZS5raW5kICsgJ1wiLCBub3QgXCInICsgc3RhdGUua2luZCArICdcIicpO1xuICAgICAgfVxuXG4gICAgICBpZiAoIXR5cGUucmVzb2x2ZShzdGF0ZS5yZXN1bHQpKSB7XG4gICAgICAgIC8vIGBzdGF0ZS5yZXN1bHRgIHVwZGF0ZWQgaW4gcmVzb2x2ZXIgaWYgbWF0Y2hlZFxuICAgICAgICB0aHJvd0Vycm9yKHN0YXRlLCAnY2Fubm90IHJlc29sdmUgYSBub2RlIHdpdGggITwnICsgc3RhdGUudGFnICsgJz4gZXhwbGljaXQgdGFnJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzdGF0ZS5yZXN1bHQgPSB0eXBlLmNvbnN0cnVjdChzdGF0ZS5yZXN1bHQpO1xuXG4gICAgICAgIGlmIChzdGF0ZS5hbmNob3IgIT09IG51bGwpIHtcbiAgICAgICAgICBzdGF0ZS5hbmNob3JNYXBbc3RhdGUuYW5jaG9yXSA9IHN0YXRlLnJlc3VsdDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvd0Vycm9yKHN0YXRlLCAndW5rbm93biB0YWcgITwnICsgc3RhdGUudGFnICsgJz4nKTtcbiAgICB9XG4gIH1cblxuICBpZiAoc3RhdGUubGlzdGVuZXIgIT09IG51bGwpIHtcbiAgICBzdGF0ZS5saXN0ZW5lcignY2xvc2UnLCBzdGF0ZSk7XG4gIH1cblxuICByZXR1cm4gc3RhdGUudGFnICE9PSBudWxsIHx8IHN0YXRlLmFuY2hvciAhPT0gbnVsbCB8fCBoYXNDb250ZW50O1xufVxuXG5mdW5jdGlvbiByZWFkRG9jdW1lbnQoc3RhdGUpIHtcbiAgdmFyIGRvY3VtZW50U3RhcnQgPSBzdGF0ZS5wb3NpdGlvbixcbiAgICAgIF9wb3NpdGlvbixcbiAgICAgIGRpcmVjdGl2ZU5hbWUsXG4gICAgICBkaXJlY3RpdmVBcmdzLFxuICAgICAgaGFzRGlyZWN0aXZlcyA9IGZhbHNlLFxuICAgICAgY2g7XG5cbiAgc3RhdGUudmVyc2lvbiA9IG51bGw7XG4gIHN0YXRlLmNoZWNrTGluZUJyZWFrcyA9IHN0YXRlLmxlZ2FjeTtcbiAgc3RhdGUudGFnTWFwID0ge307XG4gIHN0YXRlLmFuY2hvck1hcCA9IHt9O1xuXG4gIHdoaWxlICgoY2ggPSBzdGF0ZS5pbnB1dC5jaGFyQ29kZUF0KHN0YXRlLnBvc2l0aW9uKSkgIT09IDApIHtcbiAgICBza2lwU2VwYXJhdGlvblNwYWNlKHN0YXRlLCB0cnVlLCAtMSk7XG4gICAgY2ggPSBzdGF0ZS5pbnB1dC5jaGFyQ29kZUF0KHN0YXRlLnBvc2l0aW9uKTtcblxuICAgIGlmIChzdGF0ZS5saW5lSW5kZW50ID4gMCB8fCBjaCAhPT0gMHgyNVxuICAgIC8qICUgKi9cbiAgICApIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG5cbiAgICBoYXNEaXJlY3RpdmVzID0gdHJ1ZTtcbiAgICBjaCA9IHN0YXRlLmlucHV0LmNoYXJDb2RlQXQoKytzdGF0ZS5wb3NpdGlvbik7XG4gICAgX3Bvc2l0aW9uID0gc3RhdGUucG9zaXRpb247XG5cbiAgICB3aGlsZSAoY2ggIT09IDAgJiYgIWlzX1dTX09SX0VPTChjaCkpIHtcbiAgICAgIGNoID0gc3RhdGUuaW5wdXQuY2hhckNvZGVBdCgrK3N0YXRlLnBvc2l0aW9uKTtcbiAgICB9XG5cbiAgICBkaXJlY3RpdmVOYW1lID0gc3RhdGUuaW5wdXQuc2xpY2UoX3Bvc2l0aW9uLCBzdGF0ZS5wb3NpdGlvbik7XG4gICAgZGlyZWN0aXZlQXJncyA9IFtdO1xuXG4gICAgaWYgKGRpcmVjdGl2ZU5hbWUubGVuZ3RoIDwgMSkge1xuICAgICAgdGhyb3dFcnJvcihzdGF0ZSwgJ2RpcmVjdGl2ZSBuYW1lIG11c3Qgbm90IGJlIGxlc3MgdGhhbiBvbmUgY2hhcmFjdGVyIGluIGxlbmd0aCcpO1xuICAgIH1cblxuICAgIHdoaWxlIChjaCAhPT0gMCkge1xuICAgICAgd2hpbGUgKGlzX1dISVRFX1NQQUNFKGNoKSkge1xuICAgICAgICBjaCA9IHN0YXRlLmlucHV0LmNoYXJDb2RlQXQoKytzdGF0ZS5wb3NpdGlvbik7XG4gICAgICB9XG5cbiAgICAgIGlmIChjaCA9PT0gMHgyM1xuICAgICAgLyogIyAqL1xuICAgICAgKSB7XG4gICAgICAgICAgZG8ge1xuICAgICAgICAgICAgY2ggPSBzdGF0ZS5pbnB1dC5jaGFyQ29kZUF0KCsrc3RhdGUucG9zaXRpb24pO1xuICAgICAgICAgIH0gd2hpbGUgKGNoICE9PSAwICYmICFpc19FT0woY2gpKTtcblxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgIGlmIChpc19FT0woY2gpKSBicmVhaztcbiAgICAgIF9wb3NpdGlvbiA9IHN0YXRlLnBvc2l0aW9uO1xuXG4gICAgICB3aGlsZSAoY2ggIT09IDAgJiYgIWlzX1dTX09SX0VPTChjaCkpIHtcbiAgICAgICAgY2ggPSBzdGF0ZS5pbnB1dC5jaGFyQ29kZUF0KCsrc3RhdGUucG9zaXRpb24pO1xuICAgICAgfVxuXG4gICAgICBkaXJlY3RpdmVBcmdzLnB1c2goc3RhdGUuaW5wdXQuc2xpY2UoX3Bvc2l0aW9uLCBzdGF0ZS5wb3NpdGlvbikpO1xuICAgIH1cblxuICAgIGlmIChjaCAhPT0gMCkgcmVhZExpbmVCcmVhayhzdGF0ZSk7XG5cbiAgICBpZiAoX2hhc093blByb3BlcnR5JDIuY2FsbChkaXJlY3RpdmVIYW5kbGVycywgZGlyZWN0aXZlTmFtZSkpIHtcbiAgICAgIGRpcmVjdGl2ZUhhbmRsZXJzW2RpcmVjdGl2ZU5hbWVdKHN0YXRlLCBkaXJlY3RpdmVOYW1lLCBkaXJlY3RpdmVBcmdzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3dXYXJuaW5nKHN0YXRlLCAndW5rbm93biBkb2N1bWVudCBkaXJlY3RpdmUgXCInICsgZGlyZWN0aXZlTmFtZSArICdcIicpO1xuICAgIH1cbiAgfVxuXG4gIHNraXBTZXBhcmF0aW9uU3BhY2Uoc3RhdGUsIHRydWUsIC0xKTtcblxuICBpZiAoc3RhdGUubGluZUluZGVudCA9PT0gMCAmJiBzdGF0ZS5pbnB1dC5jaGFyQ29kZUF0KHN0YXRlLnBvc2l0aW9uKSA9PT0gMHgyRFxuICAvKiAtICovXG4gICYmIHN0YXRlLmlucHV0LmNoYXJDb2RlQXQoc3RhdGUucG9zaXRpb24gKyAxKSA9PT0gMHgyRFxuICAvKiAtICovXG4gICYmIHN0YXRlLmlucHV0LmNoYXJDb2RlQXQoc3RhdGUucG9zaXRpb24gKyAyKSA9PT0gMHgyRFxuICAvKiAtICovXG4gICkge1xuICAgICAgc3RhdGUucG9zaXRpb24gKz0gMztcbiAgICAgIHNraXBTZXBhcmF0aW9uU3BhY2Uoc3RhdGUsIHRydWUsIC0xKTtcbiAgICB9IGVsc2UgaWYgKGhhc0RpcmVjdGl2ZXMpIHtcbiAgICB0aHJvd0Vycm9yKHN0YXRlLCAnZGlyZWN0aXZlcyBlbmQgbWFyayBpcyBleHBlY3RlZCcpO1xuICB9XG5cbiAgY29tcG9zZU5vZGUoc3RhdGUsIHN0YXRlLmxpbmVJbmRlbnQgLSAxLCBDT05URVhUX0JMT0NLX09VVCwgZmFsc2UsIHRydWUpO1xuICBza2lwU2VwYXJhdGlvblNwYWNlKHN0YXRlLCB0cnVlLCAtMSk7XG5cbiAgaWYgKHN0YXRlLmNoZWNrTGluZUJyZWFrcyAmJiBQQVRURVJOX05PTl9BU0NJSV9MSU5FX0JSRUFLUy50ZXN0KHN0YXRlLmlucHV0LnNsaWNlKGRvY3VtZW50U3RhcnQsIHN0YXRlLnBvc2l0aW9uKSkpIHtcbiAgICB0aHJvd1dhcm5pbmcoc3RhdGUsICdub24tQVNDSUkgbGluZSBicmVha3MgYXJlIGludGVycHJldGVkIGFzIGNvbnRlbnQnKTtcbiAgfVxuXG4gIHN0YXRlLmRvY3VtZW50cy5wdXNoKHN0YXRlLnJlc3VsdCk7XG5cbiAgaWYgKHN0YXRlLnBvc2l0aW9uID09PSBzdGF0ZS5saW5lU3RhcnQgJiYgdGVzdERvY3VtZW50U2VwYXJhdG9yKHN0YXRlKSkge1xuICAgIGlmIChzdGF0ZS5pbnB1dC5jaGFyQ29kZUF0KHN0YXRlLnBvc2l0aW9uKSA9PT0gMHgyRVxuICAgIC8qIC4gKi9cbiAgICApIHtcbiAgICAgICAgc3RhdGUucG9zaXRpb24gKz0gMztcbiAgICAgICAgc2tpcFNlcGFyYXRpb25TcGFjZShzdGF0ZSwgdHJ1ZSwgLTEpO1xuICAgICAgfVxuXG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKHN0YXRlLnBvc2l0aW9uIDwgc3RhdGUubGVuZ3RoIC0gMSkge1xuICAgIHRocm93RXJyb3Ioc3RhdGUsICdlbmQgb2YgdGhlIHN0cmVhbSBvciBhIGRvY3VtZW50IHNlcGFyYXRvciBpcyBleHBlY3RlZCcpO1xuICB9IGVsc2Uge1xuICAgIHJldHVybjtcbiAgfVxufVxuXG5mdW5jdGlvbiBsb2FkRG9jdW1lbnRzKGlucHV0LCBvcHRpb25zKSB7XG4gIGlucHV0ID0gU3RyaW5nKGlucHV0KTtcbiAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG5cbiAgaWYgKGlucHV0Lmxlbmd0aCAhPT0gMCkge1xuICAgIC8vIEFkZCB0YWlsaW5nIGBcXG5gIGlmIG5vdCBleGlzdHNcbiAgICBpZiAoaW5wdXQuY2hhckNvZGVBdChpbnB1dC5sZW5ndGggLSAxKSAhPT0gMHgwQVxuICAgIC8qIExGICovXG4gICAgJiYgaW5wdXQuY2hhckNvZGVBdChpbnB1dC5sZW5ndGggLSAxKSAhPT0gMHgwRFxuICAgIC8qIENSICovXG4gICAgKSB7XG4gICAgICAgIGlucHV0ICs9ICdcXG4nO1xuICAgICAgfSAvLyBTdHJpcCBCT01cblxuXG4gICAgaWYgKGlucHV0LmNoYXJDb2RlQXQoMCkgPT09IDB4RkVGRikge1xuICAgICAgaW5wdXQgPSBpbnB1dC5zbGljZSgxKTtcbiAgICB9XG4gIH1cblxuICB2YXIgc3RhdGUgPSBuZXcgU3RhdGUoaW5wdXQsIG9wdGlvbnMpO1xuICB2YXIgbnVsbHBvcyA9IGlucHV0LmluZGV4T2YoJ1xcMCcpO1xuXG4gIGlmIChudWxscG9zICE9PSAtMSkge1xuICAgIHN0YXRlLnBvc2l0aW9uID0gbnVsbHBvcztcbiAgICB0aHJvd0Vycm9yKHN0YXRlLCAnbnVsbCBieXRlIGlzIG5vdCBhbGxvd2VkIGluIGlucHV0Jyk7XG4gIH0gLy8gVXNlIDAgYXMgc3RyaW5nIHRlcm1pbmF0b3IuIFRoYXQgc2lnbmlmaWNhbnRseSBzaW1wbGlmaWVzIGJvdW5kcyBjaGVjay5cblxuXG4gIHN0YXRlLmlucHV0ICs9ICdcXDAnO1xuXG4gIHdoaWxlIChzdGF0ZS5pbnB1dC5jaGFyQ29kZUF0KHN0YXRlLnBvc2l0aW9uKSA9PT0gMHgyMFxuICAvKiBTcGFjZSAqL1xuICApIHtcbiAgICBzdGF0ZS5saW5lSW5kZW50ICs9IDE7XG4gICAgc3RhdGUucG9zaXRpb24gKz0gMTtcbiAgfVxuXG4gIHdoaWxlIChzdGF0ZS5wb3NpdGlvbiA8IHN0YXRlLmxlbmd0aCAtIDEpIHtcbiAgICByZWFkRG9jdW1lbnQoc3RhdGUpO1xuICB9XG5cbiAgcmV0dXJuIHN0YXRlLmRvY3VtZW50cztcbn1cblxuZnVuY3Rpb24gbG9hZEFsbChpbnB1dCwgaXRlcmF0b3IsIG9wdGlvbnMpIHtcbiAgaWYgKGl0ZXJhdG9yICE9PSBudWxsICYmIHR5cGVvZiBpdGVyYXRvciA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG9wdGlvbnMgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgb3B0aW9ucyA9IGl0ZXJhdG9yO1xuICAgIGl0ZXJhdG9yID0gbnVsbDtcbiAgfVxuXG4gIHZhciBkb2N1bWVudHMgPSBsb2FkRG9jdW1lbnRzKGlucHV0LCBvcHRpb25zKTtcblxuICBpZiAodHlwZW9mIGl0ZXJhdG9yICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgcmV0dXJuIGRvY3VtZW50cztcbiAgfVxuXG4gIGZvciAodmFyIGluZGV4ID0gMCwgbGVuZ3RoID0gZG9jdW1lbnRzLmxlbmd0aDsgaW5kZXggPCBsZW5ndGg7IGluZGV4ICs9IDEpIHtcbiAgICBpdGVyYXRvcihkb2N1bWVudHNbaW5kZXhdKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBsb2FkKGlucHV0LCBvcHRpb25zKSB7XG4gIHZhciBkb2N1bWVudHMgPSBsb2FkRG9jdW1lbnRzKGlucHV0LCBvcHRpb25zKTtcblxuICBpZiAoZG9jdW1lbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgIC8qZXNsaW50LWRpc2FibGUgbm8tdW5kZWZpbmVkKi9cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9IGVsc2UgaWYgKGRvY3VtZW50cy5sZW5ndGggPT09IDEpIHtcbiAgICByZXR1cm4gZG9jdW1lbnRzWzBdO1xuICB9XG5cbiAgdGhyb3cgbmV3IGV4Y2VwdGlvbignZXhwZWN0ZWQgYSBzaW5nbGUgZG9jdW1lbnQgaW4gdGhlIHN0cmVhbSwgYnV0IGZvdW5kIG1vcmUnKTtcbn1cblxuZnVuY3Rpb24gc2FmZUxvYWRBbGwoaW5wdXQsIGl0ZXJhdG9yLCBvcHRpb25zKSB7XG4gIGlmICh0eXBlb2YgaXRlcmF0b3IgPT09ICdvYmplY3QnICYmIGl0ZXJhdG9yICE9PSBudWxsICYmIHR5cGVvZiBvcHRpb25zID09PSAndW5kZWZpbmVkJykge1xuICAgIG9wdGlvbnMgPSBpdGVyYXRvcjtcbiAgICBpdGVyYXRvciA9IG51bGw7XG4gIH1cblxuICByZXR1cm4gbG9hZEFsbChpbnB1dCwgaXRlcmF0b3IsIGNvbW1vbi5leHRlbmQoe1xuICAgIHNjaGVtYTogZGVmYXVsdF9zYWZlXG4gIH0sIG9wdGlvbnMpKTtcbn1cblxuZnVuY3Rpb24gc2FmZUxvYWQoaW5wdXQsIG9wdGlvbnMpIHtcbiAgcmV0dXJuIGxvYWQoaW5wdXQsIGNvbW1vbi5leHRlbmQoe1xuICAgIHNjaGVtYTogZGVmYXVsdF9zYWZlXG4gIH0sIG9wdGlvbnMpKTtcbn1cblxudmFyIGxvYWRBbGxfMSA9IGxvYWRBbGw7XG52YXIgbG9hZF8xID0gbG9hZDtcbnZhciBzYWZlTG9hZEFsbF8xID0gc2FmZUxvYWRBbGw7XG52YXIgc2FmZUxvYWRfMSA9IHNhZmVMb2FkO1xudmFyIGxvYWRlciA9IHtcbiAgbG9hZEFsbDogbG9hZEFsbF8xLFxuICBsb2FkOiBsb2FkXzEsXG4gIHNhZmVMb2FkQWxsOiBzYWZlTG9hZEFsbF8xLFxuICBzYWZlTG9hZDogc2FmZUxvYWRfMVxufTtcblxuLyplc2xpbnQtZGlzYWJsZSBuby11c2UtYmVmb3JlLWRlZmluZSovXG5cblxudmFyIF90b1N0cmluZyQyID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZztcbnZhciBfaGFzT3duUHJvcGVydHkkMyA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7XG52YXIgQ0hBUl9UQUIgPSAweDA5O1xuLyogVGFiICovXG5cbnZhciBDSEFSX0xJTkVfRkVFRCA9IDB4MEE7XG4vKiBMRiAqL1xuXG52YXIgQ0hBUl9DQVJSSUFHRV9SRVRVUk4gPSAweDBEO1xuLyogQ1IgKi9cblxudmFyIENIQVJfU1BBQ0UgPSAweDIwO1xuLyogU3BhY2UgKi9cblxudmFyIENIQVJfRVhDTEFNQVRJT04gPSAweDIxO1xuLyogISAqL1xuXG52YXIgQ0hBUl9ET1VCTEVfUVVPVEUgPSAweDIyO1xuLyogXCIgKi9cblxudmFyIENIQVJfU0hBUlAgPSAweDIzO1xuLyogIyAqL1xuXG52YXIgQ0hBUl9QRVJDRU5UID0gMHgyNTtcbi8qICUgKi9cblxudmFyIENIQVJfQU1QRVJTQU5EID0gMHgyNjtcbi8qICYgKi9cblxudmFyIENIQVJfU0lOR0xFX1FVT1RFID0gMHgyNztcbi8qICcgKi9cblxudmFyIENIQVJfQVNURVJJU0sgPSAweDJBO1xuLyogKiAqL1xuXG52YXIgQ0hBUl9DT01NQSA9IDB4MkM7XG4vKiAsICovXG5cbnZhciBDSEFSX01JTlVTID0gMHgyRDtcbi8qIC0gKi9cblxudmFyIENIQVJfQ09MT04gPSAweDNBO1xuLyogOiAqL1xuXG52YXIgQ0hBUl9FUVVBTFMgPSAweDNEO1xuLyogPSAqL1xuXG52YXIgQ0hBUl9HUkVBVEVSX1RIQU4gPSAweDNFO1xuLyogPiAqL1xuXG52YXIgQ0hBUl9RVUVTVElPTiA9IDB4M0Y7XG4vKiA/ICovXG5cbnZhciBDSEFSX0NPTU1FUkNJQUxfQVQgPSAweDQwO1xuLyogQCAqL1xuXG52YXIgQ0hBUl9MRUZUX1NRVUFSRV9CUkFDS0VUID0gMHg1Qjtcbi8qIFsgKi9cblxudmFyIENIQVJfUklHSFRfU1FVQVJFX0JSQUNLRVQgPSAweDVEO1xuLyogXSAqL1xuXG52YXIgQ0hBUl9HUkFWRV9BQ0NFTlQgPSAweDYwO1xuLyogYCAqL1xuXG52YXIgQ0hBUl9MRUZUX0NVUkxZX0JSQUNLRVQgPSAweDdCO1xuLyogeyAqL1xuXG52YXIgQ0hBUl9WRVJUSUNBTF9MSU5FID0gMHg3Qztcbi8qIHwgKi9cblxudmFyIENIQVJfUklHSFRfQ1VSTFlfQlJBQ0tFVCA9IDB4N0Q7XG4vKiB9ICovXG5cbnZhciBFU0NBUEVfU0VRVUVOQ0VTID0ge307XG5FU0NBUEVfU0VRVUVOQ0VTWzB4MDBdID0gJ1xcXFwwJztcbkVTQ0FQRV9TRVFVRU5DRVNbMHgwN10gPSAnXFxcXGEnO1xuRVNDQVBFX1NFUVVFTkNFU1sweDA4XSA9ICdcXFxcYic7XG5FU0NBUEVfU0VRVUVOQ0VTWzB4MDldID0gJ1xcXFx0JztcbkVTQ0FQRV9TRVFVRU5DRVNbMHgwQV0gPSAnXFxcXG4nO1xuRVNDQVBFX1NFUVVFTkNFU1sweDBCXSA9ICdcXFxcdic7XG5FU0NBUEVfU0VRVUVOQ0VTWzB4MENdID0gJ1xcXFxmJztcbkVTQ0FQRV9TRVFVRU5DRVNbMHgwRF0gPSAnXFxcXHInO1xuRVNDQVBFX1NFUVVFTkNFU1sweDFCXSA9ICdcXFxcZSc7XG5FU0NBUEVfU0VRVUVOQ0VTWzB4MjJdID0gJ1xcXFxcIic7XG5FU0NBUEVfU0VRVUVOQ0VTWzB4NUNdID0gJ1xcXFxcXFxcJztcbkVTQ0FQRV9TRVFVRU5DRVNbMHg4NV0gPSAnXFxcXE4nO1xuRVNDQVBFX1NFUVVFTkNFU1sweEEwXSA9ICdcXFxcXyc7XG5FU0NBUEVfU0VRVUVOQ0VTWzB4MjAyOF0gPSAnXFxcXEwnO1xuRVNDQVBFX1NFUVVFTkNFU1sweDIwMjldID0gJ1xcXFxQJztcbnZhciBERVBSRUNBVEVEX0JPT0xFQU5TX1NZTlRBWCA9IFsneScsICdZJywgJ3llcycsICdZZXMnLCAnWUVTJywgJ29uJywgJ09uJywgJ09OJywgJ24nLCAnTicsICdubycsICdObycsICdOTycsICdvZmYnLCAnT2ZmJywgJ09GRiddO1xuXG5mdW5jdGlvbiBjb21waWxlU3R5bGVNYXAoc2NoZW1hLCBtYXApIHtcbiAgdmFyIHJlc3VsdCwga2V5cywgaW5kZXgsIGxlbmd0aCwgdGFnLCBzdHlsZSwgdHlwZTtcbiAgaWYgKG1hcCA9PT0gbnVsbCkgcmV0dXJuIHt9O1xuICByZXN1bHQgPSB7fTtcbiAga2V5cyA9IE9iamVjdC5rZXlzKG1hcCk7XG5cbiAgZm9yIChpbmRleCA9IDAsIGxlbmd0aCA9IGtleXMubGVuZ3RoOyBpbmRleCA8IGxlbmd0aDsgaW5kZXggKz0gMSkge1xuICAgIHRhZyA9IGtleXNbaW5kZXhdO1xuICAgIHN0eWxlID0gU3RyaW5nKG1hcFt0YWddKTtcblxuICAgIGlmICh0YWcuc2xpY2UoMCwgMikgPT09ICchIScpIHtcbiAgICAgIHRhZyA9ICd0YWc6eWFtbC5vcmcsMjAwMjonICsgdGFnLnNsaWNlKDIpO1xuICAgIH1cblxuICAgIHR5cGUgPSBzY2hlbWEuY29tcGlsZWRUeXBlTWFwWydmYWxsYmFjayddW3RhZ107XG5cbiAgICBpZiAodHlwZSAmJiBfaGFzT3duUHJvcGVydHkkMy5jYWxsKHR5cGUuc3R5bGVBbGlhc2VzLCBzdHlsZSkpIHtcbiAgICAgIHN0eWxlID0gdHlwZS5zdHlsZUFsaWFzZXNbc3R5bGVdO1xuICAgIH1cblxuICAgIHJlc3VsdFt0YWddID0gc3R5bGU7XG4gIH1cblxuICByZXR1cm4gcmVzdWx0O1xufVxuXG5mdW5jdGlvbiBlbmNvZGVIZXgoY2hhcmFjdGVyKSB7XG4gIHZhciBzdHJpbmcsIGhhbmRsZSwgbGVuZ3RoO1xuICBzdHJpbmcgPSBjaGFyYWN0ZXIudG9TdHJpbmcoMTYpLnRvVXBwZXJDYXNlKCk7XG5cbiAgaWYgKGNoYXJhY3RlciA8PSAweEZGKSB7XG4gICAgaGFuZGxlID0gJ3gnO1xuICAgIGxlbmd0aCA9IDI7XG4gIH0gZWxzZSBpZiAoY2hhcmFjdGVyIDw9IDB4RkZGRikge1xuICAgIGhhbmRsZSA9ICd1JztcbiAgICBsZW5ndGggPSA0O1xuICB9IGVsc2UgaWYgKGNoYXJhY3RlciA8PSAweEZGRkZGRkZGKSB7XG4gICAgaGFuZGxlID0gJ1UnO1xuICAgIGxlbmd0aCA9IDg7XG4gIH0gZWxzZSB7XG4gICAgdGhyb3cgbmV3IGV4Y2VwdGlvbignY29kZSBwb2ludCB3aXRoaW4gYSBzdHJpbmcgbWF5IG5vdCBiZSBncmVhdGVyIHRoYW4gMHhGRkZGRkZGRicpO1xuICB9XG5cbiAgcmV0dXJuICdcXFxcJyArIGhhbmRsZSArIGNvbW1vbi5yZXBlYXQoJzAnLCBsZW5ndGggLSBzdHJpbmcubGVuZ3RoKSArIHN0cmluZztcbn1cblxuZnVuY3Rpb24gU3RhdGUkMShvcHRpb25zKSB7XG4gIHRoaXMuc2NoZW1hID0gb3B0aW9uc1snc2NoZW1hJ10gfHwgZGVmYXVsdF9mdWxsO1xuICB0aGlzLmluZGVudCA9IE1hdGgubWF4KDEsIG9wdGlvbnNbJ2luZGVudCddIHx8IDIpO1xuICB0aGlzLm5vQXJyYXlJbmRlbnQgPSBvcHRpb25zWydub0FycmF5SW5kZW50J10gfHwgZmFsc2U7XG4gIHRoaXMuc2tpcEludmFsaWQgPSBvcHRpb25zWydza2lwSW52YWxpZCddIHx8IGZhbHNlO1xuICB0aGlzLmZsb3dMZXZlbCA9IGNvbW1vbi5pc05vdGhpbmcob3B0aW9uc1snZmxvd0xldmVsJ10pID8gLTEgOiBvcHRpb25zWydmbG93TGV2ZWwnXTtcbiAgdGhpcy5zdHlsZU1hcCA9IGNvbXBpbGVTdHlsZU1hcCh0aGlzLnNjaGVtYSwgb3B0aW9uc1snc3R5bGVzJ10gfHwgbnVsbCk7XG4gIHRoaXMuc29ydEtleXMgPSBvcHRpb25zWydzb3J0S2V5cyddIHx8IGZhbHNlO1xuICB0aGlzLmxpbmVXaWR0aCA9IG9wdGlvbnNbJ2xpbmVXaWR0aCddIHx8IDgwO1xuICB0aGlzLm5vUmVmcyA9IG9wdGlvbnNbJ25vUmVmcyddIHx8IGZhbHNlO1xuICB0aGlzLm5vQ29tcGF0TW9kZSA9IG9wdGlvbnNbJ25vQ29tcGF0TW9kZSddIHx8IGZhbHNlO1xuICB0aGlzLmNvbmRlbnNlRmxvdyA9IG9wdGlvbnNbJ2NvbmRlbnNlRmxvdyddIHx8IGZhbHNlO1xuICB0aGlzLmltcGxpY2l0VHlwZXMgPSB0aGlzLnNjaGVtYS5jb21waWxlZEltcGxpY2l0O1xuICB0aGlzLmV4cGxpY2l0VHlwZXMgPSB0aGlzLnNjaGVtYS5jb21waWxlZEV4cGxpY2l0O1xuICB0aGlzLnRhZyA9IG51bGw7XG4gIHRoaXMucmVzdWx0ID0gJyc7XG4gIHRoaXMuZHVwbGljYXRlcyA9IFtdO1xuICB0aGlzLnVzZWREdXBsaWNhdGVzID0gbnVsbDtcbn0gLy8gSW5kZW50cyBldmVyeSBsaW5lIGluIGEgc3RyaW5nLiBFbXB0eSBsaW5lcyAoXFxuIG9ubHkpIGFyZSBub3QgaW5kZW50ZWQuXG5cblxuZnVuY3Rpb24gaW5kZW50U3RyaW5nKHN0cmluZywgc3BhY2VzKSB7XG4gIHZhciBpbmQgPSBjb21tb24ucmVwZWF0KCcgJywgc3BhY2VzKSxcbiAgICAgIHBvc2l0aW9uID0gMCxcbiAgICAgIG5leHQgPSAtMSxcbiAgICAgIHJlc3VsdCA9ICcnLFxuICAgICAgbGluZSxcbiAgICAgIGxlbmd0aCA9IHN0cmluZy5sZW5ndGg7XG5cbiAgd2hpbGUgKHBvc2l0aW9uIDwgbGVuZ3RoKSB7XG4gICAgbmV4dCA9IHN0cmluZy5pbmRleE9mKCdcXG4nLCBwb3NpdGlvbik7XG5cbiAgICBpZiAobmV4dCA9PT0gLTEpIHtcbiAgICAgIGxpbmUgPSBzdHJpbmcuc2xpY2UocG9zaXRpb24pO1xuICAgICAgcG9zaXRpb24gPSBsZW5ndGg7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxpbmUgPSBzdHJpbmcuc2xpY2UocG9zaXRpb24sIG5leHQgKyAxKTtcbiAgICAgIHBvc2l0aW9uID0gbmV4dCArIDE7XG4gICAgfVxuXG4gICAgaWYgKGxpbmUubGVuZ3RoICYmIGxpbmUgIT09ICdcXG4nKSByZXN1bHQgKz0gaW5kO1xuICAgIHJlc3VsdCArPSBsaW5lO1xuICB9XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZnVuY3Rpb24gZ2VuZXJhdGVOZXh0TGluZShzdGF0ZSwgbGV2ZWwpIHtcbiAgcmV0dXJuICdcXG4nICsgY29tbW9uLnJlcGVhdCgnICcsIHN0YXRlLmluZGVudCAqIGxldmVsKTtcbn1cblxuZnVuY3Rpb24gdGVzdEltcGxpY2l0UmVzb2x2aW5nKHN0YXRlLCBzdHIpIHtcbiAgdmFyIGluZGV4LCBsZW5ndGgsIHR5cGU7XG5cbiAgZm9yIChpbmRleCA9IDAsIGxlbmd0aCA9IHN0YXRlLmltcGxpY2l0VHlwZXMubGVuZ3RoOyBpbmRleCA8IGxlbmd0aDsgaW5kZXggKz0gMSkge1xuICAgIHR5cGUgPSBzdGF0ZS5pbXBsaWNpdFR5cGVzW2luZGV4XTtcblxuICAgIGlmICh0eXBlLnJlc29sdmUoc3RyKSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGZhbHNlO1xufSAvLyBbMzNdIHMtd2hpdGUgOjo9IHMtc3BhY2UgfCBzLXRhYlxuXG5cbmZ1bmN0aW9uIGlzV2hpdGVzcGFjZShjKSB7XG4gIHJldHVybiBjID09PSBDSEFSX1NQQUNFIHx8IGMgPT09IENIQVJfVEFCO1xufSAvLyBSZXR1cm5zIHRydWUgaWYgdGhlIGNoYXJhY3RlciBjYW4gYmUgcHJpbnRlZCB3aXRob3V0IGVzY2FwaW5nLlxuLy8gRnJvbSBZQU1MIDEuMjogXCJhbnkgYWxsb3dlZCBjaGFyYWN0ZXJzIGtub3duIHRvIGJlIG5vbi1wcmludGFibGVcbi8vIHNob3VsZCBhbHNvIGJlIGVzY2FwZWQuIFtIb3dldmVyLF0gVGhpcyBpc27igJl0IG1hbmRhdG9yeVwiXG4vLyBEZXJpdmVkIGZyb20gbmItY2hhciAtIFxcdCAtICN4ODUgLSAjeEEwIC0gI3gyMDI4IC0gI3gyMDI5LlxuXG5cbmZ1bmN0aW9uIGlzUHJpbnRhYmxlKGMpIHtcbiAgcmV0dXJuIDB4MDAwMjAgPD0gYyAmJiBjIDw9IDB4MDAwMDdFIHx8IDB4MDAwQTEgPD0gYyAmJiBjIDw9IDB4MDBEN0ZGICYmIGMgIT09IDB4MjAyOCAmJiBjICE9PSAweDIwMjkgfHwgMHgwRTAwMCA8PSBjICYmIGMgPD0gMHgwMEZGRkQgJiYgYyAhPT0gMHhGRUZGXG4gIC8qIEJPTSAqL1xuICB8fCAweDEwMDAwIDw9IGMgJiYgYyA8PSAweDEwRkZGRjtcbn0gLy8gWzM0XSBucy1jaGFyIDo6PSBuYi1jaGFyIC0gcy13aGl0ZVxuLy8gWzI3XSBuYi1jaGFyIDo6PSBjLXByaW50YWJsZSAtIGItY2hhciAtIGMtYnl0ZS1vcmRlci1tYXJrXG4vLyBbMjZdIGItY2hhciAgOjo9IGItbGluZS1mZWVkIHwgYi1jYXJyaWFnZS1yZXR1cm5cbi8vIFsyNF0gYi1saW5lLWZlZWQgICAgICAgOjo9ICAgICAjeEEgICAgLyogTEYgKi9cbi8vIFsyNV0gYi1jYXJyaWFnZS1yZXR1cm4gOjo9ICAgICAjeEQgICAgLyogQ1IgKi9cbi8vIFszXSAgYy1ieXRlLW9yZGVyLW1hcmsgOjo9ICAgICAjeEZFRkZcblxuXG5mdW5jdGlvbiBpc05zQ2hhcihjKSB7XG4gIHJldHVybiBpc1ByaW50YWJsZShjKSAmJiAhaXNXaGl0ZXNwYWNlKGMpIC8vIGJ5dGUtb3JkZXItbWFya1xuICAmJiBjICE9PSAweEZFRkYgLy8gYi1jaGFyXG4gICYmIGMgIT09IENIQVJfQ0FSUklBR0VfUkVUVVJOICYmIGMgIT09IENIQVJfTElORV9GRUVEO1xufSAvLyBTaW1wbGlmaWVkIHRlc3QgZm9yIHZhbHVlcyBhbGxvd2VkIGFmdGVyIHRoZSBmaXJzdCBjaGFyYWN0ZXIgaW4gcGxhaW4gc3R5bGUuXG5cblxuZnVuY3Rpb24gaXNQbGFpblNhZmUoYywgcHJldikge1xuICAvLyBVc2VzIGEgc3Vic2V0IG9mIG5iLWNoYXIgLSBjLWZsb3ctaW5kaWNhdG9yIC0gXCI6XCIgLSBcIiNcIlxuICAvLyB3aGVyZSBuYi1jaGFyIDo6PSBjLXByaW50YWJsZSAtIGItY2hhciAtIGMtYnl0ZS1vcmRlci1tYXJrLlxuICByZXR1cm4gaXNQcmludGFibGUoYykgJiYgYyAhPT0gMHhGRUZGIC8vIC0gYy1mbG93LWluZGljYXRvclxuICAmJiBjICE9PSBDSEFSX0NPTU1BICYmIGMgIT09IENIQVJfTEVGVF9TUVVBUkVfQlJBQ0tFVCAmJiBjICE9PSBDSEFSX1JJR0hUX1NRVUFSRV9CUkFDS0VUICYmIGMgIT09IENIQVJfTEVGVF9DVVJMWV9CUkFDS0VUICYmIGMgIT09IENIQVJfUklHSFRfQ1VSTFlfQlJBQ0tFVCAvLyAtIFwiOlwiIC0gXCIjXCJcbiAgLy8gLyogQW4gbnMtY2hhciBwcmVjZWRpbmcgKi8gXCIjXCJcbiAgJiYgYyAhPT0gQ0hBUl9DT0xPTiAmJiAoYyAhPT0gQ0hBUl9TSEFSUCB8fCBwcmV2ICYmIGlzTnNDaGFyKHByZXYpKTtcbn0gLy8gU2ltcGxpZmllZCB0ZXN0IGZvciB2YWx1ZXMgYWxsb3dlZCBhcyB0aGUgZmlyc3QgY2hhcmFjdGVyIGluIHBsYWluIHN0eWxlLlxuXG5cbmZ1bmN0aW9uIGlzUGxhaW5TYWZlRmlyc3QoYykge1xuICAvLyBVc2VzIGEgc3Vic2V0IG9mIG5zLWNoYXIgLSBjLWluZGljYXRvclxuICAvLyB3aGVyZSBucy1jaGFyID0gbmItY2hhciAtIHMtd2hpdGUuXG4gIHJldHVybiBpc1ByaW50YWJsZShjKSAmJiBjICE9PSAweEZFRkYgJiYgIWlzV2hpdGVzcGFjZShjKSAvLyAtIHMtd2hpdGVcbiAgLy8gLSAoYy1pbmRpY2F0b3IgOjo9XG4gIC8vIOKAnC3igJ0gfCDigJw/4oCdIHwg4oCcOuKAnSB8IOKAnCzigJ0gfCDigJxb4oCdIHwg4oCcXeKAnSB8IOKAnHvigJ0gfCDigJx94oCdXG4gICYmIGMgIT09IENIQVJfTUlOVVMgJiYgYyAhPT0gQ0hBUl9RVUVTVElPTiAmJiBjICE9PSBDSEFSX0NPTE9OICYmIGMgIT09IENIQVJfQ09NTUEgJiYgYyAhPT0gQ0hBUl9MRUZUX1NRVUFSRV9CUkFDS0VUICYmIGMgIT09IENIQVJfUklHSFRfU1FVQVJFX0JSQUNLRVQgJiYgYyAhPT0gQ0hBUl9MRUZUX0NVUkxZX0JSQUNLRVQgJiYgYyAhPT0gQ0hBUl9SSUdIVF9DVVJMWV9CUkFDS0VUIC8vIHwg4oCcI+KAnSB8IOKAnCbigJ0gfCDigJwq4oCdIHwg4oCcIeKAnSB8IOKAnHzigJ0gfCDigJw94oCdIHwg4oCcPuKAnSB8IOKAnCfigJ0gfCDigJxcIuKAnVxuICAmJiBjICE9PSBDSEFSX1NIQVJQICYmIGMgIT09IENIQVJfQU1QRVJTQU5EICYmIGMgIT09IENIQVJfQVNURVJJU0sgJiYgYyAhPT0gQ0hBUl9FWENMQU1BVElPTiAmJiBjICE9PSBDSEFSX1ZFUlRJQ0FMX0xJTkUgJiYgYyAhPT0gQ0hBUl9FUVVBTFMgJiYgYyAhPT0gQ0hBUl9HUkVBVEVSX1RIQU4gJiYgYyAhPT0gQ0hBUl9TSU5HTEVfUVVPVEUgJiYgYyAhPT0gQ0hBUl9ET1VCTEVfUVVPVEUgLy8gfCDigJwl4oCdIHwg4oCcQOKAnSB8IOKAnGDigJ0pXG4gICYmIGMgIT09IENIQVJfUEVSQ0VOVCAmJiBjICE9PSBDSEFSX0NPTU1FUkNJQUxfQVQgJiYgYyAhPT0gQ0hBUl9HUkFWRV9BQ0NFTlQ7XG59IC8vIERldGVybWluZXMgd2hldGhlciBibG9jayBpbmRlbnRhdGlvbiBpbmRpY2F0b3IgaXMgcmVxdWlyZWQuXG5cblxuZnVuY3Rpb24gbmVlZEluZGVudEluZGljYXRvcihzdHJpbmcpIHtcbiAgdmFyIGxlYWRpbmdTcGFjZVJlID0gL15cXG4qIC87XG4gIHJldHVybiBsZWFkaW5nU3BhY2VSZS50ZXN0KHN0cmluZyk7XG59XG5cbnZhciBTVFlMRV9QTEFJTiA9IDEsXG4gICAgU1RZTEVfU0lOR0xFID0gMixcbiAgICBTVFlMRV9MSVRFUkFMID0gMyxcbiAgICBTVFlMRV9GT0xERUQgPSA0LFxuICAgIFNUWUxFX0RPVUJMRSA9IDU7IC8vIERldGVybWluZXMgd2hpY2ggc2NhbGFyIHN0eWxlcyBhcmUgcG9zc2libGUgYW5kIHJldHVybnMgdGhlIHByZWZlcnJlZCBzdHlsZS5cbi8vIGxpbmVXaWR0aCA9IC0xID0+IG5vIGxpbWl0LlxuLy8gUHJlLWNvbmRpdGlvbnM6IHN0ci5sZW5ndGggPiAwLlxuLy8gUG9zdC1jb25kaXRpb25zOlxuLy8gICAgU1RZTEVfUExBSU4gb3IgU1RZTEVfU0lOR0xFID0+IG5vIFxcbiBhcmUgaW4gdGhlIHN0cmluZy5cbi8vICAgIFNUWUxFX0xJVEVSQUwgPT4gbm8gbGluZXMgYXJlIHN1aXRhYmxlIGZvciBmb2xkaW5nIChvciBsaW5lV2lkdGggaXMgLTEpLlxuLy8gICAgU1RZTEVfRk9MREVEID0+IGEgbGluZSA+IGxpbmVXaWR0aCBhbmQgY2FuIGJlIGZvbGRlZCAoYW5kIGxpbmVXaWR0aCAhPSAtMSkuXG5cbmZ1bmN0aW9uIGNob29zZVNjYWxhclN0eWxlKHN0cmluZywgc2luZ2xlTGluZU9ubHksIGluZGVudFBlckxldmVsLCBsaW5lV2lkdGgsIHRlc3RBbWJpZ3VvdXNUeXBlKSB7XG4gIHZhciBpO1xuICB2YXIgY2hhciwgcHJldl9jaGFyO1xuICB2YXIgaGFzTGluZUJyZWFrID0gZmFsc2U7XG4gIHZhciBoYXNGb2xkYWJsZUxpbmUgPSBmYWxzZTsgLy8gb25seSBjaGVja2VkIGlmIHNob3VsZFRyYWNrV2lkdGhcblxuICB2YXIgc2hvdWxkVHJhY2tXaWR0aCA9IGxpbmVXaWR0aCAhPT0gLTE7XG4gIHZhciBwcmV2aW91c0xpbmVCcmVhayA9IC0xOyAvLyBjb3VudCB0aGUgZmlyc3QgbGluZSBjb3JyZWN0bHlcblxuICB2YXIgcGxhaW4gPSBpc1BsYWluU2FmZUZpcnN0KHN0cmluZy5jaGFyQ29kZUF0KDApKSAmJiAhaXNXaGl0ZXNwYWNlKHN0cmluZy5jaGFyQ29kZUF0KHN0cmluZy5sZW5ndGggLSAxKSk7XG5cbiAgaWYgKHNpbmdsZUxpbmVPbmx5KSB7XG4gICAgLy8gQ2FzZTogbm8gYmxvY2sgc3R5bGVzLlxuICAgIC8vIENoZWNrIGZvciBkaXNhbGxvd2VkIGNoYXJhY3RlcnMgdG8gcnVsZSBvdXQgcGxhaW4gYW5kIHNpbmdsZS5cbiAgICBmb3IgKGkgPSAwOyBpIDwgc3RyaW5nLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjaGFyID0gc3RyaW5nLmNoYXJDb2RlQXQoaSk7XG5cbiAgICAgIGlmICghaXNQcmludGFibGUoY2hhcikpIHtcbiAgICAgICAgcmV0dXJuIFNUWUxFX0RPVUJMRTtcbiAgICAgIH1cblxuICAgICAgcHJldl9jaGFyID0gaSA+IDAgPyBzdHJpbmcuY2hhckNvZGVBdChpIC0gMSkgOiBudWxsO1xuICAgICAgcGxhaW4gPSBwbGFpbiAmJiBpc1BsYWluU2FmZShjaGFyLCBwcmV2X2NoYXIpO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICAvLyBDYXNlOiBibG9jayBzdHlsZXMgcGVybWl0dGVkLlxuICAgIGZvciAoaSA9IDA7IGkgPCBzdHJpbmcubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNoYXIgPSBzdHJpbmcuY2hhckNvZGVBdChpKTtcblxuICAgICAgaWYgKGNoYXIgPT09IENIQVJfTElORV9GRUVEKSB7XG4gICAgICAgIGhhc0xpbmVCcmVhayA9IHRydWU7IC8vIENoZWNrIGlmIGFueSBsaW5lIGNhbiBiZSBmb2xkZWQuXG5cbiAgICAgICAgaWYgKHNob3VsZFRyYWNrV2lkdGgpIHtcbiAgICAgICAgICBoYXNGb2xkYWJsZUxpbmUgPSBoYXNGb2xkYWJsZUxpbmUgfHwgLy8gRm9sZGFibGUgbGluZSA9IHRvbyBsb25nLCBhbmQgbm90IG1vcmUtaW5kZW50ZWQuXG4gICAgICAgICAgaSAtIHByZXZpb3VzTGluZUJyZWFrIC0gMSA+IGxpbmVXaWR0aCAmJiBzdHJpbmdbcHJldmlvdXNMaW5lQnJlYWsgKyAxXSAhPT0gJyAnO1xuICAgICAgICAgIHByZXZpb3VzTGluZUJyZWFrID0gaTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICghaXNQcmludGFibGUoY2hhcikpIHtcbiAgICAgICAgcmV0dXJuIFNUWUxFX0RPVUJMRTtcbiAgICAgIH1cblxuICAgICAgcHJldl9jaGFyID0gaSA+IDAgPyBzdHJpbmcuY2hhckNvZGVBdChpIC0gMSkgOiBudWxsO1xuICAgICAgcGxhaW4gPSBwbGFpbiAmJiBpc1BsYWluU2FmZShjaGFyLCBwcmV2X2NoYXIpO1xuICAgIH0gLy8gaW4gY2FzZSB0aGUgZW5kIGlzIG1pc3NpbmcgYSBcXG5cblxuXG4gICAgaGFzRm9sZGFibGVMaW5lID0gaGFzRm9sZGFibGVMaW5lIHx8IHNob3VsZFRyYWNrV2lkdGggJiYgaSAtIHByZXZpb3VzTGluZUJyZWFrIC0gMSA+IGxpbmVXaWR0aCAmJiBzdHJpbmdbcHJldmlvdXNMaW5lQnJlYWsgKyAxXSAhPT0gJyAnO1xuICB9IC8vIEFsdGhvdWdoIGV2ZXJ5IHN0eWxlIGNhbiByZXByZXNlbnQgXFxuIHdpdGhvdXQgZXNjYXBpbmcsIHByZWZlciBibG9jayBzdHlsZXNcbiAgLy8gZm9yIG11bHRpbGluZSwgc2luY2UgdGhleSdyZSBtb3JlIHJlYWRhYmxlIGFuZCB0aGV5IGRvbid0IGFkZCBlbXB0eSBsaW5lcy5cbiAgLy8gQWxzbyBwcmVmZXIgZm9sZGluZyBhIHN1cGVyLWxvbmcgbGluZS5cblxuXG4gIGlmICghaGFzTGluZUJyZWFrICYmICFoYXNGb2xkYWJsZUxpbmUpIHtcbiAgICAvLyBTdHJpbmdzIGludGVycHJldGFibGUgYXMgYW5vdGhlciB0eXBlIGhhdmUgdG8gYmUgcXVvdGVkO1xuICAgIC8vIGUuZy4gdGhlIHN0cmluZyAndHJ1ZScgdnMuIHRoZSBib29sZWFuIHRydWUuXG4gICAgcmV0dXJuIHBsYWluICYmICF0ZXN0QW1iaWd1b3VzVHlwZShzdHJpbmcpID8gU1RZTEVfUExBSU4gOiBTVFlMRV9TSU5HTEU7XG4gIH0gLy8gRWRnZSBjYXNlOiBibG9jayBpbmRlbnRhdGlvbiBpbmRpY2F0b3IgY2FuIG9ubHkgaGF2ZSBvbmUgZGlnaXQuXG5cblxuICBpZiAoaW5kZW50UGVyTGV2ZWwgPiA5ICYmIG5lZWRJbmRlbnRJbmRpY2F0b3Ioc3RyaW5nKSkge1xuICAgIHJldHVybiBTVFlMRV9ET1VCTEU7XG4gIH0gLy8gQXQgdGhpcyBwb2ludCB3ZSBrbm93IGJsb2NrIHN0eWxlcyBhcmUgdmFsaWQuXG4gIC8vIFByZWZlciBsaXRlcmFsIHN0eWxlIHVubGVzcyB3ZSB3YW50IHRvIGZvbGQuXG5cblxuICByZXR1cm4gaGFzRm9sZGFibGVMaW5lID8gU1RZTEVfRk9MREVEIDogU1RZTEVfTElURVJBTDtcbn0gLy8gTm90ZTogbGluZSBicmVha2luZy9mb2xkaW5nIGlzIGltcGxlbWVudGVkIGZvciBvbmx5IHRoZSBmb2xkZWQgc3R5bGUuXG4vLyBOQi4gV2UgZHJvcCB0aGUgbGFzdCB0cmFpbGluZyBuZXdsaW5lIChpZiBhbnkpIG9mIGEgcmV0dXJuZWQgYmxvY2sgc2NhbGFyXG4vLyAgc2luY2UgdGhlIGR1bXBlciBhZGRzIGl0cyBvd24gbmV3bGluZS4gVGhpcyBhbHdheXMgd29ya3M6XG4vLyAgICDigKIgTm8gZW5kaW5nIG5ld2xpbmUgPT4gdW5hZmZlY3RlZDsgYWxyZWFkeSB1c2luZyBzdHJpcCBcIi1cIiBjaG9tcGluZy5cbi8vICAgIOKAoiBFbmRpbmcgbmV3bGluZSAgICA9PiByZW1vdmVkIHRoZW4gcmVzdG9yZWQuXG4vLyAgSW1wb3J0YW50bHksIHRoaXMga2VlcHMgdGhlIFwiK1wiIGNob21wIGluZGljYXRvciBmcm9tIGdhaW5pbmcgYW4gZXh0cmEgbGluZS5cblxuXG5mdW5jdGlvbiB3cml0ZVNjYWxhcihzdGF0ZSwgc3RyaW5nLCBsZXZlbCwgaXNrZXkpIHtcbiAgc3RhdGUuZHVtcCA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoc3RyaW5nLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIFwiJydcIjtcbiAgICB9XG5cbiAgICBpZiAoIXN0YXRlLm5vQ29tcGF0TW9kZSAmJiBERVBSRUNBVEVEX0JPT0xFQU5TX1NZTlRBWC5pbmRleE9mKHN0cmluZykgIT09IC0xKSB7XG4gICAgICByZXR1cm4gXCInXCIgKyBzdHJpbmcgKyBcIidcIjtcbiAgICB9XG5cbiAgICB2YXIgaW5kZW50ID0gc3RhdGUuaW5kZW50ICogTWF0aC5tYXgoMSwgbGV2ZWwpOyAvLyBubyAwLWluZGVudCBzY2FsYXJzXG4gICAgLy8gQXMgaW5kZW50YXRpb24gZ2V0cyBkZWVwZXIsIGxldCB0aGUgd2lkdGggZGVjcmVhc2UgbW9ub3RvbmljYWxseVxuICAgIC8vIHRvIHRoZSBsb3dlciBib3VuZCBtaW4oc3RhdGUubGluZVdpZHRoLCA0MCkuXG4gICAgLy8gTm90ZSB0aGF0IHRoaXMgaW1wbGllc1xuICAgIC8vICBzdGF0ZS5saW5lV2lkdGgg4omkIDQwICsgc3RhdGUuaW5kZW50OiB3aWR0aCBpcyBmaXhlZCBhdCB0aGUgbG93ZXIgYm91bmQuXG4gICAgLy8gIHN0YXRlLmxpbmVXaWR0aCA+IDQwICsgc3RhdGUuaW5kZW50OiB3aWR0aCBkZWNyZWFzZXMgdW50aWwgdGhlIGxvd2VyIGJvdW5kLlxuICAgIC8vIFRoaXMgYmVoYXZlcyBiZXR0ZXIgdGhhbiBhIGNvbnN0YW50IG1pbmltdW0gd2lkdGggd2hpY2ggZGlzYWxsb3dzIG5hcnJvd2VyIG9wdGlvbnMsXG4gICAgLy8gb3IgYW4gaW5kZW50IHRocmVzaG9sZCB3aGljaCBjYXVzZXMgdGhlIHdpZHRoIHRvIHN1ZGRlbmx5IGluY3JlYXNlLlxuXG4gICAgdmFyIGxpbmVXaWR0aCA9IHN0YXRlLmxpbmVXaWR0aCA9PT0gLTEgPyAtMSA6IE1hdGgubWF4KE1hdGgubWluKHN0YXRlLmxpbmVXaWR0aCwgNDApLCBzdGF0ZS5saW5lV2lkdGggLSBpbmRlbnQpOyAvLyBXaXRob3V0IGtub3dpbmcgaWYga2V5cyBhcmUgaW1wbGljaXQvZXhwbGljaXQsIGFzc3VtZSBpbXBsaWNpdCBmb3Igc2FmZXR5LlxuXG4gICAgdmFyIHNpbmdsZUxpbmVPbmx5ID0gaXNrZXkgLy8gTm8gYmxvY2sgc3R5bGVzIGluIGZsb3cgbW9kZS5cbiAgICB8fCBzdGF0ZS5mbG93TGV2ZWwgPiAtMSAmJiBsZXZlbCA+PSBzdGF0ZS5mbG93TGV2ZWw7XG5cbiAgICBmdW5jdGlvbiB0ZXN0QW1iaWd1aXR5KHN0cmluZykge1xuICAgICAgcmV0dXJuIHRlc3RJbXBsaWNpdFJlc29sdmluZyhzdGF0ZSwgc3RyaW5nKTtcbiAgICB9XG5cbiAgICBzd2l0Y2ggKGNob29zZVNjYWxhclN0eWxlKHN0cmluZywgc2luZ2xlTGluZU9ubHksIHN0YXRlLmluZGVudCwgbGluZVdpZHRoLCB0ZXN0QW1iaWd1aXR5KSkge1xuICAgICAgY2FzZSBTVFlMRV9QTEFJTjpcbiAgICAgICAgcmV0dXJuIHN0cmluZztcblxuICAgICAgY2FzZSBTVFlMRV9TSU5HTEU6XG4gICAgICAgIHJldHVybiBcIidcIiArIHN0cmluZy5yZXBsYWNlKC8nL2csIFwiJydcIikgKyBcIidcIjtcblxuICAgICAgY2FzZSBTVFlMRV9MSVRFUkFMOlxuICAgICAgICByZXR1cm4gJ3wnICsgYmxvY2tIZWFkZXIoc3RyaW5nLCBzdGF0ZS5pbmRlbnQpICsgZHJvcEVuZGluZ05ld2xpbmUoaW5kZW50U3RyaW5nKHN0cmluZywgaW5kZW50KSk7XG5cbiAgICAgIGNhc2UgU1RZTEVfRk9MREVEOlxuICAgICAgICByZXR1cm4gJz4nICsgYmxvY2tIZWFkZXIoc3RyaW5nLCBzdGF0ZS5pbmRlbnQpICsgZHJvcEVuZGluZ05ld2xpbmUoaW5kZW50U3RyaW5nKGZvbGRTdHJpbmcoc3RyaW5nLCBsaW5lV2lkdGgpLCBpbmRlbnQpKTtcblxuICAgICAgY2FzZSBTVFlMRV9ET1VCTEU6XG4gICAgICAgIHJldHVybiAnXCInICsgZXNjYXBlU3RyaW5nKHN0cmluZykgKyAnXCInO1xuXG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0aHJvdyBuZXcgZXhjZXB0aW9uKCdpbXBvc3NpYmxlIGVycm9yOiBpbnZhbGlkIHNjYWxhciBzdHlsZScpO1xuICAgIH1cbiAgfSgpO1xufSAvLyBQcmUtY29uZGl0aW9uczogc3RyaW5nIGlzIHZhbGlkIGZvciBhIGJsb2NrIHNjYWxhciwgMSA8PSBpbmRlbnRQZXJMZXZlbCA8PSA5LlxuXG5cbmZ1bmN0aW9uIGJsb2NrSGVhZGVyKHN0cmluZywgaW5kZW50UGVyTGV2ZWwpIHtcbiAgdmFyIGluZGVudEluZGljYXRvciA9IG5lZWRJbmRlbnRJbmRpY2F0b3Ioc3RyaW5nKSA/IFN0cmluZyhpbmRlbnRQZXJMZXZlbCkgOiAnJzsgLy8gbm90ZSB0aGUgc3BlY2lhbCBjYXNlOiB0aGUgc3RyaW5nICdcXG4nIGNvdW50cyBhcyBhIFwidHJhaWxpbmdcIiBlbXB0eSBsaW5lLlxuXG4gIHZhciBjbGlwID0gc3RyaW5nW3N0cmluZy5sZW5ndGggLSAxXSA9PT0gJ1xcbic7XG4gIHZhciBrZWVwID0gY2xpcCAmJiAoc3RyaW5nW3N0cmluZy5sZW5ndGggLSAyXSA9PT0gJ1xcbicgfHwgc3RyaW5nID09PSAnXFxuJyk7XG4gIHZhciBjaG9tcCA9IGtlZXAgPyAnKycgOiBjbGlwID8gJycgOiAnLSc7XG4gIHJldHVybiBpbmRlbnRJbmRpY2F0b3IgKyBjaG9tcCArICdcXG4nO1xufSAvLyAoU2VlIHRoZSBub3RlIGZvciB3cml0ZVNjYWxhci4pXG5cblxuZnVuY3Rpb24gZHJvcEVuZGluZ05ld2xpbmUoc3RyaW5nKSB7XG4gIHJldHVybiBzdHJpbmdbc3RyaW5nLmxlbmd0aCAtIDFdID09PSAnXFxuJyA/IHN0cmluZy5zbGljZSgwLCAtMSkgOiBzdHJpbmc7XG59IC8vIE5vdGU6IGEgbG9uZyBsaW5lIHdpdGhvdXQgYSBzdWl0YWJsZSBicmVhayBwb2ludCB3aWxsIGV4Y2VlZCB0aGUgd2lkdGggbGltaXQuXG4vLyBQcmUtY29uZGl0aW9uczogZXZlcnkgY2hhciBpbiBzdHIgaXNQcmludGFibGUsIHN0ci5sZW5ndGggPiAwLCB3aWR0aCA+IDAuXG5cblxuZnVuY3Rpb24gZm9sZFN0cmluZyhzdHJpbmcsIHdpZHRoKSB7XG4gIC8vIEluIGZvbGRlZCBzdHlsZSwgJGskIGNvbnNlY3V0aXZlIG5ld2xpbmVzIG91dHB1dCBhcyAkaysxJCBuZXdsaW5lc+KAlFxuICAvLyB1bmxlc3MgdGhleSdyZSBiZWZvcmUgb3IgYWZ0ZXIgYSBtb3JlLWluZGVudGVkIGxpbmUsIG9yIGF0IHRoZSB2ZXJ5XG4gIC8vIGJlZ2lubmluZyBvciBlbmQsIGluIHdoaWNoIGNhc2UgJGskIG1hcHMgdG8gJGskLlxuICAvLyBUaGVyZWZvcmUsIHBhcnNlIGVhY2ggY2h1bmsgYXMgbmV3bGluZShzKSBmb2xsb3dlZCBieSBhIGNvbnRlbnQgbGluZS5cbiAgdmFyIGxpbmVSZSA9IC8oXFxuKykoW15cXG5dKikvZzsgLy8gZmlyc3QgbGluZSAocG9zc2libHkgYW4gZW1wdHkgbGluZSlcblxuICB2YXIgcmVzdWx0ID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBuZXh0TEYgPSBzdHJpbmcuaW5kZXhPZignXFxuJyk7XG4gICAgbmV4dExGID0gbmV4dExGICE9PSAtMSA/IG5leHRMRiA6IHN0cmluZy5sZW5ndGg7XG4gICAgbGluZVJlLmxhc3RJbmRleCA9IG5leHRMRjtcbiAgICByZXR1cm4gZm9sZExpbmUoc3RyaW5nLnNsaWNlKDAsIG5leHRMRiksIHdpZHRoKTtcbiAgfSgpOyAvLyBJZiB3ZSBoYXZlbid0IHJlYWNoZWQgdGhlIGZpcnN0IGNvbnRlbnQgbGluZSB5ZXQsIGRvbid0IGFkZCBhbiBleHRyYSBcXG4uXG5cblxuICB2YXIgcHJldk1vcmVJbmRlbnRlZCA9IHN0cmluZ1swXSA9PT0gJ1xcbicgfHwgc3RyaW5nWzBdID09PSAnICc7XG4gIHZhciBtb3JlSW5kZW50ZWQ7IC8vIHJlc3Qgb2YgdGhlIGxpbmVzXG5cbiAgdmFyIG1hdGNoO1xuXG4gIHdoaWxlIChtYXRjaCA9IGxpbmVSZS5leGVjKHN0cmluZykpIHtcbiAgICB2YXIgcHJlZml4ID0gbWF0Y2hbMV0sXG4gICAgICAgIGxpbmUgPSBtYXRjaFsyXTtcbiAgICBtb3JlSW5kZW50ZWQgPSBsaW5lWzBdID09PSAnICc7XG4gICAgcmVzdWx0ICs9IHByZWZpeCArICghcHJldk1vcmVJbmRlbnRlZCAmJiAhbW9yZUluZGVudGVkICYmIGxpbmUgIT09ICcnID8gJ1xcbicgOiAnJykgKyBmb2xkTGluZShsaW5lLCB3aWR0aCk7XG4gICAgcHJldk1vcmVJbmRlbnRlZCA9IG1vcmVJbmRlbnRlZDtcbiAgfVxuXG4gIHJldHVybiByZXN1bHQ7XG59IC8vIEdyZWVkeSBsaW5lIGJyZWFraW5nLlxuLy8gUGlja3MgdGhlIGxvbmdlc3QgbGluZSB1bmRlciB0aGUgbGltaXQgZWFjaCB0aW1lLFxuLy8gb3RoZXJ3aXNlIHNldHRsZXMgZm9yIHRoZSBzaG9ydGVzdCBsaW5lIG92ZXIgdGhlIGxpbWl0LlxuLy8gTkIuIE1vcmUtaW5kZW50ZWQgbGluZXMgKmNhbm5vdCogYmUgZm9sZGVkLCBhcyB0aGF0IHdvdWxkIGFkZCBhbiBleHRyYSBcXG4uXG5cblxuZnVuY3Rpb24gZm9sZExpbmUobGluZSwgd2lkdGgpIHtcbiAgaWYgKGxpbmUgPT09ICcnIHx8IGxpbmVbMF0gPT09ICcgJykgcmV0dXJuIGxpbmU7IC8vIFNpbmNlIGEgbW9yZS1pbmRlbnRlZCBsaW5lIGFkZHMgYSBcXG4sIGJyZWFrcyBjYW4ndCBiZSBmb2xsb3dlZCBieSBhIHNwYWNlLlxuXG4gIHZhciBicmVha1JlID0gLyBbXiBdL2c7IC8vIG5vdGU6IHRoZSBtYXRjaCBpbmRleCB3aWxsIGFsd2F5cyBiZSA8PSBsZW5ndGgtMi5cblxuICB2YXIgbWF0Y2g7IC8vIHN0YXJ0IGlzIGFuIGluY2x1c2l2ZSBpbmRleC4gZW5kLCBjdXJyLCBhbmQgbmV4dCBhcmUgZXhjbHVzaXZlLlxuXG4gIHZhciBzdGFydCA9IDAsXG4gICAgICBlbmQsXG4gICAgICBjdXJyID0gMCxcbiAgICAgIG5leHQgPSAwO1xuICB2YXIgcmVzdWx0ID0gJyc7IC8vIEludmFyaWFudHM6IDAgPD0gc3RhcnQgPD0gbGVuZ3RoLTEuXG4gIC8vICAgMCA8PSBjdXJyIDw9IG5leHQgPD0gbWF4KDAsIGxlbmd0aC0yKS4gY3VyciAtIHN0YXJ0IDw9IHdpZHRoLlxuICAvLyBJbnNpZGUgdGhlIGxvb3A6XG4gIC8vICAgQSBtYXRjaCBpbXBsaWVzIGxlbmd0aCA+PSAyLCBzbyBjdXJyIGFuZCBuZXh0IGFyZSA8PSBsZW5ndGgtMi5cblxuICB3aGlsZSAobWF0Y2ggPSBicmVha1JlLmV4ZWMobGluZSkpIHtcbiAgICBuZXh0ID0gbWF0Y2guaW5kZXg7IC8vIG1haW50YWluIGludmFyaWFudDogY3VyciAtIHN0YXJ0IDw9IHdpZHRoXG5cbiAgICBpZiAobmV4dCAtIHN0YXJ0ID4gd2lkdGgpIHtcbiAgICAgIGVuZCA9IGN1cnIgPiBzdGFydCA/IGN1cnIgOiBuZXh0OyAvLyBkZXJpdmUgZW5kIDw9IGxlbmd0aC0yXG5cbiAgICAgIHJlc3VsdCArPSAnXFxuJyArIGxpbmUuc2xpY2Uoc3RhcnQsIGVuZCk7IC8vIHNraXAgdGhlIHNwYWNlIHRoYXQgd2FzIG91dHB1dCBhcyBcXG5cblxuICAgICAgc3RhcnQgPSBlbmQgKyAxOyAvLyBkZXJpdmUgc3RhcnQgPD0gbGVuZ3RoLTFcbiAgICB9XG5cbiAgICBjdXJyID0gbmV4dDtcbiAgfSAvLyBCeSB0aGUgaW52YXJpYW50cywgc3RhcnQgPD0gbGVuZ3RoLTEsIHNvIHRoZXJlIGlzIHNvbWV0aGluZyBsZWZ0IG92ZXIuXG4gIC8vIEl0IGlzIGVpdGhlciB0aGUgd2hvbGUgc3RyaW5nIG9yIGEgcGFydCBzdGFydGluZyBmcm9tIG5vbi13aGl0ZXNwYWNlLlxuXG5cbiAgcmVzdWx0ICs9ICdcXG4nOyAvLyBJbnNlcnQgYSBicmVhayBpZiB0aGUgcmVtYWluZGVyIGlzIHRvbyBsb25nIGFuZCB0aGVyZSBpcyBhIGJyZWFrIGF2YWlsYWJsZS5cblxuICBpZiAobGluZS5sZW5ndGggLSBzdGFydCA+IHdpZHRoICYmIGN1cnIgPiBzdGFydCkge1xuICAgIHJlc3VsdCArPSBsaW5lLnNsaWNlKHN0YXJ0LCBjdXJyKSArICdcXG4nICsgbGluZS5zbGljZShjdXJyICsgMSk7XG4gIH0gZWxzZSB7XG4gICAgcmVzdWx0ICs9IGxpbmUuc2xpY2Uoc3RhcnQpO1xuICB9XG5cbiAgcmV0dXJuIHJlc3VsdC5zbGljZSgxKTsgLy8gZHJvcCBleHRyYSBcXG4gam9pbmVyXG59IC8vIEVzY2FwZXMgYSBkb3VibGUtcXVvdGVkIHN0cmluZy5cblxuXG5mdW5jdGlvbiBlc2NhcGVTdHJpbmcoc3RyaW5nKSB7XG4gIHZhciByZXN1bHQgPSAnJztcbiAgdmFyIGNoYXIsIG5leHRDaGFyO1xuICB2YXIgZXNjYXBlU2VxO1xuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgc3RyaW5nLmxlbmd0aDsgaSsrKSB7XG4gICAgY2hhciA9IHN0cmluZy5jaGFyQ29kZUF0KGkpOyAvLyBDaGVjayBmb3Igc3Vycm9nYXRlIHBhaXJzIChyZWZlcmVuY2UgVW5pY29kZSAzLjAgc2VjdGlvbiBcIjMuNyBTdXJyb2dhdGVzXCIpLlxuXG4gICAgaWYgKGNoYXIgPj0gMHhEODAwICYmIGNoYXIgPD0gMHhEQkZGXG4gICAgLyogaGlnaCBzdXJyb2dhdGUgKi9cbiAgICApIHtcbiAgICAgICAgbmV4dENoYXIgPSBzdHJpbmcuY2hhckNvZGVBdChpICsgMSk7XG5cbiAgICAgICAgaWYgKG5leHRDaGFyID49IDB4REMwMCAmJiBuZXh0Q2hhciA8PSAweERGRkZcbiAgICAgICAgLyogbG93IHN1cnJvZ2F0ZSAqL1xuICAgICAgICApIHtcbiAgICAgICAgICAgIC8vIENvbWJpbmUgdGhlIHN1cnJvZ2F0ZSBwYWlyIGFuZCBzdG9yZSBpdCBlc2NhcGVkLlxuICAgICAgICAgICAgcmVzdWx0ICs9IGVuY29kZUhleCgoY2hhciAtIDB4RDgwMCkgKiAweDQwMCArIG5leHRDaGFyIC0gMHhEQzAwICsgMHgxMDAwMCk7IC8vIEFkdmFuY2UgaW5kZXggb25lIGV4dHJhIHNpbmNlIHdlIGFscmVhZHkgdXNlZCB0aGF0IGNoYXIgaGVyZS5cblxuICAgICAgICAgICAgaSsrO1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgfVxuICAgICAgfVxuXG4gICAgZXNjYXBlU2VxID0gRVNDQVBFX1NFUVVFTkNFU1tjaGFyXTtcbiAgICByZXN1bHQgKz0gIWVzY2FwZVNlcSAmJiBpc1ByaW50YWJsZShjaGFyKSA/IHN0cmluZ1tpXSA6IGVzY2FwZVNlcSB8fCBlbmNvZGVIZXgoY2hhcik7XG4gIH1cblxuICByZXR1cm4gcmVzdWx0O1xufVxuXG5mdW5jdGlvbiB3cml0ZUZsb3dTZXF1ZW5jZShzdGF0ZSwgbGV2ZWwsIG9iamVjdCkge1xuICB2YXIgX3Jlc3VsdCA9ICcnLFxuICAgICAgX3RhZyA9IHN0YXRlLnRhZyxcbiAgICAgIGluZGV4LFxuICAgICAgbGVuZ3RoO1xuXG4gIGZvciAoaW5kZXggPSAwLCBsZW5ndGggPSBvYmplY3QubGVuZ3RoOyBpbmRleCA8IGxlbmd0aDsgaW5kZXggKz0gMSkge1xuICAgIC8vIFdyaXRlIG9ubHkgdmFsaWQgZWxlbWVudHMuXG4gICAgaWYgKHdyaXRlTm9kZShzdGF0ZSwgbGV2ZWwsIG9iamVjdFtpbmRleF0sIGZhbHNlLCBmYWxzZSkpIHtcbiAgICAgIGlmIChpbmRleCAhPT0gMCkgX3Jlc3VsdCArPSAnLCcgKyAoIXN0YXRlLmNvbmRlbnNlRmxvdyA/ICcgJyA6ICcnKTtcbiAgICAgIF9yZXN1bHQgKz0gc3RhdGUuZHVtcDtcbiAgICB9XG4gIH1cblxuICBzdGF0ZS50YWcgPSBfdGFnO1xuICBzdGF0ZS5kdW1wID0gJ1snICsgX3Jlc3VsdCArICddJztcbn1cblxuZnVuY3Rpb24gd3JpdGVCbG9ja1NlcXVlbmNlKHN0YXRlLCBsZXZlbCwgb2JqZWN0LCBjb21wYWN0KSB7XG4gIHZhciBfcmVzdWx0ID0gJycsXG4gICAgICBfdGFnID0gc3RhdGUudGFnLFxuICAgICAgaW5kZXgsXG4gICAgICBsZW5ndGg7XG5cbiAgZm9yIChpbmRleCA9IDAsIGxlbmd0aCA9IG9iamVjdC5sZW5ndGg7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCArPSAxKSB7XG4gICAgLy8gV3JpdGUgb25seSB2YWxpZCBlbGVtZW50cy5cbiAgICBpZiAod3JpdGVOb2RlKHN0YXRlLCBsZXZlbCArIDEsIG9iamVjdFtpbmRleF0sIHRydWUsIHRydWUpKSB7XG4gICAgICBpZiAoIWNvbXBhY3QgfHwgaW5kZXggIT09IDApIHtcbiAgICAgICAgX3Jlc3VsdCArPSBnZW5lcmF0ZU5leHRMaW5lKHN0YXRlLCBsZXZlbCk7XG4gICAgICB9XG5cbiAgICAgIGlmIChzdGF0ZS5kdW1wICYmIENIQVJfTElORV9GRUVEID09PSBzdGF0ZS5kdW1wLmNoYXJDb2RlQXQoMCkpIHtcbiAgICAgICAgX3Jlc3VsdCArPSAnLSc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBfcmVzdWx0ICs9ICctICc7XG4gICAgICB9XG5cbiAgICAgIF9yZXN1bHQgKz0gc3RhdGUuZHVtcDtcbiAgICB9XG4gIH1cblxuICBzdGF0ZS50YWcgPSBfdGFnO1xuICBzdGF0ZS5kdW1wID0gX3Jlc3VsdCB8fCAnW10nOyAvLyBFbXB0eSBzZXF1ZW5jZSBpZiBubyB2YWxpZCB2YWx1ZXMuXG59XG5cbmZ1bmN0aW9uIHdyaXRlRmxvd01hcHBpbmcoc3RhdGUsIGxldmVsLCBvYmplY3QpIHtcbiAgdmFyIF9yZXN1bHQgPSAnJyxcbiAgICAgIF90YWcgPSBzdGF0ZS50YWcsXG4gICAgICBvYmplY3RLZXlMaXN0ID0gT2JqZWN0LmtleXMob2JqZWN0KSxcbiAgICAgIGluZGV4LFxuICAgICAgbGVuZ3RoLFxuICAgICAgb2JqZWN0S2V5LFxuICAgICAgb2JqZWN0VmFsdWUsXG4gICAgICBwYWlyQnVmZmVyO1xuXG4gIGZvciAoaW5kZXggPSAwLCBsZW5ndGggPSBvYmplY3RLZXlMaXN0Lmxlbmd0aDsgaW5kZXggPCBsZW5ndGg7IGluZGV4ICs9IDEpIHtcbiAgICBwYWlyQnVmZmVyID0gJyc7XG4gICAgaWYgKGluZGV4ICE9PSAwKSBwYWlyQnVmZmVyICs9ICcsICc7XG4gICAgaWYgKHN0YXRlLmNvbmRlbnNlRmxvdykgcGFpckJ1ZmZlciArPSAnXCInO1xuICAgIG9iamVjdEtleSA9IG9iamVjdEtleUxpc3RbaW5kZXhdO1xuICAgIG9iamVjdFZhbHVlID0gb2JqZWN0W29iamVjdEtleV07XG5cbiAgICBpZiAoIXdyaXRlTm9kZShzdGF0ZSwgbGV2ZWwsIG9iamVjdEtleSwgZmFsc2UsIGZhbHNlKSkge1xuICAgICAgY29udGludWU7IC8vIFNraXAgdGhpcyBwYWlyIGJlY2F1c2Ugb2YgaW52YWxpZCBrZXk7XG4gICAgfVxuXG4gICAgaWYgKHN0YXRlLmR1bXAubGVuZ3RoID4gMTAyNCkgcGFpckJ1ZmZlciArPSAnPyAnO1xuICAgIHBhaXJCdWZmZXIgKz0gc3RhdGUuZHVtcCArIChzdGF0ZS5jb25kZW5zZUZsb3cgPyAnXCInIDogJycpICsgJzonICsgKHN0YXRlLmNvbmRlbnNlRmxvdyA/ICcnIDogJyAnKTtcblxuICAgIGlmICghd3JpdGVOb2RlKHN0YXRlLCBsZXZlbCwgb2JqZWN0VmFsdWUsIGZhbHNlLCBmYWxzZSkpIHtcbiAgICAgIGNvbnRpbnVlOyAvLyBTa2lwIHRoaXMgcGFpciBiZWNhdXNlIG9mIGludmFsaWQgdmFsdWUuXG4gICAgfVxuXG4gICAgcGFpckJ1ZmZlciArPSBzdGF0ZS5kdW1wOyAvLyBCb3RoIGtleSBhbmQgdmFsdWUgYXJlIHZhbGlkLlxuXG4gICAgX3Jlc3VsdCArPSBwYWlyQnVmZmVyO1xuICB9XG5cbiAgc3RhdGUudGFnID0gX3RhZztcbiAgc3RhdGUuZHVtcCA9ICd7JyArIF9yZXN1bHQgKyAnfSc7XG59XG5cbmZ1bmN0aW9uIHdyaXRlQmxvY2tNYXBwaW5nKHN0YXRlLCBsZXZlbCwgb2JqZWN0LCBjb21wYWN0KSB7XG4gIHZhciBfcmVzdWx0ID0gJycsXG4gICAgICBfdGFnID0gc3RhdGUudGFnLFxuICAgICAgb2JqZWN0S2V5TGlzdCA9IE9iamVjdC5rZXlzKG9iamVjdCksXG4gICAgICBpbmRleCxcbiAgICAgIGxlbmd0aCxcbiAgICAgIG9iamVjdEtleSxcbiAgICAgIG9iamVjdFZhbHVlLFxuICAgICAgZXhwbGljaXRQYWlyLFxuICAgICAgcGFpckJ1ZmZlcjsgLy8gQWxsb3cgc29ydGluZyBrZXlzIHNvIHRoYXQgdGhlIG91dHB1dCBmaWxlIGlzIGRldGVybWluaXN0aWNcblxuICBpZiAoc3RhdGUuc29ydEtleXMgPT09IHRydWUpIHtcbiAgICAvLyBEZWZhdWx0IHNvcnRpbmdcbiAgICBvYmplY3RLZXlMaXN0LnNvcnQoKTtcbiAgfSBlbHNlIGlmICh0eXBlb2Ygc3RhdGUuc29ydEtleXMgPT09ICdmdW5jdGlvbicpIHtcbiAgICAvLyBDdXN0b20gc29ydCBmdW5jdGlvblxuICAgIG9iamVjdEtleUxpc3Quc29ydChzdGF0ZS5zb3J0S2V5cyk7XG4gIH0gZWxzZSBpZiAoc3RhdGUuc29ydEtleXMpIHtcbiAgICAvLyBTb21ldGhpbmcgaXMgd3JvbmdcbiAgICB0aHJvdyBuZXcgZXhjZXB0aW9uKCdzb3J0S2V5cyBtdXN0IGJlIGEgYm9vbGVhbiBvciBhIGZ1bmN0aW9uJyk7XG4gIH1cblxuICBmb3IgKGluZGV4ID0gMCwgbGVuZ3RoID0gb2JqZWN0S2V5TGlzdC5sZW5ndGg7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCArPSAxKSB7XG4gICAgcGFpckJ1ZmZlciA9ICcnO1xuXG4gICAgaWYgKCFjb21wYWN0IHx8IGluZGV4ICE9PSAwKSB7XG4gICAgICBwYWlyQnVmZmVyICs9IGdlbmVyYXRlTmV4dExpbmUoc3RhdGUsIGxldmVsKTtcbiAgICB9XG5cbiAgICBvYmplY3RLZXkgPSBvYmplY3RLZXlMaXN0W2luZGV4XTtcbiAgICBvYmplY3RWYWx1ZSA9IG9iamVjdFtvYmplY3RLZXldO1xuXG4gICAgaWYgKCF3cml0ZU5vZGUoc3RhdGUsIGxldmVsICsgMSwgb2JqZWN0S2V5LCB0cnVlLCB0cnVlLCB0cnVlKSkge1xuICAgICAgY29udGludWU7IC8vIFNraXAgdGhpcyBwYWlyIGJlY2F1c2Ugb2YgaW52YWxpZCBrZXkuXG4gICAgfVxuXG4gICAgZXhwbGljaXRQYWlyID0gc3RhdGUudGFnICE9PSBudWxsICYmIHN0YXRlLnRhZyAhPT0gJz8nIHx8IHN0YXRlLmR1bXAgJiYgc3RhdGUuZHVtcC5sZW5ndGggPiAxMDI0O1xuXG4gICAgaWYgKGV4cGxpY2l0UGFpcikge1xuICAgICAgaWYgKHN0YXRlLmR1bXAgJiYgQ0hBUl9MSU5FX0ZFRUQgPT09IHN0YXRlLmR1bXAuY2hhckNvZGVBdCgwKSkge1xuICAgICAgICBwYWlyQnVmZmVyICs9ICc/JztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHBhaXJCdWZmZXIgKz0gJz8gJztcbiAgICAgIH1cbiAgICB9XG5cbiAgICBwYWlyQnVmZmVyICs9IHN0YXRlLmR1bXA7XG5cbiAgICBpZiAoZXhwbGljaXRQYWlyKSB7XG4gICAgICBwYWlyQnVmZmVyICs9IGdlbmVyYXRlTmV4dExpbmUoc3RhdGUsIGxldmVsKTtcbiAgICB9XG5cbiAgICBpZiAoIXdyaXRlTm9kZShzdGF0ZSwgbGV2ZWwgKyAxLCBvYmplY3RWYWx1ZSwgdHJ1ZSwgZXhwbGljaXRQYWlyKSkge1xuICAgICAgY29udGludWU7IC8vIFNraXAgdGhpcyBwYWlyIGJlY2F1c2Ugb2YgaW52YWxpZCB2YWx1ZS5cbiAgICB9XG5cbiAgICBpZiAoc3RhdGUuZHVtcCAmJiBDSEFSX0xJTkVfRkVFRCA9PT0gc3RhdGUuZHVtcC5jaGFyQ29kZUF0KDApKSB7XG4gICAgICBwYWlyQnVmZmVyICs9ICc6JztcbiAgICB9IGVsc2Uge1xuICAgICAgcGFpckJ1ZmZlciArPSAnOiAnO1xuICAgIH1cblxuICAgIHBhaXJCdWZmZXIgKz0gc3RhdGUuZHVtcDsgLy8gQm90aCBrZXkgYW5kIHZhbHVlIGFyZSB2YWxpZC5cblxuICAgIF9yZXN1bHQgKz0gcGFpckJ1ZmZlcjtcbiAgfVxuXG4gIHN0YXRlLnRhZyA9IF90YWc7XG4gIHN0YXRlLmR1bXAgPSBfcmVzdWx0IHx8ICd7fSc7IC8vIEVtcHR5IG1hcHBpbmcgaWYgbm8gdmFsaWQgcGFpcnMuXG59XG5cbmZ1bmN0aW9uIGRldGVjdFR5cGUoc3RhdGUsIG9iamVjdCwgZXhwbGljaXQpIHtcbiAgdmFyIF9yZXN1bHQsIHR5cGVMaXN0LCBpbmRleCwgbGVuZ3RoLCB0eXBlLCBzdHlsZTtcblxuICB0eXBlTGlzdCA9IGV4cGxpY2l0ID8gc3RhdGUuZXhwbGljaXRUeXBlcyA6IHN0YXRlLmltcGxpY2l0VHlwZXM7XG5cbiAgZm9yIChpbmRleCA9IDAsIGxlbmd0aCA9IHR5cGVMaXN0Lmxlbmd0aDsgaW5kZXggPCBsZW5ndGg7IGluZGV4ICs9IDEpIHtcbiAgICB0eXBlID0gdHlwZUxpc3RbaW5kZXhdO1xuXG4gICAgaWYgKCh0eXBlLmluc3RhbmNlT2YgfHwgdHlwZS5wcmVkaWNhdGUpICYmICghdHlwZS5pbnN0YW5jZU9mIHx8IHR5cGVvZiBvYmplY3QgPT09ICdvYmplY3QnICYmIG9iamVjdCBpbnN0YW5jZW9mIHR5cGUuaW5zdGFuY2VPZikgJiYgKCF0eXBlLnByZWRpY2F0ZSB8fCB0eXBlLnByZWRpY2F0ZShvYmplY3QpKSkge1xuICAgICAgc3RhdGUudGFnID0gZXhwbGljaXQgPyB0eXBlLnRhZyA6ICc/JztcblxuICAgICAgaWYgKHR5cGUucmVwcmVzZW50KSB7XG4gICAgICAgIHN0eWxlID0gc3RhdGUuc3R5bGVNYXBbdHlwZS50YWddIHx8IHR5cGUuZGVmYXVsdFN0eWxlO1xuXG4gICAgICAgIGlmIChfdG9TdHJpbmckMi5jYWxsKHR5cGUucmVwcmVzZW50KSA9PT0gJ1tvYmplY3QgRnVuY3Rpb25dJykge1xuICAgICAgICAgIF9yZXN1bHQgPSB0eXBlLnJlcHJlc2VudChvYmplY3QsIHN0eWxlKTtcbiAgICAgICAgfSBlbHNlIGlmIChfaGFzT3duUHJvcGVydHkkMy5jYWxsKHR5cGUucmVwcmVzZW50LCBzdHlsZSkpIHtcbiAgICAgICAgICBfcmVzdWx0ID0gdHlwZS5yZXByZXNlbnRbc3R5bGVdKG9iamVjdCwgc3R5bGUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRocm93IG5ldyBleGNlcHRpb24oJyE8JyArIHR5cGUudGFnICsgJz4gdGFnIHJlc29sdmVyIGFjY2VwdHMgbm90IFwiJyArIHN0eWxlICsgJ1wiIHN0eWxlJyk7XG4gICAgICAgIH1cblxuICAgICAgICBzdGF0ZS5kdW1wID0gX3Jlc3VsdDtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGZhbHNlO1xufSAvLyBTZXJpYWxpemVzIGBvYmplY3RgIGFuZCB3cml0ZXMgaXQgdG8gZ2xvYmFsIGByZXN1bHRgLlxuLy8gUmV0dXJucyB0cnVlIG9uIHN1Y2Nlc3MsIG9yIGZhbHNlIG9uIGludmFsaWQgb2JqZWN0LlxuLy9cblxuXG5mdW5jdGlvbiB3cml0ZU5vZGUoc3RhdGUsIGxldmVsLCBvYmplY3QsIGJsb2NrLCBjb21wYWN0LCBpc2tleSkge1xuICBzdGF0ZS50YWcgPSBudWxsO1xuICBzdGF0ZS5kdW1wID0gb2JqZWN0O1xuXG4gIGlmICghZGV0ZWN0VHlwZShzdGF0ZSwgb2JqZWN0LCBmYWxzZSkpIHtcbiAgICBkZXRlY3RUeXBlKHN0YXRlLCBvYmplY3QsIHRydWUpO1xuICB9XG5cbiAgdmFyIHR5cGUgPSBfdG9TdHJpbmckMi5jYWxsKHN0YXRlLmR1bXApO1xuXG4gIGlmIChibG9jaykge1xuICAgIGJsb2NrID0gc3RhdGUuZmxvd0xldmVsIDwgMCB8fCBzdGF0ZS5mbG93TGV2ZWwgPiBsZXZlbDtcbiAgfVxuXG4gIHZhciBvYmplY3RPckFycmF5ID0gdHlwZSA9PT0gJ1tvYmplY3QgT2JqZWN0XScgfHwgdHlwZSA9PT0gJ1tvYmplY3QgQXJyYXldJyxcbiAgICAgIGR1cGxpY2F0ZUluZGV4LFxuICAgICAgZHVwbGljYXRlO1xuXG4gIGlmIChvYmplY3RPckFycmF5KSB7XG4gICAgZHVwbGljYXRlSW5kZXggPSBzdGF0ZS5kdXBsaWNhdGVzLmluZGV4T2Yob2JqZWN0KTtcbiAgICBkdXBsaWNhdGUgPSBkdXBsaWNhdGVJbmRleCAhPT0gLTE7XG4gIH1cblxuICBpZiAoc3RhdGUudGFnICE9PSBudWxsICYmIHN0YXRlLnRhZyAhPT0gJz8nIHx8IGR1cGxpY2F0ZSB8fCBzdGF0ZS5pbmRlbnQgIT09IDIgJiYgbGV2ZWwgPiAwKSB7XG4gICAgY29tcGFjdCA9IGZhbHNlO1xuICB9XG5cbiAgaWYgKGR1cGxpY2F0ZSAmJiBzdGF0ZS51c2VkRHVwbGljYXRlc1tkdXBsaWNhdGVJbmRleF0pIHtcbiAgICBzdGF0ZS5kdW1wID0gJypyZWZfJyArIGR1cGxpY2F0ZUluZGV4O1xuICB9IGVsc2Uge1xuICAgIGlmIChvYmplY3RPckFycmF5ICYmIGR1cGxpY2F0ZSAmJiAhc3RhdGUudXNlZER1cGxpY2F0ZXNbZHVwbGljYXRlSW5kZXhdKSB7XG4gICAgICBzdGF0ZS51c2VkRHVwbGljYXRlc1tkdXBsaWNhdGVJbmRleF0gPSB0cnVlO1xuICAgIH1cblxuICAgIGlmICh0eXBlID09PSAnW29iamVjdCBPYmplY3RdJykge1xuICAgICAgaWYgKGJsb2NrICYmIE9iamVjdC5rZXlzKHN0YXRlLmR1bXApLmxlbmd0aCAhPT0gMCkge1xuICAgICAgICB3cml0ZUJsb2NrTWFwcGluZyhzdGF0ZSwgbGV2ZWwsIHN0YXRlLmR1bXAsIGNvbXBhY3QpO1xuXG4gICAgICAgIGlmIChkdXBsaWNhdGUpIHtcbiAgICAgICAgICBzdGF0ZS5kdW1wID0gJyZyZWZfJyArIGR1cGxpY2F0ZUluZGV4ICsgc3RhdGUuZHVtcDtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgd3JpdGVGbG93TWFwcGluZyhzdGF0ZSwgbGV2ZWwsIHN0YXRlLmR1bXApO1xuXG4gICAgICAgIGlmIChkdXBsaWNhdGUpIHtcbiAgICAgICAgICBzdGF0ZS5kdW1wID0gJyZyZWZfJyArIGR1cGxpY2F0ZUluZGV4ICsgJyAnICsgc3RhdGUuZHVtcDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ1tvYmplY3QgQXJyYXldJykge1xuICAgICAgdmFyIGFycmF5TGV2ZWwgPSBzdGF0ZS5ub0FycmF5SW5kZW50ICYmIGxldmVsID4gMCA/IGxldmVsIC0gMSA6IGxldmVsO1xuXG4gICAgICBpZiAoYmxvY2sgJiYgc3RhdGUuZHVtcC5sZW5ndGggIT09IDApIHtcbiAgICAgICAgd3JpdGVCbG9ja1NlcXVlbmNlKHN0YXRlLCBhcnJheUxldmVsLCBzdGF0ZS5kdW1wLCBjb21wYWN0KTtcblxuICAgICAgICBpZiAoZHVwbGljYXRlKSB7XG4gICAgICAgICAgc3RhdGUuZHVtcCA9ICcmcmVmXycgKyBkdXBsaWNhdGVJbmRleCArIHN0YXRlLmR1bXA7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHdyaXRlRmxvd1NlcXVlbmNlKHN0YXRlLCBhcnJheUxldmVsLCBzdGF0ZS5kdW1wKTtcblxuICAgICAgICBpZiAoZHVwbGljYXRlKSB7XG4gICAgICAgICAgc3RhdGUuZHVtcCA9ICcmcmVmXycgKyBkdXBsaWNhdGVJbmRleCArICcgJyArIHN0YXRlLmR1bXA7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdbb2JqZWN0IFN0cmluZ10nKSB7XG4gICAgICBpZiAoc3RhdGUudGFnICE9PSAnPycpIHtcbiAgICAgICAgd3JpdGVTY2FsYXIoc3RhdGUsIHN0YXRlLmR1bXAsIGxldmVsLCBpc2tleSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChzdGF0ZS5za2lwSW52YWxpZCkgcmV0dXJuIGZhbHNlO1xuICAgICAgdGhyb3cgbmV3IGV4Y2VwdGlvbigndW5hY2NlcHRhYmxlIGtpbmQgb2YgYW4gb2JqZWN0IHRvIGR1bXAgJyArIHR5cGUpO1xuICAgIH1cblxuICAgIGlmIChzdGF0ZS50YWcgIT09IG51bGwgJiYgc3RhdGUudGFnICE9PSAnPycpIHtcbiAgICAgIHN0YXRlLmR1bXAgPSAnITwnICsgc3RhdGUudGFnICsgJz4gJyArIHN0YXRlLmR1bXA7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHRydWU7XG59XG5cbmZ1bmN0aW9uIGdldER1cGxpY2F0ZVJlZmVyZW5jZXMob2JqZWN0LCBzdGF0ZSkge1xuICB2YXIgb2JqZWN0cyA9IFtdLFxuICAgICAgZHVwbGljYXRlc0luZGV4ZXMgPSBbXSxcbiAgICAgIGluZGV4LFxuICAgICAgbGVuZ3RoO1xuICBpbnNwZWN0Tm9kZShvYmplY3QsIG9iamVjdHMsIGR1cGxpY2F0ZXNJbmRleGVzKTtcblxuICBmb3IgKGluZGV4ID0gMCwgbGVuZ3RoID0gZHVwbGljYXRlc0luZGV4ZXMubGVuZ3RoOyBpbmRleCA8IGxlbmd0aDsgaW5kZXggKz0gMSkge1xuICAgIHN0YXRlLmR1cGxpY2F0ZXMucHVzaChvYmplY3RzW2R1cGxpY2F0ZXNJbmRleGVzW2luZGV4XV0pO1xuICB9XG5cbiAgc3RhdGUudXNlZER1cGxpY2F0ZXMgPSBuZXcgQXJyYXkobGVuZ3RoKTtcbn1cblxuZnVuY3Rpb24gaW5zcGVjdE5vZGUob2JqZWN0LCBvYmplY3RzLCBkdXBsaWNhdGVzSW5kZXhlcykge1xuICB2YXIgb2JqZWN0S2V5TGlzdCwgaW5kZXgsIGxlbmd0aDtcblxuICBpZiAob2JqZWN0ICE9PSBudWxsICYmIHR5cGVvZiBvYmplY3QgPT09ICdvYmplY3QnKSB7XG4gICAgaW5kZXggPSBvYmplY3RzLmluZGV4T2Yob2JqZWN0KTtcblxuICAgIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICAgIGlmIChkdXBsaWNhdGVzSW5kZXhlcy5pbmRleE9mKGluZGV4KSA9PT0gLTEpIHtcbiAgICAgICAgZHVwbGljYXRlc0luZGV4ZXMucHVzaChpbmRleCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIG9iamVjdHMucHVzaChvYmplY3QpO1xuXG4gICAgICBpZiAoQXJyYXkuaXNBcnJheShvYmplY3QpKSB7XG4gICAgICAgIGZvciAoaW5kZXggPSAwLCBsZW5ndGggPSBvYmplY3QubGVuZ3RoOyBpbmRleCA8IGxlbmd0aDsgaW5kZXggKz0gMSkge1xuICAgICAgICAgIGluc3BlY3ROb2RlKG9iamVjdFtpbmRleF0sIG9iamVjdHMsIGR1cGxpY2F0ZXNJbmRleGVzKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgb2JqZWN0S2V5TGlzdCA9IE9iamVjdC5rZXlzKG9iamVjdCk7XG5cbiAgICAgICAgZm9yIChpbmRleCA9IDAsIGxlbmd0aCA9IG9iamVjdEtleUxpc3QubGVuZ3RoOyBpbmRleCA8IGxlbmd0aDsgaW5kZXggKz0gMSkge1xuICAgICAgICAgIGluc3BlY3ROb2RlKG9iamVjdFtvYmplY3RLZXlMaXN0W2luZGV4XV0sIG9iamVjdHMsIGR1cGxpY2F0ZXNJbmRleGVzKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBkdW1wKGlucHV0LCBvcHRpb25zKSB7XG4gIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICB2YXIgc3RhdGUgPSBuZXcgU3RhdGUkMShvcHRpb25zKTtcbiAgaWYgKCFzdGF0ZS5ub1JlZnMpIGdldER1cGxpY2F0ZVJlZmVyZW5jZXMoaW5wdXQsIHN0YXRlKTtcbiAgaWYgKHdyaXRlTm9kZShzdGF0ZSwgMCwgaW5wdXQsIHRydWUsIHRydWUpKSByZXR1cm4gc3RhdGUuZHVtcCArICdcXG4nO1xuICByZXR1cm4gJyc7XG59XG5cbmZ1bmN0aW9uIHNhZmVEdW1wKGlucHV0LCBvcHRpb25zKSB7XG4gIHJldHVybiBkdW1wKGlucHV0LCBjb21tb24uZXh0ZW5kKHtcbiAgICBzY2hlbWE6IGRlZmF1bHRfc2FmZVxuICB9LCBvcHRpb25zKSk7XG59XG5cbnZhciBkdW1wXzEgPSBkdW1wO1xudmFyIHNhZmVEdW1wXzEgPSBzYWZlRHVtcDtcbnZhciBkdW1wZXIgPSB7XG4gIGR1bXA6IGR1bXBfMSxcbiAgc2FmZUR1bXA6IHNhZmVEdW1wXzFcbn07XG5cbmZ1bmN0aW9uIGRlcHJlY2F0ZWQobmFtZSkge1xuICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgIHRocm93IG5ldyBFcnJvcignRnVuY3Rpb24gJyArIG5hbWUgKyAnIGlzIGRlcHJlY2F0ZWQgYW5kIGNhbm5vdCBiZSB1c2VkLicpO1xuICB9O1xufVxuXG52YXIgVHlwZSQxID0gdHlwZTtcbnZhciBTY2hlbWEkMSA9IHNjaGVtYTtcbnZhciBGQUlMU0FGRV9TQ0hFTUEgPSBmYWlsc2FmZTtcbnZhciBKU09OX1NDSEVNQSA9IGpzb247XG52YXIgQ09SRV9TQ0hFTUEgPSBjb3JlO1xudmFyIERFRkFVTFRfU0FGRV9TQ0hFTUEgPSBkZWZhdWx0X3NhZmU7XG52YXIgREVGQVVMVF9GVUxMX1NDSEVNQSA9IGRlZmF1bHRfZnVsbDtcbnZhciBsb2FkJDEgPSBsb2FkZXIubG9hZDtcbnZhciBsb2FkQWxsJDEgPSBsb2FkZXIubG9hZEFsbDtcbnZhciBzYWZlTG9hZCQxID0gbG9hZGVyLnNhZmVMb2FkO1xudmFyIHNhZmVMb2FkQWxsJDEgPSBsb2FkZXIuc2FmZUxvYWRBbGw7XG52YXIgZHVtcCQxID0gZHVtcGVyLmR1bXA7XG52YXIgc2FmZUR1bXAkMSA9IGR1bXBlci5zYWZlRHVtcDtcbnZhciBZQU1MRXhjZXB0aW9uJDEgPSBleGNlcHRpb247IC8vIERlcHJlY2F0ZWQgc2NoZW1hIG5hbWVzIGZyb20gSlMtWUFNTCAyLjAueFxuXG52YXIgTUlOSU1BTF9TQ0hFTUEgPSBmYWlsc2FmZTtcbnZhciBTQUZFX1NDSEVNQSA9IGRlZmF1bHRfc2FmZTtcbnZhciBERUZBVUxUX1NDSEVNQSA9IGRlZmF1bHRfZnVsbDsgLy8gRGVwcmVjYXRlZCBmdW5jdGlvbnMgZnJvbSBKUy1ZQU1MIDEueC54XG5cbnZhciBzY2FuID0gZGVwcmVjYXRlZCgnc2NhbicpO1xudmFyIHBhcnNlID0gZGVwcmVjYXRlZCgncGFyc2UnKTtcbnZhciBjb21wb3NlID0gZGVwcmVjYXRlZCgnY29tcG9zZScpO1xudmFyIGFkZENvbnN0cnVjdG9yID0gZGVwcmVjYXRlZCgnYWRkQ29uc3RydWN0b3InKTtcbnZhciBqc1lhbWwgPSB7XG4gIFR5cGU6IFR5cGUkMSxcbiAgU2NoZW1hOiBTY2hlbWEkMSxcbiAgRkFJTFNBRkVfU0NIRU1BOiBGQUlMU0FGRV9TQ0hFTUEsXG4gIEpTT05fU0NIRU1BOiBKU09OX1NDSEVNQSxcbiAgQ09SRV9TQ0hFTUE6IENPUkVfU0NIRU1BLFxuICBERUZBVUxUX1NBRkVfU0NIRU1BOiBERUZBVUxUX1NBRkVfU0NIRU1BLFxuICBERUZBVUxUX0ZVTExfU0NIRU1BOiBERUZBVUxUX0ZVTExfU0NIRU1BLFxuICBsb2FkOiBsb2FkJDEsXG4gIGxvYWRBbGw6IGxvYWRBbGwkMSxcbiAgc2FmZUxvYWQ6IHNhZmVMb2FkJDEsXG4gIHNhZmVMb2FkQWxsOiBzYWZlTG9hZEFsbCQxLFxuICBkdW1wOiBkdW1wJDEsXG4gIHNhZmVEdW1wOiBzYWZlRHVtcCQxLFxuICBZQU1MRXhjZXB0aW9uOiBZQU1MRXhjZXB0aW9uJDEsXG4gIE1JTklNQUxfU0NIRU1BOiBNSU5JTUFMX1NDSEVNQSxcbiAgU0FGRV9TQ0hFTUE6IFNBRkVfU0NIRU1BLFxuICBERUZBVUxUX1NDSEVNQTogREVGQVVMVF9TQ0hFTUEsXG4gIHNjYW46IHNjYW4sXG4gIHBhcnNlOiBwYXJzZSxcbiAgY29tcG9zZTogY29tcG9zZSxcbiAgYWRkQ29uc3RydWN0b3I6IGFkZENvbnN0cnVjdG9yXG59O1xuXG52YXIganNZYW1sJDEgPSBqc1lhbWw7XG5cbmZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgeyB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7IGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7IHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOyBpZiAoZW51bWVyYWJsZU9ubHkpIHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7IHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOyB9KTsga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOyB9IHJldHVybiBrZXlzOyB9XG5cbmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9OyBpZiAoaSAlIDIpIHsgb3duS2V5cyhPYmplY3Qoc291cmNlKSwgdHJ1ZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IGRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBzb3VyY2Vba2V5XSk7IH0pOyB9IGVsc2UgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMoc291cmNlKSk7IH0gZWxzZSB7IG93bktleXMoT2JqZWN0KHNvdXJjZSkpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsgfSk7IH0gfSByZXR1cm4gdGFyZ2V0OyB9XG4vKipcbiAqIFJlZGlyZWN0IC0gb2JqZWN0IHVzZWQgdG8gcmVkaXJlY3Qgc29tZSByZXF1ZXN0c1xuICogZS5nLlxuICoge1xuICogICAgICB0aXRsZTogMXgxLXRyYW5zcGFyZW50LmdpZlxuICogICAgICBjb21tZW50OiBodHRwOi8vcHJvYmFibHlwcm9ncmFtbWluZy5jb20vMjAwOS8wMy8xNS90aGUtdGluaWVzdC1naWYtZXZlclxuICogICAgICBjb250ZW50VHlwZTogaW1hZ2UvZ2lmO2Jhc2U2NFxuICogICAgICBjb250ZW50OiBSMGxHT0RsaEFRQUJBQUFBQUNINUJBRUtBQUVBTEFBQUFBQUJBQUVBQUFJQ1RBRUFPdz09XG4gKiB9XG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBSZWRpcmVjdFxuICogQHByb3BlcnR5IHtzdHJpbmd9IHRpdGxlXG4gKiBAcHJvcGVydHkge3N0cmluZ30gY29tbWVudFxuICogQHByb3BlcnR5IHtzdHJpbmd9IGNvbnRlbnRcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBjb250ZW50VHlwZVxuICovXG5cbnZhciBSZWRpcmVjdHMgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkge1xuICAvKipcbiAgICogQ29udmVydHMgcmF3WWFtbCBpbnRvIEpTIG9iamVjdCB3aXRoIHNvdXJjZXMgdGl0bGVzIHVzZWQgYXMga2V5c1xuICAgKiBAcGFyYW0gcmF3WWFtbFxuICAgKiBAcmV0dXJucyB7T2JqZWN0PFJlZGlyZWN0Pn0gLSByZXR1cm4gb2JqZWN0IHdpdGggdGl0bGVzIGluIHRoZSBrZXlzIGFuZCBSZWRpcmVjdFNvdXJjZXNcbiAgICogaW4gdGhlIHZhbHVlc1xuICAgKi9cbiAgZnVuY3Rpb24gUmVkaXJlY3RzKHJhd1lhbWwpIHtcbiAgICBjbGFzc0NhbGxDaGVjayh0aGlzLCBSZWRpcmVjdHMpO1xuXG4gICAgdHJ5IHtcbiAgICAgIHZhciBhcnJPZlJlZGlyZWN0cyA9IGpzWWFtbCQxLnNhZmVMb2FkKHJhd1lhbWwpO1xuICAgICAgdGhpcy5yZWRpcmVjdHMgPSBhcnJPZlJlZGlyZWN0cy5yZWR1Y2UoZnVuY3Rpb24gKGFjYywgcmVkaXJlY3QpIHtcbiAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgYWNjKSwge30sIGRlZmluZVByb3BlcnR5KHt9LCByZWRpcmVjdC50aXRsZSwgcmVkaXJlY3QpKTtcbiAgICAgIH0sIHt9KTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZVxuICAgICAgY29uc29sZS5sb2coXCJXYXMgdW5hYmxlIHRvIGxvYWQgWUFNTCBpbnRvIEpTIGR1ZSB0bzogXCIuY29uY2F0KGUubWVzc2FnZSkpO1xuICAgICAgdGhyb3cgZTtcbiAgICB9XG4gIH1cbiAgLyoqXG4gICAqIFJldHVybnMgcmVkaXJlY3Qgc291cmNlIG9iamVjdFxuICAgKiBAcGFyYW0ge3N0cmluZ30gdGl0bGVcbiAgICogQHJldHVybiB7UmVkaXJlY3R9XG4gICAqL1xuXG5cbiAgY3JlYXRlQ2xhc3MoUmVkaXJlY3RzLCBbe1xuICAgIGtleTogXCJnZXRSZWRpcmVjdFwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRSZWRpcmVjdCh0aXRsZSkge1xuICAgICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh0aGlzLnJlZGlyZWN0cywgdGl0bGUpKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlZGlyZWN0c1t0aXRsZV07XG4gICAgICB9IC8vIGxvb2sgdGl0bGUgYW1vbmcgYWxpYXNlc1xuXG5cbiAgICAgIHZhciB2YWx1ZXMgPSBPYmplY3Qua2V5cyh0aGlzLnJlZGlyZWN0cykubWFwKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgcmV0dXJuIF90aGlzLnJlZGlyZWN0c1trZXldO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gdmFsdWVzLmZpbmQoZnVuY3Rpb24gKHJlZGlyZWN0KSB7XG4gICAgICAgIHZhciBhbGlhc2VzID0gcmVkaXJlY3QuYWxpYXNlcztcblxuICAgICAgICBpZiAoIWFsaWFzZXMpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gYWxpYXNlcy5pbmRleE9mKHRpdGxlKSA+IC0xO1xuICAgICAgfSk7XG4gICAgfVxuICB9XSk7XG5cbiAgcmV0dXJuIFJlZGlyZWN0cztcbn0oKTtcblxuLyoqXG4gKiBGaW5kcyByZWRpcmVjdCByZXNvdXJjZSBieSBpdCdzIG5hbWVcbiAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gcmVkaXJlY3QgbmFtZVxuICovXG5cbnZhciBnZXRSZWRpcmVjdEJ5TmFtZSA9IGZ1bmN0aW9uIGdldFJlZGlyZWN0QnlOYW1lKG5hbWUpIHtcbiAgdmFyIHJlZGlyZWN0cyA9IE9iamVjdC5rZXlzKHJlZGlyZWN0c0xpc3QpLm1hcChmdW5jdGlvbiAoa2V5KSB7XG4gICAgcmV0dXJuIHJlZGlyZWN0c0xpc3Rba2V5XTtcbiAgfSk7XG4gIHJldHVybiByZWRpcmVjdHMuZmluZChmdW5jdGlvbiAocikge1xuICAgIHJldHVybiByLm5hbWVzICYmIHIubmFtZXMuaW5kZXhPZihuYW1lKSA+IC0xO1xuICB9KTtcbn07XG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IFNvdXJjZSAtIHJlZGlyZWN0IHByb3BlcnRpZXNcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBuYW1lIHJlZGlyZWN0IG5hbWVcbiAqIEBwcm9wZXJ0eSB7QXJyYXk8c3RyaW5nPn0gYXJncyBBcmd1bWVudHMgZm9yIHJlZGlyZWN0IGZ1bmN0aW9uXG4gKiBAcHJvcGVydHkgeydleHRlbnNpb24nfCd0ZXN0J30gW2VuZ2luZV0gLVxuICogRGVmaW5lcyB0aGUgZmluYWwgZm9ybSBvZiByZWRpcmVjdCBzdHJpbmcgcHJlc2VudGF0aW9uXG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IFt2ZXJib3NlXSBmbGFnIHRvIGVuYWJsZSBwcmludGluZyB0byBjb25zb2xlIGRlYnVnIGluZm9ybWF0aW9uXG4gKi9cblxuLyoqXG4gKiBSZXR1cm5zIHJlZGlyZWN0IGNvZGUgYnkgcGFyYW1cbiAqIEBwYXJhbSB7U291cmNlfSBzb3VyY2VcbiAqIEByZXR1cm5zIHtzdHJpbmd9IHJlZGlyZWN0IGNvZGVcbiAqL1xuXG5cbnZhciBnZXRSZWRpcmVjdENvZGUgPSBmdW5jdGlvbiBnZXRSZWRpcmVjdENvZGUoc291cmNlKSB7XG4gIHZhciByZWRpcmVjdCA9IGdldFJlZGlyZWN0QnlOYW1lKHNvdXJjZS5uYW1lKTtcbiAgdmFyIHJlc3VsdCA9IGF0dGFjaERlcGVuZGVuY2llcyhyZWRpcmVjdCk7XG4gIHJlc3VsdCA9IGFkZENhbGwocmVkaXJlY3QsIHJlc3VsdCk7IC8vIHJlZGlyZWN0IGNvZGUgZm9yIGRpZmZlcmVudCBzb3VyY2VzIGlzIGNoZWNrZWQgaW4gdGVzdHNcbiAgLy8gc28gaXQgc2hvdWxkIGJlIGp1c3QgYSBjb2RlIHdpdGhvdXQgYW55IHNvdXJjZSBhbmQgcHJvcHMgcGFzc2VkXG5cbiAgcmVzdWx0ID0gc291cmNlLmVuZ2luZSA9PT0gJ3Rlc3QnID8gd3JhcEluTm9uYW1lRnVuYyhyZXN1bHQpIDogcGFzc1NvdXJjZUFuZFByb3BzKHNvdXJjZSwgcmVzdWx0KTtcbiAgcmV0dXJuIHJlc3VsdDtcbn07XG5cbnZhciByZWRpcmVjdHNDanMgPSB7XG4gIFJlZGlyZWN0czogUmVkaXJlY3RzLFxuICBnZXRDb2RlOiBnZXRSZWRpcmVjdENvZGUsXG4gIGlzQWRnUmVkaXJlY3RSdWxlOiB2YWxpZGF0b3IuaXNBZGdSZWRpcmVjdFJ1bGUsXG4gIGlzVmFsaWRBZGdSZWRpcmVjdFJ1bGU6IHZhbGlkYXRvci5pc1ZhbGlkQWRnUmVkaXJlY3RSdWxlLFxuICBpc0FkZ1JlZGlyZWN0Q29tcGF0aWJsZVdpdGhVYm86IHZhbGlkYXRvci5pc0FkZ1JlZGlyZWN0Q29tcGF0aWJsZVdpdGhVYm8sXG4gIGlzVWJvUmVkaXJlY3RDb21wYXRpYmxlV2l0aEFkZzogdmFsaWRhdG9yLmlzVWJvUmVkaXJlY3RDb21wYXRpYmxlV2l0aEFkZyxcbiAgaXNBYnBSZWRpcmVjdENvbXBhdGlibGVXaXRoQWRnOiB2YWxpZGF0b3IuaXNBYnBSZWRpcmVjdENvbXBhdGlibGVXaXRoQWRnLFxuICBjb252ZXJ0VWJvUmVkaXJlY3RUb0FkZzogY29udmVydFVib1JlZGlyZWN0VG9BZGcsXG4gIGNvbnZlcnRBYnBSZWRpcmVjdFRvQWRnOiBjb252ZXJ0QWJwUmVkaXJlY3RUb0FkZyxcbiAgY29udmVydFJlZGlyZWN0VG9BZGc6IGNvbnZlcnRSZWRpcmVjdFRvQWRnLFxuICBjb252ZXJ0QWRnUmVkaXJlY3RUb1VibzogY29udmVydEFkZ1JlZGlyZWN0VG9VYm9cbn07XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gU291cmNlIC0gc2NyaXB0bGV0IHByb3BlcnRpZXNcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBuYW1lIFNjcmlwdGxldCBuYW1lXG4gKiBAcHJvcGVydHkge0FycmF5PHN0cmluZz59IGFyZ3MgQXJndW1lbnRzIGZvciBzY3JpcHRsZXQgZnVuY3Rpb25cbiAqIEBwcm9wZXJ0eSB7J2V4dGVuc2lvbid8J2NvcmVsaWJzJ3wndGVzdCd9IGVuZ2luZSAtXG4gKiBEZWZpbmVzIHRoZSBmaW5hbCBmb3JtIG9mIHNjcmlwdGxldCBzdHJpbmcgcHJlc2VudGF0aW9uXG4gKiBAcHJvcGVydHkge3N0cmluZ30gW3ZlcnNpb25dXG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IFt2ZXJib3NlXSBmbGFnIHRvIGVuYWJsZSBwcmludGluZyB0byBjb25zb2xlIGRlYnVnIGluZm9ybWF0aW9uXG4gKiBAcHJvcGVydHkge3N0cmluZ30gW3J1bGVUZXh0XSBTb3VyY2UgcnVsZSB0ZXh0IGlzIHVzZWQgZm9yIGRlYnVnZ2luZyBwdXJwb3Nlc1xuICogQHByb3BlcnR5IHtzdHJpbmd9IFtkb21haW5OYW1lXSBkb21haW4gbmFtZSB3aGVyZSBzY3JpcHRsZXQgaXMgYXBwbGllZDsgZm9yIGRlYnVnZ2luZyBwdXJwb3Nlc1xuICovXG5cbi8qKlxuICogUmV0dXJucyBzY3JpcHRsZXQgY29kZSBieSBwYXJhbVxuICogQHBhcmFtIHtTb3VyY2V9IHNvdXJjZVxuICogQHJldHVybnMge3N0cmluZ30gc2NyaXB0bGV0IGNvZGVcbiAqL1xuXG5mdW5jdGlvbiBnZXRTY3JpcHRsZXRDb2RlKHNvdXJjZSkge1xuICBpZiAoIXZhbGlkYXRvci5pc1ZhbGlkU2NyaXB0bGV0TmFtZShzb3VyY2UubmFtZSkpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIHZhciBzY3JpcHRsZXQgPSB2YWxpZGF0b3IuZ2V0U2NyaXB0bGV0QnlOYW1lKHNvdXJjZS5uYW1lKTtcbiAgdmFyIHJlc3VsdCA9IGF0dGFjaERlcGVuZGVuY2llcyhzY3JpcHRsZXQpO1xuICByZXN1bHQgPSBhZGRDYWxsKHNjcmlwdGxldCwgcmVzdWx0KTtcbiAgcmVzdWx0ID0gc291cmNlLmVuZ2luZSA9PT0gJ2NvcmVsaWJzJyB8fCBzb3VyY2UuZW5naW5lID09PSAndGVzdCcgPyB3cmFwSW5Ob25hbWVGdW5jKHJlc3VsdCkgOiBwYXNzU291cmNlQW5kUHJvcHMoc291cmNlLCByZXN1bHQpO1xuICByZXR1cm4gcmVzdWx0O1xufVxuLyoqXG4gKiBTY3JpcHRsZXRzIHZhcmlhYmxlXG4gKlxuICogQHJldHVybnMge09iamVjdH0gb2JqZWN0IHdpdGggbWV0aG9kczpcbiAqIGBpbnZva2VgIG1ldGhvZCByZWNlaXZlcyBvbmUgYXJndW1lbnQgd2l0aCBgU291cmNlYCB0eXBlXG4gKiBgdmFsaWRhdGVgIG1ldGhvZCByZWNlaXZlcyBvbmUgYXJndW1lbnQgd2l0aCBgU3RyaW5nYCB0eXBlXG4gKi9cblxuXG52YXIgc2NyaXB0bGV0c09iamVjdCA9IGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIHtcbiAgICBpbnZva2U6IGdldFNjcmlwdGxldENvZGUsXG4gICAgaXNWYWxpZFNjcmlwdGxldE5hbWU6IHZhbGlkYXRvci5pc1ZhbGlkU2NyaXB0bGV0TmFtZSxcbiAgICBpc1ZhbGlkU2NyaXB0bGV0UnVsZTogaXNWYWxpZFNjcmlwdGxldFJ1bGUsXG4gICAgaXNBZGdTY3JpcHRsZXRSdWxlOiB2YWxpZGF0b3IuaXNBZGdTY3JpcHRsZXRSdWxlLFxuICAgIGlzVWJvU2NyaXB0bGV0UnVsZTogdmFsaWRhdG9yLmlzVWJvU2NyaXB0bGV0UnVsZSxcbiAgICBpc0FicFNuaXBwZXRSdWxlOiB2YWxpZGF0b3IuaXNBYnBTbmlwcGV0UnVsZSxcbiAgICBjb252ZXJ0VWJvVG9BZGc6IGNvbnZlcnRVYm9TY3JpcHRsZXRUb0FkZyxcbiAgICBjb252ZXJ0QWJwVG9BZGc6IGNvbnZlcnRBYnBTbmlwcGV0VG9BZGcsXG4gICAgY29udmVydFNjcmlwdGxldFRvQWRnOiBjb252ZXJ0U2NyaXB0bGV0VG9BZGcsXG4gICAgY29udmVydEFkZ1RvVWJvOiBjb252ZXJ0QWRnU2NyaXB0bGV0VG9VYm8sXG4gICAgcmVkaXJlY3RzOiByZWRpcmVjdHNDanNcbiAgfTtcbn0oKTtcblxuLyoqXG4gKiBBZGQgbW9kdWxlIGV4cG9ydHMgdG8gYmUgdXNlZCBhcyBub2RlIHBhY2thZ2VcbiAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IHNjcmlwdGxldHNPYmplY3Q7XG5cbi8qKlxuICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICogfCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfFxuICogfCAgSWYgeW91IHdhbnQgdG8gYWRkIHlvdXIgb3duIHNjcmlwdGxldCAgfFxuICogfCAgcGxlYXNlIHB1dCB5b3VyIGNvZGUgYmVsb3cgICAgICAgICAgICAgfFxuICogfCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfFxuICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICovXG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcblxuZXhwb3J0cy5icm93c2VyID0gcmVxdWlyZShcIndlYmV4dGVuc2lvbi1wb2x5ZmlsbFwiKTtcbiIsIihmdW5jdGlvbiAoZ2xvYmFsLCBmYWN0b3J5KSB7XG4gIGlmICh0eXBlb2YgZGVmaW5lID09PSBcImZ1bmN0aW9uXCIgJiYgZGVmaW5lLmFtZCkge1xuICAgIGRlZmluZShcIndlYmV4dGVuc2lvbi1wb2x5ZmlsbFwiLCBbXCJtb2R1bGVcIl0sIGZhY3RvcnkpO1xuICB9IGVsc2UgaWYgKHR5cGVvZiBleHBvcnRzICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgZmFjdG9yeShtb2R1bGUpO1xuICB9IGVsc2Uge1xuICAgIHZhciBtb2QgPSB7XG4gICAgICBleHBvcnRzOiB7fVxuICAgIH07XG4gICAgZmFjdG9yeShtb2QpO1xuICAgIGdsb2JhbC5icm93c2VyID0gbW9kLmV4cG9ydHM7XG4gIH1cbn0pKHR5cGVvZiBnbG9iYWxUaGlzICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsVGhpcyA6IHR5cGVvZiBzZWxmICE9PSBcInVuZGVmaW5lZFwiID8gc2VsZiA6IHRoaXMsIGZ1bmN0aW9uIChtb2R1bGUpIHtcbiAgLyogd2ViZXh0ZW5zaW9uLXBvbHlmaWxsIC0gdjAuNy4wIC0gVHVlIE5vdiAxMCAyMDIwIDIwOjI0OjA0ICovXG5cbiAgLyogLSotIE1vZGU6IGluZGVudC10YWJzLW1vZGU6IG5pbDsganMtaW5kZW50LWxldmVsOiAyIC0qLSAqL1xuXG4gIC8qIHZpbTogc2V0IHN0cz0yIHN3PTIgZXQgdHc9ODA6ICovXG5cbiAgLyogVGhpcyBTb3VyY2UgQ29kZSBGb3JtIGlzIHN1YmplY3QgdG8gdGhlIHRlcm1zIG9mIHRoZSBNb3ppbGxhIFB1YmxpY1xuICAgKiBMaWNlbnNlLCB2LiAyLjAuIElmIGEgY29weSBvZiB0aGUgTVBMIHdhcyBub3QgZGlzdHJpYnV0ZWQgd2l0aCB0aGlzXG4gICAqIGZpbGUsIFlvdSBjYW4gb2J0YWluIG9uZSBhdCBodHRwOi8vbW96aWxsYS5vcmcvTVBMLzIuMC8uICovXG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIGlmICh0eXBlb2YgYnJvd3NlciA9PT0gXCJ1bmRlZmluZWRcIiB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2YoYnJvd3NlcikgIT09IE9iamVjdC5wcm90b3R5cGUpIHtcbiAgICBjb25zdCBDSFJPTUVfU0VORF9NRVNTQUdFX0NBTExCQUNLX05PX1JFU1BPTlNFX01FU1NBR0UgPSBcIlRoZSBtZXNzYWdlIHBvcnQgY2xvc2VkIGJlZm9yZSBhIHJlc3BvbnNlIHdhcyByZWNlaXZlZC5cIjtcbiAgICBjb25zdCBTRU5EX1JFU1BPTlNFX0RFUFJFQ0FUSU9OX1dBUk5JTkcgPSBcIlJldHVybmluZyBhIFByb21pc2UgaXMgdGhlIHByZWZlcnJlZCB3YXkgdG8gc2VuZCBhIHJlcGx5IGZyb20gYW4gb25NZXNzYWdlL29uTWVzc2FnZUV4dGVybmFsIGxpc3RlbmVyLCBhcyB0aGUgc2VuZFJlc3BvbnNlIHdpbGwgYmUgcmVtb3ZlZCBmcm9tIHRoZSBzcGVjcyAoU2VlIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2RvY3MvTW96aWxsYS9BZGQtb25zL1dlYkV4dGVuc2lvbnMvQVBJL3J1bnRpbWUvb25NZXNzYWdlKVwiOyAvLyBXcmFwcGluZyB0aGUgYnVsayBvZiB0aGlzIHBvbHlmaWxsIGluIGEgb25lLXRpbWUtdXNlIGZ1bmN0aW9uIGlzIGEgbWlub3JcbiAgICAvLyBvcHRpbWl6YXRpb24gZm9yIEZpcmVmb3guIFNpbmNlIFNwaWRlcm1vbmtleSBkb2VzIG5vdCBmdWxseSBwYXJzZSB0aGVcbiAgICAvLyBjb250ZW50cyBvZiBhIGZ1bmN0aW9uIHVudGlsIHRoZSBmaXJzdCB0aW1lIGl0J3MgY2FsbGVkLCBhbmQgc2luY2UgaXQgd2lsbFxuICAgIC8vIG5ldmVyIGFjdHVhbGx5IG5lZWQgdG8gYmUgY2FsbGVkLCB0aGlzIGFsbG93cyB0aGUgcG9seWZpbGwgdG8gYmUgaW5jbHVkZWRcbiAgICAvLyBpbiBGaXJlZm94IG5lYXJseSBmb3IgZnJlZS5cblxuICAgIGNvbnN0IHdyYXBBUElzID0gZXh0ZW5zaW9uQVBJcyA9PiB7XG4gICAgICAvLyBOT1RFOiBhcGlNZXRhZGF0YSBpcyBhc3NvY2lhdGVkIHRvIHRoZSBjb250ZW50IG9mIHRoZSBhcGktbWV0YWRhdGEuanNvbiBmaWxlXG4gICAgICAvLyBhdCBidWlsZCB0aW1lIGJ5IHJlcGxhY2luZyB0aGUgZm9sbG93aW5nIFwiaW5jbHVkZVwiIHdpdGggdGhlIGNvbnRlbnQgb2YgdGhlXG4gICAgICAvLyBKU09OIGZpbGUuXG4gICAgICBjb25zdCBhcGlNZXRhZGF0YSA9IHtcbiAgICAgICAgXCJhbGFybXNcIjoge1xuICAgICAgICAgIFwiY2xlYXJcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDAsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJjbGVhckFsbFwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAwXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImdldFwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImdldEFsbFwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAwXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBcImJvb2ttYXJrc1wiOiB7XG4gICAgICAgICAgXCJjcmVhdGVcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJnZXRcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJnZXRDaGlsZHJlblwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImdldFJlY2VudFwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImdldFN1YlRyZWVcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJnZXRUcmVlXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAwLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDBcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwibW92ZVwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMixcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAyXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInJlbW92ZVwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInJlbW92ZVRyZWVcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJzZWFyY2hcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJ1cGRhdGVcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDIsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMlxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgXCJicm93c2VyQWN0aW9uXCI6IHtcbiAgICAgICAgICBcImRpc2FibGVcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDAsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwiZmFsbGJhY2tUb05vQ2FsbGJhY2tcIjogdHJ1ZVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJlbmFibGVcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDAsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwiZmFsbGJhY2tUb05vQ2FsbGJhY2tcIjogdHJ1ZVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJnZXRCYWRnZUJhY2tncm91bmRDb2xvclwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImdldEJhZGdlVGV4dFwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImdldFBvcHVwXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiZ2V0VGl0bGVcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJvcGVuUG9wdXBcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDAsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMFxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJzZXRCYWRnZUJhY2tncm91bmRDb2xvclwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJmYWxsYmFja1RvTm9DYWxsYmFja1wiOiB0cnVlXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInNldEJhZGdlVGV4dFwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJmYWxsYmFja1RvTm9DYWxsYmFja1wiOiB0cnVlXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInNldEljb25cIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJzZXRQb3B1cFwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJmYWxsYmFja1RvTm9DYWxsYmFja1wiOiB0cnVlXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInNldFRpdGxlXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDEsXG4gICAgICAgICAgICBcImZhbGxiYWNrVG9Ob0NhbGxiYWNrXCI6IHRydWVcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIFwiYnJvd3NpbmdEYXRhXCI6IHtcbiAgICAgICAgICBcInJlbW92ZVwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMixcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAyXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInJlbW92ZUNhY2hlXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwicmVtb3ZlQ29va2llc1wiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInJlbW92ZURvd25sb2Fkc1wiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInJlbW92ZUZvcm1EYXRhXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwicmVtb3ZlSGlzdG9yeVwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInJlbW92ZUxvY2FsU3RvcmFnZVwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInJlbW92ZVBhc3N3b3Jkc1wiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInJlbW92ZVBsdWdpbkRhdGFcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJzZXR0aW5nc1wiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAwXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBcImNvbW1hbmRzXCI6IHtcbiAgICAgICAgICBcImdldEFsbFwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAwXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBcImNvbnRleHRNZW51c1wiOiB7XG4gICAgICAgICAgXCJyZW1vdmVcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJyZW1vdmVBbGxcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDAsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMFxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJ1cGRhdGVcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDIsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMlxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgXCJjb29raWVzXCI6IHtcbiAgICAgICAgICBcImdldFwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImdldEFsbFwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImdldEFsbENvb2tpZVN0b3Jlc1wiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAwXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInJlbW92ZVwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInNldFwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBcImRldnRvb2xzXCI6IHtcbiAgICAgICAgICBcImluc3BlY3RlZFdpbmRvd1wiOiB7XG4gICAgICAgICAgICBcImV2YWxcIjoge1xuICAgICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDIsXG4gICAgICAgICAgICAgIFwic2luZ2xlQ2FsbGJhY2tBcmdcIjogZmFsc2VcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIFwicGFuZWxzXCI6IHtcbiAgICAgICAgICAgIFwiY3JlYXRlXCI6IHtcbiAgICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDMsXG4gICAgICAgICAgICAgIFwibWF4QXJnc1wiOiAzLFxuICAgICAgICAgICAgICBcInNpbmdsZUNhbGxiYWNrQXJnXCI6IHRydWVcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcImVsZW1lbnRzXCI6IHtcbiAgICAgICAgICAgICAgXCJjcmVhdGVTaWRlYmFyUGFuZVwiOiB7XG4gICAgICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgXCJkb3dubG9hZHNcIjoge1xuICAgICAgICAgIFwiY2FuY2VsXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiZG93bmxvYWRcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJlcmFzZVwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImdldEZpbGVJY29uXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDJcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwib3BlblwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJmYWxsYmFja1RvTm9DYWxsYmFja1wiOiB0cnVlXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInBhdXNlXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwicmVtb3ZlRmlsZVwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInJlc3VtZVwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInNlYXJjaFwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInNob3dcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwiZmFsbGJhY2tUb05vQ2FsbGJhY2tcIjogdHJ1ZVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgXCJleHRlbnNpb25cIjoge1xuICAgICAgICAgIFwiaXNBbGxvd2VkRmlsZVNjaGVtZUFjY2Vzc1wiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAwXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImlzQWxsb3dlZEluY29nbml0b0FjY2Vzc1wiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAwXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBcImhpc3RvcnlcIjoge1xuICAgICAgICAgIFwiYWRkVXJsXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiZGVsZXRlQWxsXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAwLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDBcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiZGVsZXRlUmFuZ2VcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJkZWxldGVVcmxcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJnZXRWaXNpdHNcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJzZWFyY2hcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgXCJpMThuXCI6IHtcbiAgICAgICAgICBcImRldGVjdExhbmd1YWdlXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiZ2V0QWNjZXB0TGFuZ3VhZ2VzXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAwLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDBcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIFwiaWRlbnRpdHlcIjoge1xuICAgICAgICAgIFwibGF1bmNoV2ViQXV0aEZsb3dcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgXCJpZGxlXCI6IHtcbiAgICAgICAgICBcInF1ZXJ5U3RhdGVcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgXCJtYW5hZ2VtZW50XCI6IHtcbiAgICAgICAgICBcImdldFwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImdldEFsbFwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAwXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImdldFNlbGZcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDAsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMFxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJzZXRFbmFibGVkXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAyLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDJcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwidW5pbnN0YWxsU2VsZlwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBcIm5vdGlmaWNhdGlvbnNcIjoge1xuICAgICAgICAgIFwiY2xlYXJcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJjcmVhdGVcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMlxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJnZXRBbGxcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDAsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMFxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJnZXRQZXJtaXNzaW9uTGV2ZWxcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDAsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMFxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJ1cGRhdGVcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDIsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMlxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgXCJwYWdlQWN0aW9uXCI6IHtcbiAgICAgICAgICBcImdldFBvcHVwXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiZ2V0VGl0bGVcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJoaWRlXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDEsXG4gICAgICAgICAgICBcImZhbGxiYWNrVG9Ob0NhbGxiYWNrXCI6IHRydWVcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwic2V0SWNvblwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInNldFBvcHVwXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDEsXG4gICAgICAgICAgICBcImZhbGxiYWNrVG9Ob0NhbGxiYWNrXCI6IHRydWVcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwic2V0VGl0bGVcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwiZmFsbGJhY2tUb05vQ2FsbGJhY2tcIjogdHJ1ZVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJzaG93XCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDEsXG4gICAgICAgICAgICBcImZhbGxiYWNrVG9Ob0NhbGxiYWNrXCI6IHRydWVcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIFwicGVybWlzc2lvbnNcIjoge1xuICAgICAgICAgIFwiY29udGFpbnNcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJnZXRBbGxcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDAsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMFxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJyZW1vdmVcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJyZXF1ZXN0XCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIFwicnVudGltZVwiOiB7XG4gICAgICAgICAgXCJnZXRCYWNrZ3JvdW5kUGFnZVwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAwXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImdldFBsYXRmb3JtSW5mb1wiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAwXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcIm9wZW5PcHRpb25zUGFnZVwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAwXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInJlcXVlc3RVcGRhdGVDaGVja1wiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAwXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInNlbmRNZXNzYWdlXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDNcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwic2VuZE5hdGl2ZU1lc3NhZ2VcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDIsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMlxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJzZXRVbmluc3RhbGxVUkxcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgXCJzZXNzaW9uc1wiOiB7XG4gICAgICAgICAgXCJnZXREZXZpY2VzXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAwLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiZ2V0UmVjZW50bHlDbG9zZWRcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDAsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJyZXN0b3JlXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAwLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIFwic3RvcmFnZVwiOiB7XG4gICAgICAgICAgXCJsb2NhbFwiOiB7XG4gICAgICAgICAgICBcImNsZWFyXCI6IHtcbiAgICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDAsXG4gICAgICAgICAgICAgIFwibWF4QXJnc1wiOiAwXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJnZXRcIjoge1xuICAgICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcImdldEJ5dGVzSW5Vc2VcIjoge1xuICAgICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcInJlbW92ZVwiOiB7XG4gICAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwic2V0XCI6IHtcbiAgICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBcIm1hbmFnZWRcIjoge1xuICAgICAgICAgICAgXCJnZXRcIjoge1xuICAgICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcImdldEJ5dGVzSW5Vc2VcIjoge1xuICAgICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIFwic3luY1wiOiB7XG4gICAgICAgICAgICBcImNsZWFyXCI6IHtcbiAgICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDAsXG4gICAgICAgICAgICAgIFwibWF4QXJnc1wiOiAwXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJnZXRcIjoge1xuICAgICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcImdldEJ5dGVzSW5Vc2VcIjoge1xuICAgICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcInJlbW92ZVwiOiB7XG4gICAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwic2V0XCI6IHtcbiAgICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBcInRhYnNcIjoge1xuICAgICAgICAgIFwiY2FwdHVyZVZpc2libGVUYWJcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDAsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMlxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJjcmVhdGVcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJkZXRlY3RMYW5ndWFnZVwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImRpc2NhcmRcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDAsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJkdXBsaWNhdGVcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJleGVjdXRlU2NyaXB0XCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDJcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiZ2V0XCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiZ2V0Q3VycmVudFwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMCxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAwXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImdldFpvb21cIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDAsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJnZXRab29tU2V0dGluZ3NcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDAsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJnb0JhY2tcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDAsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJnb0ZvcndhcmRcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDAsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJoaWdobGlnaHRcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJpbnNlcnRDU1NcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMlxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJtb3ZlXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAyLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDJcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwicXVlcnlcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJyZWxvYWRcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDAsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMlxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJyZW1vdmVcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJyZW1vdmVDU1NcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMlxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJzZW5kTWVzc2FnZVwiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMixcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAzXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInNldFpvb21cIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMlxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJzZXRab29tU2V0dGluZ3NcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMlxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJ1cGRhdGVcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMlxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgXCJ0b3BTaXRlc1wiOiB7XG4gICAgICAgICAgXCJnZXRcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDAsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMFxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgXCJ3ZWJOYXZpZ2F0aW9uXCI6IHtcbiAgICAgICAgICBcImdldEFsbEZyYW1lc1wiOiB7XG4gICAgICAgICAgICBcIm1pbkFyZ3NcIjogMSxcbiAgICAgICAgICAgIFwibWF4QXJnc1wiOiAxXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImdldEZyYW1lXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAxLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIFwid2ViUmVxdWVzdFwiOiB7XG4gICAgICAgICAgXCJoYW5kbGVyQmVoYXZpb3JDaGFuZ2VkXCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAwLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDBcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIFwid2luZG93c1wiOiB7XG4gICAgICAgICAgXCJjcmVhdGVcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDAsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJnZXRcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMlxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJnZXRBbGxcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDAsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJnZXRDdXJyZW50XCI6IHtcbiAgICAgICAgICAgIFwibWluQXJnc1wiOiAwLFxuICAgICAgICAgICAgXCJtYXhBcmdzXCI6IDFcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiZ2V0TGFzdEZvY3VzZWRcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDAsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJyZW1vdmVcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDEsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJ1cGRhdGVcIjoge1xuICAgICAgICAgICAgXCJtaW5BcmdzXCI6IDIsXG4gICAgICAgICAgICBcIm1heEFyZ3NcIjogMlxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgaWYgKE9iamVjdC5rZXlzKGFwaU1ldGFkYXRhKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiYXBpLW1ldGFkYXRhLmpzb24gaGFzIG5vdCBiZWVuIGluY2x1ZGVkIGluIGJyb3dzZXItcG9seWZpbGxcIik7XG4gICAgICB9XG4gICAgICAvKipcbiAgICAgICAqIEEgV2Vha01hcCBzdWJjbGFzcyB3aGljaCBjcmVhdGVzIGFuZCBzdG9yZXMgYSB2YWx1ZSBmb3IgYW55IGtleSB3aGljaCBkb2VzXG4gICAgICAgKiBub3QgZXhpc3Qgd2hlbiBhY2Nlc3NlZCwgYnV0IGJlaGF2ZXMgZXhhY3RseSBhcyBhbiBvcmRpbmFyeSBXZWFrTWFwXG4gICAgICAgKiBvdGhlcndpc2UuXG4gICAgICAgKlxuICAgICAgICogQHBhcmFtIHtmdW5jdGlvbn0gY3JlYXRlSXRlbVxuICAgICAgICogICAgICAgIEEgZnVuY3Rpb24gd2hpY2ggd2lsbCBiZSBjYWxsZWQgaW4gb3JkZXIgdG8gY3JlYXRlIHRoZSB2YWx1ZSBmb3IgYW55XG4gICAgICAgKiAgICAgICAga2V5IHdoaWNoIGRvZXMgbm90IGV4aXN0LCB0aGUgZmlyc3QgdGltZSBpdCBpcyBhY2Nlc3NlZC4gVGhlXG4gICAgICAgKiAgICAgICAgZnVuY3Rpb24gcmVjZWl2ZXMsIGFzIGl0cyBvbmx5IGFyZ3VtZW50LCB0aGUga2V5IGJlaW5nIGNyZWF0ZWQuXG4gICAgICAgKi9cblxuXG4gICAgICBjbGFzcyBEZWZhdWx0V2Vha01hcCBleHRlbmRzIFdlYWtNYXAge1xuICAgICAgICBjb25zdHJ1Y3RvcihjcmVhdGVJdGVtLCBpdGVtcyA9IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHN1cGVyKGl0ZW1zKTtcbiAgICAgICAgICB0aGlzLmNyZWF0ZUl0ZW0gPSBjcmVhdGVJdGVtO1xuICAgICAgICB9XG5cbiAgICAgICAgZ2V0KGtleSkge1xuICAgICAgICAgIGlmICghdGhpcy5oYXMoa2V5KSkge1xuICAgICAgICAgICAgdGhpcy5zZXQoa2V5LCB0aGlzLmNyZWF0ZUl0ZW0oa2V5KSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIHN1cGVyLmdldChrZXkpO1xuICAgICAgICB9XG5cbiAgICAgIH1cbiAgICAgIC8qKlxuICAgICAgICogUmV0dXJucyB0cnVlIGlmIHRoZSBnaXZlbiBvYmplY3QgaXMgYW4gb2JqZWN0IHdpdGggYSBgdGhlbmAgbWV0aG9kLCBhbmQgY2FuXG4gICAgICAgKiB0aGVyZWZvcmUgYmUgYXNzdW1lZCB0byBiZWhhdmUgYXMgYSBQcm9taXNlLlxuICAgICAgICpcbiAgICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHRlc3QuXG4gICAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgdmFsdWUgaXMgdGhlbmFibGUuXG4gICAgICAgKi9cblxuXG4gICAgICBjb25zdCBpc1RoZW5hYmxlID0gdmFsdWUgPT4ge1xuICAgICAgICByZXR1cm4gdmFsdWUgJiYgdHlwZW9mIHZhbHVlID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiB2YWx1ZS50aGVuID09PSBcImZ1bmN0aW9uXCI7XG4gICAgICB9O1xuICAgICAgLyoqXG4gICAgICAgKiBDcmVhdGVzIGFuZCByZXR1cm5zIGEgZnVuY3Rpb24gd2hpY2gsIHdoZW4gY2FsbGVkLCB3aWxsIHJlc29sdmUgb3IgcmVqZWN0XG4gICAgICAgKiB0aGUgZ2l2ZW4gcHJvbWlzZSBiYXNlZCBvbiBob3cgaXQgaXMgY2FsbGVkOlxuICAgICAgICpcbiAgICAgICAqIC0gSWYsIHdoZW4gY2FsbGVkLCBgY2hyb21lLnJ1bnRpbWUubGFzdEVycm9yYCBjb250YWlucyBhIG5vbi1udWxsIG9iamVjdCxcbiAgICAgICAqICAgdGhlIHByb21pc2UgaXMgcmVqZWN0ZWQgd2l0aCB0aGF0IHZhbHVlLlxuICAgICAgICogLSBJZiB0aGUgZnVuY3Rpb24gaXMgY2FsbGVkIHdpdGggZXhhY3RseSBvbmUgYXJndW1lbnQsIHRoZSBwcm9taXNlIGlzXG4gICAgICAgKiAgIHJlc29sdmVkIHRvIHRoYXQgdmFsdWUuXG4gICAgICAgKiAtIE90aGVyd2lzZSwgdGhlIHByb21pc2UgaXMgcmVzb2x2ZWQgdG8gYW4gYXJyYXkgY29udGFpbmluZyBhbGwgb2YgdGhlXG4gICAgICAgKiAgIGZ1bmN0aW9uJ3MgYXJndW1lbnRzLlxuICAgICAgICpcbiAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSBwcm9taXNlXG4gICAgICAgKiAgICAgICAgQW4gb2JqZWN0IGNvbnRhaW5pbmcgdGhlIHJlc29sdXRpb24gYW5kIHJlamVjdGlvbiBmdW5jdGlvbnMgb2YgYVxuICAgICAgICogICAgICAgIHByb21pc2UuXG4gICAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBwcm9taXNlLnJlc29sdmVcbiAgICAgICAqICAgICAgICBUaGUgcHJvbWlzZSdzIHJlc29sdXRpb24gZnVuY3Rpb24uXG4gICAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBwcm9taXNlLnJlamVjdGlvblxuICAgICAgICogICAgICAgIFRoZSBwcm9taXNlJ3MgcmVqZWN0aW9uIGZ1bmN0aW9uLlxuICAgICAgICogQHBhcmFtIHtvYmplY3R9IG1ldGFkYXRhXG4gICAgICAgKiAgICAgICAgTWV0YWRhdGEgYWJvdXQgdGhlIHdyYXBwZWQgbWV0aG9kIHdoaWNoIGhhcyBjcmVhdGVkIHRoZSBjYWxsYmFjay5cbiAgICAgICAqIEBwYXJhbSB7aW50ZWdlcn0gbWV0YWRhdGEubWF4UmVzb2x2ZWRBcmdzXG4gICAgICAgKiAgICAgICAgVGhlIG1heGltdW0gbnVtYmVyIG9mIGFyZ3VtZW50cyB3aGljaCBtYXkgYmUgcGFzc2VkIHRvIHRoZVxuICAgICAgICogICAgICAgIGNhbGxiYWNrIGNyZWF0ZWQgYnkgdGhlIHdyYXBwZWQgYXN5bmMgZnVuY3Rpb24uXG4gICAgICAgKlxuICAgICAgICogQHJldHVybnMge2Z1bmN0aW9ufVxuICAgICAgICogICAgICAgIFRoZSBnZW5lcmF0ZWQgY2FsbGJhY2sgZnVuY3Rpb24uXG4gICAgICAgKi9cblxuXG4gICAgICBjb25zdCBtYWtlQ2FsbGJhY2sgPSAocHJvbWlzZSwgbWV0YWRhdGEpID0+IHtcbiAgICAgICAgcmV0dXJuICguLi5jYWxsYmFja0FyZ3MpID0+IHtcbiAgICAgICAgICBpZiAoZXh0ZW5zaW9uQVBJcy5ydW50aW1lLmxhc3RFcnJvcikge1xuICAgICAgICAgICAgcHJvbWlzZS5yZWplY3QoZXh0ZW5zaW9uQVBJcy5ydW50aW1lLmxhc3RFcnJvcik7XG4gICAgICAgICAgfSBlbHNlIGlmIChtZXRhZGF0YS5zaW5nbGVDYWxsYmFja0FyZyB8fCBjYWxsYmFja0FyZ3MubGVuZ3RoIDw9IDEgJiYgbWV0YWRhdGEuc2luZ2xlQ2FsbGJhY2tBcmcgIT09IGZhbHNlKSB7XG4gICAgICAgICAgICBwcm9taXNlLnJlc29sdmUoY2FsbGJhY2tBcmdzWzBdKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcHJvbWlzZS5yZXNvbHZlKGNhbGxiYWNrQXJncyk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfTtcblxuICAgICAgY29uc3QgcGx1cmFsaXplQXJndW1lbnRzID0gbnVtQXJncyA9PiBudW1BcmdzID09IDEgPyBcImFyZ3VtZW50XCIgOiBcImFyZ3VtZW50c1wiO1xuICAgICAgLyoqXG4gICAgICAgKiBDcmVhdGVzIGEgd3JhcHBlciBmdW5jdGlvbiBmb3IgYSBtZXRob2Qgd2l0aCB0aGUgZ2l2ZW4gbmFtZSBhbmQgbWV0YWRhdGEuXG4gICAgICAgKlxuICAgICAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWVcbiAgICAgICAqICAgICAgICBUaGUgbmFtZSBvZiB0aGUgbWV0aG9kIHdoaWNoIGlzIGJlaW5nIHdyYXBwZWQuXG4gICAgICAgKiBAcGFyYW0ge29iamVjdH0gbWV0YWRhdGFcbiAgICAgICAqICAgICAgICBNZXRhZGF0YSBhYm91dCB0aGUgbWV0aG9kIGJlaW5nIHdyYXBwZWQuXG4gICAgICAgKiBAcGFyYW0ge2ludGVnZXJ9IG1ldGFkYXRhLm1pbkFyZ3NcbiAgICAgICAqICAgICAgICBUaGUgbWluaW11bSBudW1iZXIgb2YgYXJndW1lbnRzIHdoaWNoIG11c3QgYmUgcGFzc2VkIHRvIHRoZVxuICAgICAgICogICAgICAgIGZ1bmN0aW9uLiBJZiBjYWxsZWQgd2l0aCBmZXdlciB0aGFuIHRoaXMgbnVtYmVyIG9mIGFyZ3VtZW50cywgdGhlXG4gICAgICAgKiAgICAgICAgd3JhcHBlciB3aWxsIHJhaXNlIGFuIGV4Y2VwdGlvbi5cbiAgICAgICAqIEBwYXJhbSB7aW50ZWdlcn0gbWV0YWRhdGEubWF4QXJnc1xuICAgICAgICogICAgICAgIFRoZSBtYXhpbXVtIG51bWJlciBvZiBhcmd1bWVudHMgd2hpY2ggbWF5IGJlIHBhc3NlZCB0byB0aGVcbiAgICAgICAqICAgICAgICBmdW5jdGlvbi4gSWYgY2FsbGVkIHdpdGggbW9yZSB0aGFuIHRoaXMgbnVtYmVyIG9mIGFyZ3VtZW50cywgdGhlXG4gICAgICAgKiAgICAgICAgd3JhcHBlciB3aWxsIHJhaXNlIGFuIGV4Y2VwdGlvbi5cbiAgICAgICAqIEBwYXJhbSB7aW50ZWdlcn0gbWV0YWRhdGEubWF4UmVzb2x2ZWRBcmdzXG4gICAgICAgKiAgICAgICAgVGhlIG1heGltdW0gbnVtYmVyIG9mIGFyZ3VtZW50cyB3aGljaCBtYXkgYmUgcGFzc2VkIHRvIHRoZVxuICAgICAgICogICAgICAgIGNhbGxiYWNrIGNyZWF0ZWQgYnkgdGhlIHdyYXBwZWQgYXN5bmMgZnVuY3Rpb24uXG4gICAgICAgKlxuICAgICAgICogQHJldHVybnMge2Z1bmN0aW9uKG9iamVjdCwgLi4uKil9XG4gICAgICAgKiAgICAgICBUaGUgZ2VuZXJhdGVkIHdyYXBwZXIgZnVuY3Rpb24uXG4gICAgICAgKi9cblxuXG4gICAgICBjb25zdCB3cmFwQXN5bmNGdW5jdGlvbiA9IChuYW1lLCBtZXRhZGF0YSkgPT4ge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gYXN5bmNGdW5jdGlvbldyYXBwZXIodGFyZ2V0LCAuLi5hcmdzKSB7XG4gICAgICAgICAgaWYgKGFyZ3MubGVuZ3RoIDwgbWV0YWRhdGEubWluQXJncykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBFeHBlY3RlZCBhdCBsZWFzdCAke21ldGFkYXRhLm1pbkFyZ3N9ICR7cGx1cmFsaXplQXJndW1lbnRzKG1ldGFkYXRhLm1pbkFyZ3MpfSBmb3IgJHtuYW1lfSgpLCBnb3QgJHthcmdzLmxlbmd0aH1gKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAoYXJncy5sZW5ndGggPiBtZXRhZGF0YS5tYXhBcmdzKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEV4cGVjdGVkIGF0IG1vc3QgJHttZXRhZGF0YS5tYXhBcmdzfSAke3BsdXJhbGl6ZUFyZ3VtZW50cyhtZXRhZGF0YS5tYXhBcmdzKX0gZm9yICR7bmFtZX0oKSwgZ290ICR7YXJncy5sZW5ndGh9YCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIGlmIChtZXRhZGF0YS5mYWxsYmFja1RvTm9DYWxsYmFjaykge1xuICAgICAgICAgICAgICAvLyBUaGlzIEFQSSBtZXRob2QgaGFzIGN1cnJlbnRseSBubyBjYWxsYmFjayBvbiBDaHJvbWUsIGJ1dCBpdCByZXR1cm4gYSBwcm9taXNlIG9uIEZpcmVmb3gsXG4gICAgICAgICAgICAgIC8vIGFuZCBzbyB0aGUgcG9seWZpbGwgd2lsbCB0cnkgdG8gY2FsbCBpdCB3aXRoIGEgY2FsbGJhY2sgZmlyc3QsIGFuZCBpdCB3aWxsIGZhbGxiYWNrXG4gICAgICAgICAgICAgIC8vIHRvIG5vdCBwYXNzaW5nIHRoZSBjYWxsYmFjayBpZiB0aGUgZmlyc3QgY2FsbCBmYWlscy5cbiAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICB0YXJnZXRbbmFtZV0oLi4uYXJncywgbWFrZUNhbGxiYWNrKHtcbiAgICAgICAgICAgICAgICAgIHJlc29sdmUsXG4gICAgICAgICAgICAgICAgICByZWplY3RcbiAgICAgICAgICAgICAgICB9LCBtZXRhZGF0YSkpO1xuICAgICAgICAgICAgICB9IGNhdGNoIChjYkVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGAke25hbWV9IEFQSSBtZXRob2QgZG9lc24ndCBzZWVtIHRvIHN1cHBvcnQgdGhlIGNhbGxiYWNrIHBhcmFtZXRlciwgYCArIFwiZmFsbGluZyBiYWNrIHRvIGNhbGwgaXQgd2l0aG91dCBhIGNhbGxiYWNrOiBcIiwgY2JFcnJvcik7XG4gICAgICAgICAgICAgICAgdGFyZ2V0W25hbWVdKC4uLmFyZ3MpOyAvLyBVcGRhdGUgdGhlIEFQSSBtZXRob2QgbWV0YWRhdGEsIHNvIHRoYXQgdGhlIG5leHQgQVBJIGNhbGxzIHdpbGwgbm90IHRyeSB0b1xuICAgICAgICAgICAgICAgIC8vIHVzZSB0aGUgdW5zdXBwb3J0ZWQgY2FsbGJhY2sgYW55bW9yZS5cblxuICAgICAgICAgICAgICAgIG1ldGFkYXRhLmZhbGxiYWNrVG9Ob0NhbGxiYWNrID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgbWV0YWRhdGEubm9DYWxsYmFjayA9IHRydWU7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG1ldGFkYXRhLm5vQ2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgdGFyZ2V0W25hbWVdKC4uLmFyZ3MpO1xuICAgICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB0YXJnZXRbbmFtZV0oLi4uYXJncywgbWFrZUNhbGxiYWNrKHtcbiAgICAgICAgICAgICAgICByZXNvbHZlLFxuICAgICAgICAgICAgICAgIHJlamVjdFxuICAgICAgICAgICAgICB9LCBtZXRhZGF0YSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgfTtcbiAgICAgIC8qKlxuICAgICAgICogV3JhcHMgYW4gZXhpc3RpbmcgbWV0aG9kIG9mIHRoZSB0YXJnZXQgb2JqZWN0LCBzbyB0aGF0IGNhbGxzIHRvIGl0IGFyZVxuICAgICAgICogaW50ZXJjZXB0ZWQgYnkgdGhlIGdpdmVuIHdyYXBwZXIgZnVuY3Rpb24uIFRoZSB3cmFwcGVyIGZ1bmN0aW9uIHJlY2VpdmVzLFxuICAgICAgICogYXMgaXRzIGZpcnN0IGFyZ3VtZW50LCB0aGUgb3JpZ2luYWwgYHRhcmdldGAgb2JqZWN0LCBmb2xsb3dlZCBieSBlYWNoIG9mXG4gICAgICAgKiB0aGUgYXJndW1lbnRzIHBhc3NlZCB0byB0aGUgb3JpZ2luYWwgbWV0aG9kLlxuICAgICAgICpcbiAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSB0YXJnZXRcbiAgICAgICAqICAgICAgICBUaGUgb3JpZ2luYWwgdGFyZ2V0IG9iamVjdCB0aGF0IHRoZSB3cmFwcGVkIG1ldGhvZCBiZWxvbmdzIHRvLlxuICAgICAgICogQHBhcmFtIHtmdW5jdGlvbn0gbWV0aG9kXG4gICAgICAgKiAgICAgICAgVGhlIG1ldGhvZCBiZWluZyB3cmFwcGVkLiBUaGlzIGlzIHVzZWQgYXMgdGhlIHRhcmdldCBvZiB0aGUgUHJveHlcbiAgICAgICAqICAgICAgICBvYmplY3Qgd2hpY2ggaXMgY3JlYXRlZCB0byB3cmFwIHRoZSBtZXRob2QuXG4gICAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSB3cmFwcGVyXG4gICAgICAgKiAgICAgICAgVGhlIHdyYXBwZXIgZnVuY3Rpb24gd2hpY2ggaXMgY2FsbGVkIGluIHBsYWNlIG9mIGEgZGlyZWN0IGludm9jYXRpb25cbiAgICAgICAqICAgICAgICBvZiB0aGUgd3JhcHBlZCBtZXRob2QuXG4gICAgICAgKlxuICAgICAgICogQHJldHVybnMge1Byb3h5PGZ1bmN0aW9uPn1cbiAgICAgICAqICAgICAgICBBIFByb3h5IG9iamVjdCBmb3IgdGhlIGdpdmVuIG1ldGhvZCwgd2hpY2ggaW52b2tlcyB0aGUgZ2l2ZW4gd3JhcHBlclxuICAgICAgICogICAgICAgIG1ldGhvZCBpbiBpdHMgcGxhY2UuXG4gICAgICAgKi9cblxuXG4gICAgICBjb25zdCB3cmFwTWV0aG9kID0gKHRhcmdldCwgbWV0aG9kLCB3cmFwcGVyKSA9PiB7XG4gICAgICAgIHJldHVybiBuZXcgUHJveHkobWV0aG9kLCB7XG4gICAgICAgICAgYXBwbHkodGFyZ2V0TWV0aG9kLCB0aGlzT2JqLCBhcmdzKSB7XG4gICAgICAgICAgICByZXR1cm4gd3JhcHBlci5jYWxsKHRoaXNPYmosIHRhcmdldCwgLi4uYXJncyk7XG4gICAgICAgICAgfVxuXG4gICAgICAgIH0pO1xuICAgICAgfTtcblxuICAgICAgbGV0IGhhc093blByb3BlcnR5ID0gRnVuY3Rpb24uY2FsbC5iaW5kKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkpO1xuICAgICAgLyoqXG4gICAgICAgKiBXcmFwcyBhbiBvYmplY3QgaW4gYSBQcm94eSB3aGljaCBpbnRlcmNlcHRzIGFuZCB3cmFwcyBjZXJ0YWluIG1ldGhvZHNcbiAgICAgICAqIGJhc2VkIG9uIHRoZSBnaXZlbiBgd3JhcHBlcnNgIGFuZCBgbWV0YWRhdGFgIG9iamVjdHMuXG4gICAgICAgKlxuICAgICAgICogQHBhcmFtIHtvYmplY3R9IHRhcmdldFxuICAgICAgICogICAgICAgIFRoZSB0YXJnZXQgb2JqZWN0IHRvIHdyYXAuXG4gICAgICAgKlxuICAgICAgICogQHBhcmFtIHtvYmplY3R9IFt3cmFwcGVycyA9IHt9XVxuICAgICAgICogICAgICAgIEFuIG9iamVjdCB0cmVlIGNvbnRhaW5pbmcgd3JhcHBlciBmdW5jdGlvbnMgZm9yIHNwZWNpYWwgY2FzZXMuIEFueVxuICAgICAgICogICAgICAgIGZ1bmN0aW9uIHByZXNlbnQgaW4gdGhpcyBvYmplY3QgdHJlZSBpcyBjYWxsZWQgaW4gcGxhY2Ugb2YgdGhlXG4gICAgICAgKiAgICAgICAgbWV0aG9kIGluIHRoZSBzYW1lIGxvY2F0aW9uIGluIHRoZSBgdGFyZ2V0YCBvYmplY3QgdHJlZS4gVGhlc2VcbiAgICAgICAqICAgICAgICB3cmFwcGVyIG1ldGhvZHMgYXJlIGludm9rZWQgYXMgZGVzY3JpYmVkIGluIHtAc2VlIHdyYXBNZXRob2R9LlxuICAgICAgICpcbiAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSBbbWV0YWRhdGEgPSB7fV1cbiAgICAgICAqICAgICAgICBBbiBvYmplY3QgdHJlZSBjb250YWluaW5nIG1ldGFkYXRhIHVzZWQgdG8gYXV0b21hdGljYWxseSBnZW5lcmF0ZVxuICAgICAgICogICAgICAgIFByb21pc2UtYmFzZWQgd3JhcHBlciBmdW5jdGlvbnMgZm9yIGFzeW5jaHJvbm91cy4gQW55IGZ1bmN0aW9uIGluXG4gICAgICAgKiAgICAgICAgdGhlIGB0YXJnZXRgIG9iamVjdCB0cmVlIHdoaWNoIGhhcyBhIGNvcnJlc3BvbmRpbmcgbWV0YWRhdGEgb2JqZWN0XG4gICAgICAgKiAgICAgICAgaW4gdGhlIHNhbWUgbG9jYXRpb24gaW4gdGhlIGBtZXRhZGF0YWAgdHJlZSBpcyByZXBsYWNlZCB3aXRoIGFuXG4gICAgICAgKiAgICAgICAgYXV0b21hdGljYWxseS1nZW5lcmF0ZWQgd3JhcHBlciBmdW5jdGlvbiwgYXMgZGVzY3JpYmVkIGluXG4gICAgICAgKiAgICAgICAge0BzZWUgd3JhcEFzeW5jRnVuY3Rpb259XG4gICAgICAgKlxuICAgICAgICogQHJldHVybnMge1Byb3h5PG9iamVjdD59XG4gICAgICAgKi9cblxuICAgICAgY29uc3Qgd3JhcE9iamVjdCA9ICh0YXJnZXQsIHdyYXBwZXJzID0ge30sIG1ldGFkYXRhID0ge30pID0+IHtcbiAgICAgICAgbGV0IGNhY2hlID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICAgICAgbGV0IGhhbmRsZXJzID0ge1xuICAgICAgICAgIGhhcyhwcm94eVRhcmdldCwgcHJvcCkge1xuICAgICAgICAgICAgcmV0dXJuIHByb3AgaW4gdGFyZ2V0IHx8IHByb3AgaW4gY2FjaGU7XG4gICAgICAgICAgfSxcblxuICAgICAgICAgIGdldChwcm94eVRhcmdldCwgcHJvcCwgcmVjZWl2ZXIpIHtcbiAgICAgICAgICAgIGlmIChwcm9wIGluIGNhY2hlKSB7XG4gICAgICAgICAgICAgIHJldHVybiBjYWNoZVtwcm9wXTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCEocHJvcCBpbiB0YXJnZXQpKSB7XG4gICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGxldCB2YWx1ZSA9IHRhcmdldFtwcm9wXTtcblxuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICAgIC8vIFRoaXMgaXMgYSBtZXRob2Qgb24gdGhlIHVuZGVybHlpbmcgb2JqZWN0LiBDaGVjayBpZiB3ZSBuZWVkIHRvIGRvXG4gICAgICAgICAgICAgIC8vIGFueSB3cmFwcGluZy5cbiAgICAgICAgICAgICAgaWYgKHR5cGVvZiB3cmFwcGVyc1twcm9wXSA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICAgICAgLy8gV2UgaGF2ZSBhIHNwZWNpYWwtY2FzZSB3cmFwcGVyIGZvciB0aGlzIG1ldGhvZC5cbiAgICAgICAgICAgICAgICB2YWx1ZSA9IHdyYXBNZXRob2QodGFyZ2V0LCB0YXJnZXRbcHJvcF0sIHdyYXBwZXJzW3Byb3BdKTtcbiAgICAgICAgICAgICAgfSBlbHNlIGlmIChoYXNPd25Qcm9wZXJ0eShtZXRhZGF0YSwgcHJvcCkpIHtcbiAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIGFuIGFzeW5jIG1ldGhvZCB0aGF0IHdlIGhhdmUgbWV0YWRhdGEgZm9yLiBDcmVhdGUgYVxuICAgICAgICAgICAgICAgIC8vIFByb21pc2Ugd3JhcHBlciBmb3IgaXQuXG4gICAgICAgICAgICAgICAgbGV0IHdyYXBwZXIgPSB3cmFwQXN5bmNGdW5jdGlvbihwcm9wLCBtZXRhZGF0YVtwcm9wXSk7XG4gICAgICAgICAgICAgICAgdmFsdWUgPSB3cmFwTWV0aG9kKHRhcmdldCwgdGFyZ2V0W3Byb3BdLCB3cmFwcGVyKTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIGEgbWV0aG9kIHRoYXQgd2UgZG9uJ3Qga25vdyBvciBjYXJlIGFib3V0LiBSZXR1cm4gdGhlXG4gICAgICAgICAgICAgICAgLy8gb3JpZ2luYWwgbWV0aG9kLCBib3VuZCB0byB0aGUgdW5kZXJseWluZyBvYmplY3QuXG4gICAgICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZS5iaW5kKHRhcmdldCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSBcIm9iamVjdFwiICYmIHZhbHVlICE9PSBudWxsICYmIChoYXNPd25Qcm9wZXJ0eSh3cmFwcGVycywgcHJvcCkgfHwgaGFzT3duUHJvcGVydHkobWV0YWRhdGEsIHByb3ApKSkge1xuICAgICAgICAgICAgICAvLyBUaGlzIGlzIGFuIG9iamVjdCB0aGF0IHdlIG5lZWQgdG8gZG8gc29tZSB3cmFwcGluZyBmb3IgdGhlIGNoaWxkcmVuXG4gICAgICAgICAgICAgIC8vIG9mLiBDcmVhdGUgYSBzdWItb2JqZWN0IHdyYXBwZXIgZm9yIGl0IHdpdGggdGhlIGFwcHJvcHJpYXRlIGNoaWxkXG4gICAgICAgICAgICAgIC8vIG1ldGFkYXRhLlxuICAgICAgICAgICAgICB2YWx1ZSA9IHdyYXBPYmplY3QodmFsdWUsIHdyYXBwZXJzW3Byb3BdLCBtZXRhZGF0YVtwcm9wXSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGhhc093blByb3BlcnR5KG1ldGFkYXRhLCBcIipcIikpIHtcbiAgICAgICAgICAgICAgLy8gV3JhcCBhbGwgcHJvcGVydGllcyBpbiAqIG5hbWVzcGFjZS5cbiAgICAgICAgICAgICAgdmFsdWUgPSB3cmFwT2JqZWN0KHZhbHVlLCB3cmFwcGVyc1twcm9wXSwgbWV0YWRhdGFbXCIqXCJdKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIC8vIFdlIGRvbid0IG5lZWQgdG8gZG8gYW55IHdyYXBwaW5nIGZvciB0aGlzIHByb3BlcnR5LFxuICAgICAgICAgICAgICAvLyBzbyBqdXN0IGZvcndhcmQgYWxsIGFjY2VzcyB0byB0aGUgdW5kZXJseWluZyBvYmplY3QuXG4gICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjYWNoZSwgcHJvcCwge1xuICAgICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuXG4gICAgICAgICAgICAgICAgZ2V0KCkge1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIHRhcmdldFtwcm9wXTtcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgc2V0KHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICB0YXJnZXRbcHJvcF0gPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY2FjaGVbcHJvcF0gPSB2YWx1ZTtcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgICAgICB9LFxuXG4gICAgICAgICAgc2V0KHByb3h5VGFyZ2V0LCBwcm9wLCB2YWx1ZSwgcmVjZWl2ZXIpIHtcbiAgICAgICAgICAgIGlmIChwcm9wIGluIGNhY2hlKSB7XG4gICAgICAgICAgICAgIGNhY2hlW3Byb3BdID0gdmFsdWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB0YXJnZXRbcHJvcF0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgfSxcblxuICAgICAgICAgIGRlZmluZVByb3BlcnR5KHByb3h5VGFyZ2V0LCBwcm9wLCBkZXNjKSB7XG4gICAgICAgICAgICByZXR1cm4gUmVmbGVjdC5kZWZpbmVQcm9wZXJ0eShjYWNoZSwgcHJvcCwgZGVzYyk7XG4gICAgICAgICAgfSxcblxuICAgICAgICAgIGRlbGV0ZVByb3BlcnR5KHByb3h5VGFyZ2V0LCBwcm9wKSB7XG4gICAgICAgICAgICByZXR1cm4gUmVmbGVjdC5kZWxldGVQcm9wZXJ0eShjYWNoZSwgcHJvcCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgIH07IC8vIFBlciBjb250cmFjdCBvZiB0aGUgUHJveHkgQVBJLCB0aGUgXCJnZXRcIiBwcm94eSBoYW5kbGVyIG11c3QgcmV0dXJuIHRoZVxuICAgICAgICAvLyBvcmlnaW5hbCB2YWx1ZSBvZiB0aGUgdGFyZ2V0IGlmIHRoYXQgdmFsdWUgaXMgZGVjbGFyZWQgcmVhZC1vbmx5IGFuZFxuICAgICAgICAvLyBub24tY29uZmlndXJhYmxlLiBGb3IgdGhpcyByZWFzb24sIHdlIGNyZWF0ZSBhbiBvYmplY3Qgd2l0aCB0aGVcbiAgICAgICAgLy8gcHJvdG90eXBlIHNldCB0byBgdGFyZ2V0YCBpbnN0ZWFkIG9mIHVzaW5nIGB0YXJnZXRgIGRpcmVjdGx5LlxuICAgICAgICAvLyBPdGhlcndpc2Ugd2UgY2Fubm90IHJldHVybiBhIGN1c3RvbSBvYmplY3QgZm9yIEFQSXMgdGhhdFxuICAgICAgICAvLyBhcmUgZGVjbGFyZWQgcmVhZC1vbmx5IGFuZCBub24tY29uZmlndXJhYmxlLCBzdWNoIGFzIGBjaHJvbWUuZGV2dG9vbHNgLlxuICAgICAgICAvL1xuICAgICAgICAvLyBUaGUgcHJveHkgaGFuZGxlcnMgdGhlbXNlbHZlcyB3aWxsIHN0aWxsIHVzZSB0aGUgb3JpZ2luYWwgYHRhcmdldGBcbiAgICAgICAgLy8gaW5zdGVhZCBvZiB0aGUgYHByb3h5VGFyZ2V0YCwgc28gdGhhdCB0aGUgbWV0aG9kcyBhbmQgcHJvcGVydGllcyBhcmVcbiAgICAgICAgLy8gZGVyZWZlcmVuY2VkIHZpYSB0aGUgb3JpZ2luYWwgdGFyZ2V0cy5cblxuICAgICAgICBsZXQgcHJveHlUYXJnZXQgPSBPYmplY3QuY3JlYXRlKHRhcmdldCk7XG4gICAgICAgIHJldHVybiBuZXcgUHJveHkocHJveHlUYXJnZXQsIGhhbmRsZXJzKTtcbiAgICAgIH07XG4gICAgICAvKipcbiAgICAgICAqIENyZWF0ZXMgYSBzZXQgb2Ygd3JhcHBlciBmdW5jdGlvbnMgZm9yIGFuIGV2ZW50IG9iamVjdCwgd2hpY2ggaGFuZGxlc1xuICAgICAgICogd3JhcHBpbmcgb2YgbGlzdGVuZXIgZnVuY3Rpb25zIHRoYXQgdGhvc2UgbWVzc2FnZXMgYXJlIHBhc3NlZC5cbiAgICAgICAqXG4gICAgICAgKiBBIHNpbmdsZSB3cmFwcGVyIGlzIGNyZWF0ZWQgZm9yIGVhY2ggbGlzdGVuZXIgZnVuY3Rpb24sIGFuZCBzdG9yZWQgaW4gYVxuICAgICAgICogbWFwLiBTdWJzZXF1ZW50IGNhbGxzIHRvIGBhZGRMaXN0ZW5lcmAsIGBoYXNMaXN0ZW5lcmAsIG9yIGByZW1vdmVMaXN0ZW5lcmBcbiAgICAgICAqIHJldHJpZXZlIHRoZSBvcmlnaW5hbCB3cmFwcGVyLCBzbyB0aGF0ICBhdHRlbXB0cyB0byByZW1vdmUgYVxuICAgICAgICogcHJldmlvdXNseS1hZGRlZCBsaXN0ZW5lciB3b3JrIGFzIGV4cGVjdGVkLlxuICAgICAgICpcbiAgICAgICAqIEBwYXJhbSB7RGVmYXVsdFdlYWtNYXA8ZnVuY3Rpb24sIGZ1bmN0aW9uPn0gd3JhcHBlck1hcFxuICAgICAgICogICAgICAgIEEgRGVmYXVsdFdlYWtNYXAgb2JqZWN0IHdoaWNoIHdpbGwgY3JlYXRlIHRoZSBhcHByb3ByaWF0ZSB3cmFwcGVyXG4gICAgICAgKiAgICAgICAgZm9yIGEgZ2l2ZW4gbGlzdGVuZXIgZnVuY3Rpb24gd2hlbiBvbmUgZG9lcyBub3QgZXhpc3QsIGFuZCByZXRyaWV2ZVxuICAgICAgICogICAgICAgIGFuIGV4aXN0aW5nIG9uZSB3aGVuIGl0IGRvZXMuXG4gICAgICAgKlxuICAgICAgICogQHJldHVybnMge29iamVjdH1cbiAgICAgICAqL1xuXG5cbiAgICAgIGNvbnN0IHdyYXBFdmVudCA9IHdyYXBwZXJNYXAgPT4gKHtcbiAgICAgICAgYWRkTGlzdGVuZXIodGFyZ2V0LCBsaXN0ZW5lciwgLi4uYXJncykge1xuICAgICAgICAgIHRhcmdldC5hZGRMaXN0ZW5lcih3cmFwcGVyTWFwLmdldChsaXN0ZW5lciksIC4uLmFyZ3MpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGhhc0xpc3RlbmVyKHRhcmdldCwgbGlzdGVuZXIpIHtcbiAgICAgICAgICByZXR1cm4gdGFyZ2V0Lmhhc0xpc3RlbmVyKHdyYXBwZXJNYXAuZ2V0KGxpc3RlbmVyKSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVtb3ZlTGlzdGVuZXIodGFyZ2V0LCBsaXN0ZW5lcikge1xuICAgICAgICAgIHRhcmdldC5yZW1vdmVMaXN0ZW5lcih3cmFwcGVyTWFwLmdldChsaXN0ZW5lcikpO1xuICAgICAgICB9XG5cbiAgICAgIH0pOyAvLyBLZWVwIHRyYWNrIGlmIHRoZSBkZXByZWNhdGlvbiB3YXJuaW5nIGhhcyBiZWVuIGxvZ2dlZCBhdCBsZWFzdCBvbmNlLlxuXG5cbiAgICAgIGxldCBsb2dnZWRTZW5kUmVzcG9uc2VEZXByZWNhdGlvbldhcm5pbmcgPSBmYWxzZTtcbiAgICAgIGNvbnN0IG9uTWVzc2FnZVdyYXBwZXJzID0gbmV3IERlZmF1bHRXZWFrTWFwKGxpc3RlbmVyID0+IHtcbiAgICAgICAgaWYgKHR5cGVvZiBsaXN0ZW5lciAhPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgcmV0dXJuIGxpc3RlbmVyO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXcmFwcyBhIG1lc3NhZ2UgbGlzdGVuZXIgZnVuY3Rpb24gc28gdGhhdCBpdCBtYXkgc2VuZCByZXNwb25zZXMgYmFzZWQgb25cbiAgICAgICAgICogaXRzIHJldHVybiB2YWx1ZSwgcmF0aGVyIHRoYW4gYnkgcmV0dXJuaW5nIGEgc2VudGluZWwgdmFsdWUgYW5kIGNhbGxpbmcgYVxuICAgICAgICAgKiBjYWxsYmFjay4gSWYgdGhlIGxpc3RlbmVyIGZ1bmN0aW9uIHJldHVybnMgYSBQcm9taXNlLCB0aGUgcmVzcG9uc2UgaXNcbiAgICAgICAgICogc2VudCB3aGVuIHRoZSBwcm9taXNlIGVpdGhlciByZXNvbHZlcyBvciByZWplY3RzLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAcGFyYW0geyp9IG1lc3NhZ2VcbiAgICAgICAgICogICAgICAgIFRoZSBtZXNzYWdlIHNlbnQgYnkgdGhlIG90aGVyIGVuZCBvZiB0aGUgY2hhbm5lbC5cbiAgICAgICAgICogQHBhcmFtIHtvYmplY3R9IHNlbmRlclxuICAgICAgICAgKiAgICAgICAgRGV0YWlscyBhYm91dCB0aGUgc2VuZGVyIG9mIHRoZSBtZXNzYWdlLlxuICAgICAgICAgKiBAcGFyYW0ge2Z1bmN0aW9uKCopfSBzZW5kUmVzcG9uc2VcbiAgICAgICAgICogICAgICAgIEEgY2FsbGJhY2sgd2hpY2gsIHdoZW4gY2FsbGVkIHdpdGggYW4gYXJiaXRyYXJ5IGFyZ3VtZW50LCBzZW5kc1xuICAgICAgICAgKiAgICAgICAgdGhhdCB2YWx1ZSBhcyBhIHJlc3BvbnNlLlxuICAgICAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAgICAgICAgICogICAgICAgIFRydWUgaWYgdGhlIHdyYXBwZWQgbGlzdGVuZXIgcmV0dXJuZWQgYSBQcm9taXNlLCB3aGljaCB3aWxsIGxhdGVyXG4gICAgICAgICAqICAgICAgICB5aWVsZCBhIHJlc3BvbnNlLiBGYWxzZSBvdGhlcndpc2UuXG4gICAgICAgICAqL1xuXG5cbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIG9uTWVzc2FnZShtZXNzYWdlLCBzZW5kZXIsIHNlbmRSZXNwb25zZSkge1xuICAgICAgICAgIGxldCBkaWRDYWxsU2VuZFJlc3BvbnNlID0gZmFsc2U7XG4gICAgICAgICAgbGV0IHdyYXBwZWRTZW5kUmVzcG9uc2U7XG4gICAgICAgICAgbGV0IHNlbmRSZXNwb25zZVByb21pc2UgPSBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcbiAgICAgICAgICAgIHdyYXBwZWRTZW5kUmVzcG9uc2UgPSBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgaWYgKCFsb2dnZWRTZW5kUmVzcG9uc2VEZXByZWNhdGlvbldhcm5pbmcpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oU0VORF9SRVNQT05TRV9ERVBSRUNBVElPTl9XQVJOSU5HLCBuZXcgRXJyb3IoKS5zdGFjayk7XG4gICAgICAgICAgICAgICAgbG9nZ2VkU2VuZFJlc3BvbnNlRGVwcmVjYXRpb25XYXJuaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGRpZENhbGxTZW5kUmVzcG9uc2UgPSB0cnVlO1xuICAgICAgICAgICAgICByZXNvbHZlKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgbGV0IHJlc3VsdDtcblxuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXN1bHQgPSBsaXN0ZW5lcihtZXNzYWdlLCBzZW5kZXIsIHdyYXBwZWRTZW5kUmVzcG9uc2UpO1xuICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgcmVzdWx0ID0gUHJvbWlzZS5yZWplY3QoZXJyKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBjb25zdCBpc1Jlc3VsdFRoZW5hYmxlID0gcmVzdWx0ICE9PSB0cnVlICYmIGlzVGhlbmFibGUocmVzdWx0KTsgLy8gSWYgdGhlIGxpc3RlbmVyIGRpZG4ndCByZXR1cm5lZCB0cnVlIG9yIGEgUHJvbWlzZSwgb3IgY2FsbGVkXG4gICAgICAgICAgLy8gd3JhcHBlZFNlbmRSZXNwb25zZSBzeW5jaHJvbm91c2x5LCB3ZSBjYW4gZXhpdCBlYXJsaWVyXG4gICAgICAgICAgLy8gYmVjYXVzZSB0aGVyZSB3aWxsIGJlIG5vIHJlc3BvbnNlIHNlbnQgZnJvbSB0aGlzIGxpc3RlbmVyLlxuXG4gICAgICAgICAgaWYgKHJlc3VsdCAhPT0gdHJ1ZSAmJiAhaXNSZXN1bHRUaGVuYWJsZSAmJiAhZGlkQ2FsbFNlbmRSZXNwb25zZSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH0gLy8gQSBzbWFsbCBoZWxwZXIgdG8gc2VuZCB0aGUgbWVzc2FnZSBpZiB0aGUgcHJvbWlzZSByZXNvbHZlc1xuICAgICAgICAgIC8vIGFuZCBhbiBlcnJvciBpZiB0aGUgcHJvbWlzZSByZWplY3RzIChhIHdyYXBwZWQgc2VuZE1lc3NhZ2UgaGFzXG4gICAgICAgICAgLy8gdG8gdHJhbnNsYXRlIHRoZSBtZXNzYWdlIGludG8gYSByZXNvbHZlZCBwcm9taXNlIG9yIGEgcmVqZWN0ZWRcbiAgICAgICAgICAvLyBwcm9taXNlKS5cblxuXG4gICAgICAgICAgY29uc3Qgc2VuZFByb21pc2VkUmVzdWx0ID0gcHJvbWlzZSA9PiB7XG4gICAgICAgICAgICBwcm9taXNlLnRoZW4obXNnID0+IHtcbiAgICAgICAgICAgICAgLy8gc2VuZCB0aGUgbWVzc2FnZSB2YWx1ZS5cbiAgICAgICAgICAgICAgc2VuZFJlc3BvbnNlKG1zZyk7XG4gICAgICAgICAgICB9LCBlcnJvciA9PiB7XG4gICAgICAgICAgICAgIC8vIFNlbmQgYSBKU09OIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBlcnJvciBpZiB0aGUgcmVqZWN0ZWQgdmFsdWVcbiAgICAgICAgICAgICAgLy8gaXMgYW4gaW5zdGFuY2Ugb2YgZXJyb3IsIG9yIHRoZSBvYmplY3QgaXRzZWxmIG90aGVyd2lzZS5cbiAgICAgICAgICAgICAgbGV0IG1lc3NhZ2U7XG5cbiAgICAgICAgICAgICAgaWYgKGVycm9yICYmIChlcnJvciBpbnN0YW5jZW9mIEVycm9yIHx8IHR5cGVvZiBlcnJvci5tZXNzYWdlID09PSBcInN0cmluZ1wiKSkge1xuICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSBlcnJvci5tZXNzYWdlO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSBcIkFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWRcIjtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIHNlbmRSZXNwb25zZSh7XG4gICAgICAgICAgICAgICAgX19tb3pXZWJFeHRlbnNpb25Qb2x5ZmlsbFJlamVjdF9fOiB0cnVlLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KS5jYXRjaChlcnIgPT4ge1xuICAgICAgICAgICAgICAvLyBQcmludCBhbiBlcnJvciBvbiB0aGUgY29uc29sZSBpZiB1bmFibGUgdG8gc2VuZCB0aGUgcmVzcG9uc2UuXG4gICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gc2VuZCBvbk1lc3NhZ2UgcmVqZWN0ZWQgcmVwbHlcIiwgZXJyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH07IC8vIElmIHRoZSBsaXN0ZW5lciByZXR1cm5lZCBhIFByb21pc2UsIHNlbmQgdGhlIHJlc29sdmVkIHZhbHVlIGFzIGFcbiAgICAgICAgICAvLyByZXN1bHQsIG90aGVyd2lzZSB3YWl0IHRoZSBwcm9taXNlIHJlbGF0ZWQgdG8gdGhlIHdyYXBwZWRTZW5kUmVzcG9uc2VcbiAgICAgICAgICAvLyBjYWxsYmFjayB0byByZXNvbHZlIGFuZCBzZW5kIGl0IGFzIGEgcmVzcG9uc2UuXG5cblxuICAgICAgICAgIGlmIChpc1Jlc3VsdFRoZW5hYmxlKSB7XG4gICAgICAgICAgICBzZW5kUHJvbWlzZWRSZXN1bHQocmVzdWx0KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc2VuZFByb21pc2VkUmVzdWx0KHNlbmRSZXNwb25zZVByb21pc2UpO1xuICAgICAgICAgIH0gLy8gTGV0IENocm9tZSBrbm93IHRoYXQgdGhlIGxpc3RlbmVyIGlzIHJlcGx5aW5nLlxuXG5cbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfTtcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCB3cmFwcGVkU2VuZE1lc3NhZ2VDYWxsYmFjayA9ICh7XG4gICAgICAgIHJlamVjdCxcbiAgICAgICAgcmVzb2x2ZVxuICAgICAgfSwgcmVwbHkpID0+IHtcbiAgICAgICAgaWYgKGV4dGVuc2lvbkFQSXMucnVudGltZS5sYXN0RXJyb3IpIHtcbiAgICAgICAgICAvLyBEZXRlY3Qgd2hlbiBub25lIG9mIHRoZSBsaXN0ZW5lcnMgcmVwbGllZCB0byB0aGUgc2VuZE1lc3NhZ2UgY2FsbCBhbmQgcmVzb2x2ZVxuICAgICAgICAgIC8vIHRoZSBwcm9taXNlIHRvIHVuZGVmaW5lZCBhcyBpbiBGaXJlZm94LlxuICAgICAgICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vbW96aWxsYS93ZWJleHRlbnNpb24tcG9seWZpbGwvaXNzdWVzLzEzMFxuICAgICAgICAgIGlmIChleHRlbnNpb25BUElzLnJ1bnRpbWUubGFzdEVycm9yLm1lc3NhZ2UgPT09IENIUk9NRV9TRU5EX01FU1NBR0VfQ0FMTEJBQ0tfTk9fUkVTUE9OU0VfTUVTU0FHRSkge1xuICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZWplY3QoZXh0ZW5zaW9uQVBJcy5ydW50aW1lLmxhc3RFcnJvcik7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKHJlcGx5ICYmIHJlcGx5Ll9fbW96V2ViRXh0ZW5zaW9uUG9seWZpbGxSZWplY3RfXykge1xuICAgICAgICAgIC8vIENvbnZlcnQgYmFjayB0aGUgSlNPTiByZXByZXNlbnRhdGlvbiBvZiB0aGUgZXJyb3IgaW50b1xuICAgICAgICAgIC8vIGFuIEVycm9yIGluc3RhbmNlLlxuICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IocmVwbHkubWVzc2FnZSkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlc29sdmUocmVwbHkpO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBjb25zdCB3cmFwcGVkU2VuZE1lc3NhZ2UgPSAobmFtZSwgbWV0YWRhdGEsIGFwaU5hbWVzcGFjZU9iaiwgLi4uYXJncykgPT4ge1xuICAgICAgICBpZiAoYXJncy5sZW5ndGggPCBtZXRhZGF0YS5taW5BcmdzKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBFeHBlY3RlZCBhdCBsZWFzdCAke21ldGFkYXRhLm1pbkFyZ3N9ICR7cGx1cmFsaXplQXJndW1lbnRzKG1ldGFkYXRhLm1pbkFyZ3MpfSBmb3IgJHtuYW1lfSgpLCBnb3QgJHthcmdzLmxlbmd0aH1gKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChhcmdzLmxlbmd0aCA+IG1ldGFkYXRhLm1heEFyZ3MpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEV4cGVjdGVkIGF0IG1vc3QgJHttZXRhZGF0YS5tYXhBcmdzfSAke3BsdXJhbGl6ZUFyZ3VtZW50cyhtZXRhZGF0YS5tYXhBcmdzKX0gZm9yICR7bmFtZX0oKSwgZ290ICR7YXJncy5sZW5ndGh9YCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgIGNvbnN0IHdyYXBwZWRDYiA9IHdyYXBwZWRTZW5kTWVzc2FnZUNhbGxiYWNrLmJpbmQobnVsbCwge1xuICAgICAgICAgICAgcmVzb2x2ZSxcbiAgICAgICAgICAgIHJlamVjdFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGFyZ3MucHVzaCh3cmFwcGVkQ2IpO1xuICAgICAgICAgIGFwaU5hbWVzcGFjZU9iai5zZW5kTWVzc2FnZSguLi5hcmdzKTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuXG4gICAgICBjb25zdCBzdGF0aWNXcmFwcGVycyA9IHtcbiAgICAgICAgcnVudGltZToge1xuICAgICAgICAgIG9uTWVzc2FnZTogd3JhcEV2ZW50KG9uTWVzc2FnZVdyYXBwZXJzKSxcbiAgICAgICAgICBvbk1lc3NhZ2VFeHRlcm5hbDogd3JhcEV2ZW50KG9uTWVzc2FnZVdyYXBwZXJzKSxcbiAgICAgICAgICBzZW5kTWVzc2FnZTogd3JhcHBlZFNlbmRNZXNzYWdlLmJpbmQobnVsbCwgXCJzZW5kTWVzc2FnZVwiLCB7XG4gICAgICAgICAgICBtaW5BcmdzOiAxLFxuICAgICAgICAgICAgbWF4QXJnczogM1xuICAgICAgICAgIH0pXG4gICAgICAgIH0sXG4gICAgICAgIHRhYnM6IHtcbiAgICAgICAgICBzZW5kTWVzc2FnZTogd3JhcHBlZFNlbmRNZXNzYWdlLmJpbmQobnVsbCwgXCJzZW5kTWVzc2FnZVwiLCB7XG4gICAgICAgICAgICBtaW5BcmdzOiAyLFxuICAgICAgICAgICAgbWF4QXJnczogM1xuICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICBjb25zdCBzZXR0aW5nTWV0YWRhdGEgPSB7XG4gICAgICAgIGNsZWFyOiB7XG4gICAgICAgICAgbWluQXJnczogMSxcbiAgICAgICAgICBtYXhBcmdzOiAxXG4gICAgICAgIH0sXG4gICAgICAgIGdldDoge1xuICAgICAgICAgIG1pbkFyZ3M6IDEsXG4gICAgICAgICAgbWF4QXJnczogMVxuICAgICAgICB9LFxuICAgICAgICBzZXQ6IHtcbiAgICAgICAgICBtaW5BcmdzOiAxLFxuICAgICAgICAgIG1heEFyZ3M6IDFcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIGFwaU1ldGFkYXRhLnByaXZhY3kgPSB7XG4gICAgICAgIG5ldHdvcms6IHtcbiAgICAgICAgICBcIipcIjogc2V0dGluZ01ldGFkYXRhXG4gICAgICAgIH0sXG4gICAgICAgIHNlcnZpY2VzOiB7XG4gICAgICAgICAgXCIqXCI6IHNldHRpbmdNZXRhZGF0YVxuICAgICAgICB9LFxuICAgICAgICB3ZWJzaXRlczoge1xuICAgICAgICAgIFwiKlwiOiBzZXR0aW5nTWV0YWRhdGFcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHJldHVybiB3cmFwT2JqZWN0KGV4dGVuc2lvbkFQSXMsIHN0YXRpY1dyYXBwZXJzLCBhcGlNZXRhZGF0YSk7XG4gICAgfTtcblxuICAgIGlmICh0eXBlb2YgY2hyb21lICE9IFwib2JqZWN0XCIgfHwgIWNocm9tZSB8fCAhY2hyb21lLnJ1bnRpbWUgfHwgIWNocm9tZS5ydW50aW1lLmlkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUaGlzIHNjcmlwdCBzaG91bGQgb25seSBiZSBsb2FkZWQgaW4gYSBicm93c2VyIGV4dGVuc2lvbi5cIik7XG4gICAgfSAvLyBUaGUgYnVpbGQgcHJvY2VzcyBhZGRzIGEgVU1EIHdyYXBwZXIgYXJvdW5kIHRoaXMgZmlsZSwgd2hpY2ggbWFrZXMgdGhlXG4gICAgLy8gYG1vZHVsZWAgdmFyaWFibGUgYXZhaWxhYmxlLlxuXG5cbiAgICBtb2R1bGUuZXhwb3J0cyA9IHdyYXBBUElzKGNocm9tZSk7XG4gIH0gZWxzZSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBicm93c2VyO1xuICB9XG59KTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWJyb3dzZXItcG9seWZpbGwuanMubWFwXG4iLCIvLyBUaGUgbW9kdWxlIGNhY2hlXG52YXIgX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fID0ge307XG5cbi8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG5mdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuXHR2YXIgY2FjaGVkTW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXTtcblx0aWYgKGNhY2hlZE1vZHVsZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0cmV0dXJuIGNhY2hlZE1vZHVsZS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuIiwiLy8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbl9fd2VicGFja19yZXF1aXJlX18ubiA9IChtb2R1bGUpID0+IHtcblx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG5cdFx0KCkgPT4gKG1vZHVsZVsnZGVmYXVsdCddKSA6XG5cdFx0KCkgPT4gKG1vZHVsZSk7XG5cdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsIHsgYTogZ2V0dGVyIH0pO1xuXHRyZXR1cm4gZ2V0dGVyO1xufTsiLCIvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9ucyBmb3IgaGFybW9ueSBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSAoZXhwb3J0cywgZGVmaW5pdGlvbikgPT4ge1xuXHRmb3IodmFyIGtleSBpbiBkZWZpbml0aW9uKSB7XG5cdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGRlZmluaXRpb24sIGtleSkgJiYgIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBrZXkpKSB7XG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywga2V5LCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZGVmaW5pdGlvbltrZXldIH0pO1xuXHRcdH1cblx0fVxufTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSAob2JqLCBwcm9wKSA9PiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCkpIiwiLy8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5yID0gKGV4cG9ydHMpID0+IHtcblx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG5cdH1cblx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbn07IiwiaW1wb3J0IHsgY29udGVudCB9IGZyb20gJy4uLy4uL3BhZ2VzL2NvbnRlbnQnO1xuXG5jb250ZW50LmluaXQoKTtcbiJdLCJzb3VyY2VSb290IjoiIn0=
>>>>>>> Stashed changes
